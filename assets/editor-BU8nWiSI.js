var je=Object.defineProperty;var Pe=(t,e,s)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Mt=(t,e,s)=>Pe(t,typeof e!="symbol"?e+"":e,s);import{r as x,R as kt,j as g,a as Re,b as Ie,c as pe}from"./vendor-react-BcztRRPo.js";import{J as Ee}from"./vendor-zip-CPkGWvL_.js";import{P as Le}from"./beatmap-preview-BasPDPAs.js";function Kt(t){const e=(s,n)=>{const o=t==null?void 0:t[s],i=typeof o=="number"?o:Number(o);return Number.isFinite(i)?i:n};return{AR:e("ApproachRate",e("AR",5)),CS:e("CircleSize",5),OD:e("OverallDifficulty",e("OD",5)),HP:e("HPDrainRate",e("HP",5)),SliderMultiplier:e("SliderMultiplier",1.4),SliderTickRate:e("SliderTickRate",1)}}function ge(t){return 54.4-4.48*t}function ye(t){return t<=5?1800-120*t:1200-150*(t-5)}function Ne(t){return ye(t)*.4}function Jt(t){return t?typeof t.uninherited=="number"?t.uninherited===1:(t.beatLength??0)>0:!1}function $t(t,e){const s=t.timingPoints||[];let n=null,o=null;for(let i=0;i<s.length;i++){const r=s[i];if(r.time<=e)Jt(r)?n=r:o=r;else break}if(!n||!o)for(let i=s.length-1;i>=0&&(!n||!o);i--){const r=s[i];r.time<=e&&(Jt(r)&&!n&&(n=r),!Jt(r)&&!o&&(o=r))}return{base:n,inherited:o}}const Ot=512,Nt=384;function Ae(t){const e=[];for(let i=0;i<t.length;i++){const r=t[i];(!e.length||e[e.length-1].x!==r.x||e[e.length-1].y!==r.y)&&e.push({x:r.x,y:r.y})}const s=[],n=[0];for(let i=1;i<e.length;i++){const r=e[i].x-e[i-1].x,a=e[i].y-e[i-1].y,h=Math.hypot(r,a);s.push(h),n.push(n[n.length-1]+h)}const o=n[n.length-1]||0;return{pts:e,segLen:s,cumLen:n,total:o}}function Ft(t,e){const s=t.total||1,n=Math.max(0,Math.min(s,e*s));let o=1;for(;o<t.cumLen.length&&t.cumLen[o]<n;)o++;const i=Math.max(0,o-1),r=t.cumLen[i],a=t.segLen[i]||1,h=a>0?(n-r)/a:0,c=t.pts[i],d=t.pts[Math.min(i+1,t.pts.length-1)];return{x:c.x+(d.x-c.x)*h,y:c.y+(d.y-c.y)*h}}function Be(t,e){const s=t.total||1,n=Math.max(0,Math.min(s,e*s));let o=1;for(;o<t.cumLen.length&&t.cumLen[o]<n;)o++;const i=Math.max(0,Math.min(t.pts.length-2,o-1)),r=t.pts[i],a=t.pts[i+1];return Math.atan2(a.y-r.y,a.x-r.x)}function re(t,e){const s=Math.max(0,Math.min(t.total,e));if(s<=0)return[t.pts[0]];if(s>=t.total)return t.pts.slice();const n=[];let o=0;n.push(t.pts[0]);for(let i=1;i<t.pts.length;i++){const r=t.segLen[i-1];if(o+r<s){n.push(t.pts[i]),o+=r;continue}const a=s-o,h=r>0?a/r:0,c=t.pts[i-1],d=t.pts[i];n.push({x:c.x+(d.x-c.x)*h,y:c.y+(d.y-c.y)*h});break}return n}function Fe(t,e){let s=t.map(n=>({x:n.x,y:n.y}));for(;s.length>1;){const n=[];for(let o=0;o<s.length-1;o++)n.push({x:s[o].x+(s[o+1].x-s[o].x)*e,y:s[o].y+(s[o+1].y-s[o].y)*e});s=n}return s[0]}function ne(t,e=64){const s=[];for(let n=0;n<=e;n++){const o=n/e;s.push(Fe(t,o))}return s}function Oe(t,e=64){const s=[];if(t.length<2)return t.slice();const n=t.slice(),o=.5,i=n.length-1;for(let r=0;r<i;r++){const a=n[Math.max(0,r-1)],h=n[r],c=n[r+1],d=n[Math.min(n.length-1,r+2)];for(let u=0;u<=e;u++){const m=u/e,C=m*m,f=C*m,I=-o*m+2*o*C-o*f,A=1+(o-3)*C+(2-o)*f,E=o*m+(3-2*o)*C+(o-2)*f,M=-o*C+o*f,S=I*a.x+A*h.x+E*c.x+M*d.x,p=I*a.y+A*h.y+E*c.y+M*d.y;s.push({x:S,y:p})}}return s}function $e(t,e=64){if(t.length!==3)return ne(t,96);const[s,n,o]=t,i=n.x-s.x,r=n.y-s.y,a=o.x-s.x,h=o.y-s.y,c=i*(s.x+n.x)+r*(s.y+n.y),d=a*(s.x+o.x)+h*(s.y+o.y),u=2*(i*(o.y-n.y)-r*(o.x-n.x));if(Math.abs(u)<1e-6)return ne(t,96);const m=(h*c-r*d)/u,C=(i*d-a*c)/u,f=Math.atan2(s.y-C,s.x-m),I=Math.atan2(n.y-C,n.x-m),A=Math.atan2(o.y-C,o.x-m),E=P=>(P%(Math.PI*2)+Math.PI*2)%(Math.PI*2),M=E(A-f),S=-E(f-A),j=E(I-f)<=M?M:S,v=Math.hypot(s.x-m,s.y-C),b=[];for(let P=0;P<=e;P++){const H=P/e,ot=f+j*H;b.push({x:m+Math.cos(ot)*v,y:C+Math.sin(ot)*v})}return b}function ce(t,e){return t.x===e.x&&t.y===e.y}function ke(t,e=64){const s=[];let n=t[0],o=[t[0]];for(let r=1;r<t.length;r++){const a=t[r];ce(a,n)?(o.length>=2&&s.push(o.slice()),o=[a]):(o.push(a),n=a)}o.length>=2&&s.push(o);const i=[];for(const r of s){if(r.length===2){i.length===0&&i.push(r[0]),i.push(r[1]);continue}const a=ne(r,e);i.length>0&&ce(i[i.length-1],a[0])&&a.shift(),i.push(...a)}return i}function ie(t,e){let s;return t==="L"?s=e:t==="B"?s=ke(e,96):t==="C"?s=Oe(e,96):s=$e(e,96),Ae(s)}const zt=new Map;function St(t){return Math.max(0,Math.min(1,t))}function Wt(t,e,s,n,o){t.beginPath(),t.arc(e,s,n,0,Math.PI*2),t.strokeStyle=o,t.lineWidth=3,t.stroke()}function _t(t,e){if(!(e.length<2)){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)t.lineTo(e[s].x,e[s].y)}}function De(t){const e=t.trim().match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(e){const n=e[1],o=n.length===3?n.split("").map(h=>h+h).join(""):n,i=parseInt(o.slice(0,2),16),r=parseInt(o.slice(2,4),16),a=parseInt(o.slice(4,6),16);return{r:i,g:r,b:a}}const s=t.trim().match(/^rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);return s?{r:Number(s[1]),g:Number(s[2]),b:Number(s[3])}:null}function ze(t,e,s,n,o,i,r,a=1){if(e.length<2)return;const h=Et.get(e,i,s,n);if(h){t.save(),t.globalAlpha=Math.max(0,Math.min(1,r));const{entry:$,transform:U}=h;t.translate(U.tx,U.ty),t.rotate(U.angle),t.scale(U.scale,U.scale),t.drawImage($.canvas,$.normMinX-$.pad,$.normMinY-$.pad),t.restore();return}const c=Et.normalizePath(e);let d=1/0,u=1/0,m=-1/0,C=-1/0;for(const $ of c)$.x<d&&(d=$.x),$.y<u&&(u=$.y),$.x>m&&(m=$.x),$.y>C&&(C=$.y);const f=Math.ceil(Math.max(s,n)/2)+2,I=Math.max(1,Math.ceil(m-d+f*2)),A=Math.max(1,Math.ceil(C-u+f*2)),E=document.createElement("canvas");E.width=I,E.height=A;const M=E.getContext("2d",{willReadFrequently:!1});M.save(),M.translate(-d+f,-u+f),M.lineCap="round",M.lineJoin="round",M.globalCompositeOperation="source-over",M.globalAlpha=1,M.lineWidth=s,_t(M,c),M.strokeStyle=o,M.stroke();const S=De(i)||{r:255,g:255,b:255},p=`rgba(${S.r}, ${S.g}, ${S.b}, 1)`;M.lineWidth=n,_t(M,c),M.strokeStyle=p,M.stroke();const B=be(),j=we[B];M.globalCompositeOperation="soft-light",M.globalCompositeOperation!=="soft-light"&&(M.globalCompositeOperation="screen");const v=j.highlightPasses;for(let $=0;$<v;$++){const U=$/(v-1),gt=Math.max(1,n*(.96-.7*U)),y=.15*(1-U)*(1-U)*a;M.lineWidth=gt,_t(M,c),M.strokeStyle=`rgba(255,255,255,${y.toFixed(3)})`,M.stroke()}if(j.edgePasses>0){M.globalCompositeOperation="multiply";const $=j.edgePasses;for(let U=0;U<$;U++){const gt=U/($-1),y=Math.max(1,n*(.98-.08*gt)),_=(.1-.03*gt)*a;M.lineWidth=y,_t(M,c),M.strokeStyle=`rgba(0,0,0,${Math.max(0,_).toFixed(3)})`,M.stroke()}}M.restore(),Et.set(e,i,s,n,{canvas:E,normalizedWidth:I,normalizedHeight:A,pad:f,normMinX:d,normMinY:u,lastUsed:0,accessCount:0,memoryBytes:I*A*4,pathSignature:Et.generatePathSignature(e)});const b=e[0],P=e[e.length-1],H=c[c.length-1],ot=Math.atan2(P.y-b.y,P.x-b.x),Z=Math.atan2(H.y,H.x),nt=ot-Z;t.save(),t.globalAlpha=Math.max(0,Math.min(1,r)),t.translate(b.x,b.y),t.rotate(nt),t.drawImage(E,d-f,u-f),t.restore()}function Ht(t,e,s,n,o,i=1,r){const a=o.hitcircle,h=o.hitcircleoverlay,c=n*2/(a.width||128),d=Math.max(1,Math.round(a.width*c)),u=Math.max(1,Math.round(a.height*c));if(t.save(),t.translate(e,s),t.globalAlpha=i,r){const m=`${a.src}|${r}|${d}x${u}`;let C=zt.get(m);if(!C){C=document.createElement("canvas"),C.width=d,C.height=u;const f=C.getContext("2d");f.drawImage(a,0,0,d,u),f.globalCompositeOperation="source-in",f.fillStyle=r,f.fillRect(0,0,d,u),zt.set(m,C)}t.drawImage(C,-d/2,-u/2,d,u)}else t.drawImage(a,-d/2,-u/2,d,u);h&&t.drawImage(h,-d/2,-u/2,d,u),t.restore()}function le(t,e,s,n,o,i,r){const a=i.approachcircle,h=n*2/(a.width||128),c=Math.max(1,Math.round(a.width*h)),d=Math.max(1,Math.round(a.height*h));if(t.save(),t.globalAlpha=.6*o,t.translate(e,s),r){const u=`${a.src}|approach|${r}|${c}x${d}`;let m=zt.get(u);if(!m){m=document.createElement("canvas"),m.width=c,m.height=d;const C=m.getContext("2d");C.drawImage(a,0,0,c,d),C.globalCompositeOperation="source-in",C.fillStyle=r,C.fillRect(0,0,c,d),zt.set(u,m)}t.drawImage(m,-c/2,-d/2,c,d)}else t.drawImage(a,-c/2,-d/2,c,d);t.restore()}function Ue(t,e,s,n,o,i=1){const r=o.sliderfollowcircle,a=n*2/(r.width||256),h=r.width*a,c=r.height*a;t.save(),t.globalAlpha=.9*St(i),t.translate(e,s),t.drawImage(r,-h/2,-c/2,h,c),t.restore()}function he(t,e,s,n,o,i,r=1){var f;if(!o.digits||i<=0)return;const h=String(i).split("").map(I=>o.digits[Number(I)]),c=((f=h[0])==null?void 0:f.height)||32,u=n*.82*.85/c,m=h.reduce((I,A)=>I+((A==null?void 0:A.width)||20)*u,0);let C=e-m/2;t.save(),t.globalAlpha=r;for(const I of h){const A=((I==null?void 0:I.width)||20)*u,E=((I==null?void 0:I.height)||20)*u;t.drawImage(I,C,s-E/2,A,E),C+=A}t.restore()}function We(t,e,s){const n=Math.max(1,Math.round(e)),o=`${t.src}|ball|${s}|${n}`;let i=zt.get(o);if(!i){i=document.createElement("canvas"),i.width=n,i.height=n;const r=i.getContext("2d");r.clearRect(0,0,n,n),r.drawImage(t,0,0,n,n),r.globalCompositeOperation="multiply",r.fillStyle=s,r.fillRect(0,0,n,n),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0,n,n),zt.set(o,i)}return i}function Xt(t,e,s,n,o,i,r,a,h){const c=Math.max(1,o),d=c/Math.max(1,e.width||128),u=(e.width||128)*d,m=(e.height||128)*d;if(t.save(),t.translate(s,n),t.rotate(i),h?t.globalCompositeOperation="lighter":t.globalCompositeOperation="source-over",r&&r!=="#ffffff"&&r!=="rgba(255,255,255,1)"){const C=We(e,c,r);t.globalAlpha=a,t.drawImage(C,-u/2,-m/2,u,m)}else t.globalAlpha=a,t.drawImage(e,-u/2,-m/2,u,m);t.restore()}function _e(t,e,s,n,o,i){const r=t.createRadialGradient(e-n*.3,s-n*.3,n*.15,e,s,n);r.addColorStop(0,"rgba(255,255,255,1)"),r.addColorStop(1,o),t.save(),t.globalAlpha=i,t.fillStyle=r,t.beginPath(),t.arc(e,s,n,0,Math.PI*2),t.fill(),t.restore()}function Dt(t){return t*(2-t)}function Ut(t,e,s,n){const o=n&&n<0?100/-n:1,i=100*s*o;return t.length/Math.max(1e-6,i)*e}function He(t,e,s,n,o){const i=n&&n<0?100/-n:1,r=100*s*i,a=t.length/Math.max(1e-6,r),h=1/Math.max(1e-6,o),c=[];for(let d=h;d<a-.001;d+=h){const u=d/a;u>0&&u<1&&c.push(u)}return c}function Xe(t,e,s){let n=1/0;for(let o=1;o<s.pts.length;o++){const i=s.pts[o-1],r=s.pts[o],a=r.x-i.x,h=r.y-i.y,c=a*a+h*h;let d=0;c>0&&(d=((t-i.x)*a+(e-i.y)*h)/c,d=Math.max(0,Math.min(1,d)));const u=i.x+a*d,m=i.y+h*d,C=Math.hypot(u-t,m-e);C<n&&(n=C)}return n}function qt(t,e,s){const n=3*s;return{x:t-n,y:e-n}}function xe(t){const e=(t==null?void 0:t.hitObjects.length)||0,s=new Array(e).fill(0),n=new Array(e).fill(1);if(!t)return{colorIndex:s,number:n};let o=0,i=0;for(let r=0;r<e;r++){const a=t.hitObjects[r];a.newCombo?(o=o+1+(a.comboSkip||0),i=1):i=(i||1)+1,s[r]=o,n[r]=i}return{colorIndex:s,number:n}}function Ye(t){const e=(t==null?void 0:t.hitObjects.length)||0,s=new Array(e).fill(0);if(!t)return s;const n=t.hitObjects,o=60,i=3;for(let r=1;r<e;r++){const a=n[r-1],h=n[r];if(h.time-a.time<=o){const d=h.x-a.x,u=h.y-a.y;if(Math.hypot(d,u)<=i){s[r]=s[r-1]+1;continue}}if(a.kind==="slider"){const d=oe(t,a),u=ve(t,a),m=h.time-d;if(m<=o&&m>=-o){const C=ae(h),f=C.x-u.x,I=C.y-u.y;Math.hypot(f,I)<=i&&(s[r]=s[r-1]+1)}}}return s}function oe(t,e){if(e.kind==="circle")return e.time;if(e.kind==="spinner")return e.endTime;const{base:s,inherited:n}=$t(t,e.time),o=(s==null?void 0:s.beatLength)??500,i=n==null?void 0:n.beatLength,r=Ut(e,o,Kt(t.difficulty).SliderMultiplier,i),a=Math.max(1,e.slides);return e.time+r*a}function ve(t,e){if(e.kind==="circle")return ae(e);if(e.kind==="spinner")return{x:Ot/2,y:Nt/2};const s=e,n=ie(s.curveType,s.points),o=s.length;let i=n;if(o>0&&o<n.total){const m=re(n,o),C={pts:m,segLen:[],cumLen:[0],total:o};for(let f=1;f<m.length;f++){const I=m[f].x-m[f-1].x,A=m[f].y-m[f-1].y,E=Math.hypot(I,A);C.segLen.push(E),C.cumLen.push(C.cumLen[C.cumLen.length-1]+E)}i=C}const{base:r,inherited:a}=$t(t,s.time),h=(r==null?void 0:r.beatLength)??500,c=a==null?void 0:a.beatLength;Ut(s,h,Kt(t.difficulty).SliderMultiplier,c);const u=(Math.max(1,s.slides)-1)%2===0;return Ft(i,u?1:0)}function ae(t){if(t.kind==="circle"){const s=t;return typeof s.stackedX=="number"&&typeof s.stackedY=="number"?{x:s.stackedX,y:s.stackedY}:{x:t.x,y:t.y}}if(t.kind==="spinner")return{x:Ot/2,y:Nt/2};const e=t;return typeof e.stackedX=="number"&&typeof e.stackedY=="number"?{x:e.stackedX,y:e.stackedY}:{x:t.x,y:t.y}}class Ge{constructor(){Mt(this,"cache",new Map);Mt(this,"maxSize",50);Mt(this,"accessCounter",0);Mt(this,"shapeUsageMap",new Map);Mt(this,"totalMemoryBytes",0);Mt(this,"memoryBudgetBytes");Mt(this,"stats",{hits:0,misses:0,totalRenders:0,cacheSize:0,lastFrameHits:0,lastFrameMisses:0,uniqueShapesInMap:0,get hitRate(){const e=this.hits+this.misses;return e>0?this.hits/e*100:0},get totalDrawCalls(){return this.hits+this.misses}});this.memoryBudgetBytes=this.calculateMemoryBudget()}getStats(){return this.stats.cacheSize=this.cache.size,{...this.stats}}resetFrameStats(){this.stats.lastFrameHits=0,this.stats.lastFrameMisses=0}getMaxSize(){return this.maxSize}getMemoryUsage(){return this.totalMemoryBytes}getMemoryBudget(){return this.memoryBudgetBytes}calculateMemoryBudget(){const e=navigator.hardwareConcurrency||4,s=navigator.deviceMemory||4;return e<=4||s<=4?30*1024*1024:e<=8||s<=8?50*1024*1024:80*1024*1024}resetStats(){this.stats.hits=0,this.stats.misses=0,this.stats.totalRenders=0}normalizePath(e){if(e.length<2)return e;const s=e[0],n=e.map(a=>({x:a.x-s.x,y:a.y-s.y}));let o=0;for(let a=1;a<n.length;a++){const h=n[a].x-n[a-1].x,c=n[a].y-n[a-1].y,d=Math.hypot(h,c);o+=d}if(o<1e-6)return n;const i=n[n.length-1],r=Math.atan2(i.y,i.x);if(Math.hypot(i.x,i.y)>.001){const a=Math.cos(-r),h=Math.sin(-r);return n.map(c=>({x:c.x*a-c.y*h,y:c.x*h+c.y*a}))}return n}generatePathSignature(e){if(e.length<2)return"empty";const s=this.normalizePath(e),n=Math.min(32,s.length),o=[];if(s.length<=n)for(const r of s)o.push(`${r.x.toFixed(3)},${r.y.toFixed(3)}`);else for(let r=0;r<n;r++){const a=Math.floor(r/(n-1)*(s.length-1)),h=s[a];o.push(`${h.x.toFixed(3)},${h.y.toFixed(3)}`)}let i=0;for(let r=1;r<s.length-1;r++){const a=s[r-1],h=s[r],c=s[r+1],d=h.x-a.x,u=h.y-a.y,m=c.x-h.x,C=c.y-h.y,f=Math.atan2(u,d),I=Math.atan2(C,m);i+=Math.abs(I-f)}return`${o.join("|")}-curv:${i.toFixed(2)}`}hashPath(e,s,n,o){if(e.length<2)return`empty-${s}-${Math.round(n)}-${Math.round(o)}`;const i=this.normalizePath(e),r=Math.min(14,i.length),a=[];if(i.length<=r)for(const I of i)a.push(`${I.x.toFixed(2)},${I.y.toFixed(2)}`);else for(let I=0;I<r;I++){const A=Math.floor(I/(r-1)*(i.length-1)),E=i[A];a.push(`${E.x.toFixed(2)},${E.y.toFixed(2)}`)}let h=0;for(let I=1;I<i.length;I++){const A=i[I].x-i[I-1].x,E=i[I].y-i[I-1].y;h+=Math.hypot(A,E)}let c=0;for(let I=1;I<i.length-1;I++){const A=i[I-1],E=i[I],M=i[I+1],S=E.x-A.x,p=E.y-A.y,B=M.x-E.x,j=M.y-E.y,v=Math.atan2(p,S),b=Math.atan2(j,B);c+=Math.abs(b-v)}const d=Math.round(n),u=Math.round(o),m=h.toFixed(1),C=c.toFixed(2);return`${a.join("|")}-len:${m}-curv:${C}-pts:${e.length}-${s}-${d}-${u}`}get(e,s,n,o){const i=this.hashPath(e,s,n,o),r=this.cache.get(i);if(r){r.lastUsed=++this.accessCounter,r.accessCount++;const a=this.shapeUsageMap.get(i);a&&a.accessCount++,this.stats.hits++,this.stats.lastFrameHits++;const h=this.normalizePath(e),c=e[0],d=e[e.length-1],u=h[h.length-1],m=Math.atan2(d.y-c.y,d.x-c.x),C=Math.atan2(u.y,u.x),f=m-C;return{entry:r,transform:{tx:c.x,ty:c.y,angle:f,scale:1}}}return this.stats.misses++,this.stats.lastFrameMisses++,null}shouldCache(e,s,n,o,i){if(o>2e3||i>2e3)return!1;let a=0;for(let h=1;h<e.length;h++){const c=e[h].x-e[h-1].x,d=e[h].y-e[h-1].y;a+=Math.hypot(c,d)}return!(a<20)}set(e,s,n,o,i){const r=this.hashPath(e,s,n,o),a=i.canvas.width*i.canvas.height*4;if(i.memoryBytes=a,i.pathSignature=this.generatePathSignature(e),i.accessCount=0,(this.cache.size>=this.maxSize||this.totalMemoryBytes+a>this.memoryBudgetBytes)&&!this.cache.has(r)){let d=!1;if(this.shapeUsageMap.size>0){const u=[];for(const[m,C]of this.shapeUsageMap.entries())C.lastUsageTime<Date.now()-5e3&&u.push(m);if(u.length>0)for(const m of u)this.cache.delete(m),this.shapeUsageMap.delete(m),d=!0}d||this.evictByMemory(a)}const c=this.cache.get(r);c&&(this.totalMemoryBytes-=c.memoryBytes),i.lastUsed=++this.accessCounter,this.cache.set(r,i),this.totalMemoryBytes+=a,this.stats.totalRenders++}evictByMemory(e){const s=e+this.memoryBudgetBytes*.1,n=[],o=Date.now();for(const[r,a]of this.cache.entries()){const h=this.shapeUsageMap.get(r),c=h?h.lastUsageTime<o:!1,d=a.accessCount,u=a.memoryBytes;let m=0;c&&(m+=1e3),m+=u/1e3,m-=d*10,m+=(this.accessCounter-a.lastUsed)/100,n.push({key:r,entry:a,score:m})}n.sort((r,a)=>a.score-r.score);let i=0;for(const r of n){if(i>=s)break;this.cache.delete(r.key),this.shapeUsageMap.delete(r.key),this.totalMemoryBytes-=r.entry.memoryBytes,i+=r.entry.memoryBytes}}clear(){this.cache.clear(),this.shapeUsageMap.clear(),this.totalMemoryBytes=0}clearAll(){this.cache.clear(),this.shapeUsageMap.clear(),this.totalMemoryBytes=0,this.memoryBudgetBytes=this.calculateMemoryBudget()}renderShapeToCanvas(e,s,n,o,i){if(e.length<2)return null;let r=1/0,a=1/0,h=-1/0,c=-1/0;for(const p of e)p.x<r&&(r=p.x),p.y<a&&(a=p.y),p.x>h&&(h=p.x),p.y>c&&(c=p.y);const d=Math.ceil(Math.max(s,n)/2)+2,u=Math.max(1,Math.ceil(h-r+d*2)),m=Math.max(1,Math.ceil(c-a+d*2));if(!this.shouldCache(e,s,n,u,m))return null;const C=document.createElement("canvas");C.width=u,C.height=m;const f=C.getContext("2d",{willReadFrequently:!1});f.save(),f.translate(-r+d,-a+d),f.lineCap="round",f.lineJoin="round",f.globalCompositeOperation="source-over",f.globalAlpha=1,f.lineWidth=s,f.beginPath(),f.moveTo(e[0].x,e[0].y);for(let p=1;p<e.length;p++)f.lineTo(e[p].x,e[p].y);f.strokeStyle=o,f.stroke();const I=this.rgbFromCss(i)||{r:255,g:255,b:255},A=`rgba(${I.r}, ${I.g}, ${I.b}, 1)`;f.lineWidth=n,f.beginPath(),f.moveTo(e[0].x,e[0].y);for(let p=1;p<e.length;p++)f.lineTo(e[p].x,e[p].y);f.strokeStyle=A,f.stroke();const E=be(),M=we[E];f.globalCompositeOperation="soft-light",f.globalCompositeOperation!=="soft-light"&&(f.globalCompositeOperation="screen");const S=M.highlightPasses;for(let p=0;p<S;p++){const B=p/(S-1),j=Math.max(1,n*(.96-.7*B)),v=.15*(1-B)*(1-B);f.lineWidth=j,f.beginPath(),f.moveTo(e[0].x,e[0].y);for(let b=1;b<e.length;b++)f.lineTo(e[b].x,e[b].y);f.strokeStyle=`rgba(255,255,255,${v.toFixed(3)})`,f.stroke()}if(M.edgePasses>0){f.globalCompositeOperation="multiply";const p=M.edgePasses;for(let B=0;B<p;B++){const j=B/(p-1),v=Math.max(1,n*(.98-.08*j)),b=.1-.03*j;f.lineWidth=v,f.beginPath(),f.moveTo(e[0].x,e[0].y);for(let P=1;P<e.length;P++)f.lineTo(e[P].x,e[P].y);f.strokeStyle=`rgba(0,0,0,${Math.max(0,b).toFixed(3)})`,f.stroke()}}return f.restore(),{canvas:C,minX:r,minY:a,pad:d}}rgbFromCss(e){const s=e.trim().match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(s){const o=s[1],i=o.length===3?o.split("").map(c=>c+c).join(""):o,r=parseInt(i.slice(0,2),16),a=parseInt(i.slice(2,4),16),h=parseInt(i.slice(4,6),16);return{r,g:a,b:h}}const n=e.trim().match(/^rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);return n?{r:Number(n[1]),g:Number(n[2]),b:Number(n[3])}:null}precalculateShapes(e,s,n,o,i=240,r="#ffffff"){if(this.shapeUsageMap.clear(),!e||!e.hitObjects)return;const a=o*2,h=Math.max(1,a-8),c=Math.max(1,a-14),d=xe(e),u=new Set,m=[];for(let B=0;B<e.hitObjects.length;B++){const j=e.hitObjects[B];if(j.kind!=="slider")continue;const v=j,b=ie(v.curveType,v.points),P=v.length;let H=b;if(P>0&&P<b.total){const V=re(b,P),tt={pts:V,segLen:[],cumLen:[0],total:P};for(let k=1;k<V.length;k++){const l=V[k].x-V[k-1].x,O=V[k].y-V[k-1].y,at=Math.hypot(l,O);tt.segLen.push(at),tt.cumLen.push(tt.cumLen[tt.cumLen.length-1]+at)}H=tt}const ot=d.colorIndex[B],Z=n[ot%n.length],nt=this.hashPath(H.pts,Z,h,c);u.add(nt);const{base:$,inherited:U}=$t(e,v.time),gt=($==null?void 0:$.beatLength)??500,y=U==null?void 0:U.beatLength,_=Ut(v,gt,s.SliderMultiplier,y),L=Math.max(1,v.slides),R=v.time+_*L+i,F=m.find(V=>V.cacheKey===nt);F?(R>F.lastUsageTime&&(F.lastUsageTime=R),F.sliderIndices.push(B)):m.push({cacheKey:nt,pts:H.pts,comboColor:Z,lastUsageTime:R,sliderIndices:[B]})}const C=u.size;this.stats.uniqueShapesInMap=C;const f=200*200*4,I=Math.floor(this.memoryBudgetBytes/f);this.maxSize=Math.min(Math.ceil(C*.8),I,200);const A=6200,E=m.filter(B=>{var v;return B.sliderIndices.length>1?!0:(((v=e.hitObjects[B.sliderIndices[0]])==null?void 0:v.time)||1/0)<=A});for(const B of m)this.shapeUsageMap.set(B.cacheKey,{cacheKey:B.cacheKey,lastUsageTime:B.lastUsageTime,sliderIndices:B.sliderIndices,accessCount:0,isPreRendered:!1});const M=15;let S=0;const p=()=>{const B=S*M,j=Math.min(B+M,E.length);for(let v=B;v<j;v++){const b=E[v],P=this.normalizePath(b.pts),H=this.renderShapeToCanvas(P,h,c,r,b.comboColor);if(H){const ot={canvas:H.canvas,normalizedWidth:H.canvas.width,normalizedHeight:H.canvas.height,pad:H.pad,normMinX:H.minX,normMinY:H.minY,lastUsed:0,accessCount:0,memoryBytes:H.canvas.width*H.canvas.height*4,pathSignature:this.generatePathSignature(b.pts)};this.set(b.pts,b.comboColor,h,c,ot);const Z=this.shapeUsageMap.get(b.cacheKey);Z&&(Z.isPreRendered=!0)}}S++,j<E.length&&(typeof requestIdleCallback<"u"?requestIdleCallback(p,{timeout:100}):setTimeout(p,0))};E.length>0&&(typeof requestIdleCallback<"u"?requestIdleCallback(p,{timeout:100}):setTimeout(p,0))}evictExpiredShapes(e){const s=[];for(const[n,o]of this.shapeUsageMap.entries())if(o.lastUsageTime<e){const i=this.cache.get(n);if(i){let r=0;r+=i.memoryBytes/1e3,r-=i.accessCount*10,r-=o.accessCount*5,r+=(this.accessCounter-i.lastUsed)/100,s.push({key:n,entry:i,info:o,score:r})}}s.sort((n,o)=>o.score-n.score);for(const n of s)this.cache.has(n.key)&&(this.cache.delete(n.key),this.totalMemoryBytes-=n.entry.memoryBytes),this.shapeUsageMap.delete(n.key);this.totalMemoryBytes>this.memoryBudgetBytes&&this.evictByMemory(0)}}const Et=new Ge;function Ve(){const t=navigator.hardwareConcurrency||4,e=navigator.deviceMemory||4;return t<=4||e<=4?"low":t<=8||e<=8?"medium":"high"}const we={high:{highlightPasses:16,edgePasses:3},medium:{highlightPasses:10,edgePasses:2},low:{highlightPasses:8,edgePasses:1}};let Qt=null;function be(){return Qt===null&&(Qt=Ve()),Qt}function Zt(t,e,s,n,o,i,r,a,h,c,d,u,m,C,f="core",I=1,A=240,E){if(s.kind==="circle"){if(f!=="core")return;const M=s.time-r,S=n<=s.time?St((n-M)/Math.max(1,a)):1,p=n<=s.time?1:St(1-(n-s.time)/400),B=St(S*p);if(B<=.001)return;const j=typeof s.stackedX=="number"&&typeof s.stackedY=="number"?{x:s.stackedX,y:s.stackedY}:qt(s.x,s.y,m);if(o!=null&&o.approachcircle){const b=1+2*St((s.time-n)/Math.max(1,r));le(t,j.x,j.y,i*b,.8*B,o,d)}o!=null&&o.hitcircle?(t.save(),Ht(t,j.x,j.y,i,o,B,d),o!=null&&o.digits&&he(t,j.x,j.y,i,o,u,B),t.restore()):(t.save(),t.globalAlpha=B,Wt(t,j.x,j.y,i,d),t.restore())}else if(s.kind==="slider"){const M=ie(s.curveType,s.points);let S,p,B,j,v;if(E)S=E.base,p=E.inherited,B=E.baseBeat,j=E.ih,v=E.span??Ut(s,B,h,j);else{const k=$t(e,s.time);S=k.base,p=k.inherited,B=(S==null?void 0:S.beatLength)??500,j=p==null?void 0:p.beatLength,v=Ut(s,B,h,j)}const b=Math.max(1,s.slides),P=s.time+v*b,H=s.time-r,ot=Math.max(1,Math.floor(r*.4)),Z=Math.max(1,A);let nt=0;n<H?nt=0:n<s.time?nt=St((n-H)/ot):n<=P?nt=1:nt=St(1-(n-P)/Z);const $=s.length;let U=M;if($>0&&$<M.total){const k=re(M,$),l={pts:k,segLen:[],cumLen:[0],total:$};for(let O=1;O<k.length;O++){const at=k[O].x-k[O-1].x,K=k[O].y-k[O-1].y,ht=Math.hypot(at,K);l.segLen.push(ht),l.cumLen.push(l.cumLen[l.cumLen.length-1]+ht)}U=l}const gt=U.pts,y=!!C&&Xe(C.x,C.y,U)<=Math.max(6,i*.35),_=typeof s.stackedX=="number"&&typeof s.stackedY=="number"?{x:s.stackedX,y:s.stackedY}:qt(s.x,s.y,m),L={x:_.x-s.x,y:_.y-s.y},G=gt.map(k=>({x:k.x+L.x,y:k.y+L.y})),R=i*2,F=Math.max(1,R-8),V=Math.max(1,R-14),tt=(o==null?void 0:o.sliderBorder)||"#ffffff";if(f==="body"){if(nt<=.01)return;ze(t,G,F,V,tt,d,nt,1);return}if(f==="core"){const k=s.time+v*b,l=k-r,O=n<=k?St((n-l)/Math.max(1,a)):1,at=n<=k?1:St(1-(n-k)/400),K=St(O*at)*nt,ht=(b-1)%2===0,pt=Ft(U,ht?1:0),it={x:pt.x+L.x,y:pt.y+L.y};if(K>.001&&(o!=null&&o.hitcircle?Ht(t,it.x,it.y,i,o,K,d):(t.save(),t.globalAlpha=K,Wt(t,it.x,it.y,i,d),t.restore()),o!=null&&o.sliderendcircle)){const st=i*2/(o.sliderendcircle.width||128),q=o.sliderendcircle.width*st,rt=o.sliderendcircle.height*st;t.save(),t.globalAlpha=K,t.translate(it.x,it.y),t.drawImage(o.sliderendcircle,-q/2,-rt/2,q,rt),t.restore()}if(b>1)for(let st=0;st<b-1;st++){const rt=st%2===0?1:0,W=Ft(U,rt),Q={x:W.x+L.x,y:W.y+L.y},yt=s.time+v*(st+1),bt=yt-r,Pt=n<=yt?St((n-bt)/Math.max(1,a)):1,w=n<=yt?1:St(1-(n-yt)/400),T=St(Pt*w);if(T>0&&(o!=null&&o.hitcircle?Ht(t,Q.x,Q.y,i,o,T,d):(t.save(),t.globalAlpha=T,Wt(t,Q.x,Q.y,i,d),t.restore()),o!=null&&o.sliderendcircle)){const D=i*2/(o.sliderendcircle.width||128),X=o.sliderendcircle.width*D,Y=o.sliderendcircle.height*D;t.save(),t.globalAlpha=T,t.translate(Q.x,Q.y),t.drawImage(o.sliderendcircle,-X/2,-Y/2,X,Y),t.restore()}}const et=_,mt=s.time-r,vt=n<=s.time?St((n-mt)/Math.max(1,a)):1,xt=n<=s.time?1:St(1-(n-s.time)/400),wt=St(vt*xt)*nt;if(wt>.001)if(o!=null&&o.hitcircle){if(t.save(),Ht(t,et.x,et.y,i,o,wt,d),o.sliderstartcircle){const st=o.sliderstartcircle,q=i*2/(st.width||128),rt=st.width*q,W=st.height*q;t.drawImage(st,et.x-rt/2,et.y-W/2,rt,W)}o!=null&&o.digits&&he(t,et.x,et.y,i,o,u,wt),t.restore()}else t.save(),t.globalAlpha=wt,Wt(t,et.x,et.y,i,d),t.restore();if(o!=null&&o.approachcircle&&wt>.001){const q=1+2*St((s.time-n)/Math.max(1,r));le(t,et.x,et.y,i*q,.8*wt,o,d)}}if(f==="top"&&n>=s.time&&n<=P){const k=n-s.time,l=Math.floor(k/v),O=k%v/v,K=l%2===0?O:1-O,ht=Ft(U,K),pt={x:ht.x+L.x,y:ht.y+L.y};o!=null&&o.sliderfollowcircle&&nt>.001&&Ue(t,pt.x,pt.y,i*1.6,o,nt);const it=Math.max(4,Math.max(1,R-6)),et=St(nt);if(et<=.001)return;const mt=.1/Math.max(1,U.total),vt=Math.max(0,Math.min(1-mt,K)),xt=Math.min(1,K+mt),ut=Ft(U,vt),wt=Ft(U,xt),st=ut.x-wt.x,q=ut.y-wt.y,W=(-90+-Math.atan2(st,q)*180/Math.PI)*Math.PI/180,Q=o==null?void 0:o.sliderballFrames,yt=Q&&Q.length>0,bt=!!(o!=null&&o.sliderb),Pt=U.total/(v*b),w=Math.max(.15/Pt*(1e3/60),1e3/60),T=yt?Math.floor(k/w)%Q.length:0,D=d;if(o!=null&&o.sliderbnd&&Xt(t,o.sliderbnd,pt.x,pt.y,it,0,"#000000",et,!1),yt){const X=Q[T];Xt(t,X,pt.x,pt.y,it,W,D,et,!1)}else bt?Xt(t,o.sliderb,pt.x,pt.y,it,W,D,et,!1):_e(t,pt.x,pt.y,it/2,d,et);o!=null&&o.sliderbspec&&Xt(t,o.sliderbspec,pt.x,pt.y,it,0,"#ffffff",et,!0)}if(f==="top"&&(o!=null&&o.reversearrow)&&b>1){let k=-1;for(let l=0;l<b-1;l++){const O=s.time+v*(l+1);if(n<O){k=l;break}}for(let l=0;l<b-1;l++){if(k===-1)continue;let O=!1;if((l===k||k>0&&l===k-1)&&(O=!0),!O)continue;const at=l%2===0,ht=Ft(U,at?1:0),pt={x:ht.x+L.x,y:ht.y+L.y},it=Be(U,at?1-.001:.001)+(at?Math.PI:0),et=s.time+v*(l+1),mt=et-r,vt=300,xt=150,ut=((Math.min(n,et)-mt)%vt+vt)%vt;let wt=0,st=1;if(n>et){const q=1.3-Dt(ut/vt)*.3,rt=1.4-q,W=Math.min(300,v),Q=St((n-et)/W);st=q+Dt(Q)*rt,wt=Dt(1-Q)}else if(n>=mt){wt=St((n-mt)/xt);const q=35,rt=250;if(ut<q)st=1+Dt(ut/q)*.3;else{const W=(ut-q)/(q+rt);st=1.3-Dt(W)*.3}}if(wt*=nt,wt>.01){t.save(),t.globalAlpha=wt,t.translate(pt.x,pt.y),t.rotate(it),t.scale(st,st);const q=i*2*.72/(o.reversearrow.width||128),rt=o.reversearrow.width*q,W=o.reversearrow.height*q;t.drawImage(o.reversearrow,-rt/2,-W/2,rt,W),t.restore()}}}if(f==="top"&&(o!=null&&o.sliderscorepoint)){const l={x:s.x+L.x,y:s.y+L.y},O=(b-1)%2===0,at=Ft(U,O?1:0),K={x:at.x+L.x,y:at.y+L.y};for(let ht=0;ht<b;ht++){const pt=ht%2===1,it=He(s,B,h,j,c);for(const et of it){const mt=pt?1-et:et,vt=Ft(U,mt),xt={x:vt.x+L.x,y:vt.y+L.y},ut=s.time+v*ht+v*et,wt=Math.hypot(xt.x-l.x,xt.y-l.y),st=Math.hypot(xt.x-K.x,xt.y-K.y);if(wt<i||st<i)continue;const q=ut-r;let rt=0;if(n<ut?rt=St((n-q)/Math.max(1,a)):rt=St(1-(n-ut)/200),rt*=nt,rt<=.001)continue;const W=i*.15;t.save(),t.globalAlpha=rt,t.translate(xt.x,xt.y);const Q=o.sliderscorepoint,yt=W*2/(Q.width||64);t.drawImage(Q,-Q.width*yt/2,-Q.height*yt/2,Q.width*yt,Q.height*yt),t.restore()}}}if(f==="top"&&y&&s.points.length>0){t.save(),t.globalAlpha=nt,t.strokeStyle="#efefef",t.lineWidth=1,t.beginPath();const k=s.points[0];t.moveTo(k.x+L.x,k.y+L.y);for(let O=1;O<s.points.length;O++){const at=s.points[O];t.lineTo(at.x+L.x,at.y+L.y)}t.stroke();const l=O=>{if(O===0)return!1;if(s.curveType!=="B")return O>0;const at=s.points[O-1],K=s.points[O];return at.x===K.x&&at.y===K.y};for(let O=0;O<s.points.length;O++){const at=s.points[O],K=at.x+L.x,ht=at.y+L.y;O===0?t.fillStyle="#efefef":l(O)?t.fillStyle="#ff0000":s.curveType==="B"?t.fillStyle="#efefef":t.fillStyle="#ff0000",t.beginPath(),t.arc(K,ht,2,0,Math.PI*2),t.fill()}t.restore()}}else if(s.kind==="spinner"){if(f!=="core")return;const M=Ot/2,S=Nt/2,p=s.time-r,B=800,j=s.endTime;if(n<p||n>j+B)return;let v=1;if(n<s.time?v=St((n-p)/Math.max(1,a)):n>=s.time&&(v=1-St((n-j)/B)),v<=.001)return;const b=15;if(o!=null&&o.spinnerBottom){const P=o.spinnerBottom,H=b*2/(P.width||128),ot=P.width*H,Z=P.height*H;t.save(),t.globalAlpha=v,t.translate(M,S),t.drawImage(P,-ot/2,-Z/2,ot,Z),t.restore()}else t.save(),t.globalAlpha=v,t.beginPath(),t.arc(M,S,b,0,Math.PI*2),t.strokeStyle="#f9d66b",t.lineWidth=3,t.stroke(),t.restore();if(o!=null&&o.spinnerApproachcircle){const P=o.spinnerApproachcircle,ot=Nt*.9/2,Z=b,nt=50,$=j-s.time;let U=0,gt=ot;if(n>=p&&n<j+nt){if(n<s.time){const y=Math.min(a,r);U=Math.min(1,Math.max(0,(n-p)/Math.max(1,y))),gt=ot}else if(n>=s.time){const y=St((n-s.time)/Math.max(1,$));U=(1-St((n-j)/nt))*.9,gt=ot-(ot-Z)*y}if(U>.001){const y=gt*2/(P.width||128),_=P.width*y,L=P.height*y;t.save(),t.globalAlpha=U,t.translate(M,S),t.drawImage(P,-_/2,-L/2,_,L),t.restore()}}}}}function qe(t,e,s,n,o,i,r,a){const h=r.followpoint,c=32;for(let d=0;d<s.length-1;d++){const u=s[d].obj,m=s[d+1].obj,C=s[d].idx,f=s[d+1].idx,I=oe(e,u);if(m.time-I<=0||m.newCombo)continue;const E=ve(e,u),M=ae(m),S=qt(E.x,E.y,a[C]||0),p=qt(M.x,M.y,a[f]||0),B=p.x-S.x,j=p.y-S.y,v=Math.hypot(B,j);if(v<80)continue;const b=Math.floor((v-48)/c);if(b<=0)continue;const P=u.kind==="slider"?oe(e,u):u.time,ot=m.time-P;if(ot<=0)continue;const Z=Math.atan2(j,B),$=Math.max(4,i*.15)*2/(h.width||64),U=Math.max(1,Math.floor(o*.4));t.save(),t.globalCompositeOperation="source-over",t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";for(let gt=0;gt<b;gt++){const _=c*(1.5+gt)/v;if(_>=1)continue;const L=P+_*ot,G=L-o;let R=0;if(n<G)R=0;else if(n<G+U){const tt=(n-G)/U;R=Dt(St(tt))}else if(n<L)R=1;else{const tt=(n-L)/U;R=1-Dt(St(tt))}if(R<=0)continue;const F=S.x+B*_,V=S.y+j*_;t.save(),t.globalAlpha=.9*R,t.translate(F,V),t.rotate(Z),t.drawImage(h,-(h.width*$)/2,-(h.height*$)/2,h.width*$,h.height*$),t.restore()}t.restore()}}function Me(t,e,s){const r=x.useRef(null),a=x.useRef(null),h=x.useRef(0);x.useEffect(()=>{const c=t.current;if(!c)return;const d=()=>{const C=c.getBoundingClientRect(),f=Math.floor(C.width),I=Math.floor(C.height);r.current&&r.current.width===f&&r.current.height===I||(r.current={width:f,height:I},a.current!==null&&clearTimeout(a.current),a.current=window.setTimeout(()=>{const A=performance.now();A-h.current>=100&&(h.current=A,e())},100))},u=window.ResizeObserver;let m=null;return u?(m=new u(d),m.observe(c)):window.addEventListener("resize",d),d(),()=>{m?m.disconnect():window.removeEventListener("resize",d),a.current!==null&&clearTimeout(a.current)}},[t,e,100,100])}const de=({beatmap:t,timeSec:e,backgroundUrl:s,skin:n,sliderBodyCutoffPx:o=1,sliderFadeOutMs:i=240})=>{const r=x.useRef(null),a=x.useRef(null),[h,c]=kt.useState(0),[d,u]=kt.useState(0),[m,C]=kt.useState(null),[f,I]=kt.useState(Et.getStats()),A=x.useRef(0),[E,M]=kt.useState(0),S=x.useRef({lastTime:performance.now(),frameCount:0,fps:0}),[p,B]=kt.useState(!0),j=x.useRef(null),[v,b]=kt.useState(!1),P=x.useMemo(()=>Kt(t==null?void 0:t.difficulty),[t]);x.useEffect(()=>{if(j.current){const y=j.current.parentElement,_=!!(y!=null&&y.classList.contains("playfield-container")&&!y.closest(".embed-preview-playfield")&&!y.closest(".embed-preview-body"));b(_)}},[]);const H=x.useMemo(()=>ge(P.CS),[P.CS]),ot=x.useMemo(()=>ye(P.AR),[P.AR]),Z=x.useMemo(()=>Ne(P.AR),[P.AR]),nt=x.useMemo(()=>{var L;const y=(L=t==null?void 0:t.colors)==null?void 0:L.comboColors;if(y&&y.length)return y;const _=n==null?void 0:n.comboColors;return _&&_.length?_:["#FF66AA","#99CCFF","#99FF99","#FFFF66"]},[t==null?void 0:t.colors,n==null?void 0:n.comboColors]),$=x.useMemo(()=>xe(t),[t]),U=x.useMemo(()=>Ye(t),[t]);x.useEffect(()=>{if(!s){a.current=null;return}const y=new Image;return y.onload=()=>{a.current=y,c(_=>_+1)},y.onerror=()=>{a.current=null,c(_=>_+1)},y.src=s,a.current=y,()=>{y.onload=null,y.onerror=null}},[s]);const gt=x.useCallback(()=>{u(y=>y+1)},[]);return Me(r,gt),x.useEffect(()=>{const y=r.current;if(!y)return;Et.evictExpiredShapes(e*1e3);const _=window.devicePixelRatio||1,L=y.getBoundingClientRect(),G=Math.max(100,L.width),R=Math.max(100,L.height);y.width=Math.round(G*_),y.height=Math.round(R*_);const F=y.getContext("2d",{willReadFrequently:!1});F.setTransform(_,0,0,_,0,0),F.globalCompositeOperation="source-over",F.clearRect(0,0,G,R),F.fillStyle="#02060d",F.fillRect(0,0,G,R);const V=a.current;if(V&&V.complete){const K=Math.max(G/V.width,R/V.height),ht=V.width*K,pt=V.height*K;F.globalAlpha=.2,F.drawImage(V,(G-ht)/2,(R-pt)/2,ht,pt),F.globalAlpha=1}const tt=16,k=Math.min((G-tt*2)/Ot,(R-tt*2)/Nt),l=(G-Ot*k)/2,O=(R-Nt*k)/2;if(F.save(),F.translate(l,O),F.scale(k,k),F.strokeStyle="#2a3955",F.lineWidth=2/k,F.strokeRect(0,0,Ot,Nt),t){const K=e*1e3,ht=1200,pt=2e3,it=t.hitObjects,et=K-ht,mt=K+pt,vt=et-1e4;let xt=0,ut=it.length;for(;xt<ut;){const W=xt+ut>>>1;it[W].time<vt?xt=W+1:ut=W}const wt=xt;for(xt=0,ut=it.length;xt<ut;){const W=xt+ut>>>1;it[W].time<=mt?xt=W+1:ut=W}const st=xt,q=[];for(let W=wt;W<st;W++){const Q=it[W],yt=Q.time;let bt=yt+600,Pt;if(Q.kind==="spinner")bt=Q.endTime;else if(Q.kind==="slider"){const{base:w,inherited:T}=$t(t,Q.time),D=(w==null?void 0:w.beatLength)??500,X=T==null?void 0:T.beatLength,Y=Ut(Q,D,P.SliderMultiplier,X);bt=Q.time+Y*Math.max(1,Q.slides),Pt={base:w,inherited:T,baseBeat:D,ih:X,span:Y}}bt>=et&&yt<=mt&&q.push({o:Q,idx:W,startTime:yt,endTime:bt,timing:Pt})}q.sort((W,Q)=>W.startTime!==Q.startTime?W.startTime-Q.startTime:W.idx-Q.idx);const rt=q.map(W=>({obj:W.o,idx:W.idx}));n!=null&&n.followpoint&&qe(F,t,rt,K,ot,H,n,U);for(let W=q.length-1;W>=0;W--){const{o:Q,idx:yt,timing:bt}=q[W],Pt=nt[$.colorIndex[yt]%nt.length],w=$.number[yt],T=U[yt];Q.kind==="slider"&&Zt(F,t,Q,K,n,H,ot,Z,P.SliderMultiplier,P.SliderTickRate,Pt,w,T,m,"body",o,i,bt),Zt(F,t,Q,K,n,H,ot,Z,P.SliderMultiplier,P.SliderTickRate,Pt,w,T,m,"core",o,i,bt),Q.kind==="slider"&&Zt(F,t,Q,K,n,H,ot,Z,P.SliderMultiplier,P.SliderTickRate,Pt,0,T,m,"top",o,i,bt)}}if(F.restore(),A.current++,A.current%10===0){const K=Et.getStats();I(K),Et.resetFrameStats()}const at=performance.now();S.current.frameCount++,at-S.current.lastTime>=1e3&&(S.current.fps=S.current.frameCount,S.current.frameCount=0,S.current.lastTime=at,M(S.current.fps))},[t,e,s,h,H,ot,Z,n,P.SliderMultiplier,P.SliderTickRate,o,i,d,m]),x.useEffect(()=>{const y=r.current;if(!y)return;const _=G=>{const R=y.getBoundingClientRect(),F=16,V=Math.min((R.width-F*2)/Ot,(R.height-F*2)/Nt),tt=(R.width-Ot*V)/2,k=(R.height-Nt*V)/2,l=(G.clientX-R.left-tt)/V,O=(G.clientY-R.top-k)/V;l>=0&&l<=Ot&&O>=0&&O<=Nt?C({x:l,y:O}):C(null)},L=()=>{C(null)};return y.addEventListener("mousemove",_),y.addEventListener("mouseleave",L),()=>{y.removeEventListener("mousemove",_),y.removeEventListener("mouseleave",L);const G=y.getContext("2d");G&&G.clearRect(0,0,y.width,y.height)}},[]),g.jsxs("div",{ref:j,style:{position:"relative",width:"100%",height:"100%"},children:[g.jsx("canvas",{ref:r,className:"playfield",style:{width:"100%",height:"100%",display:"block"}}),v&&g.jsxs("div",{style:{position:"absolute",top:"8px",right:"8px",background:"#0d111e",color:"#cdd6f4",borderRadius:"4px",fontFamily:"monospace",fontSize:"11px",lineHeight:"1.4",minWidth:"220px",zIndex:1e3,border:"1px solid rgba(255, 255, 255, 0.1)",overflow:"hidden"},children:[g.jsxs("div",{style:{padding:"8px 12px",cursor:"pointer",userSelect:"none",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:p?"1px solid rgba(255,255,255,0.1)":"none"},onClick:()=>B(!p),children:[g.jsx("span",{style:{fontWeight:600,color:"#cdd6f4",textTransform:"lowercase"},children:"performance"}),g.jsx("span",{style:{color:"#89b4fa",fontSize:"10px"},children:p?"▼":"▶"})]}),p&&g.jsxs("div",{style:{padding:"12px"},children:[g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",paddingBottom:"4px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"fps:"}),g.jsx("span",{style:{color:"#89b4fa",fontWeight:600,background:"#141b2e",padding:"2px 8px",borderRadius:"4px"},children:E})]}),g.jsx("div",{style:{fontWeight:600,marginBottom:"4px",fontSize:"10px",color:"#89b4fa",textTransform:"lowercase"},children:"slider cache (cumulative)"}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"total draw calls:"}),g.jsx("span",{style:{color:"#89b4fa"},children:f.totalDrawCalls.toLocaleString()})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"cache hits:"}),g.jsx("span",{style:{color:"#89b4fa"},children:f.hits.toLocaleString()})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"cache misses:"}),g.jsx("span",{style:{color:"#89b4fa"},children:f.misses.toLocaleString()})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"hit rate:"}),g.jsxs("span",{style:{color:"#89b4fa",background:"#141b2e",padding:"2px 8px",borderRadius:"4px"},children:[f.hitRate.toFixed(1),"%"]})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",paddingBottom:"4px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"unique shapes:"}),g.jsxs("span",{style:{color:"#89b4fa"},children:[f.uniqueShapesInMap||f.totalRenders," (cached: ",f.cacheSize,")"]})]}),g.jsx("div",{style:{fontWeight:600,marginBottom:"4px",fontSize:"10px",color:"#89b4fa",textTransform:"lowercase"},children:"per frame (last 10)"}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"draw calls/frame:"}),g.jsx("span",{style:{color:"#89b4fa"},children:(f.lastFrameHits+f.lastFrameMisses).toLocaleString()})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"hits/frame:"}),g.jsx("span",{style:{color:"#89b4fa"},children:f.lastFrameHits.toLocaleString()})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[g.jsx("span",{style:{color:"#cdd6f4",textTransform:"lowercase"},children:"misses/frame:"}),g.jsx("span",{style:{color:"#89b4fa"},children:f.lastFrameMisses.toLocaleString()})]})]})]})]})},ue=({isPlaying:t,onPlayPause:e,currentTime:s,duration:n,onSeek:o,onScrubStart:i,onScrubEnd:r,bpm:a,sliderVelocity:h,timingPoints:c})=>{const d=x.useRef(null),u=x.useRef(null),[m,C]=x.useState(!1),f=x.useRef(null),I=x.useRef(!1),A=j=>{const v=Math.max(0,Math.floor(j*1e3)),b=Math.floor(v/6e4)%100,P=Math.floor(v%6e4/1e3)%60,H=Math.floor(v%1e3);return`${String(b).padStart(2,"0")}:${String(P).padStart(2,"0")}.${String(H).padStart(3,"0")}`},E=x.useCallback(j=>{if(!d.current)return 0;const v=d.current.getBoundingClientRect(),b=j-v.left;return Math.max(0,Math.min(1,b/v.width))*n},[n]),M=j=>{C(!0),i==null||i();const v=E(j.clientX);o(v)},S=j=>{if(j.preventDefault(),j.touches.length===0)return;C(!0),i==null||i();const v=E(j.touches[0].clientX);o(v)},p=j=>{if(j.preventDefault(),!Number.isFinite(n)||n<=0)return;I.current||(I.current=!0,i==null||i()),f.current!==null&&clearTimeout(f.current);const v=j.shiftKey?1:.1,b=j.deltaY>0?1:-1,P=Math.max(0,Math.min(n,s+b*v));o(P),f.current=window.setTimeout(()=>{I.current=!1,r==null||r(),f.current=null},150)};x.useEffect(()=>()=>{f.current!==null&&clearTimeout(f.current)},[]),x.useEffect(()=>{if(!m)return;const j=H=>{const ot=E(H.clientX);o(ot)},v=H=>{if(H.preventDefault(),H.touches.length===0)return;const ot=E(H.touches[0].clientX);o(ot)},b=()=>{C(!1),r==null||r()},P=H=>{H.preventDefault(),C(!1),r==null||r()};return window.addEventListener("mousemove",j),window.addEventListener("mouseup",b),window.addEventListener("touchmove",v,{passive:!1}),window.addEventListener("touchend",P),window.addEventListener("touchcancel",P),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",b),window.removeEventListener("touchmove",v),window.removeEventListener("touchend",P),window.removeEventListener("touchcancel",P)}},[m,n,o,r,E]);const B=n>0?Math.max(0,Math.min(1,s/n)):0;return x.useEffect(()=>{const j=d.current,v=u.current;if(!j||!v)return;const b=j.getBoundingClientRect(),P=Math.max(1,Math.floor(b.width)),H=Math.max(1,Math.floor(b.height)),ot=window.devicePixelRatio||1;(v.width!==Math.round(P*ot)||v.height!==Math.round(H*ot))&&(v.width=Math.round(P*ot),v.height=Math.round(H*ot));const Z=v.getContext("2d");Z.setTransform(ot,0,0,ot,0,0),Z.clearRect(0,0,P,H);const nt=Array.isArray(c)?c:[];for(let U=0;U<nt.length;U++){const gt=nt[U],y=nt[U+1];if(typeof gt.effects=="number"&&(gt.effects&1)===1){const L=Math.max(0,gt.time/1e3),G=Math.min(n,(y?y.time:n*1e3)/1e3);if(G>L){const R=Math.floor(L/n*P),F=Math.ceil(G/n*P);Z.fillStyle="rgba(245, 158, 11, 0.4)";const V=Math.max(1,Math.round(H/1.6)),tt=Math.round((H-V)/2);Z.fillRect(R,tt,Math.max(1,F-R),V)}}}const $=(U,gt,y)=>{const _=Math.max(0,U.time/1e3),L=Math.floor(_/(n||1)*P),G=Math.max(1,Math.round(y)),R=G/2,F=H-G/2;Z.save(),Z.strokeStyle=gt,Z.lineWidth=G,Z.lineCap="round",Z.beginPath(),Z.moveTo(L+.5,R),Z.lineTo(L+.5,F),Z.stroke(),Z.restore()};for(const U of nt)(typeof U.uninherited=="number"?U.uninherited===1:(U.beatLength||0)>0)||$(U,"#22c55e",2);for(const U of nt)(typeof U.uninherited=="number"?U.uninherited===1:(U.beatLength||0)>0)&&$(U,"#ef4444",3)},[c,n]),g.jsxs("div",{className:"editor-controls-container",children:[g.jsxs("div",{className:"controls-timestamp",children:[g.jsx("div",{className:"timestamp-display",children:A(s)}),g.jsxs("div",{className:"timing-info",children:[g.jsxs("span",{className:"bpm-display",children:[a.toFixed(0),"BPM"]}),g.jsx("span",{className:"sv-display",children:n>0?`${Math.round(s/n*100)}%`:"0%"})]})]}),g.jsxs("div",{className:"controls-center",children:[g.jsx("button",{className:"controls-play-button",onClick:e,title:t?"Pause (Space)":"Play (Space)",children:t?g.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[g.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),g.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}):g.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M8 5v14l11-7z"})})}),g.jsx("div",{className:"controls-progress-wrapper",ref:d,onMouseDown:M,onTouchStart:S,onWheel:p,children:g.jsxs("div",{className:"progress-bar-track",children:[g.jsx("canvas",{ref:u,className:"progress-markers"}),g.jsx("div",{className:"progress-bar-fill",style:{width:`${B*100}%`}}),g.jsx("div",{className:"progress-bar-thumb",style:{left:`${B*100}%`}})]})})]})]})},fe=({masterVolume:t,songVolume:e,hitsoundVolume:s,onMasterVolumeChange:n,onSongVolumeChange:o,onHitsoundVolumeChange:i})=>{const[r,a]=x.useState(!1),h=x.useRef(null),c=x.useRef(null);x.useEffect(()=>{if(!r)return;const u=m=>{h.current&&!h.current.contains(m.target)&&c.current&&!c.current.contains(m.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[r]);const d=u=>`${Math.round(u*100)}%`;return g.jsxs("div",{className:"volume-control-wrapper",children:[g.jsx("button",{ref:c,className:"volume-control-button",onClick:u=>{u.stopPropagation(),a(!r)},"aria-label":"Volume controls","aria-expanded":r,children:t>0?g.jsx(Re,{size:20}):g.jsx(Ie,{size:20})}),r&&g.jsxs("div",{ref:h,className:"volume-control-menu",children:[g.jsxs("div",{className:"volume-control-item",children:[g.jsx("label",{className:"volume-label",children:"Master"}),g.jsxs("div",{className:"volume-slider-container",children:[g.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t,onChange:u=>n(parseFloat(u.target.value)),className:"volume-slider"}),g.jsx("span",{className:"volume-value",children:d(t)})]})]}),g.jsxs("div",{className:"volume-control-item",children:[g.jsx("label",{className:"volume-label",children:"Song"}),g.jsxs("div",{className:"volume-slider-container",children:[g.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:e,onChange:u=>o(parseFloat(u.target.value)),className:"volume-slider"}),g.jsx("span",{className:"volume-value",children:d(e)})]})]}),g.jsxs("div",{className:"volume-control-item",children:[g.jsx("label",{className:"volume-label",children:"Hitsounds"}),g.jsxs("div",{className:"volume-slider-container",children:[g.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s,onChange:u=>i(parseFloat(u.target.value)),className:"volume-slider"}),g.jsx("span",{className:"volume-value",children:d(s)})]})]})]})]})};async function me(t){const e=await Ee.loadAsync(t instanceof File?t:new Blob([t])),s=Object.keys(e.files);async function n(r){const a=e.file(r);if(!a)throw new Error(`Not found: ${r}`);return a.async("text")}async function o(r){const a=e.file(r);if(!a)throw new Error(`Not found: ${r}`);return a.async("arraybuffer")}function i(r){return s.find(r)}return{list:s,readText:n,readArrayBuffer:o,findFirst:i}}function Yt(t){const e=t.indexOf(":");if(e===-1)return null;const s=t.slice(0,e).trim(),n=t.slice(e+1).trim();return[s,n]}function te(t){const e=t.split(/\r?\n/);let s="";const n={},o={},i={},r=[],a=[],h={comboColors:[]};let c="osu file format v?";for(let E=0;E<e.length;E++){const S=e[E].trim();if(S){if(E===0&&/^osu file format/.test(S)){c=S;continue}if(S.startsWith("[")&&S.endsWith("]")){s=S.slice(1,-1);continue}if(!S.startsWith("//"))switch(s){case"General":{const p=Yt(S);p&&(n[p[0]]=p[1]);break}case"Metadata":{const p=Yt(S);p&&(o[p[0]]=p[1]);break}case"Difficulty":{const p=Yt(S);if(!p)break;const B=Number(p[1]);i[p[0]]=Number.isFinite(B)?B:p[1];break}case"TimingPoints":{const p=S.split(",").map(j=>j.trim()),B={time:Number(p[0]||0),beatLength:Number(p[1]||0),meter:Number(p[2]||4),sampleSet:p[3]?Number(p[3]):void 0,sampleIndex:p[4]?Number(p[4]):void 0,volume:p[5]?Number(p[5]):void 0,uninherited:p[6]?Number(p[6]):void 0,effects:p[7]?Number(p[7]):void 0};r.push(B);break}case"Colours":{const p=Yt(S);if(!p)break;const[B,j]=p,v=b=>{const P=b.split(",").map($=>$.trim());if(P.length<3)return null;const H=Math.max(0,Math.min(255,Number(P[0]||0))),ot=Math.max(0,Math.min(255,Number(P[1]||0))),Z=Math.max(0,Math.min(255,Number(P[2]||0))),nt=$=>$.toString(16).padStart(2,"0");return`#${nt(H)}${nt(ot)}${nt(Z)}`};if(/^Combo\d+$/i.test(B)){const b=v(j);b&&h.comboColors.push(b)}else if(/^SliderBorder$/i.test(B)){const b=v(j);b&&(h.sliderBorder=b)}else if(/^SliderTrackOverride$/i.test(B)){const b=v(j);b&&(h.sliderTrackOverride=b)}break}case"HitObjects":{const p=S.split(","),B=Number(p[0]),j=Number(p[1]),v=Number(p[2]),b=Number(p[3]),P=Number(p[4]||0),H=nt=>{if(!nt||!nt.includes(":"))return;const $=nt.split(":"),U=$[0]!==""?Number($[0]):void 0,gt=$[1]!==""?Number($[1]):void 0,y=$[2]!==""?Number($[2]):void 0,_=$[3]!==""?Number($[3]):void 0,L=$[4]&&$[4]!==""?$[4]:void 0;return{sampleSet:U,additionSet:gt,customIndex:y,sampleVolume:_,filename:L}},ot=(b&4)===4,Z=(b&112)>>4;if((b&1)===1){const nt=H(p[5]);a.push({kind:"circle",x:B,y:j,time:v,hitSound:P,hitSample:nt,newCombo:ot,comboSkip:Z})}else if((b&2)===2){const nt=String(p[5]||""),[$,...U]=nt.split("|"),gt=($||"B").slice(0,1).toUpperCase(),y=Number(p[6]||1),_=Number(p[7]||0),L=[{x:B,y:j}];for(const tt of U){const[k,l]=tt.split(":");k&&l&&L.push({x:Number(k),y:Number(l)})}let G;p[8]&&(G=String(p[8]).split("|").map(tt=>Number(tt||0)));let R;p[9]&&(R=String(p[9]).split("|").map(tt=>{const[k,l]=tt.split(":"),O=k&&k!==""?Number(k):void 0,at=l&&l!==""?Number(l):void 0;return{sampleSet:O,additionSet:at}}));const F=p[p.length-1],V=H(F);a.push({kind:"slider",x:B,y:j,time:v,hitSound:P,curveType:gt,points:L,slides:y,length:_,edgeSounds:G,edgeSets:R,hitSample:V,newCombo:ot,comboSkip:Z})}else if((b&8)===8){const nt=Number(p[5]||v),$=H(p[6]);a.push({kind:"spinner",time:v,endTime:nt,hitSample:$,newCombo:ot,comboSkip:Z})}break}}}}const d=Number(n.Mode||"0"),m=["standard","taiko","catch","mania"][Math.max(0,Math.min(3,d))],C=n.AudioFilename;let f;const I=e.findIndex(E=>E.trim()==="[Events]");if(I!==-1)for(let E=I+1;E<e.length;E++){const M=e[E].trim();if(!M||M.startsWith("["))break;const S=M.match(/\"([^\"]+)\"/);if(S){f=S[1];break}}const A={comboColors:h.comboColors.length?h.comboColors:void 0,sliderBorder:h.sliderBorder,sliderTrackOverride:h.sliderTrackOverride};return{format:c,mode:m,general:n,metadata:o,difficulty:i,timingPoints:r,hitObjects:a,audioFilename:C,backgroundFilename:f,colors:A}}async function Ke(t,e){var s,n,o,i;try{const r="https://esm.sh/osu-parsers@4.1.7?bundle",a="https://esm.sh/osu-standard-stable@5.0.1?bundle";let h,c;try{h=await import(r),c=await import(a)}catch{const M="osu-parsers",S="osu-standard-stable";h=await import(M),c=await import(S)}const d=new h.BeatmapDecoder,u=new c.StandardRuleset,m=u.applyToBeatmapWithMods(d.decodeFromString(t),u.createModCombination("")),C=c.Circle,f=c.Slider,I=c.Spinner,A=m.hitObjects.filter(M=>M instanceof C||M instanceof f||M instanceof I),E=Math.min(A.length,e.hitObjects.length);for(let M=0;M<E;M++){const S=A[M],p=e.hitObjects[M];if(S instanceof I)continue;const B=(S.startX??((s=S.startPosition)==null?void 0:s.x)??S.x??0)+(((n=S.stackedOffset)==null?void 0:n.x)??0),j=(S.startY??((o=S.startPosition)==null?void 0:o.y)??S.y??0)+(((i=S.stackedOffset)==null?void 0:i.y)??0);p.stackedX=B,p.stackedY=j}return e}catch{return e}}class Je{constructor(){Mt(this,"ctx",null);Mt(this,"buffer",null);Mt(this,"src",null);Mt(this,"gainNode",null);Mt(this,"startCtxTime",0);Mt(this,"startOffset",0);Mt(this,"_onTick");Mt(this,"raf",0);Mt(this,"_volume",1);Mt(this,"tick",()=>{this._onTick&&this._onTick(this.currentTime),this.raf=requestAnimationFrame(this.tick)})}get duration(){var e;return((e=this.buffer)==null?void 0:e.duration)??0}get volume(){return this._volume}set volume(e){this._volume=Math.max(0,Math.min(1,e)),this.gainNode&&(this.gainNode.gain.value=this._volume)}async load(e){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext));const s=await this.ctx.decodeAudioData(e.slice(0));this.buffer=s,this.stop()}ensureSrc(){!this.ctx||!this.buffer||(this.gainNode||(this.gainNode=this.ctx.createGain(),this.gainNode.gain.value=this._volume,this.gainNode.connect(this.ctx.destination)),this.src=this.ctx.createBufferSource(),this.src.buffer=this.buffer,this.src.connect(this.gainNode),this.src.onended=()=>{cancelAnimationFrame(this.raf),this.raf=0})}play(e){!this.ctx||!this.buffer||(this.stop(),this.ensureSrc(),this.src&&(this.startOffset=typeof e=="number"?e:this.currentTime,this.startCtxTime=this.ctx.currentTime,this.src.start(0,this.startOffset),this.tick()))}pause(){if(!this.ctx)return;const e=this.currentTime;this.stop(),this.startOffset=e}seek(e){if(!this.ctx)return;const s=!!this.src;this.stop(),this.startOffset=Math.max(0,Math.min(this.duration,e)),s&&this.play(this.startOffset)}setPosition(e){this.ctx&&(this.stop(),this.startOffset=Math.max(0,Math.min(this.duration,e)))}stop(){if(this.src){try{this.src.stop()}catch{}try{this.src.disconnect()}catch{}}this.src=null,this.raf&&cancelAnimationFrame(this.raf),this.raf=0}get isPlaying(){return!!this.src}get currentTime(){if(!this.ctx)return 0;if(!this.src)return Math.min(this.duration,this.startOffset);const e=this.ctx.currentTime-this.startCtxTime;return Math.max(0,Math.min(this.duration,this.startOffset+e))}onTick(e){this._onTick=e}getBuffer(){return this.buffer}getContext(){return this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx}}const Gt={1:"normal",2:"soft",3:"drum"};function Qe(t){const e=["hitnormal"];return t&2&&e.push("hitwhistle"),t&4&&e.push("hitfinish"),t&8&&e.push("hitclap"),e}class Vt{constructor(e){Mt(this,"ctx");Mt(this,"buffers",new Map);Mt(this,"loading",null);Mt(this,"slideSrc",null);Mt(this,"slideGain",null);Mt(this,"whistleSrc",null);Mt(this,"whistleGain",null);Mt(this,"active",new Set);Mt(this,"masterGain",null);Mt(this,"_volume",1);this.ctx=e,this.masterGain=e.createGain(),this.masterGain.gain.value=this._volume,this.masterGain.connect(e.destination)}get volume(){return this._volume}set volume(e){this._volume=Math.max(0,Math.min(1,e)),this.masterGain&&(this.masterGain.gain.value=this._volume)}async load(e){if(e||(e="/img/"),e.endsWith("/")||(e+="/"),this.loading)return this.loading;const s=[];for(const n of["normal","soft","drum"])for(const o of["hitnormal","hitwhistle","hitfinish","hitclap","slidertick","sliderslide","sliderwhistle"])s.push(`${n}-${o}.wav`);return this.loading=(async()=>{await Promise.all(s.map(async n=>{try{const o=await fetch(e+n);if(!o.ok)return;const i=await o.arrayBuffer(),r=await this.ctx.decodeAudioData(i.slice(0));this.buffers.set(n,r)}catch{}}))})(),this.loading}playFile(e,s=0,n=.8){const o=this.buffers.get(e);if(!o)return;try{this.ctx.state!=="running"&&this.ctx.resume().catch(()=>{})}catch{}const i=this.ctx.createBufferSource(),r=this.ctx.createGain();r.gain.value=n,i.buffer=o,i.connect(r),this.masterGain?r.connect(this.masterGain):r.connect(this.ctx.destination);const a=Math.max(this.ctx.currentTime,s);i.onended=()=>{try{i.disconnect()}catch{}try{r.disconnect()}catch{}this.active.delete(i)};try{i.start(a)}catch{}this.active.add(i)}playWithFallback(e,s,n=0,o=.8){const i=[s,"normal","soft","drum"],r=new Set;for(const h of i){const c=`${h}-${e}.wav`;if(r.has(c))continue;if(r.add(c),this.buffers.get(c))return this.playFile(c,n,o),!0}const a=`${e}.wav`;return this.buffers.get(a)?(this.playFile(a,n,o),!0):!1}playHit(e,s,n){const o=Qe(s);for(const i of o)this.playFile(`${e}-${i}.wav`,n)}playTick(e,s){this.playFile(`${e}-slidertick.wav`,s,.7)}playReverse(e,s){this.playFile(`${e}-sliderwhistle.wav`,s,.8)}startLoop(e,s,n,o=.3){const i=[s,"normal","soft","drum"];let r;for(const c of i){const d=`${c}-${e}.wav`,u=this.buffers.get(d);if(u){r=u;break}}if(!r){const c=`${e}.wav`,d=this.buffers.get(c);if(d)r=d;else return}if(e==="sliderslide")this.stopSlide();else{if(this.whistleSrc){try{this.whistleSrc.stop()}catch{}try{this.whistleSrc.disconnect()}catch{}this.whistleSrc=null}if(this.whistleGain){try{this.whistleGain.disconnect()}catch{}this.whistleGain=null}}try{this.ctx.state!=="running"&&this.ctx.resume().catch(()=>{})}catch{}const a=this.ctx.createBufferSource();a.buffer=r,a.loop=!0;const h=this.ctx.createGain();h.gain.value=typeof o=="number"?Math.max(0,Math.min(1,o)):.3,a.connect(h),this.masterGain?h.connect(this.masterGain):h.connect(this.ctx.destination);try{a.start(Math.max(this.ctx.currentTime,n||0))}catch{}e==="sliderslide"?(this.slideSrc=a,this.slideGain=h):(this.whistleSrc=a,this.whistleGain=h)}startSlide(e,s,n){this.startLoop("sliderslide",e,s,(typeof n=="number"?Math.max(0,Math.min(1,n)):1)*.3)}stopSlide(){if(this.slideSrc){try{this.slideSrc.stop()}catch{}try{this.slideSrc.disconnect()}catch{}this.slideSrc=null}if(this.slideGain){try{this.slideGain.disconnect()}catch{}this.slideGain=null}}startSliderLoops(e,s,n,o){this.startLoop("sliderslide",e,n,(typeof o=="number"?Math.max(0,Math.min(1,o)):1)*.3),s&&this.startLoop("sliderwhistle",e,n,(typeof o=="number"?Math.max(0,Math.min(1,o)):1)*.25)}stopSliderLoops(){if(this.stopSlide(),this.whistleSrc){try{this.whistleSrc.stop()}catch{}try{this.whistleSrc.disconnect()}catch{}this.whistleSrc=null}if(this.whistleGain){try{this.whistleGain.disconnect()}catch{}this.whistleGain=null}}stopAll(){this.stopSlide();for(const e of Array.from(this.active)){try{e.stop()}catch{}try{e.disconnect()}catch{}this.active.delete(e)}}}function Ze(t,e){var r,a,h;const s=[],n=c=>{let d="normal";for(let u=0;u<t.timingPoints.length;u++){const m=t.timingPoints[u];if(m.time<=c&&m.sampleSet&&(d=Gt[m.sampleSet]||d),m.time>c)break}return d},o=(c,d,u,m)=>{const C=m&&m<0?100/-m:1,f=100*u*C;return c.length/Math.max(1e-6,f)*d},i=(c,d,u,m,C)=>{const f=m&&m<0?100/-m:1,I=100*u*f,A=c.length/Math.max(1e-6,I),E=1/Math.max(1e-6,C),M=[];for(let S=E;S<A-.001;S+=E){const p=S/A;p>0&&p<1&&M.push(p)}return M};for(const c of t.hitObjects)if(c.kind==="circle"){const d=n(c.time);s.push({timeMs:c.time,kind:"hit",set:d,bits:c.hitSound})}else if(c.kind==="slider"){const{base:d,inherited:u}=$t(t,c.time),m=(d==null?void 0:d.beatLength)??500,C=u==null?void 0:u.beatLength,f=o(c,m,e.SliderMultiplier,C),I=Math.max(1,c.slides),A=c.edgeSets&&((r=c.edgeSets[0])==null?void 0:r.sampleSet)&&Gt[c.edgeSets[0].sampleSet]||n(c.time),E=c.edgeSounds&&typeof c.edgeSounds[0]=="number"?c.edgeSounds[0]:c.hitSound;s.push({timeMs:c.time,kind:"hit",set:A,bits:E});const M=i(c,m,e.SliderMultiplier,C,e.SliderTickRate);for(let v=0;v<I;v++){const b=c.time+v*f;for(const P of M)s.push({timeMs:b+P*f,kind:"tick",set:A})}for(let v=1;v<I;v++){const b=c.time+v*f,P=c.edgeSets&&((a=c.edgeSets[v])==null?void 0:a.sampleSet)&&Gt[c.edgeSets[v].sampleSet]||n(b),H=c.edgeSounds&&typeof c.edgeSounds[v]=="number"?c.edgeSounds[v]:c.hitSound;s.push({timeMs:b,kind:"reverse",set:P,bits:H})}const S=c.time+f*I,p=I,B=c.edgeSets&&((h=c.edgeSets[p])==null?void 0:h.sampleSet)&&Gt[c.edgeSets[p].sampleSet]||n(S),j=c.edgeSounds&&typeof c.edgeSounds[p]=="number"?c.edgeSounds[p]:c.hitSound;s.push({timeMs:S,kind:"hit",set:B,bits:j})}else if(c.kind==="spinner"){const d=n(c.endTime);s.push({timeMs:c.endTime,kind:"hit",set:d,bits:0})}return s.sort((c,d)=>c.timeMs-d.timeMs),s}function ts(t){const e={};let s="root";e[s]={};const n=t.split(/\r?\n/);for(let o of n){let i=o.trim();if(!i||i.startsWith(";")||i.startsWith("//"))continue;if(i.startsWith("[")&&i.endsWith("]")){s=i.slice(1,-1).trim(),e[s]||(e[s]={});continue}const r=i.indexOf("=");if(r===-1)continue;const a=i.slice(0,r).trim(),h=i.slice(r+1).trim();e[s][a]=h}return e}function es(t){const e=t.Colours||t.Colors||{},s=Object.keys(e).filter(o=>/^combo\d+/i.test(o)).sort((o,i)=>{const r=Number(o.replace(/[^\d]/g,"")),a=Number(i.replace(/[^\d]/g,""));return r-a}),n=[];for(const o of s){const r=e[o].split(",").map(a=>Number(a.trim())).filter(a=>Number.isFinite(a));r.length>=3&&n.push(Se(r[0],r[1],r[2]))}return n}function ss(t){const e=t.Colours||t.Colors||{},s=e.SliderBorder||e.sliderborder;if(!s)return null;const n=s.split(",").map(o=>Number(o.trim())).filter(o=>Number.isFinite(o));return n.length>=3?Se(n[0],n[1],n[2]):null}function Se(t,e,s){const n=i=>Math.max(0,Math.min(255,Math.round(i))),o=i=>n(i).toString(16).padStart(2,"0");return`#${o(t)}${o(e)}${o(s)}`}async function ns(t){t||(t="/img/"),t.endsWith("/")||(t+="/");const e={},s=async(a,h)=>{try{const c=await ee(t+h);e[a]=c}catch{}};await Promise.all([s("hitcircle","hitcircle.png"),s("hitcircleoverlay","hitcircleoverlay.png"),s("approachcircle","approachcircle.png"),s("sliderfollowcircle","sliderfollowcircle.png"),s("followpoint","followpoint.png"),s("cursor","cursor.png"),s("cursortrail","cursortrail.png"),s("reversearrow","reversearrow.png"),s("sliderscorepoint","sliderscorepoint.png"),s("sliderstartcircle","sliderstartcircle.png"),s("sliderendcircle","sliderendcircle.png"),s("sliderb","sliderb.png"),s("sliderbnd","sliderb-nd.png"),s("sliderbspec","sliderb-spec.png"),s("spinnerApproachcircle","spinner-approachcircle.png"),s("spinnerBottom","spinner-bottom.png")]),e.sliderb||await s("sliderb","sliderb0.png");const n=[];for(let a=0;a<10;a++)try{const h=await ee(t+`sliderb${a}.png`);n.push(h)}catch{}n.length&&(e.sliderballFrames=n);const o=[];for(let a=0;a<=9;a++){const h=`default-${a}.png`,c=ee(t+h).then(d=>d).catch(()=>null);o.push(c)}const r=(await Promise.all(o)).filter(Boolean);r.length===10&&(e.digits=r);try{const a=await fetch(t+"skin.ini");if(a.ok){const h=await a.text(),c=ts(h),d=es(c);d.length&&(e.comboColors=d);const u=ss(c);u&&(e.sliderBorder=u)}}catch{}return e}async function ee(t){return new Promise((e,s)=>{const n=new Image;n.onload=()=>e(n),n.onerror=o=>s(o),n.src=t})}const os=({open:t,onClose:e,downloadUrl:s,beatmapVersion:n,beatmapId:o})=>(kt.useEffect(()=>{if(t)return document.body.classList.add("overlay-open"),()=>{document.body.classList.remove("overlay-open")}},[t]),t?g.jsxs("div",{className:"overlay editor-embed-overlay",role:"dialog","aria-modal":"true",onClick:i=>i.stopPropagation(),children:[g.jsx("div",{className:"overlay-backdrop",onClick:e}),g.jsxs("div",{className:"overlay-card embed-preview-card",onClick:i=>i.stopPropagation(),children:[g.jsx("button",{className:"overlay-close",onClick:e,"aria-label":"Close embed preview",children:g.jsx(pe,{size:18})}),g.jsx("div",{className:"embed-preview-body",onClick:i=>i.stopPropagation(),children:g.jsx(Le,{downloadUrl:s,beatmapVersion:n,beatmapId:o,onOpenInEditor:()=>{e(),window.location.hash="/editor"}})})]})]}):null),se=1,rs={1:"#ffffff",2:"#ff0000",3:"#b706b7",4:"#3276e6",5:"#e6e605",6:"#843e84",7:"#e6e605",8:"#e6e605",9:"#e6e605"};function is(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){const s=e;e=t%e,t=s}return t||1}const as=({beatmap:t,currentTime:e,duration:s,onSeek:n,bookmarks:o,onScrubStart:i,onScrubEnd:r,scale:a,onScaleChange:h,beatSnapDivisor:c=4,onBeatSnapChange:d,skin:u,isPlaying:m,onPlayPause:C})=>{const f=x.useRef(null),I=48,[A,E]=x.useState(a??.4),M=x.useRef(!1),S=x.useRef([0,0]),p=x.useRef(new Set),[,B]=x.useState(0),j=x.useRef(null),v=x.useRef(!1);x.useEffect(()=>{a!==void 0&&E(a)},[a]);const b=(y,_,L)=>_/2+(y-L)/(se/A),P=(y,_,L)=>L+(y-_/2)*(se/A),H=y=>[1,2,4,8,16].includes(y)?"even":[3,6,12].includes(y)?"triplets":"custom",ot=x.useRef(new Map),Z=(y,_,L)=>{const G=Math.max(1,Math.round(_)),R=`${y.src}|mini|${L}|${G}`,F=ot.current,V=F.get(R);if(V)return V;const tt=document.createElement("canvas");tt.width=G,tt.height=G;const k=tt.getContext("2d");return k.drawImage(y,0,0,G,G),k.globalCompositeOperation="multiply",k.fillStyle=L,k.fillRect(0,0,G,G),k.globalCompositeOperation="destination-in",k.drawImage(y,0,0,G,G),F.set(R,tt),tt};function nt(y,_,L,G,R,F){if(L<=0)return;const V=_==null?void 0:_.digits,tt=Math.max(6,Math.floor(F*.75));if(V&&V.length===10){const l=String(L).split("").map(K=>V[Number(K)]),O=l.reduce((K,ht)=>K+Math.max(1,Math.round(((ht==null?void 0:ht.width)||10)*(tt/((ht==null?void 0:ht.height)||tt)))),0);let at=G-O/2;y.save();for(const K of l){const ht=Math.max(1,Math.round(((K==null?void 0:K.width)||10)*(tt/((K==null?void 0:K.height)||tt)))),pt=tt;K&&y.drawImage(K,at,R-pt/2,ht,pt),at+=ht}y.restore()}else y.save(),y.fillStyle="#fff",y.font=`bold ${tt}px system-ui, sans-serif`,y.textAlign="center",y.textBaseline="middle",y.fillText(String(L),G,R),y.restore()}function $(y,_){const{base:L,inherited:G}=$t(y,_.time),R=(L==null?void 0:L.beatLength)??500,F=G==null?void 0:G.beatLength,V=F&&F<0?100/-F:1,k=100*Number(y.difficulty.SliderMultiplier??1)*V;return _.length/Math.max(1e-6,k)*R}function U(y,_){return $(y,_)*Math.max(1,_.slides)}const gt=x.useCallback(()=>{B(y=>y+1)},[]);return Me(f,gt),x.useEffect(()=>{var pt;const y=f.current;if(!y)return;const _=window.devicePixelRatio||1,L=Math.min(3,Math.max(1,_)),G=y.getBoundingClientRect(),R=Math.max(200,Math.min(G.width,1e4)),F=I,V=16384,tt=Math.min(V,Math.max(1,Math.round(R*L))),k=Math.min(V,Math.max(1,Math.round(F*L)));y.width=tt,y.height=k;const l=y.getContext("2d");try{l.setTransform(L,0,0,L,0,0)}catch{}l.globalCompositeOperation="source-over",l.clearRect(0,0,R,F),l.fillStyle="#0f1626",l.fillRect(0,0,R,F);const O=e*1e3,at=R/2*(se/A)+120,K=O-at,ht=O+at;if(t){const{base:it}=$t(t,O);if(it&&it.beatLength>0){const et=it.beatLength,mt=c,vt=it.time+et*Math.ceil((O-it.time)/et),xt=ut=>{const wt=b(ut,R,O);if(wt<-1||wt>R+1)return;const st=Math.round(ut-(Math.round((ut-it.time)/et)*et+it.time))===0,q=st&&Math.round((ut-it.time)/et)%(it.meter||4)===0;let rt="#cdd6f4";if(!st){const W=Math.floor((ut-it.time)/et)*et+it.time,Q=Math.round((ut-W)/(et/mt)),yt=mt/is(mt,Q);rt=rs[yt]||"#929292"}l.strokeStyle=rt,l.lineWidth=st?2:1,l.beginPath(),l.moveTo(wt+.5,q?0:10),l.lineTo(wt+.5,q?F:F-10),l.stroke()};for(let ut=vt;ut<=ht;ut+=et/mt)xt(ut);for(let ut=vt-et/mt;ut>=K;ut-=et/mt)xt(ut)}}if(t){const it=t.hitObjects,et=(pt=t.colors)!=null&&pt.comboColors&&t.colors.comboColors.length?t.colors.comboColors:u!=null&&u.comboColors&&u.comboColors.length?u.comboColors:["#FF66AA","#99CCFF","#99FF99","#FFFF66"],mt=new Array(it.length).fill(0),vt=new Array(it.length).fill(1);{let rt=0;for(let W=0;W<it.length;W++){const Q=it[W];Q.newCombo&&(rt=rt+1+(Q.comboSkip||0)),mt[W]=rt,W===0||mt[W]!==mt[W-1]?vt[W]=1:vt[W]=(vt[W-1]||1)+1}}const[xt,ut]=S.current;if(Math.abs(xt-ut)>0){const rt=b(Math.min(xt,ut),R,O),W=b(Math.max(xt,ut),R,O);l.fillStyle="rgba(255,255,255,0.25)",l.fillRect(Math.max(0,rt),0,Math.max(0,Math.min(R,W)-Math.max(0,rt)),F)}const st=Math.floor(F*.5),q=Math.max(2,Math.floor(F*.38));for(let rt=it.length-1;rt>=0;rt--){const W=it[rt],Q=W.time,yt=W.kind==="slider"?Q+U(t,W):W.endTime??Q;if(yt<K||Q>ht)continue;const bt=b(Q,R,O),Pt=b(yt,R,O),w=p.current.has(rt),T=et[mt[rt]%et.length];if(l.fillStyle=w?"#f59e0b":"#1f2b45",l.fillRect(Math.floor(bt),0,1,F),W.kind==="circle"){const D=u==null?void 0:u.hitcircle,X=u==null?void 0:u.hitcircleoverlay;if(D){const Y=q*2,N=Y/(D.width||128),z=(D.width||128)*N,J=(D.height||128)*N;l.save(),l.globalAlpha=.95;const ct=Z(D,Math.max(1,Math.round(Y)),T);l.drawImage(ct,bt-z/2,st-J/2,z,J),X&&l.drawImage(X,bt-z/2,st-J/2,z,J),l.restore(),nt(l,u,vt[rt],bt,st,q)}else l.save(),l.beginPath(),l.arc(bt,st,q,0,Math.PI*2),l.fillStyle=T,l.fill(),l.restore(),nt(l,u,vt[rt],bt,st,q)}else if(W.kind==="slider"){l.save();const D=Math.min(bt,Pt),X=Math.max(4,Math.abs(Pt-bt)),Y=Math.max(6,Math.floor(F*.7)),N=Math.floor((F-Y)/2),z=3;l.beginPath(),l.moveTo(D+z,N),l.lineTo(D+X-z,N),l.quadraticCurveTo(D+X,N,D+X,N+z),l.lineTo(D+X,N+Y-z),l.quadraticCurveTo(D+X,N+Y,D+X-z,N+Y),l.lineTo(D+z,N+Y),l.quadraticCurveTo(D,N+Y,D,N+Y-z),l.lineTo(D,N+z),l.quadraticCurveTo(D,N,D+z,N),l.closePath(),l.fillStyle=w?"rgba(245,158,11,0.9)":T,l.globalAlpha=w?.95:.85,l.fill(),l.restore();const J=u==null?void 0:u.hitcircle,ct=u==null?void 0:u.hitcircleoverlay;if(J){const lt=q*2,Ct=lt/(J.width||128),Tt=(J.width||128)*Ct,jt=(J.height||128)*Ct;l.save(),l.globalAlpha=.95;const Lt=Z(J,Math.max(1,Math.round(lt)),T);l.drawImage(Lt,bt-Tt/2,st-jt/2,Tt,jt),ct&&l.drawImage(ct,bt-Tt/2,st-jt/2,Tt,jt),l.restore(),nt(l,u,vt[rt],bt,st,q),l.save(),l.globalAlpha=.95;const Rt=Z(J,Math.max(1,Math.round(lt)),T);l.drawImage(Rt,Pt-Tt/2,st-jt/2,Tt,jt),ct&&l.drawImage(ct,Pt-Tt/2,st-jt/2,Tt,jt),l.restore()}const ft=W,dt=Math.max(1,ft.slides);if(dt>1&&t){const lt=$(t,ft);for(let Ct=1;Ct<dt;Ct++){const Tt=Q+lt*Ct;if(Tt<K||Tt>ht)continue;const jt=b(Tt,R,O),Lt=u==null?void 0:u.reversearrow;if(Lt){const It=Math.max(8,Math.floor(q*1.2))/(Lt.width||128),At=(Lt.width||128)*It,Bt=(Lt.height||128)*It;l.save(),l.globalAlpha=.9,l.translate(jt,st),l.drawImage(Lt,-At/2,-Bt/2,At,Bt),l.restore()}else if(J){const Rt=Math.max(4,Math.floor(q*.75)),It=Rt/(J.width||128),At=(J.width||128)*It,Bt=(J.height||128)*It;l.save(),l.globalAlpha=.85;const Te=w?"#f59e0b":T,Ce=Z(J,Math.max(1,Math.round(Rt*2)),Te);l.drawImage(Ce,jt-At/2,st-Bt/2,At,Bt),ct&&(l.globalAlpha=.7,l.drawImage(ct,jt-At/2,st-Bt/2,At,Bt)),l.restore()}else l.save(),l.beginPath(),l.arc(jt,st,Math.max(2,Math.floor(q*.6)),0,Math.PI*2),l.fillStyle=w?"#f59e0b":T,l.globalAlpha=.85,l.fill(),l.restore()}}}else if(W.kind==="spinner"){const X=Q-36,Y=yt-36,N=b(X,R,O),z=b(Y,R,O),J=Math.min(N,z),ct=Math.max(4,Math.abs(z-N)),ft=Math.max(6,Math.floor(F*.7)),dt=Math.floor((F-ft)/2);l.save();const lt=3;l.beginPath(),l.moveTo(J+lt,dt),l.lineTo(J+ct-lt,dt),l.quadraticCurveTo(J+ct,dt,J+ct,dt+lt),l.lineTo(J+ct,dt+ft-lt),l.quadraticCurveTo(J+ct,dt+ft,J+ct-lt,dt+ft),l.lineTo(J+lt,dt+ft),l.quadraticCurveTo(J,dt+ft,J,dt+ft-lt),l.lineTo(J,dt+lt),l.quadraticCurveTo(J,dt,J+lt,dt),l.closePath(),l.fillStyle=w?"rgba(245,158,11,0.9)":"rgba(87,177,255,0.85)",l.globalAlpha=w?.95:.85,l.fill(),l.restore();const Ct=u==null?void 0:u.hitcircle,Tt=u==null?void 0:u.hitcircleoverlay;if(Ct){const jt=q*2,Lt=jt/(Ct.width||128),Rt=(Ct.width||128)*Lt,It=(Ct.height||128)*Lt;l.save(),l.globalAlpha=.95;const At=Z(Ct,Math.max(1,Math.round(jt)),T);l.drawImage(At,N-Rt/2,st-It/2,Rt,It),Tt&&l.drawImage(Tt,N-Rt/2,st-It/2,Rt,It),l.restore(),l.save(),l.globalAlpha=.95;const Bt=Z(Ct,Math.max(1,Math.round(jt)),T);l.drawImage(Bt,z-Rt/2,st-It/2,Rt,It),Tt&&l.drawImage(Tt,z-Rt/2,st-It/2,Rt,It),l.restore()}else l.save(),l.beginPath(),l.arc(N,st,q,0,Math.PI*2),l.fillStyle=T,l.fill(),l.restore(),l.save(),l.beginPath(),l.arc(z,st,q,0,Math.PI*2),l.fillStyle=T,l.fill(),l.restore()}if(yt>Q){const D=b(yt,R,O);l.fillStyle=w?"rgba(245,158,11,0.35)":"rgba(87,177,255,0.2)",l.fillRect(Math.min(bt,D),F-8,Math.max(1,Math.abs(D-bt)),6)}}}if(o&&o.length>0){l.fillStyle="#f59e0b";for(const it of o){const et=it*1e3,mt=b(et,R,O);mt<-6||mt>R+6||(l.beginPath(),l.moveTo(mt,0),l.lineTo(mt+6,10),l.lineTo(mt-6,10),l.closePath(),l.fill())}}l.strokeStyle="#cdd6f4",l.lineWidth=2,l.beginPath(),l.moveTo(R/2+.5,0),l.lineTo(R/2+.5,F),l.stroke(),l.beginPath(),l.moveTo(R/2-3,0),l.lineTo(R/2,3),l.lineTo(R/2+3,0),l.closePath(),l.fillStyle="#cdd6f4",l.fill(),l.beginPath(),l.moveTo(R/2-3,F),l.lineTo(R/2,F-3),l.lineTo(R/2+3,F),l.closePath(),l.fill()},[t,e,s,o,A,c,u]),x.useEffect(()=>{const y=f.current;if(!y)return;const _=L=>{if(L.altKey){L.preventDefault();const V=L.deltaY>0?Math.max(.5,A-.1):Math.min(1.5,A+.1),tt=Math.round(V*10)/10;E(tt),h==null||h(tt);return}L.preventDefault(),v.current||(v.current=!0,i==null||i()),j.current!==null&&clearTimeout(j.current);const G=L.shiftKey?1:.1,R=L.deltaY>0?1:-1,F=Math.max(0,Math.min(s,e+R*G));n(F),j.current=window.setTimeout(()=>{v.current=!1,r==null||r(),j.current=null},150)};return y.addEventListener("wheel",_,{passive:!1}),()=>{y.removeEventListener("wheel",_),j.current!==null&&clearTimeout(j.current)}},[A,h,e,s,n,i,r]),x.useEffect(()=>{const y=f.current;if(!y)return;const _=G=>{const R=y.getBoundingClientRect(),F=R.width,V=e*1e3,tt=P(G.clientX-R.left,F,V);M.current=!0,G.ctrlKey?S.current=[tt,tt]:(i&&i(),n(Math.max(0,Math.min(s,tt/1e3))));const k=O=>{if(!M.current)return;const at=P(Math.max(0,Math.min(R.width,O.clientX-R.left)),F,V);if(G.ctrlKey){if(S.current=[tt,at],t){const K=Math.min(tt,at),ht=Math.max(tt,at),pt=new Set;for(let it=0;it<t.hitObjects.length;it++){const et=t.hitObjects[it],mt=et.time,vt=et.kind==="slider"?mt+U(t,et):et.endTime??mt;(K<mt&&ht>mt||K<vt&&ht>vt||mt<ht&&vt>K)&&pt.add(it)}p.current=pt}B(K=>K+1)}else n(Math.max(0,Math.min(s,at/1e3)))},l=()=>{M.current=!1,G.ctrlKey||r&&r(),window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",l)};window.addEventListener("mousemove",k),window.addEventListener("mouseup",l)},L=G=>{if(G.preventDefault(),G.touches.length===0)return;const R=y.getBoundingClientRect(),F=R.width,V=e*1e3,tt=G.touches[0],k=P(Math.max(0,Math.min(R.width,tt.clientX-R.left)),F,V);M.current=!0,i&&i(),n(Math.max(0,Math.min(s,k/1e3)));const l=at=>{if(at.preventDefault(),!M.current||at.touches.length===0)return;const K=at.touches[0],ht=P(Math.max(0,Math.min(R.width,K.clientX-R.left)),F,V);n(Math.max(0,Math.min(s,ht/1e3)))},O=at=>{at.preventDefault(),M.current=!1,r&&r(),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",O),window.removeEventListener("touchcancel",O)};window.addEventListener("touchmove",l,{passive:!1}),window.addEventListener("touchend",O),window.addEventListener("touchcancel",O)};return y.addEventListener("mousedown",_),y.addEventListener("touchstart",L,{passive:!1}),()=>{y.removeEventListener("mousedown",_),y.removeEventListener("touchstart",L)}},[t,e,s,n,i,r]),g.jsx("div",{className:"timeline-wrapper",children:g.jsxs("div",{className:"timeline-row",children:[g.jsx("canvas",{ref:f,className:"timeline",style:{height:I,display:"block"}}),g.jsxs("div",{className:"zoom-column",children:[g.jsx("button",{className:"zoom-btn small",onClick:()=>{const y=Math.min(1.5,A+.1);E(y),h==null||h(y)},children:"+"}),g.jsx("button",{className:"zoom-btn small",onClick:()=>{const y=Math.max(.5,A-.1);E(y),h==null||h(y)},children:"-"})]}),g.jsxs("div",{className:"beatsnap-vertical",children:[g.jsx("div",{className:"bs-label",children:"Beat Snap Divisor"}),g.jsxs("div",{className:"bs-value",children:["1/",c]}),g.jsxs("div",{className:"bs-arrows",children:[g.jsx("button",{className:"beat-snap-btn icon xs",title:"Prev divisor",onClick:()=>d==null?void 0:d(Math.max(1,c===16?12:c===12?9:c-1)),children:"◀"}),g.jsx("span",{className:"bs-kind",children:H(c)}),g.jsx("button",{className:"beat-snap-btn icon xs",title:"Next divisor",onClick:()=>d==null?void 0:d(Math.min(16,c===9?12:c===12?16:c+1)),children:"▶"})]})]})]})})},us=()=>{const[t,e]=x.useState(null),[s,n]=x.useState(void 0),o=x.useRef(void 0),[i,r]=x.useState(""),a=x.useRef(new Je),[h,c]=x.useState(0),[d,u]=x.useState(!1),[m,C]=x.useState(0),[f,I]=x.useState(null),A=x.useRef(null),E=x.useRef([]),M=x.useRef(0),S=x.useRef(0),p=x.useRef(0),B=x.useRef(0),[j,v]=x.useState([]),[b,P]=x.useState(1),[H,ot]=x.useState(!1),Z=x.useRef(!1),nt=x.useRef(!1),$=x.useRef(null),U=x.useRef(!1),gt=x.useRef(),[y,_]=x.useState(.4),[L,G]=x.useState(4),[R,F]=x.useState(!1),[V,tt]=x.useState(.6),[k,l]=x.useState(1),[O,at]=x.useState(.6),K=x.useRef(null),[ht,pt]=x.useState([]),[it,et]=x.useState(""),[mt,vt]=x.useState(!1),[xt,ut]=x.useState(!1),wt=x.useCallback(async(w,T)=>{var D,X;Et.clearAll();try{const Y=await w.readText(T);let N=te(Y);try{N=await Ke(Y,N)}catch{}e(N);try{const z=N.metadata.TitleUnicode||N.metadata.Title||"",J=N.metadata.ArtistUnicode||N.metadata.Artist||"",ct=N.metadata.Creator||N.metadata.creator||"",ft=N.metadata.Version||"",dt=Number(N.metadata.BeatmapID||0)||null;window.dispatchEvent(new CustomEvent("editor:info",{detail:{title:z,artist:J,mapper:ct,version:ft,beatmapId:dt}}))}catch{}try{const z=Kt(N.difficulty);E.current=Ze(N,z),M.current=0;const J=(D=N.colors)!=null&&D.comboColors&&N.colors.comboColors.length?N.colors.comboColors:["#FF66AA","#99CCFF","#99FF99","#FFFF66"],ct=ge(z.CS),ft=(f==null?void 0:f.sliderBorder)||((X=N.colors)==null?void 0:X.sliderBorder)||"#ffffff";Et.precalculateShapes(N,z,J,ct,240,ft)}catch{E.current=[],M.current=0}if(C(0),N.audioFilename){const z=w.findFirst(J=>J.toLowerCase().endsWith(N.audioFilename.toLowerCase()))||N.audioFilename;try{const J=await w.readArrayBuffer(z);await a.current.load(J),C(a.current.duration||0)}catch(J){console.warn("Failed to load audio:",J)}}if(N.backgroundFilename)try{const z=w.findFirst(ft=>ft.toLowerCase().endsWith(N.backgroundFilename.toLowerCase()))||N.backgroundFilename,J=await w.readArrayBuffer(z);o.current&&URL.revokeObjectURL(o.current);const ct=URL.createObjectURL(new Blob([J]));o.current=ct,n(ct)}catch{o.current&&(URL.revokeObjectURL(o.current),o.current=void 0),n(void 0)}else o.current&&(URL.revokeObjectURL(o.current),o.current=void 0),n(void 0);a.current.seek(0),c(0),u(!1)}catch(Y){console.error("Error loading beatmap path:",Y),alert(Y instanceof Error?Y.message:String(Y))}},[]);x.useEffect(()=>{const w=a.current;return w.onTick(T=>{Z.current||c(T)}),()=>w.stop()},[]),x.useEffect(()=>{const w=()=>F(!0);return window.addEventListener("editor:embed:preview",w),()=>window.removeEventListener("editor:embed:preview",w)},[]),x.useEffect(()=>{const w=window.__editorTransferOsz,T=window.__editorTransferPath,D=w?null:sessionStorage.getItem("editor:transfer:osz"),X=T?null:sessionStorage.getItem("editor:transfer:path");if(!w&&!D||!T&&!X)return;w?(delete window.__editorTransferOsz,delete window.__editorTransferPath):(sessionStorage.removeItem("editor:transfer:osz"),sessionStorage.removeItem("editor:transfer:path"));let Y=null;return Y=window.setTimeout(()=>{window.__editorTransferOsz&&(delete window.__editorTransferOsz,delete window.__editorTransferPath)},6e4),(async()=>{try{let N;if(w)N=w;else{const lt=atob(D),Ct=new Uint8Array(lt.length);for(let Tt=0;Tt<lt.length;Tt++)Ct[Tt]=lt.charCodeAt(Tt);N=Ct.buffer}const z=T||X,J=await me(N);K.current=J;const ct=J.list.filter(lt=>lt.toLowerCase().endsWith(".osu"));if(!ct.length)throw new Error("No .osu file in archive");const ft=[];for(const lt of ct)try{const Ct=await J.readText(lt),Tt=te(Ct),jt=String(Tt.metadata.Version||"");ft.push({path:lt,version:jt,mode:Tt.mode})}catch{}pt(ft);const dt=ct.includes(z)?z:ct[0];et(dt);try{window.dispatchEvent(new CustomEvent("editor:difficulty:list",{detail:{items:ft,selected:dt}}))}catch{}await wt(J,dt),r("Transferred from preview"),Y!==null&&clearTimeout(Y)}catch(N){console.error("Failed to load transferred OSZ:",N),alert(N instanceof Error?N.message:"Failed to load transferred beatmap"),Y!==null&&clearTimeout(Y)}})(),()=>{Y!==null&&clearTimeout(Y)}},[wt]),x.useEffect(()=>{if(!R)return;const w=T=>{T.key==="Escape"&&F(!1)};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[R]),x.useEffect(()=>{try{localStorage.getItem("editor:welcome:hidden")==="1"||vt(!0)}catch{vt(!0)}},[]),x.useEffect(()=>{const w=async()=>{try{const T=a.current.getContext();if(T.state!=="running"&&await T.resume(),!A.current){const D=new Vt(T);A.current=D,D.volume=O*V,await D.load().catch(()=>{})}}catch{}window.removeEventListener("pointerdown",w),window.removeEventListener("keydown",w)};return window.addEventListener("pointerdown",w,{once:!0}),window.addEventListener("keydown",w,{once:!0}),()=>{window.removeEventListener("pointerdown",w),window.removeEventListener("keydown",w)}},[]),x.useEffect(()=>{ns().then(w=>I(w)).catch(()=>I(null))},[]),x.useEffect(()=>{Et.clearAll()},[]),x.useEffect(()=>()=>{var w;S.current&&(cancelAnimationFrame(S.current),S.current=0),a.current.stop(),Et.clearAll(),o.current&&(URL.revokeObjectURL(o.current),o.current=void 0),$.current!==null&&(clearTimeout($.current),$.current=null);try{(w=A.current)==null||w.stopAll()}catch{}},[]),x.useEffect(()=>{a.current&&(a.current.volume=k*V)},[k,V]),x.useEffect(()=>{A.current&&(A.current.volume=O*V)},[O,V]);const st=x.useCallback(async w=>{console.log("Attempting to load OSZ file:",w.name),r(w.name);try{const T=await me(w);console.log("OSZ loaded, contents:",T.list),K.current=T;const D=T.list.filter(Y=>Y.toLowerCase().endsWith(".osu"));if(!D.length)throw new Error("No .osu file in archive");const X=[];for(const Y of D)try{const N=await T.readText(Y),z=te(N),J=String(z.metadata.Version||"");X.push({path:Y,version:J,mode:z.mode})}catch{}pt(X),et(D[0]);try{window.dispatchEvent(new CustomEvent("editor:difficulty:list",{detail:{items:X,selected:D[0]}}))}catch{}await wt(T,D[0])}catch(T){console.error("Error in onOpenOsz:",T),alert(T instanceof Error?T.message:String(T))}},[]),q=x.useMemo(()=>{if(m>0)return m;if(!t)return 0;const w=t.hitObjects[t.hitObjects.length-1];return w?(("endTime"in w?w.endTime:w.time)+2e3)/1e3:0},[m,t]),rt=x.useCallback(w=>{var N;H?(a.current&&m>0&&a.current.setPosition(w),c(w)):(a.current.seek(w),c(w));const T=w*1e3,D=E.current;let X=0,Y=D.length;for(;X<Y;){const z=X+Y>>>1;D[z].timeMs<=T?X=z+1:Y=z}M.current=X;try{(N=A.current)==null||N.stopSlide()}catch{}m===0&&d&&!H&&(p.current=performance.now(),B.current=w)},[H,m,d]),W=x.useCallback(async()=>{var X,Y;if(a.current.isPlaying&&m>0||d){a.current.pause(),u(!1),a.current.isPlaying&&a.current.stop(),S.current&&(cancelAnimationFrame(S.current),S.current=0);try{(X=A.current)==null||X.stopAll()}catch{}}else{if(Z.current)return;try{const N=a.current.getContext();if(N.state!=="running"&&await N.resume(),!A.current){const z=new Vt(N);A.current=z,z.volume=O*V,await z.load().catch(()=>{})}}catch{}if(m>0){const N=Math.max(0,m);let z=Math.max(0,Math.min(N,typeof h=="number"?h:0));if(z>=N-.001&&(z=0),z!==h){c(z);const J=z*1e3,ct=E.current;let ft=0,dt=ct.length;for(;ft<dt;){const lt=ft+dt>>>1;ct[lt].timeMs<=J?ft=lt+1:dt=lt}M.current=ft}yt.current=z,a.current.play(z),u(!0),a.current.isPlaying||u(!1);try{const J=(typeof h=="number"?h:0)*1e3,ct=E.current;let ft=-1;for(let dt=0;dt<ct.length;dt++)ct[dt].timeMs<=J&&ct[dt].kind==="slide_start"&&(ft=dt);if(ft!==-1){let dt=!1;for(let lt=ft+1;lt<ct.length;lt++)if(ct[lt].kind==="slide_end"){dt=ct[lt].timeMs>=J;break}if(dt){const lt=ct[ft];(Y=A.current)==null||Y.startSlide(lt.set)}}}catch{}}else{u(!0),p.current=performance.now();const N=Math.max(0,q||0),z=typeof h=="number"&&h>=N-.001?0:h;if(z!==h){c(z);const ct=z*1e3,ft=E.current;let dt=0,lt=ft.length;for(;dt<lt;){const Ct=dt+lt>>>1;ft[Ct].timeMs<=ct?dt=Ct+1:lt=Ct}M.current=dt}B.current=z;const J=()=>{if(Z.current){S.current=0;return}const ct=(performance.now()-p.current)/1e3,ft=Math.min(q||1/0,B.current+ct);if(c(ft),ft>=(q||1/0)){u(!1);return}S.current=requestAnimationFrame(J)};S.current=requestAnimationFrame(J)}}},[d,m,h,q]);x.useEffect(()=>{gt.current=W},[W]);const Q=x.useMemo(()=>{if(!t)return{bpm:0,sliderVelocity:0};const{base:w,inherited:T}=$t(t,h*1e3),D=w?6e4/w.beatLength:0,X=T?-100/T.beatLength:1;return{bpm:D,sliderVelocity:X}},[t,h]);x.useCallback(w=>{var D;const T=(D=w.target.files)==null?void 0:D[0];if(T){console.log("File selected in input:",T.name);try{const X=a.current.getContext();if(X.state!=="running"&&X.resume(),!A.current){const Y=new Vt(X);A.current=Y,Y.volume=O*V,Y.load().catch(()=>{})}}catch{}st(T).catch(X=>{console.error("Error from onOpenOsz via file input:",X),alert(String((X==null?void 0:X.message)||X))})}},[st]),x.useEffect(()=>{const w=T=>{const X=T.detail;X&&st(X).catch(Y=>{alert(Y instanceof Error?Y.message:String(Y))})};return window.addEventListener("editor:file",w),()=>window.removeEventListener("editor:file",w)},[st]),x.useEffect(()=>{const w=T=>{if(T.target&&T.target.tagName==="INPUT")return;if(T.code==="Space"){T.preventDefault(),gt.current&&gt.current();return}const D=T.shiftKey?1:.1;T.code==="ArrowLeft"&&(T.preventDefault(),rt(Math.max(0,h-D))),T.code==="ArrowRight"&&(T.preventDefault(),rt(Math.min(q,h+D))),T.code==="Home"&&(T.preventDefault(),rt(0)),T.code==="End"&&(T.preventDefault(),rt(q)),T.code==="KeyB"&&(T.preventDefault(),v(X=>[...X,h]))};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[W,rt,h,q]),x.useEffect(()=>{const w=T=>{var dt;const D=T.target;if(!D||D.closest(".top-nav")||D.tagName==="INPUT"||D.tagName==="TEXTAREA"||T.altKey||D.closest(".timeline-wrapper")||D.closest(".editor-controls-container")||(T.preventDefault(),!Number.isFinite(q)||q<=0))return;if(!U.current){U.current=!0;const lt=a.current.isPlaying&&m>0;nt.current=lt,lt&&a.current.pause(),u(!1),Z.current=!0,ot(!0)}$.current!==null&&clearTimeout($.current);const X=T.shiftKey?1:.1,Y=T.deltaY>0?1:-1,N=Math.max(0,Math.min(q,h+Y*X));m>0&&a.current.setPosition(N),c(N);const z=N*1e3,J=E.current;let ct=0,ft=J.length;for(;ct<ft;){const lt=ct+ft>>>1;J[lt].timeMs<=z?ct=lt+1:ft=lt}M.current=ct;try{(dt=A.current)==null||dt.stopSlide()}catch{}$.current=window.setTimeout(()=>{U.current=!1,Z.current=!1,ot(!1),$.current=null},150)};return window.addEventListener("wheel",w,{passive:!1}),()=>{window.removeEventListener("wheel",w),$.current!==null&&clearTimeout($.current)}},[h,q,d,m]),x.useEffect(()=>{const w=T=>{var N;const X=(N=T.detail)==null?void 0:N.path,Y=K.current;!Y||!X||(et(X),wt(Y,X).then(()=>{try{window.dispatchEvent(new CustomEvent("editor:difficulty:list",{detail:{items:ht,selected:X}}))}catch{}}))};return window.addEventListener("editor:difficulty:select",w),()=>window.removeEventListener("editor:difficulty:select",w)},[ht,wt]);const yt=x.useRef(0);x.useEffect(()=>{if(!t){yt.current=h;return}const w=A.current;if(!w){yt.current=h;return}const T=yt.current,D=h;if(yt.current=h,!d||H||D<=T||D-T>1)return;try{const z=a.current.getContext();if(z.state!=="running"){z.resume().catch(()=>{});return}}catch{}const X=D*1e3,Y=E.current;let N=M.current;for(;N<Y.length&&Y[N].timeMs<=X;N++){const z=Y[N];z.kind==="hit"?w.playHit(z.set,z.bits||0):z.kind==="tick"?w.playTick(z.set):z.kind==="reverse"&&(typeof z.bits=="number"?w.playHit(z.set,z.bits):w.playReverse(z.set))}M.current=N},[h,t,d,H]);const bt=x.useCallback(()=>{const w=a.current.isPlaying&&m>0;nt.current=w,w&&a.current.pause(),S.current&&(cancelAnimationFrame(S.current),S.current=0),u(!1),Z.current=!0,ot(!0)},[m]),Pt=x.useCallback(async()=>{Z.current=!1,ot(!1);try{const w=a.current.getContext();if(w.state!=="running"&&await w.resume(),!A.current){const T=new Vt(w);A.current=T,T.volume=O*V,await T.load().catch(()=>{})}}catch{}},[O,V]);return g.jsxs("div",{className:"app fullscreen-editor",children:[g.jsx(as,{beatmap:t,currentTime:h,duration:q,onSeek:rt,bookmarks:j,onScrubStart:bt,onScrubEnd:Pt,scale:y,onScaleChange:_,beatSnapDivisor:L,onBeatSnapChange:G,skin:f||void 0,isPlaying:d,onPlayPause:W}),g.jsxs("div",{className:"playfield-container",children:[g.jsx(de,{beatmap:t,timeSec:h,backgroundUrl:s,skin:f,sliderBodyCutoffPx:b}),g.jsx(fe,{masterVolume:V,songVolume:k,hitsoundVolume:O,onMasterVolumeChange:tt,onSongVolumeChange:l,onHitsoundVolumeChange:at})]}),g.jsx(ue,{isPlaying:d,onPlayPause:W,currentTime:h,duration:q,onSeek:rt,onScrubStart:bt,onScrubEnd:Pt,bpm:Q.bpm,sliderVelocity:Q.sliderVelocity,timingPoints:t==null?void 0:t.timingPoints}),mt&&g.jsx("div",{className:"editor-modal-overlay",children:g.jsxs("div",{className:"editor-modal",children:[g.jsx("div",{className:"modal-title",children:"Hey!"}),g.jsx("div",{className:"modal-body",children:g.jsxs("p",{children:["If you use this website solely for the editor, ",g.jsx("strong",{children:"don't"}),". This is a fork of ",g.jsx("strong",{children:"JoSu! 2.0"})," (",g.jsx("a",{href:"https://preview.tryz.id.vn/",target:"_blank",rel:"noreferrer",children:"preview.tryz.id.vn"}),") adapted specifically for this website. JoSu is superior in almost every way."]})}),g.jsxs("div",{className:"modal-actions",children:[g.jsxs("label",{className:"check-bubble",children:[g.jsx("input",{type:"checkbox",checked:xt,onChange:w=>ut(w.target.checked)}),g.jsx("span",{className:"check-text",children:"Don't show this again"})]}),g.jsx("button",{className:"btn secondary",onClick:()=>{try{xt&&localStorage.setItem("editor:welcome:hidden","1")}catch{}vt(!1)},children:"OK"})]})]})}),R&&g.jsxs("div",{className:"overlay editor-embed-overlay",role:"dialog","aria-modal":"true",children:[g.jsx("div",{className:"overlay-backdrop",onClick:()=>F(!1)}),g.jsxs("div",{className:"overlay-card embed-preview-card",children:[g.jsx("button",{className:"overlay-close",onClick:()=>F(!1),"aria-label":"Close embed preview",children:g.jsx(pe,{size:18})}),g.jsx("div",{className:"embed-preview-body",children:t?g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"embed-preview-playfield",children:[g.jsx(de,{beatmap:t,timeSec:h,backgroundUrl:s,skin:f,sliderBodyCutoffPx:b}),g.jsx(fe,{masterVolume:V,songVolume:k,hitsoundVolume:O,onMasterVolumeChange:tt,onSongVolumeChange:l,onHitsoundVolumeChange:at})]}),g.jsx(ue,{isPlaying:d,onPlayPause:W,currentTime:h,duration:q,onSeek:rt,bpm:Q.bpm,sliderVelocity:Q.sliderVelocity,timingPoints:t==null?void 0:t.timingPoints})]}):g.jsx("div",{className:"embed-preview-empty",children:"Load a beatmap to see the embed preview."})})]})]})]})},fs=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));export{Je as A,os as B,ue as C,us as E,Vt as H,de as P,fe as V,me as a,Ke as b,Ze as c,fs as d,ns as l,te as p,Kt as r,Et as s,$t as t};
