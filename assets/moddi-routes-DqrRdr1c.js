import{r as l,j as e,d as It,u as he,e as be,f as Ce,g as ge,h as Me,i as Rt,k as Ft,l as Mt,m as ke,n as Lt,o as Ke,R as K,p as fe,q as At,s as Bt,t as dt,L as _e,v as Et,w as Dt,x as ct,y as me,z as ut,A as Ve,B as Ot,M as Wt,C as Ze,D as et,E as tt,G as st,H as nt,I as it,c as Pt,J as Qt}from"./vendor-react-KNlIICER.js";import{B as $t}from"./editor-CKaGu5o2.js";function pt(){if(typeof window>"u")return!1;try{const t=navigator.userAgentData;if(t&&typeof t.mobile=="boolean"&&t.mobile||window.matchMedia&&(window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(hover: none)").matches))return!0;const s=navigator.userAgent||"";if(/Android|iPhone|iPad|iPod|Mobile|Silk|Kindle|Opera Mini|IEMobile|WPDesktop/i.test(s))return!0}catch{}return!1}function fs(){var d;if(typeof window>"u"||typeof document>"u")return()=>{};const t=()=>{const a=pt();document.documentElement.classList.toggle("is-mobile",a),document.documentElement.setAttribute("data-mobile",a?"true":"false")};t();const s=["(pointer: coarse)","(hover: none)","(orientation: landscape)","(orientation: portrait)"],i=[];try{for(const a of s)if(window.matchMedia){const o=window.matchMedia(a);(d=o.addEventListener)==null||d.call(o,"change",t),i.push(o)}}catch{}return window.addEventListener("resize",t),()=>{try{i.forEach(a=>{var o;return(o=a.removeEventListener)==null?void 0:o.call(a,"change",t)}),window.removeEventListener("resize",t)}catch{}}}function hs(){if(typeof window>"u")return!1;try{const t=navigator.standalone===!0,s=window.matchMedia&&window.matchMedia("(display-mode: standalone)"),i=!!(s&&s.matches),d=window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)"),a=window.matchMedia&&window.matchMedia("(display-mode: fullscreen)");return t||i||!!(d&&d.matches)||!!(a&&a.matches)}catch{return!1}}const mt=l.createContext(null);function bs({children:t}){const[s,i]=l.useState([]),d=l.useRef(1),a=l.useRef(new Map),o=r=>{const x=a.current.get(r);x&&(clearTimeout(x),a.current.delete(r))},c=(r,x)=>{o(r);const m=window.setTimeout(()=>f(r),x);a.current.set(r,m)},f=l.useCallback(r=>{o(r),i(x=>x.filter(m=>m.id!==r))},[]),y=l.useCallback((r,x)=>{const m=typeof x=="number"?x:(x==null?void 0:x.durationMs)??5e3,R=typeof x=="number"?"info":(x==null?void 0:x.variant)??"info",N=pt();let _=null;return i(N?w=>{const k=w[0];if(k&&k.message===r&&k.variant===R){const v={...k,count:k.count+1,duration:m};return _=v.id,[v]}w.forEach(v=>o(v.id));const F=d.current++,b={id:F,message:r,duration:m,variant:R,count:1};return _=F,[b]}:w=>{const k=w.findIndex(v=>v.message===r&&v.variant===R);if(k!==-1){const v=[...w],M={...v[k],count:v[k].count+1};return v[k]=M,_=M.id,v}const F=d.current++,b={id:F,message:r,duration:m,variant:R,count:1};return _=F,[...w,b]}),_!=null&&c(_,m),_??-1},[]),S=l.useMemo(()=>({notify:y,close:f}),[y,f]);return e.jsxs(mt.Provider,{value:S,children:[t,e.jsx("div",{className:"toasts",children:s.map(r=>e.jsxs("div",{className:`toast ${r.variant}`,children:[e.jsxs("div",{className:"toast-text",children:[r.message,r.count>1&&e.jsxs("span",{style:{marginLeft:6,opacity:.8},children:["×",r.count]})]}),e.jsx("button",{className:"toast-close",onClick:()=>f(r.id),"aria-label":"Close",children:"×"})]},r.id))})]})}function le(){const t=l.useContext(mt);if(!t)throw new Error("useToasts must be used within ToastProvider");return t}const Ut=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{standard:!0,taiko:!0,mania:!0,catch:!0}}catch{return{standard:!0,taiko:!0,mania:!0,catch:!0}}},Ht=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help,showcase,request",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{untagged:s.has("untagged")||s.size===0,help:s.has("help")||s.size===0,showcase:s.has("showcase")||s.size===0,request:s.has("request")||s.size===0}}catch{return{untagged:!0,help:!0,showcase:!0,request:!0}}},Yt=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{unchecked:s.has("unchecked")||s.size===0,accepted:s.has("accepted")||s.size===0,denied:s.has("denied")||s.size===0,finished:s.has("finished")||s.size===0,archived:s.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Jt=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{open:s.has("open")||s.size===0,closed:s.has("closed")}}catch{return{open:!0,closed:!1}}},Gt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator,timing,audio",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{modder:s.has("modder")||s.size===0,nominator:s.has("nominator")||s.size===0,timing:s.has("timing")||s.size===0,audio:s.has("audio")||s.size===0}}catch{return{modder:!0,nominator:!0,timing:!0,audio:!0}}},Xt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Kt=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Be=It(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Ut(),tagFilters:Ht(),queueStatusFilters:Yt(),queueOpenFilters:Jt(),queueTypeFilters:Gt(),lastSection:Xt(),previousLocation:null,theme:Kt(),setMenuOpen:s=>t({menuOpen:s}),setMobileNavOpen:s=>t({mobileNavOpen:s}),setNotifOpen:s=>t({notifOpen:s}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:s=>{t({modeFilters:s});try{const d=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),a=d.length?d:["standard"];localStorage.setItem("filter_modes",a.join(","))}catch{}},setTagFilters:s=>{t({tagFilters:s});try{const d=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),a=d.length?d:["untagged","help","showcase","request"];localStorage.setItem("filter_moddi_tags",a.join(","))}catch{}},setQueueStatusFilters:s=>{t({queueStatusFilters:s});try{const d=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),a=d.length?d:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",a.join(","))}catch{}},setQueueOpenFilters:s=>{t({queueOpenFilters:s});try{const d=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),a=d.length?d:["open"];localStorage.setItem("filter_queue_open",a.join(","))}catch{}},setQueueTypeFilters:s=>{t({queueTypeFilters:s});try{const d=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),a=d.length?d:["modder","nominator","timing","audio"];localStorage.setItem("filter_queue_type",a.join(","))}catch{}},setLastSection:s=>{t({lastSection:s});try{s?localStorage.setItem("last_section",s):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:s=>{t({previousLocation:s})},setTheme:s=>{t({theme:s});try{localStorage.setItem("theme",s)}catch{}}})),gt="https://api.osumappi.ng";function ft(){var t;try{return((t=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s==="csrf"))==null?void 0:t[1])||""}catch{return""}}async function T(t,s={}){const{requireAuth:i=!0,skipCsrf:d=!1,...a}=s,o={...a.headers};if(a.body&&!o["Content-Type"]&&(o["Content-Type"]="application/json"),i&&!d){const f=ft();f&&(o["X-CSRF-Token"]=f)}const c=await fetch(`${gt}${t}`,{...a,credentials:"include",headers:o});if(!c.ok){const f=await c.json().catch(()=>({error:`HTTP ${c.status}`}));throw new Error(f.error||`HTTP ${c.status}: ${c.statusText}`)}return c.json()}function Vt(t){const s=new URLSearchParams;for(const[d,a]of Object.entries(t))a!=null&&s.append(d,String(a));const i=s.toString();return i?`?${i}`:""}const z={auth:{login:"/api/auth/login",logout:"/api/auth/logout",me:"/api/me"},user:{quota:"/api/me/upload_quota",notifications:"/api/me/notifications",markNotificationsRead:"/api/me/notifications/mark_read",deleteNotification:t=>`/api/me/notifications/${encodeURIComponent(t)}`,pushSubscribe:"/api/me/push/subscribe",pushUnsubscribe:"/api/me/push/unsubscribe",pushList:"/api/me/push/subscriptions",pushTest:"/api/me/push/test",notifPrefs:"/api/me/notification_prefs",bannerUpload:"/api/users/me/banner/upload-url",bannerImageUpload:"/api/users/me/banner/image/upload-url",bannerImageConfirm:"/api/users/me/banner/image/confirm"},feed:{next:"/api/feed/next",batch:"/api/feed/batch",progress:t=>`/api/feed/progress${t?`?modes=${encodeURIComponent(t)}`:""}`,recent:"/api/videos/recent"},videos:{like:t=>`/api/videos/${t}/like`,view:t=>`/api/videos/${t}/view`,update:t=>`/api/videos/${t}`,delete:t=>`/api/videos/${t}`,flag:t=>`/api/videos/${t}/flag`,comments:t=>`/api/videos/${t}/comments`,get:t=>`/api/videos/${t}`},uploads:{new:"/api/uploads/new"},moddi:{mySubmissions:"/api/moddi/me/submissions",posts:"/api/moddiposts",post:t=>`/api/moddiposts/${t}`,postReact:t=>`/api/moddiposts/${t}/react`,postComments:t=>`/api/moddiposts/${t}/comments`,queues:"/api/moddi/queues",queue:t=>`/api/moddi/queues/${t}`,queueSubmit:t=>`/api/moddi/queues/${t}/submit`,queueAccept:t=>`/api/moddi/queues/${t}/accept`,queueDeny:t=>`/api/moddi/queues/${t}/deny`,queueInvite:t=>`/api/moddi/queues/${t}/invite`,queueMember:(t,s)=>`/api/moddi/queues/${t}/members/${s}`,queueSubmission:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueSubmissionDelete:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueBlockUser:t=>`/api/moddi/queues/${t}/block`,queueUnblockUser:(t,s)=>`/api/moddi/queues/${t}/block/${s}`,queueBlockedUsers:t=>`/api/moddi/queues/${t}/blocked`,queueSubmissionAcknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueSubmissionUnacknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueBannerUpload:t=>`/api/moddi/queues/${t}/banner/upload-url`,queueBannerImageUpload:t=>`/api/moddi/queues/${t}/banner/image/upload-url`,queueBannerImageConfirm:t=>`/api/moddi/queues/${t}/banner/image/confirm`,usersSearch:t=>`/api/moddi/users/search?q=${encodeURIComponent(t)}`},osu:{resolveBeatmap:"/api/osu/beatmap/resolve",downloadBeatmapset:t=>`/api/osu/beatmapsets/${t}/download?noVideo=1`,usersSearch:t=>`/api/osu/users/search?q=${encodeURIComponent(t)}`},users:{get:t=>`/api/users/${t}`,videos:t=>`/api/users/${t}/videos`,likes:t=>`/api/users/${t}/likes`,myVideos:"/api/me/videos"},admin:{clearViews:"/api/admin/me/clear_views",debugState:"/api/debug/state",settingsModeration:"/api/admin/settings/moderation",videosPending:"/api/admin/videos/pending",videosApprove:t=>`/api/admin/videos/${t}/approve`,videosReject:t=>`/api/admin/videos/${t}/reject`,videosAction:(t,s)=>`/api/admin/videos/${t}/${s}`,analytics:"/api/admin/analytics",usersSearch:t=>`/api/admin/users/search?q=${encodeURIComponent(t)}`,userVideos:t=>`/api/admin/users/${t}/videos`,userUpdate:t=>`/api/admin/users/${t}`,notificationsSystem:"/api/admin/notifications/system",notificationsTest:"/api/admin/notifications/test"}};function Zt(t=!0){return he({queryKey:["notifications"],queryFn:async()=>{try{const s=await T(z.user.notifications);return Array.isArray(s.items)?s.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function es(){return he({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await T("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function xs(){const{data:t=[]}=Zt();return t.filter(s=>s.kind==="system"&&s.id.startsWith("b:")&&(s.expiresAt||0)<=Date.now()?!1:!s.read).length}function ts(){const t=be();return Ce({mutationFn:async s=>{await T(z.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:s})})},onSuccess:()=>{t.setQueryData(["notifications"],s=>(s==null?void 0:s.map(i=>({...i,read:!0})))||[])}})}function ss(){const t=be();return Ce({mutationFn:async s=>{const i=ft();await T(z.user.deleteNotification(s),{method:"DELETE",headers:{"X-CSRF-Token":i}})},onSuccess:(s,i)=>{t.setQueryData(["notifications"],d=>(d==null?void 0:d.filter(a=>a.id!==i))||[]),t.setQueryData(["notifications","detailed"],d=>(d==null?void 0:d.filter(a=>a.id!==i))||[])}})}function Ne(){return he({queryKey:["user","me"],queryFn:async()=>{try{return await T(z.auth.me)}catch{return null}},staleTime:5*60*1e3})}function ys(t=!0){return he({queryKey:["user","quota"],queryFn:async()=>{try{return await T(z.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function vs(){const t=be();return Ce({mutationFn:async()=>{await T(z.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function ns(t,s,i,d){l.useEffect(()=>{if(!i)return;const a=o=>{const c=o.target;s.current&&!s.current.contains(c)&&t.current&&!t.current.contains(c)&&d()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[i,d,t,s])}const rt=/(\d{2}:\d{2}:\d{3})(?:\s+\(([\d,]+)\))?/g;function at(t,s){return s?`osu://edit/${t}-(${s})`:`osu://edit/${t}`}function ht({text:t,className:s,style:i}){rt.lastIndex=0;const d=[];let a=0,o;for(;(o=rt.exec(t))!==null;){o.index>a&&d.push(t.substring(a,o.index));const c=o[1],f=o[2],y=o[0];d.push(e.jsx("a",{href:at(c,f),onClick:S=>{S.preventDefault(),window.location.href=at(c,f)},style:{color:"var(--primary)",textDecoration:"none",cursor:"pointer"},onMouseEnter:S=>{S.currentTarget.style.textDecoration="underline"},onMouseLeave:S=>{S.currentTarget.style.textDecoration="none"},title:"Open in osu! editor",children:y},o.index)),a=o.index+o[0].length}return a<t.length&&d.push(t.substring(a)),d.length===0?e.jsx("span",{className:s,style:i,children:t}):e.jsx("span",{className:s,style:i,children:d})}function is(t){const s=Math.floor(t/60),i=Math.floor(t%60);return`${s}:${i.toString().padStart(2,"0")}`}function Le({submission:t,canManage:s,onUpdate:i,onDelete:d,isGroup:a=!1,allowSelfActions:o=!1}){var ne,H;const[c,f]=l.useState(!1),[y,S]=l.useState(!1),[r,x]=l.useState(null),[m,R]=l.useState(t.beatmapset_id),[N,_]=l.useState(t.beatmap_id),[w,k]=l.useState(!1),[F,b]=l.useState(!1),[v,M]=l.useState(null),[P,q]=l.useState(!1),[A,O]=l.useState(t.acknowledgments||[]),[U,Y]=l.useState(t.acknowledged_by_me||!1),D=l.useRef(null),h=l.useRef(null),C=l.useRef(null),g=l.useRef(null),{notify:B}=le();l.useEffect(()=>{O(t.acknowledgments||[]),Y(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),l.useEffect(()=>{if(t.beatmap_url)try{const u=new URL(t.beatmap_url),I=u.pathname.match(/\/beatmapsets\/(\d+)/);if(I&&!t.beatmapset_id){const $=Number(I[1]);isNaN($)||R($)}const W=u.hash.match(/#osu\/(\d+)/);if(W&&!t.beatmap_id){const $=Number(W[1]);isNaN($)||_($)}}catch(u){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,u)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),l.useEffect(()=>{if(!t.beatmap_url||r&&m)return;let u=!1;return(async()=>{try{let I;try{I=new URL(t.beatmap_url)}catch{return}const W=I.hash.match(/#osu\/(\d+)/),$=W?W[1]:null;I.hash="";const pe={url:I.toString()};if($?pe.beatmap_id=$:t.beatmap_id&&(pe.beatmap_id=String(t.beatmap_id)),!u){const J=await T(z.osu.resolveBeatmap+Vt(pe),{requireAuth:!0});J.setId&&!m&&R(Number(J.setId)),(J.title||J.artist)&&x({title:J.title||null,artist:J.artist||null,mapper:J.mapper||null,bpm:J.bpm||null,length:J.length||null})}}catch(I){console.error("[QueueSubmission] Error fetching beatmap metadata:",I)}})(),()=>{u=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,r,m]),l.useEffect(()=>{if(!w||!C.current){M(null);return}const u=C.current.getBoundingClientRect();M({top:u.bottom+4,left:u.left})},[w]),l.useEffect(()=>{if(!y)return;const u=I=>{const W=I.target;D.current&&!D.current.contains(W)&&!W.closest("[data-status-dropdown]")&&S(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[y]),l.useEffect(()=>{if(!w)return;const u=I=>{const W=I.target;h.current&&h.current.contains(W)||C.current&&C.current.contains(W)||k(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[w]);const G=async u=>{if(!c){f(!0);try{await T(z.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:u})});const I={...t,status:u,updated_at:Math.floor(Date.now()/1e3)};i&&i(I),B("Status updated",{variant:"success"})}catch{B("Failed to update status",{variant:"error"})}finally{f(!1),S(!1)}}},ue=async()=>{if(!c){f(!0);try{const u=!!t.is_archived;await T(z.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!u})});const I={...t,is_archived:u?0:1,updated_at:Math.floor(Date.now()/1e3)};i&&i(I),B(u?"Unarchived":"Archived",{variant:"success"})}catch{B("Failed to update archive status",{variant:"error"})}finally{f(!1)}}},ie=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){f(!0);try{await T(z.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),B("Submission deleted",{variant:"success"}),d&&d(t.id)}catch{B("Failed to delete submission",{variant:"error"})}finally{f(!1)}}},V=async()=>{if(!P){q(!0);try{U?(await T(z.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),Y(!1),B("Unacknowledged",{variant:"info"}),i&&i({...t,acknowledged_by_me:!1})):(await T(z.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),Y(!0),B("Acknowledged",{variant:"success"}),i&&i({...t,acknowledged_by_me:!0}))}catch{B("Failed to update acknowledgment",{variant:"error"})}finally{q(!1)}}},Z={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},ee={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},Q=m||t.beatmapset_id,re=Q?`https://assets.ppy.sh/beatmaps/${Q}/covers/cover.jpg`:null,X=!!t.is_archived,te=r!=null&&r.title?`${r.artist} - ${r.title}`:t.beatmap_version||"Beatmap";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:g,className:"queue-submission-card-square",style:{position:"relative",aspectRatio:"4 / 3",overflow:"hidden",background:"#1a1a1f",opacity:X?.6:1},children:[re&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:re,alt:"",style:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:"cover",zIndex:0},onError:u=>{u.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.55) 50%, rgba(0,0,0,0.45) 100%)",backdropFilter:"blur(1px)",zIndex:1}})]}),e.jsxs("div",{style:{position:"relative",zIndex:2,height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",padding:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 14px",background:"rgba(0,0,0,0.85)",backdropFilter:"blur(2px)"},children:[e.jsxs("div",{style:{position:"relative"},children:[s||o?e.jsxs("button",{ref:D,onClick:()=>S(!y),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.3px",background:Z[t.status]+"30",border:"none",color:Z[t.status],cursor:c?"not-allowed":"pointer",opacity:c?.6:1},children:[ee[t.status],e.jsx(Me,{size:14})]}):e.jsx("span",{style:{display:"inline-flex",padding:"6px 12px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.3px",background:Z[t.status]+"30",color:Z[t.status]},children:ee[t.status]}),y&&(s||o)&&ge.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",top:((ne=D.current)==null?void 0:ne.getBoundingClientRect().bottom)??0,left:((H=D.current)==null?void 0:H.getBoundingClientRect().left)??0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",padding:4,zIndex:1e4,minWidth:130,boxShadow:"0 8px 24px rgba(0,0,0,0.4)"},onClick:u=>u.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(u=>e.jsx("button",{onClick:()=>G(u),style:{display:"block",width:"100%",padding:"8px 12px",fontSize:13,fontWeight:u===t.status?600:500,textAlign:"left",background:u===t.status?Z[u]+"20":"transparent",color:u===t.status?Z[u]:"var(--text)",border:"none",cursor:"pointer"},children:ee[u]},u))}),document.body)]}),(s||o)&&e.jsxs("div",{style:{display:"flex",gap:6},children:[s&&e.jsx("button",{onClick:V,disabled:P||c,title:U?"Unacknowledge":"Acknowledge",style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:U?"rgba(16, 185, 129, 0.3)":"rgba(0,0,0,0.4)",border:"none",color:U?"#10b981":"rgba(255,255,255,0.7)",cursor:"pointer"},children:e.jsx(Rt,{size:16})}),e.jsx("button",{onClick:ue,disabled:c,title:X?"Unarchive":"Archive",style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:X?"rgba(99, 102, 241, 0.3)":"rgba(0,0,0,0.4)",border:"none",color:X?"#6366f1":"rgba(255,255,255,0.7)",cursor:"pointer"},children:X?e.jsx(Ft,{size:16}):e.jsx(Mt,{size:16})}),e.jsx("button",{onClick:ie,disabled:c,title:"Delete",style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",border:"none",color:"#ef4444",cursor:"pointer"},children:e.jsx(ke,{size:16})})]})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:8,minHeight:0,padding:"12px 14px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#fff",lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:te}),t.beatmap_version&&(r==null?void 0:r.title)&&e.jsxs("div",{style:{fontSize:12,color:"rgba(255,255,255,0.7)",marginTop:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["[",t.beatmap_version,"]"]})]}),t.message&&e.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.65)",lineHeight:1.4,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.message})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,justifyContent:"space-between",padding:"12px 14px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:26,height:26,alt:t.username,style:{borderRadius:"50%",flexShrink:0}}),e.jsx("span",{style:{fontSize:13,color:"rgba(255,255,255,0.85)",whiteSpace:"nowrap"},children:t.username}),A&&A.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:[A.slice(0,3).map((u,I)=>u.avatar_url?e.jsx("img",{src:u.avatar_url,alt:u.username,title:u.username,width:20,height:20,style:{borderRadius:"50%",border:"2px solid rgba(0,0,0,0.5)",marginLeft:I>0?-6:0,zIndex:A.length-I,position:"relative"}},u.user_id):e.jsx("div",{title:u.username,style:{width:20,height:20,borderRadius:"50%",border:"2px solid rgba(0,0,0,0.5)",marginLeft:I>0?-6:0,zIndex:A.length-I,position:"relative",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:600,color:"#fff"},children:u.username.charAt(0).toUpperCase()},u.user_id)),A.length>3&&e.jsxs("div",{style:{width:20,height:20,borderRadius:"50%",border:"2px solid rgba(0,0,0,0.5)",marginLeft:-6,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:600,color:"#fff",zIndex:0,position:"relative"},title:`+${A.length-3} more`,children:["+",A.length-3]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:[(r==null?void 0:r.bpm)&&e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:5,padding:"5px 10px",fontSize:12,fontWeight:600,background:"rgba(255,255,255,0.15)",color:"#fff"},children:[Math.round(r.bpm)," BPM"]}),(r==null?void 0:r.length)&&e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:5,padding:"5px 10px",fontSize:12,fontWeight:600,background:"rgba(255,255,255,0.15)",color:"#fff"},children:[e.jsx(Lt,{size:12}),is(r.length)]}),t.beatmap_url&&e.jsxs("button",{ref:C,onClick:u=>{u.preventDefault(),u.stopPropagation(),k(I=>!I)},title:"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:5,padding:"5px 10px",background:"rgba(255,255,255,0.15)",border:"none",color:"#fff",fontSize:12,cursor:"pointer",flexShrink:0},children:[e.jsx(Ke,{size:14}),e.jsx(Me,{size:12})]})]})]})]})]}),w&&v&&t.beatmap_url&&ge.createPortal(e.jsxs("div",{ref:h,style:{position:"fixed",top:v.top,left:v.left,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",padding:4,zIndex:1e4,minWidth:140,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:u=>u.stopPropagation(),children:[e.jsxs("a",{href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>k(!1),style:{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",fontSize:12,color:"var(--text)",textDecoration:"none"},children:[e.jsx(Ke,{size:14}),"osu.ppy.sh"]}),Q&&e.jsx("button",{onClick:()=>{b(!0),k(!1)},style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"8px 10px",fontSize:12,color:"var(--text)",background:"transparent",border:"none",cursor:"pointer",textAlign:"left"},children:"Preview"})]}),document.body),F&&Q&&e.jsx($t,{open:F,onClose:()=>b(!1),downloadUrl:`${gt}${z.osu.downloadBeatmapset(Q)}`,beatmapId:N??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}const ot=["modding","timing","audio"],Re=["nominator","subdivision"];function Te(){return he({queryKey:["moddi","queues"],queryFn:async()=>{const t=await T(z.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function bt(){const t=be();return Ce({mutationFn:async s=>{var i;return await T(z.moddi.queues,{method:"POST",body:JSON.stringify({name:s.name.trim(),description:((i=s.description)==null?void 0:i.trim())||null,is_group:s.is_group??!1,type:s.type||"modder",tags:s.tags||"modding"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function Ee({open:t,onClose:s,children:i}){const d=l.useRef(null),a=l.useRef(null),o=l.useRef(!1),c=r=>{var x;a.current=((x=r.touches[0])==null?void 0:x.clientY)??null,o.current=!1},f=r=>{var N,_;if(a.current==null)return;const x=((N=r.touches[0])==null?void 0:N.clientY)??null;if(x==null)return;const m=x-a.current;(((_=d.current)==null?void 0:_.scrollTop)??0)<=0&&m>60?o.current=!0:o.current=!1},y=()=>{o.current&&s(),a.current=null,o.current=!1};if(!t)return null;const S=e.jsx("div",{className:"mobile-upload-overlay",onClick:s,children:e.jsx("div",{ref:d,className:"mobile-upload-sheet",onClick:r=>r.stopPropagation(),onTouchStart:c,onTouchMove:f,onTouchEnd:y,children:i})});return ge.createPortal(S,document.body)}function rs({queueId:t,onSubmitted:s}){const[i,d]=K.useState(!1),[a,o]=K.useState(t),[c,f]=K.useState(""),[y,S]=K.useState(""),[r,x]=K.useState(!1),{notify:m}=le(),{data:R=[]}=Te();K.useEffect(()=>{o(t)},[t]);const N=async()=>{if(!a){m("Please select a queue",{variant:"error"});return}if(!c.trim()){m("Beatmap URL is required",{variant:"error"});return}x(!0);try{await T(z.moddi.queueSubmit(a),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:y.trim()||null})}),m("Submission created!",{variant:"success"}),f(""),S(""),d(!1),s==null||s()}catch(_){m((_==null?void 0:_.message)||"Failed to create submission",{variant:"error"})}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>d(!0),children:e.jsx(fe,{size:22})}),e.jsx(Ee,{open:i,onClose:()=>d(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:a??"",onChange:_=>o(_.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),R.map(_=>e.jsx("option",{value:String(_.id),children:_.name},_.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:_=>f(_.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:y,onChange:_=>S(_.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),y.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[y.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:r,onClick:N,children:r?"Submitting...":"Submit"})]})]})})]})}const xt=({context:t})=>{const s=At(),{tagFilters:i,setTagFilters:d,queueTypeFilters:a,setQueueTypeFilters:o,queueStatusFilters:c,setQueueStatusFilters:f}=Be(),y=K.useMemo(()=>{if(t)return t;const w=s.pathname;return w==="/feed"?"unified-feed":w==="/mp/feed"?"mappi-feed":w==="/md/feed"?"moddi-feed":w==="/queues"||w==="/md/queues"?"moddi-queues":w.startsWith("/queues/")||w.startsWith("/md/queues/")?"moddi-queue-detail":"unified-feed"},[t,s.pathname]),S=w=>{const k={...i,[w]:!i[w]};!k.untagged&&!k.help&&!k.showcase&&!k.request&&(k.untagged=!0),d(k);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},r=w=>{const k={...a,[w]:!a[w]};!k.modder&&!k.nominator&&!k.timing&&!k.audio&&(k.modder=!0),o(k)},x=w=>{const k={...c,[w]:!c[w]};["unchecked","accepted","denied","finished"].some(b=>k[b])||(k.unchecked=!0),f(k)},m=({active:w,onClick:k,label:F})=>e.jsx("button",{type:"button",onClick:k,className:"desktop-filter-chip","aria-pressed":w,"data-active":w,children:F}),R=y==="unified-feed"||y==="moddi-feed",N=y==="moddi-queues",_=y==="moddi-queue-detail";return e.jsxs("div",{className:"desktop-filter-bar",children:[R&&e.jsxs(e.Fragment,{children:[e.jsx(m,{active:i.untagged,onClick:()=>S("untagged"),label:"untagged"}),e.jsx(m,{active:i.help,onClick:()=>S("help"),label:"help"}),e.jsx(m,{active:i.showcase,onClick:()=>S("showcase"),label:"showcase"}),e.jsx(m,{active:i.request,onClick:()=>S("request"),label:"request"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx(m,{active:a.modder,onClick:()=>r("modder"),label:"modding"}),e.jsx(m,{active:a.nominator,onClick:()=>r("nominator"),label:"bn/subdivision"}),e.jsx(m,{active:a.timing,onClick:()=>r("timing"),label:"timing"}),e.jsx(m,{active:a.audio,onClick:()=>r("audio"),label:"audio"})]}),_&&e.jsxs(e.Fragment,{children:[e.jsx(m,{active:c.unchecked,onClick:()=>x("unchecked"),label:"pending"}),e.jsx(m,{active:c.accepted,onClick:()=>x("accepted"),label:"accepted"}),e.jsx(m,{active:c.denied,onClick:()=>x("denied"),label:"denied"}),e.jsx(m,{active:c.finished,onClick:()=>x("finished"),label:"finished"})]})]})};function Ae({tabs:t,activeTab:s,onChange:i,rightAction:d,style:a}){return e.jsxs("div",{className:"tab-header",style:{display:"flex",background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",position:"relative",...a},children:[t.map((o,c)=>{const f=o.id===s,y=c===t.length-1;return e.jsxs("button",{onClick:()=>i(o.id),style:{flex:1,padding:"14px 16px",background:"transparent",border:"none",borderRight:!y||d?"1px solid rgba(255,255,255,0.08)":"none",color:f?"var(--text)":"var(--muted)",fontWeight:f?600:400,fontSize:14,fontFamily:"inherit",cursor:"pointer",transition:"all 0.15s ease",position:"relative"},onMouseEnter:S=>{f||(S.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:S=>{S.currentTarget.style.backgroundColor="transparent"},children:[o.label,f&&e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:"var(--accent, #667eea)",borderRadius:"2px 2px 0 0"}})]},o.id)}),d&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:d})]})}function as({isOpen:t,onClose:s,onSubmitted:i,queueId:d,isQueueOpen:a,anchorRef:o,rules:c}){const{notify:f}=le(),[y,S]=l.useState(""),[r,x]=l.useState(""),[m,R]=l.useState(!1),[N,_]=l.useState(!1),w=l.useRef(null);l.useEffect(()=>{if(!t)return;const F=b=>{const v=b.target;if(w.current&&!w.current.contains(v)&&(o!=null&&o.current)&&!o.current.contains(v)){const M=document.getElementById("rules-modal-overlay");if(M&&M.contains(v))return;s()}};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[t,s,o]);const k=async F=>{if(F.preventDefault(),!a){f("Queue is closed for submissions",{variant:"error"});return}if(!y.trim()){f("Beatmap URL is required",{variant:"error"});return}R(!0);try{await T(z.moddi.queueSubmit(d),{method:"POST",body:JSON.stringify({beatmap_url:y.trim(),message:r.trim()||null})}),f("Submission created!",{variant:"success"}),s(),S(""),x(""),i()}catch(b){f((b==null?void 0:b.message)||"Failed to create submission",{variant:"error"})}finally{R(!1)}};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:w,className:"submit-beatmap-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:a?e.jsx("form",{onSubmit:k,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:y,onChange:F=>S(F.target.value),required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:r,onChange:F=>x(F.target.value.slice(0,100)),maxLength:100,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),r.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right"},children:[r.length,"/100"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:4},children:[c?e.jsx("button",{type:"button",onClick:()=>_(!0),style:{background:"transparent",border:"none",padding:0,color:"var(--text)",fontSize:13,textDecoration:"underline",cursor:"pointer",opacity:.8},children:"Rules"}):e.jsx("div",{}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m||!y.trim(),style:{background:y.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:y.trim()?"pointer":"not-allowed"},children:m?"Submitting...":"Submit"})]})]})]})}):e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"This queue is currently closed for submissions."})})}),N&&c&&e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>_(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>_(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6,whiteSpace:"pre-wrap"},children:c})]})})]}):null}const lt={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},os=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Wt,{components:{p:({children:s})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:s}),ul:({children:s})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),ol:({children:s})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),li:({children:s})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:s}),strong:({children:s})=>e.jsx("strong",{style:{fontWeight:600},children:s}),em:({children:s})=>e.jsx("em",{children:s}),code:({children:s})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:s}),h1:({children:s})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:s}),h2:({children:s})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:s}),h3:({children:s})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:s})},children:t})});function js(){var Ge;const{id:t}=Bt(),s=dt(),[i,d]=l.useState(null),[a,o]=l.useState([]),[c,f]=l.useState([]),[y,S]=l.useState(!0),[r,x]=l.useState(null),[m,R]=l.useState(!1),N=l.useRef(null),[_,w]=l.useState(null),[k,F]=l.useState(!1),[b,v]=l.useState(""),[M,P]=l.useState(""),[q,A]=l.useState(""),[O,U]=l.useState("modder"),[Y,D]=l.useState(!1),[h,C]=l.useState(!1),[g,B]=l.useState("general"),[G,ue]=l.useState(!1),[ie,V]=l.useState(!1),[Z,ee]=l.useState(null),[Q,re]=l.useState(""),[X,te]=l.useState([]),[ne,H]=l.useState(!1),u=l.useRef(null),I=l.useRef(null),W=l.useRef(null),[$,xe]=l.useState([]),[pe,J]=l.useState(!1),[De,Oe]=l.useState(null),[ze,yt]=l.useState("active"),[vt,ye]=l.useState(!1),[We,Pe]=l.useState(!1),[Qe,qe]=l.useState(0),ve=l.useRef(null),{notify:E}=le(),{queueStatusFilters:je}=Be(),ae=async()=>{var n,p;if(t){S(!0);try{const j=await T(z.moddi.queue(t),{requireAuth:!1});d(j.queue||null),o(j.members||[]),f(j.submissions||[])}catch(j){(n=j==null?void 0:j.message)!=null&&n.includes("403")||(p=j==null?void 0:j.message)!=null&&p.includes("Forbidden")?(E("You do not have access to this queue",{variant:"error"}),s("/queues")):E("Failed to load queue",{variant:"error"})}finally{S(!1)}}};l.useEffect(()=>{ae(),T(z.auth.me,{requireAuth:!1}).then(n=>x(n)).catch(()=>{})},[t]);const de=r&&i&&(i.owner_id===r.id||a.some(n=>n.user_id===r.id&&n.joined_at)||r.is_mod||r.is_admin),jt=r&&a.some(n=>n.user_id===r.id&&n.joined_at),$e=r&&i&&(i.owner_id===r.id||a.some(n=>n.user_id===r.id&&n.joined_at)),Ue=n=>{f(p=>p.map(j=>j.id===n.id?n:j)),n.acknowledged_by_me!==void 0&&ae()},St=()=>{i&&(v(i.name),P(i.description||""),A(i.rules||""),U(i.type||"modder"),F(!0),B("general"))},Se=()=>{F(!1),v(""),P(""),A(""),U("modder"),ye(!1)},He=async()=>{if(!(!i||!$e)){C(!0);try{const n=i.is_open!==1;await T(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:n})}),E(`Queue ${n?"opened":"closed"} `,{variant:"success"}),ae()}catch(n){E((n==null?void 0:n.message)||"Failed to update status",{variant:"error"})}finally{C(!1)}}},Ye=async n=>{if(n.preventDefault(),!i||!b.trim()){E("Queue name is required",{variant:"error"});return}ue(!0);try{const p=a.filter(L=>L.user_id!==i.owner_id&&L.role!=="owner").length>0,j={name:b.trim(),description:M.trim()||null,rules:q.trim()||null,is_group:p};(r!=null&&r.is_mod||r!=null&&r.is_admin)&&(j.type=O),await T(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify(j)}),E("Queue updated!",{variant:"success"}),Se(),ae()}catch(p){E((p==null?void 0:p.message)||"Failed to update queue",{variant:"error"})}finally{ue(!1)}};l.useEffect(()=>{if(!Q.trim()){te([]),H(!1);return}const n=setTimeout(async()=>{try{const j=(await T(z.moddi.usersSearch(Q),{requireAuth:!1})).items||[];te(j),H(j.length>0)}catch(p){console.error("Search failed:",p),te([]),H(!1)}},300);return()=>clearTimeout(n)},[Q]);const wt=async n=>{if(!ie){V(!0);try{await T(z.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:n})}),E("Invite sent!",{variant:"success"}),re(""),te([]),H(!1),ae()}catch(p){E((p==null?void 0:p.message)||"Failed to invite member",{variant:"error"})}finally{V(!1)}}},Ie=async()=>{if(!(!t||!de))try{const n=await T(z.moddi.queueBlockedUsers(t));xe(n.blocked||[])}catch(n){console.error("Failed to load blocked users:",n)}},kt=async n=>{if(!(!t||pe)&&confirm("Block this user from submitting to this queue?")){J(!0);try{await T(z.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:n})}),E("User blocked",{variant:"success"}),Ie(),re(""),te([]),H(!1)}catch(p){E((p==null?void 0:p.message)||"Failed to block user",{variant:"error"})}finally{J(!1)}}},Je=async n=>{if(!(!t||De===n)){Oe(n);try{await T(z.moddi.queueUnblockUser(t,n),{method:"DELETE"}),E("User unblocked",{variant:"success"}),Ie()}catch(p){E((p==null?void 0:p.message)||"Failed to unblock user",{variant:"error"})}finally{Oe(null)}}};l.useEffect(()=>{g==="members"&&de&&t&&Ie()},[g,de,t]);const _t=async()=>{if(i&&confirm(`Are you sure you want to delete "${i.name}" ? This action cannot be undone.`)){D(!0);try{await T(z.moddi.queue(t),{method:"DELETE"}),E("Queue deleted",{variant:"success"}),s("/queues")}catch(n){E((n==null?void 0:n.message)||"Failed to delete queue",{variant:"error"})}finally{D(!1)}}},Ct=async n=>{if(!r||!i||r.id!==i.owner_id){E("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){ee(n);try{await T(z.moddi.queueMember(t,n),{method:"DELETE"}),E("Member removed",{variant:"success"});const j=a.filter(L=>L.user_id!==n).some(L=>L.user_id!==(i==null?void 0:i.owner_id)&&L.role!=="owner");if(i&&i.is_group===1&&!j)try{await T(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}ae()}catch(p){E((p==null?void 0:p.message)||"Failed to remove member",{variant:"error"})}finally{ee(null)}}},Nt=async()=>{if(r&&confirm("Leave this queue? You will need to be invited again to rejoin.")){ee(r.id);try{await T(z.moddi.queueMember(t,r.id),{method:"DELETE"}),E("Left queue",{variant:"success"});const p=a.filter(j=>j.user_id!==r.id).some(j=>j.user_id!==(i==null?void 0:i.owner_id)&&j.role!=="owner");if(i&&i.is_group===1&&!p)try{await T(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}s("/queues")}catch(n){E((n==null?void 0:n.message)||"Failed to leave queue",{variant:"error"})}finally{ee(null)}}},Tt=async n=>{var j;const p=(j=n.target.files)==null?void 0:j[0];if(!(!p||!t)){Pe(!0),qe(0);try{const L=await T(z.moddi.queueBannerImageUpload(t),{method:"POST"}),se=L.uploadURL,zt=L.imageID,ce=new XMLHttpRequest;ce.open("POST",se,!0),ce.upload.onprogress=oe=>{if(oe.lengthComputable){const we=Math.round(oe.loaded/oe.total*100);qe(we)}},await new Promise((oe,we)=>{ce.onload=()=>{ce.status>=200&&ce.status<300?oe():we(new Error("Upload failed"))},ce.onerror=()=>we(new Error("Network error"));const Xe=new FormData;Xe.append("file",p),ce.send(Xe)});const qt=await T(z.moddi.queueBannerImageConfirm(t),{method:"POST",body:JSON.stringify({imageID:zt})});d(oe=>oe?{...oe,banner_stream_uid:qt.banner_stream_uid}:null),E("Banner updated!",{variant:"success"})}catch(L){console.error(L),E(L.message||"Banner upload failed",{variant:"error"})}finally{Pe(!1),qe(0),ve.current&&(ve.current.value="")}}};return l.useEffect(()=>{if(!k)return;const n=p=>{var L;const j=p.target;(L=document.getElementById("rules-modal-overlay"))!=null&&L.contains(j)||j.closest(".manage-overlay")||j.closest(".manage-overlay-backdrop")||!j.closest(".manage-popup")&&W.current&&!W.current.contains(j)&&Se()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[k]),l.useEffect(()=>{if(!ne)return;const n=p=>{const j=p.target;u.current&&!u.current.contains(j)&&I.current&&!I.current.contains(j)&&H(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[ne]),y?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):i?e.jsxs("div",{className:"feed-container queue-detail-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0,minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t&&e.jsx(rs,{queueId:t,onSubmitted:()=>ae()}),e.jsx(xt,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"queue-detail-header",style:{background:"var(--panel)",borderBottom:"1px solid var(--divider)",position:"relative"},children:[e.jsxs("div",{style:{height:120,background:"var(--panel)",width:"100%",position:"relative",overflow:"hidden"},children:[i.banner_stream_uid?i.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:i.banner_stream_uid.slice(4),alt:"Banner",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("video",{src:`https://videodelivery.net/${i.banner_stream_uid}/manifest/video.m3u8`,poster:`https://videodelivery.net/${i.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),We&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:20,backdropFilter:"blur(4px)"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#fff",marginBottom:8},children:["Uploading... ",Qe,"%"]}),e.jsx("div",{style:{width:"60%",height:4,background:"rgba(255,255,255,0.2)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${Qe}%`,height:"100%",background:"#fff",transition:"width 0.1s ease"}})})]}),e.jsx(_e,{to:"/queues",style:{position:"absolute",top:12,left:12,width:36,height:36,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",color:"#fff",zIndex:10},title:"Back to queues",children:e.jsx(Et,{size:18})}),de&&e.jsxs("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8,zIndex:10},children:[e.jsx("input",{ref:ve,type:"file",accept:"image/*",style:{display:"none"},onChange:Tt}),e.jsxs("button",{className:"btn secondary",onClick:()=>{var n;return(n=ve.current)==null?void 0:n.click()},disabled:We,style:{padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff"},title:i.banner_stream_uid?"Change Banner":"Add Banner",children:[e.jsx(fe,{size:14,style:{marginRight:6}}),i.banner_stream_uid?"Edit":"Add Banner"]}),e.jsxs("button",{ref:W,className:"btn secondary",onClick:St,style:{padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff"},title:"Manage Queue",children:[e.jsx(Dt,{size:14,style:{marginRight:6}}),"Manage"]})]}),e.jsxs("div",{style:{position:"absolute",bottom:12,right:16,display:"flex",gap:8,alignItems:"center",zIndex:10},children:[(()=>{const n=(i.tags||i.type||"modding").split(",")[0].trim().toLowerCase(),p=n==="modder"?"modding":n==="subdivisions"?"subdivision":n;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)"},children:p})})(),$e?e.jsx("button",{onClick:He,disabled:h,className:`queue - status - badge ${i.is_open===1?"status-open":"status-closed"} `,title:i.is_open===1?"Close queue":"Open queue","aria-label":i.is_open===1?"Close queue":"Open queue",style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:i.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:i.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",cursor:"pointer",display:"flex",alignItems:"center"},children:i.is_open===1?"Open":"Closed"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:i.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:i.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",display:"inline-flex",alignItems:"center"},children:i.is_open===1?"Open":"Closed"})]})]}),e.jsxs("div",{style:{padding:"0 16px 16px",position:"relative"},children:[e.jsx("div",{style:{marginTop:-32,marginBottom:12,display:"flex",alignItems:"flex-end",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.filter(n=>n.joined_at!==null).sort((n,p)=>{const j=n.role==="owner"||n.user_id===(i==null?void 0:i.owner_id),L=p.role==="owner"||p.user_id===(i==null?void 0:i.owner_id);return j&&!L?-1:!j&&L?1:(p.joined_at||0)-(n.joined_at||0)}).slice(0,5).map((n,p)=>e.jsxs("div",{style:{position:"relative",marginLeft:p>0?-12:0,zIndex:10-p},onMouseEnter:()=>w(n.user_id),onMouseLeave:()=>w(null),children:[e.jsx(_e,{to:`/ profile / ${n.user_id} `,style:{display:"block",width:p===0?64:40,height:p===0?64:40,borderRadius:"50%",overflow:"hidden",border:"3px solid var(--panel)",background:"var(--bg)"},title:n.username,children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:p===0?24:14,fontWeight:600,color:"var(--muted)"},children:n.username.charAt(0).toUpperCase()})}),_===n.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[n.username," ",n.role!=="member"?`(${n.role})`:""]})]},n.user_id)),a.filter(n=>n.joined_at!==null).length>5&&e.jsxs("div",{style:{width:40,height:40,borderRadius:"50%",border:"3px solid var(--panel)",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,color:"var(--muted)",marginLeft:-12,zIndex:0},children:["+",a.filter(n=>n.joined_at!==null).length-5]})]})}),e.jsxs("div",{className:"col",style:{gap:2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[i.is_group?e.jsx(ct,{size:18,style:{color:"var(--muted)"}}):e.jsx(me,{size:18,style:{color:"var(--muted)"}}),e.jsx("h1",{style:{fontSize:20,fontWeight:700,margin:0},children:i.name})]}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["by ",i.owner_username||((Ge=a.find(n=>n.user_id===i.owner_id))==null?void 0:Ge.username)||"Unknown"," • ",new Date(i.created_at*1e3).toLocaleDateString()]}),i.description&&e.jsx("div",{style:{fontSize:14,lineHeight:1.5,marginTop:8},children:e.jsx(ht,{text:i.description})})]})]}),e.jsx(Ae,{tabs:[{id:"active",label:"Active"},{id:"archived",label:"Archived"}],activeTab:ze,onChange:n=>yt(n),rightAction:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:N,onClick:()=>R(!m),style:{width:48,height:"100%",minHeight:48,background:m?"rgba(255,255,255,0.05)":"transparent",border:"none",color:i.is_open===1?"var(--text)":"var(--muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s",opacity:i.is_open===0?.5:1},onMouseEnter:n=>{m||(n.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:n=>{m||(n.currentTarget.style.backgroundColor="transparent")},title:i.is_open===1?"Submit a beatmap":"Queue is closed",children:e.jsx(fe,{size:18})}),t&&e.jsx(as,{isOpen:m,onClose:()=>R(!1),onSubmitted:()=>ae(),queueId:t,isQueueOpen:i.is_open===1,anchorRef:N,rules:i.rules})]})})]}),i.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{className:"feed-list-wrapper",style:{background:"var(--panel)",paddingBottom:"60px",flex:1},children:[ze==="active"&&e.jsx(e.Fragment,{children:c.filter(n=>!!!n.is_archived&&je[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):e.jsx("div",{className:"queue-submissions-grid",children:c.filter(n=>!!!n.is_archived&&je[n.status]).map(n=>e.jsx(Le,{submission:n,canManage:!!de,isGroup:(i==null?void 0:i.is_group)===1,onUpdate:Ue,onDelete:p=>{f(j=>j.filter(L=>L.id!==p))}},n.id))})}),ze==="archived"&&e.jsx(e.Fragment,{children:c.filter(n=>!!n.is_archived&&je[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):e.jsx("div",{className:"queue-submissions-grid",children:c.filter(n=>!!n.is_archived&&je[n.status]).map(n=>e.jsx(Le,{submission:n,canManage:!!de,isGroup:(i==null?void 0:i.is_group)===1,onUpdate:Ue,onDelete:p=>{f(j=>j.filter(L=>L.id!==p))}},n.id))})})]}),k&&ge.createPortal(e.jsx("div",{className:"manage-overlay-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",backdropFilter:"blur(5px)",zIndex:9998,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:Se,children:e.jsxs("div",{className:"manage-popup",style:{width:"100%",maxWidth:"800px",height:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",borderRadius:0},onClick:n=>n.stopPropagation(),children:[e.jsx(Ae,{tabs:[{id:"general",label:"General"},{id:"rules",label:"Rules"},{id:"members",label:"Members"}],activeTab:g,onChange:n=>B(n),style:{borderBottom:"1px solid var(--divider)"}}),e.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:e.jsxs("form",{onSubmit:Ye,style:{display:"flex",flexDirection:"column",flex:1},children:[g==="general"&&e.jsxs("div",{className:"col",style:{gap:20,padding:24},children:[e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Name"}),e.jsx("input",{type:"text",value:b,onChange:n=>v(n.target.value),placeholder:"e.g. My Modding Queue",required:!0,style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Short Description"}),e.jsx("input",{type:"text",value:M,onChange:n=>P(n.target.value),placeholder:"Brief description of your queue...",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),((r==null?void 0:r.is_mod)||(r==null?void 0:r.is_admin))&&e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:["modder","nominator","timing","audio","subdivision"].map(n=>{const p=O===n,j=lt[n==="modder"?"modding":n]||lt.modding;return e.jsx("button",{type:"button",onClick:()=>U(n),style:{background:p?j.bg:"transparent",border:p?j.border:"1px solid var(--border)",color:p?j.color:"var(--muted)",padding:"8px 16px",borderRadius:0,fontSize:13,fontWeight:p?600:400,cursor:"pointer",textTransform:"capitalize",transition:"all 0.15s ease"},children:n},n)})})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",border:"1px solid var(--border)",marginTop:8},children:[e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:"Queue Status"}),e.jsx("div",{className:"muted",style:{fontSize:13},children:i.is_open?"Queue is currently open for submissions":"Queue is currently closed"})]}),e.jsx("button",{type:"button",onClick:He,disabled:h,className:`btn ${i.is_open?"secondary":"primary"}`,style:{borderRadius:0},children:i.is_open?"Close Queue":"Open Queue"})]})]}),g==="rules"&&e.jsxs("div",{className:"col",style:{gap:12,padding:24,flex:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between"},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Rules (Markdown)"}),e.jsx("button",{type:"button",onClick:()=>ye(!0),className:"btn secondary",style:{fontSize:11,padding:"4px 8px",height:"auto",borderRadius:0},children:"Preview Rules"})]}),e.jsx("textarea",{value:q,onChange:n=>A(n.target.value),placeholder:"Enter your queue rules here... Markdown is supported.",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"none",flex:1,lineHeight:1.6}})]}),g==="members"&&e.jsxs("div",{className:"col",style:{gap:20,padding:24},children:[e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{className:"row",style:{gap:0},children:[e.jsx("div",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--muted)",pointerEvents:"none"},children:e.jsx(ut,{})}),e.jsx("input",{ref:u,type:"text",placeholder:"Search by username or ID...",value:Q,onChange:n=>re(n.target.value),onFocus:()=>{X.length>0&&H(!0)},style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px 10px 36px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),ne&&X.length>0&&e.jsx("div",{ref:I,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:-1,background:"var(--bg)",border:"1px solid var(--border)",borderTop:"none",maxHeight:250,overflowY:"auto",zIndex:100},children:X.map(n=>{const p=a.some(se=>se.user_id===n.id&&se.joined_at),j=a.some(se=>se.user_id===n.id&&se.invited_at&&!se.joined_at),L=$.some(se=>se.user_id===n.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"8px 12px",gap:10,borderBottom:"1px solid var(--divider)"},children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,style:{width:24,height:24,borderRadius:"50%"}}):e.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"var(--panel)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10},children:n.username[0]}),e.jsxs("div",{className:"col",style:{flex:1,gap:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username}),e.jsxs("div",{className:"muted",style:{fontSize:11},children:["ID: ",n.id]})]}),e.jsxs("div",{className:"row",style:{gap:4},children:[p?e.jsx("span",{className:"badge",style:{fontSize:10,opacity:.6},children:"Member"}):j?e.jsx("span",{className:"badge",style:{fontSize:10,color:"var(--accent)",background:"rgba(var(--accent-rgb), 0.1)"},children:"Invited"}):e.jsx("button",{type:"button",onClick:()=>wt(n.id),disabled:ie,style:{background:"var(--primary)",border:"none",borderRadius:0,padding:"4px 10px",color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"},children:"Invite"}),de&&e.jsx("button",{type:"button",onClick:()=>L?Je(n.id):kt(n.id),disabled:pe||De===n.id,style:{background:"transparent",border:"1px solid var(--border)",padding:4,color:L?"var(--accent)":"var(--muted)",cursor:"pointer",display:"flex"},title:L?"Unblock":"Block",children:L?e.jsx(Ve,{size:12}):e.jsx(Ot,{size:12})})]})]},n.id)})})]})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Current Members"}),e.jsx("div",{className:"col",style:{gap:0,border:"1px solid var(--border)"},children:a.length===0?e.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--muted)",fontSize:13},children:"No members yet"}):a.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"10px 12px",borderBottom:"1px solid var(--divider)",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,style:{width:32,height:32,borderRadius:"50%"}}):e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"var(--panel)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:n.username[0]}),e.jsxs("div",{className:"col",style:{gap:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username}),e.jsxs("div",{className:"muted",style:{fontSize:11,textTransform:"capitalize"},children:[n.role," ",n.invited_at&&!n.joined_at&&"(Pending Invite)"]})]})]}),e.jsx("div",{className:"row",style:{gap:8},children:n.user_id!==(r==null?void 0:r.id)&&(n.role!=="owner"||r.id===i.owner_id)&&e.jsx("button",{type:"button",onClick:()=>Ct(n.user_id),title:"Remove Member",style:{background:"transparent",border:"none",color:"var(--danger)",cursor:"pointer",padding:4},children:e.jsx(ke,{size:16})})})]},n.user_id))})]}),$.length>0&&e.jsxs("div",{className:"col",style:{gap:8,marginTop:10},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Blocked Users"}),e.jsx("div",{className:"col",style:{gap:0,border:"1px solid var(--border)"},children:$.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"10px 12px",borderBottom:"1px solid var(--divider)",justifyContent:"space-between"},children:[e.jsx("div",{className:"row",style:{alignItems:"center",gap:10},children:e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username})}),e.jsx("button",{type:"button",onClick:()=>Je(n.user_id),title:"Unblock",style:{background:"transparent",border:"none",color:"var(--accent)",cursor:"pointer",padding:4},children:e.jsx(Ve,{size:16})})]},n.user_id))})]})]})]})}),e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"1px solid var(--divider)",background:"rgba(255,255,255,0.02)"},children:[e.jsxs("div",{className:"row",style:{gap:12},children:[((r==null?void 0:r.is_mod)||(r==null?void 0:r.is_admin)||i.owner_id===(r==null?void 0:r.id))&&e.jsx("button",{type:"button",onClick:_t,disabled:Y||G,style:{background:"transparent",border:"none",color:"var(--danger)",fontSize:13,fontWeight:600,cursor:"pointer",padding:0},children:"Delete Queue"}),jt&&i.owner_id!==(r==null?void 0:r.id)&&e.jsx("button",{type:"button",onClick:Nt,disabled:Y||G,style:{background:"transparent",border:"none",color:"var(--danger)",fontSize:13,fontWeight:600,cursor:"pointer",padding:0},children:"Leave Queue"})]}),e.jsxs("div",{className:"row",style:{gap:12},children:[e.jsx("button",{type:"button",onClick:Se,disabled:G||Y,style:{background:"transparent",border:"1px solid var(--border)",color:"var(--text)",padding:"8px 20px",fontSize:13,fontWeight:600,cursor:"pointer",borderRadius:0},children:"Cancel"}),e.jsx("button",{type:"button",onClick:n=>{G||Ye({preventDefault:()=>{}})},disabled:G||Y,style:{background:"#667eea",border:"none",color:"#fff",padding:"8px 20px",fontSize:13,fontWeight:600,cursor:"pointer",borderRadius:0},children:G?"Saving...":"Save Changes"})]})]})]})}),document.body),vt&&ge.createPortal(e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>ye(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>ye(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6},children:e.jsx(os,{content:q||"*No rules defined.*"})})]})}),document.body),e.jsx("style",{children:`
/* Hide inline submit form on mobile – mobile uses floating FAB instead */
html.is - mobile.queue - submit - desktop - only {
  display: none;
}

        .queue - member - avatar {
  width: 32px;
  height: 32px;
  border - radius: 9999px;
  padding: 0;
  border: 1px solid rgba(255, 255, 255, 0.08);
  overflow: hidden;
  cursor: pointer;
  background: transparent;
  display: inline - flex;
  align - items: center;
  justify - content: center;
  text - decoration: none;
  transition: border - color 0.2s;
}
        .queue - member - avatar:hover {
  border - color: rgba(167, 139, 250, 0.4);
}
        .queue - member - avatar img {
  width: 100 %;
  height: 100 %;
  object - fit: cover;
  display: block;
}
        .queue - member - tooltip {
  position: absolute;
  bottom: calc(100 % + 8px);
  left: 50 %;
  transform: translateX(-50 %);
  background: rgba(18, 20, 24, 0.95);
  color: var(--text, #e5e7eb);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border - radius: 6px;
  padding: 6px 10px;
  font - size: 14px;
  white - space: nowrap;
  z - index: 10000;
  pointer - events: none;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
}
        .queue - member - tooltip::after {
  content: '';
  position: absolute;
  top: 100 %;
  left: 50 %;
  transform: translateX(-50 %);
  width: 0;
  height: 0;
  border - left: 5px solid transparent;
  border - right: 5px solid transparent;
  border - top: 5px solid rgba(18, 20, 24, 0.95);
}
        .queue - status - badge {
  display: inline - flex;
  align - items: center;
  gap: 6px;
  padding: 6px 12px;
  border - radius: 12px;
  font - size: 12px;
  font - weight: 600;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
  border: 1px solid;
  cursor: pointer;
  transition: all 0.2s;
  white - space: nowrap;
}
        .queue - status - badge:disabled {
  cursor: not - allowed;
  opacity: 0.6;
}
        .queue - status - badge.status - open {
  background: rgba(52, 211, 153, 0.15);
  border - color: rgba(52, 211, 153, 0.4);
  color: #34d399;
}
        .queue - status - badge.status - open: hover: not(: disabled) {
  background: rgba(52, 211, 153, 0.25);
  border - color: rgba(52, 211, 153, 0.5);
}
        .queue - status - badge.status - closed {
  background: rgba(245, 158, 11, 0.15);
  border - color: rgba(245, 158, 11, 0.4);
  color: #f59e0b;
}
        .queue - status - badge.status - closed: hover: not(: disabled) {
  background: rgba(245, 158, 11, 0.25);
  border - color: rgba(245, 158, 11, 0.5);
}

/* Queue Submissions Grid - 2 columns on desktop, 1 on mobile, no gaps */
.queue-submissions-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0;
}

@media (max-width: 600px) {
  .queue-submissions-grid {
    grid-template-columns: 1fr;
  }
}
`})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function Ss(){const{data:t=[],isLoading:s}=es(),i=ts(),d=ss(),{notify:a}=le(),o=dt(),c=be(),[f,y]=l.useState(new Set),{data:S}=Ne(),[r,x]=l.useState(!1),[m,R]=l.useState(!1),[N,_]=l.useState(!1),w=l.useRef(null),k=l.useRef(null),F=!!(S!=null&&S.is_admin||S!=null&&S.is_mod);ns(w,k,r,()=>x(!1));const b=async h=>{i.mutate(h,{onSuccess:()=>{}})},v=async h=>{h.startsWith("n:")&&d.mutate(h)},M=async()=>{const h=t.filter(C=>!C.read&&(C.id.startsWith("n:")||C.kind==="system"&&!C.id.startsWith("b:"))).map(C=>C.id);h.length>0&&(await b(h),a("All notifications marked as read",{variant:"success"}))},P=h=>{if(!h)return null;try{const C=JSON.parse(h);if((C==null?void 0:C.type)==="queue_invite"&&(C!=null&&C.queue_id))return C}catch{}return null},q=async(h,C)=>{if(!f.has(h.id)){y(g=>new Set(g).add(h.id));try{await T(z.moddi.queueAccept(String(C)),{method:"POST"}),a("Invitation accepted!",{variant:"success"}),v(h.id),o(`/queues/${C}`)}catch(g){a((g==null?void 0:g.message)||"Failed to accept invitation",{variant:"error"})}finally{y(g=>{const B=new Set(g);return B.delete(h.id),B})}}},A=async(h,C)=>{if(!f.has(h.id)){y(g=>new Set(g).add(h.id));try{await T(z.moddi.queueDeny(String(C)),{method:"POST"}),a("Invitation declined",{variant:"success"}),v(h.id)}catch(g){a((g==null?void 0:g.message)||"Failed to decline invitation",{variant:"error"})}finally{y(g=>{const B=new Set(g);return B.delete(h.id),B})}}},O=h=>P(h.text)?e.jsx(ut,{size:20,color:"#a78bfa"}):h.kind==="star"?e.jsx(tt,{size:20,color:"#f59e0b"}):h.kind==="likes5"?e.jsx(st,{size:20,color:"#f472b6"}):h.kind==="comment"?e.jsx(me,{size:20,color:"#60a5fa"}):h.kind==="inspiration"?e.jsx(me,{size:20,color:"#7dd3fc"}):h.kind==="reaction"?e.jsx(nt,{size:20,color:"#10b981"}):h.id.startsWith("b:")?e.jsx(it,{size:20,color:"#a78bfa"}):null,U=h=>P(h.text)?"Queue Invitation":h.kind==="star"?"Star":h.kind==="likes5"?"Likes":h.kind==="comment"?"Comment":h.kind==="inspiration"?"Inspiration":h.kind==="reaction"?"Reaction":h.id.startsWith("b:")?"Global":"System",Y=t.filter(h=>!h.read&&!(h.id.startsWith("b:")&&h.expiresAt&&h.expiresAt<=Date.now())).length,D=async h=>{if(!(!(S!=null&&S.id)||N)){_(!0);try{const C={kind:h};h==="system"&&(C.text="Test system notification"),await T(z.admin.notificationsTest,{method:"POST",body:JSON.stringify(C)}),a("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(C){a((C==null?void 0:C.message)||"Failed to send test notification",{variant:"error"})}finally{_(!1),x(!1),R(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[F&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:w,className:"btn secondary",onClick:()=>x(!r),disabled:N,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Ze,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(Me,{size:14,style:{transition:"transform 0.2s ease",transform:r?"rotate(180deg)":"rotate(0deg)"}})]}),r&&e.jsxs("div",{ref:k,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("star"),disabled:N,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("likes5"),disabled:N,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("comment"),disabled:N,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("inspiration"),disabled:N,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("reaction"),disabled:N,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("system"),disabled:N,children:"Test System"})]})]}),Y>0&&e.jsxs("button",{className:"btn secondary",onClick:M,children:[e.jsx(et,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),F&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>R(!0),children:e.jsx(Ze,{size:22})}),e.jsx(Ee,{open:m,onClose:()=>R(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>D("star"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(tt,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("likes5"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(st,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("comment"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(me,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("inspiration"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(me,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("reaction"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(nt,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("system"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(it,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(h=>!(h.id.startsWith("b:")&&h.expiresAt&&h.expiresAt<=Date.now())).map(h=>{const C=({notif:g})=>{const[B,G]=l.useState(0),[ue,ie]=l.useState(!1),V=l.useRef(null),Z=l.useRef(null),ee=l.useRef(null),Q=l.useRef(null),re=u=>{g.id.startsWith("n:")&&(V.current=u.touches[0].clientX,Q.current=u.touches[0].clientY,Z.current=Date.now(),ie(!1))},X=u=>{if(V.current===null||Q.current===null||!g.id.startsWith("n:"))return;const I=u.touches[0].clientX,W=u.touches[0].clientY,$=I-V.current,xe=Math.abs(W-Q.current);Math.abs($)>xe&&(ie(!0),G(Math.max(-80,Math.min(0,$))))},te=()=>{if(V.current===null)return;B<=-60&&v(g.id),G(0),ie(!1),V.current=null,Q.current=null,Z.current=null},ne=g.id.startsWith("n:"),H=typeof g.targetPath=="string"&&g.targetPath.trim().length>0?g.targetPath.trim():null;return e.jsxs("div",{ref:ee,style:{position:"relative",background:g.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:H?"pointer":"default",opacity:g.read?.7:1,transform:`translateX(${B}px)`,transition:ue?"none":"transform 0.2s ease",touchAction:ne?"pan-x pan-y":"pan-y"},onTouchStart:re,onTouchMove:X,onTouchEnd:te,onTouchCancel:te,onClick:()=>{if(!(Math.abs(B)>10)){if(!g.read&&g.id.startsWith("n:")&&b([g.id]),H){o(H);return}g.videoId&&(window.location.hash="/feed")}},children:[ne&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(B)/80,pointerEvents:"none",zIndex:0},children:e.jsx(ke,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:O(g)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:U(g)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(g.createdAt).toLocaleDateString()}),g.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:u=>{u.stopPropagation(),v(g.id)},style:{padding:4},children:e.jsx(ke,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const u=P(g.text);return u?`${u.inviter_username} invited you to join queue: ${u.queue_name}`:g.text||(g.kind==="star"?"One of your posts was starred!":g.kind==="likes5"?"One of your posts reached 5 likes!":g.kind==="comment"?"Someone commented on your post":g.kind==="inspiration"?"Someone is inspired by you!":g.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const u=P(g.text);return u&&!f.has(g.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:I=>{I.stopPropagation(),q(g,u.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(et,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:I=>{I.stopPropagation(),A(g,u.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Pt,{size:14,style:{marginRight:4}}),"Decline"]})]}):u&&f.has(g.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),g.read&&g.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(g.readAt).toLocaleString()]})]})]})]},g.id)};return e.jsx(C,{notif:h},h.id)})})})]})}const Fe={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"},subdivisions:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},ls=["nominator","subdivision","subdivisions"];function ds({queue:t}){const i=(t.tags||t.type||"modding").split(",").map(o=>o.trim().toLowerCase()).filter(Boolean).map(o=>o==="modder"?"modding":o==="subdivisions"?"subdivision":o),d=i.find(o=>ls.includes(o)),a=d?[d==="subdivisions"?"subdivision":d]:i.filter(o=>Fe[o]);return e.jsx(_e,{to:`/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:o=>o.currentTarget.style.background="rgba(255,255,255,0.04)",onMouseLeave:o=>o.currentTarget.style.background="var(--panel)",children:[t.banner_stream_uid&&e.jsxs("div",{style:{position:"absolute",inset:0,zIndex:0,opacity:.12,pointerEvents:"none",overflow:"hidden"},children:[t.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:t.banner_stream_uid.slice(4),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("img",{src:`https://videodelivery.net/${t.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to bottom, transparent, var(--panel))"}})]}),e.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:4,flexWrap:"wrap",justifyContent:"flex-end",maxWidth:"50%"},children:[a.map(o=>{const c=Fe[o]||Fe.modding;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:c.bg,color:c.color,border:c.border},children:o},o)}),(t.is_open??1)===1?e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(16, 185, 129, 0.12)",color:"#10b981",border:"1px solid rgba(16, 185, 129, 0.2)"},children:"Open"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(239, 68, 68, 0.12)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)"},children:"Closed"})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(ct,{size:18}):e.jsx(me,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(ht,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12,position:"relative",zIndex:1},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const o=t.member_count||0;return o===0?null:o===1&&t.first_member_username?` and ${t.first_member_username}`:o>1?` & ${o} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function cs({isOpen:t,onClose:s,anchorRef:i}){const{notify:d}=le(),{data:a}=Ne(),{data:o=[]}=Te(),c=bt(),[f,y]=l.useState(""),[S,r]=l.useState(""),[x,m]=l.useState(["modding"]),R=l.useRef(null),N=a?o.some(b=>b.owner_id===a.id):!1,_=(a==null?void 0:a.is_admin)||(a==null?void 0:a.is_mod);l.useEffect(()=>{if(!t)return;const b=v=>{const M=v.target;R.current&&!R.current.contains(M)&&(i!=null&&i.current)&&!i.current.contains(M)&&s()};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[t,s,i]);const w=b=>{if(Re.includes(b)){x.includes(b)?m(["modding"]):m([b]);return}const v=x.filter(M=>ot.includes(M));if(v.includes(b)){const M=v.filter(P=>P!==b);if(M.length===0)return;m(M)}else m([...v,b])},k=async b=>{if(b.preventDefault(),N){d("You can only create one queue",{variant:"error"});return}if(!f.trim()){d("Queue name is required",{variant:"error"});return}c.mutate({name:f.trim(),description:S.trim()||null,is_group:!1,tags:x.join(",")},{onSuccess:()=>{d("Queue created!",{variant:"success"}),s(),y(""),r(""),m(["modding"])},onError:v=>{d((v==null?void 0:v.message)||"Failed to create queue",{variant:"error"})}})};if(!t)return null;const F=x.some(b=>Re.includes(b));return e.jsx("div",{ref:R,className:"create-queue-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:N?e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsx("form",{onSubmit:k,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:f,onChange:b=>y(b.target.value),maxLength:100,required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("textarea",{placeholder:"Description (optional)",value:S,onChange:b=>r(b.target.value),maxLength:500,rows:2,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",outline:"none"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:ot.map(b=>{const v=x.includes(b),M=F;return e.jsx("button",{type:"button",onClick:()=>w(b),disabled:M,style:{background:v?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:v?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:v?"#667eea":M?"var(--muted)":"var(--text)",cursor:M?"not-allowed":"pointer",transition:"all 0.15s",fontWeight:v?500:400,opacity:M?.5:1,textTransform:"capitalize"},children:b},b)})}),_&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:10,color:"var(--muted)",marginTop:10,marginBottom:6,fontWeight:500},children:"Admin Only"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:Re.map(b=>{const v=x.includes(b);return e.jsx("button",{type:"button",onClick:()=>w(b),style:{background:v?"rgba(139, 92, 246, 0.2)":"rgba(255,255,255,0.05)",border:v?"1px solid #a78bfa":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:v?"#a78bfa":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:v?500:400,textTransform:"capitalize"},children:b},b)})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:4},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c.isPending||!f.trim(),style:{background:f.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:f.trim()?"pointer":"not-allowed"},children:c.isPending?"Creating...":"Create"})]})]})})})}function us(){const[t,s]=K.useState(!1),[i,d]=K.useState(""),[a,o]=K.useState(""),{data:c=[]}=Te(),{data:f}=Ne(),{notify:y}=le(),S=bt(),r=K.useMemo(()=>f?c.some(m=>m.owner_id===f.id):!1,[f,c]),x=m=>{if(m&&m.preventDefault(),r){y("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!i.trim()){y("Queue name is required",{variant:"error"});return}S.mutate({name:i.trim(),description:a.trim()||null,is_group:!1},{onSuccess:()=>{y("Queue created!",{variant:"success"}),s(!1),d(""),o("")},onError:R=>{y((R==null?void 0:R.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>s(!0),children:e.jsx(fe,{size:22})}),e.jsx(Ee,{open:t,onClose:()=>s(!1),children:e.jsxs("form",{onSubmit:x,className:"col",style:{gap:12},children:[r?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:i,onChange:m=>d(m.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:a,onChange:m=>o(m.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:S.isPending||r,children:S.isPending?"Creating...":"Create"})]})]})})]})}const ps=[{id:"queues",label:"Queues"},{id:"submissions",label:"Submissions"}];function ws(){const[t,s]=Qt(),i=t.get("tab")||"queues",[d,a]=l.useState(i),{data:o=[],isLoading:c}=Te(),{data:f}=Ne(),{queueTypeFilters:y}=Be(),{notify:S}=le(),[r,x]=l.useState(!1),m=l.useRef(null),[R,N]=l.useState([]),[_,w]=l.useState(!1);l.useEffect(()=>{d==="submissions"&&k()},[d]);const k=async()=>{try{w(!0);const q=await T(z.moddi.mySubmissions);N(q.items)}catch(q){console.error(q),S("Failed to load submissions",{variant:"error"})}finally{w(!1)}},F=q=>{a(q),s(q==="queues"?{}:{tab:q})},b=l.useMemo(()=>o.filter(A=>{const O=A.type||"modder";return O==="modder"&&y.modder||(O==="nominator"||O==="subdivision")&&y.nominator||O==="timing"&&y.timing||O==="audio"&&y.audio}).sort((A,O)=>{const U=(A.is_open??1)===1,Y=(O.is_open??1)===1;return U&&!Y?-1:!U&&Y?1:0}),[o,y]),v=q=>{N(A=>A.map(O=>O.id===q.id?{...O,...q}:O))},M=q=>{N(A=>A.filter(O=>O.id!==q))},P=e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:m,onClick:()=>x(!r),style:{width:48,height:"100%",minHeight:48,background:r?"rgba(255,255,255,0.05)":"transparent",border:"none",color:"var(--text)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},onMouseEnter:q=>{r||(q.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:q=>{r||(q.currentTarget.style.backgroundColor="transparent")},title:"Create queue",children:e.jsx(fe,{size:18})}),e.jsx(cs,{isOpen:r,onClose:()=>x(!1),anchorRef:m})]});return e.jsxs("div",{className:"feed-container unified-queues",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0},children:[e.jsx(Ae,{tabs:ps,activeTab:d,onChange:F,rightAction:P}),d==="queues"&&e.jsxs(e.Fragment,{children:[e.jsx(us,{}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsx("div",{className:"col",style:{gap:0},children:c?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):b.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):b.map(q=>e.jsx(ds,{queue:q},q.id))})}),e.jsx(xt,{context:"moddi-queues"})]}),d==="submissions"&&e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:_?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):R.length===0?e.jsxs("div",{style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx("button",{className:"btn",style:{marginTop:16},onClick:()=>F("queues"),children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:0},children:R.map(q=>e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(_e,{to:`/queues/${q.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:A=>A.currentTarget.style.textDecoration="underline",onMouseLeave:A=>A.currentTarget.style.textDecoration="none",children:q.queue_name}),q.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(q.created_at*1e3).toLocaleDateString()})]}),e.jsx(Le,{submission:q,canManage:!1,allowSelfActions:!0,onUpdate:v,onDelete:M})]},q.id))})})]})}export{z as A,xt as D,Ss as N,ht as O,js as Q,Ae as T,ws as U,xs as a,Ne as b,le as c,T as d,ns as e,ys as f,Zt as g,vs as h,ts as i,ss as j,gt as k,es as l,pt as m,hs as n,Vt as o,fs as p,bs as q,Be as u};
