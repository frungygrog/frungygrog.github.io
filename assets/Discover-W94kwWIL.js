import{r as o,R as se,i as ct,j as s,b as lt,a as dt,L as We,p as ut,D as ft,E as pt,G as Xe,I as mt,J as qe,A as ht,c as gt}from"./vendor-react-_vsaDC62.js";import{P as bt}from"./Popup-9yj3qj3-.js";import{P as xt}from"./beatmap-preview-Da_UNwHS.js";import{C as yt}from"./Comment-BPBiFFu-.js";import{u as vt,B as wt}from"./index-D4ANDSid.js";import"./vendor-DBgzFpze.js";import"./editor-lib-Cf56EpaA.js";import"./editor-components-CKFEosPJ.js";const u="https://api.osumappi.ng",v={};function Tt(){var Be,Ve,He;const[C,E]=o.useState(v.history||[]),[f,L]=o.useState(v.index||-1),n=f>=0?C[f]:null,[Y,ke]=o.useState(!1),[Je,Se]=o.useState(!1),[Ge,Re]=o.useState(!1),[re,W]=o.useState(!1),oe=se.useRef(null),[ie,ae]=o.useState(!1),ce=se.useRef(null),[I,Qe]=o.useState(null),[le,B]=o.useState(!1),[de,X]=o.useState(!1),ue=se.useRef(null),fe=se.useRef(null),[q,pe]=o.useState(!1),[Ce,Ee]=o.useState([]),[V,J]=o.useState(""),[me,he]=o.useState(null),[ge,Ie]=o.useState(!1),[_,T]=o.useState(!0),{notify:w}=vt(),[y,z]=o.useState(v.queue||[]),j=o.useRef(v.seenIds||new Set),_e=o.useRef(new Set),be=o.useRef(!1),Te=o.useRef(null),[Ne,F]=o.useState(v.eligibleCount||null),[$e,D]=o.useState(v.viewedCount||0),[P,$]=o.useState(!1);o.useEffect(()=>()=>{v.history=C,v.index=f,v.queue=y,v.seenIds=j.current,v.eligibleCount=Ne,v.viewedCount=$e},[C,f,y,Ne,$e]);function U(e){var t;return(t=document.cookie.split("; ").map(r=>r.split("=")).find(([r])=>r===e))==null?void 0:t[1]}function Ke(){try{const e=Array.from(j.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function N(){try{const e=localStorage.getItem("filter_modes"),t=(e?String(e):"standard").toLowerCase().split(",").map(i=>i.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],a=Array.from(new Set(t.filter(i=>r.includes(i))));return a.length?a:["standard"]}catch{return["standard"]}}const Me=async(e=3)=>{if(be.current)return[];be.current=!0;try{const t=async()=>{const d=[];for(let R=0;R<e;R++)try{const h=Array.from(j.current).slice(-200),l=N().join(","),b=await fetch(`${u}/api/feed/next?exclude=${encodeURIComponent(h.join(","))}&modes=${encodeURIComponent(l)}`,{credentials:"include"});if(b.status===401){Re(!0);break}if(b.status===429){w("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(!b.ok)break;const x=await b.json(),O=x&&(x.id?x:x.video);if(!O)break;d.push(O)}catch{break}return d};if(Te.current===!1){const d=await t(),R=new Set(y.map(l=>l.id)),h=d.filter(l=>!j.current.has(l.id)&&!R.has(l.id));if(h.length>0&&z(l=>[...l,...h]),h.length===0&&y.length===0)try{const l=N().join(","),b=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(l)}`,{credentials:"include"});if(b.ok){const x=await b.json();F(Number(x.eligible||0)),D(Number(x.viewed||0)),$(!!x.caught_up)}}catch{}return h}const r=Array.from(j.current).slice(-200),a=N().join(","),i=await fetch(`${u}/api/feed/batch?size=${e}&exclude=${encodeURIComponent(r.join(","))}&modes=${encodeURIComponent(a)}`,{credentials:"include"});if(i.status===401)return Re(!0),[];if(i.status===429)return w("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];if(i.status===404){Te.current=!1;const d=await t(),R=new Set(y.map(l=>l.id)),h=d.filter(l=>!j.current.has(l.id)&&!R.has(l.id));if(h.length>0&&z(l=>[...l,...h]),h.length===0&&y.length===0)try{const l=N().join(","),b=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(l)}`,{credentials:"include"});if(b.ok){const x=await b.json(),O=Number(x.eligible||0),Ye=Number(x.viewed||0);F(O),D(Ye);const at=O>0&&Ye>=O;$(at)}}catch{}return h}const c=await i.json(),p=c&&Array.isArray(c.items)?c.items:[],m=new Set,k=p.filter(d=>m.has(d.id)?!1:(m.add(d.id),!0)),M=new Set(y.map(d=>d.id)),S=k.filter(d=>!j.current.has(d.id)&&!M.has(d.id));if(S.length>0&&z(d=>[...d,...S]),S.length===0&&y.length===0)try{const d=N().join(","),R=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(d)}`,{credentials:"include"});if(R.ok){const h=await R.json(),l=Number(h.eligible||0),b=Number(h.viewed||0);F(l),D(b);const x=l>0&&b>=l;$(x)}}catch{}return S}catch{return[]}finally{be.current=!1}},G=async()=>{if(!Y){ke(!0);try{let e=[];y.length===0&&(e=await Me(3));let t;if(y.length>0?(t=y[0],z(r=>r.slice(1))):e.length>0&&(t=e[0],e.length>1&&z(r=>[...r,...e.slice(1)])),t){if(j.current.add(t.id),Ke(),E(r=>{const a=[...r.slice(0,f+1),t];return L(a.length-1),a}),!_e.current.has(t.id)){_e.current.add(t.id);const r=U("csrf")||"";try{const a=await fetch(`${u}/api/videos/${t.id}/view`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":r}});if(a.ok){const i=await a.json();i&&E(c=>{const p=[...c],m=p.findIndex(k=>k.id===t.id);return m!==-1&&(p[m]={...p[m],views_count:i.views_count??p[m].views_count??0,viewed_by_me:!0}),p})}}catch{}}}else try{const r=N().join(","),a=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(a.ok){const i=await a.json(),c=Number(i.eligible||0),p=Number(i.viewed||0);F(c),D(p);const m=c>0&&p>=c;$(m)}}catch{}y.length<=1&&Me(3)}finally{ke(!1)}}},xe=()=>{f>0&&(L(f-1),B(!1))},ye=()=>{if(!_&&(H.current=!0,ee.current=!0,g.current)){const e=g.current;e.muted=!1,T(!1),e.play().catch(()=>{})}if(f<C.length-1){L(f+1),B(!1);return}P||G()},Q=o.useRef(0),K=o.useRef(null),Z=o.useRef(null),ve=o.useRef({goNext:ye,goPrev:xe,index:f,history:C,loading:Y,exhausted:P});o.useEffect(()=>{ve.current={goNext:ye,goPrev:xe,index:f,history:C,loading:Y,exhausted:P}},[ye,xe,f,C,Y,P]),o.useEffect(()=>{const e=Oe.current;if(!e)return;const t=i=>{if(e){const k=e.getBoundingClientRect(),M=i.clientX,S=i.clientY;if(M<k.left||M>k.right||S<k.top||S>k.bottom)return}i.preventDefault(),i.stopPropagation();const c=Date.now();if(c<Q.current||(Q.current=c+1e3,Math.abs(i.deltaY)<Math.abs(i.deltaX)))return;const{goNext:p,goPrev:m}=ve.current;i.deltaY>0?p():m()},r=i=>{K.current=i.touches[0].clientY,Z.current=Date.now()},a=i=>{if(K.current===null||Z.current===null)return;const c=i.changedTouches[0].clientY,p=Date.now(),m=K.current-c,k=p-Z.current;if(K.current=null,Z.current=null,Math.abs(m)<50||k>300)return;const M=Date.now();if(M<Q.current)return;Q.current=M+1e3;const{goNext:S,goPrev:d}=ve.current;m>0?S():d()};return e.addEventListener("wheel",t,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",t,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",t,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a),window.removeEventListener("wheel",t,{capture:!0})}},[]);const Ze=async()=>{if(n){Se(!0);try{const e=U("csrf")||"",t=n.liked_by_me?"DELETE":"POST",r=await fetch(`${u}/api/videos/${n.id}/like`,{method:t,credentials:"include",headers:{"X-CSRF-Token":e}});if(r.status===429){w("Please slow down a bit.",{durationMs:5e3,variant:"warn"});return}if(r.ok){const a=await r.json();E(i=>{const c=[...i];return c[f]={...c[f],liked_by_me:!n.liked_by_me,likes_count:a.likes_count},c})}}finally{Se(!1)}}};async function Le(e){if(!n)return;const t=U("csrf")||"";(await fetch(`${u}/api/videos/${n.id}/flag`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({reason:e})})).ok?w("Thanks for your report.",{variant:"info"}):w("Report failed",{variant:"error"}),W(!1)}o.useEffect(()=>{if(!re)return;const e=t=>{oe.current&&!oe.current.contains(t.target)&&W(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[re]),o.useEffect(()=>{if(!ie)return;const e=t=>{ce.current&&!ce.current.contains(t.target)&&ae(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ie]),o.useEffect(()=>{if(!de)return;const e=t=>{ue.current&&!ue.current.contains(t.target)&&fe.current&&!fe.current.contains(t.target)&&X(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[de]),o.useEffect(()=>{C.length===0&&G()},[]),o.useEffect(()=>{(async()=>{try{const e=N().join(","),t=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(e)}`,{credentials:"include"});if(t.ok){const r=await t.json(),a=Number(r.eligible||0),i=Number(r.viewed||0);F(a),D(i);const c=a>0&&i>=a;$(c)}}catch{}})()},[]),o.useEffect(()=>{const e=()=>{E([]),z([]),j.current.clear(),L(-1),$(!1),(async()=>{try{const t=N().join(","),r=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(t)}`,{credentials:"include"});if(r.ok){const a=await r.json(),i=Number(a.eligible||0),c=Number(a.viewed||0);F(i),D(c),$(!1)}}catch{}G()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),o.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const t=JSON.parse(e);if(Array.isArray(t))for(const r of t)typeof r=="number"&&j.current.add(r)}}catch{}},[]),o.useEffect(()=>{(async()=>{try{const e=await fetch(`${u}/api/me`,{credentials:"include"});e.ok&&Qe(await e.json())}catch{}})()},[]);const H=o.useRef(!1);o.useEffect(()=>{B(!1),pe(!1),H.current?T(!1):T(!0)},[n==null?void 0:n.id]),o.useEffect(()=>{g.current&&(g.current.muted=_)},[_]),o.useEffect(()=>{if(n&&g.current){const e=setTimeout(()=>{const t=g.current;t&&(!H.current?(t.muted=!0,t.play().catch(a=>{console.debug("Autoplay prevented:",a)})):(t.muted=!1,T(!1),t.play().then(()=>{}).catch(a=>{console.debug("Unmuted play failed, falling back to muted:",a),t.muted=!0,T(!0),t.play().catch(()=>{console.debug("Autoplay prevented:",a)})})))},100);return()=>clearTimeout(e)}},[n==null?void 0:n.id]);const ee=o.useRef(!1),et=e=>{g.current=e,e&&(ee.current&&H.current?(e.muted=!1,T(!1),e.play().then(()=>{ee.current=!1}).catch(()=>{e.muted=!0,T(!0),ee.current=!1,e.play().catch(()=>{})})):e.muted=_)},ze=async()=>{if(n!=null&&n.id)try{const e=await fetch(`${u}/api/videos/${n.id}/comments`,{credentials:"include"});if(e.ok){const t=await e.json();Ee(t.items||[])}}catch{}};o.useEffect(()=>{q&&(n!=null&&n.id)&&ze()},[q,n==null?void 0:n.id]);const Fe=async e=>{if(e.preventDefault(),!(!V.trim()||!(n!=null&&n.id))){Ie(!0);try{const t=U("csrf")||"",r=await fetch(`${u}/api/videos/${n.id}/comments`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({text:V.trim(),parent_id:me||void 0})});if(r.ok)J(""),he(null),ze(),E(a=>{const i=[...a],c=i.findIndex(p=>p.id===n.id);return c!==-1&&(i[c]={...i[c],comments_count:(i[c].comments_count||0)+1}),i}),w("Comment posted!",{variant:"success"});else{const a=await r.json().catch(()=>({}));w(a.error||"Failed to post comment",{variant:"error"})}}catch{w("Failed to post comment",{variant:"error"})}finally{Ie(!1)}}},tt=e=>{Ee(t=>t.filter(r=>r.id!==e)),E(t=>{const r=[...t],a=r.findIndex(i=>i.id===(n==null?void 0:n.id));return a!==-1&&(r[a]={...r[a],comments_count:Math.max(0,(r[a].comments_count||0)-1)}),r})},De=Ce.filter(e=>!e.parent_id),te=new Map;Ce.filter(e=>e.parent_id).forEach(e=>{const t=e.parent_id;te.has(t)||te.set(t,[]),te.get(t).push(e)});const g=o.useRef(null),ne=o.useRef(null),A=o.useRef(!1),nt=()=>{if(!g.current||A.current)return;const e=g.current,t=!_;T(t),e.muted=t,t||(H.current=!0),!t&&e.paused&&e.play().catch(r=>{console.debug("Play failed after unmute:",r)})},Pe=()=>{g.current&&(A.current=!1,ne.current=window.setTimeout(()=>{A.current=!0;const e=g.current;e&&!e.paused&&e.pause()},200))},we=()=>{if(ne.current&&(clearTimeout(ne.current),ne.current=null),A.current&&g.current){const e=g.current;e.paused&&e.play().catch(t=>console.debug("Resume failed:",t)),A.current=!1}},st=()=>{Pe()},rt=e=>{A.current&&e.preventDefault(),we()},Ue=!!(I!=null&&I.is_admin||I!=null&&I.is_mod);async function ot(){if(!n)return;const e=U("csrf")||"",t=!n.is_starred,r=t?"star":"unstar";(await fetch(`${u}/api/admin/videos/${n.id}/${r}`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(E(i=>{const c=[...i];return c[f]={...c[f],is_starred:t},c}),ae(!1),w(t?"Post starred":"Star removed",{variant:"success"})):w("Action failed",{variant:"error"})}async function Ae(){if(!n||!confirm("Permanently delete this video?"))return;const e=U("csrf")||"";(await fetch(`${u}/api/videos/${n.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(w("Deleted",{variant:"warn"}),W(!1),E(r=>{const a=r.filter((i,c)=>c!==f);return a.length===0?(L(-1),setTimeout(G,0)):L(i=>Math.max(0,Math.min(i,a.length-1))),a})):alert("Delete failed")}ct();const Oe=o.useRef(null),[je,it]=o.useState(0);return o.useEffect(()=>{const e=()=>{const t=document.querySelector(".top-nav");t&&it(t.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.jsxs(s.Fragment,{children:[s.jsx(wt,{paused:!1}),s.jsxs("div",{ref:Oe,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[P&&s.jsx("div",{className:"chip info",style:{position:"absolute",top:je+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),s.jsx("div",{className:"video-area",style:{position:"absolute",top:je,left:0,right:0,bottom:q?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:Ge?s.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[s.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),s.jsx("button",{className:"btn",onClick:()=>window.location.href=`${u}/api/auth/login`,children:"Login with osu!"})]}):n?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:le&&n.beatmapset_id?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:s.jsx(xt,{downloadUrl:`${u}/api/osu/beatmapsets/${n.beatmapset_id}/download?noVideo=1`,beatmapId:n.beatmap_id??void 0,beatmapVersion:n.beatmap_version??void 0,onOpenInEditor:()=>{B(!1),window.location.hash="/editor"}})}):s.jsxs("div",{style:{width:"75vw",maxWidth:"75vw",height:"100%",maxHeight:`calc(100vh - ${je}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),s.jsx("div",{style:{position:"relative",zIndex:1},children:s.jsxs("div",{onClick:nt,onMouseDown:Pe,onMouseUp:we,onMouseLeave:we,onTouchStart:st,onTouchEnd:rt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[s.jsx(bt,{streamUID:n.stream_uid,playbackUrl:n.playback_url,aspectRatio:n!=null&&n.width&&(n!=null&&n.height)?n.width/n.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:_,controls:!1,onVideoRef:et}),s.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:_?1:0},children:_?s.jsx(lt,{size:20,color:"#fff"}):s.jsx(dt,{size:20,color:"#fff"})})]})})]})}):P?null:s.jsx("div",{className:"muted",style:{zIndex:10},children:"No videos yet"})}),n&&!le&&s.jsxs("div",{style:{position:"absolute",right:16,bottom:"20%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto"},onClick:e=>e.stopPropagation(),children:[s.jsx(We,{to:`/profile/${(Be=n.uploader)==null?void 0:Be.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Ve=n.uploader)!=null&&Ve.avatar_url?s.jsx("img",{src:n.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:n.uploader.username}):s.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:Ze,disabled:Je,"aria-label":n.liked_by_me?"Unlike":"Like",title:n.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:n.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.liked_by_me?s.jsx(ut,{size:28}):s.jsx(ft,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.likes_count??0})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:()=>pe(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(pt,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.comments_count??0})]}),n.beatmap_url&&s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{ref:fe,onClick:()=>X(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(Xe,{size:24})}),de&&s.jsxs("div",{ref:ue,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsxs("a",{className:"menu-item",href:n.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>X(!1),children:[s.jsx(Xe,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),n.beatmapset_id&&s.jsx("button",{className:"menu-item",onClick:()=>{B(!0),X(!1)},children:"Preview"})]})]}),Ue?s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{onClick:()=>ae(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(qe,{size:24})}),ie&&s.jsxs("div",{ref:ce,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("button",{className:"menu-item",onClick:ot,children:n.is_starred?"Unstar post":"Star post"}),s.jsx("button",{className:"menu-item",onClick:Ae,children:"Delete video"})]})]}):s.jsx("button",{onClick:()=>W(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(mt,{size:24})}),re&&s.jsxs("div",{ref:oe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),s.jsx("button",{className:"menu-item",onClick:()=>Le("unrelated"),children:"Unrelated"}),s.jsx("button",{className:"menu-item",onClick:()=>Le("explicit"),children:"Explicit"}),Ue&&s.jsx("button",{className:"menu-item",onClick:Ae,children:"Delete video"})]})]}),n&&!le&&s.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:s.jsx(We,{to:`/profile/${(He=n.uploader)==null?void 0:He.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:16,display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:(()=>{var a,i,c;const e=(a=n.uploader)==null?void 0:a.is_admin,t=(i=n.uploader)==null?void 0:i.is_mod,r=e?"#fff3bf":t?"#d7fbe8":"#fff";return s.jsxs(s.Fragment,{children:[s.jsxs("span",{style:{color:r},children:["@",(c=n.uploader)==null?void 0:c.username]}),n.is_starred&&s.jsx(ht,{size:16,color:"#f59e0b",title:"Starred"}),(e||t)&&s.jsx(qe,{size:14,color:r,title:e?"admin":"mod"})]})})()})}),(n.description??"").trim()&&s.jsx("div",{style:{color:"#fff",fontSize:14,lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto"},children:n.description}),n.beatmap_title&&s.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:13,textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto"},children:[n.beatmap_artist," – ",n.beatmap_title," ",n.beatmap_mapper?`(by ${n.beatmap_mapper})`:""," ",n.beatmap_version?`[${n.beatmap_version}]`:""]})]}),q&&n&&s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),s.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[s.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",n.comments_count??0,")"]}),s.jsx("button",{onClick:()=>pe(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:s.jsx(gt,{size:24})})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:De.length===0?s.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):s.jsx("div",{className:"col",style:{gap:0},children:De.map(e=>s.jsx(yt,{comment:e,replies:te.get(e.id)||[],me:I,section:"mappi",onReply:t=>he(t),onDelete:tt,replyingTo:me,replyText:V,onReplyTextChange:J,onReplySubmit:Fe,posting:ge,onCancelReply:()=>{he(null),J("")}},e.id))})}),I&&!me&&s.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:s.jsxs("form",{onSubmit:Fe,style:{display:"flex",alignItems:"flex-end",gap:8},children:[s.jsx("textarea",{placeholder:"Write a comment...",value:V,onChange:e=>J(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,120)}px`}}),s.jsx("button",{type:"submit",className:"btn compact",disabled:ge||!V.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:ge?"...":"Post"})]})})]})]})]})]})}export{Tt as default};
