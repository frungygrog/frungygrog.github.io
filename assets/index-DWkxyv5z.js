const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-Buy1TldR.js","assets/vendor-react-BcztRRPo.js","assets/vendor-z7ElObC4.js","assets/mappi-routes-DblMHN0M.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-BU8nWiSI.js","assets/vendor-zip-CPkGWvL_.js","assets/beatmap-preview-BasPDPAs.js","assets/editor-CG1yLUbS.css","assets/moddi-routes-CLIqwKJw.js","assets/editor-components-BMK_t3kA.js","assets/editor-components-Bzmrvihl.css"])))=>i.map(i=>d[i]);
var Oe=Object.defineProperty;var Qe=(t,a,s)=>a in t?Oe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var je=(t,a,s)=>Qe(t,typeof a!="symbol"?a+"":a,s);import{r as N,j as e,e as ne,u as ce,R as b,q as Ae,d as he,V as Je,W as Ne,X as Ye,L as q,Y as Ve,Z as Ke,P as _e,_ as Ge,$ as we,Q as xe,M as Xe,A as Ze,h as et,D as ke,S as tt,T as st,H as it,c as Le,J as at,l as Me,a0 as nt,z as rt,a1 as Se,B as lt,v as ot,o as ct,k as dt,x as ut,i as mt,g as pt,a2 as ht,a3 as ft,a4 as xt,a5 as gt,a6 as J}from"./vendor-react-BcztRRPo.js";import{y as vt}from"./vendor-z7ElObC4.js";import{u as de,a as z,A as M,c as me,i as ae,d as ge,P as bt,b as re,e as yt,T as jt,f as Nt}from"./mappi-routes-DblMHN0M.js";import{u as te,a as ze,b as Pe,c as le,d as wt,e as kt,f as St,g as Ct,h as Tt,F as Et,C as At,M as _t,D as Lt,i as Mt,P as zt,Q as Pt,j as It,N as Ft}from"./moddi-routes-CLIqwKJw.js";import{b as Rt,a as Dt,i as Wt,c as qt,H as Bt}from"./editor-components-BMK_t3kA.js";import{s as Ht,E as $t}from"./editor-BU8nWiSI.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-BasPDPAs.js";import"./vendor-zip-CPkGWvL_.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(l){if(l.ep)return;l.ep=!0;const n=s(l);fetch(l.href,n)}})();const Ut="modulepreload",Ot=function(t){return"/"+t},Ce={},Qt=function(a,s,r){let l=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),x=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));l=Promise.allSettled(s.map(m=>{if(m=Ot(m),m in Ce)return;Ce[m]=!0;const w=m.endsWith(".css"),d=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${d}`))return;const v=document.createElement("link");if(v.rel=w?"stylesheet":Ut,w||(v.as="script"),v.crossOrigin="",v.href=m,x&&v.setAttribute("nonce",x),document.head.appendChild(v),w)return new Promise((S,C)=>{v.addEventListener("load",S),v.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(c){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=c,window.dispatchEvent(x),!x.defaultPrevented)throw c}return l.then(c=>{for(const x of c||[])x.status==="rejected"&&n(x.reason);return a().catch(n)})},Jt=new vt({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Yt extends N.Component{constructor(s){super(s);je(this,"handleRetry",()=>{const s=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),s&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r)}isChunkLoadingError(s){if(!s)return!1;const r=s.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||s.name==="ChunkLoadError"}render(){var s;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),l=((s=this.state.error)==null?void 0:s.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":l}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const Z=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Vt({i:t}){const a=t*1337,s=(C,f)=>{const p=Math.sin(a+C+f)*1e4,y=p-Math.floor(p);return Math.floor(y*(f-C+1)+C)},r=s(0,100),l=s(24,50),n=.7+s(0,100)/100*.3,c=l*n,x=s(0,4e3),m=s(-10,10),w=s(-8,8),d=s(0,100),v=d<60?1:d<80?1.5:2,S=[{size:200*v,alpha:.06,dx:-22,dy:12,color:Z[s(0,Z.length-1)]},{size:150*v,alpha:.08,dx:-9,dy:7,color:Z[s(0,Z.length-1)]},{size:120*v,alpha:.1,dx:0,dy:0,color:Z[s(0,Z.length-1)]},{size:90*v,alpha:.12,dx:12,dy:-4,color:Z[s(0,Z.length-1)]},{size:64*v,alpha:.13,dx:20,dy:-7,color:Z[s(0,Z.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${c}s`,animationDelay:`${x}ms`,"--tx":`${m}vw`,transform:`rotate(${w}deg)`},children:S.map((C,f)=>e.jsx("svg",{width:C.size,height:C.size,viewBox:"0 0 100 100",style:{left:`${50+C.dx}%`,bottom:`${C.dy}px`,transform:"translateX(-50%)","--alpha":C.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:C.color})},f))})}function Kt({paused:t=!1}){const a=N.useMemo(()=>new Array(20).fill(0).map((s,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:a.map(s=>e.jsx(Vt,{i:s},s))})}function Gt(){const t=ne(),a=ce(),{lastSection:s,previousLocation:r,setPreviousLocation:l}=te(),n=b.useRef(null),c=b.useRef(!1),x=b.useRef(0),m=b.useRef(0),w=b.useRef(null),d=b.useRef(null),v=b.useRef(!1),S=300,C=2e3,f=b.useRef(null),p=b.useRef(null),y=b.useRef(null),[u,T]=b.useState(!1),[k,g]=b.useState(12),P=b.useRef(null),E=b.useRef(null),[o,I]=b.useState(!1),[F,U]=b.useState(12),[Y,R]=b.useState([]),[Q,X]=b.useState(""),D=b.useRef(null),V=b.useRef(null),[K,h]=b.useState(!1),[L,_]=b.useState(12),[$,ie]=b.useState(null),oe=b.useCallback(()=>{if(!p.current)return;const j=p.current.getBoundingClientRect(),B=window.innerWidth||document.documentElement.clientWidth||320,H=160;let W=j.left;W+H+8>B&&(W=Math.max(8,B-H-8)),W=Math.max(8,W),g(W)},[]),i=b.useCallback(()=>{if(!P.current)return;const j=P.current.getBoundingClientRect(),B=window.innerWidth||document.documentElement.clientWidth||320,H=220;let W=j.left;W+H+8>B&&(W=Math.max(8,B-H-8)),W=Math.max(8,W),U(W)},[]),A=b.useCallback(()=>{if(!D.current)return;const j=D.current.getBoundingClientRect(),B=window.innerWidth||document.documentElement.clientWidth||320,H=280;let W=j.left;W+H+8>B&&(W=Math.max(8,B-H-8)),W=Math.max(8,W),_(W)},[]);b.useEffect(()=>()=>{n.current&&clearTimeout(n.current),w.current&&clearTimeout(w.current),d.current&&clearTimeout(d.current)},[]),b.useEffect(()=>{if(!u)return;const j=B=>{const H=B.target;y.current&&!y.current.contains(H)&&p.current&&!p.current.contains(H)&&T(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[u]),b.useEffect(()=>{if(!o)return;const j=B=>{const H=B.target;E.current&&!E.current.contains(H)&&P.current&&!P.current.contains(H)&&I(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[o]),b.useEffect(()=>{if(!K)return;const j=B=>{const H=B.target;V.current&&!V.current.contains(H)&&D.current&&!D.current.contains(H)&&h(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[K]),b.useEffect(()=>{if(!u)return;oe();const j=()=>oe();return window.addEventListener("resize",j),window.addEventListener("orientationchange",j),()=>{window.removeEventListener("resize",j),window.removeEventListener("orientationchange",j)}},[u,oe]),b.useEffect(()=>{if(!o)return;i();const j=()=>i();return window.addEventListener("resize",j),window.addEventListener("orientationchange",j),()=>{window.removeEventListener("resize",j),window.removeEventListener("orientationchange",j)}},[o,i]),b.useEffect(()=>{if(!K)return;A();const j=()=>A();return window.addEventListener("resize",j),window.addEventListener("orientationchange",j),()=>{window.removeEventListener("resize",j),window.removeEventListener("orientationchange",j)}},[K,A]);const G=t.pathname==="/"||t.pathname==="/about",O=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!G&&t.pathname.startsWith("/md/");const se=t.pathname.startsWith("/md/")||!G&&!t.pathname.startsWith("/mp/")&&s==="moddi";b.useEffect(()=>{if(!O)return;const j=H=>{const W=H.detail||{},Ue=Array.isArray(W.items)?W.items:[];R(Ue),X(String(W.selected||""))},B=H=>{const W=H.detail||{};ie({title:String(W.title||""),artist:String(W.artist||""),mapper:String(W.mapper||""),version:String(W.version||""),beatmapId:Number(W.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",j),window.addEventListener("editor:info",B),()=>{window.removeEventListener("editor:difficulty:list",j),window.removeEventListener("editor:info",B)}},[O]);const Fe=ze();if(G)return null;const ve=()=>{a(r||(s==="moddi"?"/md/feed":"/mp/feed"))},Re=()=>{T(j=>!j)},De=()=>{var j;T(!1),(j=f.current)==null||j.click()},We=()=>{I(j=>!j)},qe=j=>{I(!1),X(j),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:j}}))},Be=()=>{h(j=>!j)};if(O)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:f,type:"file",accept:".osz,.zip",onChange:j=>{var H;const B=(H=j.target.files)==null?void 0:H[0];B&&window.dispatchEvent(new CustomEvent("editor:file",{detail:B}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ve,"aria-label":"Back",title:"Go back",children:e.jsx(Ae,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:p,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Re,"aria-label":"File",title:"File menu","aria-expanded":u,children:e.jsx(Je,{size:20})}),u&&he.createPortal(e.jsx("div",{ref:y,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${k}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:De,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:ve,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[Y.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:P,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:We,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":o,children:e.jsx(Ne,{size:20})}),o&&he.createPortal(e.jsx("div",{ref:E,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${F}px`,minWidth:220},children:Y.map(j=>{const B=j.mode==="taiko"?Rt:j.mode==="mania"?Dt:j.mode==="catch"?Wt:qt;return e.jsxs("button",{className:`mode-option ${Q===j.path?"selected":""}`,type:"button",onClick:()=>qe(j.path),children:[e.jsx("img",{className:"mode-icon",src:B,width:24,height:24,alt:""}),e.jsx("span",{children:j.version||"(Untitled)"})]},j.path)})}),document.body)]}),$&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:D,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Be,"aria-label":"Map Info",title:"Map Info","aria-expanded":K,children:e.jsx(Ye,{size:20})}),K&&he.createPortal(e.jsx("div",{ref:V,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${L}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[$.artist||"Artist"," – ",$.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",$.mapper||"Unknown"]}),$.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",$.version]}),$.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${$.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]});const be=()=>{const j=Date.now();if(x.current>0){const B=j-x.current;if(B<S&&B>0){w.current&&(clearTimeout(w.current),w.current=null),d.current&&(clearTimeout(d.current),d.current=null),n.current&&(clearTimeout(n.current),n.current=null),m.current=j+C,x.current=0,c.current=!1,l(t.pathname),a("/editor");return}}j<m.current&&x.current===0||(w.current&&(clearTimeout(w.current),w.current=null),d.current&&(clearTimeout(d.current),d.current=null),x.current=j,d.current=setTimeout(()=>{d.current!==null&&(a(se?"/mp/feed":"/md/feed"),d.current=null)},S),w.current=setTimeout(()=>{x.current>0&&(x.current=0,m.current=Date.now()+C),w.current=null},S))},ye=()=>{c.current=!1,n.current=setTimeout(()=>{c.current=!0,a("/")},500)},pe=()=>{n.current&&(clearTimeout(n.current),n.current=null),c.current&&setTimeout(()=>{c.current=!1},100)},He=j=>{if(v.current){j.preventDefault(),j.stopPropagation(),v.current=!1;return}if(c.current){j.preventDefault(),j.stopPropagation();return}be()},$e=j=>{if(pe(),c.current){j.preventDefault(),v.current=!0;return}j.preventDefault(),be(),v.current=!0,setTimeout(()=>{v.current=!1},S+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(q,{to:se?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(Ne,{size:20})}),se?e.jsx(q,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Ve,{size:20})}):e.jsx(q,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Ke,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:He,onTouchStart:ye,onTouchEnd:$e,onMouseDown:ye,onMouseUp:pe,onMouseLeave:pe,"aria-label":se?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:se?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:se?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(q,{to:"/md/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/md/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(_e,{size:20}),Fe>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>a("/settings"),"aria-label":"Settings",children:e.jsx(Ge,{size:20})})]})]})}function Xt({isModdi:t,onClick:a}){return e.jsxs("button",{onClick:a,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:t?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:t?"osu!mappi.ng":"osu!moddi.ng"})]})}function Zt({isNeutralPage:t,isEditor:a,isModdi:s,isMappi:r,onCoinFlipClick:l}){return t?e.jsx(q,{to:"/",className:"title",children:s?"osu!moddi.ng":r?"osu!mappi.ng":"mappi!"}):a?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(q,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(we,{size:18})}),e.jsx(q,{to:s?"/md/feed":"/mp/feed",className:"title",children:"osu!editi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(q,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(we,{size:18})}),e.jsx(Xt,{isModdi:s,onClick:l})]})}function es({isNeutralPage:t,isMappi:a,isModdi:s}){const r=ne();return e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[t&&e.jsx(q,{to:r.pathname==="/"?"/about":"/",className:r.pathname==="/about"?"active":"",children:r.pathname==="/"?"About":"Home"}),a&&e.jsxs(e.Fragment,{children:[e.jsx(q,{to:"/mp/feed",className:r.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(q,{to:"/mp/discover",className:r.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(q,{to:"/editor",className:r.pathname==="/editor"?"active":"",children:"Editor"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(q,{to:"/md/feed",className:r.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(q,{to:"/md/queues",className:r.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!a&&!s&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(q,{to:"/mp/feed",className:r.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(q,{to:"/mp/discover",className:r.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(q,{to:"/editor",className:r.pathname==="/editor"?"active":"",children:"Editor"})]})]})}function ts(t,a,s,r){const l=ce(),{notify:n}=de(),[c,x]=N.useState(new Set);return{parseQueueInvite:f=>{if(!f)return null;try{const p=JSON.parse(f);if((p==null?void 0:p.type)==="queue_invite"&&(p!=null&&p.queue_id))return p}catch{}return null},handleAcceptInvite:async(f,p)=>{if(!c.has(f.id)){x(y=>new Set(y).add(f.id));try{await z(M.moddi.queueAccept(String(p)),{method:"POST"}),n("Invitation accepted!",{variant:"success"}),s.mutate(f.id),r(!1),l(`/md/queues/${p}`)}catch(y){n((y==null?void 0:y.message)||"Failed to accept invitation",{variant:"error"})}finally{x(y=>{const u=new Set(y);return u.delete(f.id),u})}}},handleDenyInvite:async(f,p)=>{if(!c.has(f.id)){x(y=>new Set(y).add(f.id));try{await z(M.moddi.queueDeny(String(p)),{method:"POST"}),n("Invitation declined",{variant:"success"}),s.mutate(f.id)}catch(y){n((y==null?void 0:y.message)||"Failed to decline invitation",{variant:"error"})}finally{x(y=>{const u=new Set(y);return u.delete(f.id),u})}}},handleMarkAllRead:async()=>{const f=t.filter(p=>p.id.startsWith("n:")||p.kind==="system"&&!p.read).map(p=>p.id);f.length>0&&a.mutate(f)},handleNotificationClick:async f=>{if(r(!1),a.mutate([f.id]),f.kind==="system"||f.id.startsWith("n:"))try{await z(M.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[f.id]})})}catch{}},handleDeleteNotification:async(f,p)=>{f.stopPropagation(),s.mutate(p)},processing:c}}function ss({notifications:t,unreadCount:a,notifOpen:s,setNotifOpen:r,markReadMutation:l,deleteNotificationMutation:n,closeAllPanels:c}){const x=N.useRef(null),m=N.useRef(null),{parseQueueInvite:w,handleAcceptInvite:d,handleDenyInvite:v,handleMarkAllRead:S,handleNotificationClick:C,handleDeleteNotification:f,processing:p}=ts(t,l,n,r);Pe(x,m,s,()=>r(!1));const y=t.filter(u=>!(u.kind==="system"&&u.id.startsWith("b:")&&(u.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:x,className:"icon-link",onClick:()=>{s||c(),r(!s)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(_e,{size:18})}),a>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),s&&e.jsxs("div",{ref:m,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(q,{to:"/md/notifications",onClick:()=>r(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:u=>u.currentTarget.style.opacity="1",onMouseLeave:u=>u.currentTarget.style.opacity="0.7",children:"View all"}),y.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:S,children:e.jsx(xe,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[y.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),y.map(u=>{const T=w(u.text),k=u.id.startsWith("b:"),g=T?"queue-invite":u.kind==="star"?"star":u.kind==="likes5"?"likes":u.kind==="comment"?"comment":u.kind==="inspiration"?"inspiration":u.kind==="reaction"?"reaction":k?"global":"system",P=u.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${g}`,role:"button",onClick:()=>!T&&C(u),children:[e.jsxs("div",{className:`notif-icon ${P?"deletable":""}`,"aria-hidden":"true",onClick:P&&!T?E=>f(E,u.id):void 0,title:P&&!T?"Remove":void 0,role:P&&!T?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:T?e.jsx(Xe,{}):g==="star"?e.jsx(Ze,{}):g==="likes"?e.jsx(et,{}):g==="comment"?e.jsx(ke,{}):g==="inspiration"?e.jsx(ke,{}):g==="reaction"?e.jsx(tt,{}):g==="global"?e.jsx(st,{}):null}),P&&!T?e.jsx("span",{className:"swap-trash",children:e.jsx(it,{})}):null]}),e.jsx("div",{className:"notif-body",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[T.inviter_username," invited you to join queue: ",T.queue_name]}),p.has(u.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:E=>{E.stopPropagation(),d(u,T.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(xe,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:E=>{E.stopPropagation(),v(u,T.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Le,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):u.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:k?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:u.text||""}),k&&u.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(u.expiresAt).toLocaleString()]}):null]}):u.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone commented on your post"})]}):u.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone is inspired by you!"})]}):u.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:u.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:u.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},u.id)})]})]})]})}function is({quota:t,nowTick:a}){if(!(t!=null&&t.blocked))return null;const s=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),r=Math.floor(s/3600),l=Math.floor(s%3600/60),n=s%60,c=m=>String(m).padStart(2,"0"),x=r>0?`${r}:${c(l)}:${c(n)}`:`${l}:${c(n)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(at,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:x})]})}function as({me:t,menuOpen:a,setMenuOpen:s,onLogout:r,closeAllPanels:l}){const n=N.useRef(null),c=N.useRef(null);return Pe(n,c,a,()=>s(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:n,className:"icon-link",onClick:()=>{a||l(),s(!a)},title:t.username,"aria-label":"User menu","aria-expanded":a,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(Me,{size:14,style:{opacity:.8}})]}),a&&e.jsxs("div",{ref:c,className:"menu-panel",role:"menu",children:[e.jsx(q,{to:"/profile",className:"menu-item",onClick:()=>s(!1),children:"Profile"}),e.jsx(q,{to:"/settings",className:"menu-item",onClick:()=>s(!1),children:"Settings"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(q,{to:"/moderation",className:"menu-item",onClick:()=>s(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:r,children:"Log out"})]})]})}function ns({isNeutralPage:t,isEditor:a,isMappi:s,isModdi:r,onCoinFlipClick:l}){const n=ne(),{data:c,isLoading:x}=le(),{data:m}=wt(!!c),{data:w=[]}=kt(!!c),d=ze(),v=St(),S=Ct(),C=Tt(),{menuOpen:f,notifOpen:p,setMenuOpen:y,setNotifOpen:u,closeAllPanels:T}=te(),[k,g]=b.useState(0);return b.useEffect(()=>{const P=setInterval(()=>g(E=>E+1),1e3);return()=>clearInterval(P)},[]),e.jsxs("header",{className:"top-nav",children:[e.jsx(Zt,{isNeutralPage:t,isEditor:a,isModdi:r,isMappi:s,onCoinFlipClick:l}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),n.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Bt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(es,{isNeutralPage:t,isMappi:s,isModdi:r}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(nt,{size:18})}),c?e.jsxs("div",{className:"user-menu",children:[e.jsx(ss,{notifications:w,unreadCount:d,notifOpen:p,setNotifOpen:u,markReadMutation:S,deleteNotificationMutation:C,closeAllPanels:T}),e.jsx(is,{quota:m,nowTick:k}),e.jsx(as,{me:c,menuOpen:f,setMenuOpen:y,onLogout:()=>v.mutate(),closeAllPanels:T})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=me+M.auth.login},disabled:x,children:x?"Checking…":"Login with osu!"})]})]})}function rs({title:t,onRefresh:a}){const{data:s}=le(),r=ne(),l=ce(),{lastSection:n}=te(),[c,x]=b.useState(!0),[m,w]=b.useState(0),[d,v]=b.useState(!1),S=b.useRef(!1),C=b.useRef(0),[f,p]=b.useState(!1),y=b.useRef(null);b.useEffect(()=>{const k=document.querySelector(".page");if(!k)return;let g=k.scrollTop,P=!1;const E=()=>{P||(P=!0,requestAnimationFrame(()=>{const o=k.scrollTop,I=o-g;o<=12||I<-12?x(!0):I>12&&x(!1),g=o,P=!1}))};return k.addEventListener("scroll",E,{passive:!0}),()=>k.removeEventListener("scroll",E)},[]),b.useEffect(()=>{const k=document.querySelector(".page");if(!k)return;const g=120,P=70,E=U=>{var Y;d||(k.scrollTop<=0?(S.current=!0,C.current=((Y=U.touches[0])==null?void 0:Y.clientY)??0):S.current=!1)},o=U=>{var Q;if(!S.current||d)return;const Y=((Q=U.touches[0])==null?void 0:Q.clientY)??0,R=Math.max(0,Y-C.current);if(R>0){const X=Math.min(g,R*.5);w(X)}},I=async()=>{try{if(v(!0),a)await a();else{window.location.reload();return}}finally{setTimeout(()=>{v(!1),w(0)},400)}},F=()=>{!S.current||d||(m>=P?I():w(0),S.current=!1)};return k.addEventListener("touchstart",E,{passive:!0}),k.addEventListener("touchmove",o,{passive:!0}),k.addEventListener("touchend",F),k.addEventListener("touchcancel",F),()=>{k.removeEventListener("touchstart",E),k.removeEventListener("touchmove",o),k.removeEventListener("touchend",F),k.removeEventListener("touchcancel",F)}},[m,d,a]);const{showBack:u,onBack:T}=b.useMemo(()=>{const k=r.pathname;if(/^\/mp\/feed\/.+/.test(k))return{showBack:!0,onBack:()=>l("/mp/feed")};if(/^\/md\/feed\/.+/.test(k))return{showBack:!0,onBack:()=>l("/md/feed")};if(/^\/md\/queues\/.+/.test(k))return{showBack:!0,onBack:()=>l("/md/queues")};if(k==="/profile"||k.startsWith("/profile/")){const g=n==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?l(-1):l(g)}}}return{showBack:!1,onBack:()=>{}}},[r.pathname,l,n]);return e.jsxs("div",{className:`mobile-page-header ${c?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${c?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:u?e.jsx("button",{className:"icon-link",onClick:T,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ae,{size:18})}):e.jsx(q,{to:"/profile",className:"icon-link","aria-label":"Profile",children:s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"var(--hover-overlay-strong)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:(()=>{const k=r.pathname;let g=null;return k==="/mp/feed"?g="mappi-feed":k==="/md/feed"?g="moddi-feed":k==="/md/queues"?g="moddi-queues":k.startsWith("/md/queues/")&&(g="moddi-queue-detail"),g?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:y,className:"icon-link","aria-haspopup":"dialog","aria-expanded":f,onClick:()=>p(P=>!P),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(rt,{size:18})}),f&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(Et,{context:g,onClose:()=>p(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:d||m>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(m,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${d?"spin":m>60?"ready":""}`})})]})}function ls({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function os(){const t=ne(),{lastSection:a}=te(),s=t.pathname==="/"||t.pathname==="/about",r=t.pathname==="/editor",l=t.pathname.startsWith("/mp/")||!s&&!t.pathname.startsWith("/md/")&&a==="mappi",n=t.pathname.startsWith("/md/")||!s&&!t.pathname.startsWith("/mp/")&&a==="moddi",c=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";return{isNeutralPage:s,isEditor:r,isMappi:l,isModdi:n,isQueueDetail:c}}function cs(t){const a=ce(),s=ne(),{setPreviousLocation:r}=te(),l=N.useRef(0),n=N.useRef(0),c=N.useRef(null),x=500,m=2e3;return N.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),d=>{d.preventDefault();const v=Date.now();if(!(v<n.current)){if(c.current&&l.current>0){const S=v-l.current;if(S<x&&S>0){clearTimeout(c.current),c.current=null,n.current=v+m,l.current=0,r(s.pathname),a("/editor");return}}c.current&&(clearTimeout(c.current),c.current=null),l.current=v,c.current=setTimeout(()=>{n.current=Date.now()+m,c.current=null,l.current=0,a(t?"/mp/feed":"/md/feed")},x)}}}function ds(){const t=ne(),{notify:a}=de(),{data:s}=le(),{lastSection:r,setLastSection:l}=te(),{isNeutralPage:n,isEditor:c,isMappi:x,isModdi:m}=os(),w=cs(m);b.useEffect(()=>{t.pathname.startsWith("/mp/")?l("mappi"):t.pathname.startsWith("/md/")&&l("moddi")},[t.pathname,l]);const[d,v]=b.useState(null);b.useEffect(()=>{!s||!s.is_mod||(async()=>{try{const f=await z(M.admin.debugState,{requireAuth:!1}),p=Array.isArray(f==null?void 0:f.counts)?f.counts.find(y=>String(y.status)==="ready"):null;p&&v(Number(p.c)||0)}catch{}})()},[s]),b.useEffect(()=>{s&&!localStorage.getItem("welcomed")&&(a(`Welcome, ${s.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[s,a]),b.useEffect(()=>{if(typeof window>"u"||!ae()||t.pathname==="/editor")return;const p=document.querySelector(".page");p&&(p.scrollTop=0)},[t.pathname]);const{showMobileHeader:S,headerTitle:C}=b.useMemo(()=>{const f=t.pathname;if(f==="/"||f==="/about"||f==="/editor"||f==="/mp/discover"||f==="/mobile")return{showMobileHeader:!1,headerTitle:""};const p=f.split("/").filter(Boolean),y=p[0]||"",u=p[1]||"";if(y==="mp"){if(u==="discover")return{showMobileHeader:!0,headerTitle:"Discover"};if(u==="feed")return{showMobileHeader:!0,headerTitle:p.length>2?"Post":"Feed"}}if(y==="md"){if(u==="feed")return{showMobileHeader:!0,headerTitle:p.length>2?"Post":"Feed"};if(u==="queues")return{showMobileHeader:!0,headerTitle:p.length>2?"Queue":"Queues"};if(u==="notifications")return{showMobileHeader:!0,headerTitle:"Notifications"}}return y==="profile"?{showMobileHeader:!0,headerTitle:"Profile"}:f==="/settings"?{showMobileHeader:!0,headerTitle:"Settings"}:f==="/moderation"?{showMobileHeader:!0,headerTitle:"Moderation"}:{showMobileHeader:!0,headerTitle:""}},[t.pathname]);return e.jsxs("div",{className:"app-shell","data-section":m?"moddi":x?"mappi":r==="moddi"?"moddi":r==="mappi"?"mappi":void 0,children:[e.jsx(Kt,{paused:t.pathname==="/editor"}),e.jsx(ns,{isNeutralPage:n,isEditor:c,isMappi:x,isModdi:m,onCoinFlipClick:w}),e.jsxs("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:[S&&e.jsx(rs,{title:C}),t.pathname==="/about"?e.jsx("div",{className:"card",children:e.jsx(Se,{})}):e.jsx(Se,{})]}),t.pathname!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(ls,{readyCount:d})}),t.pathname!=="/mobile"&&e.jsx(Gt,{})]})}const us="theme";function ms(){try{const t=localStorage.getItem(us);if(t==="light"||t==="dark")return t}catch{}return null}function Ie(t){if(!(typeof document>"u")){document.documentElement.setAttribute("data-theme",t);try{const a=document.querySelector('meta[name="theme-color"]');a&&(a.content=t==="light"?"#ffffff":"#1a1a1a")}catch{}}}function ps(t="dark"){const a=ms()||t;Ie(a)}function hs(){const{data:t,isLoading:a}=le(),s=!!t,r=ce(),{lastSection:l}=te(),[n,c]=b.useState(!1);return b.useEffect(()=>{if(typeof window>"u")return;const x=localStorage.getItem("hide_mobile_install_prompt")==="1",m=ae()&&!ge()&&!x;c(m)},[]),b.useEffect(()=>{ge()&&r(l==="moddi"?"/md/feed":"/mp/feed",{replace:!0})},[l,r]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: var(--panel);
          color: var(--text);
          border: 1px solid var(--border);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: var(--border-strong);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!s&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),s&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions landing-actions-desktop",children:[e.jsx(q,{to:"/mp/feed",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(q,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]}),!s&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=me+M.auth.login},disabled:a,children:a?"Checking…":"Login with osu!"})}),s&&e.jsxs("div",{className:"landing-actions landing-actions-mobile",children:[e.jsx(q,{to:"/mp/feed",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(q,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]}),n&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px",boxShadow:"0 6px 24px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{c(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(q,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}function fs(){const{data:t}=le(),{modeFilters:a}=te(),s=Object.entries(a).filter(([l,n])=>n).map(([l])=>l),r=s.length?s.join(","):"standard";return lt({queryKey:["mappi","feed",r],queryFn:async({pageParam:l=0})=>{const n=new URLSearchParams({limit:"20",offset:String(l),modes:r}),c=`${M.feed.recent}?${n.toString()}`;return await z(c)},enabled:!!t,initialPageParam:0,getNextPageParam:(l,n)=>{var m;const c=n.reduce((w,d)=>{var v;return w+(((v=d.items)==null?void 0:v.length)||0)},0);return(((m=l.items)==null?void 0:m.length)||0)===20?c:void 0}})}function xs(){const t=ne(),a=ot(),{data:s}=le(),{modeFilters:r}=te(),{data:l,fetchNextPage:n,hasNextPage:c,isFetching:x,isFetchingNextPage:m,refetch:w}=fs(),d=N.useMemo(()=>(l==null?void 0:l.pages.flatMap(u=>u.items||[]))||[],[l]),v=N.useMemo(()=>{const u=Object.entries(r).filter(([k,g])=>g).map(([k])=>k.toLowerCase()),T=new Set(u.length?u:["standard"]);return d.filter(k=>{const g=String(k.mode||"standard").toLowerCase();return T.has(g)})},[d,r]);N.useEffect(()=>{t.pathname==="/mp/feed"&&w()},[t.pathname,w]),N.useEffect(()=>{const u=()=>{w()};return window.addEventListener("filterchange",u),()=>window.removeEventListener("filterchange",u)},[w]);const S=u=>{a.setQueryData(["mappi","feed"],T=>T&&{...T,pages:T.pages.map(k=>({...k,items:k.items.map(g=>g.id===u.id?u:g)}))})},C=u=>{a.setQueryData(["mappi","feed"],T=>T&&{...T,pages:T.pages.map(k=>({...k,items:k.items.filter(g=>g.id!==u)}))})},f=()=>{w()},p=x&&!m,y=c??!1;return e.jsxs("div",{className:"feed-container mappi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(At,{section:"mappi",onUpload:f})]}),e.jsx(_t,{section:"mappi",onUpload:f}),e.jsx(Lt,{context:"mappi-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[v.length===0&&!p&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),v.map(u=>e.jsx(bt,{post:u,section:"mappi",onUpdate:S,onDelete:C,me:s},u.id)),v.length>0&&y&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>n(),disabled:m,children:m?"Loading...":"Load more"})})]})})]})}function Te(t){if(!t)return"standard";const a=String(t).toLowerCase().trim();return a==="osu"||a==="0"||a==="standard"?"standard":a==="taiko"||a==="1"?"taiko":a==="catch"||a==="fruits"||a==="2"?"catch":a==="mania"||a==="3"?"mania":"standard"}const gs=({open:t,onClose:a,videoId:s,initialDescription:r,initialBeatmapUrl:l,onSave:n})=>{const[c,x]=N.useState(r||""),[m,w]=N.useState(l||""),[d,v]=N.useState(null),[S,C]=N.useState(null),[f,p]=N.useState(""),[y,u]=N.useState(!1),T=N.useRef(0);N.useEffect(()=>{t&&(x(r||""),w(l||""),v(null),C(null),p(""))},[t,r,l]),N.useEffect(()=>{if(!t)return;T.current&&window.clearTimeout(T.current);const g=(m||"").trim();if(!g){p(""),v(null),C(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(g)){p(""),v(null),C(null);return}return T.current=window.setTimeout(async()=>{var E;try{let o;try{o=new URL(g)}catch{p("Invalid URL format");return}const I=o.hash.match(/#osu\/(\d+)/),F=I?I[1]:null;o.hash="";const Y={url:o.toString()};F&&(Y.beatmap_id=F);const R=await z(M.osu.resolveBeatmap+re(Y),{requireAuth:!1}),Q=Array.isArray(R==null?void 0:R.diffs)?R.diffs:[];if(!Q.length&&!R.setId){p("No difficulties found"),v(null),C(null);return}if(v({setId:Number(R.setId)||0,beatmapId:R.beatmapId??null,title:String(R.title||""),artist:String(R.artist||""),mapper:String(R.mapper||""),diffs:Q}),Q.length>0){const X=Number.isFinite(Number(R.beatmapId))?Number(R.beatmapId):Number((E=Q[0])==null?void 0:E.id),D=Q.find(K=>Number(K.id)===X)||Q[0],V=Te(D==null?void 0:D.mode);C({beatmapId:Number(D==null?void 0:D.id)||null,version:String((D==null?void 0:D.version)||""),mode:V})}p("")}catch(o){p(`Failed to resolve: ${(o==null?void 0:o.message)||"Unknown error"}`),v(null),C(null)}},400),()=>{T.current&&window.clearTimeout(T.current)}},[m,t]);const k=async()=>{if(!y){u(!0);try{await z(M.videos.update(s),{method:"PATCH",body:JSON.stringify({description:c.slice(0,100),beatmap_url:m.trim()||void 0})});const g=!!m.trim();if(d||!g)try{await z(M.videos.update(s)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:g&&d&&d.setId>0?d.setId:null,beatmap_id:g&&(S!=null&&S.beatmapId)?S.beatmapId:null,beatmap_version:g&&(S!=null&&S.version)?S.version:null,beatmap_title:g&&(d!=null&&d.title)?d.title:null,beatmap_artist:g&&(d!=null&&d.artist)?d.artist:null,beatmap_mapper:g&&(d!=null&&d.mapper)?d.mapper:null,beatmap_url:g?m.trim():null})})}catch(E){console.warn("Failed to update beatmap metadata:",E)}n(c,m.trim()||null),a()}catch(g){alert((g==null?void 0:g.message)||"Failed to update post")}finally{u(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:g=>g.target===g.currentTarget&&a(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:a}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:a,"aria-label":"Close",children:e.jsx(Le,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:c,onChange:g=>x(g.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),d?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[d.artist," – ",d.title]}),e.jsxs("span",{className:"muted",children:["by ",d.mapper]})]}),e.jsx("select",{value:(S==null?void 0:S.beatmapId)??d.beatmapId??void 0,onChange:g=>{const P=Number(g.target.value),E=(d==null?void 0:d.diffs.find(o=>Number(o.id)===P))||null;if(E){const o=Te(E.mode);C({beatmapId:P,version:E.version,mode:o})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"},children:d.diffs.map(g=>e.jsxs("option",{value:g.id,children:[g.version," (",g.mode,")"]},g.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{v(null),C(null),w("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:m,onChange:g=>w(g.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}}),f&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:f})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:a,disabled:y,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:k,disabled:y,children:y?"Saving...":"Save"})]})]})]})]}):null};function Ee(){const t=ct(),a=ce(),{notify:s}=de(),[r,l]=N.useState(null),[n,c]=N.useState(null),[x,m]=N.useState(""),[w,d]=N.useState([]),[v,S]=N.useState([]),[C,f]=N.useState([]),[p,y]=N.useState(""),[u,T]=N.useState(null),[k,g]=N.useState([]),[P,E]=N.useState(null),[o,I]=N.useState(""),[F,U]=N.useState([]),[Y,R]=N.useState(null),[Q,X]=N.useState(!1),D=N.useMemo(()=>{const h=t.id?Number(t.id):null;return h?r?r.id===h:!1:!0},[t.id,r]);function V(h){const L=h.stream_uid||String(h.id),_=t.id?`/profile/${t.id}`:"/profile";a(`/mp/feed/${L}`,{state:{returnTo:_}})}N.useEffect(()=>{(async()=>{try{const h=await z(M.auth.me,{requireAuth:!1});l(h),h&&Array.isArray(h.inspirations)&&g(h.inspirations)}catch(h){m((h==null?void 0:h.message)||"Not logged in")}})()},[]),N.useEffect(()=>{(async()=>{try{const h=t.id?Number(t.id):null;if(h){const L=await z(M.users.get(h),{requireAuth:!1});c(L),y(L.about||""),Array.isArray(L.inspirations)&&g(L.inspirations);const _=await z(M.users.videos(h)+re({limit:"60"}),{requireAuth:!1});f(_.items||[]);const $=await z(M.users.likes(h)+re({limit:"60"}),{requireAuth:!1});S($.items||[])}else{if(!r)return;c(r),y(r.about||""),Array.isArray(r.inspirations)&&g(r.inspirations);const L=await z(M.users.myVideos+re({limit:"50"}),{requireAuth:!1});d(L.items||[]);const _=await z(M.users.likes(r.id)+re({limit:"60"}),{requireAuth:!1});S(_.items||[])}}catch{}})()},[t.id,r]),N.useEffect(()=>{X(!1)},[n==null?void 0:n.id]);async function K(h){try{const _=(await z(M.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:h})})).user||n;c(_),Array.isArray(_==null?void 0:_.inspirations)&&g(_.inspirations),t.id||l(_)}catch{}}return N.useEffect(()=>{let h;return P!==null&&o.trim().length>=2?h=setTimeout(async()=>{try{const L=await z(M.osu.usersSearch(o),{requireAuth:!1});U(Array.isArray(L.items)?L.items:[])}catch{}},250):U([]),()=>{h&&clearTimeout(h)}},[o,P]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:n?e.jsxs(e.Fragment,{children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[n.username,n.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${n.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:h=>h.currentTarget.style.opacity="1",onMouseLeave:h=>h.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(dt,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",n.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!D&&k.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),k.map((h,L)=>D?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>R(h.id),onMouseLeave:()=>R(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const _=k.filter(($,ie)=>ie!==L);g(_),K(_)},children:e.jsx("img",{src:h.avatar_url,alt:h.username})}),Y===h.id&&e.jsxs("div",{className:"insp-tooltip",children:[h.username," — click to remove"]})]},h.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>R(h.id),onMouseLeave:()=>R(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${h.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:h.avatar_url,alt:h.username})}),Y===h.id&&e.jsx("div",{className:"insp-tooltip",children:h.username})]},h.id)),D&&k.length<3&&new Array(3-k.length).fill(0).map((h,L)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>R(-L-1),onMouseLeave:()=>R(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{E(L),I(""),U([])},children:"+"}),Y===-L-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),P===L&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:o,onChange:_=>I(_.target.value)}),e.jsxs("div",{className:"insp-results",children:[F.length===0&&o.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),F.map(_=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(_.id)){s("Kinda based, but no.",{variant:"warn"}),E(null);return}if(k.some(ie=>ie.id===_.id)){E(null);return}const $=[...k,{id:_.id,username:_.username,avatar_url:_.avatar_url}].slice(0,3);g($),E(null),K($)},children:[e.jsx("img",{src:_.avatar_url,alt:"avatar"}),e.jsx("span",{children:_.username})]},_.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>E(null),children:"Close"})]})]},`slot-${L}`))]}),D&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:x||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),D?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:p,onChange:h=>y(h.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const h=await z(M.auth.me,{method:"PATCH",body:JSON.stringify({about:p})});c(h.user||n),l(h.user||r)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(xe,{size:16})})]})}):(()=>{const h=((n==null?void 0:n.about)||"").trim()||"No bio.",L=h.length>200,_=L&&!Q?h.slice(0,200)+"...":h;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:_}),L&&e.jsx("button",{onClick:()=>X(!Q),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:Q?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(ut,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Me,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:h=>{const L=h.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach($=>{$.classList.remove("active"),$.setAttribute("aria-selected","false")}),h.currentTarget.classList.add("active"),h.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:h=>{const L=h.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach($=>{$.classList.remove("active"),$.setAttribute("aria-selected","false")}),h.currentTarget.classList.add("active"),h.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(D?w:C).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(D?w:C).map(h=>(D&&n?(n.id,n.username,n.avatar_url,n.is_admin,n.is_mod):h.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>V({...h}),children:[h.poster_url?e.jsx("img",{className:"recent-thumb",src:h.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(mt,{size:12}),e.jsx("span",{children:h.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(pt,{size:12}),e.jsx("span",{children:h.comments_count??0})]})]})})]},h.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[v.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),v.map(h=>{var L,_;return e.jsxs("button",{className:"recent-cell",onClick:()=>V(h),children:[h.poster_url?e.jsx("img",{className:"recent-thumb",src:h.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((L=h.uploader)==null?void 0:L.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:h.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(_=h.uploader)==null?void 0:_.username})]})]},h.id)})]})})})]})]}),u&&e.jsx(gs,{open:!!u,onClose:()=>T(null),videoId:u.id,initialDescription:u.description,initialBeatmapUrl:u.beatmap_url,onSave:(h,L)=>{d(w.map(_=>_.id===u.id?{..._,description:h||null,beatmap_url:L}:_)),T(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: var(--hover-overlay); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid var(--divider); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed var(--divider); background: transparent; color: var(--text); font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: var(--border-strong); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid var(--divider);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid var(--divider); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel-dark); color: var(--text); outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: var(--text); cursor: pointer; text-align: left; }
        .insp-result:hover { background: var(--hover-overlay); border-color: var(--divider); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--divider); background: var(--hover-overlay); color: var(--text); cursor: pointer; }
      `})]})}function vs(){var L,_,$,ie,oe;const[t,a]=N.useState(null),[s,r]=N.useState([]),[l,n]=N.useState(""),[c,x]=N.useState([]),[m,w]=N.useState(null),[d,v]=N.useState([]),[S,C]=N.useState("all"),[f,p]=N.useState("approvals"),[y,u]=N.useState(null),[T,k]=N.useState(""),[g,P]=N.useState(!1),{notify:E}=de(),[o,I]=N.useState(null),[F,U]=N.useState(!1);N.useEffect(()=>{(async()=>{try{const i=await z(M.auth.me,{requireAuth:!1});if(a(i),i!=null&&i.is_admin)try{const A=await z(M.admin.settingsModeration,{requireAuth:!1});u(!!A.require_approval)}catch{}}catch{}try{const i=await z(M.admin.videosPending+re({limit:"50"}),{requireAuth:!1});r(i.items||[])}catch{}})()},[]);async function Y(){U(!0);try{const i=await z(M.admin.analytics,{requireAuth:!1});I(i)}finally{U(!1)}}async function R(){try{const i=await z(M.admin.usersSearch(l),{requireAuth:!1});x(i.items||[])}catch{}}async function Q(i){w(i),v([]);try{const A=await z(M.admin.userVideos(i.id)+re({limit:"50"}),{requireAuth:!1});v(A.items||[])}catch{}}async function X(i,A){try{const G=await z(M.admin.user(i.id),{method:"PATCH",body:JSON.stringify({is_mod:A})}),O=(G==null?void 0:G.user)||{...i,is_mod:A};E(A?"Granted moderation":"Revoked moderation",{variant:A?"success":"warn"}),w(O),x(c.map(se=>se.id===i.id?O:se))}catch{alert("Failed to update")}}const D=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),V=!!(t!=null&&t.is_admin);if(!D)return e.jsx("div",{className:"muted",children:"You do not have access."});const K=s.filter(i=>!i.flagged_only),h=s.filter(i=>!!i.flagged_only);return e.jsx("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"muted moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:ae()?"nowrap":"wrap",gap:ae()?"2px":"4px",overflowX:ae()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":f==="approvals",className:`profile-tab ${f==="approvals"?"active":""}`,"data-tab":"approvals",onClick:i=>{const A=i.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),p("approvals")},children:"Approvals"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":f==="manage",className:`profile-tab ${f==="manage"?"active":""}`,"data-tab":"manage",onClick:i=>{const A=i.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),p("manage")},children:"Manage"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":f==="analytics",className:`profile-tab ${f==="analytics"?"active":""}`,"data-tab":"analytics",onClick:i=>{const A=i.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),p("analytics"),o||Y()},children:"Analytics"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":f==="message",className:`profile-tab ${f==="message"?"active":""}`,"data-tab":"message",onClick:i=>{const A=i.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","message"),p("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":f,children:[e.jsx("div",{className:"panel approvals",hidden:f!=="approvals",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[K.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[K.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),K.map(i=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[i.poster_url?e.jsx("img",{src:i.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",i.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await z(M.admin.videosReject(i.id),{method:"POST"}),r(s.filter(A=>A.id!==i.id)),E("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await z(M.admin.videosApprove(i.id),{method:"POST"}),r(s.filter(A=>A.id!==i.id)),E("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await z(M.videos.delete(i.id),{method:"DELETE"}),r(s.filter(A=>A.id!==i.id)),E("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[h.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[h.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),h.map(i=>e.jsxs("div",{className:"col moderation-video-card flagged",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[i.poster_url?e.jsx("img",{src:i.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",i.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]})]}),e.jsx("div",{className:"row",children:e.jsx("button",{className:"btn secondary",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await z(M.videos.delete(i.id),{method:"DELETE"}),r(s.filter(A=>A.id!==i.id)),E("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},i.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:f!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:l,onChange:i=>n(i.target.value),onKeyDown:i=>{i.key==="Enter"&&R()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:R,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:c.map(i=>e.jsxs("button",{className:"btn secondary moderation-user-result",onClick:()=>Q(i),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center"},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),i.is_admin?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"admin"}):i.is_mod?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"mod"}):i.is_blacklisted?e.jsx("span",{style:{color:"#f87171",fontSize:12,flexShrink:0},children:"blacklisted"}):null]},i.id))})})]}),m?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flexWrap:"wrap"},children:[m.avatar_url&&e.jsx("img",{src:m.avatar_url,width:40,height:40,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:4},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:m.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",m.id," • osu ",m.osu_user_id]})]})]}),e.jsxs("div",{className:"col",style:{gap:10},children:[V&&!m.is_admin&&(m.is_mod?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>X(m,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>X(m,!0),children:"Grant moderation"})),!m.is_admin&&(m.is_blacklisted?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await z(M.admin.user(m.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),w({...m,is_blacklisted:!1}),E("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await z(M.admin.user(m.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),w({...m,is_blacklisted:!0}),E("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),m.is_admin&&e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"})]}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>C("all"),children:"All"}),e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>C("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[d.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),d.filter(i=>{if(S==="all")return!0;const A=(y?!i.approved_at:!1)&&i.status==="ready",G=!!i.needs_review;return A||G}).map(i=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[i.poster_url?e.jsx("img",{src:i.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:[i.status.toUpperCase()," • ",new Date(i.created_at*1e3).toLocaleString()]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,y&&!i.approved_at&&i.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:14},children:i.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)",fontSize:16},children:"★"})]}),e.jsxs("div",{className:"row",style:{gap:8},children:[(V||(t==null?void 0:t.is_mod))&&(!!i.needs_review||y&&!i.approved_at&&i.status==="ready")&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await z(M.admin.videosApprove(i.id),{method:"POST"}),v(d.map(A=>A.id===i.id?{...A,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:A)),E("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await z(M.videos.delete(i.id),{method:"DELETE"}),v(d.filter(A=>A.id!==i.id)),E("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]})]},i.id))]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:f!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:l,onChange:i=>n(i.target.value),onKeyDown:i=>{i.key==="Enter"&&R()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:R,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:c.map(i=>e.jsxs("button",{className:`btn secondary moderation-user-result ${(m==null?void 0:m.id)===i.id,""}`,onClick:()=>w(i),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center",border:(m==null?void 0:m.id)===i.id?"2px solid var(--accent)":void 0},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),(m==null?void 0:m.id)===i.id&&e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"selected"})]},i.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:g,onChange:i=>P(i.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",width:"100%",fontSize:16,color:"inherit",fontFamily:"inherit"},value:T,onChange:i=>k(i.target.value)}),e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const i=(T||"").trim();if(!i){alert("Enter a message");return}(async()=>{try{const A={text:i,global:g};!g&&(m!=null&&m.id)&&(A.user_id=m.id),await z(M.admin.notificationsSystem,{method:"POST",body:JSON.stringify(A)}),k(""),E("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:f!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Analytics"}),F&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!F&&!o&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(ee,{label:"Users",value:o.totals.users_total}),e.jsx(ee,{label:"Admins",value:o.totals.users_admin}),e.jsx(ee,{label:"Mods",value:o.totals.users_mod}),e.jsx(ee,{label:"Blacklisted",value:o.totals.users_blacklisted}),e.jsx(ee,{label:"Videos",value:o.totals.videos_total}),e.jsx(ee,{label:"Ready",value:o.totals.videos_ready}),e.jsx(ee,{label:"Pending",value:o.totals.pending_count}),e.jsx(ee,{label:"Purgatory",value:o.totals.purgatory_count}),e.jsx(ee,{label:"Likes",value:o.totals.likes_total}),e.jsx(ee,{label:"Flags",value:o.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(fe,{title:"New users (30d)",series:o.series.users,color:"#60a5fa"}),e.jsx(fe,{title:"New videos (30d)",series:o.series.videos,color:"#34d399"}),((_=(L=o.stream)==null?void 0:L.graphql)==null?void 0:_.minutes_viewed)&&o.stream.graphql.minutes_viewed.length>0&&e.jsx(fe,{title:"Minutes viewed (30d)",series:o.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",o.feed.count," items in rotation",o.feed.cursor?` • cursor ${o.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",o.stream.approximate.total_duration_sec," • ready videos: ",o.stream.approximate.videos_ready]}),o.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",o.stream.api.ok?"ok":"unavailable",(ie=($=o.stream.api)==null?void 0:$.result_info)!=null&&ie.count?` • count ${o.stream.api.result_info.count}`:"",(oe=o.stream.api)!=null&&oe.sample_status?` • sample status ${String(o.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})})}function ee({label:t,value:a}){return e.jsxs("div",{className:"col moderation-stat-card",children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",style:{fontSize:"clamp(18px, 4vw, 20px)"},children:a})]})}function fe({title:t,series:a,color:s}){const[r,l]=N.useState(()=>ae());N.useEffect(()=>{const o=()=>l(ae());return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const n=r?Math.min(400,window.innerWidth-48):400,c=160,x=8,m=8,w=28,d=r?36:42,v=a.map(o=>o.count),S=Math.max(1,...v),C=N.useMemo(()=>{const o=S,I=Math.pow(10,Math.floor(Math.log10(o))),F=o/I;return(F<=1?1:F<=2?2:F<=5?5:10)*I},[S]),f=n-d-m,p=c-x-w,y=N.useMemo(()=>a.map((o,I)=>{const F=d+I/Math.max(1,a.length-1)*f,U=x+(1-o.count/(C||1))*p;return[F,U]}),[a,C,f,p]),u=N.useMemo(()=>y.map((o,I)=>I===0?`M ${o[0]} ${o[1]}`:`L ${o[0]} ${o[1]}`).join(" "),[y]),T=[0,.25,.5,.75,1],k=N.useMemo(()=>{if(a.length===0)return[];const o=[0,.25,.5,.75,1].map(I=>Math.min(a.length-1,Math.round(I*(a.length-1))));return Array.from(new Set(o))},[a]),g=o=>{if(!o||o.length<10)return o||"";const I=o.slice(5,7).replace(/^0/,""),F=o.slice(8,10).replace(/^0/,"");return`${I}/${F}`};function P(o){const I=Number.isInteger(o);return o>=1e6?`${(o/1e6).toFixed(1).replace(/\.0$/,"")}M`:o>=1e3?`${(o/1e3).toFixed(1).replace(/\.0$/,"")}k`:I?String(o):o<10?o.toFixed(1):o.toFixed(1).replace(/\.0$/,"")}const E=a.length?a[a.length-1].count:0;return e.jsxs("div",{className:"col moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:r?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:r?11:12},children:["latest: ",P(E)]})]}),e.jsx("div",{style:{width:"100%",overflowX:"auto"},children:e.jsxs("svg",{width:n,height:c,role:"img","aria-label":t,style:{display:"block"},children:[e.jsx("rect",{x:0,y:0,width:n,height:c,rx:12,style:{fill:"var(--panel-dark)"}}),T.map((o,I)=>{const F=x+(1-o)*p,U=o*C;return e.jsxs("g",{children:[e.jsx("line",{x1:d,y1:F,x2:n-m,y2:F,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:d-6,y:F+4,textAnchor:"end",fontSize:10,style:{fill:"var(--muted)"},children:P(U)})]},I)}),e.jsx("line",{x1:d,y1:x,x2:d,y2:x+p,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),e.jsx("line",{x1:d,y1:x+p,x2:d+f,y2:x+p,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),k.map((o,I)=>{var U;const F=d+o/Math.max(1,a.length-1)*f;return e.jsxs("g",{children:[e.jsx("line",{x1:F,y1:x,x2:F,y2:x+p,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:F,y:x+p+12,textAnchor:"middle",fontSize:10,style:{fill:"var(--muted)"},children:g((U=a[o])==null?void 0:U.day)})]},I)}),e.jsx("path",{d:u,fill:"none",stroke:s,strokeWidth:2}),y.length>0&&e.jsx("circle",{cx:y[y.length-1][0],cy:y[y.length-1][1],r:3,fill:s})]})})]})}function bs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function ys(t){const a="=".repeat((4-t.length%4)%4),s=(t+a).replace(/-/g,"+").replace(/_/g,"/"),r=atob(s),l=new Uint8Array(r.length);for(let n=0;n<r.length;n++)l[n]=r.charCodeAt(n);return l}async function ue(){return!("serviceWorker"in navigator)||!("PushManager"in window)?null:(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function js(){try{const t=await fetch(`${me}/api/push/public_key`,{credentials:"include"});if(!t.ok)return null;const a=await t.json().catch(()=>null);return a&&typeof a.publicKey=="string"?a.publicKey:null}catch{return null}}async function Ns(t){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)||await Notification.requestPermission()!=="granted")return!1;const r=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ys(t)});try{await z(M.user.pushSubscribe,{method:"POST",body:JSON.stringify({...r.toJSON(),ua:navigator.userAgent})})}catch{}return!0}async function ws(){const t=await ue();if(!t)return!0;try{await z(M.user.pushUnsubscribe,{method:"POST",body:JSON.stringify({endpoint:t.endpoint})})}catch{}try{await t.unsubscribe()}catch{}return!0}function ks(){const{theme:t,setTheme:a}=te(),{data:s}=le(),{notify:r}=de(),[l,n]=b.useState("general"),[c,x]=b.useState(!1),[m,w]=b.useState(!1),[d,v]=b.useState(!1),[S,C]=b.useState(typeof Notification<"u"?Notification.permission:"default"),f=p=>{a(p),Ie(p)};return b.useEffect(()=>{x(typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),w(ge()),ue().then(p=>v(!!p)).catch(()=>v(!1)),typeof Notification<"u"&&C(Notification.permission)},[]),e.jsxs("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Settings"}),e.jsx("div",{className:"muted moderation-description",children:"Personalize appearance and app behavior."})]})}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Settings",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Settings tabs",children:[e.jsx("button",{role:"tab","aria-selected":l==="general",className:`profile-tab ${l==="general"?"active":""}`,"data-tab":"general",onClick:p=>{const y=p.currentTarget.closest(".profile-tabs-unified"),u=y==null?void 0:y.querySelector(".profile-tabs-content");u==null||u.setAttribute("data-active","general"),n("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":l==="notifications",className:`profile-tab ${l==="notifications"?"active":""}`,"data-tab":"notifications",onClick:p=>{const y=p.currentTarget.closest(".profile-tabs-unified"),u=y==null?void 0:y.querySelector(".profile-tabs-content");u==null||u.setAttribute("data-active","notifications"),n("notifications")},children:"Notifications"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":l,children:[e.jsx("div",{className:"panel general settings-panel",children:e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-section-title",children:"Appearance"}),e.jsxs("div",{className:"settings-row",children:[e.jsx("span",{className:"settings-label",children:"Theme"}),e.jsxs("div",{className:"settings-toggle-group",role:"group","aria-label":"Theme selection",children:[e.jsx("button",{type:"button",className:`btn ${t==="dark"?"":"secondary"}`,"aria-pressed":t==="dark",onClick:()=>f("dark"),children:"Dark"}),e.jsx("button",{type:"button",className:`btn ${t==="light"?"":"secondary"}`,"aria-pressed":t==="light",onClick:()=>f("light"),children:"Light"})]})]}),e.jsx("div",{className:"settings-hint",children:"The selected theme is saved on this device."})]})}),e.jsxs("div",{className:"panel settings-panel",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-section-title",children:"Push Notifications"}),!c&&e.jsx("div",{className:"settings-hint",children:"Push notifications are not supported on this device."}),c&&!m&&e.jsx("div",{className:"settings-hint",children:"On iOS, install the app to your Home Screen to enable push."}),c&&e.jsx("div",{className:"settings-row",children:S!=="granted"||!d?e.jsx("button",{className:"btn secondary",onClick:async()=>{const p=await js();if(!p)return;await Ns(p),C(typeof Notification<"u"?Notification.permission:"default");const y=await ue();v(!!y)},title:m?void 0:"On iOS, install as PWA to enable",children:"Enable push notifications"}):S==="granted"&&d?e.jsx("button",{className:"btn secondary",onClick:async()=>{await ws();const p=await ue();v(!!p),C(typeof Notification<"u"?Notification.permission:"default")},children:"Disable push notifications"}):null})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-section-title",children:"Notification Types"}),e.jsx(Ss,{})]})]})]})]})]})}function Ss(){const{notify:t}=de(),[a,s]=b.useState(!0),[r,l]=b.useState(!1),[n,c]=b.useState({star:!0,likes5:!0,comment:!0,inspiration:!0,reaction:!0,system:!0,invites:!0});b.useEffect(()=>{(async()=>{s(!0);try{const d=await z(M.user.notifPrefs,{requireAuth:!0});d&&d.prefs&&c(v=>({...v,...d.prefs}))}finally{s(!1)}})()},[]);async function x(d){l(!0);try{await z(M.user.notifPrefs,{method:"POST",body:JSON.stringify(d)}),t("Preferences saved",{variant:"success"})}catch(v){t((v==null?void 0:v.message)||"Failed to save",{variant:"error"})}finally{l(!1)}}function m(d){const v={...n,[d]:!n[d]};c(v),x(v)}const w=({k:d,label:v})=>e.jsxs("div",{className:"settings-row",children:[e.jsx("span",{className:"settings-label",children:v}),e.jsx("div",{className:"settings-toggle-group",children:e.jsx("button",{className:`btn ${n[d]?"":"secondary"}`,onClick:S=>{S.preventDefault(),m(d)},children:n[d]?"On":"Off"})})]});return a?e.jsx("div",{className:"settings-hint",children:"Loading preferences…"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{k:"star",label:"Stars"}),e.jsx(w,{k:"likes5",label:"Likes milestone"}),e.jsx(w,{k:"comment",label:"Comments"}),e.jsx(w,{k:"inspiration",label:"Inspirations"}),e.jsx(w,{k:"reaction",label:"Reactions"}),e.jsx(w,{k:"invites",label:"Queue invitations"}),e.jsx(w,{k:"system",label:"System messages"}),r&&e.jsx("div",{className:"settings-hint",children:"Saving…"})]})}const Cs=()=>(N.useEffect(()=>()=>{Ht.clearAll()},[]),e.jsx($t,{}));function Ts(){const[t,a]=b.useState({mobile:!1,standalone:!1,platform:""}),[s,r]=b.useState("ios");return b.useEffect(()=>{const l=typeof navigator<"u"&&navigator.userAgent||"",n=/iPad|iPhone|iPod/i.test(l)||/(Macintosh).*Mobile/.test(l),c=/Android/i.test(l),x=n?"ios":c?"android":"other";a({mobile:ae(),standalone:!1,platform:x}),r(x==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":s==="ios",className:`profile-tab ${s==="ios"?"active":""}`,"data-tab":"ios",onClick:l=>{const n=l.currentTarget.closest(".profile-tabs-unified");n.querySelectorAll(".profile-tab").forEach(x=>{x.classList.remove("active"),x.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),n.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),r("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":s==="android",className:`profile-tab ${s==="android"?"active":""}`,"data-tab":"android",onClick:l=>{const n=l.currentTarget.closest(".profile-tabs-unified");n.querySelectorAll(".profile-tab").forEach(x=>{x.classList.remove("active"),x.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),n.querySelector(".profile-tabs-content").setAttribute("data-active","android"),r("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":s,children:[e.jsx("div",{className:"panel",hidden:s!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:s!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const Es=b.lazy(()=>Qt(()=>import("./Discover-Buy1TldR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));ps("dark");yt();"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t=encodeURIComponent(me);navigator.serviceWorker.register(`/sw.js?api=${t}`).then(a=>{console.log("Service Worker registered successfully:",a.scope)}).catch(a=>{console.error("Service Worker registration failed:",a)})});const As=()=>e.jsx(gt,{children:e.jsxs(J,{element:e.jsx(ds,{}),children:[e.jsx(J,{path:"/",element:e.jsx(hs,{})}),e.jsx(J,{path:"/mp/discover",element:e.jsx(N.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(Es,{})})}),e.jsx(J,{path:"/mp/feed",element:e.jsx(xs,{})}),e.jsx(J,{path:"/mp/feed/:uid",element:e.jsx(Nt,{})}),e.jsx(J,{path:"/md/feed",element:e.jsx(Mt,{})}),e.jsx(J,{path:"/md/feed/:uid",element:e.jsx(zt,{})}),e.jsx(J,{path:"/md/queues",element:e.jsx(Pt,{})}),e.jsx(J,{path:"/md/queues/:id",element:e.jsx(It,{})}),e.jsx(J,{path:"/md/notifications",element:e.jsx(Ft,{})}),e.jsx(J,{path:"/profile",element:e.jsx(Ee,{})}),e.jsx(J,{path:"/profile/:id",element:e.jsx(Ee,{})}),e.jsx(J,{path:"/moderation",element:e.jsx(vs,{})}),e.jsx(J,{path:"/about",element:e.jsx(bs,{})}),e.jsx(J,{path:"/settings",element:e.jsx(ks,{})}),e.jsx(J,{path:"/mobile",element:e.jsx(Ts,{})}),e.jsx(J,{path:"/editor",element:e.jsx(Cs,{})})]})}),_s=()=>e.jsx(xt,{children:e.jsx(As,{})});ht(document.getElementById("root")).render(e.jsx(Yt,{children:e.jsx(ft,{client:Jt,children:e.jsx(jt,{children:e.jsx(_s,{})})})}));export{Kt as B,Qt as _};
