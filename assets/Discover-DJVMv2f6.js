const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-Dgz2Sa0B.js","assets/index-ByI_yUEs.js","assets/vendor-react-_vsaDC62.js","assets/vendor-DBgzFpze.js","assets/editor-components-CKFEosPJ.js","assets/editor-components-Bzmrvihl.css","assets/index-Do5egyzH.css"])))=>i.map(i=>d[i]);
import{u as lt,B as dt,_ as ke}from"./index-ByI_yUEs.js";import{r as i,R as re,i as ut,j as s,b as ft,a as pt,L as Ye,p as mt,D as ht,E as gt,G as qe,I as xt,J as Xe,A as bt,c as yt}from"./vendor-react-_vsaDC62.js";import{P as wt}from"./Popup-Dgz2Sa0B.js";import{P as vt}from"./beatmap-preview-Da_UNwHS.js";import{C as jt}from"./Comment-DxGwYXlQ.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";import"./editor-lib-Cf56EpaA.js";const x="https://api.osumappi.ng",w={};function Nt(){var He,We,Ve;const[j,R]=i.useState(w.history||[]),[f,z]=i.useState(w.index||-1),t=f>=0?j[f]:null,[V,Se]=i.useState(!1),[Je,Ce]=i.useState(!1),[Ge,_e]=i.useState(!1),[oe,Y]=i.useState(!1),ie=re.useRef(null),[ae,ce]=i.useState(!1),le=re.useRef(null),[E,Qe]=i.useState(null),[de,A]=i.useState(!1),[ue,q]=i.useState(!1),fe=re.useRef(null),pe=re.useRef(null),[p,me]=i.useState(!1),[Re,Ee]=i.useState([]),[U,X]=i.useState(""),[he,ge]=i.useState(null),[xe,Ie]=i.useState(!1),[I,T]=i.useState(!0),{notify:k}=lt(),[v,O]=i.useState(w.queue||[]),N=i.useRef(w.seenIds||new Set),Te=i.useRef(new Set),be=i.useRef(!1),Ne=i.useRef(null),[$e,B]=i.useState(w.eligibleCount||null),[Me,H]=i.useState(w.viewedCount||0),[L,D]=i.useState(!1),C=i.useRef(w.lastShownVideoId||null);i.useEffect(()=>()=>{w.history=j,w.index=f,w.queue=v,w.seenIds=N.current,w.eligibleCount=$e,w.viewedCount=Me,w.lastShownVideoId=C.current},[j,f,v,$e,Me]);function P(e){var n;return(n=document.cookie.split("; ").map(r=>r.split("=")).find(([r])=>r===e))==null?void 0:n[1]}function Ke(){try{const e=Array.from(N.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function J(){try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],a=Array.from(new Set(n.filter(o=>r.includes(o))));return a.length?a:["standard"]}catch{return["standard"]}}const Ze=()=>{const e=new Set;return C.current!==null&&e.add(C.current),Array.from(N.current).slice(-200).forEach(r=>e.add(r)),v.forEach(r=>e.add(r.id)),Array.from(e)},ze=async(e=5)=>{if(be.current)return[];be.current=!0;try{const n=Ze(),r=J().join(",");if(Ne.current!==!1){const l=await fetch(`${x}/api/feed/batch?size=${e}&exclude=${encodeURIComponent(n.join(","))}&modes=${encodeURIComponent(r)}`,{credentials:"include"});if(l.status===401)return _e(!0),[];if(l.status===429)return k("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];if(l.status===404)Ne.current=!1;else if(l.ok){const u=await l.json(),g=u&&Array.isArray(u.items)?u.items:[],d=new Set,$=g.filter(h=>d.has(h.id)?!1:(d.add(h.id),!0)),y=new Set(v.map(h=>h.id)),m=$.filter(h=>!N.current.has(h.id)&&!y.has(h.id)&&h.id!==C.current);if(m.length>0&&O(h=>{const M=new Set(h.map(S=>S.id)),_=m.filter(S=>!M.has(S.id));return[...h,..._]}),m.length===0&&v.length===0)try{const h=await fetch(`${x}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(h.ok){const M=await h.json(),_=Number(M.eligible||0),S=Number(M.viewed||0);B(_),H(S),D(_>0&&S>=_)}}catch{}return m}}const a=[],o=new Set(v.map(l=>l.id));let c=[...n];for(let l=0;l<e;l++)try{const u=await fetch(`${x}/api/feed/next?exclude=${encodeURIComponent(c.join(","))}&modes=${encodeURIComponent(r)}`,{credentials:"include"});if(u.status===401){_e(!0);break}if(u.status===429){k("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(!u.ok)break;const g=await u.json(),d=g&&(g.id?g:g.video);if(!d)break;if(N.current.has(d.id)||o.has(d.id)||d.id===C.current){c.push(d.id);continue}a.push(d),c.push(d.id),o.add(d.id)}catch{break}if(a.length>0&&O(l=>{const u=new Set(l.map(d=>d.id)),g=a.filter(d=>!u.has(d.id));return[...l,...g]}),a.length===0&&v.length===0)try{const l=await fetch(`${x}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(l.ok){const u=await l.json();B(Number(u.eligible||0)),H(Number(u.viewed||0)),D(Number(u.caught_up||0)===1)}}catch{}return a}catch{return[]}finally{be.current=!1}},G=async()=>{if(!V){Se(!0);try{v.length<=2&&ze(5).catch(()=>{});let e;if(v.length>0)e=v[0],e&&O(n=>n.filter(a=>a.id!==e.id));else{const n=await ze(3);n.length>0&&(e=n[0],n.length>1&&O(r=>{const a=new Set(r.map(c=>c.id)),o=n.slice(1).filter(c=>!a.has(c.id));return[...r,...o]}))}if(e){if(C.current=e.id,N.current.add(e.id),Ke(),R(n=>{const r=[...n.slice(0,f+1),e];return z(r.length-1),r}),!Te.current.has(e.id)){Te.current.add(e.id);const n=P("csrf")||"";try{const r=await fetch(`${x}/api/videos/${e.id}/view`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":n}});if(r.ok){const a=await r.json();a&&R(o=>{const c=[...o],l=c.findIndex(u=>u.id===e.id);return l!==-1&&(c[l]={...c[l],views_count:a.views_count??c[l].views_count??0,viewed_by_me:!0}),c})}}catch{}}}else try{const n=J().join(","),r=await fetch(`${x}/api/feed/progress?modes=${encodeURIComponent(n)}`,{credentials:"include"});if(r.ok){const a=await r.json(),o=Number(a.eligible||0),c=Number(a.viewed||0);B(o),H(c),D(o>0&&c>=o)}}catch{}}finally{Se(!1)}}},ye=()=>{f>0&&(z(f-1),A(!1))},we=()=>{if(!I&&(W.current=!0,ee.current=!0,b.current)){const e=b.current;e.muted=!1,T(!1),e.play().catch(()=>{})}if(f<j.length-1){const e=j[f+1];e&&(C.current=e.id),z(f+1),A(!1);return}L||G()},Q=i.useRef(0),K=i.useRef(null),Z=i.useRef(null),ve=i.useRef({goNext:we,goPrev:ye,index:f,history:j,loading:V,exhausted:L});i.useEffect(()=>{ve.current={goNext:we,goPrev:ye,index:f,history:j,loading:V,exhausted:L}},[we,ye,f,j,V,L]),i.useEffect(()=>{const e=Be.current;if(!e)return;const n=o=>{if(e){const g=e.getBoundingClientRect(),d=o.clientX,$=o.clientY;if(d<g.left||d>g.right||$<g.top||$>g.bottom)return}o.preventDefault(),o.stopPropagation();const c=Date.now();if(c<Q.current||(Q.current=c+1e3,Math.abs(o.deltaY)<Math.abs(o.deltaX)))return;const{goNext:l,goPrev:u}=ve.current;o.deltaY>0?l():u()},r=o=>{K.current=o.touches[0].clientY,Z.current=Date.now()},a=o=>{if(K.current===null||Z.current===null)return;const c=o.changedTouches[0].clientY,l=Date.now(),u=K.current-c,g=l-Z.current;if(K.current=null,Z.current=null,Math.abs(u)<50||g>300)return;const d=Date.now();if(d<Q.current)return;Q.current=d+1e3;const{goNext:$,goPrev:y}=ve.current;u>0?$():y()};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a),window.removeEventListener("wheel",n,{capture:!0})}},[]);const et=async()=>{if(t){Ce(!0);try{const e=P("csrf")||"",n=t.liked_by_me?"DELETE":"POST",r=await fetch(`${x}/api/videos/${t.id}/like`,{method:n,credentials:"include",headers:{"X-CSRF-Token":e}});if(r.status===429){k("Please slow down a bit.",{durationMs:5e3,variant:"warn"});return}if(r.ok){const a=await r.json();R(o=>{const c=[...o];return c[f]={...c[f],liked_by_me:!t.liked_by_me,likes_count:a.likes_count},c})}}finally{Ce(!1)}}};async function Le(e){if(!t)return;const n=P("csrf")||"";(await fetch(`${x}/api/videos/${t.id}/flag`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":n},body:JSON.stringify({reason:e})})).ok?k("Thanks for your report.",{variant:"info"}):k("Report failed",{variant:"error"}),Y(!1)}i.useEffect(()=>{if(!oe)return;const e=n=>{ie.current&&!ie.current.contains(n.target)&&Y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[oe]),i.useEffect(()=>{if(!ae)return;const e=n=>{le.current&&!le.current.contains(n.target)&&ce(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ae]),i.useEffect(()=>{if(!ue)return;const e=n=>{fe.current&&!fe.current.contains(n.target)&&pe.current&&!pe.current.contains(n.target)&&q(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ue]),i.useEffect(()=>{j.length===0&&G()},[]),i.useEffect(()=>{t&&(C.current=t.id)},[t==null?void 0:t.id]),i.useEffect(()=>{(async()=>{try{const e=J().join(","),n=await fetch(`${x}/api/feed/progress?modes=${encodeURIComponent(e)}`,{credentials:"include"});if(n.ok){const r=await n.json(),a=Number(r.eligible||0),o=Number(r.viewed||0);B(a),H(o);const c=a>0&&o>=a;D(c)}}catch{}})()},[]),i.useEffect(()=>{const e=()=>{R([]),O([]),N.current.clear(),C.current=null,z(-1),D(!1),(async()=>{try{const n=J().join(","),r=await fetch(`${x}/api/feed/progress?modes=${encodeURIComponent(n)}`,{credentials:"include"});if(r.ok){const a=await r.json(),o=Number(a.eligible||0),c=Number(a.viewed||0);B(o),H(c),D(!1)}}catch{}G()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),i.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const n=JSON.parse(e);if(Array.isArray(n))for(const r of n)typeof r=="number"&&N.current.add(r)}}catch{}},[]),i.useEffect(()=>{(async()=>{try{const e=await fetch(`${x}/api/me`,{credentials:"include"});e.ok&&Qe(await e.json())}catch{}})()},[]);const W=i.useRef(!1),tt=async e=>{if(e)try{const n=e.playback_url||(e.stream_uid?`https://videodelivery.net/${e.stream_uid}/manifest/video.m3u8`:null);if(!n)return;const r=async()=>{try{const a=await fetch(n,{priority:"low"});if(a.ok){const o=await a.text(),l=new TextEncoder().encode(o).buffer,{setCached:u}=await ke(async()=>{const{setCached:y}=await import("./Popup-Dgz2Sa0B.js").then(m=>m.v);return{setCached:y}},__vite__mapDeps([0,1,2,3,4,5,6]));await u(n,l,!0,e.stream_uid);const g=o.split(`
`),d=[];let $=n.substring(0,n.lastIndexOf("/")+1);for(let y=0;y<g.length&&d.length<3;y++){const m=g[y].trim();if(m&&!m.startsWith("#")&&(m.endsWith(".ts")||m.endsWith(".m4s"))){const h=m.startsWith("http")?m:$+m;d.push(h)}}for(const y of d.slice(0,2))"requestIdleCallback"in window?requestIdleCallback(async()=>{try{const m=await fetch(y,{priority:"low"});if(m.ok){const h=await m.arrayBuffer(),{setCached:M}=await ke(async()=>{const{setCached:_}=await import("./Popup-Dgz2Sa0B.js").then(S=>S.v);return{setCached:_}},__vite__mapDeps([0,1,2,3,4,5,6]));await M(y,h,!1,e.stream_uid)}}catch{}},{timeout:5e3}):setTimeout(async()=>{try{const m=await fetch(y,{});if(m.ok){const h=await m.arrayBuffer(),{setCached:M}=await ke(async()=>{const{setCached:_}=await import("./Popup-Dgz2Sa0B.js").then(S=>S.v);return{setCached:_}},__vite__mapDeps([0,1,2,3,4,5,6]));await M(y,h,!1,e.stream_uid)}}catch{}},1e3)}}catch{}};"requestIdleCallback"in window?requestIdleCallback(r,{timeout:3e3}):setTimeout(r,500)}catch{}};i.useEffect(()=>{A(!1),me(!1),W.current?T(!1):T(!0)},[t==null?void 0:t.id]),i.useEffect(()=>{b.current&&(b.current.muted=I)},[I]),i.useEffect(()=>{if(!t)return;const e=v.length>0?v[0]:f<j.length-1?j[f+1]:null;if(e&&e.id!==t.id&&tt(e),b.current){const n=setTimeout(()=>{const r=b.current;r&&r===b.current&&(!W.current?(r.muted=!0,r.play().catch(o=>{o.name!=="AbortError"&&o.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",o)})):(r.muted=!1,T(!1),r.play().then(()=>{}).catch(o=>{o.name==="AbortError"||o.name==="NotAllowedError"||(console.debug("Unmuted play failed, falling back to muted:",o),r===b.current&&(r.muted=!0,T(!0),r.play().catch(c=>{c.name!=="AbortError"&&c.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",c)})))})))},100);return()=>clearTimeout(n)}},[t==null?void 0:t.id,v,f,j]);const ee=i.useRef(!1),nt=e=>{b.current=e,e&&(ee.current&&W.current?(e.muted=!1,T(!1),e.play().then(()=>{ee.current=!1}).catch(()=>{e.muted=!0,T(!0),ee.current=!1,e.play().catch(()=>{})})):e.muted=I)},De=async()=>{if(t!=null&&t.id)try{const e=await fetch(`${x}/api/videos/${t.id}/comments`,{credentials:"include"});if(e.ok){const n=await e.json();Ee(n.items||[])}}catch{}};i.useEffect(()=>{p&&(t!=null&&t.id)&&De()},[p,t==null?void 0:t.id]);const Pe=async e=>{if(e.preventDefault(),!(!U.trim()||!(t!=null&&t.id))){Ie(!0);try{const n=P("csrf")||"",r=await fetch(`${x}/api/videos/${t.id}/comments`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":n},body:JSON.stringify({text:U.trim(),parent_id:he||void 0})});if(r.ok)X(""),ge(null),De(),R(a=>{const o=[...a],c=o.findIndex(l=>l.id===t.id);return c!==-1&&(o[c]={...o[c],comments_count:(o[c].comments_count||0)+1}),o}),k("Comment posted!",{variant:"success"});else{const a=await r.json().catch(()=>({}));k(a.error||"Failed to post comment",{variant:"error"})}}catch{k("Failed to post comment",{variant:"error"})}finally{Ie(!1)}}},st=e=>{Ee(n=>n.filter(r=>r.id!==e)),R(n=>{const r=[...n],a=r.findIndex(o=>o.id===(t==null?void 0:t.id));return a!==-1&&(r[a]={...r[a],comments_count:Math.max(0,(r[a].comments_count||0)-1)}),r})},Fe=Re.filter(e=>!e.parent_id),te=new Map;Re.filter(e=>e.parent_id).forEach(e=>{const n=e.parent_id;te.has(n)||te.set(n,[]),te.get(n).push(e)});const b=i.useRef(null),ne=i.useRef(null),F=i.useRef(!1),rt=()=>{if(!b.current||F.current)return;const e=b.current,n=!I;T(n),e.muted=n,n||(W.current=!0),!n&&e.paused&&e.play().catch(r=>{console.debug("Play failed after unmute:",r)})},Ae=()=>{b.current&&(F.current=!1,ne.current=window.setTimeout(()=>{F.current=!0;const e=b.current;e&&!e.paused&&e.pause()},200))},je=()=>{if(ne.current&&(clearTimeout(ne.current),ne.current=null),F.current&&b.current){const e=b.current;e.paused&&e.play().catch(n=>console.debug("Resume failed:",n)),F.current=!1}},ot=()=>{Ae()},it=e=>{F.current&&e.preventDefault(),je()},Ue=!!(E!=null&&E.is_admin||E!=null&&E.is_mod);async function at(){if(!t)return;const e=P("csrf")||"",n=!t.is_starred,r=n?"star":"unstar";(await fetch(`${x}/api/admin/videos/${t.id}/${r}`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(R(o=>{const c=[...o];return c[f]={...c[f],is_starred:n},c}),ce(!1),k(n?"Post starred":"Star removed",{variant:"success"})):k("Action failed",{variant:"error"})}async function Oe(){if(!t||!confirm("Permanently delete this video?"))return;const e=P("csrf")||"";(await fetch(`${x}/api/videos/${t.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(k("Deleted",{variant:"warn"}),Y(!1),R(r=>{const a=r.filter((o,c)=>c!==f);return a.length===0?(z(-1),setTimeout(G,0)):z(o=>Math.max(0,Math.min(o,a.length-1))),a})):alert("Delete failed")}ut();const Be=i.useRef(null),[se,ct]=i.useState(0);return i.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&ct(n.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.jsxs(s.Fragment,{children:[s.jsx(dt,{paused:!1}),s.jsxs("div",{ref:Be,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[L&&s.jsx("div",{className:"chip info",style:{position:"absolute",top:se+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),s.jsx("div",{className:"video-area",style:{position:"absolute",top:se,left:0,right:0,bottom:p?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:Ge?s.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[s.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),s.jsx("button",{className:"btn",onClick:()=>window.location.href=`${x}/api/auth/login`,children:"Login with osu!"})]}):t?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:de&&t.beatmapset_id?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:s.jsx(vt,{downloadUrl:`${x}/api/osu/beatmapsets/${t.beatmapset_id}/download?noVideo=1`,beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{A(!1),window.location.hash="/editor"}})}):s.jsxs("div",{style:{width:p?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:p?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:p?`calc(50vh - ${se}px)`:`calc(100vh - ${se}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),s.jsx("div",{style:{position:"relative",zIndex:1},children:s.jsxs("div",{onClick:rt,onMouseDown:Ae,onMouseUp:je,onMouseLeave:je,onTouchStart:ot,onTouchEnd:it,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[s.jsx(wt,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t!=null&&t.width&&(t!=null&&t.height)?t.width/t.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:I,controls:!1,onVideoRef:nt}),s.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:I?1:0},children:I?s.jsx(ft,{size:20,color:"#fff"}):s.jsx(pt,{size:20,color:"#fff"})})]})})]})}):L?null:s.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[s.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),s.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[s.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),s.jsx("div",{children:"• Click video to toggle mute/unmute"}),s.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!de&&s.jsxs("div",{style:{position:"absolute",right:p?12:16,top:"50%",display:"flex",flexDirection:"column",gap:p?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:p?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[s.jsx(Ye,{to:`/profile/${(He=t.uploader)==null?void 0:He.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(We=t.uploader)!=null&&We.avatar_url?s.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):s.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:et,disabled:Je,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?s.jsx(mt,{size:28}):s.jsx(ht,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:()=>me(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(gt,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{ref:pe,onClick:()=>q(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(qe,{size:24})}),ue&&s.jsxs("div",{ref:fe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>q(!1),children:[s.jsx(qe,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&s.jsx("button",{className:"menu-item",onClick:()=>{A(!0),q(!1)},children:"Preview"})]})]}),Ue?s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{onClick:()=>ce(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(Xe,{size:24})}),ae&&s.jsxs("div",{ref:le,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("button",{className:"menu-item",onClick:at,children:t.is_starred?"Unstar post":"Star post"}),s.jsx("button",{className:"menu-item",onClick:Oe,children:"Delete video"})]})]}):s.jsx("button",{onClick:()=>Y(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(xt,{size:24})}),oe&&s.jsxs("div",{ref:ie,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),s.jsx("button",{className:"menu-item",onClick:()=>Le("unrelated"),children:"Unrelated"}),s.jsx("button",{className:"menu-item",onClick:()=>Le("explicit"),children:"Explicit"}),Ue&&s.jsx("button",{className:"menu-item",onClick:Oe,children:"Delete video"})]})]}),t&&!de&&s.jsxs("div",{style:{position:"absolute",left:p?12:16,bottom:p?"55%":80,right:p?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:p?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:p?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:s.jsx(Ye,{to:`/profile/${(Ve=t.uploader)==null?void 0:Ve.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:p?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var a,o,c;const e=(a=t.uploader)==null?void 0:a.is_admin,n=(o=t.uploader)==null?void 0:o.is_mod,r=e?"#fff3bf":n?"#d7fbe8":"#fff";return s.jsxs(s.Fragment,{children:[s.jsxs("span",{style:{color:r},children:["@",(c=t.uploader)==null?void 0:c.username]}),t.is_starred&&s.jsx(bt,{size:p?14:16,color:"#f59e0b",title:"Starred"}),(e||n)&&s.jsx(Xe,{size:p?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&s.jsx("div",{style:{color:"#fff",fontSize:p?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&s.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:p?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),p&&t&&s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),s.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[s.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),s.jsx("button",{onClick:()=>me(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:s.jsx(yt,{size:24})})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Fe.length===0?s.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):s.jsx("div",{className:"col",style:{gap:0},children:Fe.map(e=>s.jsx(jt,{comment:e,replies:te.get(e.id)||[],me:E,section:"mappi",onReply:n=>ge(n),onDelete:st,replyingTo:he,replyText:U,onReplyTextChange:X,onReplySubmit:Pe,posting:xe,onCancelReply:()=>{ge(null),X("")}},e.id))})}),E&&!he&&s.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:s.jsxs("form",{onSubmit:Pe,style:{display:"flex",alignItems:"flex-end",gap:8},children:[s.jsx("textarea",{placeholder:"Write a comment...",value:U,onChange:e=>X(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),s.jsx("button",{type:"submit",className:"btn compact",disabled:xe||!U.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:xe?"...":"Post"})]})})]})]})]})]})}export{Nt as default};
