const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-CUSwx6hu.js","assets/vendor-react-BcztRRPo.js","assets/vendor-z7ElObC4.js","assets/mappi-routes-BZhmWKjA.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-BU8nWiSI.js","assets/vendor-zip-CPkGWvL_.js","assets/beatmap-preview-BasPDPAs.js","assets/editor-CG1yLUbS.css","assets/moddi-routes-BTS26tZs.js","assets/editor-components-BMK_t3kA.js","assets/editor-components-Bzmrvihl.css"])))=>i.map(i=>d[i]);
var $e=Object.defineProperty;var Ue=(t,a,i)=>a in t?$e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;var be=(t,a,i)=>Ue(t,typeof a!="symbol"?a+"":a,i);import{r as v,j as e,e as ne,u as oe,R as N,q as Ee,d as me,V as Oe,W as ve,X as Qe,L as B,Y as Ye,Z as Je,P as Te,_ as Ve,$ as ye,Q as he,M as Ge,A as Ke,h as Xe,D as je,S as Ze,T as et,H as tt,c as _e,J as st,l as Ae,a0 as it,z as at,a1 as Ne,B as nt,v as rt,o as lt,k as ot,x as ct,i as dt,g as ut,a2 as mt,a3 as pt,a4 as ht,a5 as ft,a6 as Y}from"./vendor-react-BcztRRPo.js";import{y as xt}from"./vendor-z7ElObC4.js";import{u as de,a as F,A as M,c as Le,i as ae,d as we,P as gt,b as re,e as bt,T as vt,f as yt}from"./mappi-routes-BZhmWKjA.js";import{u as se,a as ze,b as Me,c as ce,d as jt,e as Nt,f as wt,g as kt,h as St,F as Ct,C as Et,M as Tt,D as _t,i as At,P as Lt,Q as zt,j as Mt,N as It}from"./moddi-routes-BTS26tZs.js";import{b as Ft,a as Rt,i as Pt,c as Dt,H as Wt}from"./editor-components-BMK_t3kA.js";import{s as Bt,E as Ht}from"./editor-BU8nWiSI.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-BasPDPAs.js";import"./vendor-zip-CPkGWvL_.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();const qt="modulepreload",$t=function(t){return"/"+t},ke={},Ut=function(a,i,n){let o=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),x=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.allSettled(i.map(d=>{if(d=$t(d),d in ke)return;ke[d]=!0;const k=d.endsWith(".css"),p=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const j=document.createElement("link");if(j.rel=k?"stylesheet":qt,k||(j.as="script"),j.crossOrigin="",j.href=d,x&&j.setAttribute("nonce",x),document.head.appendChild(j),k)return new Promise((C,E)=>{j.addEventListener("load",C),j.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(c){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=c,window.dispatchEvent(x),!x.defaultPrevented)throw c}return o.then(c=>{for(const x of c||[])x.status==="rejected"&&r(x.reason);return a().catch(r)})},Ot=new xt({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Qt extends v.Component{constructor(i){super(i);be(this,"handleRetry",()=>{const i=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),i&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,n){console.error("ErrorBoundary caught an error:",i,n)}isChunkLoadingError(i){if(!i)return!1;const n=i.message.toLowerCase();return n.includes("loading chunk")||n.includes("failed to load")||n.includes("chunk load failed")||n.includes("loading css chunk")||i.name==="ChunkLoadError"}render(){var i;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const n=this.isChunkLoadingError(this.state.error),o=((i=this.state.error)==null?void 0:i.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:n?"Failed to load page. This might be a network issue.":o}),n&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:n?"Reload Page":"Try Again"}),!n&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const Z=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Yt({i:t}){const a=t*1337,i=(E,h)=>{const g=Math.sin(a+E+h)*1e4,w=g-Math.floor(g);return Math.floor(w*(h-E+1)+E)},n=i(0,100),o=i(24,50),r=.7+i(0,100)/100*.3,c=o*r,x=i(0,4e3),d=i(-10,10),k=i(-8,8),p=i(0,100),j=p<60?1:p<80?1.5:2,C=[{size:200*j,alpha:.06,dx:-22,dy:12,color:Z[i(0,Z.length-1)]},{size:150*j,alpha:.08,dx:-9,dy:7,color:Z[i(0,Z.length-1)]},{size:120*j,alpha:.1,dx:0,dy:0,color:Z[i(0,Z.length-1)]},{size:90*j,alpha:.12,dx:12,dy:-4,color:Z[i(0,Z.length-1)]},{size:64*j,alpha:.13,dx:20,dy:-7,color:Z[i(0,Z.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${n}vw`,animationDuration:`${c}s`,animationDelay:`${x}ms`,"--tx":`${d}vw`,transform:`rotate(${k}deg)`},children:C.map((E,h)=>e.jsx("svg",{width:E.size,height:E.size,viewBox:"0 0 100 100",style:{left:`${50+E.dx}%`,bottom:`${E.dy}px`,transform:"translateX(-50%)","--alpha":E.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:E.color})},h))})}function Jt({paused:t=!1}){const a=v.useMemo(()=>new Array(20).fill(0).map((i,n)=>n),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:a.map(i=>e.jsx(Yt,{i},i))})}function Vt(){const t=ne(),a=oe(),{lastSection:i,previousLocation:n,setPreviousLocation:o}=se(),r=N.useRef(null),c=N.useRef(!1),x=N.useRef(0),d=N.useRef(0),k=N.useRef(null),p=N.useRef(null),j=N.useRef(!1),C=300,E=2e3,h=N.useRef(null),g=N.useRef(null),w=N.useRef(null),[u,S]=N.useState(!1),[y,f]=N.useState(12),z=N.useRef(null),T=N.useRef(null),[l,I]=N.useState(!1),[R,U]=N.useState(12),[J,P]=N.useState([]),[Q,X]=N.useState(""),D=N.useRef(null),V=N.useRef(null),[G,m]=N.useState(!1),[L,A]=N.useState(12),[$,ie]=N.useState(null),le=N.useCallback(()=>{if(!g.current)return;const b=g.current.getBoundingClientRect(),H=window.innerWidth||document.documentElement.clientWidth||320,q=160;let W=b.left;W+q+8>H&&(W=Math.max(8,H-q-8)),W=Math.max(8,W),f(W)},[]),s=N.useCallback(()=>{if(!z.current)return;const b=z.current.getBoundingClientRect(),H=window.innerWidth||document.documentElement.clientWidth||320,q=220;let W=b.left;W+q+8>H&&(W=Math.max(8,H-q-8)),W=Math.max(8,W),U(W)},[]),_=N.useCallback(()=>{if(!D.current)return;const b=D.current.getBoundingClientRect(),H=window.innerWidth||document.documentElement.clientWidth||320,q=280;let W=b.left;W+q+8>H&&(W=Math.max(8,H-q-8)),W=Math.max(8,W),A(W)},[]);N.useEffect(()=>()=>{r.current&&clearTimeout(r.current),k.current&&clearTimeout(k.current),p.current&&clearTimeout(p.current)},[]),N.useEffect(()=>{if(!u)return;const b=H=>{const q=H.target;w.current&&!w.current.contains(q)&&g.current&&!g.current.contains(q)&&S(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[u]),N.useEffect(()=>{if(!l)return;const b=H=>{const q=H.target;T.current&&!T.current.contains(q)&&z.current&&!z.current.contains(q)&&I(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[l]),N.useEffect(()=>{if(!G)return;const b=H=>{const q=H.target;V.current&&!V.current.contains(q)&&D.current&&!D.current.contains(q)&&m(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[G]),N.useEffect(()=>{if(!u)return;le();const b=()=>le();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[u,le]),N.useEffect(()=>{if(!l)return;s();const b=()=>s();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[l,s]),N.useEffect(()=>{if(!G)return;_();const b=()=>_();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[G,_]);const K=t.pathname==="/"||t.pathname==="/about",O=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!K&&t.pathname.startsWith("/md/");const te=t.pathname.startsWith("/md/")||!K&&!t.pathname.startsWith("/mp/")&&i==="moddi";N.useEffect(()=>{if(!O)return;const b=q=>{const W=q.detail||{},qe=Array.isArray(W.items)?W.items:[];P(qe),X(String(W.selected||""))},H=q=>{const W=q.detail||{};ie({title:String(W.title||""),artist:String(W.artist||""),mapper:String(W.mapper||""),version:String(W.version||""),beatmapId:Number(W.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",b),window.addEventListener("editor:info",H),()=>{window.removeEventListener("editor:difficulty:list",b),window.removeEventListener("editor:info",H)}},[O]);const Ie=ze();if(K)return null;const fe=()=>{a(n||(i==="moddi"?"/md/feed":"/mp/feed"))},Fe=()=>{S(b=>!b)},Re=()=>{var b;S(!1),(b=h.current)==null||b.click()},Pe=()=>{I(b=>!b)},De=b=>{I(!1),X(b),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:b}}))},We=()=>{m(b=>!b)};if(O)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"file",accept:".osz,.zip",onChange:b=>{var q;const H=(q=b.target.files)==null?void 0:q[0];H&&window.dispatchEvent(new CustomEvent("editor:file",{detail:H}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:fe,"aria-label":"Back",title:"Go back",children:e.jsx(Ee,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:g,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Fe,"aria-label":"File",title:"File menu","aria-expanded":u,children:e.jsx(Oe,{size:20})}),u&&me.createPortal(e.jsx("div",{ref:w,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${y}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:Re,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:fe,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[J.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:z,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Pe,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":l,children:e.jsx(ve,{size:20})}),l&&me.createPortal(e.jsx("div",{ref:T,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${R}px`,minWidth:220},children:J.map(b=>{const H=b.mode==="taiko"?Ft:b.mode==="mania"?Rt:b.mode==="catch"?Pt:Dt;return e.jsxs("button",{className:`mode-option ${Q===b.path?"selected":""}`,type:"button",onClick:()=>De(b.path),children:[e.jsx("img",{className:"mode-icon",src:H,width:24,height:24,alt:""}),e.jsx("span",{children:b.version||"(Untitled)"})]},b.path)})}),document.body)]}),$&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:D,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:We,"aria-label":"Map Info",title:"Map Info","aria-expanded":G,children:e.jsx(Qe,{size:20})}),G&&me.createPortal(e.jsx("div",{ref:V,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${L}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[$.artist||"Artist"," – ",$.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",$.mapper||"Unknown"]}),$.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",$.version]}),$.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${$.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]});const xe=()=>{const b=Date.now();if(x.current>0){const H=b-x.current;if(H<C&&H>0){k.current&&(clearTimeout(k.current),k.current=null),p.current&&(clearTimeout(p.current),p.current=null),r.current&&(clearTimeout(r.current),r.current=null),d.current=b+E,x.current=0,c.current=!1,o(t.pathname),a("/editor");return}}b<d.current&&x.current===0||(k.current&&(clearTimeout(k.current),k.current=null),p.current&&(clearTimeout(p.current),p.current=null),x.current=b,p.current=setTimeout(()=>{p.current!==null&&(a(te?"/mp/feed":"/md/feed"),p.current=null)},C),k.current=setTimeout(()=>{x.current>0&&(x.current=0,d.current=Date.now()+E),k.current=null},C))},ge=()=>{c.current=!1,r.current=setTimeout(()=>{c.current=!0,a("/")},500)},ue=()=>{r.current&&(clearTimeout(r.current),r.current=null),c.current&&setTimeout(()=>{c.current=!1},100)},Be=b=>{if(j.current){b.preventDefault(),b.stopPropagation(),j.current=!1;return}if(c.current){b.preventDefault(),b.stopPropagation();return}xe()},He=b=>{if(ue(),c.current){b.preventDefault(),j.current=!0;return}b.preventDefault(),xe(),j.current=!0,setTimeout(()=>{j.current=!1},C+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(B,{to:te?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(ve,{size:20})}),te?e.jsx(B,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Ye,{size:20})}):e.jsx(B,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Je,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:Be,onTouchStart:ge,onTouchEnd:He,onMouseDown:ge,onMouseUp:ue,onMouseLeave:ue,"aria-label":te?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:te?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:te?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(B,{to:"/md/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/md/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(Te,{size:20}),Ie>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>a("/settings"),"aria-label":"Settings",children:e.jsx(Ve,{size:20})})]})]})}function Gt({isModdi:t,onClick:a}){return e.jsxs("button",{onClick:a,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:t?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:t?"osu!mappi.ng":"osu!moddi.ng"})]})}function Kt({isNeutralPage:t,isEditor:a,isModdi:i,isMappi:n,onCoinFlipClick:o}){return t?e.jsx(B,{to:"/",className:"title",children:i?"osu!moddi.ng":n?"osu!mappi.ng":"mappi!"}):a?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(B,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ye,{size:18})}),e.jsx(B,{to:i?"/md/feed":"/mp/feed",className:"title",children:"osu!editi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(B,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ye,{size:18})}),e.jsx(Gt,{isModdi:i,onClick:o})]})}function Xt({isNeutralPage:t,isMappi:a,isModdi:i}){const n=ne();return e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[t&&e.jsx(B,{to:n.pathname==="/"?"/about":"/",className:n.pathname==="/about"?"active":"",children:n.pathname==="/"?"About":"Home"}),a&&e.jsxs(e.Fragment,{children:[e.jsx(B,{to:"/mp/feed",className:n.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(B,{to:"/mp/discover",className:n.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(B,{to:"/editor",className:n.pathname==="/editor"?"active":"",children:"Editor"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(B,{to:"/md/feed",className:n.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(B,{to:"/md/queues",className:n.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!a&&!i&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(B,{to:"/mp/feed",className:n.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(B,{to:"/mp/discover",className:n.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(B,{to:"/editor",className:n.pathname==="/editor"?"active":"",children:"Editor"})]})]})}function Zt(t,a,i,n){const o=oe(),{notify:r}=de(),[c,x]=v.useState(new Set);return{parseQueueInvite:h=>{if(!h)return null;try{const g=JSON.parse(h);if((g==null?void 0:g.type)==="queue_invite"&&(g!=null&&g.queue_id))return g}catch{}return null},handleAcceptInvite:async(h,g)=>{if(!c.has(h.id)){x(w=>new Set(w).add(h.id));try{await F(M.moddi.queueAccept(String(g)),{method:"POST"}),r("Invitation accepted!",{variant:"success"}),i.mutate(h.id),n(!1),o(`/md/queues/${g}`)}catch(w){r((w==null?void 0:w.message)||"Failed to accept invitation",{variant:"error"})}finally{x(w=>{const u=new Set(w);return u.delete(h.id),u})}}},handleDenyInvite:async(h,g)=>{if(!c.has(h.id)){x(w=>new Set(w).add(h.id));try{await F(M.moddi.queueDeny(String(g)),{method:"POST"}),r("Invitation declined",{variant:"success"}),i.mutate(h.id)}catch(w){r((w==null?void 0:w.message)||"Failed to decline invitation",{variant:"error"})}finally{x(w=>{const u=new Set(w);return u.delete(h.id),u})}}},handleMarkAllRead:async()=>{const h=t.filter(g=>g.id.startsWith("n:")||g.kind==="system"&&!g.read).map(g=>g.id);h.length>0&&a.mutate(h)},handleNotificationClick:async h=>{if(n(!1),a.mutate([h.id]),h.kind==="system"||h.id.startsWith("n:"))try{await F(M.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[h.id]})})}catch{}},handleDeleteNotification:async(h,g)=>{h.stopPropagation(),i.mutate(g)},processing:c}}function es({notifications:t,unreadCount:a,notifOpen:i,setNotifOpen:n,markReadMutation:o,deleteNotificationMutation:r,closeAllPanels:c}){const x=v.useRef(null),d=v.useRef(null),{parseQueueInvite:k,handleAcceptInvite:p,handleDenyInvite:j,handleMarkAllRead:C,handleNotificationClick:E,handleDeleteNotification:h,processing:g}=Zt(t,o,r,n);Me(x,d,i,()=>n(!1));const w=t.filter(u=>!(u.kind==="system"&&u.id.startsWith("b:")&&(u.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:x,className:"icon-link",onClick:()=>{i||c(),n(!i)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Te,{size:18})}),a>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),i&&e.jsxs("div",{ref:d,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(B,{to:"/md/notifications",onClick:()=>n(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:u=>u.currentTarget.style.opacity="1",onMouseLeave:u=>u.currentTarget.style.opacity="0.7",children:"View all"}),w.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:C,children:e.jsx(he,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[w.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),w.map(u=>{const S=k(u.text),y=u.id.startsWith("b:"),f=S?"queue-invite":u.kind==="star"?"star":u.kind==="likes5"?"likes":u.kind==="comment"?"comment":u.kind==="inspiration"?"inspiration":u.kind==="reaction"?"reaction":y?"global":"system",z=u.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${f}`,role:"button",onClick:()=>!S&&E(u),children:[e.jsxs("div",{className:`notif-icon ${z?"deletable":""}`,"aria-hidden":"true",onClick:z&&!S?T=>h(T,u.id):void 0,title:z&&!S?"Remove":void 0,role:z&&!S?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:S?e.jsx(Ge,{}):f==="star"?e.jsx(Ke,{}):f==="likes"?e.jsx(Xe,{}):f==="comment"?e.jsx(je,{}):f==="inspiration"?e.jsx(je,{}):f==="reaction"?e.jsx(Ze,{}):f==="global"?e.jsx(et,{}):null}),z&&!S?e.jsx("span",{className:"swap-trash",children:e.jsx(tt,{})}):null]}),e.jsx("div",{className:"notif-body",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[S.inviter_username," invited you to join queue: ",S.queue_name]}),g.has(u.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:T=>{T.stopPropagation(),p(u,S.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(he,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:T=>{T.stopPropagation(),j(u,S.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(_e,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):u.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:y?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:u.text||""}),y&&u.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(u.expiresAt).toLocaleString()]}):null]}):u.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone commented on your post"})]}):u.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone is inspired by you!"})]}):u.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:u.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:u.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},u.id)})]})]})]})}function ts({quota:t,nowTick:a}){if(!(t!=null&&t.blocked))return null;const i=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),n=Math.floor(i/3600),o=Math.floor(i%3600/60),r=i%60,c=d=>String(d).padStart(2,"0"),x=n>0?`${n}:${c(o)}:${c(r)}`:`${o}:${c(r)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(st,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:x})]})}function ss({me:t,menuOpen:a,setMenuOpen:i,onLogout:n,closeAllPanels:o}){const r=v.useRef(null),c=v.useRef(null);return Me(r,c,a,()=>i(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:r,className:"icon-link",onClick:()=>{a||o(),i(!a)},title:t.username,"aria-label":"User menu","aria-expanded":a,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(Ae,{size:14,style:{opacity:.8}})]}),a&&e.jsxs("div",{ref:c,className:"menu-panel",role:"menu",children:[e.jsx(B,{to:"/profile",className:"menu-item",onClick:()=>i(!1),children:"Profile"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(B,{to:"/moderation",className:"menu-item",onClick:()=>i(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:n,children:"Log out"})]})]})}function is({isNeutralPage:t,isEditor:a,isMappi:i,isModdi:n,onCoinFlipClick:o}){const r=ne(),{data:c,isLoading:x}=ce(),{data:d}=jt(!!c),{data:k=[]}=Nt(!!c),p=ze(),j=wt(),C=kt(),E=St(),{menuOpen:h,notifOpen:g,setMenuOpen:w,setNotifOpen:u,closeAllPanels:S}=se(),[y,f]=N.useState(0);return N.useEffect(()=>{const z=setInterval(()=>f(T=>T+1),1e3);return()=>clearInterval(z)},[]),e.jsxs("header",{className:"top-nav",children:[e.jsx(Kt,{isNeutralPage:t,isEditor:a,isModdi:n,isMappi:i,onCoinFlipClick:o}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),r.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Wt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Xt,{isNeutralPage:t,isMappi:i,isModdi:n}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(it,{size:18})}),c?e.jsxs("div",{className:"user-menu",children:[e.jsx(es,{notifications:k,unreadCount:p,notifOpen:g,setNotifOpen:u,markReadMutation:C,deleteNotificationMutation:E,closeAllPanels:S}),e.jsx(ts,{quota:d,nowTick:y}),e.jsx(ss,{me:c,menuOpen:h,setMenuOpen:w,onLogout:()=>j.mutate(),closeAllPanels:S})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Le+M.auth.login},disabled:x,children:x?"Checking…":"Login with osu!"})]})]})}function as({title:t,onRefresh:a}){const{data:i}=ce(),n=ne(),o=oe(),{lastSection:r}=se(),[c,x]=N.useState(!0),[d,k]=N.useState(0),[p,j]=N.useState(!1),C=N.useRef(!1),E=N.useRef(0),[h,g]=N.useState(!1),w=N.useRef(null);N.useEffect(()=>{const y=document.querySelector(".page");if(!y)return;let f=y.scrollTop,z=!1;const T=()=>{z||(z=!0,requestAnimationFrame(()=>{const l=y.scrollTop,I=l-f;l<=12||I<-12?x(!0):I>12&&x(!1),f=l,z=!1}))};return y.addEventListener("scroll",T,{passive:!0}),()=>y.removeEventListener("scroll",T)},[]),N.useEffect(()=>{const y=document.querySelector(".page");if(!y)return;const f=120,z=70,T=U=>{var J;p||(y.scrollTop<=0?(C.current=!0,E.current=((J=U.touches[0])==null?void 0:J.clientY)??0):C.current=!1)},l=U=>{var Q;if(!C.current||p)return;const J=((Q=U.touches[0])==null?void 0:Q.clientY)??0,P=Math.max(0,J-E.current);if(P>0){const X=Math.min(f,P*.5);k(X)}},I=async()=>{try{if(j(!0),a)await a();else{window.location.reload();return}}finally{setTimeout(()=>{j(!1),k(0)},400)}},R=()=>{!C.current||p||(d>=z?I():k(0),C.current=!1)};return y.addEventListener("touchstart",T,{passive:!0}),y.addEventListener("touchmove",l,{passive:!0}),y.addEventListener("touchend",R),y.addEventListener("touchcancel",R),()=>{y.removeEventListener("touchstart",T),y.removeEventListener("touchmove",l),y.removeEventListener("touchend",R),y.removeEventListener("touchcancel",R)}},[d,p,a]);const{showBack:u,onBack:S}=N.useMemo(()=>{const y=n.pathname;if(/^\/mp\/feed\/.+/.test(y))return{showBack:!0,onBack:()=>o("/mp/feed")};if(/^\/md\/feed\/.+/.test(y))return{showBack:!0,onBack:()=>o("/md/feed")};if(/^\/md\/queues\/.+/.test(y))return{showBack:!0,onBack:()=>o("/md/queues")};if(y==="/profile"||y.startsWith("/profile/")){const f=r==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?o(-1):o(f)}}}return{showBack:!1,onBack:()=>{}}},[n.pathname,o,r]);return e.jsxs("div",{className:`mobile-page-header ${c?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${c?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:u?e.jsx("button",{className:"icon-link",onClick:S,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ee,{size:18})}):e.jsx(B,{to:"/profile",className:"icon-link","aria-label":"Profile",children:i!=null&&i.avatar_url?e.jsx("img",{src:i.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"rgba(255,255,255,0.2)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:(()=>{const y=n.pathname;let f=null;return y==="/mp/feed"?f="mappi-feed":y==="/md/feed"?f="moddi-feed":y==="/md/queues"?f="moddi-queues":y.startsWith("/md/queues/")&&(f="moddi-queue-detail"),f?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:w,className:"icon-link","aria-haspopup":"dialog","aria-expanded":h,onClick:()=>g(z=>!z),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(at,{size:18})}),h&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(Ct,{context:f,onClose:()=>g(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:p||d>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(d,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${p?"spin":d>60?"ready":""}`})})]})}function ns({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function rs(){const t=ne(),{lastSection:a}=se(),i=t.pathname==="/"||t.pathname==="/about",n=t.pathname==="/editor",o=t.pathname.startsWith("/mp/")||!i&&!t.pathname.startsWith("/md/")&&a==="mappi",r=t.pathname.startsWith("/md/")||!i&&!t.pathname.startsWith("/mp/")&&a==="moddi",c=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";return{isNeutralPage:i,isEditor:n,isMappi:o,isModdi:r,isQueueDetail:c}}function ls(t){const a=oe(),i=ne(),{setPreviousLocation:n}=se(),o=v.useRef(0),r=v.useRef(0),c=v.useRef(null),x=500,d=2e3;return v.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),p=>{p.preventDefault();const j=Date.now();if(!(j<r.current)){if(c.current&&o.current>0){const C=j-o.current;if(C<x&&C>0){clearTimeout(c.current),c.current=null,r.current=j+d,o.current=0,n(i.pathname),a("/editor");return}}c.current&&(clearTimeout(c.current),c.current=null),o.current=j,c.current=setTimeout(()=>{r.current=Date.now()+d,c.current=null,o.current=0,a(t?"/mp/feed":"/md/feed")},x)}}}function os(){const t=ne(),{notify:a}=de(),{data:i}=ce(),{lastSection:n,setLastSection:o}=se(),{isNeutralPage:r,isEditor:c,isMappi:x,isModdi:d}=rs(),k=ls(d);N.useEffect(()=>{t.pathname.startsWith("/mp/")?o("mappi"):t.pathname.startsWith("/md/")&&o("moddi")},[t.pathname,o]);const[p,j]=N.useState(null);N.useEffect(()=>{!i||!i.is_mod||(async()=>{try{const h=await F(M.admin.debugState,{requireAuth:!1}),g=Array.isArray(h==null?void 0:h.counts)?h.counts.find(w=>String(w.status)==="ready"):null;g&&j(Number(g.c)||0)}catch{}})()},[i]),N.useEffect(()=>{i&&!localStorage.getItem("welcomed")&&(a(`Welcome, ${i.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[i,a]),N.useEffect(()=>{if(typeof window>"u"||!ae()||t.pathname==="/editor")return;const g=document.querySelector(".page");g&&(g.scrollTop=0)},[t.pathname]);const{showMobileHeader:C,headerTitle:E}=N.useMemo(()=>{const h=t.pathname;if(h==="/"||h==="/about"||h==="/editor"||h==="/mp/discover"||h==="/mobile")return{showMobileHeader:!1,headerTitle:""};const g=h.split("/").filter(Boolean),w=g[0]||"",u=g[1]||"";if(w==="mp"){if(u==="discover")return{showMobileHeader:!0,headerTitle:"Discover"};if(u==="feed")return{showMobileHeader:!0,headerTitle:g.length>2?"Post":"Feed"}}if(w==="md"){if(u==="feed")return{showMobileHeader:!0,headerTitle:g.length>2?"Post":"Feed"};if(u==="queues")return{showMobileHeader:!0,headerTitle:g.length>2?"Queue":"Queues"};if(u==="notifications")return{showMobileHeader:!0,headerTitle:"Notifications"}}return w==="profile"?{showMobileHeader:!0,headerTitle:"Profile"}:h==="/settings"?{showMobileHeader:!0,headerTitle:"Settings"}:h==="/moderation"?{showMobileHeader:!0,headerTitle:"Moderation"}:{showMobileHeader:!0,headerTitle:""}},[t.pathname]);return e.jsxs("div",{className:"app-shell","data-section":d?"moddi":x?"mappi":n==="moddi"?"moddi":n==="mappi"?"mappi":void 0,children:[e.jsx(Jt,{paused:t.pathname==="/editor"}),e.jsx(is,{isNeutralPage:r,isEditor:c,isMappi:x,isModdi:d,onCoinFlipClick:k}),e.jsxs("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:[C&&e.jsx(as,{title:E}),t.pathname==="/about"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(Ne,{})}):e.jsx(Ne,{})]}),t.pathname!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(ns,{readyCount:p})}),t.pathname!=="/mobile"&&e.jsx(Vt,{})]})}function cs(){const{data:t,isLoading:a}=ce(),i=!!t,n=oe(),{lastSection:o}=se(),[r,c]=N.useState(!1);return N.useEffect(()=>{if(typeof window>"u")return;const x=localStorage.getItem("hide_mobile_install_prompt")==="1",d=ae()&&!we()&&!x;c(d)},[]),N.useEffect(()=>{we()&&n(o==="moddi"?"/md/feed":"/mp/feed",{replace:!0})},[o,n]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!i&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),i&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions landing-actions-desktop",children:[e.jsx(B,{to:"/mp/feed",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(B,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]}),!i&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Le+M.auth.login},disabled:a,children:a?"Checking…":"Login with osu!"})}),i&&e.jsxs("div",{className:"landing-actions landing-actions-mobile",children:[e.jsx(B,{to:"/mp/feed",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(B,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]}),r&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px",boxShadow:"0 6px 24px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{c(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(B,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}function ds(){const{data:t}=ce(),{modeFilters:a}=se(),i=Object.entries(a).filter(([o,r])=>r).map(([o])=>o),n=i.length?i.join(","):"standard";return nt({queryKey:["mappi","feed",n],queryFn:async({pageParam:o=0})=>{const r=new URLSearchParams({limit:"20",offset:String(o),modes:n}),c=`${M.feed.recent}?${r.toString()}`;return await F(c)},enabled:!!t,initialPageParam:0,getNextPageParam:(o,r)=>{var d;const c=r.reduce((k,p)=>{var j;return k+(((j=p.items)==null?void 0:j.length)||0)},0);return(((d=o.items)==null?void 0:d.length)||0)===20?c:void 0}})}function us(){const t=ne(),a=rt(),{data:i}=ce(),{modeFilters:n}=se(),{data:o,fetchNextPage:r,hasNextPage:c,isFetching:x,isFetchingNextPage:d,refetch:k}=ds(),p=v.useMemo(()=>(o==null?void 0:o.pages.flatMap(u=>u.items||[]))||[],[o]),j=v.useMemo(()=>{const u=Object.entries(n).filter(([y,f])=>f).map(([y])=>y.toLowerCase()),S=new Set(u.length?u:["standard"]);return p.filter(y=>{const f=String(y.mode||"standard").toLowerCase();return S.has(f)})},[p,n]);v.useEffect(()=>{t.pathname==="/mp/feed"&&k()},[t.pathname,k]),v.useEffect(()=>{const u=()=>{k()};return window.addEventListener("filterchange",u),()=>window.removeEventListener("filterchange",u)},[k]);const C=u=>{a.setQueryData(["mappi","feed"],S=>S&&{...S,pages:S.pages.map(y=>({...y,items:y.items.map(f=>f.id===u.id?u:f)}))})},E=u=>{a.setQueryData(["mappi","feed"],S=>S&&{...S,pages:S.pages.map(y=>({...y,items:y.items.filter(f=>f.id!==u)}))})},h=()=>{k()},g=x&&!d,w=c??!1;return e.jsxs("div",{className:"feed-container mappi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(Et,{section:"mappi",onUpload:h})]}),e.jsx(Tt,{section:"mappi",onUpload:h}),e.jsx(_t,{context:"mappi-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[j.length===0&&!g&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),j.map(u=>e.jsx(gt,{post:u,section:"mappi",onUpdate:C,onDelete:E,me:i},u.id)),j.length>0&&w&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>r(),disabled:d,children:d?"Loading...":"Load more"})})]})})]})}function Se(t){if(!t)return"standard";const a=String(t).toLowerCase().trim();return a==="osu"||a==="0"||a==="standard"?"standard":a==="taiko"||a==="1"?"taiko":a==="catch"||a==="fruits"||a==="2"?"catch":a==="mania"||a==="3"?"mania":"standard"}const ms=({open:t,onClose:a,videoId:i,initialDescription:n,initialBeatmapUrl:o,onSave:r})=>{const[c,x]=v.useState(n||""),[d,k]=v.useState(o||""),[p,j]=v.useState(null),[C,E]=v.useState(null),[h,g]=v.useState(""),[w,u]=v.useState(!1),S=v.useRef(0);v.useEffect(()=>{t&&(x(n||""),k(o||""),j(null),E(null),g(""))},[t,n,o]),v.useEffect(()=>{if(!t)return;S.current&&window.clearTimeout(S.current);const f=(d||"").trim();if(!f){g(""),j(null),E(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(f)){g(""),j(null),E(null);return}return S.current=window.setTimeout(async()=>{var T;try{let l;try{l=new URL(f)}catch{g("Invalid URL format");return}const I=l.hash.match(/#osu\/(\d+)/),R=I?I[1]:null;l.hash="";const J={url:l.toString()};R&&(J.beatmap_id=R);const P=await F(M.osu.resolveBeatmap+re(J),{requireAuth:!1}),Q=Array.isArray(P==null?void 0:P.diffs)?P.diffs:[];if(!Q.length&&!P.setId){g("No difficulties found"),j(null),E(null);return}if(j({setId:Number(P.setId)||0,beatmapId:P.beatmapId??null,title:String(P.title||""),artist:String(P.artist||""),mapper:String(P.mapper||""),diffs:Q}),Q.length>0){const X=Number.isFinite(Number(P.beatmapId))?Number(P.beatmapId):Number((T=Q[0])==null?void 0:T.id),D=Q.find(G=>Number(G.id)===X)||Q[0],V=Se(D==null?void 0:D.mode);E({beatmapId:Number(D==null?void 0:D.id)||null,version:String((D==null?void 0:D.version)||""),mode:V})}g("")}catch(l){g(`Failed to resolve: ${(l==null?void 0:l.message)||"Unknown error"}`),j(null),E(null)}},400),()=>{S.current&&window.clearTimeout(S.current)}},[d,t]);const y=async()=>{if(!w){u(!0);try{await F(M.videos.update(i),{method:"PATCH",body:JSON.stringify({description:c.slice(0,100),beatmap_url:d.trim()||void 0})});const f=!!d.trim();if(p||!f)try{await F(M.videos.update(i)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:f&&p&&p.setId>0?p.setId:null,beatmap_id:f&&(C!=null&&C.beatmapId)?C.beatmapId:null,beatmap_version:f&&(C!=null&&C.version)?C.version:null,beatmap_title:f&&(p!=null&&p.title)?p.title:null,beatmap_artist:f&&(p!=null&&p.artist)?p.artist:null,beatmap_mapper:f&&(p!=null&&p.mapper)?p.mapper:null,beatmap_url:f?d.trim():null})})}catch(T){console.warn("Failed to update beatmap metadata:",T)}r(c,d.trim()||null),a()}catch(f){alert((f==null?void 0:f.message)||"Failed to update post")}finally{u(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:f=>f.target===f.currentTarget&&a(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:a}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:a,"aria-label":"Close",children:e.jsx(_e,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:c,onChange:f=>x(f.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),p?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[p.artist," – ",p.title]}),e.jsxs("span",{className:"muted",children:["by ",p.mapper]})]}),e.jsx("select",{value:(C==null?void 0:C.beatmapId)??p.beatmapId??void 0,onChange:f=>{const z=Number(f.target.value),T=(p==null?void 0:p.diffs.find(l=>Number(l.id)===z))||null;if(T){const l=Se(T.mode);E({beatmapId:z,version:T.version,mode:l})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:p.diffs.map(f=>e.jsxs("option",{value:f.id,children:[f.version," (",f.mode,")"]},f.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{j(null),E(null),k("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:d,onChange:f=>k(f.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),h&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:h})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:a,disabled:w,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:y,disabled:w,children:w?"Saving...":"Save"})]})]})]})]}):null};function Ce(){const t=lt(),a=oe(),{notify:i}=de(),[n,o]=v.useState(null),[r,c]=v.useState(null),[x,d]=v.useState(""),[k,p]=v.useState([]),[j,C]=v.useState([]),[E,h]=v.useState([]),[g,w]=v.useState(""),[u,S]=v.useState(null),[y,f]=v.useState([]),[z,T]=v.useState(null),[l,I]=v.useState(""),[R,U]=v.useState([]),[J,P]=v.useState(null),[Q,X]=v.useState(!1),D=v.useMemo(()=>{const m=t.id?Number(t.id):null;return m?n?n.id===m:!1:!0},[t.id,n]);function V(m){const L=m.stream_uid||String(m.id),A=t.id?`/profile/${t.id}`:"/profile";a(`/mp/feed/${L}`,{state:{returnTo:A}})}v.useEffect(()=>{(async()=>{try{const m=await F(M.auth.me,{requireAuth:!1});o(m),m&&Array.isArray(m.inspirations)&&f(m.inspirations)}catch(m){d((m==null?void 0:m.message)||"Not logged in")}})()},[]),v.useEffect(()=>{(async()=>{try{const m=t.id?Number(t.id):null;if(m){const L=await F(M.users.get(m),{requireAuth:!1});c(L),w(L.about||""),Array.isArray(L.inspirations)&&f(L.inspirations);const A=await F(M.users.videos(m)+re({limit:"60"}),{requireAuth:!1});h(A.items||[]);const $=await F(M.users.likes(m)+re({limit:"60"}),{requireAuth:!1});C($.items||[])}else{if(!n)return;c(n),w(n.about||""),Array.isArray(n.inspirations)&&f(n.inspirations);const L=await F(M.users.myVideos+re({limit:"50"}),{requireAuth:!1});p(L.items||[]);const A=await F(M.users.likes(n.id)+re({limit:"60"}),{requireAuth:!1});C(A.items||[])}}catch{}})()},[t.id,n]),v.useEffect(()=>{X(!1)},[r==null?void 0:r.id]);async function G(m){try{const A=(await F(M.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:m})})).user||r;c(A),Array.isArray(A==null?void 0:A.inspirations)&&f(A.inspirations),t.id||o(A)}catch{}}return v.useEffect(()=>{let m;return z!==null&&l.trim().length>=2?m=setTimeout(async()=>{try{const L=await F(M.osu.usersSearch(l),{requireAuth:!1});U(Array.isArray(L.items)?L.items:[])}catch{}},250):U([]),()=>{m&&clearTimeout(m)}},[l,z]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:r?e.jsxs(e.Fragment,{children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[r.username,r.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${r.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:m=>m.currentTarget.style.opacity="1",onMouseLeave:m=>m.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(ot,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",r.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!D&&y.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),y.map((m,L)=>D?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>P(m.id),onMouseLeave:()=>P(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const A=y.filter(($,ie)=>ie!==L);f(A),G(A)},children:e.jsx("img",{src:m.avatar_url,alt:m.username})}),J===m.id&&e.jsxs("div",{className:"insp-tooltip",children:[m.username," — click to remove"]})]},m.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>P(m.id),onMouseLeave:()=>P(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${m.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:m.avatar_url,alt:m.username})}),J===m.id&&e.jsx("div",{className:"insp-tooltip",children:m.username})]},m.id)),D&&y.length<3&&new Array(3-y.length).fill(0).map((m,L)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>P(-L-1),onMouseLeave:()=>P(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{T(L),I(""),U([])},children:"+"}),J===-L-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),z===L&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:l,onChange:A=>I(A.target.value)}),e.jsxs("div",{className:"insp-results",children:[R.length===0&&l.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),R.map(A=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(n&&Number(n.osu_user_id)===Number(A.id)){i("Kinda based, but no.",{variant:"warn"}),T(null);return}if(y.some(ie=>ie.id===A.id)){T(null);return}const $=[...y,{id:A.id,username:A.username,avatar_url:A.avatar_url}].slice(0,3);f($),T(null),G($)},children:[e.jsx("img",{src:A.avatar_url,alt:"avatar"}),e.jsx("span",{children:A.username})]},A.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>T(null),children:"Close"})]})]},`slot-${L}`))]}),D&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:x||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),D?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:g,onChange:m=>w(m.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const m=await F(M.auth.me,{method:"PATCH",body:JSON.stringify({about:g})});c(m.user||r),o(m.user||n)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(he,{size:16})})]})}):(()=>{const m=((r==null?void 0:r.about)||"").trim()||"No bio.",L=m.length>200,A=L&&!Q?m.slice(0,200)+"...":m;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:A}),L&&e.jsx("button",{onClick:()=>X(!Q),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:Q?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(ct,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Ae,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:m=>{const L=m.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach($=>{$.classList.remove("active"),$.setAttribute("aria-selected","false")}),m.currentTarget.classList.add("active"),m.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:m=>{const L=m.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach($=>{$.classList.remove("active"),$.setAttribute("aria-selected","false")}),m.currentTarget.classList.add("active"),m.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(D?k:E).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(D?k:E).map(m=>(D&&r?(r.id,r.username,r.avatar_url,r.is_admin,r.is_mod):m.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>V({...m}),children:[m.poster_url?e.jsx("img",{className:"recent-thumb",src:m.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(dt,{size:12}),e.jsx("span",{children:m.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ut,{size:12}),e.jsx("span",{children:m.comments_count??0})]})]})})]},m.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[j.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),j.map(m=>{var L,A;return e.jsxs("button",{className:"recent-cell",onClick:()=>V(m),children:[m.poster_url?e.jsx("img",{className:"recent-thumb",src:m.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((L=m.uploader)==null?void 0:L.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:m.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(A=m.uploader)==null?void 0:A.username})]})]},m.id)})]})})})]})]}),u&&e.jsx(ms,{open:!!u,onClose:()=>S(null),videoId:u.id,initialDescription:u.description,initialBeatmapUrl:u.beatmap_url,onSave:(m,L)=>{p(k.map(A=>A.id===u.id?{...A,description:m||null,beatmap_url:L}:A)),S(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function ps(){var L,A,$,ie,le;const[t,a]=v.useState(null),[i,n]=v.useState([]),[o,r]=v.useState(""),[c,x]=v.useState([]),[d,k]=v.useState(null),[p,j]=v.useState([]),[C,E]=v.useState("all"),[h,g]=v.useState("approvals"),[w,u]=v.useState(null),[S,y]=v.useState(""),[f,z]=v.useState(!1),{notify:T}=de(),[l,I]=v.useState(null),[R,U]=v.useState(!1);v.useEffect(()=>{(async()=>{try{const s=await F(M.auth.me,{requireAuth:!1});if(a(s),s!=null&&s.is_admin)try{const _=await F(M.admin.settingsModeration,{requireAuth:!1});u(!!_.require_approval)}catch{}}catch{}try{const s=await F(M.admin.videosPending+re({limit:"50"}),{requireAuth:!1});n(s.items||[])}catch{}})()},[]);async function J(){U(!0);try{const s=await F(M.admin.analytics,{requireAuth:!1});I(s)}finally{U(!1)}}async function P(){try{const s=await F(M.admin.usersSearch(o),{requireAuth:!1});x(s.items||[])}catch{}}async function Q(s){k(s),j([]);try{const _=await F(M.admin.userVideos(s.id)+re({limit:"50"}),{requireAuth:!1});j(_.items||[])}catch{}}async function X(s,_){try{const K=await F(M.admin.user(s.id),{method:"PATCH",body:JSON.stringify({is_mod:_})}),O=(K==null?void 0:K.user)||{...s,is_mod:_};T(_?"Granted moderation":"Revoked moderation",{variant:_?"success":"warn"}),k(O),x(c.map(te=>te.id===s.id?O:te))}catch{alert("Failed to update")}}const D=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),V=!!(t!=null&&t.is_admin);if(!D)return e.jsx("div",{className:"muted",children:"You do not have access."});const G=i.filter(s=>!s.flagged_only),m=i.filter(s=>!!s.flagged_only);return e.jsx("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"muted moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:ae()?"nowrap":"wrap",gap:ae()?"2px":"4px",overflowX:ae()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":h==="approvals",className:`profile-tab ${h==="approvals"?"active":""}`,"data-tab":"approvals",onClick:s=>{const _=s.currentTarget.closest(".profile-tabs-unified");_.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),_.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),g("approvals")},children:"Approvals"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":h==="manage",className:`profile-tab ${h==="manage"?"active":""}`,"data-tab":"manage",onClick:s=>{const _=s.currentTarget.closest(".profile-tabs-unified");_.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),_.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),g("manage")},children:"Manage"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":h==="analytics",className:`profile-tab ${h==="analytics"?"active":""}`,"data-tab":"analytics",onClick:s=>{const _=s.currentTarget.closest(".profile-tabs-unified");_.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),_.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),g("analytics"),l||J()},children:"Analytics"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":h==="message",className:`profile-tab ${h==="message"?"active":""}`,"data-tab":"message",onClick:s=>{const _=s.currentTarget.closest(".profile-tabs-unified");_.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),_.querySelector(".profile-tabs-content").setAttribute("data-active","message"),g("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":h,children:[e.jsx("div",{className:"panel approvals",hidden:h!=="approvals",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[G.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[G.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),G.map(s=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[s.poster_url?e.jsx("img",{src:s.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:s.description||"",children:s.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",s.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[s.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof s.flags_count=="number"&&s.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",s.flags_count," reports"]}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await F(M.admin.videosReject(s.id),{method:"POST"}),n(i.filter(_=>_.id!==s.id)),T("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await F(M.admin.videosApprove(s.id),{method:"POST"}),n(i.filter(_=>_.id!==s.id)),T("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await F(M.videos.delete(s.id),{method:"DELETE"}),n(i.filter(_=>_.id!==s.id)),T("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},s.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[m.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[m.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),m.map(s=>e.jsxs("div",{className:"col moderation-video-card flagged",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[s.poster_url?e.jsx("img",{src:s.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:s.description||"",children:s.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",s.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof s.flags_count=="number"&&s.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",s.flags_count," reports"]}):null]})]})]})]}),e.jsx("div",{className:"row",children:e.jsx("button",{className:"btn secondary",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await F(M.videos.delete(s.id),{method:"DELETE"}),n(i.filter(_=>_.id!==s.id)),T("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},s.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:h!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:o,onChange:s=>r(s.target.value),onKeyDown:s=>{s.key==="Enter"&&P()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:P,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:c.map(s=>e.jsxs("button",{className:"btn secondary moderation-user-result",onClick:()=>Q(s),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center"},children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:s.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",s.id," • osu ",s.osu_user_id]})]}),s.is_admin?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"admin"}):s.is_mod?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"mod"}):s.is_blacklisted?e.jsx("span",{style:{color:"#f87171",fontSize:12,flexShrink:0},children:"blacklisted"}):null]},s.id))})})]}),d?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flexWrap:"wrap"},children:[d.avatar_url&&e.jsx("img",{src:d.avatar_url,width:40,height:40,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:4},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:d.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",d.id," • osu ",d.osu_user_id]})]})]}),e.jsxs("div",{className:"col",style:{gap:10},children:[V&&!d.is_admin&&(d.is_mod?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>X(d,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>X(d,!0),children:"Grant moderation"})),!d.is_admin&&(d.is_blacklisted?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await F(M.admin.user(d.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),k({...d,is_blacklisted:!1}),T("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await F(M.admin.user(d.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),k({...d,is_blacklisted:!0}),T("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),d.is_admin&&e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"})]}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>E("all"),children:"All"}),e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>E("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[p.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),p.filter(s=>{if(C==="all")return!0;const _=(w?!s.approved_at:!1)&&s.status==="ready",K=!!s.needs_review;return _||K}).map(s=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[s.poster_url?e.jsx("img",{src:s.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:s.description||"",children:s.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:[s.status.toUpperCase()," • ",new Date(s.created_at*1e3).toLocaleString()]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[s.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,w&&!s.approved_at&&s.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:14},children:s.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)",fontSize:16},children:"★"})]}),e.jsxs("div",{className:"row",style:{gap:8},children:[(V||(t==null?void 0:t.is_mod))&&(!!s.needs_review||w&&!s.approved_at&&s.status==="ready")&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await F(M.admin.videosApprove(s.id),{method:"POST"}),j(p.map(_=>_.id===s.id?{..._,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:_)),T("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(V||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await F(M.videos.delete(s.id),{method:"DELETE"}),j(p.filter(_=>_.id!==s.id)),T("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]})]},s.id))]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:h!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:o,onChange:s=>r(s.target.value),onKeyDown:s=>{s.key==="Enter"&&P()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:P,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:c.map(s=>e.jsxs("button",{className:`btn secondary moderation-user-result ${(d==null?void 0:d.id)===s.id,""}`,onClick:()=>k(s),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center",border:(d==null?void 0:d.id)===s.id?"2px solid var(--accent)":void 0},children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:s.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",s.id," • osu ",s.osu_user_id]})]}),(d==null?void 0:d.id)===s.id&&e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"selected"})]},s.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>z(s.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",width:"100%",fontSize:16,color:"inherit",fontFamily:"inherit"},value:S,onChange:s=>y(s.target.value)}),e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const s=(S||"").trim();if(!s){alert("Enter a message");return}(async()=>{try{const _={text:s,global:f};!f&&(d!=null&&d.id)&&(_.user_id=d.id),await F(M.admin.notificationsSystem,{method:"POST",body:JSON.stringify(_)}),y(""),T("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:h!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Analytics"}),R&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!R&&!l&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(ee,{label:"Users",value:l.totals.users_total}),e.jsx(ee,{label:"Admins",value:l.totals.users_admin}),e.jsx(ee,{label:"Mods",value:l.totals.users_mod}),e.jsx(ee,{label:"Blacklisted",value:l.totals.users_blacklisted}),e.jsx(ee,{label:"Videos",value:l.totals.videos_total}),e.jsx(ee,{label:"Ready",value:l.totals.videos_ready}),e.jsx(ee,{label:"Pending",value:l.totals.pending_count}),e.jsx(ee,{label:"Purgatory",value:l.totals.purgatory_count}),e.jsx(ee,{label:"Likes",value:l.totals.likes_total}),e.jsx(ee,{label:"Flags",value:l.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(pe,{title:"New users (30d)",series:l.series.users,color:"#60a5fa"}),e.jsx(pe,{title:"New videos (30d)",series:l.series.videos,color:"#34d399"}),((A=(L=l.stream)==null?void 0:L.graphql)==null?void 0:A.minutes_viewed)&&l.stream.graphql.minutes_viewed.length>0&&e.jsx(pe,{title:"Minutes viewed (30d)",series:l.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",l.feed.count," items in rotation",l.feed.cursor?` • cursor ${l.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",l.stream.approximate.total_duration_sec," • ready videos: ",l.stream.approximate.videos_ready]}),l.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",l.stream.api.ok?"ok":"unavailable",(ie=($=l.stream.api)==null?void 0:$.result_info)!=null&&ie.count?` • count ${l.stream.api.result_info.count}`:"",(le=l.stream.api)!=null&&le.sample_status?` • sample status ${String(l.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})})}function ee({label:t,value:a}){return e.jsxs("div",{className:"col moderation-stat-card",children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",style:{fontSize:"clamp(18px, 4vw, 20px)"},children:a})]})}function pe({title:t,series:a,color:i}){const[n,o]=v.useState(()=>ae());v.useEffect(()=>{const l=()=>o(ae());return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]);const r=n?Math.min(400,window.innerWidth-48):400,c=160,x=8,d=8,k=28,p=n?36:42,j=a.map(l=>l.count),C=Math.max(1,...j),E=v.useMemo(()=>{const l=C,I=Math.pow(10,Math.floor(Math.log10(l))),R=l/I;return(R<=1?1:R<=2?2:R<=5?5:10)*I},[C]),h=r-p-d,g=c-x-k,w=v.useMemo(()=>a.map((l,I)=>{const R=p+I/Math.max(1,a.length-1)*h,U=x+(1-l.count/(E||1))*g;return[R,U]}),[a,E,h,g]),u=v.useMemo(()=>w.map((l,I)=>I===0?`M ${l[0]} ${l[1]}`:`L ${l[0]} ${l[1]}`).join(" "),[w]),S=[0,.25,.5,.75,1],y=v.useMemo(()=>{if(a.length===0)return[];const l=[0,.25,.5,.75,1].map(I=>Math.min(a.length-1,Math.round(I*(a.length-1))));return Array.from(new Set(l))},[a]),f=l=>{if(!l||l.length<10)return l||"";const I=l.slice(5,7).replace(/^0/,""),R=l.slice(8,10).replace(/^0/,"");return`${I}/${R}`};function z(l){const I=Number.isInteger(l);return l>=1e6?`${(l/1e6).toFixed(1).replace(/\.0$/,"")}M`:l>=1e3?`${(l/1e3).toFixed(1).replace(/\.0$/,"")}k`:I?String(l):l<10?l.toFixed(1):l.toFixed(1).replace(/\.0$/,"")}const T=a.length?a[a.length-1].count:0;return e.jsxs("div",{className:"col moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:n?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:n?11:12},children:["latest: ",z(T)]})]}),e.jsx("div",{style:{width:"100%",overflowX:"auto"},children:e.jsxs("svg",{width:r,height:c,role:"img","aria-label":t,style:{display:"block"},children:[e.jsx("rect",{x:0,y:0,width:r,height:c,fill:"#0f1217",rx:12}),S.map((l,I)=>{const R=x+(1-l)*g,U=l*E;return e.jsxs("g",{children:[e.jsx("line",{x1:p,y1:R,x2:r-d,y2:R,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:p-6,y:R+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:z(U)})]},I)}),e.jsx("line",{x1:p,y1:x,x2:p,y2:x+g,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:p,y1:x+g,x2:p+h,y2:x+g,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),y.map((l,I)=>{var U;const R=p+l/Math.max(1,a.length-1)*h;return e.jsxs("g",{children:[e.jsx("line",{x1:R,y1:x,x2:R,y2:x+g,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:R,y:x+g+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:f((U=a[l])==null?void 0:U.day)})]},I)}),e.jsx("path",{d:u,fill:"none",stroke:i,strokeWidth:2}),w.length>0&&e.jsx("circle",{cx:w[w.length-1][0],cy:w[w.length-1][1],r:3,fill:i})]})})]})}function hs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function fs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const xs=()=>(v.useEffect(()=>()=>{Bt.clearAll()},[]),e.jsx(Ht,{}));function gs(){const[t,a]=N.useState({mobile:!1,standalone:!1,platform:""}),[i,n]=N.useState("ios");return N.useEffect(()=>{const o=typeof navigator<"u"&&navigator.userAgent||"",r=/iPad|iPhone|iPod/i.test(o)||/(Macintosh).*Mobile/.test(o),c=/Android/i.test(o),x=r?"ios":c?"android":"other";a({mobile:ae(),standalone:!1,platform:x}),n(x==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":i==="ios",className:`profile-tab ${i==="ios"?"active":""}`,"data-tab":"ios",onClick:o=>{const r=o.currentTarget.closest(".profile-tabs-unified");r.querySelectorAll(".profile-tab").forEach(x=>{x.classList.remove("active"),x.setAttribute("aria-selected","false")}),o.currentTarget.classList.add("active"),o.currentTarget.setAttribute("aria-selected","true"),r.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),n("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":i==="android",className:`profile-tab ${i==="android"?"active":""}`,"data-tab":"android",onClick:o=>{const r=o.currentTarget.closest(".profile-tabs-unified");r.querySelectorAll(".profile-tab").forEach(x=>{x.classList.remove("active"),x.setAttribute("aria-selected","false")}),o.currentTarget.classList.add("active"),o.currentTarget.setAttribute("aria-selected","true"),r.querySelector(".profile-tabs-content").setAttribute("data-active","android"),n("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":i,children:[e.jsx("div",{className:"panel",hidden:i!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:i!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const bs=N.lazy(()=>Ut(()=>import("./Discover-CUSwx6hu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));bt();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("Service Worker registered successfully:",t.scope)}).catch(t=>{console.error("Service Worker registration failed:",t)})});const vs=()=>e.jsx(ft,{children:e.jsxs(Y,{element:e.jsx(os,{}),children:[e.jsx(Y,{path:"/",element:e.jsx(cs,{})}),e.jsx(Y,{path:"/mp/discover",element:e.jsx(v.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(bs,{})})}),e.jsx(Y,{path:"/mp/feed",element:e.jsx(us,{})}),e.jsx(Y,{path:"/mp/feed/:uid",element:e.jsx(yt,{})}),e.jsx(Y,{path:"/md/feed",element:e.jsx(At,{})}),e.jsx(Y,{path:"/md/feed/:uid",element:e.jsx(Lt,{})}),e.jsx(Y,{path:"/md/queues",element:e.jsx(zt,{})}),e.jsx(Y,{path:"/md/queues/:id",element:e.jsx(Mt,{})}),e.jsx(Y,{path:"/md/notifications",element:e.jsx(It,{})}),e.jsx(Y,{path:"/profile",element:e.jsx(Ce,{})}),e.jsx(Y,{path:"/profile/:id",element:e.jsx(Ce,{})}),e.jsx(Y,{path:"/moderation",element:e.jsx(ps,{})}),e.jsx(Y,{path:"/about",element:e.jsx(hs,{})}),e.jsx(Y,{path:"/settings",element:e.jsx(fs,{})}),e.jsx(Y,{path:"/mobile",element:e.jsx(gs,{})}),e.jsx(Y,{path:"/editor",element:e.jsx(xs,{})})]})}),ys=()=>e.jsx(ht,{children:e.jsx(vs,{})});mt(document.getElementById("root")).render(e.jsx(Qt,{children:e.jsx(pt,{client:Ot,children:e.jsx(vt,{children:e.jsx(ys,{})})})}));export{Jt as B,Ut as _};
