import{r as s,j as i,b as mt,a as pt,L as Ke,v as ht,G as ft,I as gt,J as Ze,K as xt,M as et,A as bt,c as yt}from"./vendor-react-C7NF2CWg.js";import{P as wt}from"./Popup-CoSBxWSJ.js";import{B as vt}from"./editor-lib-BiYBlHYf.js";import{C as St}from"./Comment-BHSaqmx1.js";import{u as jt,a as S,A as w,b as kt,B as Ct,c as tt}from"./index-4noqHToJ.js";import"./vendor-RuoRctBR.js";import"./beatmap-preview-zeCbv474.js";import"./editor-components-CZPSM51n.js";const R={};function Rt(){try{const d=localStorage.getItem("feed_seen_ids");if(d){const b=JSON.parse(d);Array.isArray(b)&&(R.seenIds=b.filter(E=>typeof E=="number"))}}catch{}return R}function nt(d){Object.assign(R,d);try{const b=Array.from(new Set(R.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(b))}catch{}}function Mt(){var Ve,Je,Xe;const{notify:d}=jt(),[b,E]=s.useState(R.history||[]),[m,M]=s.useState(R.index??-1),[k,V]=s.useState(R.queue||[]),[$,_e]=s.useState(!1),[J,q]=s.useState(!1),[ze,X]=s.useState(R.eligibleCount??null),[Te,Q]=s.useState(R.viewedCount??0),[G,it]=s.useState(!1),[C,B]=s.useState(!0),[A,U]=s.useState(!1),[p,le]=s.useState(!1),[ce,K]=s.useState(!1),[de,ue]=s.useState(!1),[me,Z]=s.useState(!1),[pe,Le]=s.useState([]),[N,ee]=s.useState(""),[te,he]=s.useState(null),[fe,Fe]=s.useState(!1),[L,rt]=s.useState(null),[ge,De]=s.useState(!1),H=s.useRef(new Set(R.seenIds||[])),Me=s.useRef(new Set),xe=s.useRef(!1),F=s.useRef(R.lastShownVideoId??null),ne=s.useRef(!1),Y=s.useRef(0),Ae=s.useRef(0),Ne=s.useRef(0),f=s.useRef(null),He=s.useRef(null),ie=s.useRef(null),be=s.useRef(null),ye=s.useRef(null),we=s.useRef(null),ve=s.useRef(null),re=s.useRef(0),We=s.useRef(0),se=s.useRef(null),ae=s.useRef(null),[W,st]=s.useState(0),t=s.useMemo(()=>m>=0?b[m]:null,[b,m]);s.useEffect(()=>{Rt()},[]),s.useEffect(()=>{nt({history:b,index:m,queue:k,seenIds:Array.from(H.current),eligibleCount:ze??void 0,viewedCount:Te,lastShownVideoId:F.current??void 0})},[b,m,k,ze,Te]);const T=s.useCallback(()=>{try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],a=Array.from(new Set(n.filter(o=>r.includes(o))));return a.length?a:["standard"]}catch{return["standard"]}},[]),Pe=s.useCallback(()=>{const e=new Set;return F.current!==null&&e.add(F.current),Array.from(H.current).slice(-200).forEach(r=>e.add(r)),k.forEach(r=>e.add(r.id)),Array.from(e)},[k]),Se=s.useCallback(async(e=3)=>{var a,o,c,v;if(xe.current)return[];const n=Date.now();if(n<Y.current){const g=Math.ceil((Y.current-n)/1e3);return d(`Rate limited. Please wait ${g}s.`,{durationMs:3e3,variant:"warn"}),[]}const r=n-Ne.current;if(r<2e3){const g=2e3-r;await new Promise(D=>setTimeout(D,g))}xe.current=!0,Ne.current=Date.now();try{const g=Pe(),D=T().join(","),x=[],_=new Set(k.map(h=>h.id));let P=[...g];const z=Math.min(e,3);for(let h=0;h<z;h++){if(h>0){const l=Date.now()-Ae.current,u=1e3;l<u&&await new Promise(y=>setTimeout(y,u-l))}try{Ae.current=Date.now();const l=await S(w.feed.next+kt({exclude:P.join(","),modes:D}),{requireAuth:!1}),u=l&&("id"in l?l:l.video)||null;if(!u)break;if(H.current.has(u.id)||_.has(u.id)||u.id===F.current){P.push(u.id);continue}x.push(u),P.push(u.id),_.add(u.id)}catch(l){if((a=l==null?void 0:l.message)!=null&&a.includes("401")||(o=l==null?void 0:l.message)!=null&&o.includes("Unauthorized")){it(!0);break}else if((c=l==null?void 0:l.message)!=null&&c.includes("429")||(v=l==null?void 0:l.message)!=null&&v.includes("rate limit")){Y.current=Date.now()+5e3,d("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(x.length>0&&V(h=>{const l=new Set(h.map(y=>y.id)),u=x.filter(y=>!l.has(y.id));return[...h,...u]}),x.length===0&&k.length===0)try{const h=T().join(","),l=await S(w.feed.progress(h),{requireAuth:!1});X(Number(l.eligible||0)),Q(Number(l.viewed||0)),q(Number(l.caught_up||0)===1)}catch{}return x}catch{return[]}finally{xe.current=!1}},[Pe,T,k,d]),I=s.useCallback(async()=>{if(!$){_e(!0);try{k.length<=2&&Se(3).catch(()=>{});let e;if(k.length>0)e=k[0],V(n=>n.filter(r=>r.id!==e.id));else{const n=await Se(3);n.length>0&&(e=n[0],n.length>1&&V(r=>{const a=new Set(r.map(c=>c.id)),o=n.slice(1).filter(c=>!a.has(c.id));return[...r,...o]}))}if(e)F.current=e.id,H.current.add(e.id),nt({seenIds:Array.from(H.current)}),E(n=>{const r=[...n.slice(0,m+1),e];return M(r.length-1),r}),Me.current.has(e.id)||(Me.current.add(e.id),S(w.videos.view(e.id),{method:"POST"}).then(n=>{n&&E(r=>{const a=[...r],o=a.findIndex(c=>c.id===e.id);return o!==-1&&(a[o]={...a[o],views_count:n.views_count??a[o].views_count??0,viewed_by_me:!0}),a})}).catch(()=>{}));else try{const n=T().join(","),r=await S(w.feed.progress(n),{requireAuth:!1});X(Number(r.eligible||0)),Q(Number(r.viewed||0)),q(Number(r.eligible||0)>0&&Number(r.viewed||0)>=Number(r.eligible||0))}catch{}}finally{_e(!1)}}},[$,k,Se,m,T]),at=s.useCallback(()=>{f.current&&!f.current.paused&&f.current.pause(),U(!0),Z(!1)},[]),je=s.useCallback(()=>{m>0&&(M(m-1),U(!1))},[m]),ke=s.useCallback(()=>{const e=Date.now();if(!(e-We.current<300)){if(We.current=e,C||(ne.current=!0,B(!1)),m<b.length-1){const n=b[m+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:m,nextIndex:m+1,currentVideoId:t==null?void 0:t.id,nextVideoId:n==null?void 0:n.id,nextVideoStreamUID:n==null?void 0:n.stream_uid}),n&&(F.current=n.id),M(m+1),U(!1);return}if(!J){if(Date.now()<Y.current){const n=Math.ceil((Y.current-Date.now())/1e3);d(`Rate limited. Please wait ${n}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),I()}}},[m,b,C,J,I,d,t]);s.useEffect(()=>{const e=He.current;if(!e)return;const n=o=>{if(G||Math.abs(o.deltaY)<Math.abs(o.deltaX))return;o.preventDefault(),o.stopPropagation();const c=Date.now();if(!(c<re.current)){if(re.current=c+1e3,!t){o.deltaY>0&&!$&&I();return}o.deltaY>0?ke():je()}},r=o=>{se.current=o.touches[0].clientY,ae.current=Date.now()},a=o=>{if(G||se.current===null||ae.current===null)return;const c=o.changedTouches[0].clientY,v=Date.now(),g=se.current-c,D=v-ae.current;if(se.current=null,ae.current=null,Math.abs(g)<50||D>300)return;const x=Date.now();if(!(x<re.current)){if(re.current=x+1e3,!t){g>0&&!$&&I();return}g>0?ke():je()}};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a),window.removeEventListener("wheel",n,{capture:!0})}},[ke,je,t,$,I,G]);const ot=s.useCallback(async()=>{var e,n;if(!(!t||ge)){De(!0);try{const r=t.liked_by_me?"DELETE":"POST",a=await S(w.videos.like(t.id),{method:r});E(o=>{const c=[...o],v=c.findIndex(g=>g.id===t.id);return v!==-1&&(c[v]={...c[v],liked_by_me:!t.liked_by_me,likes_count:a.likes_count}),c})}catch(r){((e=r==null?void 0:r.message)!=null&&e.includes("429")||(n=r==null?void 0:r.message)!=null&&n.includes("rate limit"))&&d("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{De(!1)}}},[t,ge,d]),Oe=s.useCallback(async e=>{if(t)try{await S(w.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),d("Thanks for your report.",{variant:"info"})}catch{d("Report failed",{variant:"error"})}finally{K(!1)}},[t,d]),lt=s.useCallback(async()=>{if(!t)return;const e=!t.is_starred,n=e?"star":"unstar";try{await S(w.admin.videosAction(t.id,n),{method:"POST"}),E(r=>{const a=[...r],o=a.findIndex(c=>c.id===t.id);return o!==-1&&(a[o]={...a[o],is_starred:e}),a}),ue(!1),d(e?"Post starred":"Star removed",{variant:"success"})}catch{d("Action failed",{variant:"error"})}},[t,d]),$e=s.useCallback(async()=>{if(!(!t||!confirm("Permanently delete this video?")))try{await S(w.videos.delete(t.id),{method:"DELETE"}),d("Deleted",{variant:"warn"}),K(!1),E(e=>{const n=e.filter((r,a)=>a!==m);return n.length===0?(M(-1),setTimeout(I,0)):M(r=>Math.max(0,Math.min(r,n.length-1))),n})}catch{alert("Delete failed")}},[t,m,I,d]),oe=s.useCallback(async()=>{if(t!=null&&t.id)try{const e=await S(w.videos.comments(t.id),{requireAuth:!1});Le(e.items||[])}catch{}},[t==null?void 0:t.id]);s.useEffect(()=>{p&&(t!=null&&t.id)&&oe()},[p,t==null?void 0:t.id,oe]);const qe=s.useCallback(async e=>{if(e.preventDefault(),!(!N.trim()||!(t!=null&&t.id))){Fe(!0);try{await S(w.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:N.trim(),parent_id:te||void 0})}),ee(""),he(null),oe(),E(n=>{const r=[...n],a=r.findIndex(o=>o.id===t.id);return a!==-1&&(r[a]={...r[a],comments_count:(r[a].comments_count||0)+1}),r}),d("Comment posted!",{variant:"success"})}catch(n){d((n==null?void 0:n.message)||"Failed to post comment",{variant:"error"})}finally{Fe(!1)}}},[N,t,te,oe,d]),ct=s.useCallback(e=>{Le(n=>n.filter(r=>r.id!==e)),E(n=>{const r=[...n],a=r.findIndex(o=>o.id===(t==null?void 0:t.id));return a!==-1&&(r[a]={...r[a],comments_count:Math.max(0,(r[a].comments_count||0)-1)}),r})},[t==null?void 0:t.id]),{topLevelComments:Be,repliesMap:Ue}=s.useMemo(()=>{const e=pe.filter(r=>!r.parent_id),n=new Map;return pe.filter(r=>r.parent_id).forEach(r=>{const a=r.parent_id;n.has(a)||n.set(a,[]),n.get(a).push(r)}),{topLevelComments:e,repliesMap:n}},[pe]),dt=s.useCallback(()=>{if(!f.current)return;const e=!C;B(e),f.current.muted=e,e||(ne.current=!0),!e&&f.current.paused&&f.current.play().catch(()=>{})},[C]),ut=s.useCallback(e=>{f.current=e,e&&(e.muted=C)},[C]);s.useEffect(()=>{if(!f.current||!t)return;const e=f.current,n=ie.current,r=()=>{if(!e||!n)return;const v=e.videoWidth,g=e.videoHeight,D=v>0&&g>0?v/g:null,x=e.offsetWidth,_=e.offsetHeight,P=x>0&&_>0?x/_:null,z=n.offsetWidth,h=n.offsetHeight,l=z>0&&h>0?z/h:null,u=window.getComputedStyle(e),y=window.getComputedStyle(n),O=n.closest(".video-area"),Ce=(O==null?void 0:O.offsetWidth)||0,Re=(O==null?void 0:O.offsetHeight)||0,j=n.querySelector("div"),Ee=(j==null?void 0:j.offsetWidth)||0,Ie=(j==null?void 0:j.offsetHeight)||0,Qe=window.innerWidth,Ge=window.innerHeight;console.log("[Discover] Video loaded with details:",{videoId:t.id,streamUID:t.stream_uid,playbackUrl:t.playback_url,sourceWidth:v,sourceHeight:g,sourceAspectRatio:D?`${D.toFixed(4)} (${v}:${g})`:"unknown",storedWidth:t.width,storedHeight:t.height,storedAspectRatio:t.width&&t.height?`${(t.width/t.height).toFixed(4)} (${t.width}:${t.height})`:"unknown",displayWidth:x,displayHeight:_,displayAspectRatio:P?`${P.toFixed(4)}`:"unknown",containerWidth:z,containerHeight:h,containerAspectRatio:l?`${l.toFixed(4)}`:"unknown",playerWrapperWidth:Ee,playerWrapperHeight:Ie,playerWrapperAspectRatio:Ee>0&&Ie>0?`${(Ee/Ie).toFixed(4)}`:"unknown",videoAreaWidth:Ce,videoAreaHeight:Re,videoAreaAspectRatio:Ce>0&&Re>0?`${(Ce/Re).toFixed(4)}`:"unknown",viewportWidth:Qe,viewportHeight:Ge,viewportAspectRatio:`${(Qe/Ge).toFixed(4)}`,videoStyles:{width:u.width,height:u.height,maxWidth:u.maxWidth,maxHeight:u.maxHeight,aspectRatio:u.aspectRatio,objectFit:u.objectFit,boxSizing:u.boxSizing},containerStyles:{width:y.width,height:y.height,maxWidth:y.maxWidth,maxHeight:y.maxHeight,aspectRatio:y.aspectRatio,display:y.display,alignItems:y.alignItems,justifyContent:y.justifyContent,boxSizing:y.boxSizing},playerWrapperStyles:j?{width:window.getComputedStyle(j).width,height:window.getComputedStyle(j).height,maxWidth:window.getComputedStyle(j).maxWidth,maxHeight:window.getComputedStyle(j).maxHeight,aspectRatio:window.getComputedStyle(j).aspectRatio}:null,scaling:{widthFitsContainer:x<=z,heightFitsContainer:_<=h,widthOverflow:x>z?`${(x-z).toFixed(2)}px`:"none",heightOverflow:_>h?`${(_-h).toFixed(2)}px`:"none",widthRatio:z>0?`${(x/z*100).toFixed(2)}%`:"unknown",heightRatio:h>0?`${(_/h*100).toFixed(2)}%`:"unknown"},videoState:{readyState:e.readyState,paused:e.paused,muted:e.muted,currentTime:e.currentTime,duration:e.duration}})},a=()=>{requestAnimationFrame(()=>{setTimeout(r,100)})},o=()=>{requestAnimationFrame(()=>{setTimeout(r,100)})},c=()=>{requestAnimationFrame(()=>{setTimeout(r,100)})};return e.addEventListener("loadedmetadata",a),e.addEventListener("canplay",o),window.addEventListener("resize",c),e.readyState>=1&&a(),()=>{e.removeEventListener("loadedmetadata",a),e.removeEventListener("canplay",o),window.removeEventListener("resize",c)}},[t==null?void 0:t.id,t==null?void 0:t.stream_uid,t==null?void 0:t.playback_url,t==null?void 0:t.width,t==null?void 0:t.height]),s.useEffect(()=>{console.log("[Discover] Video changed:",{videoId:t==null?void 0:t.id,streamUID:t==null?void 0:t.stream_uid,index:m,historyLength:b.length}),U(!1),le(!1),ne.current?B(!1):B(!0)},[t==null?void 0:t.id,t==null?void 0:t.stream_uid,m,b.length]),s.useEffect(()=>{f.current&&(f.current.muted=C)},[C]),s.useEffect(()=>{if(!t)return;const e=!ne.current;B(e);const n=setTimeout(()=>{f.current&&(f.current.muted=e)},100);return()=>clearTimeout(n)},[t==null?void 0:t.id]),s.useEffect(()=>{t&&(F.current=t.id)},[t==null?void 0:t.id]),s.useEffect(()=>{A&&f.current&&!f.current.paused&&f.current.pause()},[A]),s.useEffect(()=>{b.length===0&&I()},[]),s.useEffect(()=>{(async()=>{try{const e=T().join(","),n=await S(w.feed.progress(e),{requireAuth:!1}),r=Number(n.eligible||0),a=Number(n.viewed||0);X(r),Q(a),q(r>0&&a>=r)}catch{}})()},[T]),s.useEffect(()=>{const e=()=>{E([]),V([]),H.current.clear(),F.current=null,M(-1),q(!1),(async()=>{try{const n=T().join(","),r=await S(w.feed.progress(n),{requireAuth:!1}),a=Number(r.eligible||0),o=Number(r.viewed||0);X(a),Q(o),q(!1)}catch{}I()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[T,I]),s.useEffect(()=>{(async()=>{try{const e=await S(w.auth.me,{requireAuth:!1});rt(e)}catch{}})()},[]),s.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&st(n.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{if(!ie.current||!t)return;const e=()=>{var r;const n=(r=ie.current)==null?void 0:r.querySelector("div");n&&(n.style.width="auto",n.style.maxWidth="100%")};requestAnimationFrame(()=>{e(),setTimeout(e,100)})},[t]),s.useEffect(()=>{if(!ce)return;const e=n=>{be.current&&!be.current.contains(n.target)&&K(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ce]),s.useEffect(()=>{if(!de)return;const e=n=>{ye.current&&!ye.current.contains(n.target)&&ue(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[de]),s.useEffect(()=>{if(!me)return;const e=n=>{we.current&&!we.current.contains(n.target)&&ve.current&&!ve.current.contains(n.target)&&Z(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[me]);const Ye=!!(L!=null&&L.is_admin||L!=null&&L.is_mod);return i.jsxs(i.Fragment,{children:[i.jsx(Ct,{paused:!1}),i.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Use height to fill, let aspect-ratio calculate width */
          /* But constrain width to prevent overflow */
          width: auto !important;
          max-width: 100% !important;
          height: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          /* Ensure it scales to fit both dimensions */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* Override inline styles to allow aspect-ratio to work */
          width: auto !important;
          max-width: 100% !important;
          height: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
        }
        .video-area .discover-player-wrapper video {
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
      `}),i.jsxs("div",{ref:He,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[J&&i.jsx("div",{className:"chip info",style:{position:"absolute",top:W+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),i.jsx("div",{className:"video-area",style:{position:"absolute",top:W,left:0,right:0,bottom:p?"50%":0,maxHeight:p?`calc(50dvh - ${W}px)`:`calc(100dvh - ${W}px)`,height:p?`calc(50dvh - ${W}px)`:`calc(100dvh - ${W}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:"16px",maxWidth:"100vw",width:"100%"},className:"discover-video-container",children:G?i.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[i.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),i.jsx("button",{className:"btn",onClick:()=>window.location.href=tt+w.auth.login,children:"Login with osu!"})]}):t?i.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:i.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),i.jsxs("div",{onClick:dt,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[i.jsx("div",{ref:ie,className:"discover-player-wrapper",children:i.jsx(wt,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t.width&&t.height?t.width/t.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:C,controls:!1,onVideoRef:ut})}),i.jsx("div",{style:{position:"absolute",top:16,right:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:C?1:0,zIndex:2},children:C?i.jsx(mt,{size:28,color:"#fff"}):i.jsx(pt,{size:28,color:"#fff"})})]})]})}):J?null:i.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[i.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),i.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[i.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),i.jsx("div",{children:"• Click video to toggle mute/unmute"}),i.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!A&&i.jsxs("div",{style:{position:"absolute",right:p?12:16,top:"50%",display:"flex",flexDirection:"column",gap:p?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:p?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[i.jsx(Ke,{to:`/profile/${(Ve=t.uploader)==null?void 0:Ve.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Je=t.uploader)!=null&&Je.avatar_url?i.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):i.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[i.jsx("button",{onClick:ot,disabled:ge,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?i.jsx(ht,{size:28}):i.jsx(ft,{size:28})}),i.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[i.jsx("button",{onClick:()=>le(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:i.jsx(gt,{size:28})}),i.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&i.jsxs("div",{style:{position:"relative"},children:[i.jsx("button",{ref:ve,onClick:()=>Z(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:i.jsx(Ze,{size:24})}),me&&i.jsxs("div",{ref:we,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[i.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>Z(!1),children:[i.jsx(Ze,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&i.jsx("button",{className:"menu-item",onClick:at,children:"Preview"})]})]}),Ye?i.jsxs("div",{style:{position:"relative"},children:[i.jsx("button",{onClick:()=>ue(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:i.jsx(et,{size:24})}),de&&i.jsxs("div",{ref:ye,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[i.jsx("button",{className:"menu-item",onClick:lt,children:t.is_starred?"Unstar post":"Star post"}),i.jsx("button",{className:"menu-item",onClick:$e,children:"Delete video"})]})]}):i.jsx("button",{onClick:()=>K(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:i.jsx(xt,{size:24})}),ce&&i.jsxs("div",{ref:be,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[i.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),i.jsx("button",{className:"menu-item",onClick:()=>Oe("unrelated"),children:"Unrelated"}),i.jsx("button",{className:"menu-item",onClick:()=>Oe("explicit"),children:"Explicit"}),Ye&&i.jsx("button",{className:"menu-item",onClick:$e,children:"Delete video"})]})]}),t&&!A&&i.jsxs("div",{style:{position:"absolute",left:p?12:16,bottom:p?"55%":80,right:p?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:p?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:p?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:i.jsx(Ke,{to:`/profile/${(Xe=t.uploader)==null?void 0:Xe.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:p?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var a,o,c;const e=(a=t.uploader)==null?void 0:a.is_admin,n=(o=t.uploader)==null?void 0:o.is_mod,r=e?"#fff3bf":n?"#d7fbe8":"#fff";return i.jsxs(i.Fragment,{children:[i.jsxs("span",{style:{color:r},children:["@",(c=t.uploader)==null?void 0:c.username]}),t.is_starred&&i.jsx(bt,{size:p?14:16,color:"#f59e0b",title:"Starred"}),(e||n)&&i.jsx(et,{size:p?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&i.jsx("div",{style:{color:"#fff",fontSize:p?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&i.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:p?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),p&&t&&i.jsxs(i.Fragment,{children:[i.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),i.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[i.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),i.jsx("button",{onClick:()=>le(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:i.jsx(yt,{size:24})})]}),i.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Be.length===0?i.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):i.jsx("div",{className:"col",style:{gap:0},children:Be.map(e=>i.jsx(St,{comment:e,replies:Ue.get(e.id)||[],me:L,section:"mappi",onReply:n=>he(n),onDelete:ct,replyingTo:te,replyText:N,onReplyTextChange:ee,onReplySubmit:qe,posting:fe,onCancelReply:()=>{he(null),ee("")},repliesMap:Ue},e.id))})}),L&&!te&&i.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:i.jsxs("form",{onSubmit:qe,style:{display:"flex",alignItems:"flex-end",gap:8},children:[i.jsx("textarea",{placeholder:"Write a comment...",value:N,onChange:e=>ee(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),i.jsx("button",{type:"submit",className:"btn compact",disabled:fe||!N.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:fe?"...":"Post"})]})})]})]}),A&&(t==null?void 0:t.beatmapset_id)&&i.jsx(vt,{open:A,onClose:()=>U(!1),downloadUrl:`${tt}${w.osu.downloadBeatmapset(t.beatmapset_id)}`,beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})]})}export{Mt as default};
