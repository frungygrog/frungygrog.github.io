const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-D49-Xa7r.js","assets/index-B7cE1kBR.js","assets/vendor-react-_vsaDC62.js","assets/vendor-DBgzFpze.js","assets/editor-components-CKFEosPJ.js","assets/editor-components-Bzmrvihl.css","assets/index-Do5egyzH.css"])))=>i.map(i=>d[i]);
import{u as wt,a as S,A as y,_ as me,B as vt,b as tt}from"./index-B7cE1kBR.js";import{r as a,R as pe,i as St,j as r,b as Et,a as jt,L as nt,p as _t,D as It,E as kt,G as rt,I as Rt,J as st,A as Dt,c as Ct}from"./vendor-react-_vsaDC62.js";import{P as Tt}from"./Popup-D49-Xa7r.js";import{P as Lt}from"./beatmap-preview-Da_UNwHS.js";import{C as Ot}from"./Comment-CJFUlFXI.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";import"./editor-lib-Cf56EpaA.js";const j={};function Ut(){var Ke,Ze,et;const[R,A]=a.useState(j.history||[]),[f,z]=a.useState(j.index||-1),t=f>=0?R[f]:null,[Z,Oe]=a.useState(!1),[ot,Ae]=a.useState(!1),[at,Fe]=a.useState(!1),[he,ee]=a.useState(!1),ge=pe.useRef(null),[xe,ye]=a.useState(!1),be=pe.useRef(null),[F,it]=a.useState(null),[we,W]=a.useState(!1),[ve,te]=a.useState(!1),Se=pe.useRef(null),Ee=pe.useRef(null),[p,je]=a.useState(!1),[Pe,Me]=a.useState([]),[Y,ne]=a.useState(""),[_e,Ie]=a.useState(null),[ke,$e]=a.useState(!1),[P,M]=a.useState(!0),{notify:C}=wt(),[_,J]=a.useState(j.queue||[]),$=a.useRef(j.seenIds||new Set),Ne=a.useRef(new Set),Re=a.useRef(!1),ze=a.useRef(null),[Ve,X]=a.useState(j.eligibleCount||null),[Ue,Q]=a.useState(j.viewedCount||0),[V,U]=a.useState(!1),L=a.useRef(j.lastShownVideoId||null);a.useEffect(()=>()=>{j.history=R,j.index=f,j.queue=_,j.seenIds=$.current,j.eligibleCount=Ve,j.viewedCount=Ue,j.lastShownVideoId=L.current},[R,f,_,Ve,Ue]);function ct(){try{const e=Array.from($.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function re(){try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(i=>i.trim()).filter(Boolean),s=["standard","taiko","mania","catch"],o=Array.from(new Set(n.filter(i=>s.includes(i))));return o.length?o:["standard"]}catch{return["standard"]}}const lt=()=>{const e=new Set;return L.current!==null&&e.add(L.current),Array.from($.current).slice(-200).forEach(s=>e.add(s)),_.forEach(s=>e.add(s.id)),Array.from(e)},Be=async(e=5)=>{var n,s,o,i,l,I,g,u,b,E;if(Re.current)return[];Re.current=!0;try{const T=lt(),D=re().join(",");if(ze.current!==!1)try{const c=await S(y.feed.batch+tt({size:String(e),exclude:T.join(","),modes:D}),{requireAuth:!1}),d=c&&Array.isArray(c.items)?c.items:[],m=new Set,k=d.filter(w=>m.has(w.id)?!1:(m.add(w.id),!0)),fe=new Set(_.map(w=>w.id)),q=k.filter(w=>!$.current.has(w.id)&&!fe.has(w.id)&&w.id!==L.current);if(q.length>0&&J(w=>{const N=new Set(w.map(K=>K.id)),H=q.filter(K=>!N.has(K.id));return[...w,...H]}),q.length===0&&_.length===0)try{const w=await S(y.feed.progress(D),{requireAuth:!1}),N=Number(w.eligible||0),H=Number(w.viewed||0);X(N),Q(H),U(N>0&&H>=N)}catch{}return q}catch(c){if((n=c==null?void 0:c.message)!=null&&n.includes("401")||(s=c==null?void 0:c.message)!=null&&s.includes("Unauthorized"))return Fe(!0),[];if((o=c==null?void 0:c.message)!=null&&o.includes("429")||(i=c==null?void 0:c.message)!=null&&i.includes("rate limit"))return C("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];((l=c==null?void 0:c.message)!=null&&l.includes("404")||(I=c==null?void 0:c.message)!=null&&I.includes("Not Found"))&&(ze.current=!1)}const O=[],h=new Set(_.map(c=>c.id));let x=[...T];for(let c=0;c<e;c++)try{const d=await S(y.feed.next+tt({exclude:x.join(","),modes:D}),{requireAuth:!1}),m=d&&("id"in d?d:d.video)||null;if(!m)break;if($.current.has(m.id)||h.has(m.id)||m.id===L.current){x.push(m.id);continue}O.push(m),x.push(m.id),h.add(m.id)}catch(d){(g=d==null?void 0:d.message)!=null&&g.includes("401")||(u=d==null?void 0:d.message)!=null&&u.includes("Unauthorized")?Fe(!0):((b=d==null?void 0:d.message)!=null&&b.includes("429")||(E=d==null?void 0:d.message)!=null&&E.includes("rate limit"))&&C("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(O.length>0&&J(c=>{const d=new Set(c.map(k=>k.id)),m=O.filter(k=>!d.has(k.id));return[...c,...m]}),O.length===0&&_.length===0)try{const c=await S(y.feed.progress(D),{requireAuth:!1});X(Number(c.eligible||0)),Q(Number(c.viewed||0)),U(Number(c.caught_up||0)===1)}catch{}return O}catch{return[]}finally{Re.current=!1}},se=async()=>{if(!Z){Oe(!0);try{_.length<=2&&Be(5).catch(()=>{});let e;if(_.length>0)e=_[0],e&&J(n=>n.filter(o=>o.id!==e.id));else{const n=await Be(3);n.length>0&&(e=n[0],n.length>1&&J(s=>{const o=new Set(s.map(l=>l.id)),i=n.slice(1).filter(l=>!o.has(l.id));return[...s,...i]}))}if(e){if(L.current=e.id,$.current.add(e.id),ct(),A(n=>{const s=[...n.slice(0,f+1),e];return z(s.length-1),s}),!Ne.current.has(e.id)){Ne.current.add(e.id);try{const n=await S(y.videos.view(e.id),{method:"POST"});n&&A(s=>{const o=[...s],i=o.findIndex(l=>l.id===e.id);return i!==-1&&(o[i]={...o[i],views_count:n.views_count??o[i].views_count??0,viewed_by_me:!0}),o})}catch{}}}else try{const n=re().join(","),s=await S(y.feed.progress(n),{requireAuth:!1}),o=Number(s.eligible||0),i=Number(s.viewed||0);X(o),Q(i),U(o>0&&i>=o)}catch{}}finally{Oe(!1)}}},De=()=>{f>0&&(z(f-1),W(!1))},Ce=()=>{if(!P&&(G.current=!0,ce.current=!0,v.current)){const e=v.current;e.muted=!1,M(!1),e.play().catch(()=>{})}if(f<R.length-1){const e=R[f+1];e&&(L.current=e.id),z(f+1),W(!1);return}V||se()},oe=a.useRef(0),ae=a.useRef(null),ie=a.useRef(null),Te=a.useRef({goNext:Ce,goPrev:De,index:f,history:R,loading:Z,exhausted:V});a.useEffect(()=>{Te.current={goNext:Ce,goPrev:De,index:f,history:R,loading:Z,exhausted:V}},[Ce,De,f,R,Z,V]),a.useEffect(()=>{const e=Ge.current;if(!e)return;const n=i=>{if(e){const u=e.getBoundingClientRect(),b=i.clientX,E=i.clientY;if(b<u.left||b>u.right||E<u.top||E>u.bottom)return}i.preventDefault(),i.stopPropagation();const l=Date.now();if(l<oe.current||(oe.current=l+1e3,Math.abs(i.deltaY)<Math.abs(i.deltaX)))return;const{goNext:I,goPrev:g}=Te.current;i.deltaY>0?I():g()},s=i=>{ae.current=i.touches[0].clientY,ie.current=Date.now()},o=i=>{if(ae.current===null||ie.current===null)return;const l=i.changedTouches[0].clientY,I=Date.now(),g=ae.current-l,u=I-ie.current;if(ae.current=null,ie.current=null,Math.abs(g)<50||u>300)return;const b=Date.now();if(b<oe.current)return;oe.current=b+1e3;const{goNext:E,goPrev:T}=Te.current;g>0?E():T()};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchend",o,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",s),e.removeEventListener("touchend",o),window.removeEventListener("wheel",n,{capture:!0})}},[]);const dt=async()=>{var e,n;if(t){Ae(!0);try{const s=t.liked_by_me?"DELETE":"POST",o=await S(y.videos.like(t.id),{method:s});A(i=>{const l=[...i];return l[f]={...l[f],liked_by_me:!t.liked_by_me,likes_count:o.likes_count},l})}catch(s){((e=s==null?void 0:s.message)!=null&&e.includes("429")||(n=s==null?void 0:s.message)!=null&&n.includes("rate limit"))&&C("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{Ae(!1)}}};async function qe(e){if(t)try{await S(y.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),C("Thanks for your report.",{variant:"info"})}catch{C("Report failed",{variant:"error"})}finally{ee(!1)}}a.useEffect(()=>{if(!he)return;const e=n=>{ge.current&&!ge.current.contains(n.target)&&ee(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[he]),a.useEffect(()=>{if(!xe)return;const e=n=>{be.current&&!be.current.contains(n.target)&&ye(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[xe]),a.useEffect(()=>{if(!ve)return;const e=n=>{Se.current&&!Se.current.contains(n.target)&&Ee.current&&!Ee.current.contains(n.target)&&te(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ve]),a.useEffect(()=>{R.length===0&&se()},[]),a.useEffect(()=>{t&&(L.current=t.id)},[t==null?void 0:t.id]),a.useEffect(()=>{(async()=>{try{const e=re().join(","),n=await S(y.feed.progress(e),{requireAuth:!1}),s=Number(n.eligible||0),o=Number(n.viewed||0);X(s),Q(o);const i=s>0&&o>=s;U(i)}catch{}})()},[]),a.useEffect(()=>{const e=()=>{A([]),J([]),$.current.clear(),L.current=null,z(-1),U(!1),(async()=>{try{const n=re().join(","),s=await S(y.feed.progress(n),{requireAuth:!1}),o=Number(s.eligible||0),i=Number(s.viewed||0);X(o),Q(i),U(!1)}catch{}se()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),a.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const n=JSON.parse(e);if(Array.isArray(n))for(const s of n)typeof s=="number"&&$.current.add(s)}}catch{}},[]),a.useEffect(()=>{(async()=>{try{const e=await S(y.auth.me,{requireAuth:!1});it(e)}catch{}})()},[]);const G=a.useRef(!1),ut=async e=>{if(!e)return;const n=performance.now();console.log(`[PRELOAD] Starting preload for next video ${e.id} (${e.stream_uid}) at ${n.toFixed(2)}ms`);try{const s=e.playback_url||(e.stream_uid?`https://videodelivery.net/${e.stream_uid}/manifest/video.m3u8`:null);if(!s)return;(async()=>{const i=performance.now();console.log(`[PRELOAD] Fetching manifest: ${s} at ${i.toFixed(2)}ms`);try{const l=await fetch(s,{priority:"high"}),I=performance.now()-i;if(console.log(`[PRELOAD] Manifest fetched in ${I.toFixed(2)}ms, status: ${l.status}`),l.ok){const g=await l.text(),b=new TextEncoder().encode(g).buffer,{setCached:E}=await me(async()=>{const{setCached:h}=await import("./Popup-D49-Xa7r.js").then(x=>x.v);return{setCached:h}},__vite__mapDeps([0,1,2,3,4,5,6]));await E(s,b,!0,e.stream_uid);const T=g.split(`
`),D=[];let O=s.substring(0,s.lastIndexOf("/")+1);for(let h=0;h<T.length&&D.length<3;h++){const x=T[h].trim();if(x&&!x.startsWith("#")&&(x.endsWith(".ts")||x.endsWith(".m4s"))){const c=x.startsWith("http")?x:O+x;D.push(c)}}for(let h=0;h<D.slice(0,2).length;h++){const x=D[h],c=performance.now();console.log(`[PRELOAD] Preloading segment ${h+1}: ${x} at ${c.toFixed(2)}ms`),fetch(x,{priority:"high"}).then(async d=>{const m=performance.now()-c;if(console.log(`[PRELOAD] Segment ${h+1} fetched in ${m.toFixed(2)}ms, status: ${d.status}`),d.ok)try{const k=performance.now(),fe=await d.arrayBuffer(),q=performance.now()-k;console.log(`[PRELOAD] Segment ${h+1} buffer read in ${q.toFixed(2)}ms, size: ${fe.byteLength} bytes`);const w=performance.now(),{setCached:N}=await me(async()=>{const{setCached:K}=await import("./Popup-D49-Xa7r.js").then(bt=>bt.v);return{setCached:K}},__vite__mapDeps([0,1,2,3,4,5,6]));await N(x,fe,!1,e.stream_uid);const H=performance.now()-w;console.log(`[PRELOAD] Segment ${h+1} cached in ${H.toFixed(2)}ms`)}catch(k){console.error(`[PRELOAD] Error caching segment ${h+1}:`,k)}}).catch(d=>{const m=performance.now()-c;console.error(`[PRELOAD] Segment ${h+1} preload failed after ${m.toFixed(2)}ms:`,d)})}}}catch{}})()}catch{}};a.useEffect(()=>{W(!1),je(!1),G.current?M(!1):M(!0)},[t==null?void 0:t.id]),a.useEffect(()=>{v.current&&(v.current.muted=P)},[P]),a.useEffect(()=>{if(!t)return;const e=performance.now();console.log(`[VIDEO LOAD] Starting load for video ${t.id} (${t.stream_uid}) at ${e.toFixed(2)}ms`);const n=t.playback_url||(t.stream_uid?`https://videodelivery.net/${t.stream_uid}/manifest/video.m3u8`:null);if(n){const o=performance.now();console.log(`[VIDEO LOAD] Prefetching manifest: ${n} at ${o.toFixed(2)}ms`),fetch(n,{priority:"high"}).then(async i=>{const l=performance.now()-o;if(console.log(`[VIDEO LOAD] Manifest fetch completed in ${l.toFixed(2)}ms, status: ${i.status}`),i.ok)try{const I=performance.now(),g=await i.text(),u=performance.now()-I;console.log(`[VIDEO LOAD] Manifest text read in ${u.toFixed(2)}ms, size: ${g.length} bytes`);const b=performance.now(),T=new TextEncoder().encode(g).buffer,{setCached:D}=await me(async()=>{const{setCached:m}=await import("./Popup-D49-Xa7r.js").then(k=>k.v);return{setCached:m}},__vite__mapDeps([0,1,2,3,4,5,6]));await D(n,T,!0,t.stream_uid);const O=performance.now()-b;console.log(`[VIDEO LOAD] Manifest cached in IndexedDB in ${O.toFixed(2)}ms`);const h=performance.now(),{memoryCache:x}=await me(async()=>{const{memoryCache:m}=await import("./Popup-D49-Xa7r.js").then(k=>k.h);return{memoryCache:m}},__vite__mapDeps([0,1,2,3,4,5,6]));x.set(n,T);const c=performance.now()-h;console.log(`[VIDEO LOAD] Manifest added to memory cache in ${c.toFixed(2)}ms`);const d=performance.now()-o;console.log(`[VIDEO LOAD] Total manifest prefetch time: ${d.toFixed(2)}ms`)}catch(I){console.error("[VIDEO LOAD] Error caching manifest:",I)}}).catch(i=>{const l=performance.now()-o;console.error(`[VIDEO LOAD] Manifest prefetch failed after ${l.toFixed(2)}ms:`,i)})}const s=_.length>0?_[0]:f<R.length-1?R[f+1]:null;if(s&&s.id!==t.id&&ut(s),v.current){const o=performance.now();console.log(`[VIDEO LOAD] Attempting to play video at ${o.toFixed(2)}ms (${(o-e).toFixed(2)}ms after load start)`),(()=>{const l=v.current;if(l&&l===v.current)if(!G.current){l.muted=!0;const g=performance.now();l.play().then(()=>{const u=performance.now()-g;console.log(`[VIDEO LOAD] Video play() succeeded in ${u.toFixed(2)}ms (muted)`)}).catch(u=>{const b=performance.now()-g;u.name!=="AbortError"&&u.name!=="NotAllowedError"&&console.warn(`[VIDEO LOAD] Video play() failed after ${b.toFixed(2)}ms:`,u)})}else{l.muted=!1,M(!1);const g=performance.now();l.play().then(()=>{const u=performance.now()-g;console.log(`[VIDEO LOAD] Video play() succeeded in ${u.toFixed(2)}ms (unmuted)`)}).catch(u=>{const b=performance.now()-g;u.name==="AbortError"||u.name==="NotAllowedError"||(console.warn(`[VIDEO LOAD] Unmuted play failed after ${b.toFixed(2)}ms, falling back to muted:`,u),l===v.current&&(l.muted=!0,M(!0),l.play().catch(E=>{E.name!=="AbortError"&&E.name!=="NotAllowedError"&&console.warn("[VIDEO LOAD] Fallback muted play failed:",E)})))})}})()}else console.warn(`[VIDEO LOAD] Video element not available for video ${t.id}`)},[t==null?void 0:t.id,_,f,R]);const ce=a.useRef(!1),ft=e=>{v.current=e,e&&(ce.current&&G.current?(e.muted=!1,M(!1),e.play().then(()=>{ce.current=!1}).catch(()=>{e.muted=!0,M(!0),ce.current=!1,e.play().catch(()=>{})})):e.muted=P)},He=async()=>{if(t!=null&&t.id)try{const e=await S(y.videos.comments(t.id),{requireAuth:!1});Me(e.items||[])}catch{}};a.useEffect(()=>{p&&(t!=null&&t.id)&&He()},[p,t==null?void 0:t.id]);const We=async e=>{if(e.preventDefault(),!(!Y.trim()||!(t!=null&&t.id))){$e(!0);try{await S(y.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:Y.trim(),parent_id:_e||void 0})}),ne(""),Ie(null),He(),A(n=>{const s=[...n],o=s.findIndex(i=>i.id===t.id);return o!==-1&&(s[o]={...s[o],comments_count:(s[o].comments_count||0)+1}),s}),C("Comment posted!",{variant:"success"})}catch(n){C((n==null?void 0:n.message)||"Failed to post comment",{variant:"error"})}finally{$e(!1)}}},mt=e=>{Me(n=>n.filter(s=>s.id!==e)),A(n=>{const s=[...n],o=s.findIndex(i=>i.id===(t==null?void 0:t.id));return o!==-1&&(s[o]={...s[o],comments_count:Math.max(0,(s[o].comments_count||0)-1)}),s})},Ye=Pe.filter(e=>!e.parent_id),le=new Map;Pe.filter(e=>e.parent_id).forEach(e=>{const n=e.parent_id;le.has(n)||le.set(n,[]),le.get(n).push(e)});const v=a.useRef(null),de=a.useRef(null),B=a.useRef(!1),pt=()=>{if(!v.current||B.current)return;const e=v.current,n=!P;M(n),e.muted=n,n||(G.current=!0),!n&&e.paused&&e.play().catch(s=>{console.debug("Play failed after unmute:",s)})},Je=()=>{v.current&&(B.current=!1,de.current=window.setTimeout(()=>{B.current=!0;const e=v.current;e&&!e.paused&&e.pause()},200))},Le=()=>{if(de.current&&(clearTimeout(de.current),de.current=null),B.current&&v.current){const e=v.current;e.paused&&e.play().catch(n=>console.debug("Resume failed:",n)),B.current=!1}},ht=()=>{Je()},gt=e=>{B.current&&e.preventDefault(),Le()},Xe=!!(F!=null&&F.is_admin||F!=null&&F.is_mod);async function xt(){if(!t)return;const e=!t.is_starred,n=e?"star":"unstar";try{await S(y.admin.videosAction(t.id,n),{method:"POST"}),A(s=>{const o=[...s];return o[f]={...o[f],is_starred:e},o}),ye(!1),C(e?"Post starred":"Star removed",{variant:"success"})}catch{C("Action failed",{variant:"error"})}}async function Qe(){if(t&&confirm("Permanently delete this video?"))try{await S(y.videos.delete(t.id),{method:"DELETE"}),C("Deleted",{variant:"warn"}),ee(!1),A(e=>{const n=e.filter((s,o)=>o!==f);return n.length===0?(z(-1),setTimeout(se,0)):z(s=>Math.max(0,Math.min(s,n.length-1))),n})}catch{alert("Delete failed")}}St();const Ge=a.useRef(null),[ue,yt]=a.useState(0);return a.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&yt(n.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),r.jsxs(r.Fragment,{children:[r.jsx(vt,{paused:!1}),r.jsxs("div",{ref:Ge,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[V&&r.jsx("div",{className:"chip info",style:{position:"absolute",top:ue+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),r.jsx("div",{className:"video-area",style:{position:"absolute",top:ue,left:0,right:0,bottom:p?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:at?r.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[r.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),r.jsx("button",{className:"btn",onClick:()=>window.location.href=y.auth.login,children:"Login with osu!"})]}):t?r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:we&&t.beatmapset_id?r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:r.jsx(Lt,{downloadUrl:t.beatmapset_id?y.osu.downloadBeatmapset(t.beatmapset_id):"",beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{W(!1),window.location.hash="/editor"}})}):r.jsxs("div",{style:{width:p?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:p?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:p?`calc(50vh - ${ue}px)`:`calc(100vh - ${ue}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),r.jsx("div",{style:{position:"relative",zIndex:1},children:r.jsxs("div",{onClick:pt,onMouseDown:Je,onMouseUp:Le,onMouseLeave:Le,onTouchStart:ht,onTouchEnd:gt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[r.jsx(Tt,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t!=null&&t.width&&(t!=null&&t.height)?t.width/t.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:P,controls:!1,onVideoRef:ft}),r.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:P?1:0},children:P?r.jsx(Et,{size:20,color:"#fff"}):r.jsx(jt,{size:20,color:"#fff"})})]})})]})}):V?null:r.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[r.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),r.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[r.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),r.jsx("div",{children:"• Click video to toggle mute/unmute"}),r.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!we&&r.jsxs("div",{style:{position:"absolute",right:p?12:16,top:"50%",display:"flex",flexDirection:"column",gap:p?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:p?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[r.jsx(nt,{to:`/profile/${(Ke=t.uploader)==null?void 0:Ke.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Ze=t.uploader)!=null&&Ze.avatar_url?r.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):r.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:dt,disabled:ot,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?r.jsx(_t,{size:28}):r.jsx(It,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:()=>je(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(kt,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{ref:Ee,onClick:()=>te(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(rt,{size:24})}),ve&&r.jsxs("div",{ref:Se,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>te(!1),children:[r.jsx(rt,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&r.jsx("button",{className:"menu-item",onClick:()=>{W(!0),te(!1)},children:"Preview"})]})]}),Xe?r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>ye(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(st,{size:24})}),xe&&r.jsxs("div",{ref:be,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("button",{className:"menu-item",onClick:xt,children:t.is_starred?"Unstar post":"Star post"}),r.jsx("button",{className:"menu-item",onClick:Qe,children:"Delete video"})]})]}):r.jsx("button",{onClick:()=>ee(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(Rt,{size:24})}),he&&r.jsxs("div",{ref:ge,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),r.jsx("button",{className:"menu-item",onClick:()=>qe("unrelated"),children:"Unrelated"}),r.jsx("button",{className:"menu-item",onClick:()=>qe("explicit"),children:"Explicit"}),Xe&&r.jsx("button",{className:"menu-item",onClick:Qe,children:"Delete video"})]})]}),t&&!we&&r.jsxs("div",{style:{position:"absolute",left:p?12:16,bottom:p?"55%":80,right:p?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:p?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:p?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:r.jsx(nt,{to:`/profile/${(et=t.uploader)==null?void 0:et.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:p?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var o,i,l;const e=(o=t.uploader)==null?void 0:o.is_admin,n=(i=t.uploader)==null?void 0:i.is_mod,s=e?"#fff3bf":n?"#d7fbe8":"#fff";return r.jsxs(r.Fragment,{children:[r.jsxs("span",{style:{color:s},children:["@",(l=t.uploader)==null?void 0:l.username]}),t.is_starred&&r.jsx(Dt,{size:p?14:16,color:"#f59e0b",title:"Starred"}),(e||n)&&r.jsx(st,{size:p?12:14,color:s,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&r.jsx("div",{style:{color:"#fff",fontSize:p?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&r.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:p?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),p&&t&&r.jsxs(r.Fragment,{children:[r.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),r.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[r.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),r.jsx("button",{onClick:()=>je(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:r.jsx(Ct,{size:24})})]}),r.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Ye.length===0?r.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):r.jsx("div",{className:"col",style:{gap:0},children:Ye.map(e=>r.jsx(Ot,{comment:e,replies:le.get(e.id)||[],me:F,section:"mappi",onReply:n=>Ie(n),onDelete:mt,replyingTo:_e,replyText:Y,onReplyTextChange:ne,onReplySubmit:We,posting:ke,onCancelReply:()=>{Ie(null),ne("")}},e.id))})}),F&&!_e&&r.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:r.jsxs("form",{onSubmit:We,style:{display:"flex",alignItems:"flex-end",gap:8},children:[r.jsx("textarea",{placeholder:"Write a comment...",value:Y,onChange:e=>ne(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),r.jsx("button",{type:"submit",className:"btn compact",disabled:ke||!Y.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:ke?"...":"Post"})]})})]})]})]})]})}export{Ut as default};
