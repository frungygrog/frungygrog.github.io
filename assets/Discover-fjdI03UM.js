import{r as o,R as re,i as ct,j as s,b as lt,a as dt,L as We,p as ut,D as ft,E as pt,G as Xe,I as mt,J as qe,A as ht,c as gt}from"./vendor-react-_vsaDC62.js";import{P as xt}from"./Popup-CUrCFExb.js";import{P as bt}from"./beatmap-preview-Da_UNwHS.js";import{C as yt}from"./Comment-CMtRxsxI.js";import{u as vt,B as wt}from"./index-DqrJMO3d.js";import"./vendor-DBgzFpze.js";import"./editor-lib-Cf56EpaA.js";import"./editor-components-CKFEosPJ.js";const f="https://api.osumappi.ng",w={};function Tt(){var Be,Ve,He;const[E,I]=o.useState(w.history||[]),[p,L]=o.useState(w.index||-1),n=p>=0?E[p]:null,[W,ke]=o.useState(!1),[Je,Se]=o.useState(!1),[Ge,Re]=o.useState(!1),[oe,X]=o.useState(!1),ie=re.useRef(null),[ae,ce]=o.useState(!1),le=re.useRef(null),[_,Qe]=o.useState(null),[de,V]=o.useState(!1),[ue,q]=o.useState(!1),fe=re.useRef(null),pe=re.useRef(null),[d,me]=o.useState(!1),[Ce,Ee]=o.useState([]),[H,J]=o.useState(""),[he,ge]=o.useState(null),[xe,Ie]=o.useState(!1),[T,N]=o.useState(!0),{notify:j}=vt(),[v,F]=o.useState(w.queue||[]),k=o.useRef(w.seenIds||new Set),_e=o.useRef(new Set),be=o.useRef(!1),Te=o.useRef(null),[Ne,D]=o.useState(w.eligibleCount||null),[$e,P]=o.useState(w.viewedCount||0),[U,M]=o.useState(!1);o.useEffect(()=>()=>{w.history=E,w.index=p,w.queue=v,w.seenIds=k.current,w.eligibleCount=Ne,w.viewedCount=$e},[E,p,v,Ne,$e]);function O(e){var t;return(t=document.cookie.split("; ").map(r=>r.split("=")).find(([r])=>r===e))==null?void 0:t[1]}function Ke(){try{const e=Array.from(k.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function $(){try{const e=localStorage.getItem("filter_modes"),t=(e?String(e):"standard").toLowerCase().split(",").map(i=>i.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],a=Array.from(new Set(t.filter(i=>r.includes(i))));return a.length?a:["standard"]}catch{return["standard"]}}const Me=async(e=3)=>{if(be.current)return[];be.current=!0;try{const t=async()=>{const u=[];for(let C=0;C<e;C++)try{const g=Array.from(k.current).slice(-200),l=$().join(","),b=await fetch(`${f}/api/feed/next?exclude=${encodeURIComponent(g.join(","))}&modes=${encodeURIComponent(l)}`,{credentials:"include"});if(b.status===401){Re(!0);break}if(b.status===429){j("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(!b.ok)break;const y=await b.json(),B=y&&(y.id?y:y.video);if(!B)break;u.push(B)}catch{break}return u};if(Te.current===!1){const u=await t(),C=new Set(v.map(l=>l.id)),g=u.filter(l=>!k.current.has(l.id)&&!C.has(l.id));if(g.length>0&&F(l=>[...l,...g]),g.length===0&&v.length===0)try{const l=$().join(","),b=await fetch(`${f}/api/feed/progress?modes=${encodeURIComponent(l)}`,{credentials:"include"});if(b.ok){const y=await b.json();D(Number(y.eligible||0)),P(Number(y.viewed||0)),M(!!y.caught_up)}}catch{}return g}const r=Array.from(k.current).slice(-200),a=$().join(","),i=await fetch(`${f}/api/feed/batch?size=${e}&exclude=${encodeURIComponent(r.join(","))}&modes=${encodeURIComponent(a)}`,{credentials:"include"});if(i.status===401)return Re(!0),[];if(i.status===429)return j("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];if(i.status===404){Te.current=!1;const u=await t(),C=new Set(v.map(l=>l.id)),g=u.filter(l=>!k.current.has(l.id)&&!C.has(l.id));if(g.length>0&&F(l=>[...l,...g]),g.length===0&&v.length===0)try{const l=$().join(","),b=await fetch(`${f}/api/feed/progress?modes=${encodeURIComponent(l)}`,{credentials:"include"});if(b.ok){const y=await b.json(),B=Number(y.eligible||0),Ye=Number(y.viewed||0);D(B),P(Ye);const at=B>0&&Ye>=B;M(at)}}catch{}return g}const c=await i.json(),m=c&&Array.isArray(c.items)?c.items:[],h=new Set,S=m.filter(u=>h.has(u.id)?!1:(h.add(u.id),!0)),z=new Set(v.map(u=>u.id)),R=S.filter(u=>!k.current.has(u.id)&&!z.has(u.id));if(R.length>0&&F(u=>[...u,...R]),R.length===0&&v.length===0)try{const u=$().join(","),C=await fetch(`${f}/api/feed/progress?modes=${encodeURIComponent(u)}`,{credentials:"include"});if(C.ok){const g=await C.json(),l=Number(g.eligible||0),b=Number(g.viewed||0);D(l),P(b);const y=l>0&&b>=l;M(y)}}catch{}return R}catch{return[]}finally{be.current=!1}},G=async()=>{if(!W){ke(!0);try{let e=[];v.length===0&&(e=await Me(3));let t;if(v.length>0?(t=v[0],F(r=>r.slice(1))):e.length>0&&(t=e[0],e.length>1&&F(r=>[...r,...e.slice(1)])),t){if(k.current.add(t.id),Ke(),I(r=>{const a=[...r.slice(0,p+1),t];return L(a.length-1),a}),!_e.current.has(t.id)){_e.current.add(t.id);const r=O("csrf")||"";try{const a=await fetch(`${f}/api/videos/${t.id}/view`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":r}});if(a.ok){const i=await a.json();i&&I(c=>{const m=[...c],h=m.findIndex(S=>S.id===t.id);return h!==-1&&(m[h]={...m[h],views_count:i.views_count??m[h].views_count??0,viewed_by_me:!0}),m})}}catch{}}}else try{const r=$().join(","),a=await fetch(`${f}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(a.ok){const i=await a.json(),c=Number(i.eligible||0),m=Number(i.viewed||0);D(c),P(m);const h=c>0&&m>=c;M(h)}}catch{}v.length<=1&&Me(3)}finally{ke(!1)}}},ye=()=>{p>0&&(L(p-1),V(!1))},ve=()=>{if(!T&&(Y.current=!0,ee.current=!0,x.current)){const e=x.current;e.muted=!1,N(!1),e.play().catch(()=>{})}if(p<E.length-1){L(p+1),V(!1);return}U||G()},Q=o.useRef(0),K=o.useRef(null),Z=o.useRef(null),we=o.useRef({goNext:ve,goPrev:ye,index:p,history:E,loading:W,exhausted:U});o.useEffect(()=>{we.current={goNext:ve,goPrev:ye,index:p,history:E,loading:W,exhausted:U}},[ve,ye,p,E,W,U]),o.useEffect(()=>{const e=Ae.current;if(!e)return;const t=i=>{if(e){const S=e.getBoundingClientRect(),z=i.clientX,R=i.clientY;if(z<S.left||z>S.right||R<S.top||R>S.bottom)return}i.preventDefault(),i.stopPropagation();const c=Date.now();if(c<Q.current||(Q.current=c+1e3,Math.abs(i.deltaY)<Math.abs(i.deltaX)))return;const{goNext:m,goPrev:h}=we.current;i.deltaY>0?m():h()},r=i=>{K.current=i.touches[0].clientY,Z.current=Date.now()},a=i=>{if(K.current===null||Z.current===null)return;const c=i.changedTouches[0].clientY,m=Date.now(),h=K.current-c,S=m-Z.current;if(K.current=null,Z.current=null,Math.abs(h)<50||S>300)return;const z=Date.now();if(z<Q.current)return;Q.current=z+1e3;const{goNext:R,goPrev:u}=we.current;h>0?R():u()};return e.addEventListener("wheel",t,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",t,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",t,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a),window.removeEventListener("wheel",t,{capture:!0})}},[]);const Ze=async()=>{if(n){Se(!0);try{const e=O("csrf")||"",t=n.liked_by_me?"DELETE":"POST",r=await fetch(`${f}/api/videos/${n.id}/like`,{method:t,credentials:"include",headers:{"X-CSRF-Token":e}});if(r.status===429){j("Please slow down a bit.",{durationMs:5e3,variant:"warn"});return}if(r.ok){const a=await r.json();I(i=>{const c=[...i];return c[p]={...c[p],liked_by_me:!n.liked_by_me,likes_count:a.likes_count},c})}}finally{Se(!1)}}};async function ze(e){if(!n)return;const t=O("csrf")||"";(await fetch(`${f}/api/videos/${n.id}/flag`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({reason:e})})).ok?j("Thanks for your report.",{variant:"info"}):j("Report failed",{variant:"error"}),X(!1)}o.useEffect(()=>{if(!oe)return;const e=t=>{ie.current&&!ie.current.contains(t.target)&&X(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[oe]),o.useEffect(()=>{if(!ae)return;const e=t=>{le.current&&!le.current.contains(t.target)&&ce(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ae]),o.useEffect(()=>{if(!ue)return;const e=t=>{fe.current&&!fe.current.contains(t.target)&&pe.current&&!pe.current.contains(t.target)&&q(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ue]),o.useEffect(()=>{E.length===0&&G()},[]),o.useEffect(()=>{(async()=>{try{const e=$().join(","),t=await fetch(`${f}/api/feed/progress?modes=${encodeURIComponent(e)}`,{credentials:"include"});if(t.ok){const r=await t.json(),a=Number(r.eligible||0),i=Number(r.viewed||0);D(a),P(i);const c=a>0&&i>=a;M(c)}}catch{}})()},[]),o.useEffect(()=>{const e=()=>{I([]),F([]),k.current.clear(),L(-1),M(!1),(async()=>{try{const t=$().join(","),r=await fetch(`${f}/api/feed/progress?modes=${encodeURIComponent(t)}`,{credentials:"include"});if(r.ok){const a=await r.json(),i=Number(a.eligible||0),c=Number(a.viewed||0);D(i),P(c),M(!1)}}catch{}G()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),o.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const t=JSON.parse(e);if(Array.isArray(t))for(const r of t)typeof r=="number"&&k.current.add(r)}}catch{}},[]),o.useEffect(()=>{(async()=>{try{const e=await fetch(`${f}/api/me`,{credentials:"include"});e.ok&&Qe(await e.json())}catch{}})()},[]);const Y=o.useRef(!1);o.useEffect(()=>{V(!1),me(!1),Y.current?N(!1):N(!0)},[n==null?void 0:n.id]),o.useEffect(()=>{x.current&&(x.current.muted=T)},[T]),o.useEffect(()=>{if(n&&x.current){const e=setTimeout(()=>{const t=x.current;t&&(!Y.current?(t.muted=!0,t.play().catch(a=>{console.debug("Autoplay prevented:",a)})):(t.muted=!1,N(!1),t.play().then(()=>{}).catch(a=>{console.debug("Unmuted play failed, falling back to muted:",a),t.muted=!0,N(!0),t.play().catch(()=>{console.debug("Autoplay prevented:",a)})})))},100);return()=>clearTimeout(e)}},[n==null?void 0:n.id]);const ee=o.useRef(!1),et=e=>{x.current=e,e&&(ee.current&&Y.current?(e.muted=!1,N(!1),e.play().then(()=>{ee.current=!1}).catch(()=>{e.muted=!0,N(!0),ee.current=!1,e.play().catch(()=>{})})):e.muted=T)},Le=async()=>{if(n!=null&&n.id)try{const e=await fetch(`${f}/api/videos/${n.id}/comments`,{credentials:"include"});if(e.ok){const t=await e.json();Ee(t.items||[])}}catch{}};o.useEffect(()=>{d&&(n!=null&&n.id)&&Le()},[d,n==null?void 0:n.id]);const Fe=async e=>{if(e.preventDefault(),!(!H.trim()||!(n!=null&&n.id))){Ie(!0);try{const t=O("csrf")||"",r=await fetch(`${f}/api/videos/${n.id}/comments`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({text:H.trim(),parent_id:he||void 0})});if(r.ok)J(""),ge(null),Le(),I(a=>{const i=[...a],c=i.findIndex(m=>m.id===n.id);return c!==-1&&(i[c]={...i[c],comments_count:(i[c].comments_count||0)+1}),i}),j("Comment posted!",{variant:"success"});else{const a=await r.json().catch(()=>({}));j(a.error||"Failed to post comment",{variant:"error"})}}catch{j("Failed to post comment",{variant:"error"})}finally{Ie(!1)}}},tt=e=>{Ee(t=>t.filter(r=>r.id!==e)),I(t=>{const r=[...t],a=r.findIndex(i=>i.id===(n==null?void 0:n.id));return a!==-1&&(r[a]={...r[a],comments_count:Math.max(0,(r[a].comments_count||0)-1)}),r})},De=Ce.filter(e=>!e.parent_id),te=new Map;Ce.filter(e=>e.parent_id).forEach(e=>{const t=e.parent_id;te.has(t)||te.set(t,[]),te.get(t).push(e)});const x=o.useRef(null),ne=o.useRef(null),A=o.useRef(!1),nt=()=>{if(!x.current||A.current)return;const e=x.current,t=!T;N(t),e.muted=t,t||(Y.current=!0),!t&&e.paused&&e.play().catch(r=>{console.debug("Play failed after unmute:",r)})},Pe=()=>{x.current&&(A.current=!1,ne.current=window.setTimeout(()=>{A.current=!0;const e=x.current;e&&!e.paused&&e.pause()},200))},je=()=>{if(ne.current&&(clearTimeout(ne.current),ne.current=null),A.current&&x.current){const e=x.current;e.paused&&e.play().catch(t=>console.debug("Resume failed:",t)),A.current=!1}},st=()=>{Pe()},rt=e=>{A.current&&e.preventDefault(),je()},Ue=!!(_!=null&&_.is_admin||_!=null&&_.is_mod);async function ot(){if(!n)return;const e=O("csrf")||"",t=!n.is_starred,r=t?"star":"unstar";(await fetch(`${f}/api/admin/videos/${n.id}/${r}`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(I(i=>{const c=[...i];return c[p]={...c[p],is_starred:t},c}),ce(!1),j(t?"Post starred":"Star removed",{variant:"success"})):j("Action failed",{variant:"error"})}async function Oe(){if(!n||!confirm("Permanently delete this video?"))return;const e=O("csrf")||"";(await fetch(`${f}/api/videos/${n.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(j("Deleted",{variant:"warn"}),X(!1),I(r=>{const a=r.filter((i,c)=>c!==p);return a.length===0?(L(-1),setTimeout(G,0)):L(i=>Math.max(0,Math.min(i,a.length-1))),a})):alert("Delete failed")}ct();const Ae=o.useRef(null),[se,it]=o.useState(0);return o.useEffect(()=>{const e=()=>{const t=document.querySelector(".top-nav");t&&it(t.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.jsxs(s.Fragment,{children:[s.jsx(wt,{paused:!1}),s.jsxs("div",{ref:Ae,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[U&&s.jsx("div",{className:"chip info",style:{position:"absolute",top:se+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),s.jsx("div",{className:"video-area",style:{position:"absolute",top:se,left:0,right:0,bottom:d?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:Ge?s.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[s.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),s.jsx("button",{className:"btn",onClick:()=>window.location.href=`${f}/api/auth/login`,children:"Login with osu!"})]}):n?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:de&&n.beatmapset_id?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:s.jsx(bt,{downloadUrl:`${f}/api/osu/beatmapsets/${n.beatmapset_id}/download?noVideo=1`,beatmapId:n.beatmap_id??void 0,beatmapVersion:n.beatmap_version??void 0,onOpenInEditor:()=>{V(!1),window.location.hash="/editor"}})}):s.jsxs("div",{style:{width:d?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:d?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:d?`calc(50vh - ${se}px)`:`calc(100vh - ${se}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),s.jsx("div",{style:{position:"relative",zIndex:1},children:s.jsxs("div",{onClick:nt,onMouseDown:Pe,onMouseUp:je,onMouseLeave:je,onTouchStart:st,onTouchEnd:rt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[s.jsx(xt,{streamUID:n.stream_uid,playbackUrl:n.playback_url,aspectRatio:n!=null&&n.width&&(n!=null&&n.height)?n.width/n.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:T,controls:!1,onVideoRef:et}),s.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:T?1:0},children:T?s.jsx(lt,{size:20,color:"#fff"}):s.jsx(dt,{size:20,color:"#fff"})})]})})]})}):U?null:s.jsx("div",{className:"muted",style:{zIndex:10},children:"No videos yet"})}),n&&!de&&s.jsxs("div",{style:{position:"absolute",right:d?12:16,top:"50%",display:"flex",flexDirection:"column",gap:d?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:d?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[s.jsx(We,{to:`/profile/${(Be=n.uploader)==null?void 0:Be.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Ve=n.uploader)!=null&&Ve.avatar_url?s.jsx("img",{src:n.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:n.uploader.username}):s.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:Ze,disabled:Je,"aria-label":n.liked_by_me?"Unlike":"Like",title:n.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:n.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.liked_by_me?s.jsx(ut,{size:28}):s.jsx(ft,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.likes_count??0})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:()=>me(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(pt,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.comments_count??0})]}),n.beatmap_url&&s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{ref:pe,onClick:()=>q(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(Xe,{size:24})}),ue&&s.jsxs("div",{ref:fe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsxs("a",{className:"menu-item",href:n.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>q(!1),children:[s.jsx(Xe,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),n.beatmapset_id&&s.jsx("button",{className:"menu-item",onClick:()=>{V(!0),q(!1)},children:"Preview"})]})]}),Ue?s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{onClick:()=>ce(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(qe,{size:24})}),ae&&s.jsxs("div",{ref:le,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("button",{className:"menu-item",onClick:ot,children:n.is_starred?"Unstar post":"Star post"}),s.jsx("button",{className:"menu-item",onClick:Oe,children:"Delete video"})]})]}):s.jsx("button",{onClick:()=>X(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(mt,{size:24})}),oe&&s.jsxs("div",{ref:ie,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),s.jsx("button",{className:"menu-item",onClick:()=>ze("unrelated"),children:"Unrelated"}),s.jsx("button",{className:"menu-item",onClick:()=>ze("explicit"),children:"Explicit"}),Ue&&s.jsx("button",{className:"menu-item",onClick:Oe,children:"Delete video"})]})]}),n&&!de&&s.jsxs("div",{style:{position:"absolute",left:d?12:16,bottom:d?"55%":80,right:d?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:d?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:d?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:s.jsx(We,{to:`/profile/${(He=n.uploader)==null?void 0:He.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:d?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var a,i,c;const e=(a=n.uploader)==null?void 0:a.is_admin,t=(i=n.uploader)==null?void 0:i.is_mod,r=e?"#fff3bf":t?"#d7fbe8":"#fff";return s.jsxs(s.Fragment,{children:[s.jsxs("span",{style:{color:r},children:["@",(c=n.uploader)==null?void 0:c.username]}),n.is_starred&&s.jsx(ht,{size:d?14:16,color:"#f59e0b",title:"Starred"}),(e||t)&&s.jsx(qe,{size:d?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(n.description??"").trim()&&s.jsx("div",{style:{color:"#fff",fontSize:d?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:n.description}),n.beatmap_title&&s.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:d?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[n.beatmap_artist," – ",n.beatmap_title," ",n.beatmap_mapper?`(by ${n.beatmap_mapper})`:""," ",n.beatmap_version?`[${n.beatmap_version}]`:""]})]}),d&&n&&s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),s.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[s.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",n.comments_count??0,")"]}),s.jsx("button",{onClick:()=>me(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:s.jsx(gt,{size:24})})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:De.length===0?s.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):s.jsx("div",{className:"col",style:{gap:0},children:De.map(e=>s.jsx(yt,{comment:e,replies:te.get(e.id)||[],me:_,section:"mappi",onReply:t=>ge(t),onDelete:tt,replyingTo:he,replyText:H,onReplyTextChange:J,onReplySubmit:Fe,posting:xe,onCancelReply:()=>{ge(null),J("")}},e.id))})}),_&&!he&&s.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:s.jsxs("form",{onSubmit:Fe,style:{display:"flex",alignItems:"flex-end",gap:8},children:[s.jsx("textarea",{placeholder:"Write a comment...",value:H,onChange:e=>J(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,120)}px`}}),s.jsx("button",{type:"submit",className:"btn compact",disabled:xe||!H.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:xe?"...":"Post"})]})})]})]})]})]})}export{Tt as default};
