const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-DJAKTnp6.js","assets/vendor-react-BUPocPCH.js","assets/vendor-DIUxzxhw.js","assets/moddi-routes-DBxPczQb.js","assets/editor-MZP5zgVH.js","assets/vendor-zip-DT3bY-99.js","assets/beatmap-preview-Bp3JZFQW.js","assets/editor-CG1yLUbS.css","assets/editor-components-BwFQHcOw.js","assets/editor-components-Bzmrvihl.css","assets/vendor-hls-B_fsdCYC.js"])))=>i.map(i=>d[i]);
var At=Object.defineProperty;var Pt=(t,o,s)=>o in t?At(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s;var tt=(t,o,s)=>Pt(t,typeof o!="symbol"?o+"":o,s);import{r,j as e,g as Pe,t as Fe,R as T,v as Ke,o as qe,P as zt,Q as st,S as Rt,L as de,T as It,U as Ft,B as mt,V as Dt,W as Wt,C as Qe,z as Bt,D as et,E as Ve,G as at,H as Ht,I as $t,n as Ut,c as De,x as qt,i as Ge,X as Ot,q as Qt,Y as it,F as pt,k as Kt,Z as ht,_ as Ye,h as Xe,$ as Gt,a0 as Jt,s as ft,K as Vt,N as Yt,a1 as nt,a2 as Xt,a3 as Zt,a4 as gt,e as es,a5 as ts,a6 as ss,a7 as as,a8 as is,a9 as me,aa as Me}from"./vendor-react-BUPocPCH.js";import{y as ns}from"./vendor-DIUxzxhw.js";import{u as ze,a as xt,b as Le,c as Ne,d as $,A as R,e as bt,O as Ae,f as rs,g as os,h as ls,i as vt,j as ds,k as $e,l as cs,F as us,m as _e,n as Ze,o as Ee,D as ms,p as ps,T as hs,U as fs,Q as gs,N as xs}from"./moddi-routes-DBxPczQb.js";import{i as yt,a as jt,b as wt,c as Nt,H as bs}from"./editor-components-BwFQHcOw.js";import{H as ve}from"./vendor-hls-B_fsdCYC.js";import{B as St,s as vs,E as ys}from"./editor-MZP5zgVH.js";import{P as js}from"./beatmap-preview-Bp3JZFQW.js";import"./vendor-zip-DT3bY-99.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const m of a)if(m.type==="childList")for(const c of m.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const m={};return a.integrity&&(m.integrity=a.integrity),a.referrerPolicy&&(m.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?m.credentials="include":a.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function u(a){if(a.ep)return;a.ep=!0;const m=s(a);fetch(a.href,m)}})();const ws="modulepreload",Ns=function(t){return"/"+t},rt={},Ss=function(o,s,u){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),j=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=Promise.allSettled(s.map(i=>{if(i=Ns(i),i in rt)return;rt[i]=!0;const g=i.endsWith(".css"),f=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${f}`))return;const h=document.createElement("link");if(h.rel=g?"stylesheet":ws,g||(h.as="script"),h.crossOrigin="",h.href=i,j&&h.setAttribute("nonce",j),document.head.appendChild(h),g)return new Promise((b,_)=>{h.addEventListener("load",b),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${i}`)))})}))}function m(c){const j=new Event("vite:preloadError",{cancelable:!0});if(j.payload=c,window.dispatchEvent(j),!j.defaultPrevented)throw c}return a.then(c=>{for(const j of c||[])j.status==="rejected"&&m(j.reason);return o().catch(m)})},ks=new ns({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class _s extends r.Component{constructor(s){super(s);tt(this,"handleRetry",()=>{const s=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),s&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,u){console.error("ErrorBoundary caught an error:",s,u)}isChunkLoadingError(s){if(!s)return!1;const u=s.message.toLowerCase();return u.includes("loading chunk")||u.includes("failed to load")||u.includes("chunk load failed")||u.includes("loading css chunk")||s.name==="ChunkLoadError"}render(){var s;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const u=this.isChunkLoadingError(this.state.error),a=((s=this.state.error)==null?void 0:s.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:u?"Failed to load page. This might be a network issue.":a}),u&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:u?"Reload Page":"Try Again"}),!u&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const Se=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Es({i:t}){const o=t*1337,s=(_,k)=>{const v=Math.sin(o+_+k)*1e4,N=v-Math.floor(v);return Math.floor(N*(k-_+1)+_)},u=s(0,100),a=s(24,50),m=.7+s(0,100)/100*.3,c=a*m,j=s(0,4e3),i=s(-10,10),g=s(-8,8),f=s(0,100),h=f<60?1:f<80?1.5:2,b=[{size:200*h,alpha:.06,dx:-22,dy:12,color:Se[s(0,Se.length-1)]},{size:150*h,alpha:.08,dx:-9,dy:7,color:Se[s(0,Se.length-1)]},{size:120*h,alpha:.1,dx:0,dy:0,color:Se[s(0,Se.length-1)]},{size:90*h,alpha:.12,dx:12,dy:-4,color:Se[s(0,Se.length-1)]},{size:64*h,alpha:.13,dx:20,dy:-7,color:Se[s(0,Se.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${u}vw`,animationDuration:`${c}s`,animationDelay:`${j}ms`,"--tx":`${i}vw`,transform:`rotate(${g}deg)`},children:b.map((_,k)=>e.jsx("svg",{width:_.size,height:_.size,viewBox:"0 0 100 100",style:{left:`${50+_.dx}%`,bottom:`${_.dy}px`,transform:"translateX(-50%)","--alpha":_.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:_.color})},k))})}function Ls({paused:t=!1}){const o=r.useMemo(()=>new Array(20).fill(0).map((s,u)=>u),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:o.map(s=>e.jsx(Es,{i:s},s))})}function Cs(){const t=Pe(),o=Fe(),{lastSection:s,previousLocation:u,setPreviousLocation:a}=ze(),m=T.useRef(null);T.useRef(!1),T.useRef(0),T.useRef(0);const c=T.useRef(null),j=T.useRef(null);T.useRef(!1);const i=T.useRef(null),g=T.useRef(null),f=T.useRef(null),[h,b]=T.useState(!1),[_,k]=T.useState(12),v=T.useRef(null),N=T.useRef(null),[x,C]=T.useState(!1),[Q,y]=T.useState(12),[K,A]=T.useState([]),[n,B]=T.useState(""),W=T.useRef(null),L=T.useRef(null),[F,P]=T.useState(!1),[E,D]=T.useState(12),[S,q]=T.useState(null),V=T.useCallback(()=>{if(!g.current)return;const z=g.current.getBoundingClientRect(),oe=window.innerWidth||document.documentElement.clientWidth||320,re=160;let Z=z.left;Z+re+8>oe&&(Z=Math.max(8,oe-re-8)),Z=Math.max(8,Z),k(Z)},[]),l=T.useCallback(()=>{if(!v.current)return;const z=v.current.getBoundingClientRect(),oe=window.innerWidth||document.documentElement.clientWidth||320,re=220;let Z=z.left;Z+re+8>oe&&(Z=Math.max(8,oe-re-8)),Z=Math.max(8,Z),y(Z)},[]),M=T.useCallback(()=>{if(!W.current)return;const z=W.current.getBoundingClientRect(),oe=window.innerWidth||document.documentElement.clientWidth||320,re=280;let Z=z.left;Z+re+8>oe&&(Z=Math.max(8,oe-re-8)),Z=Math.max(8,Z),D(Z)},[]);T.useEffect(()=>()=>{m.current&&clearTimeout(m.current),c.current&&clearTimeout(c.current),j.current&&clearTimeout(j.current)},[]),T.useEffect(()=>{if(!h)return;const z=oe=>{const re=oe.target;f.current&&!f.current.contains(re)&&g.current&&!g.current.contains(re)&&b(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[h]),T.useEffect(()=>{if(!x)return;const z=oe=>{const re=oe.target;N.current&&!N.current.contains(re)&&v.current&&!v.current.contains(re)&&C(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[x]),T.useEffect(()=>{if(!F)return;const z=oe=>{const re=oe.target;L.current&&!L.current.contains(re)&&W.current&&!W.current.contains(re)&&P(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[F]),T.useEffect(()=>{if(!h)return;V();const z=()=>V();return window.addEventListener("resize",z),window.addEventListener("orientationchange",z),()=>{window.removeEventListener("resize",z),window.removeEventListener("orientationchange",z)}},[h,V]),T.useEffect(()=>{if(!x)return;l();const z=()=>l();return window.addEventListener("resize",z),window.addEventListener("orientationchange",z),()=>{window.removeEventListener("resize",z),window.removeEventListener("orientationchange",z)}},[x,l]),T.useEffect(()=>{if(!F)return;M();const z=()=>M();return window.addEventListener("resize",z),window.addEventListener("orientationchange",z),()=>{window.removeEventListener("resize",z),window.removeEventListener("orientationchange",z)}},[F,M]);const I=t.pathname==="/feed"||t.pathname.startsWith("/feed/")||t.pathname==="/queues"||t.pathname.startsWith("/queues/")||t.pathname==="/discover"||t.pathname==="/submissions",X=t.pathname==="/"||t.pathname==="/about",ie=t.pathname==="/editor";t.pathname.startsWith("/mp/")||I&&s==="mappi"||!X&&!I&&t.pathname.startsWith("/md/"),t.pathname.startsWith("/md/")||I&&s==="moddi"||!X&&!I&&t.pathname.startsWith("/mp/"),T.useEffect(()=>{if(!ie)return;const z=re=>{const Z=re.detail||{},U=Array.isArray(Z.items)?Z.items:[];A(U),B(String(Z.selected||""))},oe=re=>{const Z=re.detail||{};q({title:String(Z.title||""),artist:String(Z.artist||""),mapper:String(Z.mapper||""),version:String(Z.version||""),beatmapId:Number(Z.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",z),window.addEventListener("editor:info",oe),()=>{window.removeEventListener("editor:difficulty:list",z),window.removeEventListener("editor:info",oe)}},[ie]);const ne=xt(),{data:w}=Le(),O=T.useRef(null),te=T.useRef(!1),se=z=>{te.current=!1,(w!=null&&w.is_mod||w!=null&&w.is_admin)&&(z.preventDefault(),z.stopPropagation(),O.current=setTimeout(()=>{te.current=!0,o("/moderation")},500))},pe=()=>{O.current&&(clearTimeout(O.current),O.current=null),te.current&&setTimeout(()=>{te.current=!1},100)},d=z=>{if(te.current){z.preventDefault(),z.stopPropagation();return}o("/settings")},H=z=>{if(pe(),te.current){z.preventDefault();return}o("/settings")};if(T.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]),X)return null;const he=()=>{o(u||"/feed")},ae=()=>{b(z=>!z)},xe=()=>{var z;b(!1),(z=i.current)==null||z.click()},ye=()=>{C(z=>!z)},We=z=>{C(!1),B(z),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:z}}))},Be=()=>{P(z=>!z)};return ie?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:i,type:"file",accept:".osz,.zip",onChange:z=>{var re;const oe=(re=z.target.files)==null?void 0:re[0];oe&&window.dispatchEvent(new CustomEvent("editor:file",{detail:oe}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:he,"aria-label":"Back",title:"Go back",children:e.jsx(Ke,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:g,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ae,"aria-label":"File",title:"File menu","aria-expanded":h,children:e.jsx(zt,{size:20})}),h&&qe.createPortal(e.jsx("div",{ref:f,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${_}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:xe,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:he,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[K.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:v,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ye,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":x,children:e.jsx(st,{size:20})}),x&&qe.createPortal(e.jsx("div",{ref:N,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${Q}px`,minWidth:220},children:K.map(z=>{const oe=z.mode==="taiko"?yt:z.mode==="mania"?jt:z.mode==="catch"?wt:Nt;return e.jsxs("button",{className:`mode-option ${n===z.path?"selected":""}`,type:"button",onClick:()=>We(z.path),children:[e.jsx("img",{className:"mode-icon",src:oe,width:24,height:24,alt:""}),e.jsx("span",{children:z.version||"(Untitled)"})]},z.path)})}),document.body)]}),S&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:W,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Be,"aria-label":"Map Info",title:"Map Info","aria-expanded":F,children:e.jsx(Rt,{size:20})}),F&&qe.createPortal(e.jsx("div",{ref:L,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${E}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[S.artist||"Artist"," – ",S.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",S.mapper||"Unknown"]}),S.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",S.version]}),S.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${S.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]}):e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(de,{to:"/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/feed"||t.pathname.startsWith("/feed/")?"active":""}`,"aria-label":"Feed",children:e.jsx(st,{size:20})}),e.jsx(de,{to:"/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(It,{size:20})}),e.jsx(de,{to:"/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/queues"||t.pathname.startsWith("/queues/")?"active":""}`,"aria-label":"Queues",children:e.jsx(Ft,{size:20})})]}),e.jsx(de,{to:"/",className:"mobile-bottom-nav-coin-flip","aria-label":"Home",title:"Go to home",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"m!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(de,{to:"/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(mt,{size:20}),ne>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:d,onTouchStart:se,onTouchEnd:H,onMouseDown:se,onMouseUp:pe,onMouseLeave:pe,"aria-label":w!=null&&w.is_mod||w!=null&&w.is_admin?"Settings (long press for moderation)":"Settings",title:w!=null&&w.is_mod||w!=null&&w.is_admin?"Settings (long press for moderation)":"Settings",children:e.jsx(Dt,{size:20})})]})]})}function Ts(){return e.jsx(de,{to:"/feed",className:"title",style:{textDecoration:"none",color:"inherit"},children:"mappi"})}function Ms({isEditor:t}){return Pe(),t?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(de,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Wt,{size:18})}),e.jsx(de,{to:"/feed",className:"title",children:"osu!editi.ng"})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:4},children:e.jsx(Ts,{})})}function As({isNeutralPage:t}){const s=Pe().pathname;return t&&s!=="/"?e.jsx("nav",{className:"nav-links","aria-label":"Primary",children:e.jsx(de,{to:s==="/about"?"/":"/about",className:s==="/about"?"active":"",children:s==="/about"?"Home":"About"})}):e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[e.jsx(de,{to:"/feed",className:s==="/feed"||s.startsWith("/feed/")?"active":"",children:"Feed"}),e.jsx(de,{to:"/discover",className:s==="/discover"?"active":"",children:"Discover"}),e.jsx(de,{to:"/queues",className:s==="/queues"||s.startsWith("/queues/")?"active":"",children:"Queues"}),e.jsx(de,{to:"/editor",className:s==="/editor"?"active":"",children:"Editor"})]})}function Ps(t,o,s,u){const a=Fe(),{notify:m}=Ne(),[c,j]=r.useState(new Set);return{parseQueueInvite:k=>{if(!k)return null;try{const v=JSON.parse(k);if((v==null?void 0:v.type)==="queue_invite"&&(v!=null&&v.queue_id))return v}catch{}return null},handleAcceptInvite:async(k,v)=>{if(!c.has(k.id)){j(N=>new Set(N).add(k.id));try{await $(R.moddi.queueAccept(String(v)),{method:"POST"}),m("Invitation accepted!",{variant:"success"}),s.mutate(k.id),u(!1),a(`/queues/${v}`)}catch(N){m((N==null?void 0:N.message)||"Failed to accept invitation",{variant:"error"})}finally{j(N=>{const x=new Set(N);return x.delete(k.id),x})}}},handleDenyInvite:async(k,v)=>{if(!c.has(k.id)){j(N=>new Set(N).add(k.id));try{await $(R.moddi.queueDeny(String(v)),{method:"POST"}),m("Invitation declined",{variant:"success"}),s.mutate(k.id)}catch(N){m((N==null?void 0:N.message)||"Failed to decline invitation",{variant:"error"})}finally{j(N=>{const x=new Set(N);return x.delete(k.id),x})}}},handleMarkAllRead:async()=>{const k=t.filter(v=>v.id.startsWith("n:")||v.kind==="system"&&!v.read).map(v=>v.id);k.length>0&&o.mutate(k)},handleNotificationClick:async k=>{u(!1),o.mutate([k.id]);const v=typeof k.targetPath=="string"&&k.targetPath.trim().length>0?k.targetPath:null;if(v&&a(v),k.kind==="system"||k.id.startsWith("n:"))try{await $(R.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[k.id]})})}catch{}},handleDeleteNotification:async(k,v)=>{k.stopPropagation(),s.mutate(v)},processing:c}}function zs({notifications:t,unreadCount:o,notifOpen:s,setNotifOpen:u,markReadMutation:a,deleteNotificationMutation:m,closeAllPanels:c}){const j=r.useRef(null),i=r.useRef(null),{parseQueueInvite:g,handleAcceptInvite:f,handleDenyInvite:h,handleMarkAllRead:b,handleNotificationClick:_,handleDeleteNotification:k,processing:v}=Ps(t,a,m,u);bt(j,i,s,()=>u(!1));const N=t.filter(x=>!(x.kind==="system"&&x.id.startsWith("b:")&&(x.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:j,className:"icon-link",onClick:()=>{s||c(),u(!s)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(mt,{size:18})}),o>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),s&&e.jsxs("div",{ref:i,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(de,{to:"/notifications",onClick:()=>u(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:x=>x.currentTarget.style.opacity="1",onMouseLeave:x=>x.currentTarget.style.opacity="0.7",children:"View all"}),N.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:b,children:e.jsx(Qe,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[N.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),N.map(x=>{const C=g(x.text),Q=x.id.startsWith("b:"),y=C?"queue-invite":x.kind==="star"?"star":x.kind==="likes5"?"likes":x.kind==="comment"?"comment":x.kind==="inspiration"?"inspiration":x.kind==="reaction"?"reaction":Q?"global":"system",K=x.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${y}`,role:"button",onClick:()=>!C&&_(x),children:[e.jsxs("div",{className:`notif-icon ${K?"deletable":""}`,"aria-hidden":"true",onClick:K&&!C?A=>k(A,x.id):void 0,title:K&&!C?"Remove":void 0,role:K&&!C?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:C?e.jsx(Bt,{}):y==="star"?e.jsx(et,{}):y==="likes"?e.jsx(Ve,{}):y==="comment"?e.jsx(at,{}):y==="inspiration"?e.jsx(at,{}):y==="reaction"?e.jsx(Ht,{}):y==="global"?e.jsx($t,{}):null}),K&&!C?e.jsx("span",{className:"swap-trash",children:e.jsx(Ut,{})}):null]}),e.jsx("div",{className:"notif-body",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[C.inviter_username," invited you to join queue: ",C.queue_name]}),v.has(x.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:A=>{A.stopPropagation(),f(x,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Qe,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:A=>{A.stopPropagation(),h(x,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(De,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):x.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:Q?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ae,{text:x.text||""})}),Q&&x.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(x.expiresAt).toLocaleString()]}):null]}):x.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ae,{text:x.text||"Someone commented on your post"})})]}):x.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ae,{text:x.text||"Someone is inspired by you!"})})]}):x.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ae,{text:x.text||"Someone raised their hand on your post!"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:x.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:x.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},x.id)})]})]})]})}function Rs({quota:t,nowTick:o}){if(!(t!=null&&t.blocked))return null;const s=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),u=Math.floor(s/3600),a=Math.floor(s%3600/60),m=s%60,c=i=>String(i).padStart(2,"0"),j=u>0?`${u}:${c(a)}:${c(m)}`:`${a}:${c(m)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(qt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:j})]})}function Is({me:t,menuOpen:o,setMenuOpen:s,onLogout:u,closeAllPanels:a}){const m=r.useRef(null),c=r.useRef(null);return bt(m,c,o,()=>s(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:m,className:"icon-link",onClick:()=>{o||a(),s(!o)},title:t.username,"aria-label":"User menu","aria-expanded":o,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(Ge,{size:14,style:{opacity:.8}})]}),o&&e.jsxs("div",{ref:c,className:"menu-panel",role:"menu",children:[e.jsx(de,{to:"/profile",className:"menu-item",onClick:()=>s(!1),children:"Profile"}),e.jsx(de,{to:"/settings",className:"menu-item",onClick:()=>s(!1),children:"Settings"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(de,{to:"/moderation",className:"menu-item",onClick:()=>s(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:u,children:"Log out"})]})]})}function Fs({isNeutralPage:t,isEditor:o}){const s=Pe(),u=Fe(),{data:a,isLoading:m}=Le(),{data:c}=rs(!!a),{data:j=[]}=os(!!a),i=xt(),g=ls(),f=vt(),h=ds(),{menuOpen:b,notifOpen:_,setMenuOpen:k,setNotifOpen:v,closeAllPanels:N,previousLocation:x,lastSection:C}=ze(),Q=s.pathname==="/settings",y=s.pathname==="/moderation",K=s.pathname==="/profile"||s.pathname.startsWith("/profile/"),A=Q||y||K,n=()=>{u(x||"/feed")},[B,W]=T.useState(0);return T.useEffect(()=>{const L=setInterval(()=>W(F=>F+1),1e3);return()=>clearInterval(L)},[]),e.jsxs("header",{className:"top-nav",children:[A?e.jsx("button",{onClick:n,className:"icon-link",title:"Go back","aria-label":"Go back",style:{width:"auto",height:"auto",padding:"2px"},children:e.jsx(Ke,{size:18})}):e.jsx("img",{src:"/icon.png",alt:"o!m",width:24,height:24,style:{objectFit:"contain"}}),e.jsx(Ms,{isEditor:o}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),s.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(bs,{})}):e.jsxs(e.Fragment,{children:[e.jsx(As,{isNeutralPage:t}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Ot,{size:18})}),a?e.jsxs("div",{className:"user-menu",children:[e.jsx(zs,{notifications:j,unreadCount:i,notifOpen:_,setNotifOpen:v,markReadMutation:f,deleteNotificationMutation:h,closeAllPanels:N}),e.jsx(Rs,{quota:c,nowTick:B}),e.jsx(Is,{me:a,menuOpen:b,setMenuOpen:k,onLogout:()=>g.mutate(),closeAllPanels:N})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=$e+R.auth.login},disabled:m,children:m?"Checking…":"Login with osu!"})]})]})}function Ds({title:t,onRefresh:o}){const{data:s}=Le(),u=Pe(),a=Fe(),{lastSection:m}=ze(),[c,j]=T.useState(!0),[i,g]=T.useState(0),[f,h]=T.useState(!1),b=T.useRef(!1),_=T.useRef(0),[k,v]=T.useState(!1),N=T.useRef(null),{data:x=[]}=cs(),C=vt(),{notify:Q}=Ne();T.useEffect(()=>{const n=document.querySelector(".page");if(!n)return;let B=n.scrollTop,W=!1;const L=()=>{W||(W=!0,requestAnimationFrame(()=>{const F=n.scrollTop,P=F-B;F<=12||P<-12?j(!0):P>12&&j(!1),B=F,W=!1}))};return n.addEventListener("scroll",L,{passive:!0}),()=>n.removeEventListener("scroll",L)},[]),T.useEffect(()=>{const n=document.querySelector(".page");if(!n)return;const B=120,W=70,L=D=>{var S;f||(n.scrollTop<=0?(b.current=!0,_.current=((S=D.touches[0])==null?void 0:S.clientY)??0):b.current=!1)},F=D=>{var V;if(!b.current||f)return;const S=((V=D.touches[0])==null?void 0:V.clientY)??0,q=Math.max(0,S-_.current);if(q>0){const l=Math.min(B,q*.5);g(l)}},P=async()=>{try{if(h(!0),o)await o();else{window.location.reload();return}}finally{setTimeout(()=>{h(!1),g(0)},400)}},E=()=>{!b.current||f||(i>=W?P():g(0),b.current=!1)};return n.addEventListener("touchstart",L,{passive:!0}),n.addEventListener("touchmove",F,{passive:!0}),n.addEventListener("touchend",E),n.addEventListener("touchcancel",E),()=>{n.removeEventListener("touchstart",L),n.removeEventListener("touchmove",F),n.removeEventListener("touchend",E),n.removeEventListener("touchcancel",E)}},[i,f,o]);const{showBack:y,onBack:K}=T.useMemo(()=>{const n=u.pathname;if(/^\/feed\/.+/.test(n))return{showBack:!0,onBack:()=>a("/feed")};if(/^\/mp\/feed\/.+/.test(n))return{showBack:!0,onBack:()=>a("/feed")};if(/^\/md\/feed\/.+/.test(n))return{showBack:!0,onBack:()=>a("/feed")};if(/^\/queues\/.+/.test(n))return{showBack:!0,onBack:()=>a("/queues")};if(/^\/md\/queues\/.+/.test(n))return{showBack:!0,onBack:()=>a("/queues")};if(n==="/profile"||n.startsWith("/profile/")){const B="/feed";return{showBack:!0,onBack:()=>{window.history.length>2?a(-1):a(B)}}}return{showBack:!1,onBack:()=>{}}},[u.pathname,a,m]),A=u.pathname==="/notifications";return e.jsxs("div",{className:`mobile-page-header ${c?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${c?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:y?e.jsx("button",{className:"icon-link",onClick:K,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ke,{size:18})}):e.jsx(de,{to:"/profile",className:"icon-link","aria-label":"Profile",children:s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"var(--hover-overlay-strong)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:A?e.jsx("button",{className:"icon-link","aria-label":"Mark all read",title:"Mark all read",style:{padding:4},onClick:()=>{const n=x.filter(B=>!B.read&&(B.id.startsWith("n:")||B.kind==="system"&&!B.id.startsWith("b:"))).map(B=>B.id);n.length!==0&&C.mutate(n,{onSuccess:()=>{Q("All notifications marked as read",{variant:"success"})}})},children:e.jsx(Qe,{size:18})}):(()=>{const n=u.pathname;let B=null;return n==="/feed"||n==="/mp/feed"?B="mappi-feed":n==="/md/feed"?B="moddi-feed":n==="/queues"||n==="/md/queues"?B="moddi-queues":(n.startsWith("/queues/")||n.startsWith("/md/queues/"))&&(B="moddi-queue-detail"),B?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:N,className:"icon-link","aria-haspopup":"dialog","aria-expanded":k,onClick:()=>v(W=>!W),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(Qt,{size:18})}),k&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(us,{context:B,onClose:()=>v(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:f||i>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(i,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${f?"spin":i>60?"ready":""}`})})]})}function Ws({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function Bs(){const t=Pe(),{notify:o}=Ne(),{data:s}=Le(),{setPreviousLocation:u}=ze(),a=t.pathname,m=a==="/"||a==="/about",c=a==="/editor";T.useEffect(()=>{a==="/settings"||a==="/moderation"||a==="/profile"||a.startsWith("/profile/")||u(a)},[a,u]);const[j,i]=T.useState(null);T.useEffect(()=>{!s||!s.is_mod||(async()=>{try{const h=await $(R.admin.debugState,{requireAuth:!1}),b=Array.isArray(h==null?void 0:h.counts)?h.counts.find(_=>String(_.status)==="ready"):null;b&&i(Number(b.c)||0)}catch{}})()},[s]),T.useEffect(()=>{s&&!localStorage.getItem("welcomed")&&(o(`Welcome, ${s.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[s,o]),T.useEffect(()=>{if(typeof window>"u"||!_e()||a==="/editor")return;const b=document.querySelector(".page");b&&(b.scrollTop=0)},[a]);const{showMobileHeader:g,headerTitle:f}=T.useMemo(()=>{if(a==="/"||a==="/about"||a==="/editor"||a==="/discover"||a==="/mobile")return{showMobileHeader:!1,headerTitle:""};if(a==="/feed"||a.startsWith("/feed/"))return{showMobileHeader:!0,headerTitle:a==="/feed"?"Feed":"Post"};if(a==="/queues"||a.startsWith("/queues/"))return{showMobileHeader:!0,headerTitle:a==="/queues"?"Queues":"Queue"};if(a==="/notifications")return{showMobileHeader:!0,headerTitle:"Notifications"};if(a==="/profile"||a.startsWith("/profile/"))return{showMobileHeader:!0,headerTitle:"Profile"};if(a==="/settings")return{showMobileHeader:!0,headerTitle:"Settings"};if(a==="/moderation")return{showMobileHeader:!0,headerTitle:"Moderation"};if(a.startsWith("/mp/")||a.startsWith("/md/")){const h=a.split("/").filter(Boolean),b=h[1]||"";if(b==="feed")return{showMobileHeader:!0,headerTitle:h.length>2?"Post":"Feed"};if(b==="discover")return{showMobileHeader:!1,headerTitle:""};if(b==="queues")return{showMobileHeader:!0,headerTitle:h.length>2?"Queue":"Queues"}}return{showMobileHeader:!0,headerTitle:""}},[a]);return e.jsxs("div",{className:"app-shell",children:[e.jsx(Ls,{paused:a==="/editor"}),e.jsx(Fs,{isNeutralPage:m,isEditor:c}),e.jsxs("main",{className:`page ${a==="/editor"||a==="/discover"?"fullscreen":""}`,children:[g&&e.jsx(Ds,{title:f}),a==="/about"?e.jsx("div",{className:"card",children:e.jsx(it,{})}):e.jsx(it,{})]}),a!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(Ws,{readyCount:j})}),a!=="/mobile"&&e.jsx(Cs,{})]})}const Hs="theme";function $s(){try{const t=localStorage.getItem(Hs);if(t==="light"||t==="dark")return t}catch{}return null}function kt(t){if(!(typeof document>"u")){document.documentElement.setAttribute("data-theme",t);try{const o=document.querySelector('meta[name="theme-color"]');o&&(o.content=t==="light"?"#ffffff":"#1a1a1a")}catch{}}}function Us(t="dark"){const o=$s()||t;kt(o)}function qs(){const{data:t,isLoading:o}=Le(),s=!!t,u=Fe(),{lastSection:a}=ze(),[m,c]=T.useState(!1);return T.useEffect(()=>{if(typeof window>"u")return;const j=localStorage.getItem("hide_mobile_install_prompt")==="1",i=_e()&&!Ze()&&!j;c(i)},[]),T.useEffect(()=>{Ze()?u("/feed",{replace:!0}):s&&u("/feed",{replace:!0})},[u,s]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
        }
        
        .landing-btn-secondary {
          background: var(--panel);
          color: var(--text);
          border: 1px solid var(--border);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: var(--border-strong);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!s&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),s&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsx("div",{className:"landing-actions landing-actions-desktop",children:e.jsx(de,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})}),!s&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=$e+R.auth.login},disabled:o,children:o?"Checking…":"Login with osu!"})}),s&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx(de,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})})]})]}),m&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{c(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(de,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}const _t=({open:t,onClose:o,buttonRef:s,children:u,align:a="right",minWidth:m=160})=>{const[c,j]=r.useState(null),i=r.useRef(null);if(r.useEffect(()=>{if(!t||!s.current){j(null);return}const f=()=>{if(!s.current)return;const h=s.current.getBoundingClientRect();j({top:h.bottom+8,[a]:window.innerWidth-h[a==="right"?"right":"left"]})};return f(),window.addEventListener("resize",f),window.addEventListener("scroll",f,!0),()=>{window.removeEventListener("resize",f),window.removeEventListener("scroll",f,!0)}},[t,s,a]),r.useEffect(()=>{if(!t)return;const f=h=>{i.current&&!i.current.contains(h.target)&&s.current&&!s.current.contains(h.target)&&o()};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[t,o,s]),!t||!c)return null;const g=e.jsx("div",{ref:i,style:{position:"fixed",top:c.top,[a]:c[a],background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,padding:6,zIndex:1e3,minWidth:m,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:u});return qe.createPortal(g,document.body)},Et=({playbackUrl:t,streamUID:o,aspectRatio:s,preferNative:u=!1,autoplay:a=!1,loop:m=!1,muted:c=!1,controls:j=!0,onVideoRef:i,onClick:g,inOverlay:f=!1})=>{const h=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches,b=r.useRef(null),[_,k]=r.useState(null),v=r.useMemo(()=>{const n=typeof s=="number"&&isFinite(s)&&s>0?s:null;return n||16/9},[s]),x=`${_??v} / 1`,C=r.useMemo(()=>t||(o?`https://videodelivery.net/${o}/manifest/video.m3u8`:null),[t,o]),Q=r.useRef(null);r.useEffect(()=>{C&&(Q.current=C)},[C]),r.useEffect(()=>{k(null)},[C]),r.useEffect(()=>{if(!u||!b.current)return;const n=b.current;let B=!1;const W=()=>{if(!B)if(n.videoWidth>0&&n.videoHeight>0){const L=n.videoWidth/n.videoHeight;k(L),B=!0}else k(v),B=!0};return n.addEventListener("loadedmetadata",W),n.readyState>=1&&W(),()=>{n.removeEventListener("loadedmetadata",W)}},[u,v,C]);const y=r.useRef(null),K=r.useRef(null);r.useEffect(()=>{if(!C)return;let n=y.current,B=null,W=!1,L=null;if(n&&K.current&&K.current!==C){console.log(`[HLS] URL changed from ${K.current} to ${C}, using loadSource`);try{n.stopLoad(),n.loadSource(C),K.current=C;const l=b.current;if(l)try{l.pause(),l.currentTime=0,l.load()}catch(M){console.warn("[HLS] Error resetting video element:",M)}}catch(l){console.error("[HLS] Error switching source:",l);try{n.destroy()}catch{}n=null,y.current=null,K.current=null}}if(n&&K.current===C)return console.log(`[HLS] URL unchanged (${C}), reusing existing HLS instance`),()=>{W=!0};const F=()=>{if(document.hidden&&n){const l=b.current;if(l)try{l.pause()}catch{}try{n.stopLoad()}catch{}}},P=()=>{if(W=!0,n){try{n.stopLoad(),n.detachMedia(),n.destroy()}catch{}n=null}};document.addEventListener("visibilitychange",F),window.addEventListener("beforeunload",P);const E=()=>{const l=b.current;if(!l||W)return;try{for(l.pause(),l.currentTime=0,l.src="",l.srcObject=null;l.firstChild;)l.removeChild(l.firstChild);l.load()}catch(I){console.warn("[HLS] Error resetting video element:",I)}const M=performance.now();if(console.log(`[HLS] Starting HLS setup for ${C} at ${M.toFixed(2)}ms`),console.log("[HLS] Video element ready:",{readyState:l.readyState,isConnected:l.isConnected,paused:l.paused,currentTime:l.currentTime}),ve.isSupported()){console.log("[HLS] HLS.js is supported, creating instance");const I={enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,startLevel:-1,maxBufferLength:20,maxMaxBufferLength:60,maxBufferSize:60*1e3*1e3,maxBufferHole:.3,maxLoadingDelay:2,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxFragLoadingTimeMs:2e4,fragLoadingTimeOut:2e4,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,fragLoadingMaxRetry:3};try{const X=performance.now();n=new ve(I),y.current=n,K.current=C;const ie=performance.now()-X;console.log(`[HLS] HLS instance created in ${ie.toFixed(2)}ms`);const ne=performance.now();n.loadSource(C);const w=performance.now()-ne;console.log(`[HLS] loadSource() called in ${w.toFixed(2)}ms`);const O=performance.now();n.attachMedia(l);const te=performance.now()-O;console.log(`[HLS] attachMedia() completed in ${te.toFixed(2)}ms`);const se=performance.now()-M;console.log(`[HLS] Total HLS setup time: ${se.toFixed(2)}ms`)}catch(X){const ie=performance.now()-M;if(console.error(`[HLS] Failed to initialize HLS after ${ie.toFixed(2)}ms:`,X),n){try{n.destroy()}catch{}n=null}return}n.on(ve.Events.MANIFEST_PARSED,()=>{const X=performance.now()-M;if(console.log(`[HLS] MANIFEST_PARSED event fired at ${X.toFixed(2)}ms after setup start`),W||!l)return;m&&(L=()=>{if(!(W||!l||!n))try{l.currentTime=0,l.play().catch(ne=>{ne.name!=="AbortError"&&ne.name!=="NotAllowedError"&&console.debug("Loop play failed:",ne)})}catch{l.currentTime=0,l.play().catch(()=>{})}},l.addEventListener("ended",L)),(()=>{if(!(W||!l))if(l.readyState>=2){if(a){const ne=performance.now();l.play().then(()=>{const w=performance.now()-ne;console.log(`[HLS] Autoplay succeeded in ${w.toFixed(2)}ms after MANIFEST_PARSED`)}).catch(w=>{const O=performance.now()-ne;w.name!=="AbortError"&&w.name!=="NotAllowedError"&&console.warn(`[HLS] Autoplay prevented after ${O.toFixed(2)}ms:`,w)})}}else{const ne=()=>{if(!(W||!l)&&(l.removeEventListener("canplay",ne),a)){const w=performance.now();l.play().then(()=>{const O=performance.now()-w;console.log(`[HLS] Autoplay succeeded in ${O.toFixed(2)}ms after canplay event`)}).catch(O=>{const te=performance.now()-w;O.name!=="AbortError"&&O.name!=="NotAllowedError"&&console.warn(`[HLS] Autoplay prevented after ${te.toFixed(2)}ms:`,O)})}};l.addEventListener("canplay",ne,{once:!0})}})()}),n.on(ve.Events.ERROR,(X,ie)=>{if(!W&&ie.fatal)switch(ie.type){case ve.ErrorTypes.NETWORK_ERROR:if(!W&&n)try{n.startLoad()}catch{}break;case ve.ErrorTypes.MEDIA_ERROR:if(!W&&n)try{n.recoverMediaError()}catch{}break;default:n&&(n.destroy(),n=null);break}})}else W||console.warn("HLS.js not supported, falling back to native HLS"),l.src=C,l.loop=m,B=()=>{W||console.warn("Native HLS playback failed")},l.addEventListener("error",B),a&&!W&&l.play().catch(I=>{I.name!=="AbortError"&&I.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",I)})};let D=0;const S=10,q=()=>{if(W)return;if(D++,D>S){console.error("[HLS] Failed to setup HLS after max attempts - video element may not be ready");return}const l=b.current;if(!l){requestAnimationFrame(q);return}if(!l.isConnected){requestAnimationFrame(q);return}E()},V=requestAnimationFrame(()=>{requestAnimationFrame(q)});return()=>{cancelAnimationFrame(V),W=!0,document.removeEventListener("visibilitychange",F),window.removeEventListener("beforeunload",P);const l=b.current;if(l&&L&&(l.removeEventListener("ended",L),L=null),n){try{n.stopLoad(),n.off(ve.Events.MANIFEST_PARSED),n.off(ve.Events.ERROR),n.off(ve.Events.MEDIA_ATTACHED),n.off(ve.Events.MEDIA_DETACHED),n.off(ve.Events.MANIFEST_LOADED),n.off(ve.Events.MEDIA_ATTACHING),n.off(ve.Events.MEDIA_DETACHING),n.off(ve.Events.DESTROYING),n.destroy()}catch{try{n&&n.detachMedia()}catch{}}n=null,y.current=null,K.current=null}if(l){B&&(l.removeEventListener("error",B),B=null);try{l.pause()}catch{}}}},[C,a]),r.useEffect(()=>(i&&b.current&&i(b.current),()=>{i&&i(null)}),[i,u,C]);const A=h||!f?{width:"auto",maxWidth:"100%",height:"100%",maxHeight:"100%",aspectRatio:x,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box",minWidth:0,minHeight:0,flexShrink:1,alignSelf:"center"}:{width:"100%",maxWidth:"100%",maxHeight:"calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 160px)",aspectRatio:x,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box",minWidth:0,minHeight:0,flexShrink:1,alignSelf:"center"};return C?e.jsx("div",{style:A,children:e.jsx("video",{ref:b,autoPlay:a,loop:!1,muted:c,controls:j,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:g?"pointer":"default"},children:"Your browser does not support the video tag."})}):e.jsx("div",{style:A,children:"No video available"})};function Os({beatmapMeta:t,beatmapVersion:o}){const s=r.useRef(null),u=r.useRef(null),[a,m]=r.useState(!1),[c,j]=r.useState(!1),[i,g]=r.useState(0);r.useEffect(()=>{if(s.current&&u.current){const b=s.current.offsetWidth,_=u.current.scrollWidth;g(_),j(_>b)}},[t,o]);const f=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",o?` [${o}]`:""]}):o?`[${o}]`:"Beatmap",h=i>0?Math.max(3,i/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:s,className:"muted one-line",style:{fontSize:12,color:"var(--muted)",flex:"0 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&m(!0),onMouseLeave:()=>m(!1),children:[e.jsx("span",{ref:u,style:{display:"inline-block",animation:a&&c?`beatmap-marquee ${h}s linear infinite`:"none"},children:f}),a&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:f})]})]})}function Qs(t){return"post_type"in t?t.post_type==="mappi":!!t.stream_uid}function Lt({post:t,section:o,onUpdate:s,onDelete:u,me:a}){const m=Fe(),j=Pe().pathname.startsWith("/feed/"),i=Qs(t);t.id;const g=i?t.stream_uid||String(t.id||""):t.uid||String(t.id||""),f=g&&g!=="null"&&g!=="undefined"?`/feed/${g}`:`/feed/${t.id}`,[h,b]=r.useState(!1),[_,k]=r.useState(!1),[v,N]=r.useState(!1),[x,C]=r.useState(!1),[Q,y]=r.useState(!1),K=r.useRef(null),A=r.useRef(null),n=r.useRef(null),[B,W]=r.useState(null),[L,F]=r.useState(null),{notify:P}=Ne(),[E,D]=r.useState(i?t.liked_by_me:void 0),[S,q]=r.useState(i?t.likes_count:0),[V,l]=r.useState(i?void 0:t.reacted_by_me),[M,I]=r.useState(i?0:t.reactions_count);r.useEffect(()=>{if(i){const p=t;D(p.liked_by_me),q(p.likes_count)}else{const p=t;l(!!p.reacted_by_me),I(p.reactions_count)}},[t,i]);const[X,ie]=r.useState(!1),[ne,w]=r.useState(i?"":t.text??""),[O,te]=r.useState(t.beatmap_url||""),[se,pe]=r.useState(null),[d,H]=r.useState(null),[he,ae]=r.useState(""),xe=r.useRef(0),ye=a&&((i?t.uploader&&a.id===t.uploader.id:a.id===t.user_id)||a.is_admin||a.is_mod),We=(()=>{const p=t.created_at;if(!p)return"";const G=Math.floor(Date.now()/1e3)-p;return G<60?"just now":G<3600?`${Math.floor(G/60)}m`:G<86400?`${Math.floor(G/3600)}h`:G<604800?`${Math.floor(G/86400)}d`:new Date(p*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})})();r.useEffect(()=>{if(!X&&!i){const p=t;w(p.text??""),te(p.beatmap_url||""),pe(null),H(null),ae("")}},[t,X,i]),r.useEffect(()=>{if(!X||i)return;xe.current&&window.clearTimeout(xe.current);const p=(O||"").trim();if(!p){ae(""),pe(null),H(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(p)){ae(""),pe(null),H(null);return}return xe.current=window.setTimeout(async()=>{var Y;try{let ue;try{ue=new URL(p)}catch{ae("Invalid URL format");return}const we=ue.hash.match(/#osu\/(\d+)/),Ce=we?we[1]:null;ue.hash="";const Ie={url:ue.toString()};Ce&&(Ie.beatmap_id=Ce);const je=await $(R.osu.resolveBeatmap+Ee(Ie),{requireAuth:!1}),He=Array.isArray(je==null?void 0:je.diffs)?je.diffs:[];if(!He.length&&!je.setId){ae("No difficulties found"),pe(null),H(null);return}if(pe({setId:Number(je.setId)||0,beatmapId:je.beatmapId??null,title:String(je.title||""),artist:String(je.artist||""),mapper:String(je.mapper||""),diffs:He}),He.length>0){const Tt=Number.isFinite(Number(je.beatmapId))?Number(je.beatmapId):Number((Y=He[0])==null?void 0:Y.id),Te=He.find(Mt=>Number(Mt.id)===Tt)||He[0];H({beatmapId:Number(Te==null?void 0:Te.id)||null,version:String((Te==null?void 0:Te.version)||""),mode:String((Te==null?void 0:Te.mode)||"standard")})}else H(null);ae("")}catch(ue){ae(`Failed to resolve: ${(ue==null?void 0:ue.message)||"Unknown error"}`),pe(null),H(null)}},400),()=>{xe.current&&window.clearTimeout(xe.current)}},[O,X,i]),r.useEffect(()=>{if(i||!t.beatmap_url||L)return;const p=t;let G=!1;return(async()=>{try{let Y;try{Y=new URL(p.beatmap_url)}catch{return}const ue=Y.hash.match(/#osu\/(\d+)/),we=ue?ue[1]:null;Y.hash="";const Re={url:Y.toString()};if(we?Re.beatmap_id=we:p.beatmap_id&&(Re.beatmap_id=String(p.beatmap_id)),!G){const Ie=await $(R.osu.resolveBeatmap+Ee(Re),{requireAuth:!1});(Ie.title||Ie.artist)&&F({title:Ie.title||null,artist:Ie.artist||null,mapper:Ie.mapper||null})}}catch{}})(),()=>{G=!0}},[t,i,L]);const Be=async()=>{if(h||!i)return;b(!0);const p=E??!1,G=S,Y=!p,ue=Y?S+1:Math.max(0,S-1);D(Y),q(ue);try{const we=p?"DELETE":"POST",Ce=await $(R.videos.like(t.id),{method:we}),Re={...t,liked_by_me:Y,likes_count:Ce.likes_count||ue};D(Y),q(Ce.likes_count??ue),s&&s(Re)}catch{D(p),q(G),P("Failed to like",{variant:"error"})}finally{b(!1)}},z=async()=>{if(_||i)return;k(!0);const p=V??!1,G=M,Y=!p,ue=Y?M+1:Math.max(0,M-1);l(Y),I(ue);try{const we=p?"DELETE":"POST",Ce=await $(R.moddi.postReact(t.id),{method:we}),Re={...t,reacted_by_me:Y,reactions_count:Ce.reactions_count||ue};l(Y),I(Ce.reactions_count??ue),s&&s(Re)}catch{l(p),I(G),P("Failed to react",{variant:"error"})}finally{k(!1)}},oe=async()=>{if(confirm(i?"Permanently delete this video?":"Permanently delete this post?")){try{const p=i?R.videos.delete(t.id):R.moddi.post(String(t.id));await $(p,{method:"DELETE"}),P(i?"Video deleted":"Post deleted",{variant:"warn"}),u&&u(t.id)}catch(p){P((p==null?void 0:p.message)||(i?"Failed to delete video":"Failed to delete post"),{variant:"error"})}C(!1)}},re=async()=>{if(i){try{const p=!t.is_starred,G=p?"star":"unstar";await $(R.admin.videosAction(t.id,G),{method:"POST"});const Y={...t,is_starred:p};s&&s(Y),P(p?"Post starred":"Star removed",{variant:"success"})}catch{P("Action failed",{variant:"error"})}C(!1)}},Z=()=>{i||(ie(!0),w(t.text??""),te(t.beatmap_url||""),pe(null),H(null),ae(""),C(!1))},U=async()=>{if(!i)try{await $(R.moddi.post(String(t.id)),{method:"PATCH",body:JSON.stringify({text:ne.trim(),beatmap_url:O.trim()||null,beatmapset_id:(se==null?void 0:se.setId)??void 0,beatmap_id:(d==null?void 0:d.beatmapId)??(se==null?void 0:se.beatmapId)??void 0,beatmap_version:(d==null?void 0:d.version)??void 0})});const p=await $(R.moddi.post(String(t.id)),{method:"GET",requireAuth:!1});s&&p.post&&s({...t,...p.post}),P("Post updated",{variant:"success"}),ie(!1)}catch(p){P((p==null?void 0:p.message)||"Failed to update post",{variant:"error"})}},J=()=>{ie(!1);const p=t;w(p.text??""),te(p.beatmap_url||""),pe(null),H(null),ae("")};r.useEffect(()=>{if(!v||!A.current){W(null);return}const p=()=>{if(A.current){const G=A.current.getBoundingClientRect();W({top:G.bottom+8,right:window.innerWidth-G.right})}};return p(),window.addEventListener("resize",p),window.addEventListener("scroll",p,!0),()=>{window.removeEventListener("resize",p),window.removeEventListener("scroll",p,!0)}},[v]),r.useEffect(()=>{if(!v)return;const p=G=>{K.current&&!K.current.contains(G.target)&&A.current&&!A.current.contains(G.target)&&N(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[v]);const le=p=>{const G=p.target;if(G.closest("button")||G.closest(".menu-panel")||G.closest("input")||G.closest("textarea")||G.closest("select"))return;const Y=G.closest("a");Y&&Y.getAttribute("href")!==`#${f}`||m(f)},ee=i?t.uploader||{id:0,username:"Unknown",avatar_url:null}:{id:t.user_id||0,username:t.username||"Unknown",avatar_url:t.avatar_url||null},fe=!i&&(V??(t.reacted_by_me===!0||t.reacted_by_me===1)),ce=!i&&t.tags&&(typeof t.tags=="string"?t.tags.split(",").map(p=>p.trim()):[]).includes("help"),ge=t.beatmapset_id,Ue=t.beatmap_id,be=t.beatmap_version;return e.jsxs("article",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",position:"relative",cursor:"pointer"},onMouseEnter:p=>p.currentTarget.style.backgroundColor="rgba(255,255,255,0.04)",onMouseLeave:p=>p.currentTarget.style.backgroundColor="var(--panel)",onClick:le,children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[ee.avatar_url?e.jsx(de,{to:`/profile/${ee.id}`,onClick:p=>p.stopPropagation(),style:{flexShrink:0},children:e.jsx("img",{src:ee.avatar_url,width:40,height:40,style:{borderRadius:"50%",border:"1px solid rgba(255,255,255,0.08)",display:"block"},alt:ee.username})}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.08)",flexShrink:0}}),e.jsx(de,{to:f,style:{flex:1,minWidth:0,textDecoration:"none",color:"inherit",display:"block"},onClick:p=>{const G=p.target,Y=G.closest("a");if(Y&&Y!==p.currentTarget){p.preventDefault(),p.stopPropagation();return}if(G.closest("button")||G.closest(".menu-panel")||G.closest("input")||G.closest("textarea")||G.closest("select")){p.preventDefault(),p.stopPropagation();return}p.stopPropagation()},children:e.jsxs("div",{style:{flex:1,minWidth:0,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6,marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(de,{to:`/profile/${ee.id}`,style:{textDecoration:"none",color:"inherit",fontWeight:600,fontSize:14},onClick:p=>p.stopPropagation(),onMouseEnter:p=>p.currentTarget.style.color="#7dd3fc",onMouseLeave:p=>p.currentTarget.style.color="inherit",children:ee.username}),i&&t.is_starred&&e.jsx(et,{size:14,color:"#f59e0b",title:"Starred"}),i&&t.mode&&e.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:"rgba(125, 211, 252, 0.2)",border:"1px solid rgba(125, 211, 252, 0.4)",color:"#7dd3fc",fontWeight:500,lineHeight:1.2,textTransform:"capitalize"},children:t.mode}),!i&&ce&&e.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:"rgba(234, 179, 8, 0.2)",border:"1px solid rgba(234, 179, 8, 0.4)",color:"#fbbf24",fontWeight:500,lineHeight:1.2},children:"Help"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[We&&e.jsx("span",{className:"muted",style:{fontSize:13},children:We}),ye&&e.jsx("button",{ref:n,onClick:p=>{p.preventDefault(),p.stopPropagation(),C(G=>!G)},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:4,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4},onMouseEnter:p=>p.currentTarget.style.backgroundColor="var(--hover-overlay)",onMouseLeave:p=>p.currentTarget.style.backgroundColor="transparent","aria-label":"Post options",children:e.jsx(pt,{size:16})})]})]}),i&&j&&t.playback_url&&e.jsx("div",{style:{marginBottom:10,borderRadius:8,overflow:"hidden",background:"var(--panel-dark)"},children:e.jsx(Et,{playbackUrl:t.playback_url,streamUID:t.stream_uid,aspectRatio:t.width&&t.height?t.width/t.height:null})}),i&&!j&&t.poster_url&&e.jsxs("div",{style:{marginBottom:10,borderRadius:8,overflow:"hidden",background:"var(--panel-dark)",aspectRatio:t.width&&t.height?`${t.width} / ${t.height}`:"16 / 9",position:"relative"},children:[e.jsx("img",{src:t.poster_url,alt:"Video thumbnail",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}),t.duration_sec&&e.jsxs("div",{style:{position:"absolute",bottom:8,right:8,background:"rgba(0,0,0,0.7)",color:"#fff",padding:"2px 6px",borderRadius:4,fontSize:11,fontWeight:500},children:[Math.floor(t.duration_sec/60),":",(t.duration_sec%60).toFixed(0).padStart(2,"0")]})]}),!i&&X?e.jsx("div",{style:{marginBottom:12},children:e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("textarea",{value:ne,onChange:p=>w(p.target.value),maxLength:200,rows:2,style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:8,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",width:"100%"}}),se?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[se.artist," – ",se.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",se.mapper]})]}),se.diffs.length>0&&e.jsx("select",{value:(d==null?void 0:d.beatmapId)??(se==null?void 0:se.beatmapId)??void 0,onChange:p=>{const G=Number(p.target.value),Y=(se==null?void 0:se.diffs.find(ue=>Number(ue.id)===G))||null;Y&&H({beatmapId:G,version:Y.version,mode:String(Y.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"4px 8px",fontSize:12},children:se.diffs.map(p=>e.jsxs("option",{value:p.id,children:[p.version," (",p.mode,")"]},p.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{pe(null),H(null),te("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:O,onChange:p=>te(p.target.value),style:{fontSize:13,padding:"6px 8px",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6}}),he&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:he}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn secondary",onClick:J,style:{padding:"6px 12px",fontSize:13},children:"Cancel"}),e.jsx("button",{className:"btn",onClick:U,style:{padding:"6px 12px",fontSize:13},children:"Save"})]})]})}):e.jsxs(e.Fragment,{children:[(()=>{if(i){const p=t.description??"";return p.trim()?e.jsx("div",{style:{marginBottom:t.beatmap_url?12:10,wordBreak:"break-word",fontSize:14,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Ae,{text:p})}):null}else{const p=t.text??"";return p.trim()?e.jsx("div",{style:{marginBottom:t.beatmap_url?12:10,wordBreak:"break-word",fontSize:14,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Ae,{text:p})}):null}})(),i&&t.beatmap_title&&e.jsxs("div",{style:{marginBottom:10,fontSize:12,color:"var(--muted)",lineHeight:1.4},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]}),!X&&e.jsxs("div",{className:"row post-actions",style:{alignItems:"center",gap:8,marginTop:8,position:"relative",justifyContent:"flex-start",flexWrap:"nowrap"},children:[i&&t.beatmap_url&&!t.beatmap_title&&e.jsx("div",{className:"muted one-line",style:{fontSize:12,color:"#7b8491",flex:"0 1 auto",minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"Beatmap"}),!i&&t.beatmap_url&&(L||t.beatmapset_id||t.beatmap_id)&&e.jsx(Os,{beatmapMeta:L,beatmapVersion:t.beatmap_version}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexShrink:0,marginLeft:"auto"},children:[i&&e.jsxs("span",{className:"views-badge","aria-label":"Views",title:"Views",onClick:p=>{p.preventDefault(),p.stopPropagation()},children:[e.jsx(Kt,{size:12}),e.jsx("span",{children:t.views_count??0})]}),e.jsxs("span",{className:"views-badge","aria-label":"Comments",title:"Comments",onClick:p=>{p.preventDefault(),p.stopPropagation()},children:[e.jsx(ht,{size:12}),e.jsx("span",{children:t.comments_count??0})]}),i?e.jsxs("button",{className:`chip-btn like ${E?"liked":""}`,onClick:p=>{p.preventDefault(),p.stopPropagation(),Be()},disabled:h,"aria-label":E?"Unlike":"Like",title:E?"Unlike":"Like",children:[E?e.jsx(Ve,{size:16}):e.jsx(Ye,{size:16}),e.jsx("span",{children:S})]}):e.jsxs("button",{className:`chip-btn like ${fe?"liked":""}`,onClick:p=>{p.preventDefault(),p.stopPropagation(),z()},disabled:_,"aria-label":fe?"Remove reaction":"React",title:fe?"Remove reaction":"React",children:[ce?e.jsx("span",{style:{fontSize:16,lineHeight:1},children:"✋"}):fe?e.jsx(Ve,{size:16}):e.jsx(Ye,{size:16}),e.jsx("span",{children:M})]}),t.beatmap_url&&e.jsxs("button",{ref:A,className:"chip-btn link",onClick:p=>{p.preventDefault(),p.stopPropagation(),N(G=>!G)},title:"Beatmap options","aria-label":"Beatmap options",children:[e.jsx(Xe,{size:16}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(Ge,{size:14,style:{marginLeft:4,opacity:.7}})]})]})]})]})]})})]}),v&&B&&t.beatmap_url&&e.jsxs("div",{ref:K,style:{position:"fixed",top:B.top,right:B.right,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,padding:6,zIndex:1e3,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>N(!1),children:[e.jsx(Xe,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ge&&e.jsx("button",{className:"menu-item",onClick:()=>{y(!0),N(!1)},children:"Preview"})]}),Q&&ge&&e.jsx(St,{open:Q,onClose:()=>y(!1),downloadUrl:`${$e}${R.osu.downloadBeatmapset(ge)}`,beatmapId:Ue??void 0,beatmapVersion:be??void 0}),ye&&e.jsx(_t,{open:x,onClose:()=>C(!1),buttonRef:n,minWidth:160,children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"menu-item",onClick:p=>{p.preventDefault(),p.stopPropagation(),re()},children:t.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:p=>{p.preventDefault(),p.stopPropagation(),oe()},children:"Delete video"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"menu-item",onClick:Z,children:"Edit post"}),e.jsx("button",{className:"menu-item",onClick:oe,children:"Delete post"})]})})]})}function Ct({comment:t,replies:o,me:s,onReply:u,onDelete:a,replyingTo:m,replyText:c,onReplyTextChange:j,onReplySubmit:i,posting:g,onCancelReply:f,section:h,repliesMap:b}){const[_,k]=r.useState(!1),v=r.useRef(null),{notify:N}=Ne(),[x,C]=r.useState(!1),Q=t.parent_id!==null,y=s&&(s.id===t.user_id||s.is_admin||s.is_mod),K=async()=>{if(confirm("Delete this comment?"))try{const A=h==="mappi"?R.videos.comments(t.post_id)+`/${t.id}`:R.moddi.postComments(t.post_id)+`/${t.id}`;await $(A,{method:"DELETE"}),a(t.id),N("Comment deleted",{variant:"success"})}catch{N("Failed to delete comment",{variant:"error"})}finally{k(!1)}};return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-subtle)",background:"var(--hover-overlay)",transition:"background-color 0.15s ease"},onMouseEnter:A=>A.currentTarget.style.backgroundColor="var(--hover-overlay-strong)",onMouseLeave:A=>A.currentTarget.style.backgroundColor="var(--hover-overlay)",children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:13,fontWeight:500},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(t.created_at*1e3).toLocaleDateString()})]}),e.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:e.jsx(Ae,{text:t.text})}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:e.jsxs("button",{onClick:()=>u(t.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[e.jsx(Gt,{size:14}),"Reply"]})}),m===t.id&&s&&e.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("form",{onSubmit:i,style:{display:"flex",alignItems:"flex-end",gap:6},children:[e.jsx("textarea",{placeholder:`Reply to ${t.username}...`,value:c||"",onChange:A=>j==null?void 0:j(A.target.value),rows:1,style:{flex:1,background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:A=>{const n=A.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,100)}px`},autoFocus:!0}),e.jsx("button",{type:"submit",className:"btn compact",disabled:g||!(c!=null&&c.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:g?"...":"Reply"}),f&&e.jsx("button",{type:"button",onClick:f,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid var(--border)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),y&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:v,className:"icon-link",onClick:()=>k(!_),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:e.jsx(pt,{size:16})}),e.jsx(_t,{open:_,onClose:()=>k(!1),buttonRef:v,children:e.jsx("button",{className:"menu-item",onClick:K,style:{color:"var(--danger)"},children:"Delete"})})]})]}),o.length>0&&e.jsxs("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid var(--border-subtle)"},children:[Q&&e.jsxs("button",{onClick:()=>C(!x),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:11,padding:"4px 0",marginBottom:4},children:[x?e.jsx(Ge,{size:12}):e.jsx(Jt,{size:12}),x?"Hide":"Show"," ",o.length," ",o.length===1?"reply":"replies"]}),(!Q||x)&&e.jsx(e.Fragment,{children:o.map(A=>e.jsx(Ct,{comment:A,replies:(b==null?void 0:b.get(A.id))||[],me:s,onReply:u,onDelete:a,replyingTo:m,replyText:c,onReplyTextChange:j,onReplySubmit:i,posting:g,onCancelReply:f,section:h,repliesMap:b},A.id))})]})]})}const Ks=({streamUID:t,playbackUrl:o,aspectRatio:s,onClose:u,headerLeft:a,headerRight:m,children:c,beatmapDownloadUrl:j,beatmapVersion:i,beatmapId:g,onOpenInEditor:f})=>{const h=typeof s=="number"&&isFinite(s)&&s>0?s:1.7777777777777777,b=!!j;return T.useEffect(()=>(document.body.classList.add("overlay-open"),()=>{document.body.classList.remove("overlay-open")}),[]),e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:_=>_.stopPropagation(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:u}),e.jsxs("div",{className:"overlay-card",onClick:_=>_.stopPropagation(),children:[e.jsx("button",{className:"overlay-close",onClick:u,"aria-label":"Close",children:e.jsx(De,{size:18})}),e.jsx("div",{className:"section-panel",style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:b?0:"auto",maxHeight:b?"80vh":"calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 160px)",width:"100%",maxWidth:"100%",overflow:"hidden",boxSizing:"border-box",flexShrink:1,minWidth:0},onClick:_=>_.stopPropagation(),children:b?e.jsx("div",{style:{width:"100%",maxWidth:"100%",height:"auto",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box",minHeight:0},children:e.jsx(js,{downloadUrl:j,beatmapVersion:i,beatmapId:g,onOpenInEditor:f})}):e.jsx(Et,{streamUID:t||void 0,playbackUrl:o||void 0,aspectRatio:h,inOverlay:!0})}),(a||m||c)&&e.jsxs("div",{className:"section-panel",children:[(a||m)&&e.jsxs("div",{className:"row-between",children:[e.jsx("div",{className:"row",style:{alignItems:"center"},children:a}),m?e.jsx("div",{className:"row post-actions",style:{gap:8,position:"relative"},children:m}):e.jsx("div",{})]}),c]})]})]})};function Gs(){var I,X,ie,ne;const{uid:t}=ft(),[o,s]=Vt(),u=Fe(),m=((I=Pe().state)==null?void 0:I.returnTo)||"/feed",[c,j]=r.useState(null),[i,g]=r.useState(null),[f,h]=r.useState([]),[b,_]=r.useState(!0),[k,v]=r.useState(null),[N,x]=r.useState(""),[C,Q]=r.useState(null),[y,K]=r.useState(!1),[A,n]=r.useState(!1),{notify:B}=Ne(),W=r.useRef(new Set);r.useEffect(()=>{$(R.auth.me,{requireAuth:!1}).then(w=>v(w)).catch(()=>{})},[]),r.useEffect(()=>{o.get("preview")==="true"&&n(!0)},[o]);const L=async()=>{if(!t||t==="null"||t==="undefined"){B("Invalid post identifier",{variant:"error"}),u("/feed");return}_(!0);try{const w=await $(R.videos.get(t),{requireAuth:!1});if(w&&w.id){j(w),g("mappi"),_(!1);return}}catch{}try{const w=await $(R.moddi.post(t),{requireAuth:!1});if(w&&w.id){const O={...w,user_id:w.user_id??0,username:w.username||"Unknown",avatar_url:w.avatar_url||null,uid:w.uid||String(w.id)||t,text:w.text??null,beatmap_url:w.beatmap_url??null,beatmapset_id:w.beatmapset_id??null,beatmap_id:w.beatmap_id??null,beatmap_version:w.beatmap_version??null,tags:w.tags??null,reactions_count:Number(w.reactions_count??0),reacted_by_me:w.reacted_by_me??!1,comments_count:Number(w.comments_count??0)};j(O),g("moddi"),_(!1);return}}catch{}B("Failed to load post",{variant:"error"}),u(m),_(!1)},F=async()=>{if(!(!(c!=null&&c.id)||!i))try{const w=i==="mappi"?R.videos.comments(c.id):R.moddi.postComments(c.id),O=await $(w,{requireAuth:!1});h(O.items||[])}catch{}};r.useEffect(()=>{L()},[t]),r.useEffect(()=>{c!=null&&c.id&&i&&F()},[c==null?void 0:c.id,i]),r.useEffect(()=>{!(c!=null&&c.id)||i!=="mappi"||W.current.has(c.id)||(W.current.add(c.id),$(R.videos.view(c.id),{method:"POST"}).then(w=>{if(!w)return;const O=Number(w.views_count??0);j(te=>te?{...te,views_count:O,viewed_by_me:!0}:null)}).catch(()=>{}))},[c==null?void 0:c.id,i]);const P=w=>{j(w)},E=()=>{u(m)},D=async w=>{if(w.preventDefault(),!(!N.trim()||!(c!=null&&c.id)||!i)){K(!0);try{const O=i==="mappi"?R.videos.comments(c.id):R.moddi.postComments(c.id);await $(O,{method:"POST",body:JSON.stringify({text:N.trim(),parent_id:C||void 0})}),x(""),Q(null),F(),L(),B("Comment posted!",{variant:"success"})}catch(O){B((O==null?void 0:O.message)||"Failed to post comment",{variant:"error"})}finally{K(!1)}}},S=w=>{h(O=>O.filter(te=>te.id!==w))};if(b)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!c||!i)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const q=f.filter(w=>!w.parent_id),V=new Map;f.filter(w=>w.parent_id).forEach(w=>{const O=w.parent_id;V.has(O)||V.set(O,[]),V.get(O).push(w)});const l=i==="mappi",M=l?c:null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"post-detail-header",style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>u(m),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(Ke,{size:20})}),e.jsx("span",{className:"hide-on-mobile",style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx(Lt,{post:c,section:i,onUpdate:P,onDelete:E,me:k})}),k&&!C&&e.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:6},children:e.jsxs("form",{onSubmit:D,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:N,onChange:w=>x(w.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:w=>{const O=w.target;O.style.height="auto",O.style.height=`${Math.min(O.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:y||!N.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:y?"...":"Post"})]})}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:q.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:q.map(w=>e.jsx(Ct,{comment:w,replies:V.get(w.id)||[],me:k,section:i,onReply:O=>Q(O),onDelete:S,replyingTo:C,replyText:N,onReplyTextChange:x,onReplySubmit:D,posting:y,onCancelReply:()=>{Q(null),x("")},repliesMap:V},w.id))})})]}),l&&M&&A&&M.beatmapset_id&&e.jsx(Ks,{streamUID:null,playbackUrl:null,aspectRatio:16/9,onClose:()=>{n(!1),s({})},beatmapDownloadUrl:`${$e}${R.osu.downloadBeatmapset(M.beatmapset_id)}`,beatmapId:M.beatmap_id??void 0,beatmapVersion:M.beatmap_version??void 0,onOpenInEditor:()=>{n(!1),s({}),window.location.hash="/editor"},headerLeft:e.jsxs(e.Fragment,{children:[((X=M.uploader)==null?void 0:X.avatar_url)&&e.jsx("img",{src:M.uploader.avatar_url,width:28,height:28,style:{borderRadius:"50%"}}),e.jsxs(de,{to:`/profile/${(ie=M.uploader)==null?void 0:ie.id}`,style:{marginLeft:6,display:"inline-flex",alignItems:"center",gap:6,textDecoration:"none",color:"inherit",fontWeight:700},children:[e.jsx("span",{children:(ne=M.uploader)==null?void 0:ne.username}),M.is_starred?e.jsx(et,{size:14,color:"#f59e0b",title:"Starred"}):null]})]})})]})}function ot(t){if(!t)return"standard";const o=String(t).toLowerCase().trim();return o==="osu"||o==="0"||o==="standard"?"standard":o==="taiko"||o==="1"?"taiko":o==="catch"||o==="fruits"||o==="2"?"catch":o==="mania"||o==="3"?"mania":"standard"}const Js=({open:t,onClose:o,videoId:s,initialDescription:u,initialBeatmapUrl:a,onSave:m})=>{const[c,j]=r.useState(u||""),[i,g]=r.useState(a||""),[f,h]=r.useState(null),[b,_]=r.useState(null),[k,v]=r.useState(""),[N,x]=r.useState(!1),C=r.useRef(0);r.useEffect(()=>{t&&(j(u||""),g(a||""),h(null),_(null),v(""))},[t,u,a]),r.useEffect(()=>{if(!t)return;C.current&&window.clearTimeout(C.current);const y=(i||"").trim();if(!y){v(""),h(null),_(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(y)){v(""),h(null),_(null);return}return C.current=window.setTimeout(async()=>{var A;try{let n;try{n=new URL(y)}catch{v("Invalid URL format");return}const B=n.hash.match(/#osu\/(\d+)/),W=B?B[1]:null;n.hash="";const F={url:n.toString()};W&&(F.beatmap_id=W);const P=await $(R.osu.resolveBeatmap+Ee(F),{requireAuth:!1}),E=Array.isArray(P==null?void 0:P.diffs)?P.diffs:[];if(!E.length&&!P.setId){v("No difficulties found"),h(null),_(null);return}if(h({setId:Number(P.setId)||0,beatmapId:P.beatmapId??null,title:String(P.title||""),artist:String(P.artist||""),mapper:String(P.mapper||""),diffs:E}),E.length>0){const D=Number.isFinite(Number(P.beatmapId))?Number(P.beatmapId):Number((A=E[0])==null?void 0:A.id),S=E.find(V=>Number(V.id)===D)||E[0],q=ot(S==null?void 0:S.mode);_({beatmapId:Number(S==null?void 0:S.id)||null,version:String((S==null?void 0:S.version)||""),mode:q})}v("")}catch(n){v(`Failed to resolve: ${(n==null?void 0:n.message)||"Unknown error"}`),h(null),_(null)}},400),()=>{C.current&&window.clearTimeout(C.current)}},[i,t]);const Q=async()=>{if(!N){x(!0);try{await $(R.videos.update(s),{method:"PATCH",body:JSON.stringify({description:c.slice(0,100),beatmap_url:i.trim()||void 0})});const y=!!i.trim();if(f||!y)try{await $(R.videos.update(s)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:y&&f&&f.setId>0?f.setId:null,beatmap_id:y&&(b!=null&&b.beatmapId)?b.beatmapId:null,beatmap_version:y&&(b!=null&&b.version)?b.version:null,beatmap_title:y&&(f!=null&&f.title)?f.title:null,beatmap_artist:y&&(f!=null&&f.artist)?f.artist:null,beatmap_mapper:y&&(f!=null&&f.mapper)?f.mapper:null,beatmap_url:y?i.trim():null})})}catch(A){console.warn("Failed to update beatmap metadata:",A)}m(c,i.trim()||null),o()}catch(y){alert((y==null?void 0:y.message)||"Failed to update post")}finally{x(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:y=>y.target===y.currentTarget&&o(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:o}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:o,"aria-label":"Close",children:e.jsx(De,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:c,onChange:y=>j(y.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),f?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[f.artist," – ",f.title]}),e.jsxs("span",{className:"muted",children:["by ",f.mapper]})]}),e.jsx("select",{value:(b==null?void 0:b.beatmapId)??f.beatmapId??void 0,onChange:y=>{const K=Number(y.target.value),A=(f==null?void 0:f.diffs.find(n=>Number(n.id)===K))||null;if(A){const n=ot(A.mode);_({beatmapId:K,version:A.version,mode:n})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"},children:f.diffs.map(y=>e.jsxs("option",{value:y.id,children:[y.version," (",y.mode,")"]},y.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{h(null),_(null),g("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:i,onChange:y=>g(y.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}}),k&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:k})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:o,disabled:N,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:Q,disabled:N,children:N?"Saving...":"Save"})]})]})]})]}):null};function lt(){const t=ft(),o=Fe(),{notify:s}=Ne(),[u,a]=r.useState(null),[m,c]=r.useState(null),[j,i]=r.useState(""),[g,f]=r.useState([]),[h,b]=r.useState([]),[_,k]=r.useState([]),[v,N]=r.useState(""),[x,C]=r.useState(null),[Q,y]=r.useState([]),[K,A]=r.useState(null),[n,B]=r.useState(""),[W,L]=r.useState([]),[F,P]=r.useState(null),[E,D]=r.useState(!1),S=r.useMemo(()=>{const l=t.id?Number(t.id):null;return l?u?u.id===l:!1:!0},[t.id,u]);function q(l){const M=l.stream_uid||String(l.id),I=t.id?`/profile/${t.id}`:"/profile";o(`/feed/${M}`,{state:{returnTo:I}})}r.useEffect(()=>{(async()=>{try{const l=await $(R.auth.me,{requireAuth:!1});a(l),l&&Array.isArray(l.inspirations)&&y(l.inspirations)}catch(l){i((l==null?void 0:l.message)||"Not logged in")}})()},[]),r.useEffect(()=>{(async()=>{try{const l=t.id?Number(t.id):null;if(l){const M=await $(R.users.get(l),{requireAuth:!1});c(M),N(M.about||""),Array.isArray(M.inspirations)&&y(M.inspirations);const I=await $(R.users.videos(l)+Ee({limit:"60"}),{requireAuth:!1});k(I.items||[]);const X=await $(R.users.likes(l)+Ee({limit:"60"}),{requireAuth:!1});b(X.items||[])}else{if(!u)return;c(u),N(u.about||""),Array.isArray(u.inspirations)&&y(u.inspirations);const M=await $(R.users.myVideos+Ee({limit:"50"}),{requireAuth:!1});f(M.items||[]);const I=await $(R.users.likes(u.id)+Ee({limit:"60"}),{requireAuth:!1});b(I.items||[])}}catch{}})()},[t.id,u]),r.useEffect(()=>{D(!1)},[m==null?void 0:m.id]);async function V(l){try{const I=(await $(R.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:l})})).user||m;c(I),Array.isArray(I==null?void 0:I.inspirations)&&y(I.inspirations),t.id||a(I)}catch{}}return r.useEffect(()=>{let l;return K!==null&&n.trim().length>=2?l=setTimeout(async()=>{try{const M=await $(R.osu.usersSearch(n),{requireAuth:!1});L(Array.isArray(M.items)?M.items:[])}catch{}},250):L([]),()=>{l&&clearTimeout(l)}},[n,K]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:m?e.jsxs(e.Fragment,{children:[m.avatar_url&&e.jsx("img",{src:m.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[m.username,m.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${m.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:l=>l.currentTarget.style.opacity="1",onMouseLeave:l=>l.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Xe,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",m.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!S&&Q.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),Q.map((l,M)=>S?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>P(l.id),onMouseLeave:()=>P(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const I=Q.filter((X,ie)=>ie!==M);y(I),V(I)},children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),F===l.id&&e.jsxs("div",{className:"insp-tooltip",children:[l.username," — click to remove"]})]},l.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>P(l.id),onMouseLeave:()=>P(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${l.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),F===l.id&&e.jsx("div",{className:"insp-tooltip",children:l.username})]},l.id)),S&&Q.length<3&&new Array(3-Q.length).fill(0).map((l,M)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>P(-M-1),onMouseLeave:()=>P(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{A(M),B(""),L([])},children:"+"}),F===-M-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),K===M&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:n,onChange:I=>B(I.target.value)}),e.jsxs("div",{className:"insp-results",children:[W.length===0&&n.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),W.map(I=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(u&&Number(u.osu_user_id)===Number(I.id)){s("Kinda based, but no.",{variant:"warn"}),A(null);return}if(Q.some(ie=>ie.id===I.id)){A(null);return}const X=[...Q,{id:I.id,username:I.username,avatar_url:I.avatar_url}].slice(0,3);y(X),A(null),V(X)},children:[e.jsx("img",{src:I.avatar_url,alt:"avatar"}),e.jsx("span",{children:I.username})]},I.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>A(null),children:"Close"})]})]},`slot-${M}`))]}),S&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:j||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),S?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:v,onChange:l=>N(l.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const l=await $(R.auth.me,{method:"PATCH",body:JSON.stringify({about:v})});c(l.user||m),a(l.user||u)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(Qe,{size:16})})]})}):(()=>{const l=((m==null?void 0:m.about)||"").trim()||"No bio.",M=l.length>200,I=M&&!E?l.slice(0,200)+"...":l;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:I}),M&&e.jsx("button",{onClick:()=>D(!E),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(Yt,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Ge,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:l=>{const M=l.currentTarget.closest(".profile-tabs-unified");M.querySelectorAll(".profile-tab").forEach(X=>{X.classList.remove("active"),X.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),M.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:l=>{const M=l.currentTarget.closest(".profile-tabs-unified");M.querySelectorAll(".profile-tab").forEach(X=>{X.classList.remove("active"),X.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),M.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(S?g:_).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(S?g:_).map(l=>(S&&m?(m.id,m.username,m.avatar_url,m.is_admin,m.is_mod):l.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>q({...l}),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ye,{size:12}),e.jsx("span",{children:l.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ht,{size:12}),e.jsx("span",{children:l.comments_count??0})]})]})})]},l.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[h.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),h.map(l=>{var M,I;return e.jsxs("button",{className:"recent-cell",onClick:()=>q(l),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((M=l.uploader)==null?void 0:M.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:l.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(I=l.uploader)==null?void 0:I.username})]})]},l.id)})]})})})]})]}),x&&e.jsx(Js,{open:!!x,onClose:()=>C(null),videoId:x.id,initialDescription:x.description,initialBeatmapUrl:x.beatmap_url,onSave:(l,M)=>{f(g.map(I=>I.id===x.id?{...I,description:l||null,beatmap_url:M}:I)),C(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: var(--hover-overlay); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid var(--divider); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed var(--divider); background: transparent; color: var(--text); font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: var(--border-strong); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid var(--divider);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid var(--divider); border-radius: 10px; padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel-dark); color: var(--text); outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: var(--text); cursor: pointer; text-align: left; }
        .insp-result:hover { background: var(--hover-overlay); border-color: var(--divider); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--divider); background: var(--hover-overlay); color: var(--text); cursor: pointer; }
      `})]})}function Vs(){var M,I,X,ie,ne,w,O,te,se,pe;const[t,o]=r.useState(null),[s,u]=r.useState([]),[a,m]=r.useState(""),[c,j]=r.useState([]),[i,g]=r.useState(null),[f,h]=r.useState([]),[b,_]=r.useState("all"),[k,v]=r.useState("approvals"),[N,x]=r.useState(null),[C,Q]=r.useState(""),[y,K]=r.useState(!1),{notify:A}=Ne(),[n,B]=r.useState(null),[W,L]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const d=await $(R.auth.me,{requireAuth:!1});if(o(d),d!=null&&d.is_admin)try{const H=await $(R.admin.settingsModeration,{requireAuth:!1});x(!!H.require_approval)}catch{}}catch{}try{const d=await $(R.admin.videosPending+Ee({limit:"50"}),{requireAuth:!1});u(d.items||[])}catch{}})()},[]);async function F(){L(!0);try{const d=await $(R.admin.analytics,{requireAuth:!1});B(d)}finally{L(!1)}}async function P(){try{const d=await $(R.admin.usersSearch(a),{requireAuth:!1});j(d.items||[])}catch{}}async function E(d){g(d),h([]);try{const H=await $(R.admin.userVideos(d.id)+Ee({limit:"50"}),{requireAuth:!1});h(H.items||[])}catch{}}async function D(d,H){try{const he=await $(R.admin.userUpdate(d.id),{method:"PATCH",body:JSON.stringify({is_mod:H})}),ae=(he==null?void 0:he.user)||{...d,is_mod:H};A(H?"Granted moderation":"Revoked moderation",{variant:H?"success":"warn"}),g(ae),j(c.map(xe=>xe.id===d.id?ae:xe))}catch{alert("Failed to update")}}const S=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),q=!!(t!=null&&t.is_admin);if(!S)return e.jsx("div",{className:"muted",style:{padding:20},children:"You do not have access."});const V=s.filter(d=>!d.flagged_only),l=s.filter(d=>!!d.flagged_only);return e.jsxs("div",{className:"moderation-container",children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:_e()?"nowrap":"wrap",gap:_e()?"2px":"4px",overflowX:_e()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":k==="approvals",className:`profile-tab ${k==="approvals"?"active":""}`,"data-tab":"approvals",onClick:d=>{const H=d.currentTarget.closest(".profile-tabs-unified");H.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),d.currentTarget.classList.add("active"),d.currentTarget.setAttribute("aria-selected","true"),H.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),v("approvals")},children:"Approvals"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":k==="manage",className:`profile-tab ${k==="manage"?"active":""}`,"data-tab":"manage",onClick:d=>{const H=d.currentTarget.closest(".profile-tabs-unified");H.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),d.currentTarget.classList.add("active"),d.currentTarget.setAttribute("aria-selected","true"),H.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),v("manage")},children:"Manage"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":k==="analytics",className:`profile-tab ${k==="analytics"?"active":""}`,"data-tab":"analytics",onClick:d=>{const H=d.currentTarget.closest(".profile-tabs-unified");H.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),d.currentTarget.classList.add("active"),d.currentTarget.setAttribute("aria-selected","true"),H.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),v("analytics"),n||F()},children:"Analytics"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":k==="message",className:`profile-tab ${k==="message"?"active":""}`,"data-tab":"message",onClick:d=>{const H=d.currentTarget.closest(".profile-tabs-unified");H.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),d.currentTarget.classList.add("active"),d.currentTarget.setAttribute("aria-selected","true"),H.querySelector(".profile-tabs-content").setAttribute("data-active","message"),v("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":k,children:[e.jsx("div",{className:"panel approvals",hidden:k!=="approvals",children:e.jsxs("div",{className:"moderation-grid",style:{paddingTop:16},children:[e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Pending approvals"}),e.jsx("div",{className:"moderation-column-count",children:V.length})]}),V.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),V.map(d=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[d.poster_url?e.jsx("img",{src:d.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:d.description||"",children:e.jsx(Ae,{text:d.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:d.username}),d.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof d.flags_count=="number"&&d.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",d.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(R.admin.videosReject(d.id),{method:"POST"}),u(s.filter(H=>H.id!==d.id)),A("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await $(R.admin.videosApprove(d.id),{method:"POST"}),u(s.filter(H=>H.id!==d.id)),A("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(R.videos.delete(d.id),{method:"DELETE"}),u(s.filter(H=>H.id!==d.id)),A("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},d.id))]}),e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Flagged (FYI)"}),e.jsx("div",{className:"moderation-column-count",children:l.length})]}),l.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),l.map(d=>e.jsxs("div",{className:"moderation-video-card flagged",children:[e.jsxs("div",{className:"mod-card-content",children:[d.poster_url?e.jsx("img",{src:d.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:d.description||"",children:e.jsx(Ae,{text:d.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:d.username}),e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof d.flags_count=="number"&&d.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",d.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"mod-card-actions",children:e.jsx("button",{className:"btn secondary compact",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(R.videos.delete(d.id),{method:"DELETE"}),u(s.filter(H=>H.id!==d.id)),A("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},d.id)),l.length>0&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:k!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:a,onChange:d=>m(d.target.value),onKeyDown:d=>{d.key==="Enter"&&P()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:P,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:c.map(d=>e.jsxs("button",{className:`moderation-user-result ${(i==null?void 0:i.id)===d.id?"selected":""}`,onClick:()=>E(d),children:[d.avatar_url&&e.jsx("img",{src:d.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:d.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",d.id," • osu ",d.osu_user_id]})]}),d.is_admin?e.jsx("span",{className:"chip info",children:"admin"}):d.is_mod?e.jsx("span",{className:"chip success",children:"mod"}):d.is_blacklisted?e.jsx("span",{className:"chip error",children:"blacklisted"}):null]},d.id))})})]}),i?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:24},children:[e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:64,height:64,style:{borderRadius:"50%",flexShrink:0,border:"2px solid var(--border)"}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"title",style:{fontSize:"24px"},children:i.username}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["id ",i.id," • osu ",i.osu_user_id]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[q&&!i.is_admin&&(i.is_mod?e.jsx("button",{className:"btn secondary compact",onClick:()=>D(i,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary compact",onClick:()=>D(i,!0),children:"Grant moderation"})),!i.is_admin&&(i.is_blacklisted?e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(R.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),g({...i,is_blacklisted:!1}),A("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(R.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),g({...i,is_blacklisted:!0}),A("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]})]})]}),e.jsxs("div",{className:"col",style:{gap:16},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:`btn compact ${b==="all"?"primary":"secondary"}`,onClick:()=>_("all"),children:"All"}),e.jsx("button",{className:`btn compact ${b==="review"?"primary":"secondary"}`,onClick:()=>_("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[f.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),e.jsx("div",{className:"col",style:{gap:12},children:f.filter(d=>{if(b==="all")return!0;const H=(N?!d.approved_at:!1)&&d.status==="ready",he=!!d.needs_review;return H||he}).map(d=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[d.poster_url?e.jsx("img",{src:d.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:d.description||"",children:d.description||"No description."}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:d.status.toUpperCase()}),e.jsxs("span",{className:"muted",children:["• ",new Date(d.created_at*1e3).toLocaleDateString()]}),d.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,N&&!d.approved_at&&d.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]}),e.jsxs("div",{className:"row",style:{gap:4,marginTop:4},children:[e.jsx("span",{style:{color:"var(--accent)",fontSize:14},children:"★"}),e.jsx("span",{className:"muted",style:{fontSize:13},children:d.likes_count??0})]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[(q||(t==null?void 0:t.is_mod))&&(!!d.needs_review||N&&!d.approved_at&&d.status==="ready")&&e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await $(R.admin.videosApprove(d.id),{method:"POST"}),h(f.map(H=>H.id===d.id?{...H,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:H)),A("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(R.videos.delete(d.id),{method:"DELETE"}),h(f.filter(H=>H.id!==d.id)),A("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},d.id))})]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center",border:"1px dashed var(--border)",borderRadius:"12px"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:k!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:a,onChange:d=>m(d.target.value),onKeyDown:d=>{d.key==="Enter"&&P()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:P,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:c.map(d=>e.jsxs("button",{className:`moderation-user-result ${(i==null?void 0:i.id)===d.id?"selected":""}`,onClick:()=>g(d),children:[d.avatar_url&&e.jsx("img",{src:d.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:d.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",d.id," • osu ",d.osu_user_id]})]}),(i==null?void 0:i.id)===d.id&&e.jsx("span",{className:"chip info",children:"selected"})]},d.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:y,onChange:d=>K(d.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",fontFamily:"inherit"},value:C,onChange:d=>Q(d.target.value)}),e.jsx("button",{className:"btn primary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const d=(C||"").trim();if(!d){alert("Enter a message");return}(async()=>{try{const H={text:d,global:y};!y&&(i!=null&&i.id)&&(H.user_id=i.id),await $(R.admin.notificationsSystem,{method:"POST",body:JSON.stringify(H)}),Q(""),A("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:k!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Analytics"}),W&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!W&&!n&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(ke,{label:"Users",value:n.totals.users_total}),e.jsx(ke,{label:"Admins",value:n.totals.users_admin}),e.jsx(ke,{label:"Mods",value:n.totals.users_mod}),e.jsx(ke,{label:"Blacklisted",value:n.totals.users_blacklisted}),e.jsx(ke,{label:"Videos",value:n.totals.videos_total}),e.jsx(ke,{label:"Ready",value:n.totals.videos_ready}),e.jsx(ke,{label:"Pending",value:n.totals.pending_count}),e.jsx(ke,{label:"Purgatory",value:n.totals.purgatory_count}),e.jsx(ke,{label:"Likes",value:n.totals.likes_total}),e.jsx(ke,{label:"Flags",value:n.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Je,{title:"New users (30d)",series:n.series.users,color:"#60a5fa"}),e.jsx(Je,{title:"New videos (30d)",series:n.series.videos,color:"#34d399"}),(I=(M=n.stream)==null?void 0:M.graphql)!=null&&I.minutes_viewed?e.jsx(Je,{title:"Minutes viewed (30d)",series:n.stream.graphql.minutes_viewed,color:"#f59e0b"}):e.jsxs("div",{className:"moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:_e()?13:14},children:"Minutes viewed (30d)"}),e.jsx("div",{className:"muted",style:{fontSize:_e()?11:12},children:"Data unavailable"})]}),e.jsxs("div",{className:"col",style:{padding:"24px",gap:12},children:[e.jsx("div",{className:"muted",style:{textAlign:"center",fontSize:14},children:"Minutes viewed data is not currently available."}),((ie=(X=n.stream)==null?void 0:X.graphql)==null?void 0:ie.errors)&&Array.isArray(n.stream.graphql.errors)&&n.stream.graphql.errors.length>0&&e.jsxs("div",{className:"col",style:{gap:8,padding:"12px",background:"var(--panel-dark)",borderRadius:8,border:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:600,color:"var(--danger)"},children:"Error details:"}),n.stream.graphql.errors.map((d,H)=>e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.5,fontFamily:"monospace"},children:typeof d=="string"?d:(d==null?void 0:d.message)||JSON.stringify(d)},H)),((w=(ne=n.stream)==null?void 0:ne.graphql)==null?void 0:w.raw)&&e.jsxs("div",{className:"col",style:{gap:4,marginTop:8,paddingTop:8,borderTop:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:11,fontWeight:600},children:"Debug info:"}),n.stream.graphql.raw.account_keys&&n.stream.graphql.raw.account_keys.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:10,fontFamily:"monospace"},children:["Available account fields: ",n.stream.graphql.raw.account_keys.join(", ")]}),n.stream.graphql.raw.response_sample&&e.jsxs("details",{style:{fontSize:10},children:[e.jsx("summary",{className:"muted",style:{cursor:"pointer",marginTop:4},children:"Response sample"}),e.jsx("pre",{style:{fontSize:9,overflow:"auto",maxHeight:"200px",marginTop:4,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:4},children:n.stream.graphql.raw.response_sample})]})]})]}),!((O=n.stream)!=null&&O.graphql)&&e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",padding:"8px",background:"var(--panel-dark)",borderRadius:8},children:"GraphQL API not configured. Set CF_GRAPHQL_API_TOKEN secret."})]})]})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",n.feed.count," items in rotation",n.feed.cursor?` • cursor ${n.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",n.stream.approximate.total_duration_sec," • ready videos: ",n.stream.approximate.videos_ready]}),n.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",n.stream.api.ok?"ok":"unavailable",(se=(te=n.stream.api)==null?void 0:te.result_info)!=null&&se.count?` • count ${n.stream.api.result_info.count}`:"",(pe=n.stream.api)!=null&&pe.sample_status?` • sample status ${String(n.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})}function ke({label:t,value:o}){return e.jsxs("div",{className:"moderation-stat-card",children:[e.jsx("div",{className:"mod-stat-label",children:t}),e.jsx("div",{className:"mod-stat-value",children:o})]})}function Je({title:t,series:o,color:s}){const[u,a]=r.useState(()=>_e()),m=T.useRef(null),[c,j]=r.useState(400);r.useEffect(()=>{const L=()=>{if(a(_e()),m.current){const P=m.current.offsetWidth-48;j(Math.max(300,P))}};L();let F=null;return m.current&&typeof ResizeObserver<"u"&&(F=new ResizeObserver(L),F.observe(m.current)),window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L),F&&m.current&&F.unobserve(m.current)}},[]);const i=u?Math.min(400,Math.max(300,window.innerWidth-48)):Math.max(400,Math.min(1e3,c)),g=160,f=8,h=8,b=28,_=u?36:42,k=o.map(L=>L.count),v=Math.max(1,...k),N=r.useMemo(()=>{const L=v,F=Math.pow(10,Math.floor(Math.log10(L))),P=L/F;return(P<=1?1:P<=2?2:P<=5?5:10)*F},[v]),x=i-_-h,C=g-f-b,Q=r.useMemo(()=>o.map((L,F)=>{const P=_+F/Math.max(1,o.length-1)*x,E=f+(1-L.count/(N||1))*C;return[P,E]}),[o,N,x,C]),y=r.useMemo(()=>Q.map((L,F)=>F===0?`M ${L[0]} ${L[1]}`:`L ${L[0]} ${L[1]}`).join(" "),[Q]),K=[0,.25,.5,.75,1],A=r.useMemo(()=>{if(o.length===0)return[];const L=[0,.25,.5,.75,1].map(F=>Math.min(o.length-1,Math.round(F*(o.length-1))));return Array.from(new Set(L))},[o]),n=L=>{if(!L||L.length<10)return L||"";const F=L.slice(5,7).replace(/^0/,""),P=L.slice(8,10).replace(/^0/,"");return`${F}/${P}`};function B(L){const F=Number.isInteger(L);return L>=1e6?`${(L/1e6).toFixed(1).replace(/\.0$/,"")}M`:L>=1e3?`${(L/1e3).toFixed(1).replace(/\.0$/,"")}k`:F?String(L):L<10?L.toFixed(1):L.toFixed(1).replace(/\.0$/,"")}const W=o.length?o[o.length-1].count:0;return e.jsxs("div",{className:"moderation-chart-card",ref:m,children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:u?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:u?11:12},children:["latest: ",B(W)]})]}),e.jsx("div",{style:{width:"100%"},children:e.jsxs("svg",{width:i,height:g,role:"img","aria-label":t,style:{display:"block",width:`${i}px`,height:`${g}px`,maxWidth:"100%"},children:[e.jsx("rect",{x:0,y:0,width:i,height:g,rx:12,style:{fill:"var(--panel-dark)"}}),K.map((L,F)=>{const P=f+(1-L)*C,E=L*N;return e.jsxs("g",{children:[e.jsx("line",{x1:_,y1:P,x2:i-h,y2:P,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:_-6,y:P+4,textAnchor:"end",fontSize:10,style:{fill:"var(--muted)"},children:B(E)})]},F)}),e.jsx("line",{x1:_,y1:f,x2:_,y2:f+C,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),e.jsx("line",{x1:_,y1:f+C,x2:_+x,y2:f+C,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),A.map((L,F)=>{var E;const P=_+L/Math.max(1,o.length-1)*x;return e.jsxs("g",{children:[e.jsx("line",{x1:P,y1:f,x2:P,y2:f+C,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:P,y:f+C+12,textAnchor:"middle",fontSize:10,style:{fill:"var(--muted)"},children:n((E=o[L])==null?void 0:E.day)})]},F)}),e.jsx("path",{d:y,fill:"none",stroke:s,strokeWidth:2}),Q.length>0&&e.jsx("circle",{cx:Q[Q.length-1][0],cy:Q[Q.length-1][1],r:3,fill:s})]})})]})}function Ys(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Xs(t){const o="=".repeat((4-t.length%4)%4),s=(t+o).replace(/-/g,"+").replace(/_/g,"/"),u=atob(s),a=new Uint8Array(u.length);for(let m=0;m<u.length;m++)a[m]=u.charCodeAt(m);return a}async function Oe(){return!("serviceWorker"in navigator)||!("PushManager"in window)?null:(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function Zs(){try{const t=await fetch(`${$e}/api/push/public_key`,{credentials:"include"});if(!t.ok)return null;const o=await t.json().catch(()=>null);return o&&typeof o.publicKey=="string"?o.publicKey:null}catch{return null}}async function ea(t){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)||await Notification.requestPermission()!=="granted")return!1;const s=await navigator.serviceWorker.ready;let u=await s.pushManager.getSubscription();u||(u=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Xs(t)}));try{await $(R.user.pushSubscribe,{method:"POST",body:JSON.stringify({...u.toJSON(),ua:navigator.userAgent})})}catch{}return!0}async function ta(){const t=await Oe();if(!t)return!0;try{await $(R.user.pushUnsubscribe,{method:"POST",body:JSON.stringify({endpoint:t.endpoint})})}catch{}try{await t.unsubscribe()}catch{}return!0}function sa(){const{theme:t,setTheme:o}=ze(),{data:s}=Le(),{notify:u}=Ne(),[a,m]=T.useState("general"),[c,j]=T.useState(!1),[i,g]=T.useState(!1),[f,h]=T.useState(!1),[b,_]=T.useState(typeof Notification<"u"?Notification.permission:"default"),k=v=>{o(v),kt(v)};return T.useEffect(()=>{j(typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),g(Ze()),Oe().then(v=>h(!!v)).catch(()=>h(!1)),typeof Notification<"u"&&_(Notification.permission)},[]),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("div",{className:"settings-title",children:"Settings"}),e.jsx("div",{className:"settings-description",children:"Personalize appearance and app behavior."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Settings",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Settings tabs",children:[e.jsx("button",{role:"tab","aria-selected":a==="general",className:`profile-tab ${a==="general"?"active":""}`,"data-tab":"general",onClick:v=>{const N=v.currentTarget.closest(".profile-tabs-unified"),x=N==null?void 0:N.querySelector(".profile-tabs-content");x==null||x.setAttribute("data-active","general"),m("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":a==="notifications",className:`profile-tab ${a==="notifications"?"active":""}`,"data-tab":"notifications",onClick:v=>{const N=v.currentTarget.closest(".profile-tabs-unified"),x=N==null?void 0:N.querySelector(".profile-tabs-content");x==null||x.setAttribute("data-active","notifications"),m("notifications")},children:"Notifications"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":a,children:[e.jsx("div",{className:"panel general",hidden:a!=="general",children:e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Appearance"}),e.jsx("span",{className:"settings-section-desc",children:"Customize how the app looks on this device."})]}),e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Theme"}),e.jsx("span",{className:"settings-sublabel",children:"Select your preferred color scheme"})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("div",{className:"theme-toggle-group",role:"group","aria-label":"Theme selection",children:[e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="dark"?"active":""}`,"aria-pressed":t==="dark",onClick:()=>k("dark"),children:"Dark"}),e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="light"?"active":""}`,"aria-pressed":t==="light",onClick:()=>k("light"),children:"Light"})]})})]})]})}),e.jsx("div",{className:"panel notifications",hidden:a!=="notifications",children:e.jsxs("div",{className:"col",style:{gap:24},children:[e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Push Notifications"}),e.jsx("span",{className:"settings-section-desc",children:"Manage push alerts for this device."})]}),!c&&e.jsx("div",{className:"settings-hint",children:"Push notifications are not supported on this device."}),c&&e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Push Alerts"}),e.jsx("span",{className:"settings-sublabel",children:b==="granted"&&f?"Enabled on this device":"Disabled on this device"}),!i&&e.jsx("div",{className:"settings-hint",style:{marginTop:4},children:"On iOS, install the app to your Home Screen to enable push."})]}),e.jsx("div",{className:"settings-action",children:b!=="granted"||!f?e.jsx("button",{className:"btn primary compact",onClick:async()=>{const v=await Zs();if(!v)return;await ea(v),_(typeof Notification<"u"?Notification.permission:"default");const N=await Oe();h(!!N)},title:i?void 0:"On iOS, install as PWA to enable",children:"Enable"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{await ta();const v=await Oe();h(!!v),_(typeof Notification<"u"?Notification.permission:"default")},children:"Disable"})})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Preferences"}),e.jsx("span",{className:"settings-section-desc",children:"Choose which activities trigger notifications."})]}),e.jsx(aa,{})]})]})})]})]})]})}function aa(){const{notify:t}=Ne(),[o,s]=T.useState(!0),[u,a]=T.useState(!1),[m,c]=T.useState({star:!0,likes5:!0,comment:!0,inspiration:!0,reaction:!0,system:!0,invites:!0});T.useEffect(()=>{(async()=>{s(!0);try{const f=await $(R.user.notifPrefs,{requireAuth:!0});f&&f.prefs&&c(h=>({...h,...f.prefs}))}finally{s(!1)}})()},[]);async function j(f){a(!0);try{await $(R.user.notifPrefs,{method:"POST",body:JSON.stringify(f)}),t("Preferences saved",{variant:"success"})}catch(h){t((h==null?void 0:h.message)||"Failed to save",{variant:"error"})}finally{a(!1)}}function i(f){const h={...m,[f]:!m[f]};c(h),j(h)}const g=({k:f,label:h,desc:b})=>e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:h}),b&&e.jsx("span",{className:"settings-sublabel",children:b})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("label",{className:"settings-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:m[f],onChange:()=>i(f),"aria-label":`Toggle ${h}`}),e.jsx("span",{className:"settings-toggle-slider"})]})})]});return o?e.jsx("div",{className:"settings-hint",children:"Loading preferences…"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{k:"star",label:"Stars",desc:"When someone stars your map"}),e.jsx(g,{k:"likes5",label:"Likes milestone",desc:"When you reach 5+ likes"}),e.jsx(g,{k:"comment",label:"Comments",desc:"When someone comments on your post"}),e.jsx(g,{k:"inspiration",label:"Inspirations",desc:"When someone is inspired by you"}),e.jsx(g,{k:"reaction",label:"Reactions",desc:"When someone reacts to your comment"}),e.jsx(g,{k:"invites",label:"Queue invitations",desc:"When you are invited to a queue"}),e.jsx(g,{k:"system",label:"System messages",desc:"Important announcements"}),u&&e.jsx("div",{className:"settings-hint",style:{marginTop:8},children:"Saving…"})]})}const ia=()=>(r.useEffect(()=>()=>{vs.clearAll()},[]),e.jsx(ys,{}));function na(){const[t,o]=T.useState({mobile:!1,standalone:!1,platform:""}),[s,u]=T.useState("ios");return T.useEffect(()=>{const a=typeof navigator<"u"&&navigator.userAgent||"",m=/iPad|iPhone|iPod/i.test(a)||/(Macintosh).*Mobile/.test(a),c=/Android/i.test(a),j=m?"ios":c?"android":"other";o({mobile:_e(),standalone:!1,platform:j}),u(j==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":s==="ios",className:`profile-tab ${s==="ios"?"active":""}`,"data-tab":"ios",onClick:a=>{const m=a.currentTarget.closest(".profile-tabs-unified");m.querySelectorAll(".profile-tab").forEach(j=>{j.classList.remove("active"),j.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),m.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),u("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":s==="android",className:`profile-tab ${s==="android"?"active":""}`,"data-tab":"android",onClick:a=>{const m=a.currentTarget.closest(".profile-tabs-unified");m.querySelectorAll(".profile-tab").forEach(j=>{j.classList.remove("active"),j.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),m.querySelector(".profile-tabs-content").setAttribute("data-active","android"),u("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":s,children:[e.jsx("div",{className:"panel",hidden:s!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:s!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const dt={standard:Nt,taiko:yt,mania:jt,catch:wt},ct={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},ra=({value:t,onChange:o})=>{const[s,u]=r.useState(!1),a=r.useRef(null);r.useEffect(()=>{if(!s)return;const c=i=>{a.current&&!a.current.contains(i.target)&&u(!1)},j=i=>{i.key==="Escape"&&u(!1)};return document.addEventListener("mousedown",c),document.addEventListener("keydown",j),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("keydown",j)}},[s]);const m=c=>e.jsxs("button",{className:`mode-option${c===t?" selected":""}`,onClick:()=>{o(c),u(!1)},role:"option","aria-selected":c===t,children:[e.jsx("img",{className:"mode-icon",src:dt[c],width:24,height:24,alt:""}),e.jsx("span",{children:ct[c]})]},c);return e.jsxs("div",{className:"mode-select",ref:a,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":s,onClick:()=>u(c=>!c),children:[e.jsx("img",{className:"mode-icon",src:dt[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:ct[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(m)})]})},oa=["help","feedback","showcase","request"];function ut(t){if(!t)return"standard";const o=String(t).toLowerCase().trim();return o==="osu"||o==="0"||o==="standard"?"standard":o==="taiko"||o==="1"?"taiko":o==="catch"||o==="fruits"||o==="2"?"catch":o==="mania"||o==="3"?"mania":"standard"}function la({section:t,onUpload:o,onPost:s}){const{notify:u}=Ne(),{data:a}=Le(),[m,c]=r.useState(""),[j,i]=r.useState(""),[g,f]=r.useState(null),[h,b]=r.useState(null),[_,k]=r.useState(!1),[v,N]=r.useState(""),x=r.useRef(0),[C,Q]=r.useState("standard"),[y,K]=r.useState(null),[A,n]=r.useState(0),[B,W]=r.useState(""),[L,F]=r.useState(""),[P,E]=r.useState(""),[D,S]=r.useState(""),[q,V]=r.useState(null),[l,M]=r.useState(!1),[I,X]=r.useState(null),ie=100*1024*1024,ne=r.useMemo(()=>y?`${y.name}:${y.size}:${y.lastModified}`:null,[y]),[w,O]=r.useState(!1),[te,se]=r.useState([]),[pe,d]=r.useState(!1),H=r.useRef(null),he=r.useRef(null),ae=r.useRef(null),xe=r.useRef(null);r.useEffect(()=>{if(!pe)return;const U=J=>{xe.current&&!xe.current.contains(J.target)&&ae.current&&!ae.current.contains(J.target)&&d(!1)};return document.addEventListener("mousedown",U),()=>document.removeEventListener("mousedown",U)},[pe]),r.useEffect(()=>{x.current&&window.clearTimeout(x.current);const U=(j||"").trim();if(!U){N(""),f(null),b(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(U)){N(""),f(null),b(null);return}return x.current=window.setTimeout(async()=>{var le;try{let ee;try{ee=new URL(U)}catch{N("Invalid URL format");return}const fe=ee.hash.match(/#osu\/(\d+)/),ce=fe?fe[1]:null;ee.hash="";const Ue={url:ee.toString()};ce&&(Ue.beatmap_id=ce);const be=await $(R.osu.resolveBeatmap+Ee(Ue),{requireAuth:!1}),p=Array.isArray(be==null?void 0:be.diffs)?be.diffs:[];if(!p.length&&!be.setId){N("No difficulties found"),f(null),b(null);return}if(f({setId:Number(be.setId)||0,beatmapId:be.beatmapId??null,title:String(be.title||""),artist:String(be.artist||""),mapper:String(be.mapper||""),diffs:p}),p.length>0){const G=Number.isFinite(Number(be.beatmapId))?Number(be.beatmapId):Number((le=p[0])==null?void 0:le.id),Y=p.find(we=>Number(we.id)===G)||p[0],ue=ut(Y==null?void 0:Y.mode);b({beatmapId:Number(Y==null?void 0:Y.id)||null,version:String((Y==null?void 0:Y.version)||""),mode:ue}),Q(ue)}else b(null);N("")}catch(ee){const fe=(ee==null?void 0:ee.message)||"Unknown error";N(`Failed to resolve: ${fe}`),f(null),b(null)}},400),()=>{x.current&&window.clearTimeout(x.current)}},[j]);const ye=m.trim(),We=U=>{var ee;const J=((ee=U.target.files)==null?void 0:ee[0])||null;if(K(J),V(null),J&&J.size>ie?E("File exceeds 100MB limit"):E(""),J)try{const fe=URL.createObjectURL(J),ce=document.createElement("video");ce.preload="metadata",ce.src=fe,ce.onloadedmetadata=()=>{URL.revokeObjectURL(fe);const ge=Number.isFinite(ce.duration)?ce.duration:NaN;Number.isFinite(ge)&&V(ge),Number.isFinite(ge)&&ge>60.5?S("Clip exceeds 60s limit"):S("")},ce.onerror=()=>{URL.revokeObjectURL(fe),V(null)}}catch{V(null)}else S("");const le=J?`${J.name}:${J.size}:${J.lastModified}`:null;le&&le!==I&&M(!1)};async function Be(){return F("info"),W("Requesting upload URL..."),await $(R.uploads.new,{method:"POST",body:JSON.stringify({description:ye.slice(0,100),beatmap_url:j||void 0,size_bytes:(y==null?void 0:y.size)??void 0,mode:C,beatmapset_id:(g==null?void 0:g.setId)??void 0,beatmap_id:(h==null?void 0:h.beatmapId)??void 0,beatmap_version:(h==null?void 0:h.version)??void 0,beatmap_title:g?`${g.title}`:void 0,beatmap_artist:g?`${g.artist}`:void 0,beatmap_mapper:g?`${g.mapper}`:void 0})})}async function z(U,J,le="form"){await new Promise((ee,fe)=>{const ce=new XMLHttpRequest;if(ce.open("POST",U),ce.upload.onprogress=ge=>{ge.lengthComputable&&n(Math.round(ge.loaded/ge.total*100))},ce.onload=()=>ce.status>=200&&ce.status<300?ee():fe(new Error(`Upload failed (${ce.status}) ${ce.responseText||""}`)),ce.onerror=()=>fe(new Error("Network error")),le==="form"){const ge=new FormData;ge.append("file",J,J.name),ce.send(ge)}else ce.setRequestHeader("Content-Type","application/octet-stream"),ce.send(J)})}async function oe(){if(y){if(y.size>ie){E("File exceeds 100MB limit");return}if(typeof q=="number"&&q>60.5){S("Clip exceeds 60s limit");return}ne&&(M(!0),X(ne)),n(0),F("info"),O(!0);try{const U=await Be();let J=U.streamUID;try{W("Uploading..."),await z(U.uploadURL,y,"form")}catch(le){F("warn"),W(`Retrying upload... (${(le==null?void 0:le.message)||le})`);const ee=await Be();J=ee.streamUID,await z(ee.uploadURL,y,"binary")}F("info"),W("Processing...");for(let le=0;le<60;le++){await new Promise(ee=>setTimeout(ee,3e3));try{if((await $(R.videos.get(J),{requireAuth:!1})).status==="ready"){F("success"),W("Ready!"),u("Upload complete!",{variant:"success"}),K(null),c(""),i(""),f(null),b(null),Q("standard"),n(0),E(""),S(""),V(null),M(!1),X(null),W(""),o&&o();break}}catch{}}}catch(U){F("error"),W(U.message||"Error"),u(U.message||"Upload failed",{variant:"error"})}finally{O(!1)}}}const re=async()=>{if(!ye.trim()){u("Text is required",{variant:"error"});return}if(ye.length>200){u("Text must be 200 characters or less",{variant:"error"});return}O(!0);try{const U=await $(R.moddi.posts,{method:"POST",body:JSON.stringify({text:ye,beatmap_url:j.trim()||void 0,beatmapset_id:(g==null?void 0:g.setId)??void 0,beatmap_id:(h==null?void 0:h.beatmapId)??(g==null?void 0:g.beatmapId)??void 0,beatmap_version:(h==null?void 0:h.version)??void 0,tags:te.length>0?te.join(","):void 0})});if(U){const J=U==null?void 0:U.post;J?(!J.uid&&J.id&&(J.uid=String(J.id)),s&&s(J)):s&&s(),u("Post created!",{variant:"success"}),c(""),i(""),f(null),b(null),N(""),se([])}}catch{u("Failed to create post",{variant:"error"})}finally{O(!1)}},Z=y?!P&&!D&&!l&&!w:ye.trim().length>0&&ye.length<=200&&!w;return e.jsxs("div",{className:"compose-twitter",style:{background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",padding:"12px 16px"},children:[e.jsxs("div",{style:{display:"flex",gap:12},children:[a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"",style:{width:40,height:40,borderRadius:"50%",flexShrink:0,objectFit:"cover"}}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("textarea",{ref:H,placeholder:"What's happening?",value:m,onChange:U=>c(U.target.value),maxLength:500,style:{width:"100%",background:"transparent",border:"none",padding:"8px 0",color:"var(--text)",fontFamily:"inherit",fontSize:18,resize:"none",minHeight:52,outline:"none",lineHeight:1.4},rows:1,onInput:U=>{const J=U.target;J.style.height="auto",J.style.height=J.scrollHeight+"px"}}),te.length>0&&e.jsx("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:6},children:te.map(U=>e.jsxs("span",{style:{background:"rgba(102, 126, 234, 0.2)",border:"1px solid rgba(102, 126, 234, 0.4)",borderRadius:12,padding:"2px 8px",fontSize:11,color:"#667eea",display:"flex",alignItems:"center",gap:4},children:[U,e.jsx("button",{type:"button",onClick:()=>se(J=>J.filter(le=>le!==U)),style:{background:"transparent",border:"none",color:"#667eea",cursor:"pointer",padding:0,display:"flex",alignItems:"center",lineHeight:1},children:e.jsx(De,{size:12})})]},U))}),g&&e.jsxs("div",{style:{marginTop:8,padding:"10px 12px",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,display:"flex",alignItems:"center",gap:10},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500},children:[g.artist," – ",g.title]}),e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:2},children:["Mapped by ",g.mapper]})]}),g.diffs.length>0&&e.jsx("select",{value:(h==null?void 0:h.beatmapId)??g.beatmapId??void 0,onChange:U=>{const J=Number(U.target.value),le=(g==null?void 0:g.diffs.find(ee=>Number(ee.id)===J))||null;if(le){const ee=ut(le.mode);b({beatmapId:J,version:le.version,mode:ee}),Q(ee)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,padding:"4px 8px",fontSize:11},children:g.diffs.map(U=>e.jsx("option",{value:U.id,children:U.version},U.id))}),e.jsx("button",{type:"button",onClick:()=>{f(null),b(null),i("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:16,padding:4},children:e.jsx(De,{size:14})})]}),v&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:v}),y&&e.jsxs("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.2)",borderRadius:8,display:"flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx(nt,{size:16}),e.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:y.name}),e.jsxs("span",{className:"muted",children:[(y.size/1024/1024).toFixed(1),"MB",q&&e.jsxs("span",{children:[" • ",Math.round(q),"s"]})]}),e.jsx("button",{type:"button",onClick:()=>{K(null),E(""),S("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:14,padding:2},children:e.jsx(De,{size:14})})]}),P&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:P}),D&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:D}),(A>0||B)&&e.jsxs("div",{style:{marginTop:8},children:[B&&e.jsx("div",{className:`chip ${L||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:B}),A>0&&e.jsx("div",{style:{marginTop:6,height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.min(100,Math.max(0,A))}%`,height:"100%",background:"#667eea",borderRadius:2,transition:"width 0.2s"}})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{type:"button",disabled:!0,style:{background:"transparent",border:"none",padding:8,cursor:"not-allowed",opacity:.4,color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center"},title:"Image upload (coming soon)",children:e.jsx(Xt,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{var U;return(U=he.current)==null?void 0:U.click()},style:{background:y?"rgba(102, 126, 234, 0.15)":"transparent",border:"none",padding:8,cursor:"pointer",color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},title:"Add video clip (max 60s, 100MB)",children:e.jsx(nt,{size:20})}),e.jsx("input",{ref:he,type:"file",accept:"video/*",onChange:We,style:{display:"none"}}),y&&e.jsx("div",{style:{marginLeft:8},children:e.jsx(ra,{value:C,onChange:Q})}),e.jsxs("div",{style:{position:"relative",marginLeft:4},children:[e.jsx("button",{ref:ae,type:"button",onClick:()=>d(U=>!U),style:{background:te.length>0||g?"rgba(102, 126, 234, 0.15)":"transparent",border:"none",padding:8,cursor:"pointer",color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},title:"Attach tags or beatmap",children:e.jsx(Zt,{size:20})}),pe&&e.jsxs("div",{ref:xe,style:{position:"absolute",bottom:"100%",left:0,marginBottom:8,background:"var(--panel-dark)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:12,padding:12,minWidth:240,zIndex:100,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Tags"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:oa.map(U=>{const J=te.includes(U);return e.jsx("button",{type:"button",onClick:()=>{se(le=>J?le.filter(ee=>ee!==U):[...le,U])},style:{background:J?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:J?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:16,padding:"4px 10px",fontSize:12,color:J?"#667eea":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:J?500:400},children:U},U)})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Beatmap URL"}),g?e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,padding:"8px 10px",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[g.artist," – ",g.title]}),e.jsxs("div",{className:"muted",style:{fontSize:10,marginTop:2},children:["by ",g.mapper]})]}),e.jsx("button",{type:"button",onClick:()=>{f(null),b(null),i("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:4,display:"flex"},children:e.jsx(De,{size:14})})]}):e.jsx("input",{type:"url",placeholder:"https://osu.ppy.sh/beatmapsets/...",value:j,onChange:U=>i(U.target.value),style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:8,padding:"8px 10px",fontSize:12,color:"var(--text)",outline:"none",boxSizing:"border-box"}}),v&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:v})]})]})]}),e.jsxs("span",{className:"muted",style:{fontSize:11,marginLeft:12},children:[ye.length,"/",y?100:200]})]}),e.jsx("button",{type:"button",onClick:y?oe:re,disabled:!Z,style:{background:Z?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:999,padding:"8px 18px",color:"#fff",fontWeight:600,fontSize:14,cursor:Z?"pointer":"not-allowed",transition:"all 0.15s"},children:w?"Posting...":"Post"})]})]})]}),_&&g&&e.jsx(St,{open:_,onClose:()=>k(!1),downloadUrl:R.osu.downloadBeatmapset(g.setId),beatmapId:(h==null?void 0:h.beatmapId)??g.beatmapId??void 0,beatmapVersion:h==null?void 0:h.version})]})}function da(){const{data:t}=Le(),{modeFilters:o}=ze(),s=Object.entries(o).filter(([a,m])=>m).map(([a])=>a),u=s.length?s.join(","):"standard";return gt({queryKey:["mappi","feed",u],queryFn:async({pageParam:a=0})=>{const m=new URLSearchParams({limit:"20",offset:String(a),modes:u}),c=`${R.feed.recent}?${m.toString()}`;return await $(c)},enabled:!!t,initialPageParam:0,getNextPageParam:(a,m)=>{var i;const c=m.reduce((g,f)=>{var h;return g+(((h=f.items)==null?void 0:h.length)||0)},0);return(((i=a.items)==null?void 0:i.length)||0)===20?c:void 0}})}function ca(){const{data:t}=Le(),{tagFilters:o}=ze();return gt({queryKey:["moddi","feed",o],queryFn:async({pageParam:s=0})=>{const u=new URLSearchParams({limit:"20",offset:String(s)}),a=`${R.moddi.posts}?${u.toString()}`;return await $(a)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,u)=>{var c;const a=u.reduce((j,i)=>{var g;return j+(((g=i.items)==null?void 0:g.length)||0)},0);return(((c=s.items)==null?void 0:c.length)||0)===20?a:void 0}})}function ua(){const t=Pe(),o=es(),{data:s}=Le(),{modeFilters:u,tagFilters:a}=ze(),{data:m,fetchNextPage:c,hasNextPage:j,isFetching:i,isFetchingNextPage:g,refetch:f}=da(),{data:h,fetchNextPage:b,hasNextPage:_,isFetching:k,isFetchingNextPage:v,refetch:N}=ca(),x=r.useMemo(()=>(m==null?void 0:m.pages.flatMap(E=>E.items||[]))||[],[m]),C=r.useMemo(()=>h!=null&&h.pages?h.pages.flatMap(E=>(E.items||[]).map(S=>({...S,user_id:S.user_id??0,username:S.username||"Unknown",avatar_url:S.avatar_url||null,text:S.text??null,uid:S.uid||String(S.id||""),reactions_count:Number(S.reactions_count??0),reacted_by_me:S.reacted_by_me??!1,comments_count:Number(S.comments_count??0),_type:"moddi"}))):[],[h]),Q=r.useMemo(()=>{const D=[...x.map(S=>({...S,_type:"mappi"})),...C];return D.sort((S,q)=>{const V=S.created_at||0;return(q.created_at||0)-V}),D},[x,C]),y=r.useMemo(()=>Q.filter(E=>{if(E._type==="mappi"){const D=Object.entries(u).filter(([V,l])=>l).map(([V])=>V.toLowerCase());if(D.length===0)return!0;const S=new Set(D),q=String(E.mode||"standard").toLowerCase();return S.has(q)}else{const D=E.tags?typeof E.tags=="string"?E.tags.split(",").map(V=>V.trim()):[]:[],S=!D.length,q=D.includes("help");return a.untagged&&a.help?!0:a.untagged&&!a.help?S:!a.untagged&&a.help?q:!0}}),[Q,u,a]);r.useEffect(()=>{t.pathname==="/feed"&&(f(),N())},[t.pathname,f,N]);const K=E=>{o.setQueryData(["mappi","feed"],D=>D&&{...D,pages:D.pages.map(S=>({...S,items:S.items.map(q=>q.id===E.id?E:q)}))})},A=E=>{o.setQueryData(["moddi","feed"],D=>D&&{...D,pages:D.pages.map(S=>({...S,items:S.items.map(q=>q.id===E.id?E:q)}))})},n=E=>{o.setQueryData(["mappi","feed"],D=>D&&{...D,pages:D.pages.map(S=>({...S,items:S.items.filter(q=>q.id!==E)}))}),o.setQueryData(["moddi","feed"],D=>D&&{...D,pages:D.pages.map(S=>({...S,items:S.items.filter(q=>q.id!==E)}))})},B=()=>{f()},W=E=>{E&&o.setQueryData(["moddi","feed"],D=>{if(!D)return D;const S={...E,user_id:E.user_id??0,username:E.username||"Unknown",avatar_url:E.avatar_url||null,text:E.text??null,uid:E.uid||String(E.id||""),reactions_count:Number(E.reactions_count??0),reacted_by_me:E.reacted_by_me??!1,comments_count:Number(E.comments_count??0)};return{...D,pages:D.pages.map((q,V)=>V===0?{...q,items:[S,...q.items||[]]}:q)}}),o.invalidateQueries({queryKey:["moddi","feed"]}),N()},L=i&&!g||k&&!v,F=j||_,P=()=>{j&&c(),_&&b()};return e.jsxs("div",{className:"feed-container unified-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto"},children:[e.jsx(la,{section:"mappi",onUpload:B,onPost:W}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[y.length===0&&!L&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to share something!"}),y.map(E=>e.jsx(Lt,{post:E,section:E._type,onUpdate:E._type==="mappi"?K:A,onDelete:n,me:s},`${E._type}-${E.id}`)),y.length>0&&F&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:P,disabled:g||v,children:g||v?"Loading...":"Load more"})})]})}),e.jsx(ms,{context:"unified-feed"})]})}const ma=T.lazy(()=>Ss(()=>import("./Discover-DJAKTnp6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));Us("dark");ps();"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t=encodeURIComponent($e);navigator.serviceWorker.register(`/sw.js?api=${t}`).then(o=>{console.log("Service Worker registered successfully:",o.scope)}).catch(o=>{console.error("Service Worker registration failed:",o)})});const pa=()=>e.jsx(is,{children:e.jsxs(me,{element:e.jsx(Bs,{}),children:[e.jsx(me,{path:"/",element:e.jsx(qs,{})}),e.jsx(me,{path:"/feed",element:e.jsx(ua,{})}),e.jsx(me,{path:"/feed/:uid",element:e.jsx(Gs,{})}),e.jsx(me,{path:"/discover",element:e.jsx(r.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(ma,{})})}),e.jsx(me,{path:"/queues",element:e.jsx(fs,{})}),e.jsx(me,{path:"/queues/:id",element:e.jsx(gs,{})}),e.jsx(me,{path:"/submissions",element:e.jsx(Me,{to:"/queues?tab=submissions",replace:!0})}),e.jsx(me,{path:"/mp/feed",element:e.jsx(Me,{to:"/feed",replace:!0})}),e.jsx(me,{path:"/mp/feed/:uid",element:e.jsx(Me,{to:"/feed/:uid",replace:!0})}),e.jsx(me,{path:"/mp/discover",element:e.jsx(Me,{to:"/discover",replace:!0})}),e.jsx(me,{path:"/md/feed",element:e.jsx(Me,{to:"/feed",replace:!0})}),e.jsx(me,{path:"/md/feed/:uid",element:e.jsx(Me,{to:"/feed/:uid",replace:!0})}),e.jsx(me,{path:"/md/queues",element:e.jsx(Me,{to:"/queues",replace:!0})}),e.jsx(me,{path:"/md/queues/:id",element:e.jsx(Me,{to:"/queues/:id",replace:!0})}),e.jsx(me,{path:"/md/submissions",element:e.jsx(Me,{to:"/submissions",replace:!0})}),e.jsx(me,{path:"/notifications",element:e.jsx(xs,{})}),e.jsx(me,{path:"/profile",element:e.jsx(lt,{})}),e.jsx(me,{path:"/profile/:id",element:e.jsx(lt,{})}),e.jsx(me,{path:"/moderation",element:e.jsx(Vs,{})}),e.jsx(me,{path:"/about",element:e.jsx(Ys,{})}),e.jsx(me,{path:"/settings",element:e.jsx(sa,{})}),e.jsx(me,{path:"/mobile",element:e.jsx(na,{})}),e.jsx(me,{path:"/editor",element:e.jsx(ia,{})})]})}),ha=()=>e.jsx(as,{children:e.jsx(pa,{})});ts(document.getElementById("root")).render(e.jsx(_s,{children:e.jsx(ss,{client:ks,children:e.jsx(hs,{children:e.jsx(ha,{})})})}));export{Ls as B,Ct as C,Et as P,Ss as _};
