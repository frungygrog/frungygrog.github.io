import{r as i,j as n,b as Ze,a as et,L as Fe,p as tt,D as nt,E as st,G as Oe,I as rt,J as qe,A as it,c as at}from"./vendor-react-_vsaDC62.js";import{P as ot}from"./Popup-CJZRRPtw.js";import{P as lt}from"./beatmap-preview-iFLBdsja.js";import{C as ct}from"./Comment-DHi-pL7Q.js";import{u as dt,a as g,A as p,b as ut,B as ft}from"./index-7yv1XHXp.js";import"./vendor-DBgzFpze.js";import"./editor-lib-BGkr3wNG.js";import"./editor-components-CKFEosPJ.js";const v={};function mt(){try{const c=localStorage.getItem("feed_seen_ids");if(c){const m=JSON.parse(c);Array.isArray(m)&&(v.seenIds=m.filter(w=>typeof w=="number"))}}catch{}return v}function Be(c){Object.assign(v,c);try{const m=Array.from(new Set(v.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(m))}catch{}}function jt(){var Ne,Pe,Ae;const{notify:c}=dt(),[m,w]=i.useState(v.history||[]),[u,z]=i.useState(v.index??-1),[b,F]=i.useState(v.queue||[]),[xe,be]=i.useState(!1),[O,D]=i.useState(!1),[ye,q]=i.useState(v.eligibleCount??null),[ve,B]=i.useState(v.viewedCount??0),[He,Ye]=i.useState(!1),[y,L]=i.useState(!0),[G,N]=i.useState(!1),[f,K]=i.useState(!1),[Z,H]=i.useState(!1),[ee,te]=i.useState(!1),[ne,Y]=i.useState(!1),[se,we]=i.useState([]),[M,U]=i.useState(""),[V,re]=i.useState(null),[ie,je]=i.useState(!1),[E,Ue]=i.useState(null),[ae,ke]=i.useState(!1),T=i.useRef(new Set(v.seenIds||[])),Se=i.useRef(new Set),oe=i.useRef(!1),_=i.useRef(v.lastShownVideoId??null),W=i.useRef(!1),P=i.useRef(0),Ce=i.useRef(0),S=i.useRef(null),Ie=i.useRef(null),le=i.useRef(null),ce=i.useRef(null),de=i.useRef(null),ue=i.useRef(null),$=i.useRef(0),Ee=i.useRef(0),J=i.useRef(null),X=i.useRef(null),[_e,Ve]=i.useState(0),t=i.useMemo(()=>u>=0?m[u]:null,[m,u]);i.useEffect(()=>{mt()},[]),i.useEffect(()=>{Be({history:m,index:u,queue:b,seenIds:Array.from(T.current),eligibleCount:ye??void 0,viewedCount:ve,lastShownVideoId:_.current??void 0})},[m,u,b,ye,ve]);const C=i.useCallback(()=>{try{const e=localStorage.getItem("filter_modes"),s=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],a=Array.from(new Set(s.filter(o=>r.includes(o))));return a.length?a:["standard"]}catch{return["standard"]}},[]),Re=i.useCallback(()=>{const e=new Set;return _.current!==null&&e.add(_.current),Array.from(T.current).slice(-200).forEach(r=>e.add(r)),b.forEach(r=>e.add(r.id)),Array.from(e)},[b]),fe=i.useCallback(async(e=5)=>{var r,a,o,d;if(oe.current)return[];const s=Date.now();if(s<P.current){const h=Math.ceil((P.current-s)/1e3);return c(`Rate limited. Please wait ${h}s.`,{durationMs:3e3,variant:"warn"}),[]}oe.current=!0;try{const h=Re(),I=C().join(","),j=[],A=new Set(b.map(k=>k.id));let he=[...h];const Ke=Math.min(e,5);for(let k=0;k<Ke;k++){if(k>0){const l=Date.now()-Ce.current;l<500&&await new Promise(x=>setTimeout(x,500-l))}try{Ce.current=Date.now();const l=await g(p.feed.next+ut({exclude:he.join(","),modes:I}),{requireAuth:!1}),x=l&&("id"in l?l:l.video)||null;if(!x)break;if(T.current.has(x.id)||A.has(x.id)||x.id===_.current){he.push(x.id);continue}j.push(x),he.push(x.id),A.add(x.id)}catch(l){if((r=l==null?void 0:l.message)!=null&&r.includes("401")||(a=l==null?void 0:l.message)!=null&&a.includes("Unauthorized")){Ye(!0);break}else if((o=l==null?void 0:l.message)!=null&&o.includes("429")||(d=l==null?void 0:l.message)!=null&&d.includes("rate limit")){P.current=Date.now()+1e4,c("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(j.length>0&&F(k=>{const l=new Set(k.map(ge=>ge.id)),x=j.filter(ge=>!l.has(ge.id));return[...k,...x]}),j.length===0&&b.length===0)try{const k=C().join(","),l=await g(p.feed.progress(k),{requireAuth:!1});q(Number(l.eligible||0)),B(Number(l.viewed||0)),D(Number(l.caught_up||0)===1)}catch{}return j}catch{return[]}finally{oe.current=!1}},[Re,C,b,c]),R=i.useCallback(async()=>{if(!xe){be(!0);try{b.length<=2&&fe(5).catch(()=>{});let e;if(b.length>0)e=b[0],F(s=>s.filter(r=>r.id!==e.id));else{const s=await fe(5);s.length>0&&(e=s[0],s.length>1&&F(r=>{const a=new Set(r.map(d=>d.id)),o=s.slice(1).filter(d=>!a.has(d.id));return[...r,...o]}))}if(e)_.current=e.id,T.current.add(e.id),Be({seenIds:Array.from(T.current)}),w(s=>{const r=[...s.slice(0,u+1),e];return z(r.length-1),r}),Se.current.has(e.id)||(Se.current.add(e.id),g(p.videos.view(e.id),{method:"POST"}).then(s=>{s&&w(r=>{const a=[...r],o=a.findIndex(d=>d.id===e.id);return o!==-1&&(a[o]={...a[o],views_count:s.views_count??a[o].views_count??0,viewed_by_me:!0}),a})}).catch(()=>{}));else try{const s=C().join(","),r=await g(p.feed.progress(s),{requireAuth:!1});q(Number(r.eligible||0)),B(Number(r.viewed||0)),D(Number(r.eligible||0)>0&&Number(r.viewed||0)>=Number(r.eligible||0))}catch{}}finally{be(!1)}}},[xe,b,fe,u,C]),me=i.useCallback(()=>{u>0&&(z(u-1),N(!1))},[u]),pe=i.useCallback(()=>{const e=Date.now();if(!(e-Ee.current<300)){if(Ee.current=e,y||(W.current=!0,L(!1)),u<m.length-1){const s=m[u+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:u,nextIndex:u+1,currentVideoId:t==null?void 0:t.id,nextVideoId:s==null?void 0:s.id,nextVideoStreamUID:s==null?void 0:s.stream_uid}),s&&(_.current=s.id),z(u+1),N(!1);return}if(!O){if(Date.now()<P.current){const s=Math.ceil((P.current-Date.now())/1e3);c(`Rate limited. Please wait ${s}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),R()}}},[u,m,y,O,R,c,t]);i.useEffect(()=>{const e=Ie.current;if(!e)return;const s=o=>{if(e){const h=e.getBoundingClientRect(),I=o.clientX,j=o.clientY;if(I<h.left||I>h.right||j<h.top||j>h.bottom)return}o.preventDefault(),o.stopPropagation();const d=Date.now();d<$.current||($.current=d+1e3,!(Math.abs(o.deltaY)<Math.abs(o.deltaX))&&(o.deltaY>0?pe():me()))},r=o=>{J.current=o.touches[0].clientY,X.current=Date.now()},a=o=>{if(J.current===null||X.current===null)return;const d=o.changedTouches[0].clientY,h=Date.now(),I=J.current-d,j=h-X.current;if(J.current=null,X.current=null,Math.abs(I)<50||j>300)return;const A=Date.now();A<$.current||($.current=A+1e3,I>0?pe():me())};return e.addEventListener("wheel",s,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",s,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",s,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a),window.removeEventListener("wheel",s,{capture:!0})}},[pe,me]);const We=i.useCallback(async()=>{var e,s;if(!(!t||ae)){ke(!0);try{const r=t.liked_by_me?"DELETE":"POST",a=await g(p.videos.like(t.id),{method:r});w(o=>{const d=[...o],h=d.findIndex(I=>I.id===t.id);return h!==-1&&(d[h]={...d[h],liked_by_me:!t.liked_by_me,likes_count:a.likes_count}),d})}catch(r){((e=r==null?void 0:r.message)!=null&&e.includes("429")||(s=r==null?void 0:r.message)!=null&&s.includes("rate limit"))&&c("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{ke(!1)}}},[t,ae,c]),ze=i.useCallback(async e=>{if(t)try{await g(p.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),c("Thanks for your report.",{variant:"info"})}catch{c("Report failed",{variant:"error"})}finally{H(!1)}},[t,c]),$e=i.useCallback(async()=>{if(!t)return;const e=!t.is_starred,s=e?"star":"unstar";try{await g(p.admin.videosAction(t.id,s),{method:"POST"}),w(r=>{const a=[...r],o=a.findIndex(d=>d.id===t.id);return o!==-1&&(a[o]={...a[o],is_starred:e}),a}),te(!1),c(e?"Post starred":"Star removed",{variant:"success"})}catch{c("Action failed",{variant:"error"})}},[t,c]),Me=i.useCallback(async()=>{if(!(!t||!confirm("Permanently delete this video?")))try{await g(p.videos.delete(t.id),{method:"DELETE"}),c("Deleted",{variant:"warn"}),H(!1),w(e=>{const s=e.filter((r,a)=>a!==u);return s.length===0?(z(-1),setTimeout(R,0)):z(r=>Math.max(0,Math.min(r,s.length-1))),s})}catch{alert("Delete failed")}},[t,u,R,c]),Q=i.useCallback(async()=>{if(t!=null&&t.id)try{const e=await g(p.videos.comments(t.id),{requireAuth:!1});we(e.items||[])}catch{}},[t==null?void 0:t.id]);i.useEffect(()=>{f&&(t!=null&&t.id)&&Q()},[f,t==null?void 0:t.id,Q]);const Te=i.useCallback(async e=>{if(e.preventDefault(),!(!M.trim()||!(t!=null&&t.id))){je(!0);try{await g(p.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:M.trim(),parent_id:V||void 0})}),U(""),re(null),Q(),w(s=>{const r=[...s],a=r.findIndex(o=>o.id===t.id);return a!==-1&&(r[a]={...r[a],comments_count:(r[a].comments_count||0)+1}),r}),c("Comment posted!",{variant:"success"})}catch(s){c((s==null?void 0:s.message)||"Failed to post comment",{variant:"error"})}finally{je(!1)}}},[M,t,V,Q,c]),Je=i.useCallback(e=>{we(s=>s.filter(r=>r.id!==e)),w(s=>{const r=[...s],a=r.findIndex(o=>o.id===(t==null?void 0:t.id));return a!==-1&&(r[a]={...r[a],comments_count:Math.max(0,(r[a].comments_count||0)-1)}),r})},[t==null?void 0:t.id]),{topLevelComments:De,repliesMap:Xe}=i.useMemo(()=>{const e=se.filter(r=>!r.parent_id),s=new Map;return se.filter(r=>r.parent_id).forEach(r=>{const a=r.parent_id;s.has(a)||s.set(a,[]),s.get(a).push(r)}),{topLevelComments:e,repliesMap:s}},[se]),Qe=i.useCallback(()=>{if(!S.current)return;const e=!y;L(e),S.current.muted=e,e||(W.current=!0),!e&&S.current.paused&&S.current.play().catch(()=>{})},[y]),Ge=i.useCallback(e=>{S.current=e,e&&(e.muted=y)},[y]);i.useEffect(()=>{console.log("[Discover] Video changed:",{videoId:t==null?void 0:t.id,streamUID:t==null?void 0:t.stream_uid,index:u,historyLength:m.length}),N(!1),K(!1),W.current?L(!1):L(!0)},[t==null?void 0:t.id,t==null?void 0:t.stream_uid,u,m.length]),i.useEffect(()=>{S.current&&(S.current.muted=y)},[y]),i.useEffect(()=>{if(!t)return;const e=!W.current;L(e);const s=setTimeout(()=>{S.current&&(S.current.muted=e)},100);return()=>clearTimeout(s)},[t==null?void 0:t.id]),i.useEffect(()=>{t&&(_.current=t.id)},[t==null?void 0:t.id]),i.useEffect(()=>{m.length===0&&R()},[]),i.useEffect(()=>{(async()=>{try{const e=C().join(","),s=await g(p.feed.progress(e),{requireAuth:!1}),r=Number(s.eligible||0),a=Number(s.viewed||0);q(r),B(a),D(r>0&&a>=r)}catch{}})()},[C]),i.useEffect(()=>{const e=()=>{w([]),F([]),T.current.clear(),_.current=null,z(-1),D(!1),(async()=>{try{const s=C().join(","),r=await g(p.feed.progress(s),{requireAuth:!1}),a=Number(r.eligible||0),o=Number(r.viewed||0);q(a),B(o),D(!1)}catch{}R()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[C,R]),i.useEffect(()=>{(async()=>{try{const e=await g(p.auth.me,{requireAuth:!1});Ue(e)}catch{}})()},[]),i.useEffect(()=>{const e=()=>{const s=document.querySelector(".top-nav");s&&Ve(s.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),i.useEffect(()=>{if(!Z)return;const e=s=>{le.current&&!le.current.contains(s.target)&&H(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Z]),i.useEffect(()=>{if(!ee)return;const e=s=>{ce.current&&!ce.current.contains(s.target)&&te(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ee]),i.useEffect(()=>{if(!ne)return;const e=s=>{de.current&&!de.current.contains(s.target)&&ue.current&&!ue.current.contains(s.target)&&Y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ne]);const Le=!!(E!=null&&E.is_admin||E!=null&&E.is_mod);return n.jsxs(n.Fragment,{children:[n.jsx(ft,{paused:!1}),n.jsx("style",{children:`
        .video-area .discover-player-wrapper > div {
          width: 100% !important;
          height: 100% !important;
          aspect-ratio: unset !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
        .video-area .discover-player-wrapper video {
          width: 100% !important;
          height: 100% !important;
          object-fit: cover !important;
        }
      `}),n.jsxs("div",{ref:Ie,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[O&&n.jsx("div",{className:"chip info",style:{position:"absolute",top:_e+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),n.jsx("div",{className:"video-area",style:{position:"absolute",top:_e,left:0,right:0,bottom:f?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:He?n.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[n.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),n.jsx("button",{className:"btn",onClick:()=>window.location.href=p.auth.login,children:"Login with osu!"})]}):t?n.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:G&&t.beatmapset_id?n.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:n.jsx(lt,{downloadUrl:p.osu.downloadBeatmapset(t.beatmapset_id),beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{N(!1),window.location.hash="/editor"}})}):n.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),n.jsx("div",{style:{position:"relative",zIndex:1,width:"100%",height:"100%"},children:n.jsxs("div",{onClick:Qe,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[n.jsx("div",{className:"discover-player-wrapper",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:n.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(ot,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:null,preferNative:!0,autoplay:!0,loop:!0,muted:y,controls:!1,onVideoRef:Ge})})}),n.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:y?1:0},children:y?n.jsx(Ze,{size:20,color:"#fff"}):n.jsx(et,{size:20,color:"#fff"})})]})})]})}):O?null:n.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[n.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),n.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[n.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),n.jsx("div",{children:"• Click video to toggle mute/unmute"}),n.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!G&&n.jsxs("div",{style:{position:"absolute",right:f?12:16,top:"50%",display:"flex",flexDirection:"column",gap:f?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:f?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[n.jsx(Fe,{to:`/profile/${(Ne=t.uploader)==null?void 0:Ne.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Pe=t.uploader)!=null&&Pe.avatar_url?n.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):n.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("button",{onClick:We,disabled:ae,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?n.jsx(tt,{size:28}):n.jsx(nt,{size:28})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("button",{onClick:()=>K(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(st,{size:28})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{ref:ue,onClick:()=>Y(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(Oe,{size:24})}),ne&&n.jsxs("div",{ref:de,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>Y(!1),children:[n.jsx(Oe,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&n.jsx("button",{className:"menu-item",onClick:()=>{N(!0),Y(!1)},children:"Preview"})]})]}),Le?n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{onClick:()=>te(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(qe,{size:24})}),ee&&n.jsxs("div",{ref:ce,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsx("button",{className:"menu-item",onClick:$e,children:t.is_starred?"Unstar post":"Star post"}),n.jsx("button",{className:"menu-item",onClick:Me,children:"Delete video"})]})]}):n.jsx("button",{onClick:()=>H(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(rt,{size:24})}),Z&&n.jsxs("div",{ref:le,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),n.jsx("button",{className:"menu-item",onClick:()=>ze("unrelated"),children:"Unrelated"}),n.jsx("button",{className:"menu-item",onClick:()=>ze("explicit"),children:"Explicit"}),Le&&n.jsx("button",{className:"menu-item",onClick:Me,children:"Delete video"})]})]}),t&&!G&&n.jsxs("div",{style:{position:"absolute",left:f?12:16,bottom:f?"55%":80,right:f?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:f?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:f?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[n.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:n.jsx(Fe,{to:`/profile/${(Ae=t.uploader)==null?void 0:Ae.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:f?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var a,o,d;const e=(a=t.uploader)==null?void 0:a.is_admin,s=(o=t.uploader)==null?void 0:o.is_mod,r=e?"#fff3bf":s?"#d7fbe8":"#fff";return n.jsxs(n.Fragment,{children:[n.jsxs("span",{style:{color:r},children:["@",(d=t.uploader)==null?void 0:d.username]}),t.is_starred&&n.jsx(it,{size:f?14:16,color:"#f59e0b",title:"Starred"}),(e||s)&&n.jsx(qe,{size:f?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&n.jsx("div",{style:{color:"#fff",fontSize:f?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&n.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:f?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),f&&t&&n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),n.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[n.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),n.jsx("button",{onClick:()=>K(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:n.jsx(at,{size:24})})]}),n.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:De.length===0?n.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):n.jsx("div",{className:"col",style:{gap:0},children:De.map(e=>n.jsx(ct,{comment:e,replies:Xe.get(e.id)||[],me:E,section:"mappi",onReply:s=>re(s),onDelete:Je,replyingTo:V,replyText:M,onReplyTextChange:U,onReplySubmit:Te,posting:ie,onCancelReply:()=>{re(null),U("")}},e.id))})}),E&&!V&&n.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:n.jsxs("form",{onSubmit:Te,style:{display:"flex",alignItems:"flex-end",gap:8},children:[n.jsx("textarea",{placeholder:"Write a comment...",value:M,onChange:e=>U(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const s=e.target;s.style.height="auto",s.style.height=`${Math.min(s.scrollHeight,120)}px`}}),n.jsx("button",{type:"submit",className:"btn compact",disabled:ie||!M.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:ie?"...":"Post"})]})})]})]})]})]})}export{jt as default};
