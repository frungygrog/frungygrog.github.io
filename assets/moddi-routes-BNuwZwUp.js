import{r,j as e,d as It,u as je,e as we,f as Ie,g as ye,h as et,i as Be,k as Rt,l as Ft,m as Mt,n as Te,o as Lt,R as se,p as ve,q as Et,s as At,t as pt,L as ze,v as Bt,w as Dt,x as mt,y as fe,z as gt,A as tt,B as Ot,M as Wt,C as st,D as nt,E as it,G as at,H as rt,I as ot,c as Pt,J as Qt}from"./vendor-react-04fz7b9N.js";import{B as $t}from"./editor-B3YzpbnK.js";function ht(){if(typeof window>"u")return!1;try{const t=navigator.userAgentData;if(t&&typeof t.mobile=="boolean"&&t.mobile||window.matchMedia&&(window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(hover: none)").matches))return!0;const s=navigator.userAgent||"";if(/Android|iPhone|iPad|iPod|Mobile|Silk|Kindle|Opera Mini|IEMobile|WPDesktop/i.test(s))return!0}catch{}return!1}function hs(){var d;if(typeof window>"u"||typeof document>"u")return()=>{};const t=()=>{const a=ht();document.documentElement.classList.toggle("is-mobile",a),document.documentElement.setAttribute("data-mobile",a?"true":"false")};t();const s=["(pointer: coarse)","(hover: none)","(orientation: landscape)","(orientation: portrait)"],i=[];try{for(const a of s)if(window.matchMedia){const l=window.matchMedia(a);(d=l.addEventListener)==null||d.call(l,"change",t),i.push(l)}}catch{}return window.addEventListener("resize",t),()=>{try{i.forEach(a=>{var l;return(l=a.removeEventListener)==null?void 0:l.call(a,"change",t)}),window.removeEventListener("resize",t)}catch{}}}function fs(){if(typeof window>"u")return!1;try{const t=navigator.standalone===!0,s=window.matchMedia&&window.matchMedia("(display-mode: standalone)"),i=!!(s&&s.matches),d=window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)"),a=window.matchMedia&&window.matchMedia("(display-mode: fullscreen)");return t||i||!!(d&&d.matches)||!!(a&&a.matches)}catch{return!1}}const ft=r.createContext(null);function bs({children:t}){const[s,i]=r.useState([]),d=r.useRef(1),a=r.useRef(new Map),l=o=>{const x=a.current.get(o);x&&(clearTimeout(x),a.current.delete(o))},c=(o,x)=>{l(o);const m=window.setTimeout(()=>h(o),x);a.current.set(o,m)},h=r.useCallback(o=>{l(o),i(x=>x.filter(m=>m.id!==o))},[]),b=r.useCallback((o,x)=>{const m=typeof x=="number"?x:(x==null?void 0:x.durationMs)??5e3,F=typeof x=="number"?"info":(x==null?void 0:x.variant)??"info",N=ht();let C=null;return i(N?S=>{const _=S[0];if(_&&_.message===o&&_.variant===F){const w={..._,count:_.count+1,duration:m};return C=w.id,[w]}S.forEach(w=>l(w.id));const R=d.current++,y={id:R,message:o,duration:m,variant:F,count:1};return C=R,[y]}:S=>{const _=S.findIndex(w=>w.message===o&&w.variant===F);if(_!==-1){const w=[...S],L={...w[_],count:w[_].count+1};return w[_]=L,C=L.id,w}const R=d.current++,y={id:R,message:o,duration:m,variant:F,count:1};return C=R,[...S,y]}),C!=null&&c(C,m),C??-1},[]),v=r.useMemo(()=>({notify:b,close:h}),[b,h]);return e.jsxs(ft.Provider,{value:v,children:[t,e.jsx("div",{className:"toasts",children:s.map(o=>e.jsxs("div",{className:`toast ${o.variant}`,children:[e.jsxs("div",{className:"toast-text",children:[o.message,o.count>1&&e.jsxs("span",{style:{marginLeft:6,opacity:.8},children:["×",o.count]})]}),e.jsx("button",{className:"toast-close",onClick:()=>h(o.id),"aria-label":"Close",children:"×"})]},o.id))})]})}function pe(){const t=r.useContext(ft);if(!t)throw new Error("useToasts must be used within ToastProvider");return t}const Ut=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{standard:!0,taiko:!0,mania:!0,catch:!0}}catch{return{standard:!0,taiko:!0,mania:!0,catch:!0}}},Ht=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help,showcase,request",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{untagged:s.has("untagged")||s.size===0,help:s.has("help")||s.size===0,showcase:s.has("showcase")||s.size===0,request:s.has("request")||s.size===0}}catch{return{untagged:!0,help:!0,showcase:!0,request:!0}}},Yt=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{unchecked:s.has("unchecked")||s.size===0,accepted:s.has("accepted")||s.size===0,denied:s.has("denied")||s.size===0,finished:s.has("finished")||s.size===0,archived:s.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Xt=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{open:s.has("open")||s.size===0,closed:s.has("closed")}}catch{return{open:!0,closed:!1}}},Jt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator,timing,audio",s=new Set(t.toLowerCase().split(",").map(i=>i.trim()).filter(Boolean));return{modder:s.has("modder")||s.size===0,nominator:s.has("nominator")||s.size===0,timing:s.has("timing")||s.size===0,audio:s.has("audio")||s.size===0}}catch{return{modder:!0,nominator:!0,timing:!0,audio:!0}}},Gt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Kt=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},We=It(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Ut(),tagFilters:Ht(),queueStatusFilters:Yt(),queueOpenFilters:Xt(),queueTypeFilters:Jt(),lastSection:Gt(),previousLocation:null,theme:Kt(),setMenuOpen:s=>t({menuOpen:s}),setMobileNavOpen:s=>t({mobileNavOpen:s}),setNotifOpen:s=>t({notifOpen:s}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:s=>{t({modeFilters:s});try{const d=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),a=d.length?d:["standard"];localStorage.setItem("filter_modes",a.join(","))}catch{}},setTagFilters:s=>{t({tagFilters:s});try{const d=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),a=d.length?d:["untagged","help","showcase","request"];localStorage.setItem("filter_moddi_tags",a.join(","))}catch{}},setQueueStatusFilters:s=>{t({queueStatusFilters:s});try{const d=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),a=d.length?d:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",a.join(","))}catch{}},setQueueOpenFilters:s=>{t({queueOpenFilters:s});try{const d=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),a=d.length?d:["open"];localStorage.setItem("filter_queue_open",a.join(","))}catch{}},setQueueTypeFilters:s=>{t({queueTypeFilters:s});try{const d=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),a=d.length?d:["modder","nominator","timing","audio"];localStorage.setItem("filter_queue_type",a.join(","))}catch{}},setLastSection:s=>{t({lastSection:s});try{s?localStorage.setItem("last_section",s):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:s=>{t({previousLocation:s})},setTheme:s=>{t({theme:s});try{localStorage.setItem("theme",s)}catch{}}})),bt="https://api.osumappi.ng";function xt(){var t;try{return((t=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s==="csrf"))==null?void 0:t[1])||""}catch{return""}}async function z(t,s={}){const{requireAuth:i=!0,skipCsrf:d=!1,...a}=s,l={...a.headers};if(a.body&&!l["Content-Type"]&&(l["Content-Type"]="application/json"),i&&!d){const h=xt();h&&(l["X-CSRF-Token"]=h)}const c=await fetch(`${bt}${t}`,{...a,credentials:"include",headers:l});if(!c.ok){const h=await c.json().catch(()=>({error:`HTTP ${c.status}`}));throw new Error(h.error||`HTTP ${c.status}: ${c.statusText}`)}return c.json()}function Vt(t){const s=new URLSearchParams;for(const[d,a]of Object.entries(t))a!=null&&s.append(d,String(a));const i=s.toString();return i?`?${i}`:""}const I={auth:{login:"/api/auth/login",logout:"/api/auth/logout",me:"/api/me"},user:{quota:"/api/me/upload_quota",notifications:"/api/me/notifications",markNotificationsRead:"/api/me/notifications/mark_read",deleteNotification:t=>`/api/me/notifications/${encodeURIComponent(t)}`,pushSubscribe:"/api/me/push/subscribe",pushUnsubscribe:"/api/me/push/unsubscribe",pushList:"/api/me/push/subscriptions",pushTest:"/api/me/push/test",notifPrefs:"/api/me/notification_prefs",bannerUpload:"/api/users/me/banner/upload-url",bannerImageUpload:"/api/users/me/banner/image/upload-url",bannerImageConfirm:"/api/users/me/banner/image/confirm"},feed:{next:"/api/feed/next",batch:"/api/feed/batch",progress:t=>`/api/feed/progress${t?`?modes=${encodeURIComponent(t)}`:""}`,recent:"/api/videos/recent"},videos:{like:t=>`/api/videos/${t}/like`,view:t=>`/api/videos/${t}/view`,update:t=>`/api/videos/${t}`,delete:t=>`/api/videos/${t}`,flag:t=>`/api/videos/${t}/flag`,comments:t=>`/api/videos/${t}/comments`,get:t=>`/api/videos/${t}`},uploads:{new:"/api/uploads/new"},moddi:{mySubmissions:"/api/moddi/me/submissions",posts:"/api/moddiposts",post:t=>`/api/moddiposts/${t}`,postReact:t=>`/api/moddiposts/${t}/react`,postComments:t=>`/api/moddiposts/${t}/comments`,queues:"/api/moddi/queues",queue:t=>`/api/moddi/queues/${t}`,queueSubmit:t=>`/api/moddi/queues/${t}/submit`,queueAccept:t=>`/api/moddi/queues/${t}/accept`,queueDeny:t=>`/api/moddi/queues/${t}/deny`,queueInvite:t=>`/api/moddi/queues/${t}/invite`,queueMember:(t,s)=>`/api/moddi/queues/${t}/members/${s}`,queueSubmission:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueSubmissionDelete:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueBlockUser:t=>`/api/moddi/queues/${t}/block`,queueUnblockUser:(t,s)=>`/api/moddi/queues/${t}/block/${s}`,queueBlockedUsers:t=>`/api/moddi/queues/${t}/blocked`,queueSubmissionAcknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueSubmissionUnacknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueBannerUpload:t=>`/api/moddi/queues/${t}/banner/upload-url`,queueBannerImageUpload:t=>`/api/moddi/queues/${t}/banner/image/upload-url`,queueBannerImageConfirm:t=>`/api/moddi/queues/${t}/banner/image/confirm`,usersSearch:t=>`/api/moddi/users/search?q=${encodeURIComponent(t)}`},osu:{resolveBeatmap:"/api/osu/beatmap/resolve",downloadBeatmapset:t=>`/api/osu/beatmapsets/${t}/download?noVideo=1`,usersSearch:t=>`/api/osu/users/search?q=${encodeURIComponent(t)}`},users:{get:t=>`/api/users/${t}`,videos:t=>`/api/users/${t}/videos`,likes:t=>`/api/users/${t}/likes`,myVideos:"/api/me/videos"},admin:{clearViews:"/api/admin/me/clear_views",debugState:"/api/debug/state",settingsModeration:"/api/admin/settings/moderation",videosPending:"/api/admin/videos/pending",videosApprove:t=>`/api/admin/videos/${t}/approve`,videosReject:t=>`/api/admin/videos/${t}/reject`,videosAction:(t,s)=>`/api/admin/videos/${t}/${s}`,analytics:"/api/admin/analytics",usersSearch:t=>`/api/admin/users/search?q=${encodeURIComponent(t)}`,userVideos:t=>`/api/admin/users/${t}/videos`,userUpdate:t=>`/api/admin/users/${t}`,notificationsSystem:"/api/admin/notifications/system",notificationsTest:"/api/admin/notifications/test"}};function Zt(t=!0){return je({queryKey:["notifications"],queryFn:async()=>{try{const s=await z(I.user.notifications);return Array.isArray(s.items)?s.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function es(){return je({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await z("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function xs(){const{data:t=[]}=Zt();return t.filter(s=>s.kind==="system"&&s.id.startsWith("b:")&&(s.expiresAt||0)<=Date.now()?!1:!s.read).length}function ts(){const t=we();return Ie({mutationFn:async s=>{await z(I.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:s})})},onSuccess:()=>{t.setQueryData(["notifications"],s=>(s==null?void 0:s.map(i=>({...i,read:!0})))||[])}})}function ss(){const t=we();return Ie({mutationFn:async s=>{const i=xt();await z(I.user.deleteNotification(s),{method:"DELETE",headers:{"X-CSRF-Token":i}})},onSuccess:(s,i)=>{t.setQueryData(["notifications"],d=>(d==null?void 0:d.filter(a=>a.id!==i))||[]),t.setQueryData(["notifications","detailed"],d=>(d==null?void 0:d.filter(a=>a.id!==i))||[])}})}function Re(){return je({queryKey:["user","me"],queryFn:async()=>{try{return await z(I.auth.me)}catch{return null}},staleTime:5*60*1e3})}function ys(t=!0){return je({queryKey:["user","quota"],queryFn:async()=>{try{return await z(I.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function vs(){const t=we();return Ie({mutationFn:async()=>{await z(I.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function ns(t,s,i,d){r.useEffect(()=>{if(!i)return;const a=l=>{const c=l.target;s.current&&!s.current.contains(c)&&t.current&&!t.current.contains(c)&&d()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[i,d,t,s])}const lt=/(\d{2}:\d{2}:\d{3})(?:\s+\(([\d,]+)\))?/g;function dt(t,s){return s?`osu://edit/${t}-(${s})`:`osu://edit/${t}`}function Pe({text:t,className:s,style:i}){lt.lastIndex=0;const d=[];let a=0,l;for(;(l=lt.exec(t))!==null;){l.index>a&&d.push(t.substring(a,l.index));const c=l[1],h=l[2],b=l[0];d.push(e.jsx("a",{href:dt(c,h),onClick:v=>{v.preventDefault(),window.location.href=dt(c,h)},style:{color:"var(--primary)",textDecoration:"none",cursor:"pointer"},onMouseEnter:v=>{v.currentTarget.style.textDecoration="underline"},onMouseLeave:v=>{v.currentTarget.style.textDecoration="none"},title:"Open in osu! editor",children:b},l.index)),a=l.index+l[0].length}return a<t.length&&d.push(t.substring(a)),d.length===0?e.jsx("span",{className:s,style:i,children:t}):e.jsx("span",{className:s,style:i,children:d})}function is({beatmapMeta:t,beatmapVersion:s}){const i=r.useRef(null),d=r.useRef(null),[a,l]=r.useState(!1),[c,h]=r.useState(!1),[b,v]=r.useState(0);r.useEffect(()=>{if(i.current&&d.current){const m=i.current.offsetWidth,F=d.current.scrollWidth;v(F),h(F>m)}},[t,s]);const o=t?e.jsxs(e.Fragment,{children:[t.artist," - ",t.title,t.mapper?` (by ${t.mapper})`:"",s?` [${s}]`:""]}):s?`[${s}]`:"Beatmap",x=b>0?Math.max(3,b/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:i,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&l(!0),onMouseLeave:()=>l(!1),children:[e.jsx("span",{ref:d,style:{display:"inline-block",animation:a&&c?`beatmap-marquee ${x}s linear infinite`:"none"},children:o}),a&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:o})]})]})}function De({submission:t,canManage:s,onUpdate:i,onDelete:d,isGroup:a=!1,allowSelfActions:l=!1}){const[c,h]=r.useState(!1),[b,v]=r.useState(!1),[o,x]=r.useState(null),[m,F]=r.useState(null),[N,C]=r.useState(t.beatmapset_id),[S,_]=r.useState(t.beatmap_id),[R,y]=r.useState(!1),[w,L]=r.useState(!1),[H,T]=r.useState(null),[O,B]=r.useState(!1),[Q,ee]=r.useState(t.acknowledgments||[]),[W,f]=r.useState(t.acknowledged_by_me||!1),q=r.useRef(null),g=r.useRef(null),U=r.useRef(null),Y=r.useRef(null),{notify:X}=pe();r.useEffect(()=>{ee(t.acknowledgments||[]),f(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),r.useEffect(()=>{if(t.beatmap_url)try{const u=new URL(t.beatmap_url),k=u.pathname.match(/\/beatmapsets\/(\d+)/);if(k&&!t.beatmapset_id){const P=Number(k[1]);isNaN(P)||C(P)}const D=u.hash.match(/#osu\/(\d+)/);if(D&&!t.beatmap_id){const P=Number(D[1]);isNaN(P)||_(P)}}catch(u){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,u)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),r.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:N,extracted_beatmap_id:S,beatmap_version:t.beatmap_version})},[t.id,N,S]),r.useEffect(()=>{if(!t.beatmap_url||m&&N)return;let u=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let k;try{k=new URL(t.beatmap_url)}catch(V){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,V);return}const D=k.hash.match(/#osu\/(\d+)/),P=D?D[1]:null;k.hash="";const he={url:k.toString()};if(P?he.beatmap_id=P:t.beatmap_id&&(he.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",he),!u){const V=await z(I.osu.resolveBeatmap+Vt(he),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",V),V.setId&&!N&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",V.setId),C(Number(V.setId))),(V.title||V.artist)&&F({title:V.title||null,artist:V.artist||null,mapper:V.mapper||null})}}catch(k){console.error("[QueueSubmission] Error fetching beatmap metadata:",k)}})(),()=>{u=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,m,N]),r.useEffect(()=>{if(!R){T(null);return}let u=null;const k=()=>{const D=Y.current;if(!D){T(null);return}const P=D.getBoundingClientRect();T({top:P.bottom+8,right:window.innerWidth-P.right})};return u=requestAnimationFrame(()=>{k(),window.addEventListener("resize",k),window.addEventListener("scroll",k,!0)}),()=>{u!==null&&cancelAnimationFrame(u),window.removeEventListener("resize",k),window.removeEventListener("scroll",k,!0)}},[R]),r.useEffect(()=>{if(!b){x(null);return}let u=null;const k=()=>{const D=q.current;if(!D){x(null);return}const P=D.getBoundingClientRect();x({top:P.bottom+8,right:window.innerWidth-P.right})};return u=requestAnimationFrame(()=>{k(),window.addEventListener("resize",k),window.addEventListener("scroll",k,!0)}),()=>{u!==null&&cancelAnimationFrame(u),window.removeEventListener("resize",k),window.removeEventListener("scroll",k,!0)}},[b]),r.useEffect(()=>{if(!b)return;const u=k=>{const D=k.target;g.current&&g.current.contains(D)||q.current&&q.current.contains(D)||v(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[b]),r.useEffect(()=>{if(!R)return;const u=k=>{const D=k.target;U.current&&U.current.contains(D)||Y.current&&Y.current.contains(D)||y(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[R]);const re=async u=>{if(!c){h(!0);try{await z(I.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:u})});const k={...t,status:u,updated_at:Math.floor(Date.now()/1e3)};i&&i(k),X("Status updated",{variant:"success"})}catch{X("Failed to update status",{variant:"error"})}finally{h(!1),v(!1)}}},ne=async()=>{if(!c){h(!0);try{const u=!!t.is_archived;await z(I.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!u})});const k={...t,is_archived:u?0:1,updated_at:Math.floor(Date.now()/1e3)};i&&i(k),X(u?"Unarchived":"Archived",{variant:"success"})}catch{X("Failed to update archive status",{variant:"error"})}finally{h(!1)}}},be=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){h(!0);try{await z(I.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),X("Submission deleted",{variant:"success"}),d&&d(t.id)}catch{X("Failed to delete submission",{variant:"error"})}finally{h(!1)}}},oe=async()=>{if(!O){B(!0);try{if(W){if(await z(I.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),f(!1),X("Unacknowledged",{variant:"info"}),i){const u={...t,acknowledged_by_me:!1};i(u)}}else if(await z(I.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),f(!0),X("Acknowledged",{variant:"success"}),i){const u={...t,acknowledged_by_me:!0};i(u)}}catch{X("Failed to update acknowledgment",{variant:"error"})}finally{B(!1)}}},$={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},ae={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},J=N||t.beatmapset_id,G=J?`https://assets.ppy.sh/beatmaps/${J}/covers/card.jpg`:null;r.useEffect(()=>{G?console.log("[QueueSubmission] Background image URL:",G,"for beatmapset_id:",J):console.log("[QueueSubmission] No background image URL - beatmapset_id:",J,"submission.beatmapset_id:",t.beatmapset_id)},[G,J,t.beatmapset_id]);const Z=!!t.is_archived,K=s||l,M=s,te=a?"Message submitter (team)":"Message submitter",le=`https://osu.ppy.sh/home/messages/users/${t.user_id}`,de=u=>{var P;if(!M)return;const k=u.target;k.closest("a")||k.closest("button")||(P=window.getSelection)!=null&&P.call(window).toString()||window.open(le,"_blank","noopener,noreferrer")},xe=u=>{M&&(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),window.open(le,"_blank","noopener,noreferrer"))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"queue-submission-card",style:{opacity:Z?.6:1},children:[G&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:G,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.25,zIndex:0,pointerEvents:"none",filter:"blur(2px) saturate(0.6)"},onError:u=>{u.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%)",backdropFilter:"blur(4px)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"queue-submission-header",children:[e.jsxs("div",{className:"queue-submission-user",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,width:28,height:28,style:{borderRadius:"50%"},alt:t.username}):e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:"rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,color:"var(--text)"},children:t.username.charAt(0).toUpperCase()}),e.jsxs("div",{className:"queue-submission-user-info",children:[e.jsx("span",{className:"queue-submission-username",children:t.username}),e.jsx("span",{className:"queue-submission-date",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]}),e.jsxs("div",{className:"queue-submission-controls",children:[Q&&Q.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:2},children:[Q.slice(0,5).map((u,k)=>u.avatar_url?e.jsx("img",{src:u.avatar_url,alt:u.username,title:u.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:k>0?-8:0,zIndex:Q.length-k,position:"relative",cursor:"pointer"}},u.user_id):e.jsx("div",{title:u.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:k>0?-8:0,zIndex:Q.length-k,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:u.username.charAt(0).toUpperCase()},u.user_id)),Q.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${Q.length-5} more`,children:["+",Q.length-5]})]}),t.beatmap_url&&e.jsxs("button",{type:"button",ref:Y,className:"queue-submission-beatmap-btn",onClick:u=>{u.preventDefault(),u.stopPropagation(),y(k=>!k)},title:"Beatmap options","aria-label":"Beatmap options",children:[e.jsx(et,{size:14}),e.jsx("span",{children:"Beatmap"}),e.jsx(Be,{size:12,style:{opacity:.7}})]}),s&&e.jsx("button",{type:"button",className:"icon-link queue-submission-icon-btn",onClick:oe,disabled:O||c,title:W?"Unacknowledge":"Acknowledge",style:{color:W?"#10b981":"var(--muted)",background:W?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Rt,{size:16})}),K&&e.jsx("button",{type:"button",className:"icon-link queue-submission-icon-btn",onClick:ne,disabled:c,title:Z?"Unarchive":"Archive",style:{color:Z?"#6366f1":"var(--muted)",background:Z?"rgba(99, 102, 241, 0.1)":"transparent"},children:Z?e.jsx(Ft,{size:16}):e.jsx(Mt,{size:16})}),K&&e.jsx("button",{type:"button",className:"icon-link queue-submission-icon-btn",onClick:be,disabled:c,title:"Delete submission",style:{color:"var(--danger)"},children:e.jsx(Te,{size:16})}),s?e.jsxs("button",{type:"button",ref:q,className:"queue-submission-status-btn",onClick:()=>v(!b),disabled:c,style:{background:$[t.status]+"15",borderColor:$[t.status]+"50",color:$[t.status],opacity:c?.6:1},children:[e.jsx("span",{children:ae[t.status]}),e.jsx(Be,{size:12,style:{marginLeft:2,transition:"transform 0.2s ease",transform:b?"rotate(180deg)":"rotate(0deg)"}})]}):e.jsx("span",{className:"queue-submission-status-badge",style:{background:$[t.status]+"15",borderColor:$[t.status]+"50",color:$[t.status]},children:ae[t.status]})]})]}),e.jsxs("div",{className:`queue-submission-content${M?" is-clickable":""}`,role:M?"button":void 0,tabIndex:M?0:-1,"aria-label":M?`Message ${t.username}`:void 0,"aria-disabled":!M,onClick:de,onKeyDown:xe,children:[e.jsxs("div",{className:"queue-submission-content-header",children:[e.jsx("span",{className:"queue-submission-content-title",children:"Submission"}),t.beatmap_version&&e.jsxs("span",{className:"queue-submission-version",children:["[",t.beatmap_version,"]"]})]}),e.jsxs("div",{className:"queue-submission-content-body",children:[e.jsxs("div",{className:"queue-submission-section",children:[e.jsx("span",{className:"queue-submission-section-label",children:"Beatmap"}),e.jsx("div",{className:"queue-submission-section-body",children:t.beatmap_url?e.jsx(is,{beatmapMeta:m,beatmapVersion:t.beatmap_version}):e.jsx("span",{className:"muted",children:"No beatmap link provided."})})]}),e.jsxs("div",{className:"queue-submission-section queue-submission-message",children:[e.jsx("span",{className:"queue-submission-section-label",children:"Message"}),e.jsx("div",{className:"queue-submission-section-body",children:t.message?e.jsx(Pe,{text:t.message,className:"queue-submission-message-text"}):e.jsx("span",{className:"muted",children:"No message provided."})})]})]}),M&&e.jsxs("div",{className:"queue-submission-message-cta",children:[e.jsx(Lt,{size:14}),e.jsx("span",{children:te})]})]})]})]}),R&&H&&t.beatmap_url&&ye.createPortal(e.jsxs("div",{ref:U,style:{position:"fixed",top:H.top,right:H.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:u=>u.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>y(!1),children:[e.jsx(et,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),J&&e.jsx("button",{className:"menu-item",onClick:()=>{L(!0),y(!1)},children:"Preview"})]}),document.body),b&&o&&s&&ye.createPortal(e.jsx("div",{ref:g,style:{position:"fixed",top:o.top,right:o.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)"},onClick:u=>u.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(u=>e.jsx("button",{onClick:()=>re(u),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:u===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:u===t.status?$[u]+"15":"transparent",color:u===t.status?$[u]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:k=>{u!==t.status&&(k.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:k=>{u!==t.status&&(k.currentTarget.style.background="transparent")},children:ae[u]},u))}),document.body),w&&J&&e.jsx($t,{open:w,onClose:()=>L(!1),downloadUrl:`${bt}${I.osu.downloadBeatmapset(J)}`,beatmapId:S??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}const ct=["modding","timing","audio"],Ee=["nominator","subdivision"];function Fe(){return je({queryKey:["moddi","queues"],queryFn:async()=>{const t=await z(I.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function yt(){const t=we();return Ie({mutationFn:async s=>{var i;return await z(I.moddi.queues,{method:"POST",body:JSON.stringify({name:s.name.trim(),description:((i=s.description)==null?void 0:i.trim())||null,is_group:s.is_group??!1,type:s.type||"modder",tags:s.tags||"modding"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function Qe({open:t,onClose:s,children:i}){const d=r.useRef(null),a=r.useRef(null),l=r.useRef(!1),c=o=>{var x;a.current=((x=o.touches[0])==null?void 0:x.clientY)??null,l.current=!1},h=o=>{var N,C;if(a.current==null)return;const x=((N=o.touches[0])==null?void 0:N.clientY)??null;if(x==null)return;const m=x-a.current;(((C=d.current)==null?void 0:C.scrollTop)??0)<=0&&m>60?l.current=!0:l.current=!1},b=()=>{l.current&&s(),a.current=null,l.current=!1};if(!t)return null;const v=e.jsx("div",{className:"mobile-upload-overlay",onClick:s,children:e.jsx("div",{ref:d,className:"mobile-upload-sheet",onClick:o=>o.stopPropagation(),onTouchStart:c,onTouchMove:h,onTouchEnd:b,children:i})});return ye.createPortal(v,document.body)}function as({queueId:t,onSubmitted:s}){const[i,d]=se.useState(!1),[a,l]=se.useState(t),[c,h]=se.useState(""),[b,v]=se.useState(""),[o,x]=se.useState(!1),{notify:m}=pe(),{data:F=[]}=Fe();se.useEffect(()=>{l(t)},[t]);const N=async()=>{if(!a){m("Please select a queue",{variant:"error"});return}if(!c.trim()){m("Beatmap URL is required",{variant:"error"});return}x(!0);try{await z(I.moddi.queueSubmit(a),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:b.trim()||null})}),m("Submission created!",{variant:"success"}),h(""),v(""),d(!1),s==null||s()}catch(C){m((C==null?void 0:C.message)||"Failed to create submission",{variant:"error"})}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>d(!0),children:e.jsx(ve,{size:22})}),e.jsx(Qe,{open:i,onClose:()=>d(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:a??"",onChange:C=>l(C.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),F.map(C=>e.jsx("option",{value:String(C.id),children:C.name},C.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:C=>h(C.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:b,onChange:C=>v(C.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),b.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[b.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:o,onClick:N,children:o?"Submitting...":"Submit"})]})]})})]})}const vt=({context:t})=>{const s=Et(),{tagFilters:i,setTagFilters:d,queueTypeFilters:a,setQueueTypeFilters:l,queueStatusFilters:c,setQueueStatusFilters:h}=We(),b=se.useMemo(()=>{if(t)return t;const S=s.pathname;return S==="/feed"?"unified-feed":S==="/mp/feed"?"mappi-feed":S==="/md/feed"?"moddi-feed":S==="/queues"||S==="/md/queues"?"moddi-queues":S.startsWith("/queues/")||S.startsWith("/md/queues/")?"moddi-queue-detail":"unified-feed"},[t,s.pathname]),v=S=>{const _={...i,[S]:!i[S]};!_.untagged&&!_.help&&!_.showcase&&!_.request&&(_.untagged=!0),d(_);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},o=S=>{const _={...a,[S]:!a[S]};!_.modder&&!_.nominator&&!_.timing&&!_.audio&&(_.modder=!0),l(_)},x=S=>{const _={...c,[S]:!c[S]};["unchecked","accepted","denied","finished"].some(y=>_[y])||(_.unchecked=!0),h(_)},m=({active:S,onClick:_,label:R})=>e.jsx("button",{type:"button",onClick:_,className:"desktop-filter-chip","aria-pressed":S,"data-active":S,children:R}),F=b==="unified-feed"||b==="moddi-feed",N=b==="moddi-queues",C=b==="moddi-queue-detail";return e.jsxs("div",{className:"desktop-filter-bar",children:[F&&e.jsxs(e.Fragment,{children:[e.jsx(m,{active:i.untagged,onClick:()=>v("untagged"),label:"untagged"}),e.jsx(m,{active:i.help,onClick:()=>v("help"),label:"help"}),e.jsx(m,{active:i.showcase,onClick:()=>v("showcase"),label:"showcase"}),e.jsx(m,{active:i.request,onClick:()=>v("request"),label:"request"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx(m,{active:a.modder,onClick:()=>o("modder"),label:"modding"}),e.jsx(m,{active:a.nominator,onClick:()=>o("nominator"),label:"bn/subdivision"}),e.jsx(m,{active:a.timing,onClick:()=>o("timing"),label:"timing"}),e.jsx(m,{active:a.audio,onClick:()=>o("audio"),label:"audio"})]}),C&&e.jsxs(e.Fragment,{children:[e.jsx(m,{active:c.unchecked,onClick:()=>x("unchecked"),label:"pending"}),e.jsx(m,{active:c.accepted,onClick:()=>x("accepted"),label:"accepted"}),e.jsx(m,{active:c.denied,onClick:()=>x("denied"),label:"denied"}),e.jsx(m,{active:c.finished,onClick:()=>x("finished"),label:"finished"})]})]})};function Oe({tabs:t,activeTab:s,onChange:i,rightAction:d,style:a}){return e.jsxs("div",{className:"tab-header",style:{display:"flex",background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",position:"relative",...a},children:[t.map((l,c)=>{const h=l.id===s,b=c===t.length-1;return e.jsxs("button",{onClick:()=>i(l.id),style:{flex:1,padding:"14px 16px",background:"transparent",border:"none",borderRight:!b||d?"1px solid rgba(255,255,255,0.08)":"none",color:h?"var(--text)":"var(--muted)",fontWeight:h?600:400,fontSize:14,fontFamily:"inherit",cursor:"pointer",transition:"all 0.15s ease",position:"relative"},onMouseEnter:v=>{h||(v.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="transparent"},children:[l.label,h&&e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:"var(--accent, #667eea)",borderRadius:"2px 2px 0 0"}})]},l.id)}),d&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:d})]})}function rs({isOpen:t,onClose:s,onSubmitted:i,queueId:d,isQueueOpen:a,anchorRef:l,rules:c}){const{notify:h}=pe(),[b,v]=r.useState(""),[o,x]=r.useState(""),[m,F]=r.useState(!1),[N,C]=r.useState(!1),S=r.useRef(null);r.useEffect(()=>{if(!t)return;const R=y=>{const w=y.target;if(S.current&&!S.current.contains(w)&&(l!=null&&l.current)&&!l.current.contains(w)){const L=document.getElementById("rules-modal-overlay");if(L&&L.contains(w))return;s()}};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[t,s,l]);const _=async R=>{if(R.preventDefault(),!a){h("Queue is closed for submissions",{variant:"error"});return}if(!b.trim()){h("Beatmap URL is required",{variant:"error"});return}F(!0);try{await z(I.moddi.queueSubmit(d),{method:"POST",body:JSON.stringify({beatmap_url:b.trim(),message:o.trim()||null})}),h("Submission created!",{variant:"success"}),s(),v(""),x(""),i()}catch(y){h((y==null?void 0:y.message)||"Failed to create submission",{variant:"error"})}finally{F(!1)}};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:S,className:"submit-beatmap-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:a?e.jsx("form",{onSubmit:_,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:b,onChange:R=>v(R.target.value),required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:o,onChange:R=>x(R.target.value.slice(0,100)),maxLength:100,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),o.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right"},children:[o.length,"/100"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:4},children:[c?e.jsx("button",{type:"button",onClick:()=>C(!0),style:{background:"transparent",border:"none",padding:0,color:"var(--text)",fontSize:13,textDecoration:"underline",cursor:"pointer",opacity:.8},children:"Rules"}):e.jsx("div",{}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m||!b.trim(),style:{background:b.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:b.trim()?"pointer":"not-allowed"},children:m?"Submitting...":"Submit"})]})]})]})}):e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"This queue is currently closed for submissions."})})}),N&&c&&e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>C(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>C(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6,whiteSpace:"pre-wrap"},children:c})]})})]}):null}const ut={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},os=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Wt,{components:{p:({children:s})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:s}),ul:({children:s})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),ol:({children:s})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),li:({children:s})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:s}),strong:({children:s})=>e.jsx("strong",{style:{fontWeight:600},children:s}),em:({children:s})=>e.jsx("em",{children:s}),code:({children:s})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:s}),h1:({children:s})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:s}),h2:({children:s})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:s}),h3:({children:s})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:s})},children:t})});function js(){var Ve;const{id:t}=At(),s=pt(),[i,d]=r.useState(null),[a,l]=r.useState([]),[c,h]=r.useState([]),[b,v]=r.useState(!0),[o,x]=r.useState(null),[m,F]=r.useState(!1),N=r.useRef(null),[C,S]=r.useState(null),[_,R]=r.useState(!1),[y,w]=r.useState(""),[L,H]=r.useState(""),[T,O]=r.useState(""),[B,Q]=r.useState("modder"),[ee,W]=r.useState(!1),[f,q]=r.useState(!1),[g,U]=r.useState("general"),[Y,X]=r.useState(!1),[re,ne]=r.useState(!1),[be,oe]=r.useState(null),[$,ae]=r.useState(""),[J,G]=r.useState([]),[Z,K]=r.useState(!1),M=r.useRef(null),te=r.useRef(null),le=r.useRef(null),[de,xe]=r.useState([]),[u,k]=r.useState(!1),[D,P]=r.useState(null),[Se,he]=r.useState("active"),[V,ke]=r.useState(!1),[$e,Ue]=r.useState(!1),[He,Me]=r.useState(0),_e=r.useRef(null),{notify:A}=pe(),{queueStatusFilters:Ne}=We(),ce=async()=>{var n,p;if(t){v(!0);try{const j=await z(I.moddi.queue(t),{requireAuth:!1});d(j.queue||null),l(j.members||[]),h(j.submissions||[])}catch(j){(n=j==null?void 0:j.message)!=null&&n.includes("403")||(p=j==null?void 0:j.message)!=null&&p.includes("Forbidden")?(A("You do not have access to this queue",{variant:"error"}),s("/queues")):A("Failed to load queue",{variant:"error"})}finally{v(!1)}}};r.useEffect(()=>{ce(),z(I.auth.me,{requireAuth:!1}).then(n=>x(n)).catch(()=>{})},[t]);const me=o&&i&&(i.owner_id===o.id||a.some(n=>n.user_id===o.id&&n.joined_at)||o.is_mod||o.is_admin),jt=o&&a.some(n=>n.user_id===o.id&&n.joined_at),Ye=o&&i&&(i.owner_id===o.id||a.some(n=>n.user_id===o.id&&n.joined_at)),Xe=n=>{h(p=>p.map(j=>j.id===n.id?n:j)),n.acknowledged_by_me!==void 0&&ce()},wt=()=>{i&&(w(i.name),H(i.description||""),O(i.rules||""),Q(i.type||"modder"),R(!0),U("general"))},Ce=()=>{R(!1),w(""),H(""),O(""),Q("modder"),ke(!1)},Je=async()=>{if(!(!i||!Ye)){q(!0);try{const n=i.is_open!==1;await z(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:n})}),A(`Queue ${n?"opened":"closed"} `,{variant:"success"}),ce()}catch(n){A((n==null?void 0:n.message)||"Failed to update status",{variant:"error"})}finally{q(!1)}}},Ge=async n=>{if(n.preventDefault(),!i||!y.trim()){A("Queue name is required",{variant:"error"});return}X(!0);try{const p=a.filter(E=>E.user_id!==i.owner_id&&E.role!=="owner").length>0,j={name:y.trim(),description:L.trim()||null,rules:T.trim()||null,is_group:p};(o!=null&&o.is_mod||o!=null&&o.is_admin)&&(j.type=B),await z(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify(j)}),A("Queue updated!",{variant:"success"}),Ce(),ce()}catch(p){A((p==null?void 0:p.message)||"Failed to update queue",{variant:"error"})}finally{X(!1)}};r.useEffect(()=>{if(!$.trim()){G([]),K(!1);return}const n=setTimeout(async()=>{try{const j=(await z(I.moddi.usersSearch($),{requireAuth:!1})).items||[];G(j),K(j.length>0)}catch(p){console.error("Search failed:",p),G([]),K(!1)}},300);return()=>clearTimeout(n)},[$]);const St=async n=>{if(!re){ne(!0);try{await z(I.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:n})}),A("Invite sent!",{variant:"success"}),ae(""),G([]),K(!1),ce()}catch(p){A((p==null?void 0:p.message)||"Failed to invite member",{variant:"error"})}finally{ne(!1)}}},Le=async()=>{if(!(!t||!me))try{const n=await z(I.moddi.queueBlockedUsers(t));xe(n.blocked||[])}catch(n){console.error("Failed to load blocked users:",n)}},kt=async n=>{if(!(!t||u)&&confirm("Block this user from submitting to this queue?")){k(!0);try{await z(I.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:n})}),A("User blocked",{variant:"success"}),Le(),ae(""),G([]),K(!1)}catch(p){A((p==null?void 0:p.message)||"Failed to block user",{variant:"error"})}finally{k(!1)}}},Ke=async n=>{if(!(!t||D===n)){P(n);try{await z(I.moddi.queueUnblockUser(t,n),{method:"DELETE"}),A("User unblocked",{variant:"success"}),Le()}catch(p){A((p==null?void 0:p.message)||"Failed to unblock user",{variant:"error"})}finally{P(null)}}};r.useEffect(()=>{g==="members"&&me&&t&&Le()},[g,me,t]);const _t=async()=>{if(i&&confirm(`Are you sure you want to delete "${i.name}" ? This action cannot be undone.`)){W(!0);try{await z(I.moddi.queue(t),{method:"DELETE"}),A("Queue deleted",{variant:"success"}),s("/queues")}catch(n){A((n==null?void 0:n.message)||"Failed to delete queue",{variant:"error"})}finally{W(!1)}}},Nt=async n=>{if(!o||!i||o.id!==i.owner_id){A("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){oe(n);try{await z(I.moddi.queueMember(t,n),{method:"DELETE"}),A("Member removed",{variant:"success"});const j=a.filter(E=>E.user_id!==n).some(E=>E.user_id!==(i==null?void 0:i.owner_id)&&E.role!=="owner");if(i&&i.is_group===1&&!j)try{await z(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}ce()}catch(p){A((p==null?void 0:p.message)||"Failed to remove member",{variant:"error"})}finally{oe(null)}}},Ct=async()=>{if(o&&confirm("Leave this queue? You will need to be invited again to rejoin.")){oe(o.id);try{await z(I.moddi.queueMember(t,o.id),{method:"DELETE"}),A("Left queue",{variant:"success"});const p=a.filter(j=>j.user_id!==o.id).some(j=>j.user_id!==(i==null?void 0:i.owner_id)&&j.role!=="owner");if(i&&i.is_group===1&&!p)try{await z(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}s("/queues")}catch(n){A((n==null?void 0:n.message)||"Failed to leave queue",{variant:"error"})}finally{oe(null)}}},qt=async n=>{var j;const p=(j=n.target.files)==null?void 0:j[0];if(!(!p||!t)){Ue(!0),Me(0);try{const E=await z(I.moddi.queueBannerImageUpload(t),{method:"POST"}),ie=E.uploadURL,Tt=E.imageID,ge=new XMLHttpRequest;ge.open("POST",ie,!0),ge.upload.onprogress=ue=>{if(ue.lengthComputable){const qe=Math.round(ue.loaded/ue.total*100);Me(qe)}},await new Promise((ue,qe)=>{ge.onload=()=>{ge.status>=200&&ge.status<300?ue():qe(new Error("Upload failed"))},ge.onerror=()=>qe(new Error("Network error"));const Ze=new FormData;Ze.append("file",p),ge.send(Ze)});const zt=await z(I.moddi.queueBannerImageConfirm(t),{method:"POST",body:JSON.stringify({imageID:Tt})});d(ue=>ue?{...ue,banner_stream_uid:zt.banner_stream_uid}:null),A("Banner updated!",{variant:"success"})}catch(E){console.error(E),A(E.message||"Banner upload failed",{variant:"error"})}finally{Ue(!1),Me(0),_e.current&&(_e.current.value="")}}};return r.useEffect(()=>{if(!_)return;const n=p=>{var E;const j=p.target;(E=document.getElementById("rules-modal-overlay"))!=null&&E.contains(j)||j.closest(".manage-overlay")||j.closest(".manage-overlay-backdrop")||!j.closest(".manage-popup")&&le.current&&!le.current.contains(j)&&Ce()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[_]),r.useEffect(()=>{if(!Z)return;const n=p=>{const j=p.target;M.current&&!M.current.contains(j)&&te.current&&!te.current.contains(j)&&K(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[Z]),b?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):i?e.jsxs("div",{className:"feed-container queue-detail-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0,minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t&&e.jsx(as,{queueId:t,onSubmitted:()=>ce()}),e.jsx(vt,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"queue-detail-header",style:{background:"var(--panel)",borderBottom:"1px solid var(--divider)",position:"relative"},children:[e.jsxs("div",{style:{height:120,background:"var(--panel)",width:"100%",position:"relative",overflow:"hidden"},children:[i.banner_stream_uid?i.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:i.banner_stream_uid.slice(4),alt:"Banner",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("video",{src:`https://videodelivery.net/${i.banner_stream_uid}/manifest/video.m3u8`,poster:`https://videodelivery.net/${i.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),$e&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:20,backdropFilter:"blur(4px)"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#fff",marginBottom:8},children:["Uploading... ",He,"%"]}),e.jsx("div",{style:{width:"60%",height:4,background:"rgba(255,255,255,0.2)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${He}%`,height:"100%",background:"#fff",transition:"width 0.1s ease"}})})]}),e.jsx(ze,{to:"/queues",style:{position:"absolute",top:12,left:12,width:36,height:36,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",color:"#fff",zIndex:10},title:"Back to queues",children:e.jsx(Bt,{size:18})}),me&&e.jsxs("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8,zIndex:10},children:[e.jsx("input",{ref:_e,type:"file",accept:"image/*",style:{display:"none"},onChange:qt}),e.jsxs("button",{className:"btn secondary",onClick:()=>{var n;return(n=_e.current)==null?void 0:n.click()},disabled:$e,style:{padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff"},title:i.banner_stream_uid?"Change Banner":"Add Banner",children:[e.jsx(ve,{size:14,style:{marginRight:6}}),i.banner_stream_uid?"Edit":"Add Banner"]}),e.jsxs("button",{ref:le,className:"btn secondary",onClick:wt,style:{padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff"},title:"Manage Queue",children:[e.jsx(Dt,{size:14,style:{marginRight:6}}),"Manage"]})]}),e.jsxs("div",{style:{position:"absolute",bottom:12,right:16,display:"flex",gap:8,alignItems:"center",zIndex:10},children:[(()=>{const n=(i.tags||i.type||"modding").split(",")[0].trim().toLowerCase(),p=n==="modder"?"modding":n==="subdivisions"?"subdivision":n;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)"},children:p})})(),Ye?e.jsx("button",{onClick:Je,disabled:f,className:`queue - status - badge ${i.is_open===1?"status-open":"status-closed"} `,title:i.is_open===1?"Close queue":"Open queue","aria-label":i.is_open===1?"Close queue":"Open queue",style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:i.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:i.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",cursor:"pointer",display:"flex",alignItems:"center"},children:i.is_open===1?"Open":"Closed"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:i.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:i.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",display:"inline-flex",alignItems:"center"},children:i.is_open===1?"Open":"Closed"})]})]}),e.jsxs("div",{style:{padding:"0 16px 16px",position:"relative"},children:[e.jsx("div",{style:{marginTop:-32,marginBottom:12,display:"flex",alignItems:"flex-end",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.filter(n=>n.joined_at!==null).sort((n,p)=>{const j=n.role==="owner"||n.user_id===(i==null?void 0:i.owner_id),E=p.role==="owner"||p.user_id===(i==null?void 0:i.owner_id);return j&&!E?-1:!j&&E?1:(p.joined_at||0)-(n.joined_at||0)}).slice(0,5).map((n,p)=>e.jsxs("div",{style:{position:"relative",marginLeft:p>0?-12:0,zIndex:10-p},onMouseEnter:()=>S(n.user_id),onMouseLeave:()=>S(null),children:[e.jsx(ze,{to:`/ profile / ${n.user_id} `,style:{display:"block",width:p===0?64:40,height:p===0?64:40,borderRadius:"50%",overflow:"hidden",border:"3px solid var(--panel)",background:"var(--bg)"},title:n.username,children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:p===0?24:14,fontWeight:600,color:"var(--muted)"},children:n.username.charAt(0).toUpperCase()})}),C===n.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[n.username," ",n.role!=="member"?`(${n.role})`:""]})]},n.user_id)),a.filter(n=>n.joined_at!==null).length>5&&e.jsxs("div",{style:{width:40,height:40,borderRadius:"50%",border:"3px solid var(--panel)",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,color:"var(--muted)",marginLeft:-12,zIndex:0},children:["+",a.filter(n=>n.joined_at!==null).length-5]})]})}),e.jsxs("div",{className:"col",style:{gap:2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[i.is_group?e.jsx(mt,{size:18,style:{color:"var(--muted)"}}):e.jsx(fe,{size:18,style:{color:"var(--muted)"}}),e.jsx("h1",{style:{fontSize:20,fontWeight:700,margin:0},children:i.name})]}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["by ",i.owner_username||((Ve=a.find(n=>n.user_id===i.owner_id))==null?void 0:Ve.username)||"Unknown"," • ",new Date(i.created_at*1e3).toLocaleDateString()]}),i.description&&e.jsx("div",{style:{fontSize:14,lineHeight:1.5,marginTop:8},children:e.jsx(Pe,{text:i.description})})]})]}),e.jsx(Oe,{tabs:[{id:"active",label:"Active"},{id:"archived",label:"Archived"}],activeTab:Se,onChange:n=>he(n),rightAction:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:N,onClick:()=>F(!m),style:{width:48,height:"100%",minHeight:48,background:m?"rgba(255,255,255,0.05)":"transparent",border:"none",color:i.is_open===1?"var(--text)":"var(--muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s",opacity:i.is_open===0?.5:1},onMouseEnter:n=>{m||(n.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:n=>{m||(n.currentTarget.style.backgroundColor="transparent")},title:i.is_open===1?"Submit a beatmap":"Queue is closed",children:e.jsx(ve,{size:18})}),t&&e.jsx(rs,{isOpen:m,onClose:()=>F(!1),onSubmitted:()=>ce(),queueId:t,isQueueOpen:i.is_open===1,anchorRef:N,rules:i.rules})]})})]}),i.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[Se==="active"&&e.jsx(e.Fragment,{children:c.filter(n=>!!!n.is_archived&&Ne[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):e.jsx("div",{className:"queue-submissions-grid",children:c.filter(n=>!!!n.is_archived&&Ne[n.status]).map(n=>e.jsx(De,{submission:n,canManage:!!me,isGroup:(i==null?void 0:i.is_group)===1,onUpdate:Xe,onDelete:p=>{h(j=>j.filter(E=>E.id!==p))}},n.id))})}),Se==="archived"&&e.jsx(e.Fragment,{children:c.filter(n=>!!n.is_archived&&Ne[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):e.jsx("div",{className:"queue-submissions-grid",children:c.filter(n=>!!n.is_archived&&Ne[n.status]).map(n=>e.jsx(De,{submission:n,canManage:!!me,isGroup:(i==null?void 0:i.is_group)===1,onUpdate:Xe,onDelete:p=>{h(j=>j.filter(E=>E.id!==p))}},n.id))})})]})}),_&&ye.createPortal(e.jsx("div",{className:"manage-overlay-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",backdropFilter:"blur(5px)",zIndex:9998,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:Ce,children:e.jsxs("div",{className:"manage-popup",style:{width:"100%",maxWidth:"800px",height:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",borderRadius:0},onClick:n=>n.stopPropagation(),children:[e.jsx(Oe,{tabs:[{id:"general",label:"General"},{id:"rules",label:"Rules"},{id:"members",label:"Members"}],activeTab:g,onChange:n=>U(n),style:{borderBottom:"1px solid var(--divider)"}}),e.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:e.jsxs("form",{onSubmit:Ge,style:{display:"flex",flexDirection:"column",flex:1},children:[g==="general"&&e.jsxs("div",{className:"col",style:{gap:20,padding:24},children:[e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Name"}),e.jsx("input",{type:"text",value:y,onChange:n=>w(n.target.value),placeholder:"e.g. My Modding Queue",required:!0,style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Short Description"}),e.jsx("input",{type:"text",value:L,onChange:n=>H(n.target.value),placeholder:"Brief description of your queue...",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),((o==null?void 0:o.is_mod)||(o==null?void 0:o.is_admin))&&e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:["modder","nominator","timing","audio","subdivision"].map(n=>{const p=B===n,j=ut[n==="modder"?"modding":n]||ut.modding;return e.jsx("button",{type:"button",onClick:()=>Q(n),style:{background:p?j.bg:"transparent",border:p?j.border:"1px solid var(--border)",color:p?j.color:"var(--muted)",padding:"8px 16px",borderRadius:0,fontSize:13,fontWeight:p?600:400,cursor:"pointer",textTransform:"capitalize",transition:"all 0.15s ease"},children:n},n)})})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",border:"1px solid var(--border)",marginTop:8},children:[e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:"Queue Status"}),e.jsx("div",{className:"muted",style:{fontSize:13},children:i.is_open?"Queue is currently open for submissions":"Queue is currently closed"})]}),e.jsx("button",{type:"button",onClick:Je,disabled:f,className:`btn ${i.is_open?"secondary":"primary"}`,style:{borderRadius:0},children:i.is_open?"Close Queue":"Open Queue"})]})]}),g==="rules"&&e.jsxs("div",{className:"col",style:{gap:12,padding:24,flex:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between"},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Rules (Markdown)"}),e.jsx("button",{type:"button",onClick:()=>ke(!0),className:"btn secondary",style:{fontSize:11,padding:"4px 8px",height:"auto",borderRadius:0},children:"Preview Rules"})]}),e.jsx("textarea",{value:T,onChange:n=>O(n.target.value),placeholder:"Enter your queue rules here... Markdown is supported.",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"none",flex:1,lineHeight:1.6}})]}),g==="members"&&e.jsxs("div",{className:"col",style:{gap:20,padding:24},children:[e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{className:"row",style:{gap:0},children:[e.jsx("div",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--muted)",pointerEvents:"none"},children:e.jsx(gt,{})}),e.jsx("input",{ref:M,type:"text",placeholder:"Search by username or ID...",value:$,onChange:n=>ae(n.target.value),onFocus:()=>{J.length>0&&K(!0)},style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px 10px 36px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),Z&&J.length>0&&e.jsx("div",{ref:te,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:-1,background:"var(--bg)",border:"1px solid var(--border)",borderTop:"none",maxHeight:250,overflowY:"auto",zIndex:100},children:J.map(n=>{const p=a.some(ie=>ie.user_id===n.id&&ie.joined_at),j=a.some(ie=>ie.user_id===n.id&&ie.invited_at&&!ie.joined_at),E=de.some(ie=>ie.user_id===n.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"8px 12px",gap:10,borderBottom:"1px solid var(--divider)"},children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,style:{width:24,height:24,borderRadius:"50%"}}):e.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"var(--panel)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10},children:n.username[0]}),e.jsxs("div",{className:"col",style:{flex:1,gap:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username}),e.jsxs("div",{className:"muted",style:{fontSize:11},children:["ID: ",n.id]})]}),e.jsxs("div",{className:"row",style:{gap:4},children:[p?e.jsx("span",{className:"badge",style:{fontSize:10,opacity:.6},children:"Member"}):j?e.jsx("span",{className:"badge",style:{fontSize:10,color:"var(--accent)",background:"rgba(var(--accent-rgb), 0.1)"},children:"Invited"}):e.jsx("button",{type:"button",onClick:()=>St(n.id),disabled:re,style:{background:"var(--primary)",border:"none",borderRadius:0,padding:"4px 10px",color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"},children:"Invite"}),me&&e.jsx("button",{type:"button",onClick:()=>E?Ke(n.id):kt(n.id),disabled:u||D===n.id,style:{background:"transparent",border:"1px solid var(--border)",padding:4,color:E?"var(--accent)":"var(--muted)",cursor:"pointer",display:"flex"},title:E?"Unblock":"Block",children:E?e.jsx(tt,{size:12}):e.jsx(Ot,{size:12})})]})]},n.id)})})]})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Current Members"}),e.jsx("div",{className:"col",style:{gap:0,border:"1px solid var(--border)"},children:a.length===0?e.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--muted)",fontSize:13},children:"No members yet"}):a.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"10px 12px",borderBottom:"1px solid var(--divider)",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,style:{width:32,height:32,borderRadius:"50%"}}):e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"var(--panel)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:n.username[0]}),e.jsxs("div",{className:"col",style:{gap:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username}),e.jsxs("div",{className:"muted",style:{fontSize:11,textTransform:"capitalize"},children:[n.role," ",n.invited_at&&!n.joined_at&&"(Pending Invite)"]})]})]}),e.jsx("div",{className:"row",style:{gap:8},children:n.user_id!==(o==null?void 0:o.id)&&(n.role!=="owner"||o.id===i.owner_id)&&e.jsx("button",{type:"button",onClick:()=>Nt(n.user_id),title:"Remove Member",style:{background:"transparent",border:"none",color:"var(--danger)",cursor:"pointer",padding:4},children:e.jsx(Te,{size:16})})})]},n.user_id))})]}),de.length>0&&e.jsxs("div",{className:"col",style:{gap:8,marginTop:10},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Blocked Users"}),e.jsx("div",{className:"col",style:{gap:0,border:"1px solid var(--border)"},children:de.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"10px 12px",borderBottom:"1px solid var(--divider)",justifyContent:"space-between"},children:[e.jsx("div",{className:"row",style:{alignItems:"center",gap:10},children:e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username})}),e.jsx("button",{type:"button",onClick:()=>Ke(n.user_id),title:"Unblock",style:{background:"transparent",border:"none",color:"var(--accent)",cursor:"pointer",padding:4},children:e.jsx(tt,{size:16})})]},n.user_id))})]})]})]})}),e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"1px solid var(--divider)",background:"rgba(255,255,255,0.02)"},children:[e.jsxs("div",{className:"row",style:{gap:12},children:[((o==null?void 0:o.is_mod)||(o==null?void 0:o.is_admin)||i.owner_id===(o==null?void 0:o.id))&&e.jsx("button",{type:"button",onClick:_t,disabled:ee||Y,style:{background:"transparent",border:"none",color:"var(--danger)",fontSize:13,fontWeight:600,cursor:"pointer",padding:0},children:"Delete Queue"}),jt&&i.owner_id!==(o==null?void 0:o.id)&&e.jsx("button",{type:"button",onClick:Ct,disabled:ee||Y,style:{background:"transparent",border:"none",color:"var(--danger)",fontSize:13,fontWeight:600,cursor:"pointer",padding:0},children:"Leave Queue"})]}),e.jsxs("div",{className:"row",style:{gap:12},children:[e.jsx("button",{type:"button",onClick:Ce,disabled:Y||ee,style:{background:"transparent",border:"1px solid var(--border)",color:"var(--text)",padding:"8px 20px",fontSize:13,fontWeight:600,cursor:"pointer",borderRadius:0},children:"Cancel"}),e.jsx("button",{type:"button",onClick:n=>{Y||Ge({preventDefault:()=>{}})},disabled:Y||ee,style:{background:"#667eea",border:"none",color:"#fff",padding:"8px 20px",fontSize:13,fontWeight:600,cursor:"pointer",borderRadius:0},children:Y?"Saving...":"Save Changes"})]})]})]})}),document.body),V&&ye.createPortal(e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>ke(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>ke(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6},children:e.jsx(os,{content:T||"*No rules defined.*"})})]})}),document.body),e.jsx("style",{children:`
/* Hide inline submit form on mobile – mobile uses floating FAB instead */
html.is - mobile.queue - submit - desktop - only {
  display: none;
}

        .queue - member - avatar {
  width: 32px;
  height: 32px;
  border - radius: 9999px;
  padding: 0;
  border: 1px solid rgba(255, 255, 255, 0.08);
  overflow: hidden;
  cursor: pointer;
  background: transparent;
  display: inline - flex;
  align - items: center;
  justify - content: center;
  text - decoration: none;
  transition: border - color 0.2s;
}
        .queue - member - avatar:hover {
  border - color: rgba(167, 139, 250, 0.4);
}
        .queue - member - avatar img {
  width: 100 %;
  height: 100 %;
  object - fit: cover;
  display: block;
}
        .queue - member - tooltip {
  position: absolute;
  bottom: calc(100 % + 8px);
  left: 50 %;
  transform: translateX(-50 %);
  background: rgba(18, 20, 24, 0.95);
  color: var(--text, #e5e7eb);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border - radius: 6px;
  padding: 6px 10px;
  font - size: 14px;
  white - space: nowrap;
  z - index: 10000;
  pointer - events: none;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
}
        .queue - member - tooltip::after {
  content: '';
  position: absolute;
  top: 100 %;
  left: 50 %;
  transform: translateX(-50 %);
  width: 0;
  height: 0;
  border - left: 5px solid transparent;
  border - right: 5px solid transparent;
  border - top: 5px solid rgba(18, 20, 24, 0.95);
}
        .queue - status - badge {
  display: inline - flex;
  align - items: center;
  gap: 6px;
  padding: 6px 12px;
  border - radius: 12px;
  font - size: 12px;
  font - weight: 600;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
  border: 1px solid;
  cursor: pointer;
  transition: all 0.2s;
  white - space: nowrap;
}
        .queue - status - badge:disabled {
  cursor: not - allowed;
  opacity: 0.6;
}
        .queue - status - badge.status - open {
  background: rgba(52, 211, 153, 0.15);
  border - color: rgba(52, 211, 153, 0.4);
  color: #34d399;
}
        .queue - status - badge.status - open: hover: not(: disabled) {
  background: rgba(52, 211, 153, 0.25);
  border - color: rgba(52, 211, 153, 0.5);
}
        .queue - status - badge.status - closed {
  background: rgba(245, 158, 11, 0.15);
  border - color: rgba(245, 158, 11, 0.4);
  color: #f59e0b;
}
        .queue - status - badge.status - closed: hover: not(: disabled) {
  background: rgba(245, 158, 11, 0.25);
  border - color: rgba(245, 158, 11, 0.5);
}
`})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function ws(){const{data:t=[],isLoading:s}=es(),i=ts(),d=ss(),{notify:a}=pe(),l=pt(),c=we(),[h,b]=r.useState(new Set),{data:v}=Re(),[o,x]=r.useState(!1),[m,F]=r.useState(!1),[N,C]=r.useState(!1),S=r.useRef(null),_=r.useRef(null),R=!!(v!=null&&v.is_admin||v!=null&&v.is_mod);ns(S,_,o,()=>x(!1));const y=async f=>{i.mutate(f,{onSuccess:()=>{}})},w=async f=>{f.startsWith("n:")&&d.mutate(f)},L=async()=>{const f=t.filter(q=>!q.read&&(q.id.startsWith("n:")||q.kind==="system"&&!q.id.startsWith("b:"))).map(q=>q.id);f.length>0&&(await y(f),a("All notifications marked as read",{variant:"success"}))},H=f=>{if(!f)return null;try{const q=JSON.parse(f);if((q==null?void 0:q.type)==="queue_invite"&&(q!=null&&q.queue_id))return q}catch{}return null},T=async(f,q)=>{if(!h.has(f.id)){b(g=>new Set(g).add(f.id));try{await z(I.moddi.queueAccept(String(q)),{method:"POST"}),a("Invitation accepted!",{variant:"success"}),w(f.id),l(`/queues/${q}`)}catch(g){a((g==null?void 0:g.message)||"Failed to accept invitation",{variant:"error"})}finally{b(g=>{const U=new Set(g);return U.delete(f.id),U})}}},O=async(f,q)=>{if(!h.has(f.id)){b(g=>new Set(g).add(f.id));try{await z(I.moddi.queueDeny(String(q)),{method:"POST"}),a("Invitation declined",{variant:"success"}),w(f.id)}catch(g){a((g==null?void 0:g.message)||"Failed to decline invitation",{variant:"error"})}finally{b(g=>{const U=new Set(g);return U.delete(f.id),U})}}},B=f=>H(f.text)?e.jsx(gt,{size:20,color:"#a78bfa"}):f.kind==="star"?e.jsx(it,{size:20,color:"#f59e0b"}):f.kind==="likes5"?e.jsx(at,{size:20,color:"#f472b6"}):f.kind==="comment"?e.jsx(fe,{size:20,color:"#60a5fa"}):f.kind==="inspiration"?e.jsx(fe,{size:20,color:"#7dd3fc"}):f.kind==="reaction"?e.jsx(rt,{size:20,color:"#10b981"}):f.id.startsWith("b:")?e.jsx(ot,{size:20,color:"#a78bfa"}):null,Q=f=>H(f.text)?"Queue Invitation":f.kind==="star"?"Star":f.kind==="likes5"?"Likes":f.kind==="comment"?"Comment":f.kind==="inspiration"?"Inspiration":f.kind==="reaction"?"Reaction":f.id.startsWith("b:")?"Global":"System",ee=t.filter(f=>!f.read&&!(f.id.startsWith("b:")&&f.expiresAt&&f.expiresAt<=Date.now())).length,W=async f=>{if(!(!(v!=null&&v.id)||N)){C(!0);try{const q={kind:f};f==="system"&&(q.text="Test system notification"),await z(I.admin.notificationsTest,{method:"POST",body:JSON.stringify(q)}),a("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(q){a((q==null?void 0:q.message)||"Failed to send test notification",{variant:"error"})}finally{C(!1),x(!1),F(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[R&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:S,className:"btn secondary",onClick:()=>x(!o),disabled:N,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(st,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(Be,{size:14,style:{transition:"transform 0.2s ease",transform:o?"rotate(180deg)":"rotate(0deg)"}})]}),o&&e.jsxs("div",{ref:_,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("star"),disabled:N,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("likes5"),disabled:N,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("comment"),disabled:N,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("inspiration"),disabled:N,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("reaction"),disabled:N,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("system"),disabled:N,children:"Test System"})]})]}),ee>0&&e.jsxs("button",{className:"btn secondary",onClick:L,children:[e.jsx(nt,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),R&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>F(!0),children:e.jsx(st,{size:22})}),e.jsx(Qe,{open:m,onClose:()=>F(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>W("star"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(it,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("likes5"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(at,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("comment"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(fe,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("inspiration"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(fe,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("reaction"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(rt,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("system"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(ot,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(f=>!(f.id.startsWith("b:")&&f.expiresAt&&f.expiresAt<=Date.now())).map(f=>{const q=({notif:g})=>{const[U,Y]=r.useState(0),[X,re]=r.useState(!1),ne=r.useRef(null),be=r.useRef(null),oe=r.useRef(null),$=r.useRef(null),ae=M=>{g.id.startsWith("n:")&&(ne.current=M.touches[0].clientX,$.current=M.touches[0].clientY,be.current=Date.now(),re(!1))},J=M=>{if(ne.current===null||$.current===null||!g.id.startsWith("n:"))return;const te=M.touches[0].clientX,le=M.touches[0].clientY,de=te-ne.current,xe=Math.abs(le-$.current);Math.abs(de)>xe&&(re(!0),Y(Math.max(-80,Math.min(0,de))))},G=()=>{if(ne.current===null)return;U<=-60&&w(g.id),Y(0),re(!1),ne.current=null,$.current=null,be.current=null},Z=g.id.startsWith("n:"),K=typeof g.targetPath=="string"&&g.targetPath.trim().length>0?g.targetPath.trim():null;return e.jsxs("div",{ref:oe,style:{position:"relative",background:g.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:K?"pointer":"default",opacity:g.read?.7:1,transform:`translateX(${U}px)`,transition:X?"none":"transform 0.2s ease",touchAction:Z?"pan-x pan-y":"pan-y"},onTouchStart:ae,onTouchMove:J,onTouchEnd:G,onTouchCancel:G,onClick:()=>{if(!(Math.abs(U)>10)){if(!g.read&&g.id.startsWith("n:")&&y([g.id]),K){l(K);return}g.videoId&&(window.location.hash="/feed")}},children:[Z&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(U)/80,pointerEvents:"none",zIndex:0},children:e.jsx(Te,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:B(g)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:Q(g)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(g.createdAt).toLocaleDateString()}),g.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:M=>{M.stopPropagation(),w(g.id)},style:{padding:4},children:e.jsx(Te,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const M=H(g.text);return M?`${M.inviter_username} invited you to join queue: ${M.queue_name}`:g.text||(g.kind==="star"?"One of your posts was starred!":g.kind==="likes5"?"One of your posts reached 5 likes!":g.kind==="comment"?"Someone commented on your post":g.kind==="inspiration"?"Someone is inspired by you!":g.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const M=H(g.text);return M&&!h.has(g.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:te=>{te.stopPropagation(),T(g,M.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(nt,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:te=>{te.stopPropagation(),O(g,M.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Pt,{size:14,style:{marginRight:4}}),"Decline"]})]}):M&&h.has(g.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),g.read&&g.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(g.readAt).toLocaleString()]})]})]})]},g.id)};return e.jsx(q,{notif:f},f.id)})})})]})}const Ae={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"},subdivisions:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},ls=["nominator","subdivision","subdivisions"];function ds({queue:t}){const i=(t.tags||t.type||"modding").split(",").map(l=>l.trim().toLowerCase()).filter(Boolean).map(l=>l==="modder"?"modding":l==="subdivisions"?"subdivision":l),d=i.find(l=>ls.includes(l)),a=d?[d==="subdivisions"?"subdivision":d]:i.filter(l=>Ae[l]);return e.jsx(ze,{to:`/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:l=>l.currentTarget.style.background="rgba(255,255,255,0.04)",onMouseLeave:l=>l.currentTarget.style.background="var(--panel)",children:[t.banner_stream_uid&&e.jsxs("div",{style:{position:"absolute",inset:0,zIndex:0,opacity:.12,pointerEvents:"none",overflow:"hidden"},children:[t.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:t.banner_stream_uid.slice(4),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("img",{src:`https://videodelivery.net/${t.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to bottom, transparent, var(--panel))"}})]}),e.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:4,flexWrap:"wrap",justifyContent:"flex-end",maxWidth:"50%"},children:[a.map(l=>{const c=Ae[l]||Ae.modding;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:c.bg,color:c.color,border:c.border},children:l},l)}),(t.is_open??1)===1?e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(16, 185, 129, 0.12)",color:"#10b981",border:"1px solid rgba(16, 185, 129, 0.2)"},children:"Open"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(239, 68, 68, 0.12)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)"},children:"Closed"})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(mt,{size:18}):e.jsx(fe,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(Pe,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12,position:"relative",zIndex:1},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const l=t.member_count||0;return l===0?null:l===1&&t.first_member_username?` and ${t.first_member_username}`:l>1?` & ${l} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function cs({isOpen:t,onClose:s,anchorRef:i}){const{notify:d}=pe(),{data:a}=Re(),{data:l=[]}=Fe(),c=yt(),[h,b]=r.useState(""),[v,o]=r.useState(""),[x,m]=r.useState(["modding"]),F=r.useRef(null),N=a?l.some(y=>y.owner_id===a.id):!1,C=(a==null?void 0:a.is_admin)||(a==null?void 0:a.is_mod);r.useEffect(()=>{if(!t)return;const y=w=>{const L=w.target;F.current&&!F.current.contains(L)&&(i!=null&&i.current)&&!i.current.contains(L)&&s()};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[t,s,i]);const S=y=>{if(Ee.includes(y)){x.includes(y)?m(["modding"]):m([y]);return}const w=x.filter(L=>ct.includes(L));if(w.includes(y)){const L=w.filter(H=>H!==y);if(L.length===0)return;m(L)}else m([...w,y])},_=async y=>{if(y.preventDefault(),N){d("You can only create one queue",{variant:"error"});return}if(!h.trim()){d("Queue name is required",{variant:"error"});return}c.mutate({name:h.trim(),description:v.trim()||null,is_group:!1,tags:x.join(",")},{onSuccess:()=>{d("Queue created!",{variant:"success"}),s(),b(""),o(""),m(["modding"])},onError:w=>{d((w==null?void 0:w.message)||"Failed to create queue",{variant:"error"})}})};if(!t)return null;const R=x.some(y=>Ee.includes(y));return e.jsx("div",{ref:F,className:"create-queue-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:N?e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsx("form",{onSubmit:_,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:h,onChange:y=>b(y.target.value),maxLength:100,required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("textarea",{placeholder:"Description (optional)",value:v,onChange:y=>o(y.target.value),maxLength:500,rows:2,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",outline:"none"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:ct.map(y=>{const w=x.includes(y),L=R;return e.jsx("button",{type:"button",onClick:()=>S(y),disabled:L,style:{background:w?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:w?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:w?"#667eea":L?"var(--muted)":"var(--text)",cursor:L?"not-allowed":"pointer",transition:"all 0.15s",fontWeight:w?500:400,opacity:L?.5:1,textTransform:"capitalize"},children:y},y)})}),C&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:10,color:"var(--muted)",marginTop:10,marginBottom:6,fontWeight:500},children:"Admin Only"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:Ee.map(y=>{const w=x.includes(y);return e.jsx("button",{type:"button",onClick:()=>S(y),style:{background:w?"rgba(139, 92, 246, 0.2)":"rgba(255,255,255,0.05)",border:w?"1px solid #a78bfa":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:w?"#a78bfa":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:w?500:400,textTransform:"capitalize"},children:y},y)})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:4},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c.isPending||!h.trim(),style:{background:h.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:h.trim()?"pointer":"not-allowed"},children:c.isPending?"Creating...":"Create"})]})]})})})}function us(){const[t,s]=se.useState(!1),[i,d]=se.useState(""),[a,l]=se.useState(""),{data:c=[]}=Fe(),{data:h}=Re(),{notify:b}=pe(),v=yt(),o=se.useMemo(()=>h?c.some(m=>m.owner_id===h.id):!1,[h,c]),x=m=>{if(m&&m.preventDefault(),o){b("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!i.trim()){b("Queue name is required",{variant:"error"});return}v.mutate({name:i.trim(),description:a.trim()||null,is_group:!1},{onSuccess:()=>{b("Queue created!",{variant:"success"}),s(!1),d(""),l("")},onError:F=>{b((F==null?void 0:F.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>s(!0),children:e.jsx(ve,{size:22})}),e.jsx(Qe,{open:t,onClose:()=>s(!1),children:e.jsxs("form",{onSubmit:x,className:"col",style:{gap:12},children:[o?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:i,onChange:m=>d(m.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:a,onChange:m=>l(m.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:v.isPending||o,children:v.isPending?"Creating...":"Create"})]})]})})]})}const ps=[{id:"queues",label:"Queues"},{id:"submissions",label:"Submissions"}];function Ss(){const[t,s]=Qt(),i=t.get("tab")||"queues",[d,a]=r.useState(i),{data:l=[],isLoading:c}=Fe(),{data:h}=Re(),{queueTypeFilters:b}=We(),{notify:v}=pe(),[o,x]=r.useState(!1),m=r.useRef(null),[F,N]=r.useState([]),[C,S]=r.useState(!1);r.useEffect(()=>{d==="submissions"&&_()},[d]);const _=async()=>{try{S(!0);const T=await z(I.moddi.mySubmissions);N(T.items)}catch(T){console.error(T),v("Failed to load submissions",{variant:"error"})}finally{S(!1)}},R=T=>{a(T),s(T==="queues"?{}:{tab:T})},y=r.useMemo(()=>l.filter(O=>{const B=O.type||"modder";return B==="modder"&&b.modder||(B==="nominator"||B==="subdivision")&&b.nominator||B==="timing"&&b.timing||B==="audio"&&b.audio}).sort((O,B)=>{const Q=(O.is_open??1)===1,ee=(B.is_open??1)===1;return Q&&!ee?-1:!Q&&ee?1:0}),[l,b]),w=T=>{N(O=>O.map(B=>B.id===T.id?{...B,...T}:B))},L=T=>{N(O=>O.filter(B=>B.id!==T))},H=e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:m,onClick:()=>x(!o),style:{width:48,height:"100%",minHeight:48,background:o?"rgba(255,255,255,0.05)":"transparent",border:"none",color:"var(--text)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},onMouseEnter:T=>{o||(T.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:T=>{o||(T.currentTarget.style.backgroundColor="transparent")},title:"Create queue",children:e.jsx(ve,{size:18})}),e.jsx(cs,{isOpen:o,onClose:()=>x(!1),anchorRef:m})]});return e.jsxs("div",{className:"feed-container unified-queues",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0},children:[e.jsx(Oe,{tabs:ps,activeTab:d,onChange:R,rightAction:H}),d==="queues"&&e.jsxs(e.Fragment,{children:[e.jsx(us,{}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsx("div",{className:"col",style:{gap:0},children:c?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):y.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):y.map(T=>e.jsx(ds,{queue:T},T.id))})}),e.jsx(vt,{context:"moddi-queues"})]}),d==="submissions"&&e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:C?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):F.length===0?e.jsxs("div",{style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx("button",{className:"btn",style:{marginTop:16},onClick:()=>R("queues"),children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:0},children:F.map(T=>e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(ze,{to:`/queues/${T.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:O=>O.currentTarget.style.textDecoration="underline",onMouseLeave:O=>O.currentTarget.style.textDecoration="none",children:T.queue_name}),T.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(T.created_at*1e3).toLocaleDateString()})]}),e.jsx(De,{submission:T,canManage:!1,allowSelfActions:!0,onUpdate:w,onDelete:L})]},T.id))})})]})}export{I as A,vt as D,ws as N,Pe as O,js as Q,Oe as T,Ss as U,xs as a,Re as b,pe as c,z as d,ns as e,ys as f,Zt as g,vs as h,ts as i,ss as j,bt as k,es as l,ht as m,fs as n,Vt as o,hs as p,bs as q,We as u};
