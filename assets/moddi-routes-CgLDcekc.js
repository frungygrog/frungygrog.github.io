import{s as wt,t as ze,v as Se,w as Pe,r as i,e as lt,R as se,j as e,c as Te,x as dt,l as ge,d as We,y as Be,z as kt,B as Nt,o as ct,u as Qe,q as ut,L as mt,C as _t,D as Ce,E as Ee,G as Ue,k as ve,f as Ke,H as Je,I as Ge,J as je,K as Ct,M as pt,N as Tt,O as zt,P as Xe,Q as Ze,A as Ve,h as et,S as tt,T as st}from"./vendor-react-CcFPULbg.js";import{a as q,A as F,g as It,u as xe,b as gt,P as ht,C as Ft,c as qt}from"./mappi-routes-DG7AcUwo.js";import{i as Mt,a as Rt,b as Lt,c as Et}from"./editor-components-COwEyuAl.js";import{B as ft}from"./editor-BdlnYnWr.js";const Pt=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",n=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{standard:n.has("standard")||n.size===0,taiko:n.has("taiko"),mania:n.has("mania"),catch:n.has("catch")}}catch{return{standard:!0,taiko:!1,mania:!1,catch:!1}}},Bt=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help",n=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{untagged:n.has("untagged")||n.size===0,help:n.has("help")||n.size===0}}catch{return{untagged:!0,help:!0}}},At=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",n=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{unchecked:n.has("unchecked")||n.size===0,accepted:n.has("accepted")||n.size===0,denied:n.has("denied")||n.size===0,finished:n.has("finished")||n.size===0,archived:n.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Ot=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",n=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{open:n.has("open")||n.size===0,closed:n.has("closed")}}catch{return{open:!0,closed:!1}}},Dt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Ut=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Ie=wt(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Pt(),tagFilters:Bt(),queueStatusFilters:At(),queueOpenFilters:Ot(),lastSection:Dt(),previousLocation:null,theme:Ut(),setMenuOpen:n=>t({menuOpen:n}),setMobileNavOpen:n=>t({mobileNavOpen:n}),setNotifOpen:n=>t({notifOpen:n}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:n=>{t({modeFilters:n});try{const c=Object.entries(n).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["standard"];localStorage.setItem("filter_modes",l.join(","))}catch{}},setTagFilters:n=>{t({tagFilters:n});try{const c=Object.entries(n).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["untagged","help"];localStorage.setItem("filter_moddi_tags",l.join(","))}catch{}},setQueueStatusFilters:n=>{t({queueStatusFilters:n});try{const c=Object.entries(n).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",l.join(","))}catch{}},setQueueOpenFilters:n=>{t({queueOpenFilters:n});try{const c=Object.entries(n).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["open"];localStorage.setItem("filter_queue_open",l.join(","))}catch{}},setLastSection:n=>{t({lastSection:n});try{n?localStorage.setItem("last_section",n):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:n=>{t({previousLocation:n})},setTheme:n=>{t({theme:n});try{localStorage.setItem("theme",n)}catch{}}}));function Wt(t=!0){return ze({queryKey:["notifications"],queryFn:async()=>{try{const n=await q(F.user.notifications);return Array.isArray(n.items)?n.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Qt(){return ze({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await q("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function os(){const{data:t=[]}=Wt();return t.filter(n=>n.kind==="system"&&n.id.startsWith("b:")&&(n.expiresAt||0)<=Date.now()?!1:!n.read).length}function $t(){const t=Se();return Pe({mutationFn:async n=>{await q(F.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:n})})},onSuccess:()=>{t.setQueryData(["notifications"],n=>(n==null?void 0:n.map(s=>({...s,read:!0})))||[])}})}function Ht(){const t=Se();return Pe({mutationFn:async n=>{const s=It();await q(F.user.deleteNotification(n),{method:"DELETE",headers:{"X-CSRF-Token":s}})},onSuccess:(n,s)=>{t.setQueryData(["notifications"],c=>(c==null?void 0:c.filter(l=>l.id!==s))||[]),t.setQueryData(["notifications","detailed"],c=>(c==null?void 0:c.filter(l=>l.id!==s))||[])}})}function Yt(t,n,s,c){i.useEffect(()=>{if(!s)return;const l=d=>{const m=d.target;n.current&&!n.current.contains(m)&&t.current&&!t.current.contains(m)&&c()};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[s,c,t,n])}function Fe(){return ze({queryKey:["user","me"],queryFn:async()=>{try{return await q(F.auth.me)}catch{return null}},staleTime:5*60*1e3})}function ls(t=!0){return ze({queryKey:["user","quota"],queryFn:async()=>{try{return await q(F.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function ds(){const t=Se();return Pe({mutationFn:async()=>{await q(F.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}const Kt=({context:t,onClose:n,style:s})=>{const c=lt(),l=se.useMemo(()=>{if(t)return t;const j=c.pathname;return j==="/mp/feed"?"mappi-feed":j==="/md/feed"?"moddi-feed":j==="/md/queues"?"moddi-queues":j.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,c.pathname]),{modeFilters:d,setModeFilters:m,tagFilters:C,setTagFilters:k,queueOpenFilters:N,setQueueOpenFilters:o,queueStatusFilters:y,setQueueStatusFilters:h}=Ie(),z=j=>{const I={...d,[j]:!d[j]};Object.values(I).some(Boolean)||(I.standard=!0),m(I);try{window.dispatchEvent(new Event("filterchange"))}catch{}},M=j=>{const I={...C,[j]:!C[j]};!I.untagged&&!I.help&&(I.help=!0),k(I);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},v=j=>{const I={...N,[j]:!N[j]};!I.open&&!I.closed&&(I.open=!0),o(I)},P=j=>{const I={...y,[j]:!y[j]};["unchecked","accepted","denied","finished"].some(Z=>I[Z])||(I.unchecked=!0),h(I)},_=({title:j,children:I})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:j}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:I})]}),T=({active:j,onClick:I,label:H})=>e.jsx("button",{type:"button",onClick:I,className:"chip","aria-pressed":j,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:j?"rgba(125,211,252,0.6)":"var(--border)",background:j?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:H});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{zIndex:1e4,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...s},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),n&&e.jsx("button",{className:"icon-link",onClick:n,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(Te,{size:16})})]}),l==="mappi-feed"&&e.jsxs(_,{title:"Gamemode",children:[e.jsx(T,{active:d.standard,onClick:()=>z("standard"),label:"Standard"}),e.jsx(T,{active:d.taiko,onClick:()=>z("taiko"),label:"Taiko"}),e.jsx(T,{active:d.mania,onClick:()=>z("mania"),label:"Mania"}),e.jsx(T,{active:d.catch,onClick:()=>z("catch"),label:"Catch"})]}),l==="moddi-feed"&&e.jsxs(_,{title:"Tags",children:[e.jsx(T,{active:C.untagged,onClick:()=>M("untagged"),label:"Untagged"}),e.jsx(T,{active:C.help,onClick:()=>M("help"),label:"Help"})]}),l==="moddi-queues"&&e.jsxs(_,{title:"Queues",children:[e.jsx(T,{active:N.open,onClick:()=>v("open"),label:"Open"}),e.jsx(T,{active:N.closed,onClick:()=>v("closed"),label:"Closed"})]}),l==="moddi-queue-detail"&&e.jsxs(_,{title:"Submissions",children:[e.jsx(T,{active:y.unchecked,onClick:()=>P("unchecked"),label:"Pending"}),e.jsx(T,{active:y.accepted,onClick:()=>P("accepted"),label:"Accepted"}),e.jsx(T,{active:y.denied,onClick:()=>P("denied"),label:"Denied"}),e.jsx(T,{active:y.finished,onClick:()=>P("finished"),label:"Finished"})]})]})},at={standard:Et,taiko:Lt,mania:Rt,catch:Mt},nt={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},Jt=({value:t,onChange:n})=>{const[s,c]=i.useState(!1),l=i.useRef(null);i.useEffect(()=>{if(!s)return;const m=k=>{l.current&&!l.current.contains(k.target)&&c(!1)},C=k=>{k.key==="Escape"&&c(!1)};return document.addEventListener("mousedown",m),document.addEventListener("keydown",C),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("keydown",C)}},[s]);const d=m=>e.jsxs("button",{className:`mode-option${m===t?" selected":""}`,onClick:()=>{n(m),c(!1)},role:"option","aria-selected":m===t,children:[e.jsx("img",{className:"mode-icon",src:at[m],width:24,height:24,alt:""}),e.jsx("span",{children:nt[m]})]},m);return e.jsxs("div",{className:"mode-select",ref:l,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":s,onClick:()=>c(m=>!m),children:[e.jsx("img",{className:"mode-icon",src:at[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:nt[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(d)})]})};function rt(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}function xt({section:t,onUpload:n,onPost:s,forceExpanded:c}){const{notify:l}=xe(),d=t==="mappi",[m,C]=i.useState(!1),[k,N]=i.useState(""),[o,y]=i.useState(null),[h,z]=i.useState(null),[M,v]=i.useState(!1),[P,_]=i.useState(""),T=i.useRef(0),[j,I]=i.useState(""),[H,Z]=i.useState("standard"),[R,ie]=i.useState(null),[f,D]=i.useState(0),[te,W]=i.useState(""),[x,S]=i.useState(""),[w,ee]=i.useState(null),[ce,X]=i.useState(""),[B,Q]=i.useState(""),[ae,ne]=i.useState(null),[Y,me]=i.useState(!1),[a,b]=i.useState(null),J=100*1024*1024,L=i.useMemo(()=>R?`${R.name}:${R.size}:${R.lastModified}`:null,[R]),[G,de]=i.useState(""),[$,he]=i.useState(!1),[ue,be]=i.useState([]),we=i.useRef(null);i.useEffect(()=>{T.current&&window.clearTimeout(T.current);const p=(k||"").trim();if(!p){_(""),y(null),z(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(p)){_(""),y(null),z(null);return}return T.current=window.setTimeout(async()=>{var E;try{let A;try{A=new URL(p)}catch{_("Invalid URL format");return}const le=A.hash.match(/#osu\/(\d+)/),K=le?le[1]:null;A.hash="";const Re={url:A.toString()};K&&(Re.beatmap_id=K);const V=await q(F.osu.resolveBeatmap+gt(Re),{requireAuth:!1}),fe=Array.isArray(V==null?void 0:V.diffs)?V.diffs:[];if(!fe.length&&!V.setId){_("No difficulties found"),y(null),z(null);return}if(y({setId:Number(V.setId)||0,beatmapId:V.beatmapId??null,title:String(V.title||""),artist:String(V.artist||""),mapper:String(V.mapper||""),diffs:fe}),fe.length>0){const Oe=Number.isFinite(Number(V.beatmapId))?Number(V.beatmapId):Number((E=fe[0])==null?void 0:E.id),pe=fe.find(De=>Number(De.id)===Oe)||fe[0],ye=rt(pe==null?void 0:pe.mode);z({beatmapId:Number(pe==null?void 0:pe.id)||null,version:String((pe==null?void 0:pe.version)||""),mode:ye}),d&&Z(ye)}else z(null);_("")}catch(A){const le=(A==null?void 0:A.message)||"Unknown error";_(`Failed to resolve: ${le}`),y(null),z(null)}},400),()=>{T.current&&window.clearTimeout(T.current)}},[k,d]);async function qe(){return S("info"),W("Requesting upload URL..."),await q(F.uploads.new,{method:"POST",body:JSON.stringify({description:j.slice(0,100),beatmap_url:k||void 0,size_bytes:(R==null?void 0:R.size)??void 0,mode:H,beatmapset_id:(o==null?void 0:o.setId)??void 0,beatmap_id:(h==null?void 0:h.beatmapId)??void 0,beatmap_version:(h==null?void 0:h.version)??void 0,beatmap_title:o?`${o.title}`:void 0,beatmap_artist:o?`${o.artist}`:void 0,beatmap_mapper:o?`${o.mapper}`:void 0})})}async function ke(p,O,E="form"){await new Promise((A,le)=>{const K=new XMLHttpRequest;if(K.open("POST",p),K.upload.onprogress=oe=>{oe.lengthComputable&&D(Math.round(oe.loaded/oe.total*100))},K.onload=()=>K.status>=200&&K.status<300?A():le(new Error(`Upload failed (${K.status}) ${K.responseText||""}`)),K.onerror=()=>le(new Error("Network error")),E==="form"){const oe=new FormData;oe.append("file",O,O.name),K.send(oe)}else K.setRequestHeader("Content-Type","application/octet-stream"),K.send(O)})}async function Me(){if(!(!R||!d)){if(R.size>J){X("File exceeds 100MB limit");return}if(typeof ae=="number"&&ae>60.5){Q("Clip exceeds 60s limit");return}L&&(me(!0),b(L)),D(0),S("info");try{const p=await qe();ee(p.streamUID);let O=p.streamUID;try{W("Uploading..."),await ke(p.uploadURL,R,"form")}catch(E){S("warn"),W(`Retrying upload... (${(E==null?void 0:E.message)||E})`);const A=await qe();ee(A.streamUID),O=A.streamUID,await ke(A.uploadURL,R,"binary")}S("info"),W("Processing...");for(let E=0;E<60;E++){await new Promise(A=>setTimeout(A,3e3));try{if((await q(F.videos.get(O),{requireAuth:!1})).status==="ready"){S("success"),W("Ready!"),l("Upload complete!",{variant:"success"}),ie(null),I(""),N(""),y(null),z(null),Z("standard"),D(0),ee(null),X(""),Q(""),ne(null),me(!1),b(null),n&&n();break}}catch{}}}catch(p){S("error"),W(p.message||"Error"),l(p.message||"Upload failed",{variant:"error"})}}}const Ne=async p=>{if(p.preventDefault(),!d){if(!G.trim()){l("Text is required",{variant:"error"});return}if(G.length>200){l("Text must be 200 characters or less",{variant:"error"});return}he(!0);try{const O=await q(F.moddi.posts,{method:"POST",body:JSON.stringify({text:G.trim(),beatmap_url:k.trim()||void 0,beatmapset_id:(o==null?void 0:o.setId)??void 0,beatmap_id:(h==null?void 0:h.beatmapId)??(o==null?void 0:o.beatmapId)??void 0,beatmap_version:(h==null?void 0:h.version)??void 0,tags:ue.length>0?ue.join(","):void 0})});if(O){console.log("Post created response:",O);const E=O==null?void 0:O.post;E?(!E.uid&&E.id&&(console.warn("Created post missing uid, using id as fallback:",E),E.uid=String(E.id)),s&&s(E)):s&&s(),l("Post created!",{variant:"success"}),de(""),N(""),y(null),z(null),_(""),v(!1),be([])}}catch{l("Failed to create post",{variant:"error"})}finally{he(!1)}}},_e=!!c||m;return e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:d?12:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:c?"default":"pointer",padding:"8px 12px",minHeight:36},onClick:()=>{c||C(!m)},children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:d?"Upload a clip":"Create a post!"}),_e?e.jsx(dt,{size:16}):e.jsx(ge,{size:16})]}),_e&&e.jsx("div",{style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.4,marginBottom:12},children:"Max: 60s, 100MB. Only osu! mapping content is permitted."}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Game mode:"}),e.jsx(Jt,{value:H,onChange:Z})]}),o?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[o.artist," – ",o.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",o.mapper]})]}),o.diffs.length>0&&e.jsx("select",{value:(h==null?void 0:h.beatmapId)??o.beatmapId??void 0,onChange:p=>{const O=Number(p.target.value),E=(o==null?void 0:o.diffs.find(A=>Number(A.id)===O))||null;if(E){const A=rt(E.mode);z({beatmapId:O,version:E.version,mode:A}),Z(A)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"4px 8px",fontSize:12},children:o.diffs.map(p=>e.jsxs("option",{value:p.id,children:[p.version," (",p.mode,")"]},p.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>v(!0),style:{padding:"6px 12px",fontSize:13},children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{y(null),z(null),N("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:k,onChange:p=>N(p.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:j,onChange:p=>I(p.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:64}}),P&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:P}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("input",{type:"file",accept:"video/*",onChange:p=>{var A;const O=((A=p.target.files)==null?void 0:A[0])||null;if(ie(O),ne(null),O&&O.size>J?X("File exceeds 100MB limit"):X(""),O)try{const le=URL.createObjectURL(O),K=document.createElement("video");K.preload="metadata",K.src=le,K.onloadedmetadata=()=>{URL.revokeObjectURL(le);const oe=Number.isFinite(K.duration)?K.duration:NaN;Number.isFinite(oe)&&ne(oe),Number.isFinite(oe)&&oe>60.5?Q("Clip exceeds 60s limit"):Q("")},K.onerror=()=>{URL.revokeObjectURL(le),ne(null)}}catch{ne(null)}else Q("");const E=O?`${O.name}:${O.size}:${O.lastModified}`:null;E&&E!==a&&me(!1)},style:{flex:1,minWidth:0}}),e.jsx("button",{className:"btn",onClick:Me,disabled:!R||!!ce||!!B||Y,style:{flexShrink:0},children:"Upload"})]}),ce&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:ce}),B&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:B}),R&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Selected: ",R.name," • ",(R.size/1024/1024).toFixed(1)," MB",Y&&a===L?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(locked)"}):null]}),(f>0||te)&&e.jsxs("div",{className:"upload-status",children:[te&&e.jsx("div",{className:`chip ${x||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:te}),f>0&&e.jsx("div",{className:"progress",style:{marginTop:8},"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":f,children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,Math.max(0,f))}%`}})})]}),w&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Stream UID: ",w]})]})]}):e.jsx("form",{onSubmit:Ne,children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("textarea",{ref:we,placeholder:"Ask for feedback! Or, say anything! Woo! (max 200 chars)",value:G,onChange:p=>de(p.target.value),maxLength:200,rows:2,style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:50}}),o?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[o.artist," – ",o.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",o.mapper]})]}),o.diffs.length>0&&e.jsx("select",{value:(h==null?void 0:h.beatmapId)??o.beatmapId??void 0,onChange:p=>{const O=Number(p.target.value),E=(o==null?void 0:o.diffs.find(A=>Number(A.id)===O))||null;E&&z({beatmapId:O,version:E.version,mode:String(E.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:o.diffs.map(p=>e.jsxs("option",{value:p.id,children:[p.version," (",p.mode,")"]},p.id))})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:k,onChange:p=>N(p.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),P&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:P}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("span",{className:"muted",style:{fontSize:11},children:"Tags:"}),e.jsx("button",{type:"button",onClick:()=>{ue.includes("help")?be(ue.filter(p=>p!=="help")):be([...ue,"help"])},style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:ue.includes("help")?"rgba(234, 179, 8, 0.2)":"rgba(255,255,255,0.05)",border:ue.includes("help")?"1px solid rgba(234, 179, 8, 0.4)":"1px solid rgba(255,255,255,0.12)",color:ue.includes("help")?"#fbbf24":"var(--text)",fontWeight:500,lineHeight:1.2,cursor:"pointer",transition:"all 0.15s ease"},children:"Help"})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>v(!0),children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{y(null),z(null),N("")},children:"Clear"})]}),e.jsx("button",{type:"submit",className:"btn",disabled:$||!G.trim()||G.length>200,children:$?"Posting...":"Post"})]})]})})}),M&&o&&e.jsx(ft,{open:M,onClose:()=>v(!1),downloadUrl:F.osu.downloadBeatmapset(o.setId),beatmapId:(h==null?void 0:h.beatmapId)??o.beatmapId??void 0,beatmapVersion:h==null?void 0:h.version})]})}function Ae({open:t,onClose:n,children:s}){const c=i.useRef(null),l=i.useRef(null),d=i.useRef(!1),m=o=>{var y;l.current=((y=o.touches[0])==null?void 0:y.clientY)??null,d.current=!1},C=o=>{var M,v;if(l.current==null)return;const y=((M=o.touches[0])==null?void 0:M.clientY)??null;if(y==null)return;const h=y-l.current;(((v=c.current)==null?void 0:v.scrollTop)??0)<=0&&h>60?d.current=!0:d.current=!1},k=()=>{d.current&&n(),l.current=null,d.current=!1};if(!t)return null;const N=e.jsx("div",{className:"mobile-upload-overlay",onClick:n,children:e.jsx("div",{ref:c,className:"mobile-upload-sheet",onClick:o=>o.stopPropagation(),onTouchStart:m,onTouchMove:C,onTouchEnd:k,children:s})});return We.createPortal(N,document.body)}function Gt({section:t,onUpload:n,onPost:s}){const[c,l]=se.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":t==="mappi"?"Upload clip":"New post",title:t==="mappi"?"Upload clip":"New post",onClick:()=>l(!0),children:e.jsx(Be,{size:22})}),e.jsx(Ae,{open:c,onClose:()=>l(!1),children:e.jsx("div",{style:{paddingTop:6},children:e.jsx(xt,{section:t,forceExpanded:!0,onUpload:()=>{n==null||n(),l(!1)},onPost:d=>{s==null||s(d),l(!1)}})})})]})}function Xt(){const[t,n]=se.useState(!1);return se.useEffect(()=>{var l;const s=window.matchMedia("(max-width: 768px)"),c=()=>n(s.matches);return c(),(l=s.addEventListener)==null||l.call(s,"change",c),()=>{var d;return(d=s.removeEventListener)==null?void 0:d.call(s,"change",c)}},[]),t}const $e=({context:t})=>{const n=Xt(),[s,c]=se.useState(!1),l=se.useRef(null),d=12,m=18,o=84+56+12;return se.useEffect(()=>{const y=h=>{if(!s)return;const z=h.target;if(l.current&&l.current.contains(z))return;const M=document.getElementById("desktop-filters-panel");M&&M.contains(z)||c(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[s]),n?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:l,className:"desktop-fab",onClick:()=>c(y=>!y),"aria-haspopup":"dialog","aria-expanded":s,title:"Filters","aria-label":"Filters",children:e.jsx(kt,{size:22})}),s&&e.jsx("div",{id:"desktop-filters-panel",style:{position:"fixed",right:m,bottom:o,zIndex:1e4},children:e.jsx(Kt,{context:t,onClose:()=>c(!1),style:{maxHeight:`calc(100vh - ${o+d}px)`,maxWidth:`calc(100vw - ${m+d}px)`,overflow:"auto"}})})]})};function Zt(){const{data:t}=Fe(),{tagFilters:n}=Ie();return Nt({queryKey:["moddi","feed",n],queryFn:async({pageParam:s=0})=>{const c=new URLSearchParams({limit:"20",offset:String(s)}),l=`${F.moddi.posts}?${c.toString()}`;return await q(l)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,c)=>{var m;const l=c.reduce((C,k)=>{var N;return C+(((N=k.items)==null?void 0:N.length)||0)},0);return(((m=s.items)==null?void 0:m.length)||0)===20?l:void 0}})}function cs(){const t=lt(),n=Se(),{data:s}=Fe(),{tagFilters:c}=Ie(),{data:l,fetchNextPage:d,hasNextPage:m,isFetching:C,isFetchingNextPage:k,refetch:N}=Zt(),o=i.useMemo(()=>l!=null&&l.pages?l.pages.flatMap(_=>(_.items||[]).map(j=>({...j,user_id:j.user_id??0,username:j.username||"Unknown",avatar_url:j.avatar_url||null,text:j.text??null,uid:j.uid||String(j.id||""),reactions_count:Number(j.reactions_count??0),reacted_by_me:j.reacted_by_me??!1,comments_count:Number(j.comments_count??0)}))):[],[l]),y=i.useMemo(()=>o.filter(_=>{const T=_.tags?typeof _.tags=="string"?_.tags.split(",").map(H=>H.trim()):[]:[],j=!_.tags||T.length===0,I=T.includes("help");return c.untagged&&c.help?!0:c.untagged&&!c.help?j:!c.untagged&&c.help?I:!1}),[o,c]);i.useEffect(()=>{t.pathname==="/md/feed"&&N()},[t.pathname,N]),i.useEffect(()=>{const _=()=>{N()};return window.addEventListener("moddifilterchange",_),()=>window.removeEventListener("moddifilterchange",_)},[N]);const h=_=>{n.setQueryData(["moddi","feed"],T=>T&&{...T,pages:T.pages.map(j=>({...j,items:j.items.map(I=>I.id===_.id?_:I)}))})},z=_=>{n.setQueryData(["moddi","feed"],T=>T&&{...T,pages:T.pages.map(j=>({...j,items:j.items.filter(I=>I.id!==_)}))})},M=_=>{_&&n.setQueryData(["moddi","feed"],T=>{if(!T)return T;const j={..._,user_id:_.user_id??0,username:_.username||"Unknown",avatar_url:_.avatar_url||null,text:_.text??null,uid:_.uid||String(_.id||""),reactions_count:Number(_.reactions_count??0),reacted_by_me:_.reacted_by_me??!1,comments_count:Number(_.comments_count??0)};return{...T,pages:T.pages.map((I,H)=>H===0?{...I,items:[j,...I.items||[]]}:I)}}),n.invalidateQueries({queryKey:["moddi","feed"]}),N()},v=C&&!k,P=m??!1;return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Say anything! If you want help, tag it accordingly and others can raise their hand."}),e.jsx(xt,{section:"moddi",onPost:M})]}),e.jsx(Gt,{section:"moddi",onPost:M}),e.jsx($e,{context:"moddi-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[y.length===0&&!v&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to post!"}),y.map(_=>e.jsx(ht,{post:_,section:"moddi",onUpdate:h,onDelete:z,me:s},_.id)),y.length>0&&P&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>d(),disabled:k,children:k?"Loading...":"Load more"})})]})})]})}function us(){const{uid:t}=ct(),n=Qe(),[s,c]=i.useState(null),[l,d]=i.useState([]),[m,C]=i.useState(!0),[k,N]=i.useState(null),[o,y]=i.useState(""),[h,z]=i.useState(null),[M,v]=i.useState(!1),{notify:P}=xe();i.useEffect(()=>{q(F.auth.me,{requireAuth:!1}).then(f=>N(f)).catch(()=>{})},[]);const _=async()=>{if(!t||t==="null"||t==="undefined"){P("Invalid post identifier",{variant:"error"}),n("/md/feed");return}C(!0);try{const f=await q(F.moddi.post(t),{requireAuth:!1}),D={...f,user_id:f.user_id??0,username:f.username||"Unknown",avatar_url:f.avatar_url||null,uid:f.uid||String(f.id)||t,text:f.text??null,beatmap_url:f.beatmap_url??null,beatmapset_id:f.beatmapset_id??null,beatmap_id:f.beatmap_id??null,beatmap_version:f.beatmap_version??null,tags:f.tags??null,reactions_count:Number(f.reactions_count??0),reacted_by_me:f.reacted_by_me??!1,comments_count:Number(f.comments_count??0)};c(D)}catch{P("Failed to load post",{variant:"error"}),n("/md/feed")}finally{C(!1)}},T=async()=>{if(s!=null&&s.id)try{const f=await q(F.moddi.postComments(s.id),{requireAuth:!1});d(f.items||[])}catch{}};i.useEffect(()=>{_()},[t]),i.useEffect(()=>{s!=null&&s.id&&T()},[s==null?void 0:s.id]);const j=f=>{c(f)},I=()=>{n("/md/feed")},H=async f=>{if(f.preventDefault(),!(!o.trim()||!(s!=null&&s.id))){v(!0);try{await q(F.moddi.postComments(s.id),{method:"POST",body:JSON.stringify({text:o.trim(),parent_id:h||void 0})}),y(""),z(null),T(),_(),P("Comment posted!",{variant:"success"})}catch(D){P((D==null?void 0:D.message)||"Failed to post comment",{variant:"error"})}finally{v(!1)}}},Z=f=>{d(D=>D.filter(te=>te.id!==f))};if(m)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!s)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const R=l.filter(f=>!f.parent_id),ie=new Map;return l.filter(f=>f.parent_id).forEach(f=>{const D=f.parent_id;ie.has(D)||ie.set(D,[]),ie.get(D).push(f)}),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"post-detail-header",style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>n("/md/feed"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(ut,{size:20})}),e.jsx("span",{className:"hide-on-mobile",style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx(ht,{post:s,section:"moddi",onUpdate:j,onDelete:I,me:k})}),k&&!h&&e.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid var(--border-subtle)",borderRadius:6},children:e.jsxs("form",{onSubmit:H,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:o,onChange:f=>y(f.target.value),rows:1,style:{flex:1,background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:f=>{const D=f.target;D.style.height="auto",D.style.height=`${Math.min(D.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:M||!o.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:M?"...":"Post"})]})}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:R.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:R.map(f=>e.jsx(Ft,{comment:f,replies:ie.get(f.id)||[],me:k,section:"moddi",onReply:D=>z(D),onDelete:Z,replyingTo:h,replyText:o,onReplyTextChange:y,onReplySubmit:H,posting:M,onCancelReply:()=>{z(null),y("")},repliesMap:ie},f.id))})})]})}function Vt({queue:t}){return e.jsx(mt,{to:`/md/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",cursor:"pointer"},onMouseEnter:n=>n.currentTarget.style.background="rgba(255,255,255,0.02)",onMouseLeave:n=>n.currentTarget.style.background="rgba(255,255,255,0.01)",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(_t,{size:18}):e.jsx(Ce,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name}),(t.is_open??1)===1?e.jsx(Ee,{size:18,style:{color:"#10b981"}}):e.jsx(Ue,{size:18,style:{color:"#ef4444"}})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:t.description}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function He(){return ze({queryKey:["moddi","queues"],queryFn:async()=>{const t=await q(F.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function bt(){const t=Se();return Pe({mutationFn:async n=>{var s;return await q(F.moddi.queues,{method:"POST",body:JSON.stringify({name:n.name.trim(),description:((s=n.description)==null?void 0:s.trim())||null,is_group:n.is_group??!1})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function es(){const[t,n]=se.useState(!1),[s,c]=se.useState(""),[l,d]=se.useState(""),{data:m=[]}=He(),{data:C}=Fe(),{notify:k}=xe(),N=bt(),o=se.useMemo(()=>C?m.some(h=>h.owner_id===C.id):!1,[C,m]),y=h=>{if(h&&h.preventDefault(),o){k("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!s.trim()){k("Queue name is required",{variant:"error"});return}N.mutate({name:s.trim(),description:l.trim()||null,is_group:!1},{onSuccess:()=>{k("Queue created!",{variant:"success"}),n(!1),c(""),d("")},onError:z=>{k((z==null?void 0:z.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>n(!0),children:e.jsx(Be,{size:22})}),e.jsx(Ae,{open:t,onClose:()=>n(!1),children:e.jsxs("form",{onSubmit:y,className:"col",style:{gap:12},children:[o?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:s,onChange:h=>c(h.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:l,onChange:h=>d(h.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>n(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:N.isPending||o,children:N.isPending?"Creating...":"Create"})]})]})})]})}function ms(){const{data:t=[],isLoading:n}=He(),{data:s}=Fe(),{queueOpenFilters:c}=Ie(),l=bt(),{notify:d}=xe(),[m,C]=i.useState(!1),[k,N]=i.useState(""),[o,y]=i.useState(""),h=i.useMemo(()=>s?t.some(v=>v.owner_id===s.id):!1,[s,t]),z=async v=>{if(v.preventDefault(),h){d("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!k.trim()){d("Queue name is required",{variant:"error"});return}l.mutate({name:k.trim(),description:o.trim()||null,is_group:!1},{onSuccess:()=>{d("Queue created!",{variant:"success"}),C(!1),N(""),y("")},onError:P=>{d((P==null?void 0:P.message)||"Failed to create queue",{variant:"error"})}})},M=se.useMemo(()=>t.filter(v=>{const P=(v.is_open??1)===1;return c.open&&c.closed?!0:c.open&&!c.closed?P:!c.open&&c.closed?!P:!0}),[t,c]);return e.jsxs("div",{className:"feed-container queues-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx(es,{}),e.jsx($e,{context:"moddi-queues"}),e.jsx("div",{className:"feed-header",children:e.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:0},children:h?e.jsx("div",{style:{padding:"12px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>C(!m),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Create a queue!"}),m?e.jsx(dt,{size:16}):e.jsx(ge,{size:16})]}),m&&e.jsx("form",{onSubmit:z,style:{padding:"12px",borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:k,onChange:v=>N(v.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:o,onChange:v=>y(v.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:v=>{v.stopPropagation(),C(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:l.isPending||h,onClick:v=>v.stopPropagation(),children:l.isPending?"Creating...":"Create"})]})]})})]})})}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsx("div",{className:"col",style:{gap:0},children:n?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):M.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):M.map(v=>e.jsx(Vt,{queue:v},v.id))})})]})}function ts({beatmapMeta:t,beatmapVersion:n}){const s=i.useRef(null),c=i.useRef(null),[l,d]=i.useState(!1),[m,C]=i.useState(!1),[k,N]=i.useState(0);i.useEffect(()=>{if(s.current&&c.current){const h=s.current.offsetWidth,z=c.current.scrollWidth;N(z),C(z>h)}},[t,n]);const o=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",n?` [${n}]`:""]}):n?`[${n}]`:"Beatmap",y=k>0?Math.max(3,k/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:s,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:m?"pointer":"default"},onMouseEnter:()=>m&&d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("span",{ref:c,style:{display:"inline-block",animation:l&&m?`beatmap-marquee ${y}s linear infinite`:"none"},children:o}),l&&m&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:o})]})]})}function it({submission:t,canManage:n,onUpdate:s,onDelete:c,isGroup:l=!1}){const[d,m]=i.useState(!1),[C,k]=i.useState(!1),[N,o]=i.useState(null),[y,h]=i.useState(t.beatmapset_id),[z,M]=i.useState(t.beatmap_id),[v,P]=i.useState(!1),[_,T]=i.useState(!1),[j,I]=i.useState(null),[H,Z]=i.useState(!1),[R,ie]=i.useState(t.acknowledgments||[]),[f,D]=i.useState(t.acknowledged_by_me||!1),te=i.useRef(null),W=i.useRef(null),x=i.useRef(null),{notify:S}=xe();i.useEffect(()=>{ie(t.acknowledgments||[]),D(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),i.useEffect(()=>{if(t.beatmap_url)try{const a=new URL(t.beatmap_url),b=a.pathname.match(/\/beatmapsets\/(\d+)/);if(b&&!t.beatmapset_id){const L=Number(b[1]);isNaN(L)||h(L)}const J=a.hash.match(/#osu\/(\d+)/);if(J&&!t.beatmap_id){const L=Number(J[1]);isNaN(L)||M(L)}}catch(a){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,a)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),i.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:y,extracted_beatmap_id:z,beatmap_version:t.beatmap_version})},[t.id,y,z]),i.useEffect(()=>{if(!t.beatmap_url||N&&y)return;let a=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let b;try{b=new URL(t.beatmap_url)}catch($){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,$);return}const J=b.hash.match(/#osu\/(\d+)/),L=J?J[1]:null;b.hash="";const de={url:b.toString()};if(L?de.beatmap_id=L:t.beatmap_id&&(de.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",de),!a){const $=await q(F.osu.resolveBeatmap+gt(de),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",$),$.setId&&!y&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",$.setId),h(Number($.setId))),($.title||$.artist)&&o({title:$.title||null,artist:$.artist||null,mapper:$.mapper||null})}}catch(b){console.error("[QueueSubmission] Error fetching beatmap metadata:",b)}})(),()=>{a=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,N,y]),i.useEffect(()=>{if(!v||!x.current){I(null);return}const a=()=>{if(x.current){const b=x.current.getBoundingClientRect();I({top:b.bottom+8,right:window.innerWidth-b.right})}};return a(),window.addEventListener("resize",a),window.addEventListener("scroll",a,!0),()=>{window.removeEventListener("resize",a),window.removeEventListener("scroll",a,!0)}},[v]),i.useEffect(()=>{if(!C)return;const a=b=>{const J=b.target;te.current&&!te.current.contains(J)&&!J.closest("[data-status-dropdown]")&&k(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[C]),i.useEffect(()=>{if(!v)return;const a=b=>{W.current&&!W.current.contains(b.target)&&x.current&&!x.current.contains(b.target)&&P(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[v]);const w=async a=>{if(!d){m(!0);try{await q(F.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:a})});const b={...t,status:a,updated_at:Math.floor(Date.now()/1e3)};s&&s(b),S("Status updated",{variant:"success"})}catch{S("Failed to update status",{variant:"error"})}finally{m(!1),k(!1)}}},ee=async()=>{if(!d){m(!0);try{const a=!!t.is_archived;await q(F.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!a})});const b={...t,is_archived:a?0:1,updated_at:Math.floor(Date.now()/1e3)};s&&s(b),S(a?"Unarchived":"Archived",{variant:"success"})}catch{S("Failed to update archive status",{variant:"error"})}finally{m(!1)}}},ce=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!d){m(!0);try{await q(F.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),S("Submission deleted",{variant:"success"}),c&&c(t.id)}catch{S("Failed to delete submission",{variant:"error"})}finally{m(!1)}}},X=async()=>{if(!H){Z(!0);try{if(f){if(await q(F.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),D(!1),S("Unacknowledged",{variant:"info"}),s){const a={...t,acknowledged_by_me:!1};s(a)}}else if(await q(F.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),D(!0),S("Acknowledged",{variant:"success"}),s){const a={...t,acknowledged_by_me:!0};s(a)}}catch{S("Failed to update acknowledgment",{variant:"error"})}finally{Z(!1)}}},B={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},Q={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},ae=y||t.beatmapset_id,ne=ae?`https://assets.ppy.sh/beatmaps/${ae}/covers/card.jpg`:null;i.useEffect(()=>{ne?console.log("[QueueSubmission] Background image URL:",ne,"for beatmapset_id:",ae):console.log("[QueueSubmission] No background image URL - beatmapset_id:",ae,"submission.beatmapset_id:",t.beatmapset_id)},[ne,ae,t.beatmapset_id]);const Y=!!t.is_archived,me=n?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),P(b=>!b)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ge,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),P(b=>!b)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ge,{size:12,style:{marginLeft:4,opacity:.7}})]})}),R&&R.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[R.slice(0,5).map((a,b)=>a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:a.username,title:a.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:b>0?-8:0,zIndex:R.length-b,position:"relative",cursor:"pointer"}},a.user_id):e.jsx("div",{title:a.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:b>0?-8:0,zIndex:R.length-b,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:a.username.charAt(0).toUpperCase()},a.user_id)),R.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${R.length-5} more`,children:["+",R.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:X,disabled:H||d,title:f?"Unacknowledge":"Acknowledge",style:{color:f?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:f?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:a=>{!H&&!d&&(a.currentTarget.style.background=f?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=f?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ke,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ee,disabled:d,title:Y?"Unarchive":"Archive",style:{color:Y?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:Y?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:a=>{d||(a.currentTarget.style.background=Y?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=Y?"rgba(99, 102, 241, 0.1)":"transparent"},children:Y?e.jsx(Je,{size:16}):e.jsx(Ge,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ce,disabled:d,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:a=>{d||(a.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:a=>{a.currentTarget.style.background="transparent"},children:e.jsx(je,{size:16})}),e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:te,onClick:()=>k(!C),disabled:d,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:B[t.status]+"15",border:`1.5px solid ${B[t.status]}50`,color:B[t.status],whiteSpace:"nowrap",cursor:d?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:d?.6:1},onMouseEnter:a=>{d||(a.currentTarget.style.background=B[t.status]+"25",a.currentTarget.style.borderColor=B[t.status]+"70",a.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:a=>{a.currentTarget.style.background=B[t.status]+"15",a.currentTarget.style.borderColor=B[t.status]+"50",a.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:Q[t.status]}),e.jsx(ge,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:C?"rotate(180deg)":"rotate(0deg)"}})]}),C&&We.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const a=document.querySelector(".queue-submission-status-btn-desktop button"),b=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),J=document.querySelector(".queue-submission-status-btn-mobile button");let L=null;if(a&&window.getComputedStyle(a.parentElement).display!=="none"?L=a:J&&window.getComputedStyle(J.parentElement).display!=="none"?L=J:b&&window.getComputedStyle(b.parentElement).display!=="none"?L=b:te.current&&(L=te.current),L){const G=L.getBoundingClientRect();return{top:G.bottom+6,right:window.innerWidth-G.right}}return{top:0,right:0}})()},onClick:a=>a.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(a=>e.jsx("button",{onClick:()=>w(a),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:a===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:a===t.status?B[a]+"15":"transparent",color:a===t.status?B[a]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:b=>{a!==t.status&&(b.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:b=>{a!==t.status&&(b.currentTarget.style.background="transparent")},children:Q[a]},a))}),document.body)]})]}):e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),P(b=>!b)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ge,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),P(b=>!b)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ge,{size:12,style:{marginLeft:4,opacity:.7}})]})})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:Y?.6:1},children:[ne&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ne,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.35,zIndex:0,pointerEvents:"none"},onError:a=>{a.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.75) 100%)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:x,className:"chip-btn link",onClick:a=>{a.preventDefault(),a.stopPropagation(),P(b=>!b)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ge,{size:12,style:{marginLeft:4,opacity:.7}})]})}),n&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[R&&R.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[R.slice(0,5).map((a,b)=>a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:a.username,title:a.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:b>0?-8:0,zIndex:R.length-b,position:"relative",cursor:"pointer"}},a.user_id):e.jsx("div",{title:a.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:b>0?-8:0,zIndex:R.length-b,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:a.username.charAt(0).toUpperCase()},a.user_id)),R.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${R.length-5} more`,children:["+",R.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:X,disabled:H||d,title:f?"Unacknowledge":"Acknowledge",style:{color:f?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:f?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:a=>{!H&&!d&&(a.currentTarget.style.background=f?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=f?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ke,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ee,disabled:d,title:Y?"Unarchive":"Archive",style:{color:Y?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:Y?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:a=>{d||(a.currentTarget.style.background=Y?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=Y?"rgba(99, 102, 241, 0.1)":"transparent"},children:Y?e.jsx(Je,{size:16}):e.jsx(Ge,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ce,disabled:d,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:a=>{d||(a.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:a=>{a.currentTarget.style.background="transparent"},children:e.jsx(je,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:te,onClick:()=>k(!C),disabled:d,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:B[t.status]+"15",border:`1.5px solid ${B[t.status]}50`,color:B[t.status],whiteSpace:"nowrap",cursor:d?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:d?.6:1},onMouseEnter:a=>{d||(a.currentTarget.style.background=B[t.status]+"25",a.currentTarget.style.borderColor=B[t.status]+"70",a.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:a=>{a.currentTarget.style.background=B[t.status]+"15",a.currentTarget.style.borderColor=B[t.status]+"50",a.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:Q[t.status]}),e.jsx(ge,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:C?"rotate(180deg)":"rotate(0deg)"}})]})})]}),n&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>k(!C),disabled:d,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:B[t.status]+"15",border:`1.5px solid ${B[t.status]}50`,color:B[t.status],whiteSpace:"nowrap",cursor:d?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:d?.6:1},onMouseEnter:a=>{d||(a.currentTarget.style.background=B[t.status]+"25",a.currentTarget.style.borderColor=B[t.status]+"70",a.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:a=>{a.currentTarget.style.background=B[t.status]+"15",a.currentTarget.style.borderColor=B[t.status]+"50",a.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:Q[t.status]}),e.jsx(ge,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:C?"rotate(180deg)":"rotate(0deg)"}})]})}),!n&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:B[t.status]+"15",border:`1.5px solid ${B[t.status]}50`,color:B[t.status],whiteSpace:"nowrap"},children:Q[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx(ts,{beatmapMeta:N,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:t.message}),me]})]}),v&&j&&t.beatmap_url&&e.jsxs("div",{ref:W,style:{position:"fixed",top:j.top,right:j.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>P(!1),children:[e.jsx(ve,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ae&&e.jsx("button",{className:"menu-item",onClick:()=>{T(!0),P(!1)},children:"Preview"})]}),_&&ae&&e.jsx(ft,{open:_,onClose:()=>T(!1),downloadUrl:`${qt}${F.osu.downloadBeatmapset(ae)}`,beatmapId:z??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}function ss({queueId:t,onSubmitted:n}){const[s,c]=se.useState(!1),[l,d]=se.useState(t),[m,C]=se.useState(""),[k,N]=se.useState(""),[o,y]=se.useState(!1),{notify:h}=xe(),{data:z=[]}=He();se.useEffect(()=>{d(t)},[t]);const M=async()=>{if(!l){h("Please select a queue",{variant:"error"});return}if(!m.trim()){h("Beatmap URL is required",{variant:"error"});return}y(!0);try{await q(F.moddi.queueSubmit(l),{method:"POST",body:JSON.stringify({beatmap_url:m.trim(),message:k.trim()||null})}),h("Submission created!",{variant:"success"}),C(""),N(""),c(!1),n==null||n()}catch(v){h((v==null?void 0:v.message)||"Failed to create submission",{variant:"error"})}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>c(!0),children:e.jsx(Be,{size:22})}),e.jsx(Ae,{open:s,onClose:()=>c(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:l??"",onChange:v=>d(v.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),z.map(v=>e.jsx("option",{value:String(v.id),children:v.name},v.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:m,onChange:v=>C(v.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:k,onChange:v=>N(v.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),k.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[k.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:o,onClick:M,children:o?"Submitting...":"Submit"})]})]})})]})}const ot=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(zt,{components:{p:({children:n})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:n}),ul:({children:n})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:n}),ol:({children:n})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:n}),li:({children:n})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:n}),strong:({children:n})=>e.jsx("strong",{style:{fontWeight:600},children:n}),em:({children:n})=>e.jsx("em",{children:n}),code:({children:n})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:n}),h1:({children:n})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:n}),h2:({children:n})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:n}),h3:({children:n})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:n})},children:t})});function ps(){const{id:t}=ct(),n=Qe(),[s,c]=i.useState(null),[l,d]=i.useState([]),[m,C]=i.useState([]),[k,N]=i.useState(!0),[o,y]=i.useState(null),[h,z]=i.useState(!1),[M,v]=i.useState(!1),[P,_]=i.useState(""),[T,j]=i.useState(""),[I,H]=i.useState(null),[Z,R]=i.useState(!1),[ie,f]=i.useState(""),[D,te]=i.useState(""),[W,x]=i.useState(""),[S,w]=i.useState(!1),[ee,ce]=i.useState(!1),[X,B]=i.useState("general"),[Q,ae]=i.useState(!1),[ne,Y]=i.useState(!1),[me,a]=i.useState(null),[b,J]=i.useState(""),[L,G]=i.useState([]),[de,$]=i.useState(!1),he=i.useRef(null),ue=i.useRef(null),be=i.useRef(null),[we,qe]=i.useState([]),[ke,Me]=i.useState(!1),[Ne,_e]=i.useState(null),{notify:p}=xe(),{queueStatusFilters:O}=Ie(),E=async()=>{var r,g;if(t){N(!0);try{const u=await q(F.moddi.queue(t),{requireAuth:!1});c(u.queue||null),d(u.members||[]),C(u.submissions||[])}catch(u){(r=u==null?void 0:u.message)!=null&&r.includes("403")||(g=u==null?void 0:u.message)!=null&&g.includes("Forbidden")?(p("You do not have access to this queue",{variant:"error"}),n("/md/queues")):p("Failed to load queue",{variant:"error"})}finally{N(!1)}}};i.useEffect(()=>{E(),q(F.auth.me,{requireAuth:!1}).then(r=>y(r)).catch(()=>{})},[t]);const A=o&&s&&(s.owner_id===o.id||l.some(r=>r.user_id===o.id&&r.joined_at));o&&l.some(r=>r.user_id===o.id&&r.joined_at);const le=o&&s&&(s.owner_id===o.id||l.some(r=>r.user_id===o.id&&r.joined_at)),K=async r=>{if(r.preventDefault(),!s||s.is_open===0){p("Queue is closed for submissions",{variant:"error"});return}if(!P.trim()){p("Beatmap URL is required",{variant:"error"});return}v(!0);try{await q(F.moddi.queueSubmit(t),{method:"POST",body:JSON.stringify({beatmap_url:P.trim(),message:T.trim()||null})}),p("Submission created!",{variant:"success"}),z(!1),_(""),j(""),E()}catch(g){p((g==null?void 0:g.message)||"Failed to create submission",{variant:"error"})}finally{v(!1)}},oe=r=>{C(g=>g.map(u=>u.id===r.id?r:u)),r.acknowledged_by_me!==void 0&&E()},Re=()=>{s&&(f(s.name),te(s.description||""),x(s.rules||""),R(!0),B("general"))},V=()=>{R(!1),f(""),te(""),x("")},fe=async()=>{if(!(!s||!le)){ce(!0);try{const r=s.is_open!==1;await q(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:r})}),p(`Queue ${r?"opened":"closed"}`,{variant:"success"}),E()}catch(r){p((r==null?void 0:r.message)||"Failed to update status",{variant:"error"})}finally{ce(!1)}}},Oe=async r=>{if(r.preventDefault(),!s||!ie.trim()){p("Queue name is required",{variant:"error"});return}ae(!0);try{const g=l.filter(u=>u.user_id!==s.owner_id&&u.role!=="owner").length>0;await q(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({name:ie.trim(),description:D.trim()||null,rules:W.trim()||null,is_group:g})}),p("Queue updated!",{variant:"success"}),V(),E()}catch(g){p((g==null?void 0:g.message)||"Failed to update queue",{variant:"error"})}finally{ae(!1)}};i.useEffect(()=>{if(!b.trim()){G([]),$(!1);return}const r=setTimeout(async()=>{try{const u=(await q(F.moddi.usersSearch(b),{requireAuth:!1})).items||[];G(u),$(u.length>0)}catch(g){console.error("Search failed:",g),G([]),$(!1)}},300);return()=>clearTimeout(r)},[b]);const pe=async r=>{if(!ne){Y(!0);try{await q(F.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:r})}),p("Invite sent!",{variant:"success"}),J(""),G([]),$(!1),E()}catch(g){p((g==null?void 0:g.message)||"Failed to invite member",{variant:"error"})}finally{Y(!1)}}},ye=async()=>{if(!(!t||!A))try{const r=await q(F.moddi.queueBlockedUsers(t));qe(r.blocked||[])}catch(r){console.error("Failed to load blocked users:",r)}},De=async r=>{if(!(!t||ke)&&confirm("Block this user from submitting to this queue?")){Me(!0);try{await q(F.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:r})}),p("User blocked",{variant:"success"}),ye(),J(""),G([]),$(!1)}catch(g){p((g==null?void 0:g.message)||"Failed to block user",{variant:"error"})}finally{Me(!1)}}},Ye=async r=>{if(!(!t||Ne===r)){_e(r);try{await q(F.moddi.queueUnblockUser(t,r),{method:"DELETE"}),p("User unblocked",{variant:"success"}),ye()}catch(g){p((g==null?void 0:g.message)||"Failed to unblock user",{variant:"error"})}finally{_e(null)}}};i.useEffect(()=>{X==="members"&&A&&t&&ye()},[X,A,t]);const yt=async()=>{if(s&&confirm(`Are you sure you want to delete "${s.name}"? This action cannot be undone.`)){w(!0);try{await q(F.moddi.queue(t),{method:"DELETE"}),p("Queue deleted",{variant:"success"}),n("/md/queues")}catch(r){p((r==null?void 0:r.message)||"Failed to delete queue",{variant:"error"})}finally{w(!1)}}},vt=async r=>{if(!o||!s||o.id!==s.owner_id){p("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){a(r);try{await q(F.moddi.queueMember(t,r),{method:"DELETE"}),p("Member removed",{variant:"success"});const u=l.filter(U=>U.user_id!==r).some(U=>U.user_id!==(s==null?void 0:s.owner_id)&&U.role!=="owner");if(s&&s.is_group===1&&!u)try{await q(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}E()}catch(g){p((g==null?void 0:g.message)||"Failed to remove member",{variant:"error"})}finally{a(null)}}},jt=async()=>{if(o&&confirm("Leave this queue? You will need to be invited again to rejoin.")){a(o.id);try{await q(F.moddi.queueMember(t,o.id),{method:"DELETE"}),p("Left queue",{variant:"success"});const g=l.filter(u=>u.user_id!==o.id).some(u=>u.user_id!==(s==null?void 0:s.owner_id)&&u.role!=="owner");if(s&&s.is_group===1&&!g)try{await q(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}n("/md/queues")}catch(r){p((r==null?void 0:r.message)||"Failed to leave queue",{variant:"error"})}finally{a(null)}}},St=async r=>{if(confirm("Cancel this invitation?")){a(r);try{await q(F.moddi.queueMember(t,r),{method:"DELETE"}),p("Invitation canceled",{variant:"success"}),E()}catch(g){p((g==null?void 0:g.message)||"Failed to cancel invitation",{variant:"error"})}finally{a(null)}}};return i.useEffect(()=>{if(!Z)return;const r=g=>{const u=g.target;u.closest(".manage-overlay")||u.closest(".manage-overlay-backdrop")||!u.closest(".manage-popup")&&be.current&&!be.current.contains(u)&&V()};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[Z]),i.useEffect(()=>{if(!de)return;const r=g=>{const u=g.target;he.current&&!he.current.contains(u)&&ue.current&&!ue.current.contains(u)&&$(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[de]),k?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):s?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t&&e.jsx(ss,{queueId:t,onSubmitted:()=>E()}),e.jsx($e,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>n("/md/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(ut,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:s.name}),le&&e.jsxs("button",{onClick:fe,disabled:ee,className:`queue-status-badge ${s.is_open===1?"status-open":"status-closed"}`,title:s.is_open===1?"Close queue":"Open queue","aria-label":s.is_open===1?"Close queue":"Open queue",children:[s.is_open===1?e.jsx(Ee,{size:14}):e.jsx(Ue,{size:14}),e.jsx("span",{children:s.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[A&&e.jsx("button",{ref:be,className:"icon-link",onClick:Re,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(Ct,{size:18})}),l.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:l.filter(r=>r.joined_at!==null).sort((r,g)=>{const u=r.role==="owner"||r.user_id===(s==null?void 0:s.owner_id),U=g.role==="owner"||g.user_id===(s==null?void 0:s.owner_id);return u&&!U?-1:!u&&U?1:(g.joined_at||0)-(r.joined_at||0)}).map(r=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>H(r.user_id),onMouseLeave:()=>H(null),children:[e.jsx(mt,{to:`/profile/${r.user_id}`,className:"queue-member-avatar",title:r.username,children:r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:r.username.charAt(0).toUpperCase()})}),I===r.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[r.username," ",r.role!=="member"?`(${r.role})`:""]})]},r.user_id))})]})]}),s.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:s.description}),s.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(ot,{content:s.rules})]}),s.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{className:"queue-submit-desktop-only",style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:12,opacity:s.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:s.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>s.is_open===1&&z(!h),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",s.is_open===0&&"(Closed)"]}),s.is_open===1&&(h?e.jsx(Te,{size:16}):e.jsx(Be,{size:16}))]}),h&&e.jsx("form",{onSubmit:K,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:P,onChange:r=>_(r.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:T,onChange:r=>j(r.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),T.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[T.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:r=>{r.stopPropagation(),z(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:M,onClick:r=>r.stopPropagation(),children:M?"Submitting...":"Submit"})]})]})})]}),e.jsxs("div",{className:"profile-tabs-unified",style:{marginTop:24},children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Submission sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"active",onClick:r=>{const g=r.currentTarget.closest(".profile-tabs-unified");g.querySelectorAll(".profile-tab").forEach(U=>{U.classList.remove("active"),U.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),g.querySelector(".profile-tabs-content").setAttribute("data-active","active")},children:"Active"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"archived",onClick:r=>{const g=r.currentTarget.closest(".profile-tabs-unified");g.querySelectorAll(".profile-tab").forEach(U=>{U.classList.remove("active"),U.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),g.querySelector(".profile-tabs-content").setAttribute("data-active","archived")},children:"Archived"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"active",children:[e.jsx("div",{className:"panel active",children:e.jsx("div",{className:"col",style:{gap:0},children:m.filter(r=>!!!r.is_archived&&O[r.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):m.filter(r=>!!!r.is_archived&&O[r.status]).map(r=>e.jsx(it,{submission:r,canManage:!!A,isGroup:(s==null?void 0:s.is_group)===1,onUpdate:oe,onDelete:g=>{C(u=>u.filter(U=>U.id!==g))}},r.id))})}),e.jsx("div",{className:"panel archived",children:e.jsx("div",{className:"col",style:{gap:0},children:m.filter(r=>!!r.is_archived&&O[r.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):m.filter(r=>!!r.is_archived&&O[r.status]).map(r=>e.jsx(it,{submission:r,canManage:!!A,isGroup:(s==null?void 0:s.is_group)===1,onUpdate:oe,onDelete:g=>{C(u=>u.filter(U=>U.id!==g))}},r.id))})})]})]}),Z&&We.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:V}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:V,"aria-label":"Close",children:e.jsx(Te,{size:18})}),e.jsxs("div",{className:"col",style:{gap:0,padding:"0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:16,padding:"20px 16px 12px",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("div",{className:"title",style:{fontSize:20,margin:0,padding:0,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Manage Queue"}),e.jsxs("div",{className:"tabs",role:"tablist",style:{margin:0},children:[e.jsx("button",{role:"tab","aria-selected":X==="general",className:`tab ${X==="general"?"active":""}`,onClick:()=>B("general"),children:"General"}),e.jsx("button",{role:"tab","aria-selected":X==="rules",className:`tab ${X==="rules"?"active":""}`,onClick:()=>B("rules"),children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":X==="members",className:`tab ${X==="members"?"active":""}`,onClick:()=>B("members"),children:"Members"})]})]}),e.jsx("hr",{className:"subtle-divider",style:{margin:"0 16px"}}),e.jsxs("form",{onSubmit:Oe,className:"col",style:{gap:0,padding:"16px"},children:[X==="general"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:ie,onChange:r=>f(r.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:D,onChange:r=>te(r.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:yt,disabled:S||Q,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(je,{size:14,style:{marginRight:6}}),S?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:Q||S,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:Q||S,style:{fontSize:13,padding:"8px 16px"},children:Q?"Updating...":"Save Changes"})]})]})]}),X==="rules"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:W,onChange:r=>x(r.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),W&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(ot,{content:W})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:Q||S,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:Q||S,style:{fontSize:13,padding:"8px 16px"},children:Q?"Updating...":"Save Changes"})]})]}),X==="members"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:he,type:"text",placeholder:"Search username or ID",value:b,onChange:r=>J(r.target.value),onKeyDown:r=>{r.key==="Enter"&&r.preventDefault()},onFocus:()=>{L.length>0&&$(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),de&&L.length>0&&e.jsx("div",{ref:ue,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:L.map(r=>{const g=l.some(re=>re.user_id===r.id&&re.joined_at),u=l.some(re=>re.user_id===r.id&&re.invited_at&&!re.joined_at),U=we.some(re=>re.user_id===r.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:r.username}),g&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),u&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",r.id," • osu ",r.osu_user_id]})]})]}),A&&!g&&!u&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:re=>{re.stopPropagation(),ne||pe(r.id)},disabled:ne,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(pt,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re=>{re.stopPropagation(),U?Ye(r.id):De(r.id)},disabled:ke||Ne===r.id,title:U?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:U?"var(--accent)":"var(--danger)"},children:U?e.jsx(Ee,{size:16}):e.jsx(Ue,{size:16})})]})]},r.id)})})})]})]}),l.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const r=l.filter(u=>u.joined_at!==null).sort((u,U)=>{const re=u.role==="owner"||u.user_id===(s==null?void 0:s.owner_id),Le=U.role==="owner"||U.user_id===(s==null?void 0:s.owner_id);return re&&!Le?-1:!re&&Le?1:(U.joined_at||0)-(u.joined_at||0)}),g=l.filter(u=>u.invited_at!==null&&u.joined_at===null);return e.jsxs(e.Fragment,{children:[r.map(u=>{const U=o&&s&&o.id===s.owner_id,re=u.user_id===(o==null?void 0:o.id),Le=u.user_id===(s==null?void 0:s.owner_id)||u.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.role})]})]}),U&&!Le&&e.jsx("button",{className:"icon-link",onClick:()=>vt(u.user_id),disabled:me===u.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(je,{size:16})}),!U&&re&&e.jsx("button",{className:"icon-link",onClick:jt,disabled:me===u.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(Tt,{size:16})})]},u.user_id)}),g.length>0&&e.jsx(e.Fragment,{children:g.map(u=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>St(u.user_id),disabled:me===u.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(Te,{size:16})})]},u.user_id))})]})})()})]}),A&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),we.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:we.map(r=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:r.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:r.username}),r.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",r.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Ye(r.user_id),disabled:Ne===r.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(Ee,{size:16})})]},r.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:Q||S,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:Q||S,style:{fontSize:13,padding:"8px 16px"},children:Q?"Updating...":"Save Changes"})]})]})]})]})]})]}),document.body),e.jsx("style",{children:`
        /* Hide inline submit form on mobile – mobile uses floating FAB instead */
        html.is-mobile .queue-submit-desktop-only {
          display: none;
        }

        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function gs(){const{data:t=[],isLoading:n}=Qt(),s=$t(),c=Ht(),{notify:l}=xe(),d=Qe(),m=Se(),[C,k]=i.useState(new Set),{data:N}=Fe(),[o,y]=i.useState(!1),[h,z]=i.useState(!1),[M,v]=i.useState(!1),P=i.useRef(null),_=i.useRef(null),T=!!(N!=null&&N.is_admin||N!=null&&N.is_mod);Yt(P,_,o,()=>y(!1));const j=async x=>{s.mutate(x,{onSuccess:()=>{}})},I=async x=>{x.startsWith("n:")&&c.mutate(x)},H=async()=>{const x=t.filter(S=>!S.read&&(S.id.startsWith("n:")||S.kind==="system"&&!S.id.startsWith("b:"))).map(S=>S.id);x.length>0&&(await j(x),l("All notifications marked as read",{variant:"success"}))},Z=x=>{if(!x)return null;try{const S=JSON.parse(x);if((S==null?void 0:S.type)==="queue_invite"&&(S!=null&&S.queue_id))return S}catch{}return null},R=async(x,S)=>{if(!C.has(x.id)){k(w=>new Set(w).add(x.id));try{await q(F.moddi.queueAccept(String(S)),{method:"POST"}),l("Invitation accepted!",{variant:"success"}),I(x.id),d(`/md/queues/${S}`)}catch(w){l((w==null?void 0:w.message)||"Failed to accept invitation",{variant:"error"})}finally{k(w=>{const ee=new Set(w);return ee.delete(x.id),ee})}}},ie=async(x,S)=>{if(!C.has(x.id)){k(w=>new Set(w).add(x.id));try{await q(F.moddi.queueDeny(String(S)),{method:"POST"}),l("Invitation declined",{variant:"success"}),I(x.id)}catch(w){l((w==null?void 0:w.message)||"Failed to decline invitation",{variant:"error"})}finally{k(w=>{const ee=new Set(w);return ee.delete(x.id),ee})}}},f=x=>Z(x.text)?e.jsx(pt,{size:20,color:"#a78bfa"}):x.kind==="star"?e.jsx(Ve,{size:20,color:"#f59e0b"}):x.kind==="likes5"?e.jsx(et,{size:20,color:"#f472b6"}):x.kind==="comment"?e.jsx(Ce,{size:20,color:"#60a5fa"}):x.kind==="inspiration"?e.jsx(Ce,{size:20,color:"#7dd3fc"}):x.kind==="reaction"?e.jsx(tt,{size:20,color:"#10b981"}):x.id.startsWith("b:")?e.jsx(st,{size:20,color:"#a78bfa"}):null,D=x=>Z(x.text)?"Queue Invitation":x.kind==="star"?"Star":x.kind==="likes5"?"Likes":x.kind==="comment"?"Comment":x.kind==="inspiration"?"Inspiration":x.kind==="reaction"?"Reaction":x.id.startsWith("b:")?"Global":"System",te=t.filter(x=>!x.read&&!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).length,W=async x=>{if(!(!(N!=null&&N.id)||M)){v(!0);try{const S={kind:x};x==="system"&&(S.text="Test system notification"),await q(F.admin.notificationsTest,{method:"POST",body:JSON.stringify(S)}),l("Test notification sent",{variant:"success"}),m.invalidateQueries({queryKey:["notifications","detailed"]}),m.invalidateQueries({queryKey:["notifications"]})}catch(S){l((S==null?void 0:S.message)||"Failed to send test notification",{variant:"error"})}finally{v(!1),y(!1),z(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[T&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:P,className:"btn secondary",onClick:()=>y(!o),disabled:M,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Xe,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(ge,{size:14,style:{transition:"transform 0.2s ease",transform:o?"rotate(180deg)":"rotate(0deg)"}})]}),o&&e.jsxs("div",{ref:_,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("star"),disabled:M,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("likes5"),disabled:M,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("comment"),disabled:M,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("inspiration"),disabled:M,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("reaction"),disabled:M,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("system"),disabled:M,children:"Test System"})]})]}),te>0&&e.jsxs("button",{className:"btn secondary",onClick:H,children:[e.jsx(Ze,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),T&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>z(!0),children:e.jsx(Xe,{size:22})}),e.jsx(Ae,{open:h,onClose:()=>z(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>W("star"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ve,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("likes5"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(et,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("comment"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ce,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("inspiration"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ce,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("reaction"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(tt,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("system"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(st,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:n?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(x=>!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).map(x=>{const S=({notif:w})=>{const[ee,ce]=i.useState(0),[X,B]=i.useState(!1),Q=i.useRef(null),ae=i.useRef(null),ne=i.useRef(null),Y=i.useRef(null),me=L=>{w.id.startsWith("n:")&&(Q.current=L.touches[0].clientX,Y.current=L.touches[0].clientY,ae.current=Date.now(),B(!1))},a=L=>{if(Q.current===null||Y.current===null||!w.id.startsWith("n:"))return;const G=L.touches[0].clientX,de=L.touches[0].clientY,$=G-Q.current,he=Math.abs(de-Y.current);Math.abs($)>he&&(B(!0),ce(Math.max(-80,Math.min(0,$))))},b=()=>{if(Q.current===null)return;ee<=-60&&I(w.id),ce(0),B(!1),Q.current=null,Y.current=null,ae.current=null},J=w.id.startsWith("n:");return e.jsxs("div",{ref:ne,style:{position:"relative",background:w.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:w.videoId?"pointer":"default",opacity:w.read?.7:1,transform:`translateX(${ee}px)`,transition:X?"none":"transform 0.2s ease",touchAction:J?"pan-x pan-y":"pan-y"},onTouchStart:me,onTouchMove:a,onTouchEnd:b,onTouchCancel:b,onClick:()=>{Math.abs(ee)>10||(!w.read&&w.id.startsWith("n:")&&j([w.id]),w.videoId&&(window.location.hash="/mp/feed"))},children:[J&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(ee)/80,pointerEvents:"none",zIndex:0},children:e.jsx(je,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:f(w)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:D(w)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(w.createdAt).toLocaleDateString()}),w.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:L=>{L.stopPropagation(),I(w.id)},style:{padding:4},children:e.jsx(je,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const L=Z(w.text);return L?`${L.inviter_username} invited you to join queue: ${L.queue_name}`:w.text||(w.kind==="star"?"One of your posts was starred!":w.kind==="likes5"?"One of your posts reached 5 likes!":w.kind==="comment"?"Someone commented on your post":w.kind==="inspiration"?"Someone is inspired by you!":w.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const L=Z(w.text);return L&&!C.has(w.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:G=>{G.stopPropagation(),R(w,L.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Ze,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:G=>{G.stopPropagation(),ie(w,L.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Te,{size:14,style:{marginRight:4}}),"Decline"]})]}):L&&C.has(w.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),w.read&&w.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(w.readAt).toLocaleString()]})]})]})]},w.id)};return e.jsx(S,{notif:x},x.id)})})})]})}export{xt as C,$e as D,Kt as F,Gt as M,gs as N,us as P,ms as Q,os as a,Yt as b,Fe as c,ls as d,Wt as e,ds as f,$t as g,Ht as h,cs as i,ps as j,Ie as u};
