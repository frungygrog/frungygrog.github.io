import{j as e,L as j,X as v,q as f,u as N,e as C,f as _,r as i,T as w,x as S}from"./vendor-react-Y5jcGNp7.js";import{a as y,A as b,d as z,u as k}from"./index-LZlfn_zl.js";import"./vendor-By4OFKBA.js";import"./editor-components-DUULl51x.js";function Q({queue:s}){return e.jsx(j,{to:`/md/queues/${s.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",cursor:"pointer"},onMouseEnter:r=>r.currentTarget.style.background="rgba(255,255,255,0.02)",onMouseLeave:r=>r.currentTarget.style.background="rgba(255,255,255,0.01)",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[s.is_group?e.jsx(v,{size:18}):e.jsx(f,{size:18}),e.jsx("strong",{style:{fontSize:16},children:s.name}),s.is_member&&e.jsx("span",{className:"chip",style:{fontSize:11,padding:"2px 8px"},children:"Member"})]}),s.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:s.description}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[s.owner_avatar_url&&e.jsx("img",{src:s.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",s.owner_username,s.member_count!==void 0&&Number(s.member_count)>0&&(Number(s.member_count)===1&&s.first_member_username?` and ${s.first_member_username}`:` & ${s.member_count} others`)]}),e.jsx("span",{className:"muted",children:"â€¢"}),e.jsx("span",{className:"muted",children:new Date(s.created_at*1e3).toLocaleDateString()})]})]})})}function F(){return N({queryKey:["moddi","queues"],queryFn:async()=>{const s=await y(b.moddi.queues);return Array.isArray(s.items)?s.items:[]}})}function D(){const s=C();return _({mutationFn:async r=>{var a;return await y(b.moddi.queues,{method:"POST",body:JSON.stringify({name:r.name.trim(),description:((a=r.description)==null?void 0:a.trim())||null,is_group:r.is_group??!1})})},onSuccess:()=>{s.invalidateQueries({queryKey:["moddi","queues"]})}})}function A(){const{data:s=[],isLoading:r}=F(),{data:a}=z(),o=D(),{notify:n}=k(),[d,l]=i.useState(!1),[c,p]=i.useState(""),[g,x]=i.useState(""),u=i.useMemo(()=>a?s.some(t=>t.owner_id===a.id):!1,[a,s]),h=async t=>{if(t.preventDefault(),u){n("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!c.trim()){n("Queue name is required",{variant:"error"});return}o.mutate({name:c.trim(),description:g.trim()||null,is_group:!1},{onSuccess:()=>{n("Queue created!",{variant:"success"}),l(!1),p(""),x("")},onError:m=>{n((m==null?void 0:m.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:0},children:u?e.jsx("div",{style:{padding:"12px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>l(!d),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Create a queue!"}),d?e.jsx(w,{size:16}):e.jsx(S,{size:16})]}),d&&e.jsx("form",{onSubmit:h,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:c,onChange:t=>p(t.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:g,onChange:t=>x(t.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:t=>{t.stopPropagation(),l(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:o.isPending||u,onClick:t=>t.stopPropagation(),children:o.isPending?"Creating...":"Create"})]})]})})]})}),e.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("div",{className:"col",style:{gap:0},children:r?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):s.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues yet. Create one to get started!"}):s.map(t=>e.jsx(Q,{queue:t},t.id))})})]})}export{A as default};
