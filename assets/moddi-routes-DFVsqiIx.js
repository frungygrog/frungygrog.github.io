import{s as vt,t as Te,v as be,w as qe,r as i,e as it,R as ae,j as e,c as ke,x as rt,l as _e,d as De,y as Ee,z as jt,B as St,o as ot,u as Ue,q as lt,L as dt,C as wt,D as Ne,k as He,f as Nt,E as kt,G as _t,H as Ce,I as Be,J as Ye,K as Ct,M as ct,N as Tt,O as zt,P as Ke,Q as Je,A as Xe,h as Ge,S as Ve,T as Ze}from"./vendor-react-BcztRRPo.js";import{a as M,A as F,g as It,u as fe,b as ut,P as mt,C as Ft,c as Mt}from"./mappi-routes-BZhmWKjA.js";import{i as Rt,a as Lt,b as qt,c as Et}from"./editor-components-BMK_t3kA.js";import{B as pt}from"./editor-BU8nWiSI.js";const Pt=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{standard:a.has("standard")||a.size===0,taiko:a.has("taiko"),mania:a.has("mania"),catch:a.has("catch")}}catch{return{standard:!0,taiko:!1,mania:!1,catch:!1}}},Ot=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{untagged:a.has("untagged")||a.size===0,help:a.has("help")||a.size===0}}catch{return{untagged:!0,help:!0}}},At=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{unchecked:a.has("unchecked")||a.size===0,accepted:a.has("accepted")||a.size===0,denied:a.has("denied")||a.size===0,finished:a.has("finished")||a.size===0,archived:a.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Bt=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{open:a.has("open")||a.size===0,closed:a.has("closed")}}catch{return{open:!0,closed:!1}}},Dt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},ze=vt(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Pt(),tagFilters:Ot(),queueStatusFilters:At(),queueOpenFilters:Bt(),lastSection:Dt(),previousLocation:null,setMenuOpen:a=>t({menuOpen:a}),setMobileNavOpen:a=>t({mobileNavOpen:a}),setNotifOpen:a=>t({notifOpen:a}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:a=>{t({modeFilters:a});try{const d=Object.entries(a).filter(([c,m])=>m).map(([c])=>c),o=d.length?d:["standard"];localStorage.setItem("filter_modes",o.join(","))}catch{}},setTagFilters:a=>{t({tagFilters:a});try{const d=Object.entries(a).filter(([c,m])=>m).map(([c])=>c),o=d.length?d:["untagged","help"];localStorage.setItem("filter_moddi_tags",o.join(","))}catch{}},setQueueStatusFilters:a=>{t({queueStatusFilters:a});try{const d=Object.entries(a).filter(([c,m])=>m).map(([c])=>c),o=d.length?d:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",o.join(","))}catch{}},setQueueOpenFilters:a=>{t({queueOpenFilters:a});try{const d=Object.entries(a).filter(([c,m])=>m).map(([c])=>c),o=d.length?d:["open"];localStorage.setItem("filter_queue_open",o.join(","))}catch{}},setLastSection:a=>{t({lastSection:a});try{a?localStorage.setItem("last_section",a):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:a=>{t({previousLocation:a})}}));function Ut(t=!0){return Te({queryKey:["notifications"],queryFn:async()=>{try{const a=await M(F.user.notifications);return Array.isArray(a.items)?a.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Wt(){return Te({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await M("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function rs(){const{data:t=[]}=Ut();return t.filter(a=>a.kind==="system"&&a.id.startsWith("b:")&&(a.expiresAt||0)<=Date.now()?!1:!a.read).length}function Qt(){const t=be();return qe({mutationFn:async a=>{await M(F.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:a})})},onSuccess:()=>{t.setQueryData(["notifications"],a=>(a==null?void 0:a.map(s=>({...s,read:!0})))||[])}})}function $t(){const t=be();return qe({mutationFn:async a=>{const s=It();await M(F.user.deleteNotification(a),{method:"DELETE",headers:{"X-CSRF-Token":s}})},onSuccess:(a,s)=>{t.setQueryData(["notifications"],d=>(d==null?void 0:d.filter(o=>o.id!==s))||[]),t.setQueryData(["notifications","detailed"],d=>(d==null?void 0:d.filter(o=>o.id!==s))||[])}})}function Ht(t,a,s,d){i.useEffect(()=>{if(!s)return;const o=c=>{const m=c.target;a.current&&!a.current.contains(m)&&t.current&&!t.current.contains(m)&&d()};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[s,d,t,a])}function Ie(){return Te({queryKey:["user","me"],queryFn:async()=>{try{return await M(F.auth.me)}catch{return null}},staleTime:5*60*1e3})}function os(t=!0){return Te({queryKey:["user","quota"],queryFn:async()=>{try{return await M(F.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function ls(){const t=be();return qe({mutationFn:async()=>{await M(F.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}const Yt=({context:t,onClose:a,style:s})=>{const d=it(),o=ae.useMemo(()=>{if(t)return t;const b=d.pathname;return b==="/mp/feed"?"mappi-feed":b==="/md/feed"?"moddi-feed":b==="/md/queues"?"moddi-queues":b.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,d.pathname]),{modeFilters:c,setModeFilters:m,tagFilters:C,setTagFilters:S,queueOpenFilters:k,setQueueOpenFilters:l,queueStatusFilters:w,setQueueStatusFilters:f}=ze(),z=b=>{const I={...c,[b]:!c[b]};Object.values(I).some(Boolean)||(I.standard=!0),m(I);try{window.dispatchEvent(new Event("filterchange"))}catch{}},q=b=>{const I={...C,[b]:!C[b]};!I.untagged&&!I.help&&(I.help=!0),S(I);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},y=b=>{const I={...k,[b]:!k[b]};!I.open&&!I.closed&&(I.open=!0),l(I)},P=b=>{const I={...w,[b]:!w[b]};["unchecked","accepted","denied","finished"].some(K=>I[K])||(I.unchecked=!0),f(I)},N=({title:b,children:I})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:b}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:I})]}),_=({active:b,onClick:I,label:Y})=>e.jsx("button",{type:"button",onClick:I,className:"chip","aria-pressed":b,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:b?"rgba(125,211,252,0.6)":"rgba(255,255,255,0.16)",background:b?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:Y});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{position:"absolute",right:0,top:0,zIndex:1e4,background:"rgba(18,20,24,0.98)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...s},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),a&&e.jsx("button",{className:"icon-link",onClick:a,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(ke,{size:16})})]}),o==="mappi-feed"&&e.jsxs(N,{title:"Gamemode",children:[e.jsx(_,{active:c.standard,onClick:()=>z("standard"),label:"Standard"}),e.jsx(_,{active:c.taiko,onClick:()=>z("taiko"),label:"Taiko"}),e.jsx(_,{active:c.mania,onClick:()=>z("mania"),label:"Mania"}),e.jsx(_,{active:c.catch,onClick:()=>z("catch"),label:"Catch"})]}),o==="moddi-feed"&&e.jsxs(N,{title:"Tags",children:[e.jsx(_,{active:C.untagged,onClick:()=>q("untagged"),label:"Untagged"}),e.jsx(_,{active:C.help,onClick:()=>q("help"),label:"Help"})]}),o==="moddi-queues"&&e.jsxs(N,{title:"Queues",children:[e.jsx(_,{active:k.open,onClick:()=>y("open"),label:"Open"}),e.jsx(_,{active:k.closed,onClick:()=>y("closed"),label:"Closed"})]}),o==="moddi-queue-detail"&&e.jsxs(N,{title:"Submissions",children:[e.jsx(_,{active:w.unchecked,onClick:()=>P("unchecked"),label:"Pending"}),e.jsx(_,{active:w.accepted,onClick:()=>P("accepted"),label:"Accepted"}),e.jsx(_,{active:w.denied,onClick:()=>P("denied"),label:"Denied"}),e.jsx(_,{active:w.finished,onClick:()=>P("finished"),label:"Finished"})]})]})},et={standard:Et,taiko:qt,mania:Lt,catch:Rt},tt={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},Kt=({value:t,onChange:a})=>{const[s,d]=i.useState(!1),o=i.useRef(null);i.useEffect(()=>{if(!s)return;const m=S=>{o.current&&!o.current.contains(S.target)&&d(!1)},C=S=>{S.key==="Escape"&&d(!1)};return document.addEventListener("mousedown",m),document.addEventListener("keydown",C),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("keydown",C)}},[s]);const c=m=>e.jsxs("button",{className:`mode-option${m===t?" selected":""}`,onClick:()=>{a(m),d(!1)},role:"option","aria-selected":m===t,children:[e.jsx("img",{className:"mode-icon",src:et[m],width:24,height:24,alt:""}),e.jsx("span",{children:tt[m]})]},m);return e.jsxs("div",{className:"mode-select",ref:o,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":s,onClick:()=>d(m=>!m),children:[e.jsx("img",{className:"mode-icon",src:et[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:tt[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(c)})]})};function st(t){if(!t)return"standard";const a=String(t).toLowerCase().trim();return a==="osu"||a==="0"||a==="standard"?"standard":a==="taiko"||a==="1"?"taiko":a==="catch"||a==="fruits"||a==="2"?"catch":a==="mania"||a==="3"?"mania":"standard"}function gt({section:t,onUpload:a,onPost:s,forceExpanded:d}){const{notify:o}=fe(),c=t==="mappi",[m,C]=i.useState(!1),[S,k]=i.useState(""),[l,w]=i.useState(null),[f,z]=i.useState(null),[q,y]=i.useState(!1),[P,N]=i.useState(""),_=i.useRef(0),[b,I]=i.useState(""),[Y,K]=i.useState("standard"),[R,oe]=i.useState(null),[x,A]=i.useState(0),[ne,D]=i.useState(""),[h,v]=i.useState(""),[j,ee]=i.useState(null),[me,J]=i.useState(""),[Q,U]=i.useState(""),[ie,X]=i.useState(null),[te,r]=i.useState(!1),[T,Z]=i.useState(null),se=100*1024*1024,W=i.useMemo(()=>R?`${R.name}:${R.size}:${R.lastModified}`:null,[R]),[$,G]=i.useState(""),[ce,ge]=i.useState(!1),[ue,xe]=i.useState([]),ve=i.useRef(null);i.useEffect(()=>{_.current&&window.clearTimeout(_.current);const p=(S||"").trim();if(!p){N(""),w(null),z(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(p)){N(""),w(null),z(null);return}return _.current=window.setTimeout(async()=>{var L;try{let E;try{E=new URL(p)}catch{N("Invalid URL format");return}const de=E.hash.match(/#osu\/(\d+)/),H=de?de[1]:null;E.hash="";const Re={url:E.toString()};H&&(Re.beatmap_id=H);const V=await M(F.osu.resolveBeatmap+ut(Re),{requireAuth:!1}),he=Array.isArray(V==null?void 0:V.diffs)?V.diffs:[];if(!he.length&&!V.setId){N("No difficulties found"),w(null),z(null);return}if(w({setId:Number(V.setId)||0,beatmapId:V.beatmapId??null,title:String(V.title||""),artist:String(V.artist||""),mapper:String(V.mapper||""),diffs:he}),he.length>0){const Oe=Number.isFinite(Number(V.beatmapId))?Number(V.beatmapId):Number((L=he[0])==null?void 0:L.id),pe=he.find(Ae=>Number(Ae.id)===Oe)||he[0],ye=st(pe==null?void 0:pe.mode);z({beatmapId:Number(pe==null?void 0:pe.id)||null,version:String((pe==null?void 0:pe.version)||""),mode:ye}),c&&K(ye)}else z(null);N("")}catch(E){const de=(E==null?void 0:E.message)||"Unknown error";N(`Failed to resolve: ${de}`),w(null),z(null)}},400),()=>{_.current&&window.clearTimeout(_.current)}},[S,c]);async function Fe(){return v("info"),D("Requesting upload URL..."),await M(F.uploads.new,{method:"POST",body:JSON.stringify({description:b.slice(0,100),beatmap_url:S||void 0,size_bytes:(R==null?void 0:R.size)??void 0,mode:Y,beatmapset_id:(l==null?void 0:l.setId)??void 0,beatmap_id:(f==null?void 0:f.beatmapId)??void 0,beatmap_version:(f==null?void 0:f.version)??void 0,beatmap_title:l?`${l.title}`:void 0,beatmap_artist:l?`${l.artist}`:void 0,beatmap_mapper:l?`${l.mapper}`:void 0})})}async function je(p,O,L="form"){await new Promise((E,de)=>{const H=new XMLHttpRequest;if(H.open("POST",p),H.upload.onprogress=le=>{le.lengthComputable&&A(Math.round(le.loaded/le.total*100))},H.onload=()=>H.status>=200&&H.status<300?E():de(new Error(`Upload failed (${H.status}) ${H.responseText||""}`)),H.onerror=()=>de(new Error("Network error")),L==="form"){const le=new FormData;le.append("file",O,O.name),H.send(le)}else H.setRequestHeader("Content-Type","application/octet-stream"),H.send(O)})}async function Me(){if(!(!R||!c)){if(R.size>se){J("File exceeds 100MB limit");return}if(typeof ie=="number"&&ie>60.5){U("Clip exceeds 60s limit");return}W&&(r(!0),Z(W)),A(0),v("info");try{const p=await Fe();ee(p.streamUID);let O=p.streamUID;try{D("Uploading..."),await je(p.uploadURL,R,"form")}catch(L){v("warn"),D(`Retrying upload... (${(L==null?void 0:L.message)||L})`);const E=await Fe();ee(E.streamUID),O=E.streamUID,await je(E.uploadURL,R,"binary")}v("info"),D("Processing...");for(let L=0;L<60;L++){await new Promise(E=>setTimeout(E,3e3));try{if((await M(F.videos.get(O),{requireAuth:!1})).status==="ready"){v("success"),D("Ready!"),o("Upload complete!",{variant:"success"}),oe(null),I(""),k(""),w(null),z(null),K("standard"),A(0),ee(null),J(""),U(""),X(null),r(!1),Z(null),a&&a();break}}catch{}}}catch(p){v("error"),D(p.message||"Error"),o(p.message||"Upload failed",{variant:"error"})}}}const Se=async p=>{if(p.preventDefault(),!c){if(!$.trim()){o("Text is required",{variant:"error"});return}if($.length>200){o("Text must be 200 characters or less",{variant:"error"});return}ge(!0);try{const O=await M(F.moddi.posts,{method:"POST",body:JSON.stringify({text:$.trim(),beatmap_url:S.trim()||void 0,beatmapset_id:(l==null?void 0:l.setId)??void 0,beatmap_id:(f==null?void 0:f.beatmapId)??(l==null?void 0:l.beatmapId)??void 0,beatmap_version:(f==null?void 0:f.version)??void 0,tags:ue.length>0?ue.join(","):void 0})});if(O){console.log("Post created response:",O);const L=O==null?void 0:O.post;L?(!L.uid&&L.id&&(console.warn("Created post missing uid, using id as fallback:",L),L.uid=String(L.id)),s&&s(L)):s&&s(),o("Post created!",{variant:"success"}),G(""),k(""),w(null),z(null),N(""),y(!1),xe([])}}catch{o("Failed to create post",{variant:"error"})}finally{ge(!1)}}},we=!!d||m;return e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:c?12:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:d?"default":"pointer",padding:"8px 12px",minHeight:36},onClick:()=>{d||C(!m)},children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:c?"Upload a clip":"Create a post!"}),we?e.jsx(rt,{size:16}):e.jsx(_e,{size:16})]}),we&&e.jsx("div",{style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.4,marginBottom:12},children:"Max: 60s, 100MB. Only osu! mapping content is permitted."}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Game mode:"}),e.jsx(Kt,{value:Y,onChange:K})]}),l?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[l.artist," – ",l.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",l.mapper]})]}),l.diffs.length>0&&e.jsx("select",{value:(f==null?void 0:f.beatmapId)??l.beatmapId??void 0,onChange:p=>{const O=Number(p.target.value),L=(l==null?void 0:l.diffs.find(E=>Number(E.id)===O))||null;if(L){const E=st(L.mode);z({beatmapId:O,version:L.version,mode:E}),K(E)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:l.diffs.map(p=>e.jsxs("option",{value:p.id,children:[p.version," (",p.mode,")"]},p.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>y(!0),style:{padding:"6px 12px",fontSize:13},children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{w(null),z(null),k("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:S,onChange:p=>k(p.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:b,onChange:p=>I(p.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:64}}),P&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:P}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("input",{type:"file",accept:"video/*",onChange:p=>{var E;const O=((E=p.target.files)==null?void 0:E[0])||null;if(oe(O),X(null),O&&O.size>se?J("File exceeds 100MB limit"):J(""),O)try{const de=URL.createObjectURL(O),H=document.createElement("video");H.preload="metadata",H.src=de,H.onloadedmetadata=()=>{URL.revokeObjectURL(de);const le=Number.isFinite(H.duration)?H.duration:NaN;Number.isFinite(le)&&X(le),Number.isFinite(le)&&le>60.5?U("Clip exceeds 60s limit"):U("")},H.onerror=()=>{URL.revokeObjectURL(de),X(null)}}catch{X(null)}else U("");const L=O?`${O.name}:${O.size}:${O.lastModified}`:null;L&&L!==T&&r(!1)},style:{flex:1,minWidth:0}}),e.jsx("button",{className:"btn",onClick:Me,disabled:!R||!!me||!!Q||te,style:{flexShrink:0},children:"Upload"})]}),me&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:me}),Q&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:Q}),R&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Selected: ",R.name," • ",(R.size/1024/1024).toFixed(1)," MB",te&&T===W?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(locked)"}):null]}),(x>0||ne)&&e.jsxs("div",{className:"upload-status",children:[ne&&e.jsx("div",{className:`chip ${h||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:ne}),x>0&&e.jsx("div",{className:"progress",style:{marginTop:8},"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":x,children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,Math.max(0,x))}%`}})})]}),j&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Stream UID: ",j]})]})]}):e.jsx("form",{onSubmit:Se,children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("textarea",{ref:ve,placeholder:"Ask for feedback! Or, say anything! Woo! (max 200 chars)",value:$,onChange:p=>G(p.target.value),maxLength:200,rows:2,style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:50}}),l?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[l.artist," – ",l.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",l.mapper]})]}),l.diffs.length>0&&e.jsx("select",{value:(f==null?void 0:f.beatmapId)??l.beatmapId??void 0,onChange:p=>{const O=Number(p.target.value),L=(l==null?void 0:l.diffs.find(E=>Number(E.id)===O))||null;L&&z({beatmapId:O,version:L.version,mode:String(L.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:l.diffs.map(p=>e.jsxs("option",{value:p.id,children:[p.version," (",p.mode,")"]},p.id))})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:S,onChange:p=>k(p.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),P&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:P}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("span",{className:"muted",style:{fontSize:11},children:"Tags:"}),e.jsx("button",{type:"button",onClick:()=>{ue.includes("help")?xe(ue.filter(p=>p!=="help")):xe([...ue,"help"])},style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:ue.includes("help")?"rgba(234, 179, 8, 0.2)":"rgba(255,255,255,0.05)",border:ue.includes("help")?"1px solid rgba(234, 179, 8, 0.4)":"1px solid rgba(255,255,255,0.12)",color:ue.includes("help")?"#fbbf24":"var(--text)",fontWeight:500,lineHeight:1.2,cursor:"pointer",transition:"all 0.15s ease"},children:"Help"})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>y(!0),children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{w(null),z(null),k("")},children:"Clear"})]}),e.jsx("button",{type:"submit",className:"btn",disabled:ce||!$.trim()||$.length>200,children:ce?"Posting...":"Post"})]})]})})}),q&&l&&e.jsx(pt,{open:q,onClose:()=>y(!1),downloadUrl:F.osu.downloadBeatmapset(l.setId),beatmapId:(f==null?void 0:f.beatmapId)??l.beatmapId??void 0,beatmapVersion:f==null?void 0:f.version})]})}function Pe({open:t,onClose:a,children:s}){const d=i.useRef(null),o=i.useRef(null),c=i.useRef(!1),m=l=>{var w;o.current=((w=l.touches[0])==null?void 0:w.clientY)??null,c.current=!1},C=l=>{var q,y;if(o.current==null)return;const w=((q=l.touches[0])==null?void 0:q.clientY)??null;if(w==null)return;const f=w-o.current;(((y=d.current)==null?void 0:y.scrollTop)??0)<=0&&f>60?c.current=!0:c.current=!1},S=()=>{c.current&&a(),o.current=null,c.current=!1};if(!t)return null;const k=e.jsx("div",{className:"mobile-upload-overlay",onClick:a,children:e.jsx("div",{ref:d,className:"mobile-upload-sheet",onClick:l=>l.stopPropagation(),onTouchStart:m,onTouchMove:C,onTouchEnd:S,children:s})});return De.createPortal(k,document.body)}function Jt({section:t,onUpload:a,onPost:s}){const[d,o]=ae.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":t==="mappi"?"Upload clip":"New post",title:t==="mappi"?"Upload clip":"New post",onClick:()=>o(!0),children:e.jsx(Ee,{size:22})}),e.jsx(Pe,{open:d,onClose:()=>o(!1),children:e.jsx("div",{style:{paddingTop:6},children:e.jsx(gt,{section:t,forceExpanded:!0,onUpload:()=>{a==null||a(),o(!1)},onPost:c=>{s==null||s(c),o(!1)}})})})]})}function Xt(){const[t,a]=ae.useState(!1);return ae.useEffect(()=>{var o;const s=window.matchMedia("(max-width: 768px)"),d=()=>a(s.matches);return d(),(o=s.addEventListener)==null||o.call(s,"change",d),()=>{var c;return(c=s.removeEventListener)==null?void 0:c.call(s,"change",d)}},[]),t}const We=({context:t})=>{const a=Xt(),[s,d]=ae.useState(!1),o=ae.useRef(null);return ae.useEffect(()=>{const c=m=>{if(!s)return;const C=m.target;if(o.current&&o.current.contains(C))return;const S=document.getElementById("desktop-filters-panel");S&&S.contains(C)||d(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[s]),a?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:o,className:"desktop-fab",onClick:()=>d(c=>!c),"aria-haspopup":"dialog","aria-expanded":s,title:"Filters","aria-label":"Filters",children:e.jsx(jt,{size:22})}),s&&e.jsx("div",{id:"desktop-filters-panel",style:{position:"fixed",right:18,bottom:100,zIndex:1e4},children:e.jsx(Yt,{context:t,onClose:()=>d(!1)})})]})};function Gt(){const{data:t}=Ie(),{tagFilters:a}=ze();return St({queryKey:["moddi","feed",a],queryFn:async({pageParam:s=0})=>{const d=new URLSearchParams({limit:"20",offset:String(s)}),o=`${F.moddi.posts}?${d.toString()}`;return await M(o)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,d)=>{var m;const o=d.reduce((C,S)=>{var k;return C+(((k=S.items)==null?void 0:k.length)||0)},0);return(((m=s.items)==null?void 0:m.length)||0)===20?o:void 0}})}function ds(){const t=it(),a=be(),{data:s}=Ie(),{tagFilters:d}=ze(),{data:o,fetchNextPage:c,hasNextPage:m,isFetching:C,isFetchingNextPage:S,refetch:k}=Gt(),l=i.useMemo(()=>o!=null&&o.pages?o.pages.flatMap(N=>(N.items||[]).map(b=>({...b,user_id:b.user_id??0,username:b.username||"Unknown",avatar_url:b.avatar_url||null,text:b.text??null,uid:b.uid||String(b.id||""),reactions_count:Number(b.reactions_count??0),reacted_by_me:b.reacted_by_me??!1,comments_count:Number(b.comments_count??0)}))):[],[o]),w=i.useMemo(()=>l.filter(N=>{const _=N.tags?typeof N.tags=="string"?N.tags.split(",").map(Y=>Y.trim()):[]:[],b=!N.tags||_.length===0,I=_.includes("help");return d.untagged&&d.help?!0:d.untagged&&!d.help?b:!d.untagged&&d.help?I:!1}),[l,d]);i.useEffect(()=>{t.pathname==="/md/feed"&&k()},[t.pathname,k]),i.useEffect(()=>{const N=()=>{k()};return window.addEventListener("moddifilterchange",N),()=>window.removeEventListener("moddifilterchange",N)},[k]);const f=N=>{a.setQueryData(["moddi","feed"],_=>_&&{..._,pages:_.pages.map(b=>({...b,items:b.items.map(I=>I.id===N.id?N:I)}))})},z=N=>{a.setQueryData(["moddi","feed"],_=>_&&{..._,pages:_.pages.map(b=>({...b,items:b.items.filter(I=>I.id!==N)}))})},q=N=>{N&&a.setQueryData(["moddi","feed"],_=>{if(!_)return _;const b={...N,user_id:N.user_id??0,username:N.username||"Unknown",avatar_url:N.avatar_url||null,text:N.text??null,uid:N.uid||String(N.id||""),reactions_count:Number(N.reactions_count??0),reacted_by_me:N.reacted_by_me??!1,comments_count:Number(N.comments_count??0)};return{..._,pages:_.pages.map((I,Y)=>Y===0?{...I,items:[b,...I.items||[]]}:I)}}),a.invalidateQueries({queryKey:["moddi","feed"]}),k()},y=C&&!S,P=m??!1;return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Say anything! If you want help, tag it accordingly and others can raise their hand."}),e.jsx(gt,{section:"moddi",onPost:q})]}),e.jsx(Jt,{section:"moddi",onPost:q}),e.jsx(We,{context:"moddi-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[w.length===0&&!y&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to post!"}),w.map(N=>e.jsx(mt,{post:N,section:"moddi",onUpdate:f,onDelete:z,me:s},N.id)),w.length>0&&P&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>c(),disabled:S,children:S?"Loading...":"Load more"})})]})})]})}function cs(){const{uid:t}=ot(),a=Ue(),[s,d]=i.useState(null),[o,c]=i.useState([]),[m,C]=i.useState(!0),[S,k]=i.useState(null),[l,w]=i.useState(""),[f,z]=i.useState(null),[q,y]=i.useState(!1),{notify:P}=fe();i.useEffect(()=>{M(F.auth.me,{requireAuth:!1}).then(x=>k(x)).catch(()=>{})},[]);const N=async()=>{if(!t||t==="null"||t==="undefined"){P("Invalid post identifier",{variant:"error"}),a("/md/feed");return}C(!0);try{const x=await M(F.moddi.post(t),{requireAuth:!1}),A={...x,user_id:x.user_id??0,username:x.username||"Unknown",avatar_url:x.avatar_url||null,uid:x.uid||String(x.id)||t,text:x.text??null,beatmap_url:x.beatmap_url??null,beatmapset_id:x.beatmapset_id??null,beatmap_id:x.beatmap_id??null,beatmap_version:x.beatmap_version??null,tags:x.tags??null,reactions_count:Number(x.reactions_count??0),reacted_by_me:x.reacted_by_me??!1,comments_count:Number(x.comments_count??0)};d(A)}catch{P("Failed to load post",{variant:"error"}),a("/md/feed")}finally{C(!1)}},_=async()=>{if(s!=null&&s.id)try{const x=await M(F.moddi.postComments(s.id),{requireAuth:!1});c(x.items||[])}catch{}};i.useEffect(()=>{N()},[t]),i.useEffect(()=>{s!=null&&s.id&&_()},[s==null?void 0:s.id]);const b=x=>{d(x)},I=()=>{a("/md/feed")},Y=async x=>{if(x.preventDefault(),!(!l.trim()||!(s!=null&&s.id))){y(!0);try{await M(F.moddi.postComments(s.id),{method:"POST",body:JSON.stringify({text:l.trim(),parent_id:f||void 0})}),w(""),z(null),_(),N(),P("Comment posted!",{variant:"success"})}catch(A){P((A==null?void 0:A.message)||"Failed to post comment",{variant:"error"})}finally{y(!1)}}},K=x=>{c(A=>A.filter(ne=>ne.id!==x))};if(m)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!s)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const R=o.filter(x=>!x.parent_id),oe=new Map;return o.filter(x=>x.parent_id).forEach(x=>{const A=x.parent_id;oe.has(A)||oe.set(A,[]),oe.get(A).push(x)}),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"post-detail-header",style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>a("/md/feed"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(lt,{size:20})}),e.jsx("span",{className:"hide-on-mobile",style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx(mt,{post:s,section:"moddi",onUpdate:b,onDelete:I,me:S})}),S&&!f&&e.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:6},children:e.jsxs("form",{onSubmit:Y,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:l,onChange:x=>w(x.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:x=>{const A=x.target;A.style.height="auto",A.style.height=`${Math.min(A.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:q||!l.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:q?"...":"Post"})]})}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:R.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:R.map(x=>e.jsx(Ft,{comment:x,replies:oe.get(x.id)||[],me:S,section:"moddi",onReply:A=>z(A),onDelete:K,replyingTo:f,replyText:l,onReplyTextChange:w,onReplySubmit:Y,posting:q,onCancelReply:()=>{z(null),w("")},repliesMap:oe},x.id))})})]})}function Vt({queue:t}){return e.jsx(dt,{to:`/md/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",cursor:"pointer"},onMouseEnter:a=>a.currentTarget.style.background="rgba(255,255,255,0.02)",onMouseLeave:a=>a.currentTarget.style.background="rgba(255,255,255,0.01)",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(wt,{size:18}):e.jsx(Ne,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name}),t.is_member&&e.jsx("span",{className:"chip",style:{fontSize:11,padding:"2px 8px"},children:"Member"})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:t.description}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,t.member_count!==void 0&&Number(t.member_count)>0&&(Number(t.member_count)===1&&t.first_member_username?` and ${t.first_member_username}`:` & ${t.member_count} others`)]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function Qe(){return Te({queryKey:["moddi","queues"],queryFn:async()=>{const t=await M(F.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function ht(){const t=be();return qe({mutationFn:async a=>{var s;return await M(F.moddi.queues,{method:"POST",body:JSON.stringify({name:a.name.trim(),description:((s=a.description)==null?void 0:s.trim())||null,is_group:a.is_group??!1})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function Zt(){const[t,a]=ae.useState(!1),[s,d]=ae.useState(""),[o,c]=ae.useState(""),{data:m=[]}=Qe(),{data:C}=Ie(),{notify:S}=fe(),k=ht(),l=ae.useMemo(()=>C?m.some(f=>f.owner_id===C.id):!1,[C,m]),w=f=>{if(f&&f.preventDefault(),l){S("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!s.trim()){S("Queue name is required",{variant:"error"});return}k.mutate({name:s.trim(),description:o.trim()||null,is_group:!1},{onSuccess:()=>{S("Queue created!",{variant:"success"}),a(!1),d(""),c("")},onError:z=>{S((z==null?void 0:z.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>a(!0),children:e.jsx(Ee,{size:22})}),e.jsx(Pe,{open:t,onClose:()=>a(!1),children:e.jsxs("form",{onSubmit:w,className:"col",style:{gap:12},children:[l?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:s,onChange:f=>d(f.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:o,onChange:f=>c(f.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>a(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:k.isPending||l,children:k.isPending?"Creating...":"Create"})]})]})})]})}function us(){const{data:t=[],isLoading:a}=Qe(),{data:s}=Ie(),{queueOpenFilters:d}=ze(),o=ht(),{notify:c}=fe(),[m,C]=i.useState(!1),[S,k]=i.useState(""),[l,w]=i.useState(""),f=i.useMemo(()=>s?t.some(y=>y.owner_id===s.id):!1,[s,t]),z=async y=>{if(y.preventDefault(),f){c("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!S.trim()){c("Queue name is required",{variant:"error"});return}o.mutate({name:S.trim(),description:l.trim()||null,is_group:!1},{onSuccess:()=>{c("Queue created!",{variant:"success"}),C(!1),k(""),w("")},onError:P=>{c((P==null?void 0:P.message)||"Failed to create queue",{variant:"error"})}})},q=ae.useMemo(()=>t.filter(y=>{const P=(y.is_open??1)===1;return d.open&&d.closed?!0:d.open&&!d.closed?P:!d.open&&d.closed?!P:!0}),[t,d]);return e.jsxs("div",{className:"feed-container queues-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx(Zt,{}),e.jsx(We,{context:"moddi-queues"}),e.jsx("div",{className:"feed-header",children:e.jsx("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:0},children:f?e.jsx("div",{style:{padding:"12px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>C(!m),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Create a queue!"}),m?e.jsx(rt,{size:16}):e.jsx(_e,{size:16})]}),m&&e.jsx("form",{onSubmit:z,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:S,onChange:y=>k(y.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:l,onChange:y=>w(y.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:y=>{y.stopPropagation(),C(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:o.isPending||f,onClick:y=>y.stopPropagation(),children:o.isPending?"Creating...":"Create"})]})]})})]})})}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsx("div",{className:"col",style:{gap:0},children:a?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):q.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):q.map(y=>e.jsx(Vt,{queue:y},y.id))})})]})}function es({beatmapMeta:t,beatmapVersion:a}){const s=i.useRef(null),d=i.useRef(null),[o,c]=i.useState(!1),[m,C]=i.useState(!1),[S,k]=i.useState(0);i.useEffect(()=>{if(s.current&&d.current){const f=s.current.offsetWidth,z=d.current.scrollWidth;k(z),C(z>f)}},[t,a]);const l=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",a?` [${a}]`:""]}):a?`[${a}]`:"Beatmap",w=S>0?Math.max(3,S/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:s,className:"muted one-line",style:{fontSize:12,color:"#7b8491",flex:"0 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:m?"pointer":"default"},onMouseEnter:()=>m&&c(!0),onMouseLeave:()=>c(!1),children:[e.jsx("span",{ref:d,style:{display:"inline-block",animation:o&&m?`beatmap-marquee ${w}s linear infinite`:"none"},children:l}),o&&m&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:l})]})]})}function at({submission:t,canManage:a,onUpdate:s,onDelete:d,isGroup:o=!1}){const[c,m]=i.useState(!1),[C,S]=i.useState(!1),[k,l]=i.useState(null),[w,f]=i.useState(t.beatmapset_id),[z,q]=i.useState(t.beatmap_id),[y,P]=i.useState(!1),[N,_]=i.useState(!1),[b,I]=i.useState(null),[Y,K]=i.useState(!1),[R,oe]=i.useState(t.acknowledgments||[]),[x,A]=i.useState(t.acknowledged_by_me||!1),ne=i.useRef(null),D=i.useRef(null),h=i.useRef(null),{notify:v}=fe();i.useEffect(()=>{oe(t.acknowledgments||[]),A(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),i.useEffect(()=>{if(t.beatmap_url)try{const r=new URL(t.beatmap_url),T=r.pathname.match(/\/beatmapsets\/(\d+)/);if(T&&!t.beatmapset_id){const se=Number(T[1]);isNaN(se)||f(se)}const Z=r.hash.match(/#osu\/(\d+)/);if(Z&&!t.beatmap_id){const se=Number(Z[1]);isNaN(se)||q(se)}}catch(r){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,r)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),i.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:w,extracted_beatmap_id:z,beatmap_version:t.beatmap_version})},[t.id,w,z]),i.useEffect(()=>{if(!t.beatmap_url||k&&w)return;let r=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let T;try{T=new URL(t.beatmap_url)}catch(G){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,G);return}const Z=T.hash.match(/#osu\/(\d+)/),se=Z?Z[1]:null;T.hash="";const $={url:T.toString()};if(se?$.beatmap_id=se:t.beatmap_id&&($.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",$),!r){const G=await M(F.osu.resolveBeatmap+ut($),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",G),G.setId&&!w&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",G.setId),f(Number(G.setId))),(G.title||G.artist)&&l({title:G.title||null,artist:G.artist||null,mapper:G.mapper||null})}}catch(T){console.error("[QueueSubmission] Error fetching beatmap metadata:",T)}})(),()=>{r=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,k,w]),i.useEffect(()=>{if(!y||!h.current){I(null);return}const r=()=>{if(h.current){const T=h.current.getBoundingClientRect();I({top:T.bottom+8,right:window.innerWidth-T.right})}};return r(),window.addEventListener("resize",r),window.addEventListener("scroll",r,!0),()=>{window.removeEventListener("resize",r),window.removeEventListener("scroll",r,!0)}},[y]),i.useEffect(()=>{if(!C)return;const r=T=>{const Z=T.target;ne.current&&!ne.current.contains(Z)&&!Z.closest("[data-status-dropdown]")&&S(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[C]),i.useEffect(()=>{if(!y)return;const r=T=>{D.current&&!D.current.contains(T.target)&&h.current&&!h.current.contains(T.target)&&P(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[y]);const j=async r=>{if(!c){m(!0);try{await M(F.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:r})});const T={...t,status:r,updated_at:Math.floor(Date.now()/1e3)};s&&s(T),v("Status updated",{variant:"success"})}catch{v("Failed to update status",{variant:"error"})}finally{m(!1),S(!1)}}},ee=async()=>{if(!c){m(!0);try{const r=!!t.is_archived;await M(F.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!r})});const T={...t,is_archived:r?0:1,updated_at:Math.floor(Date.now()/1e3)};s&&s(T),v(r?"Unarchived":"Archived",{variant:"success"})}catch{v("Failed to update archive status",{variant:"error"})}finally{m(!1)}}},me=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){m(!0);try{await M(F.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),v("Submission deleted",{variant:"success"}),d&&d(t.id)}catch{v("Failed to delete submission",{variant:"error"})}finally{m(!1)}}},J=async()=>{if(!Y){K(!0);try{if(x){if(await M(F.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),A(!1),v("Unacknowledged",{variant:"info"}),s){const r={...t,acknowledged_by_me:!1};s(r)}}else if(await M(F.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),A(!0),v("Acknowledged",{variant:"success"}),s){const r={...t,acknowledged_by_me:!0};s(r)}}catch{v("Failed to update acknowledgment",{variant:"error"})}finally{K(!1)}}},Q={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},U={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},ie=w||t.beatmapset_id,X=ie?`https://assets.ppy.sh/beatmaps/${ie}/covers/card.jpg`:null;i.useEffect(()=>{X?console.log("[QueueSubmission] Background image URL:",X,"for beatmapset_id:",ie):console.log("[QueueSubmission] No background image URL - beatmapset_id:",ie,"submission.beatmapset_id:",t.beatmapset_id)},[X,ie,t.beatmapset_id]);const te=!!t.is_archived;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{position:"relative",borderRadius:12,overflow:"hidden",borderBottom:"1px solid rgba(255,255,255,0.06)",background:X?"transparent":"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",opacity:te?.6:1},onMouseEnter:r=>{X||(r.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)")},onMouseLeave:r=>{X||(r.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)")},children:[X&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:X,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.35,zIndex:0,pointerEvents:"none"},onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.75) 100%)",zIndex:0}})]}),e.jsx("div",{style:{position:"relative",zIndex:1,padding:"16px"},children:e.jsxs("div",{className:"row",style:{alignItems:"flex-start",justifyContent:"space-between",gap:12,marginBottom:12},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[t.beatmap_url&&e.jsx("div",{style:{marginBottom:8},children:e.jsx(es,{beatmapMeta:k,beatmapVersion:t.beatmap_version})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,marginTop:8},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]}),t.message&&e.jsx("div",{style:{marginTop:8,fontSize:13,lineHeight:1.5,color:"var(--text)"},children:t.message}),t.beatmap_url&&e.jsx("div",{style:{marginTop:12,display:"flex",alignItems:"center",gap:8},children:e.jsxs("button",{ref:h,className:"chip-btn link",onClick:r=>{r.preventDefault(),r.stopPropagation(),P(T=>!T)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(He,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(_e,{size:12,style:{marginLeft:4,opacity:.7}})]})})]}),a?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[R&&R.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",marginRight:4},children:[R.slice(0,5).map((r,T)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:T>0?-8:0,zIndex:R.length-T,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:T>0?-8:0,zIndex:R.length-T,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),R.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${R.length-5} more`,children:["+",R.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:J,disabled:Y||c,title:x?"Unacknowledge":"Acknowledge",style:{color:x?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:x?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!Y&&!c&&(r.currentTarget.style.background=x?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=x?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Nt,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ee,disabled:c,title:te?"Unarchive":"Archive",style:{color:te?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:te?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=te?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=te?"rgba(99, 102, 241, 0.1)":"transparent"},children:te?e.jsx(kt,{size:16}):e.jsx(_t,{size:16})}),e.jsx("button",{className:"icon-link",onClick:me,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(Ce,{size:16})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{ref:ne,onClick:()=>S(!C),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:Q[t.status]+"15",border:`1.5px solid ${Q[t.status]}50`,color:Q[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=Q[t.status]+"25",r.currentTarget.style.borderColor=Q[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=Q[t.status]+"15",r.currentTarget.style.borderColor=Q[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:U[t.status]}),e.jsx(_e,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:C?"rotate(180deg)":"rotate(0deg)"}})]}),C&&ne.current&&De.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const r=ne.current.getBoundingClientRect();return{top:r.bottom+6,right:window.innerWidth-r.right}})()},onClick:r=>r.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(r=>e.jsx("button",{onClick:()=>j(r),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:r===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:r===t.status?Q[r]+"15":"transparent",color:r===t.status?Q[r]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:T=>{r!==t.status&&(T.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:T=>{r!==t.status&&(T.currentTarget.style.background="transparent")},children:U[r]},r))}),document.body)]})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[R&&R.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",marginRight:4},children:[R.slice(0,5).map((r,T)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:T>0?-8:0,zIndex:R.length-T,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:T>0?-8:0,zIndex:R.length-T,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),R.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${R.length-5} more`,children:["+",R.length-5]})]}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:Q[t.status]+"15",border:`1.5px solid ${Q[t.status]}50`,color:Q[t.status],whiteSpace:"nowrap"},children:U[t.status]})]})]})})]}),y&&b&&t.beatmap_url&&e.jsxs("div",{ref:D,style:{position:"fixed",top:b.top,right:b.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>P(!1),children:[e.jsx(He,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ie&&e.jsx("button",{className:"menu-item",onClick:()=>{_(!0),P(!1)},children:"Preview"})]}),N&&ie&&e.jsx(pt,{open:N,onClose:()=>_(!1),downloadUrl:`${Mt}${F.osu.downloadBeatmapset(ie)}`,beatmapId:z??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}function ts({queueId:t,onSubmitted:a}){const[s,d]=ae.useState(!1),[o,c]=ae.useState(t),[m,C]=ae.useState(""),[S,k]=ae.useState(""),[l,w]=ae.useState(!1),{notify:f}=fe(),{data:z=[]}=Qe();ae.useEffect(()=>{c(t)},[t]);const q=async()=>{if(!o){f("Please select a queue",{variant:"error"});return}if(!m.trim()){f("Beatmap URL is required",{variant:"error"});return}w(!0);try{await M(F.moddi.queueSubmit(o),{method:"POST",body:JSON.stringify({beatmap_url:m.trim(),message:S.trim()||null})}),f("Submission created!",{variant:"success"}),C(""),k(""),d(!1),a==null||a()}catch(y){f((y==null?void 0:y.message)||"Failed to create submission",{variant:"error"})}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>d(!0),children:e.jsx(Ee,{size:22})}),e.jsx(Pe,{open:s,onClose:()=>d(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:o??"",onChange:y=>c(y.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),z.map(y=>e.jsx("option",{value:String(y.id),children:y.name},y.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:m,onChange:y=>C(y.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:S,onChange:y=>k(y.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),S.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[S.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:l,onClick:q,children:l?"Submitting...":"Submit"})]})]})})]})}const nt=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(zt,{components:{p:({children:a})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:a}),ul:({children:a})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:a}),ol:({children:a})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:a}),li:({children:a})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:a}),strong:({children:a})=>e.jsx("strong",{style:{fontWeight:600},children:a}),em:({children:a})=>e.jsx("em",{children:a}),code:({children:a})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:a}),h1:({children:a})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:a}),h2:({children:a})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:a}),h3:({children:a})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:a})},children:t})});function ms(){const{id:t}=ot(),a=Ue(),[s,d]=i.useState(null),[o,c]=i.useState([]),[m,C]=i.useState([]),[S,k]=i.useState(!0),[l,w]=i.useState(null),[f,z]=i.useState(!1),[q,y]=i.useState(!1),[P,N]=i.useState(""),[_,b]=i.useState(""),[I,Y]=i.useState(null),[K,R]=i.useState(!1),[oe,x]=i.useState(""),[A,ne]=i.useState(""),[D,h]=i.useState(""),[v,j]=i.useState(!1),[ee,me]=i.useState(!1),[J,Q]=i.useState("general"),[U,ie]=i.useState(!1),[X,te]=i.useState(!1),[r,T]=i.useState(null),[Z,se]=i.useState(""),[W,$]=i.useState([]),[G,ce]=i.useState(!1),ge=i.useRef(null),ue=i.useRef(null),xe=i.useRef(null),[ve,Fe]=i.useState([]),[je,Me]=i.useState(!1),[Se,we]=i.useState(null),{notify:p}=fe(),{queueStatusFilters:O}=ze(),L=async()=>{var n,g;if(t){k(!0);try{const u=await M(F.moddi.queue(t),{requireAuth:!1});d(u.queue||null),c(u.members||[]),C(u.submissions||[])}catch(u){(n=u==null?void 0:u.message)!=null&&n.includes("403")||(g=u==null?void 0:u.message)!=null&&g.includes("Forbidden")?(p("You do not have access to this queue",{variant:"error"}),a("/md/queues")):p("Failed to load queue",{variant:"error"})}finally{k(!1)}}};i.useEffect(()=>{L(),M(F.auth.me,{requireAuth:!1}).then(n=>w(n)).catch(()=>{})},[t]);const E=l&&s&&(s.owner_id===l.id||o.some(n=>n.user_id===l.id&&n.joined_at));l&&o.some(n=>n.user_id===l.id&&n.joined_at);const de=l&&s&&(s.owner_id===l.id||o.some(n=>n.user_id===l.id&&n.joined_at)),H=async n=>{if(n.preventDefault(),!s||s.is_open===0){p("Queue is closed for submissions",{variant:"error"});return}if(!P.trim()){p("Beatmap URL is required",{variant:"error"});return}y(!0);try{await M(F.moddi.queueSubmit(t),{method:"POST",body:JSON.stringify({beatmap_url:P.trim(),message:_.trim()||null})}),p("Submission created!",{variant:"success"}),z(!1),N(""),b(""),L()}catch(g){p((g==null?void 0:g.message)||"Failed to create submission",{variant:"error"})}finally{y(!1)}},le=n=>{C(g=>g.map(u=>u.id===n.id?n:u)),n.acknowledged_by_me!==void 0&&L()},Re=()=>{s&&(x(s.name),ne(s.description||""),h(s.rules||""),R(!0),Q("general"))},V=()=>{R(!1),x(""),ne(""),h("")},he=async()=>{if(!(!s||!de)){me(!0);try{const n=s.is_open!==1;await M(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:n})}),p(`Queue ${n?"opened":"closed"}`,{variant:"success"}),L()}catch(n){p((n==null?void 0:n.message)||"Failed to update status",{variant:"error"})}finally{me(!1)}}},Oe=async n=>{if(n.preventDefault(),!s||!oe.trim()){p("Queue name is required",{variant:"error"});return}ie(!0);try{const g=o.filter(u=>u.user_id!==s.owner_id&&u.role!=="owner").length>0;await M(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({name:oe.trim(),description:A.trim()||null,rules:D.trim()||null,is_group:g})}),p("Queue updated!",{variant:"success"}),V(),L()}catch(g){p((g==null?void 0:g.message)||"Failed to update queue",{variant:"error"})}finally{ie(!1)}};i.useEffect(()=>{if(!Z.trim()){$([]),ce(!1);return}const n=setTimeout(async()=>{try{const u=(await M(F.moddi.usersSearch(Z),{requireAuth:!1})).items||[];$(u),ce(u.length>0)}catch(g){console.error("Search failed:",g),$([]),ce(!1)}},300);return()=>clearTimeout(n)},[Z]);const pe=async n=>{if(!X){te(!0);try{await M(F.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:n})}),p("Invite sent!",{variant:"success"}),se(""),$([]),ce(!1),L()}catch(g){p((g==null?void 0:g.message)||"Failed to invite member",{variant:"error"})}finally{te(!1)}}},ye=async()=>{if(!(!t||!E))try{const n=await M(F.moddi.queueBlockedUsers(t));Fe(n.blocked||[])}catch(n){console.error("Failed to load blocked users:",n)}},Ae=async n=>{if(!(!t||je)&&confirm("Block this user from submitting to this queue?")){Me(!0);try{await M(F.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:n})}),p("User blocked",{variant:"success"}),ye(),se(""),$([]),ce(!1)}catch(g){p((g==null?void 0:g.message)||"Failed to block user",{variant:"error"})}finally{Me(!1)}}},$e=async n=>{if(!(!t||Se===n)){we(n);try{await M(F.moddi.queueUnblockUser(t,n),{method:"DELETE"}),p("User unblocked",{variant:"success"}),ye()}catch(g){p((g==null?void 0:g.message)||"Failed to unblock user",{variant:"error"})}finally{we(null)}}};i.useEffect(()=>{J==="members"&&E&&t&&ye()},[J,E,t]);const ft=async()=>{if(s&&confirm(`Are you sure you want to delete "${s.name}"? This action cannot be undone.`)){j(!0);try{await M(F.moddi.queue(t),{method:"DELETE"}),p("Queue deleted",{variant:"success"}),a("/md/queues")}catch(n){p((n==null?void 0:n.message)||"Failed to delete queue",{variant:"error"})}finally{j(!1)}}},xt=async n=>{if(!l||!s||l.id!==s.owner_id){p("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){T(n);try{await M(F.moddi.queueMember(t,n),{method:"DELETE"}),p("Member removed",{variant:"success"});const u=o.filter(B=>B.user_id!==n).some(B=>B.user_id!==(s==null?void 0:s.owner_id)&&B.role!=="owner");if(s&&s.is_group===1&&!u)try{await M(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}L()}catch(g){p((g==null?void 0:g.message)||"Failed to remove member",{variant:"error"})}finally{T(null)}}},yt=async()=>{if(l&&confirm("Leave this queue? You will need to be invited again to rejoin.")){T(l.id);try{await M(F.moddi.queueMember(t,l.id),{method:"DELETE"}),p("Left queue",{variant:"success"});const g=o.filter(u=>u.user_id!==l.id).some(u=>u.user_id!==(s==null?void 0:s.owner_id)&&u.role!=="owner");if(s&&s.is_group===1&&!g)try{await M(F.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}a("/md/queues")}catch(n){p((n==null?void 0:n.message)||"Failed to leave queue",{variant:"error"})}finally{T(null)}}},bt=async n=>{if(confirm("Cancel this invitation?")){T(n);try{await M(F.moddi.queueMember(t,n),{method:"DELETE"}),p("Invitation canceled",{variant:"success"}),L()}catch(g){p((g==null?void 0:g.message)||"Failed to cancel invitation",{variant:"error"})}finally{T(null)}}};return i.useEffect(()=>{if(!K)return;const n=g=>{const u=g.target;u.closest(".manage-overlay")||u.closest(".manage-overlay-backdrop")||!u.closest(".manage-popup")&&xe.current&&!xe.current.contains(u)&&V()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[K]),i.useEffect(()=>{if(!G)return;const n=g=>{const u=g.target;ge.current&&!ge.current.contains(u)&&ue.current&&!ue.current.contains(u)&&ce(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[G]),S?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):s?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t&&e.jsx(ts,{queueId:t,onSubmitted:()=>L()}),e.jsx(We,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>a("/md/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(lt,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:s.name}),de&&e.jsxs("button",{onClick:he,disabled:ee,className:`queue-status-badge ${s.is_open===1?"status-open":"status-closed"}`,title:s.is_open===1?"Close queue":"Open queue","aria-label":s.is_open===1?"Close queue":"Open queue",children:[s.is_open===1?e.jsx(Be,{size:14}):e.jsx(Ye,{size:14}),e.jsx("span",{children:s.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[E&&e.jsx("button",{ref:xe,className:"icon-link",onClick:Re,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(Ct,{size:18})}),o.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:o.filter(n=>n.joined_at!==null).sort((n,g)=>{const u=n.role==="owner"||n.user_id===(s==null?void 0:s.owner_id),B=g.role==="owner"||g.user_id===(s==null?void 0:s.owner_id);return u&&!B?-1:!u&&B?1:(g.joined_at||0)-(n.joined_at||0)}).map(n=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Y(n.user_id),onMouseLeave:()=>Y(null),children:[e.jsx(dt,{to:`/profile/${n.user_id}`,className:"queue-member-avatar",title:n.username,children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:n.username.charAt(0).toUpperCase()})}),I===n.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[n.username," ",n.role!=="member"?`(${n.role})`:""]})]},n.user_id))})]})]}),s.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:s.description}),s.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(nt,{content:s.rules})]}),s.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:12,opacity:s.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:s.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>s.is_open===1&&z(!f),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",s.is_open===0&&"(Closed)"]}),s.is_open===1&&(f?e.jsx(ke,{size:16}):e.jsx(Ee,{size:16}))]}),f&&e.jsx("form",{onSubmit:H,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:P,onChange:n=>N(n.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:_,onChange:n=>b(n.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),_.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[_.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:n=>{n.stopPropagation(),z(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:q,onClick:n=>n.stopPropagation(),children:q?"Submitting...":"Submit"})]})]})})]}),e.jsxs("div",{className:"profile-tabs-unified",style:{marginTop:24},children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Submission sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"active",onClick:n=>{const g=n.currentTarget.closest(".profile-tabs-unified");g.querySelectorAll(".profile-tab").forEach(B=>{B.classList.remove("active"),B.setAttribute("aria-selected","false")}),n.currentTarget.classList.add("active"),n.currentTarget.setAttribute("aria-selected","true"),g.querySelector(".profile-tabs-content").setAttribute("data-active","active")},children:"Active"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"archived",onClick:n=>{const g=n.currentTarget.closest(".profile-tabs-unified");g.querySelectorAll(".profile-tab").forEach(B=>{B.classList.remove("active"),B.setAttribute("aria-selected","false")}),n.currentTarget.classList.add("active"),n.currentTarget.setAttribute("aria-selected","true"),g.querySelector(".profile-tabs-content").setAttribute("data-active","archived")},children:"Archived"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"active",children:[e.jsx("div",{className:"panel active",children:e.jsx("div",{className:"col",style:{gap:0},children:m.filter(n=>!!!n.is_archived&&O[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):m.filter(n=>!!!n.is_archived&&O[n.status]).map(n=>e.jsx(at,{submission:n,canManage:!!E,isGroup:(s==null?void 0:s.is_group)===1,onUpdate:le,onDelete:g=>{C(u=>u.filter(B=>B.id!==g))}},n.id))})}),e.jsx("div",{className:"panel archived",children:e.jsx("div",{className:"col",style:{gap:0},children:m.filter(n=>!!n.is_archived&&O[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):m.filter(n=>!!n.is_archived&&O[n.status]).map(n=>e.jsx(at,{submission:n,canManage:!!E,isGroup:(s==null?void 0:s.is_group)===1,onUpdate:le,onDelete:g=>{C(u=>u.filter(B=>B.id!==g))}},n.id))})})]})]}),K&&De.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:V}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:V,"aria-label":"Close",children:e.jsx(ke,{size:18})}),e.jsxs("div",{className:"col",style:{gap:0,padding:"0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:16,padding:"20px 16px 12px",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("div",{className:"title",style:{fontSize:20,margin:0,padding:0,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Manage Queue"}),e.jsxs("div",{className:"tabs",role:"tablist",style:{margin:0},children:[e.jsx("button",{role:"tab","aria-selected":J==="general",className:`tab ${J==="general"?"active":""}`,onClick:()=>Q("general"),children:"General"}),e.jsx("button",{role:"tab","aria-selected":J==="rules",className:`tab ${J==="rules"?"active":""}`,onClick:()=>Q("rules"),children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":J==="members",className:`tab ${J==="members"?"active":""}`,onClick:()=>Q("members"),children:"Members"})]})]}),e.jsx("hr",{className:"subtle-divider",style:{margin:"0 16px"}}),e.jsxs("form",{onSubmit:Oe,className:"col",style:{gap:0,padding:"16px"},children:[J==="general"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:oe,onChange:n=>x(n.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:A,onChange:n=>ne(n.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:ft,disabled:v||U,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(Ce,{size:14,style:{marginRight:6}}),v?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:U||v,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:U||v,style:{fontSize:13,padding:"8px 16px"},children:U?"Updating...":"Save Changes"})]})]})]}),J==="rules"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:D,onChange:n=>h(n.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),D&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(nt,{content:D})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:U||v,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:U||v,style:{fontSize:13,padding:"8px 16px"},children:U?"Updating...":"Save Changes"})]})]}),J==="members"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ge,type:"text",placeholder:"Search username or ID",value:Z,onChange:n=>se(n.target.value),onKeyDown:n=>{n.key==="Enter"&&n.preventDefault()},onFocus:()=>{W.length>0&&ce(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),G&&W.length>0&&e.jsx("div",{ref:ue,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:W.map(n=>{const g=o.some(re=>re.user_id===n.id&&re.joined_at),u=o.some(re=>re.user_id===n.id&&re.invited_at&&!re.joined_at),B=ve.some(re=>re.user_id===n.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:n.username}),g&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),u&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",n.id," • osu ",n.osu_user_id]})]})]}),E&&!g&&!u&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:re=>{re.stopPropagation(),X||pe(n.id)},disabled:X,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ct,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re=>{re.stopPropagation(),B?$e(n.id):Ae(n.id)},disabled:je||Se===n.id,title:B?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:B?"var(--accent)":"var(--danger)"},children:B?e.jsx(Be,{size:16}):e.jsx(Ye,{size:16})})]})]},n.id)})})})]})]}),o.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const n=o.filter(u=>u.joined_at!==null).sort((u,B)=>{const re=u.role==="owner"||u.user_id===(s==null?void 0:s.owner_id),Le=B.role==="owner"||B.user_id===(s==null?void 0:s.owner_id);return re&&!Le?-1:!re&&Le?1:(B.joined_at||0)-(u.joined_at||0)}),g=o.filter(u=>u.invited_at!==null&&u.joined_at===null);return e.jsxs(e.Fragment,{children:[n.map(u=>{const B=l&&s&&l.id===s.owner_id,re=u.user_id===(l==null?void 0:l.id),Le=u.user_id===(s==null?void 0:s.owner_id)||u.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.role})]})]}),B&&!Le&&e.jsx("button",{className:"icon-link",onClick:()=>xt(u.user_id),disabled:r===u.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(Ce,{size:16})}),!B&&re&&e.jsx("button",{className:"icon-link",onClick:yt,disabled:r===u.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(Tt,{size:16})})]},u.user_id)}),g.length>0&&e.jsx(e.Fragment,{children:g.map(u=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>bt(u.user_id),disabled:r===u.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(ke,{size:16})})]},u.user_id))})]})})()})]}),E&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),ve.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:ve.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:n.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:n.username}),n.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",n.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>$e(n.user_id),disabled:Se===n.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(Be,{size:16})})]},n.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:U||v,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:U||v,style:{fontSize:13,padding:"8px 16px"},children:U?"Updating...":"Save Changes"})]})]})]})]})]})]}),document.body),e.jsx("style",{children:`
        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function ps(){const{data:t=[],isLoading:a}=Wt(),s=Qt(),d=$t(),{notify:o}=fe(),c=Ue(),m=be(),[C,S]=i.useState(new Set),{data:k}=Ie(),[l,w]=i.useState(!1),[f,z]=i.useState(!1),[q,y]=i.useState(!1),P=i.useRef(null),N=i.useRef(null),_=!!(k!=null&&k.is_admin||k!=null&&k.is_mod);Ht(P,N,l,()=>w(!1));const b=async h=>{s.mutate(h,{onSuccess:()=>{}})},I=async h=>{h.startsWith("n:")&&d.mutate(h)},Y=async()=>{const h=t.filter(v=>!v.read&&(v.id.startsWith("n:")||v.kind==="system"&&!v.id.startsWith("b:"))).map(v=>v.id);h.length>0&&(await b(h),o("All notifications marked as read",{variant:"success"}))},K=h=>{if(!h)return null;try{const v=JSON.parse(h);if((v==null?void 0:v.type)==="queue_invite"&&(v!=null&&v.queue_id))return v}catch{}return null},R=async(h,v)=>{if(!C.has(h.id)){S(j=>new Set(j).add(h.id));try{await M(F.moddi.queueAccept(String(v)),{method:"POST"}),o("Invitation accepted!",{variant:"success"}),I(h.id),c(`/md/queues/${v}`)}catch(j){o((j==null?void 0:j.message)||"Failed to accept invitation",{variant:"error"})}finally{S(j=>{const ee=new Set(j);return ee.delete(h.id),ee})}}},oe=async(h,v)=>{if(!C.has(h.id)){S(j=>new Set(j).add(h.id));try{await M(F.moddi.queueDeny(String(v)),{method:"POST"}),o("Invitation declined",{variant:"success"}),I(h.id)}catch(j){o((j==null?void 0:j.message)||"Failed to decline invitation",{variant:"error"})}finally{S(j=>{const ee=new Set(j);return ee.delete(h.id),ee})}}},x=h=>K(h.text)?e.jsx(ct,{size:20,color:"#a78bfa"}):h.kind==="star"?e.jsx(Xe,{size:20,color:"#f59e0b"}):h.kind==="likes5"?e.jsx(Ge,{size:20,color:"#f472b6"}):h.kind==="comment"?e.jsx(Ne,{size:20,color:"#60a5fa"}):h.kind==="inspiration"?e.jsx(Ne,{size:20,color:"#7dd3fc"}):h.kind==="reaction"?e.jsx(Ve,{size:20,color:"#10b981"}):h.id.startsWith("b:")?e.jsx(Ze,{size:20,color:"#a78bfa"}):null,A=h=>K(h.text)?"Queue Invitation":h.kind==="star"?"Star":h.kind==="likes5"?"Likes":h.kind==="comment"?"Comment":h.kind==="inspiration"?"Inspiration":h.kind==="reaction"?"Reaction":h.id.startsWith("b:")?"Global":"System",ne=t.filter(h=>!h.read&&!(h.id.startsWith("b:")&&h.expiresAt&&h.expiresAt<=Date.now())).length,D=async h=>{if(!(!(k!=null&&k.id)||q)){y(!0);try{const v={kind:h};h==="system"&&(v.text="Test system notification"),await M(F.admin.notificationsTest,{method:"POST",body:JSON.stringify(v)}),o("Test notification sent!",{variant:"success"}),m.invalidateQueries({queryKey:["notifications","detailed"]}),m.invalidateQueries({queryKey:["notifications"]})}catch(v){o((v==null?void 0:v.message)||"Failed to send test notification",{variant:"error"})}finally{y(!1),w(!1),z(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[_&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:P,className:"btn secondary",onClick:()=>w(!l),disabled:q,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(_e,{size:14,style:{transition:"transform 0.2s ease",transform:l?"rotate(180deg)":"rotate(0deg)"}})]}),l&&e.jsxs("div",{ref:N,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("star"),disabled:q,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("likes5"),disabled:q,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("comment"),disabled:q,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("inspiration"),disabled:q,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("reaction"),disabled:q,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>D("system"),disabled:q,children:"Test System"})]})]}),ne>0&&e.jsxs("button",{className:"btn secondary",onClick:Y,children:[e.jsx(Je,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),_&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>z(!0),children:e.jsx(Ke,{size:22})}),e.jsx(Pe,{open:f,onClose:()=>z(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>D("star"),disabled:q,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Xe,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("likes5"),disabled:q,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ge,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("comment"),disabled:q,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ne,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("inspiration"),disabled:q,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ne,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("reaction"),disabled:q,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ve,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>D("system"),disabled:q,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ze,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:a?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(h=>!(h.id.startsWith("b:")&&h.expiresAt&&h.expiresAt<=Date.now())).map(h=>{const v=({notif:j})=>{const[ee,me]=i.useState(0),[J,Q]=i.useState(!1),U=i.useRef(null),ie=i.useRef(null),X=i.useRef(null),te=i.useRef(null),r=W=>{j.id.startsWith("n:")&&(U.current=W.touches[0].clientX,te.current=W.touches[0].clientY,ie.current=Date.now(),Q(!1))},T=W=>{if(U.current===null||te.current===null||!j.id.startsWith("n:"))return;const $=W.touches[0].clientX,G=W.touches[0].clientY,ce=$-U.current,ge=Math.abs(G-te.current);Math.abs(ce)>ge&&(Q(!0),me(Math.max(-80,Math.min(0,ce))))},Z=()=>{if(U.current===null)return;ee<=-60&&I(j.id),me(0),Q(!1),U.current=null,te.current=null,ie.current=null},se=j.id.startsWith("n:");return e.jsxs("div",{ref:X,style:{position:"relative",background:j.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:j.videoId?"pointer":"default",opacity:j.read?.7:1,transform:`translateX(${ee}px)`,transition:J?"none":"transform 0.2s ease",touchAction:se?"pan-x pan-y":"pan-y"},onTouchStart:r,onTouchMove:T,onTouchEnd:Z,onTouchCancel:Z,onClick:()=>{Math.abs(ee)>10||(!j.read&&j.id.startsWith("n:")&&b([j.id]),j.videoId&&(window.location.hash="/mp/feed"))},children:[se&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(ee)/80,pointerEvents:"none",zIndex:0},children:e.jsx(Ce,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:x(j)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:A(j)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(j.createdAt).toLocaleDateString()}),j.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:W=>{W.stopPropagation(),I(j.id)},style:{padding:4},children:e.jsx(Ce,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const W=K(j.text);return W?`${W.inviter_username} invited you to join queue: ${W.queue_name}`:j.text||(j.kind==="star"?"One of your posts was starred!":j.kind==="likes5"?"One of your posts reached 5 likes!":j.kind==="comment"?"Someone commented on your post":j.kind==="inspiration"?"Someone is inspired by you!":j.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const W=K(j.text);return W&&!C.has(j.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:$=>{$.stopPropagation(),R(j,W.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Je,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:$=>{$.stopPropagation(),oe(j,W.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(ke,{size:14,style:{marginRight:4}}),"Decline"]})]}):W&&C.has(j.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),j.read&&j.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(j.readAt).toLocaleString()]})]})]})]},j.id)};return e.jsx(v,{notif:h},h.id)})})})]})}export{gt as C,We as D,Yt as F,Jt as M,ps as N,cs as P,us as Q,rs as a,Ht as b,Ie as c,os as d,Ut as e,ls as f,Qt as g,$t as h,ds as i,ms as j,ze as u};
