import{r as v,j as e,U as z,F as I}from"./vendor-react-DMzs0ry_.js";import{a as w}from"./Popup-CClAB4Rw.js";import{u as C,A as y,a as E}from"./index-_LcB0oUy.js";function _({comment:i,replies:u,me:s,onReply:g,onDelete:p,replyingTo:x,replyText:r,onReplyTextChange:a,onReplySubmit:f,posting:o,onCancelReply:d,section:h,repliesMap:n}){const[b,l]=v.useState(!1),m=v.useRef(null),{notify:j}=C(),k=s&&(s.id===i.user_id||s.is_admin||s.is_mod),S=async()=>{if(confirm("Delete this comment?"))try{const t=h==="mappi"?y.videos.comments(i.post_id)+`/${i.id}`:y.moddi.postComments(i.post_id)+`/${i.id}`;await E(t,{method:"DELETE"}),p(i.id),j("Comment deleted",{variant:"success"})}catch{j("Failed to delete comment",{variant:"error"})}finally{l(!1)}};return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:13,fontWeight:500},children:i.username}),e.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(i.created_at*1e3).toLocaleDateString()})]}),e.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:i.text}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:e.jsxs("button",{onClick:()=>g(i.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[e.jsx(z,{size:14}),"Reply"]})}),x===i.id&&s&&e.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("form",{onSubmit:f,style:{display:"flex",alignItems:"flex-end",gap:6},children:[e.jsx("textarea",{placeholder:`Reply to ${i.username}...`,value:r||"",onChange:t=>a==null?void 0:a(t.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:t=>{const c=t.target;c.style.height="auto",c.style.height=`${Math.min(c.scrollHeight,100)}px`},autoFocus:!0}),e.jsx("button",{type:"submit",className:"btn compact",disabled:o||!(r!=null&&r.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:o?"...":"Reply"}),d&&e.jsx("button",{type:"button",onClick:d,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid rgba(255,255,255,0.12)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),k&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:m,className:"icon-link",onClick:()=>l(!b),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:e.jsx(I,{size:16})}),e.jsx(w,{open:b,onClose:()=>l(!1),buttonRef:m,children:e.jsx("button",{className:"menu-item",onClick:S,style:{color:"var(--danger)"},children:"Delete"})})]})]}),u.length>0&&e.jsx("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid rgba(255,255,255,0.06)"},children:u.map(t=>e.jsx(_,{comment:t,replies:(n==null?void 0:n.get(t.id))||[],me:s,onReply:g,onDelete:p,replyingTo:x,replyText:r,onReplyTextChange:a,onReplySubmit:f,posting:o,onCancelReply:d,section:h,repliesMap:n},t.id))})]})}export{_ as C};
