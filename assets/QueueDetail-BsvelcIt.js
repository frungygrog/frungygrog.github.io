import{r as o,j as e,I as Fe,X as Re,Y as Me,Z as ye,w as $e,N as qe,i as Ie,T as Pe,_ as Ee,v as Le,$ as We,L as Ae,c as ae,a0 as De,t as fe,a1 as Oe,a2 as Be}from"./vendor-react-BxoNMQk4.js";import{u as xe,b as Qe}from"./index-BKcUzMqZ.js";import"./vendor-CmWQUY7N.js";import"./editor-components-xbbWPDXL.js";const re="https://api.osumappi.ng";function me(r){var d;return(d=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s===r))==null?void 0:d[1]}function Ue({submission:r,canManage:d,onUpdate:s}){const[x,g]=o.useState(!1),[z,$]=o.useState(!1),[w,U]=o.useState(null),T=o.useRef(null),{notify:u}=xe();o.useEffect(()=>{if(!r.beatmap_url||!r.beatmapset_id&&!r.beatmap_id||w)return;let i=!1;return(async()=>{try{let p;try{p=new URL(r.beatmap_url)}catch{return}const b=p.hash.match(/#osu\/(\d+)/),_=b?b[1]:null;p.hash="";const D=p.toString(),I=new URLSearchParams({url:D});_&&I.set("beatmap_id",_);const W=await fetch(`${re}/api/osu/beatmap/resolve?${I.toString()}`,{credentials:"include"});if(W.ok&&!i){const S=await W.json();(S.title||S.artist)&&U({title:S.title||null,artist:S.artist||null,mapper:S.mapper||null})}}catch{}})(),()=>{i=!0}},[r.beatmap_url,r.beatmapset_id,r.beatmap_id]),o.useEffect(()=>{if(!z)return;const i=p=>{const b=p.target;T.current&&!T.current.contains(b)&&!b.closest("[data-status-dropdown]")&&$(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[z]);const X=async i=>{if(!x){g(!0);try{const p=me("csrf")||"";if((await fetch(`${re}/api/moddi/queues/${r.queue_id}/submissions/${r.id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":p},body:JSON.stringify({status:i})})).ok){const _={...r,status:i,updated_at:Math.floor(Date.now()/1e3)};s&&s(_),u("Status updated",{variant:"success"})}else u("Failed to update status",{variant:"error"})}catch{u("Failed to update status",{variant:"error"})}finally{g(!1),$(!1)}}},E=async()=>{if(!x){g(!0);try{const i=me("csrf")||"",p=!!r.is_archived;if((await fetch(`${re}/api/moddi/queues/${r.queue_id}/submissions/${r.id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":i},body:JSON.stringify({is_archived:!p})})).ok){const _={...r,is_archived:p?0:1,updated_at:Math.floor(Date.now()/1e3)};s&&s(_),u(p?"Unarchived":"Archived",{variant:"success"})}else u("Failed to update archive status",{variant:"error"})}catch{u("Failed to update archive status",{variant:"error"})}finally{g(!1)}}},m={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},q={unchecked:"Unchecked",accepted:"Accepted",denied:"Denied",finished:"Finished"},L=r.beatmapset_id?`https://assets.ppy.sh/beatmaps/${r.beatmapset_id}/covers/card.jpg`:null,y=!!r.is_archived;return e.jsxs("div",{style:{position:"relative",borderRadius:12,overflow:"hidden",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",opacity:y?.6:1},onMouseEnter:i=>i.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:i=>i.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[L&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"200px",backgroundImage:`url(${L})`,backgroundSize:"cover",backgroundPosition:"center",opacity:.3,zIndex:0}}),e.jsx("div",{style:{position:"relative",zIndex:1,padding:"16px"},children:e.jsxs("div",{className:"row",style:{alignItems:"flex-start",justifyContent:"space-between",gap:12,marginBottom:12},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[w?e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:600,marginBottom:4},children:w.title||"Unknown Title"}),e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:2},children:w.artist||"Unknown Artist"}),w.mapper&&e.jsxs("div",{className:"muted",style:{fontSize:12},children:["Mapped by ",w.mapper]}),r.beatmap_version&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:4},children:r.beatmap_version})]}):e.jsx("div",{style:{marginBottom:8},children:e.jsxs("a",{href:r.beatmap_url,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",gap:6,color:"#7dd3fc",textDecoration:"none",fontSize:14},children:[e.jsx(Fe,{size:14}),"View beatmap"]})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,marginTop:8},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:r.username}),e.jsx("span",{style:{fontSize:13},children:r.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(r.created_at*1e3).toLocaleDateString()})]}),r.message&&e.jsxs("div",{style:{marginTop:12,padding:10,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,fontSize:13,lineHeight:1.5},children:[e.jsx("div",{className:"muted",style:{fontSize:11,marginBottom:4,fontWeight:600},children:"Message:"}),r.message]})]}),d?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"icon-link",onClick:E,disabled:x,title:y?"Unarchive":"Archive",style:{color:y?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:y?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:i=>{x||(i.currentTarget.style.background=y?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:i=>{i.currentTarget.style.background=y?"rgba(99, 102, 241, 0.1)":"transparent"},children:y?e.jsx(Re,{size:16}):e.jsx(Me,{size:16})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{ref:T,onClick:()=>$(!z),disabled:x,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:m[r.status]+"15",border:`1.5px solid ${m[r.status]}50`,color:m[r.status],whiteSpace:"nowrap",cursor:x?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:x?.6:1},onMouseEnter:i=>{x||(i.currentTarget.style.background=m[r.status]+"25",i.currentTarget.style.borderColor=m[r.status]+"70",i.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:i=>{i.currentTarget.style.background=m[r.status]+"15",i.currentTarget.style.borderColor=m[r.status]+"50",i.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:q[r.status]}),e.jsx($e,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:z?"rotate(180deg)":"rotate(0deg)"}})]}),z&&T.current&&ye.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const i=T.current.getBoundingClientRect();return{top:i.bottom+6,right:window.innerWidth-i.right}})()},onClick:i=>i.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(i=>e.jsx("button",{onClick:()=>X(i),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:i===r.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:i===r.status?m[i]+"15":"transparent",color:i===r.status?m[i]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:p=>{i!==r.status&&(p.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:p=>{i!==r.status&&(p.currentTarget.style.background="transparent")},children:q[i]},i))}),document.body)]})]}):e.jsx("span",{style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:m[r.status]+"15",border:`1.5px solid ${m[r.status]}50`,color:m[r.status],whiteSpace:"nowrap"},children:q[r.status]})]})})]})}const h="https://api.osumappi.ng";function N(r){var d;return(d=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s===r))==null?void 0:d[1]}const he=({content:r})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Be,{components:{p:({children:d})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:d}),ul:({children:d})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:d}),ol:({children:d})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:d}),li:({children:d})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:d}),strong:({children:d})=>e.jsx("strong",{style:{fontWeight:600},children:d}),em:({children:d})=>e.jsx("em",{children:d}),code:({children:d})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:d}),h1:({children:d})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:d}),h2:({children:d})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:d}),h3:({children:d})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:d})},children:r})});function Ge(){const{id:r}=qe(),d=Ie(),[s,x]=o.useState(null),[g,z]=o.useState([]),[$,w]=o.useState([]),[U,T]=o.useState(!0),[u,X]=o.useState(null),[E,m]=o.useState(!1),[q,L]=o.useState(!1),[y,i]=o.useState(""),[p,b]=o.useState(""),[_,D]=o.useState(null),[I,W]=o.useState(!1),[S,H]=o.useState(""),[ne,J]=o.useState(""),[O,Y]=o.useState(""),[C,ie]=o.useState(!1),[be,oe]=o.useState(!1),[k,B]=o.useState("general"),[v,le]=o.useState(!1),[G,de]=o.useState(!1),[V,P]=o.useState(null),[Q,ce]=o.useState(""),[K,A]=o.useState([]),[Z,F]=o.useState(!1),ee=o.useRef(null),te=o.useRef(null),se=o.useRef(null),{notify:c}=xe(),{queueStatusFilters:ue}=Qe(),R=async()=>{if(r){T(!0);try{const t=await fetch(`${h}/api/moddi/queues/${r}`,{credentials:"include"});if(t.ok){const n=await t.json();x(n.queue),z(n.members||[]),w(n.submissions||[])}else t.status===403?(c("You do not have access to this queue",{variant:"error"}),d("/md/queues")):c("Failed to load queue",{variant:"error"})}catch{c("Failed to load queue",{variant:"error"})}finally{T(!1)}}};o.useEffect(()=>{R(),fetch(`${h}/api/me`,{credentials:"include"}).then(t=>t.ok?t.json():null).then(t=>X(t)).catch(()=>{})},[r]);const pe=u&&s&&(s.owner_id===u.id||g.some(t=>t.user_id===u.id&&t.joined_at));u&&g.some(t=>t.user_id===u.id&&t.joined_at);const ge=u&&s&&(s.owner_id===u.id||g.some(t=>t.user_id===u.id&&t.joined_at)),ve=async t=>{if(t.preventDefault(),!s||s.is_open===0){c("Queue is closed for submissions",{variant:"error"});return}if(!y.trim()){c("Beatmap URL is required",{variant:"error"});return}L(!0);try{const n=N("csrf")||"",a=await fetch(`${h}/api/moddi/queues/${r}/submit`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":n},body:JSON.stringify({beatmap_url:y.trim(),message:p.trim()||null})});if(a.ok)c("Submission created!",{variant:"success"}),m(!1),i(""),b(""),R();else{const l=await a.json().catch(()=>({}));c(l.error||"Failed to submit",{variant:"error"})}}catch{c("Failed to submit",{variant:"error"})}finally{L(!1)}},je=t=>{w(n=>n.map(a=>a.id===t.id?t:a))},we=()=>{s&&(H(s.name),J(s.description||""),Y(s.rules||""),W(!0),B("general"))},M=()=>{W(!1),H(""),J(""),Y("")},Se=async()=>{if(!(!s||!ge)){oe(!0);try{const t=N("csrf")||"",n=s.is_open!==1,a=await fetch(`${h}/api/moddi/queues/${r}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({is_open:n})});if(a.ok)c(`Queue ${n?"opened":"closed"}`,{variant:"success"}),R();else{const l=await a.json().catch(()=>({}));c(l.error||"Failed to update status",{variant:"error"})}}catch{c("Failed to update status",{variant:"error"})}finally{oe(!1)}}},ke=async t=>{if(t.preventDefault(),!s||!S.trim()){c("Queue name is required",{variant:"error"});return}le(!0);try{const n=N("csrf")||"",a=g.filter(f=>f.user_id!==s.owner_id&&f.role!=="owner").length>0,l=await fetch(`${h}/api/moddi/queues/${r}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":n},body:JSON.stringify({name:S.trim(),description:ne.trim()||null,rules:O.trim()||null,is_group:a})});if(l.ok)c("Queue updated!",{variant:"success"}),M(),R();else{const f=await l.json().catch(()=>({}));c(f.error||"Failed to update queue",{variant:"error"})}}catch{c("Failed to update queue",{variant:"error"})}finally{le(!1)}};o.useEffect(()=>{if(!Q.trim()){A([]),F(!1);return}const t=setTimeout(async()=>{try{const n=await fetch(`${h}/api/moddi/users/search?q=${encodeURIComponent(Q)}`,{credentials:"include"});if(n.ok){const l=(await n.json()).items||[];A(l),F(l.length>0)}else{const a=await n.text().catch(()=>"");console.error("Search failed:",n.status,a),A([]),F(!1)}}catch(n){console.error("Search error:",n),A([]),F(!1)}},300);return()=>clearTimeout(t)},[Q]);const Te=async t=>{if(!G){de(!0);try{const n=N("csrf")||"",a=await fetch(`${h}/api/moddi/queues/${r}/invite`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":n},body:JSON.stringify({user_id:t})});if(a.ok)c("Invite sent!",{variant:"success"}),ce(""),A([]),F(!1),R();else{const l=await a.json().catch(()=>({}));c(l.error||"Failed to invite member",{variant:"error"})}}catch{c("Failed to invite member",{variant:"error"})}finally{de(!1)}}},_e=async()=>{if(s&&confirm(`Are you sure you want to delete "${s.name}"? This action cannot be undone.`)){ie(!0);try{const t=N("csrf")||"",n=await fetch(`${h}/api/moddi/queues/${r}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":t}});if(n.ok)c("Queue deleted",{variant:"success"}),d("/md/queues");else{const a=await n.json().catch(()=>({}));c(a.error||"Failed to delete queue",{variant:"error"})}}catch{c("Failed to delete queue",{variant:"error"})}finally{ie(!1)}}},Ce=async t=>{if(!u||!s||u.id!==s.owner_id){c("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){P(t);try{const n=N("csrf")||"",a=await fetch(`${h}/api/moddi/queues/${r}/members/${t}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":n}});if(a.ok){c("Member removed",{variant:"success"});const f=g.filter(j=>j.user_id!==t).some(j=>j.user_id!==(s==null?void 0:s.owner_id)&&j.role!=="owner");s&&s.is_group===1&&!f&&((await fetch(`${h}/api/moddi/queues/${r}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":n},body:JSON.stringify({is_group:!1})})).ok||console.warn("Failed to convert queue back to individual after removing last member")),R()}else{const l=await a.json().catch(()=>({}));c(l.error||"Failed to remove member",{variant:"error"})}}catch{c("Failed to remove member",{variant:"error"})}finally{P(null)}}},Ne=async()=>{if(u&&confirm("Leave this queue? You will need to be invited again to rejoin.")){P(u.id);try{const t=N("csrf")||"",n=await fetch(`${h}/api/moddi/queues/${r}/members/${u.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":t}});if(n.ok){c("Left queue",{variant:"success"});const l=g.filter(f=>f.user_id!==u.id).some(f=>f.user_id!==(s==null?void 0:s.owner_id)&&f.role!=="owner");s&&s.is_group===1&&!l&&((await fetch(`${h}/api/moddi/queues/${r}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({is_group:!1})})).ok||console.warn("Failed to convert queue back to individual after leaving")),d("/md/queues")}else{const a=await n.json().catch(()=>({}));c(a.error||"Failed to leave queue",{variant:"error"})}}catch{c("Failed to leave queue",{variant:"error"})}finally{P(null)}}},ze=async t=>{if(confirm("Cancel this invitation?")){P(t);try{const n=N("csrf")||"",a=await fetch(`${h}/api/moddi/queues/${r}/members/${t}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":n}});if(a.ok)c("Invitation canceled",{variant:"success"}),R();else{const l=await a.json().catch(()=>({}));c(l.error||"Failed to cancel invitation",{variant:"error"})}}catch{c("Failed to cancel invitation",{variant:"error"})}finally{P(null)}}};return o.useEffect(()=>{if(!I)return;const t=n=>{const a=n.target;a.closest(".manage-overlay")||a.closest(".manage-overlay-backdrop")||!a.closest(".manage-popup")&&se.current&&!se.current.contains(a)&&M()};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[I]),o.useEffect(()=>{if(!Z)return;const t=n=>{const a=n.target;ee.current&&!ee.current.contains(a)&&te.current&&!te.current.contains(a)&&F(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[Z]),U?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):s?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link",onClick:()=>d("/md/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(Pe,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:s.name}),ge&&e.jsxs("button",{onClick:Se,disabled:be,className:`queue-status-badge ${s.is_open===1?"status-open":"status-closed"}`,title:s.is_open===1?"Close queue":"Open queue","aria-label":s.is_open===1?"Close queue":"Open queue",children:[s.is_open===1?e.jsx(Ee,{size:14}):e.jsx(Le,{size:14}),e.jsx("span",{children:s.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[pe&&e.jsx("button",{ref:se,className:"icon-link",onClick:we,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(We,{size:18})}),g.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:g.filter(t=>t.joined_at!==null).sort((t,n)=>{const a=t.role==="owner"||t.user_id===(s==null?void 0:s.owner_id),l=n.role==="owner"||n.user_id===(s==null?void 0:s.owner_id);return a&&!l?-1:!a&&l?1:(n.joined_at||0)-(t.joined_at||0)}).map(t=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>D(t.user_id),onMouseLeave:()=>D(null),children:[e.jsx(Ae,{to:`/profile/${t.user_id}`,className:"queue-member-avatar",title:t.username,children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:t.username.charAt(0).toUpperCase()})}),_===t.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[t.username," ",t.role!=="member"?`(${t.role})`:""]})]},t.user_id))})]})]}),s.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:s.description}),s.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(he,{content:s.rules})]}),s.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:12,opacity:s.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:s.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>s.is_open===1&&m(!E),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",s.is_open===0&&"(Closed)"]}),s.is_open===1&&(E?e.jsx(ae,{size:16}):e.jsx(De,{size:16}))]}),E&&e.jsx("form",{onSubmit:ve,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:y,onChange:t=>i(t.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:p,onChange:t=>b(t.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),p.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[p.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:t=>{t.stopPropagation(),m(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:q,onClick:t=>t.stopPropagation(),children:q?"Submitting...":"Submit"})]})]})})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("div",{className:"col",style:{gap:0},children:$.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No submissions yet."}):$.filter(t=>{const n=!!t.is_archived;return ue[t.status]&&(ue.archived||!n)}).map(t=>e.jsx(Ue,{submission:t,canManage:!!pe,onUpdate:je},t.id))})}),I&&ye.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:M}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:M,"aria-label":"Close",children:e.jsx(ae,{size:18})}),e.jsxs("div",{className:"col",style:{gap:0,padding:"0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:16,padding:"20px 16px 12px",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("div",{className:"title",style:{fontSize:20,margin:0,padding:0,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Manage Queue"}),e.jsxs("div",{className:"tabs",role:"tablist",style:{margin:0},children:[e.jsx("button",{role:"tab","aria-selected":k==="general",className:`tab ${k==="general"?"active":""}`,onClick:()=>B("general"),children:"General"}),e.jsx("button",{role:"tab","aria-selected":k==="rules",className:`tab ${k==="rules"?"active":""}`,onClick:()=>B("rules"),children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":k==="members",className:`tab ${k==="members"?"active":""}`,onClick:()=>B("members"),children:"Members"})]})]}),e.jsx("hr",{className:"subtle-divider",style:{margin:"0 16px"}}),e.jsxs("form",{onSubmit:ke,className:"col",style:{gap:0,padding:"16px"},children:[k==="general"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:S,onChange:t=>H(t.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:ne,onChange:t=>J(t.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:_e,disabled:C||v,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(fe,{size:14,style:{marginRight:6}}),C?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:M,disabled:v||C,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:v||C,style:{fontSize:13,padding:"8px 16px"},children:v?"Updating...":"Save Changes"})]})]})]}),k==="rules"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:O,onChange:t=>Y(t.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),O&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(he,{content:O})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:M,disabled:v||C,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:v||C,style:{fontSize:13,padding:"8px 16px"},children:v?"Updating...":"Save Changes"})]})]}),k==="members"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ee,type:"text",placeholder:"Search username or ID",value:Q,onChange:t=>ce(t.target.value),onKeyDown:t=>{t.key==="Enter"&&t.preventDefault()},onFocus:()=>{K.length>0&&F(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),Z&&K.length>0&&e.jsx("div",{ref:te,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:K.map(t=>{const n=g.some(l=>l.user_id===t.id&&l.joined_at),a=g.some(l=>l.user_id===t.id&&l.invited_at&&!l.joined_at);return e.jsxs("button",{className:"menu-item",onClick:()=>{!n&&!a&&!G&&Te(t.id)},disabled:n||a||G,style:{justifyContent:"flex-start",opacity:n||a?.5:1,cursor:n||a?"not-allowed":"pointer"},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:20,height:20,style:{borderRadius:"50%",marginRight:8}}),e.jsxs("div",{style:{flex:1,textAlign:"left",minWidth:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:500},children:t.username}),e.jsxs("div",{className:"muted",style:{fontSize:11},children:["id ",t.id," â€¢ osu ",t.osu_user_id]})]}),n&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11},children:"Already a member"}),a&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11},children:"Invited"})]},t.id)})})})]})]}),g.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const t=g.filter(a=>a.joined_at!==null).sort((a,l)=>{const f=a.role==="owner"||a.user_id===(s==null?void 0:s.owner_id),j=l.role==="owner"||l.user_id===(s==null?void 0:s.owner_id);return f&&!j?-1:!f&&j?1:(l.joined_at||0)-(a.joined_at||0)}),n=g.filter(a=>a.invited_at!==null&&a.joined_at===null);return e.jsxs(e.Fragment,{children:[t.map(a=>{const l=u&&s&&u.id===s.owner_id,f=a.user_id===(u==null?void 0:u.id),j=a.user_id===(s==null?void 0:s.owner_id)||a.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:a.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:a.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:a.role})]})]}),l&&!j&&e.jsx("button",{className:"icon-link",onClick:()=>Ce(a.user_id),disabled:V===a.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(fe,{size:16})}),!l&&f&&e.jsx("button",{className:"icon-link",onClick:Ne,disabled:V===a.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(Oe,{size:16})})]},a.user_id)}),n.length>0&&e.jsx(e.Fragment,{children:n.map(a=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:a.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:a.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>ze(a.user_id),disabled:V===a.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(ae,{size:16})})]},a.user_id))})]})})()})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:M,disabled:v||C,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:v||C,style:{fontSize:13,padding:"8px 16px"},children:v?"Updating...":"Save Changes"})]})]})]})]})]})]}),document.body),e.jsx("style",{children:`
        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}export{Ge as default};
