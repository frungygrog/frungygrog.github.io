const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-BYBP-09Q.js","assets/index-D-vrz8OI.js","assets/vendor-react-_vsaDC62.js","assets/vendor-DBgzFpze.js","assets/editor-components-CKFEosPJ.js","assets/editor-components-Bzmrvihl.css","assets/index-Do5egyzH.css"])))=>i.map(i=>d[i]);
import{u as yt,a as b,A as p,_ as ue,B as vt,b as et}from"./index-D-vrz8OI.js";import{r as a,R as fe,i as wt,j as r,b as jt,a as _t,L as tt,p as St,D as Et,E as kt,G as nt,I as Ct,J as rt,A as Rt,c as It}from"./vendor-react-_vsaDC62.js";import{P as Tt}from"./Popup-BYBP-09Q.js";import{P as Nt}from"./beatmap-preview-Da_UNwHS.js";import{C as zt}from"./Comment-B04jU-d1.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";import"./editor-lib-Cf56EpaA.js";const w={};function Bt(){var Ge,Ke,Ze;const[E,N]=a.useState(w.history||[]),[d,D]=a.useState(w.index||-1),t=d>=0?E[d]:null,[X,ze]=a.useState(!1),[st,Me]=a.useState(!1),[it,Le]=a.useState(!1),[me,Q]=a.useState(!1),pe=fe.useRef(null),[he,ge]=a.useState(!1),xe=fe.useRef(null),[z,at]=a.useState(null),[be,U]=a.useState(!1),[ye,G]=a.useState(!1),ve=fe.useRef(null),we=fe.useRef(null),[f,je]=a.useState(!1),[Ae,De]=a.useState([]),[B,K]=a.useState(""),[_e,Se]=a.useState(null),[Ee,Pe]=a.useState(!1),[M,L]=a.useState(!0),{notify:C}=yt(),[j,V]=a.useState(w.queue||[]),A=a.useRef(w.seenIds||new Set),Fe=a.useRef(new Set),ke=a.useRef(!1),Oe=a.useRef(null),[Ue,q]=a.useState(w.eligibleCount||null),[Be,H]=a.useState(w.viewedCount||0),[P,F]=a.useState(!1),R=a.useRef(w.lastShownVideoId||null);a.useEffect(()=>()=>{w.history=E,w.index=d,w.queue=j,w.seenIds=A.current,w.eligibleCount=Ue,w.viewedCount=Be,w.lastShownVideoId=R.current},[E,d,j,Ue,Be]);function ot(){try{const e=Array.from(A.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function Z(){try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),s=["standard","taiko","mania","catch"],i=Array.from(new Set(n.filter(o=>s.includes(o))));return i.length?i:["standard"]}catch{return["standard"]}}const lt=()=>{const e=new Set;return R.current!==null&&e.add(R.current),Array.from(A.current).slice(-200).forEach(s=>e.add(s)),j.forEach(s=>e.add(s.id)),Array.from(e)},Ve=async(e=5)=>{var n,s,i,o,c,y,k,h,g,I;if(ke.current)return[];ke.current=!0;try{const _=lt(),m=Z().join(",");if(Oe.current!==!1)try{const l=await b(p.feed.batch+et({size:String(e),exclude:_.join(","),modes:m}),{requireAuth:!1}),u=l&&Array.isArray(l.items)?l.items:[],S=new Set,$=u.filter(v=>S.has(v.id)?!1:(S.add(v.id),!0)),bt=new Set(j.map(v=>v.id)),ce=$.filter(v=>!A.current.has(v.id)&&!bt.has(v.id)&&v.id!==R.current);if(ce.length>0&&V(v=>{const J=new Set(v.map(Ne=>Ne.id)),de=ce.filter(Ne=>!J.has(Ne.id));return[...v,...de]}),ce.length===0&&j.length===0)try{const v=await b(p.feed.progress(m),{requireAuth:!1}),J=Number(v.eligible||0),de=Number(v.viewed||0);q(J),H(de),F(J>0&&de>=J)}catch{}return ce}catch(l){if((n=l==null?void 0:l.message)!=null&&n.includes("401")||(s=l==null?void 0:l.message)!=null&&s.includes("Unauthorized"))return Le(!0),[];if((i=l==null?void 0:l.message)!=null&&i.includes("429")||(o=l==null?void 0:l.message)!=null&&o.includes("rate limit"))return C("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];((c=l==null?void 0:l.message)!=null&&c.includes("404")||(y=l==null?void 0:l.message)!=null&&y.includes("Not Found"))&&(Oe.current=!1)}const T=[],le=new Set(j.map(l=>l.id));let Y=[..._];for(let l=0;l<e;l++)try{const u=await b(p.feed.next+et({exclude:Y.join(","),modes:m}),{requireAuth:!1}),S=u&&("id"in u?u:u.video)||null;if(!S)break;if(A.current.has(S.id)||le.has(S.id)||S.id===R.current){Y.push(S.id);continue}T.push(S),Y.push(S.id),le.add(S.id)}catch(u){(k=u==null?void 0:u.message)!=null&&k.includes("401")||(h=u==null?void 0:u.message)!=null&&h.includes("Unauthorized")?Le(!0):((g=u==null?void 0:u.message)!=null&&g.includes("429")||(I=u==null?void 0:u.message)!=null&&I.includes("rate limit"))&&C("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(T.length>0&&V(l=>{const u=new Set(l.map($=>$.id)),S=T.filter($=>!u.has($.id));return[...l,...S]}),T.length===0&&j.length===0)try{const l=await b(p.feed.progress(m),{requireAuth:!1});q(Number(l.eligible||0)),H(Number(l.viewed||0)),F(Number(l.caught_up||0)===1)}catch{}return T}catch{return[]}finally{ke.current=!1}},ee=async()=>{if(!X){ze(!0);try{j.length<=2&&Ve(5).catch(()=>{});let e;if(j.length>0)e=j[0],e&&V(n=>n.filter(i=>i.id!==e.id));else{const n=await Ve(3);n.length>0&&(e=n[0],n.length>1&&V(s=>{const i=new Set(s.map(c=>c.id)),o=n.slice(1).filter(c=>!i.has(c.id));return[...s,...o]}))}if(e){if(R.current=e.id,A.current.add(e.id),ot(),N(n=>{const s=[...n.slice(0,d+1),e];return D(s.length-1),s}),!Fe.current.has(e.id)){Fe.current.add(e.id);try{const n=await b(p.videos.view(e.id),{method:"POST"});n&&N(s=>{const i=[...s],o=i.findIndex(c=>c.id===e.id);return o!==-1&&(i[o]={...i[o],views_count:n.views_count??i[o].views_count??0,viewed_by_me:!0}),i})}catch{}}}else try{const n=Z().join(","),s=await b(p.feed.progress(n),{requireAuth:!1}),i=Number(s.eligible||0),o=Number(s.viewed||0);q(i),H(o),F(i>0&&o>=i)}catch{}}finally{ze(!1)}}},Ce=()=>{d>0&&(D(d-1),U(!1))},Re=()=>{if(!M&&(W.current=!0,se.current=!0,x.current)){const e=x.current;e.muted=!1,L(!1),e.play().catch(()=>{})}if(d<E.length-1){const e=E[d+1];e&&(R.current=e.id),D(d+1),U(!1);return}P||ee()},te=a.useRef(0),ne=a.useRef(null),re=a.useRef(null),Ie=a.useRef({goNext:Re,goPrev:Ce,index:d,history:E,loading:X,exhausted:P});a.useEffect(()=>{Ie.current={goNext:Re,goPrev:Ce,index:d,history:E,loading:X,exhausted:P}},[Re,Ce,d,E,X,P]),a.useEffect(()=>{const e=Qe.current;if(!e)return;const n=o=>{if(e){const h=e.getBoundingClientRect(),g=o.clientX,I=o.clientY;if(g<h.left||g>h.right||I<h.top||I>h.bottom)return}o.preventDefault(),o.stopPropagation();const c=Date.now();if(c<te.current||(te.current=c+1e3,Math.abs(o.deltaY)<Math.abs(o.deltaX)))return;const{goNext:y,goPrev:k}=Ie.current;o.deltaY>0?y():k()},s=o=>{ne.current=o.touches[0].clientY,re.current=Date.now()},i=o=>{if(ne.current===null||re.current===null)return;const c=o.changedTouches[0].clientY,y=Date.now(),k=ne.current-c,h=y-re.current;if(ne.current=null,re.current=null,Math.abs(k)<50||h>300)return;const g=Date.now();if(g<te.current)return;te.current=g+1e3;const{goNext:I,goPrev:_}=Ie.current;k>0?I():_()};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchend",i,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",s),e.removeEventListener("touchend",i),window.removeEventListener("wheel",n,{capture:!0})}},[]);const ct=async()=>{var e,n;if(t){Me(!0);try{const s=t.liked_by_me?"DELETE":"POST",i=await b(p.videos.like(t.id),{method:s});N(o=>{const c=[...o];return c[d]={...c[d],liked_by_me:!t.liked_by_me,likes_count:i.likes_count},c})}catch(s){((e=s==null?void 0:s.message)!=null&&e.includes("429")||(n=s==null?void 0:s.message)!=null&&n.includes("rate limit"))&&C("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{Me(!1)}}};async function qe(e){if(t)try{await b(p.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),C("Thanks for your report.",{variant:"info"})}catch{C("Report failed",{variant:"error"})}finally{Q(!1)}}a.useEffect(()=>{if(!me)return;const e=n=>{pe.current&&!pe.current.contains(n.target)&&Q(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[me]),a.useEffect(()=>{if(!he)return;const e=n=>{xe.current&&!xe.current.contains(n.target)&&ge(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[he]),a.useEffect(()=>{if(!ye)return;const e=n=>{ve.current&&!ve.current.contains(n.target)&&we.current&&!we.current.contains(n.target)&&G(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ye]),a.useEffect(()=>{E.length===0&&ee()},[]),a.useEffect(()=>{t&&(R.current=t.id)},[t==null?void 0:t.id]),a.useEffect(()=>{(async()=>{try{const e=Z().join(","),n=await b(p.feed.progress(e),{requireAuth:!1}),s=Number(n.eligible||0),i=Number(n.viewed||0);q(s),H(i);const o=s>0&&i>=s;F(o)}catch{}})()},[]),a.useEffect(()=>{const e=()=>{N([]),V([]),A.current.clear(),R.current=null,D(-1),F(!1),(async()=>{try{const n=Z().join(","),s=await b(p.feed.progress(n),{requireAuth:!1}),i=Number(s.eligible||0),o=Number(s.viewed||0);q(i),H(o),F(!1)}catch{}ee()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),a.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const n=JSON.parse(e);if(Array.isArray(n))for(const s of n)typeof s=="number"&&A.current.add(s)}}catch{}},[]),a.useEffect(()=>{(async()=>{try{const e=await b(p.auth.me,{requireAuth:!1});at(e)}catch{}})()},[]);const W=a.useRef(!1),dt=async e=>{if(e)try{const n=e.playback_url||(e.stream_uid?`https://videodelivery.net/${e.stream_uid}/manifest/video.m3u8`:null);if(!n)return;(async()=>{try{const i=await fetch(n,{priority:"high"});if(i.ok){const o=await i.text(),y=new TextEncoder().encode(o).buffer,{setCached:k}=await ue(async()=>{const{setCached:_}=await import("./Popup-BYBP-09Q.js").then(m=>m.v);return{setCached:_}},__vite__mapDeps([0,1,2,3,4,5,6]));await k(n,y,!0,e.stream_uid);const h=o.split(`
`),g=[];let I=n.substring(0,n.lastIndexOf("/")+1);for(let _=0;_<h.length&&g.length<3;_++){const m=h[_].trim();if(m&&!m.startsWith("#")&&(m.endsWith(".ts")||m.endsWith(".m4s"))){const T=m.startsWith("http")?m:I+m;g.push(T)}}for(const _ of g.slice(0,2))fetch(_,{priority:"high"}).then(async m=>{if(m.ok)try{const T=await m.arrayBuffer(),{setCached:le}=await ue(async()=>{const{setCached:Y}=await import("./Popup-BYBP-09Q.js").then(l=>l.v);return{setCached:Y}},__vite__mapDeps([0,1,2,3,4,5,6]));await le(_,T,!1,e.stream_uid)}catch{}}).catch(()=>{})}}catch{}})()}catch{}};a.useEffect(()=>{U(!1),je(!1),W.current?L(!1):L(!0)},[t==null?void 0:t.id]),a.useEffect(()=>{x.current&&(x.current.muted=M)},[M]),a.useEffect(()=>{if(!t)return;const e=t.playback_url||(t.stream_uid?`https://videodelivery.net/${t.stream_uid}/manifest/video.m3u8`:null);e&&fetch(e,{priority:"high"}).then(async s=>{if(s.ok)try{const i=await s.text(),c=new TextEncoder().encode(i).buffer,{setCached:y}=await ue(async()=>{const{setCached:h}=await import("./Popup-BYBP-09Q.js").then(g=>g.v);return{setCached:h}},__vite__mapDeps([0,1,2,3,4,5,6]));await y(e,c,!0,t.stream_uid);const{memoryCache:k}=await ue(async()=>{const{memoryCache:h}=await import("./Popup-BYBP-09Q.js").then(g=>g.h);return{memoryCache:h}},__vite__mapDeps([0,1,2,3,4,5,6]));k.set(e,c)}catch{}}).catch(()=>{});const n=j.length>0?j[0]:d<E.length-1?E[d+1]:null;n&&n.id!==t.id&&dt(n),x.current&&(()=>{const i=x.current;i&&i===x.current&&(!W.current?(i.muted=!0,i.play().catch(c=>{c.name!=="AbortError"&&c.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",c)})):(i.muted=!1,L(!1),i.play().then(()=>{}).catch(c=>{c.name==="AbortError"||c.name==="NotAllowedError"||(console.debug("Unmuted play failed, falling back to muted:",c),i===x.current&&(i.muted=!0,L(!0),i.play().catch(y=>{y.name!=="AbortError"&&y.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",y)})))})))})()},[t==null?void 0:t.id,j,d,E]);const se=a.useRef(!1),ut=e=>{x.current=e,e&&(se.current&&W.current?(e.muted=!1,L(!1),e.play().then(()=>{se.current=!1}).catch(()=>{e.muted=!0,L(!0),se.current=!1,e.play().catch(()=>{})})):e.muted=M)},He=async()=>{if(t!=null&&t.id)try{const e=await b(p.videos.comments(t.id),{requireAuth:!1});De(e.items||[])}catch{}};a.useEffect(()=>{f&&(t!=null&&t.id)&&He()},[f,t==null?void 0:t.id]);const We=async e=>{if(e.preventDefault(),!(!B.trim()||!(t!=null&&t.id))){Pe(!0);try{await b(p.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:B.trim(),parent_id:_e||void 0})}),K(""),Se(null),He(),N(n=>{const s=[...n],i=s.findIndex(o=>o.id===t.id);return i!==-1&&(s[i]={...s[i],comments_count:(s[i].comments_count||0)+1}),s}),C("Comment posted!",{variant:"success"})}catch(n){C((n==null?void 0:n.message)||"Failed to post comment",{variant:"error"})}finally{Pe(!1)}}},ft=e=>{De(n=>n.filter(s=>s.id!==e)),N(n=>{const s=[...n],i=s.findIndex(o=>o.id===(t==null?void 0:t.id));return i!==-1&&(s[i]={...s[i],comments_count:Math.max(0,(s[i].comments_count||0)-1)}),s})},Ye=Ae.filter(e=>!e.parent_id),ie=new Map;Ae.filter(e=>e.parent_id).forEach(e=>{const n=e.parent_id;ie.has(n)||ie.set(n,[]),ie.get(n).push(e)});const x=a.useRef(null),ae=a.useRef(null),O=a.useRef(!1),mt=()=>{if(!x.current||O.current)return;const e=x.current,n=!M;L(n),e.muted=n,n||(W.current=!0),!n&&e.paused&&e.play().catch(s=>{console.debug("Play failed after unmute:",s)})},$e=()=>{x.current&&(O.current=!1,ae.current=window.setTimeout(()=>{O.current=!0;const e=x.current;e&&!e.paused&&e.pause()},200))},Te=()=>{if(ae.current&&(clearTimeout(ae.current),ae.current=null),O.current&&x.current){const e=x.current;e.paused&&e.play().catch(n=>console.debug("Resume failed:",n)),O.current=!1}},pt=()=>{$e()},ht=e=>{O.current&&e.preventDefault(),Te()},Je=!!(z!=null&&z.is_admin||z!=null&&z.is_mod);async function gt(){if(!t)return;const e=!t.is_starred,n=e?"star":"unstar";try{await b(p.admin.videosAction(t.id,n),{method:"POST"}),N(s=>{const i=[...s];return i[d]={...i[d],is_starred:e},i}),ge(!1),C(e?"Post starred":"Star removed",{variant:"success"})}catch{C("Action failed",{variant:"error"})}}async function Xe(){if(t&&confirm("Permanently delete this video?"))try{await b(p.videos.delete(t.id),{method:"DELETE"}),C("Deleted",{variant:"warn"}),Q(!1),N(e=>{const n=e.filter((s,i)=>i!==d);return n.length===0?(D(-1),setTimeout(ee,0)):D(s=>Math.max(0,Math.min(s,n.length-1))),n})}catch{alert("Delete failed")}}wt();const Qe=a.useRef(null),[oe,xt]=a.useState(0);return a.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&xt(n.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),r.jsxs(r.Fragment,{children:[r.jsx(vt,{paused:!1}),r.jsxs("div",{ref:Qe,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[P&&r.jsx("div",{className:"chip info",style:{position:"absolute",top:oe+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),r.jsx("div",{className:"video-area",style:{position:"absolute",top:oe,left:0,right:0,bottom:f?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:it?r.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[r.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),r.jsx("button",{className:"btn",onClick:()=>window.location.href=p.auth.login,children:"Login with osu!"})]}):t?r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:be&&t.beatmapset_id?r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:r.jsx(Nt,{downloadUrl:t.beatmapset_id?p.osu.downloadBeatmapset(t.beatmapset_id):"",beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{U(!1),window.location.hash="/editor"}})}):r.jsxs("div",{style:{width:f?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:f?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:f?`calc(50vh - ${oe}px)`:`calc(100vh - ${oe}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),r.jsx("div",{style:{position:"relative",zIndex:1},children:r.jsxs("div",{onClick:mt,onMouseDown:$e,onMouseUp:Te,onMouseLeave:Te,onTouchStart:pt,onTouchEnd:ht,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[r.jsx(Tt,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t!=null&&t.width&&(t!=null&&t.height)?t.width/t.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:M,controls:!1,onVideoRef:ut}),r.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:M?1:0},children:M?r.jsx(jt,{size:20,color:"#fff"}):r.jsx(_t,{size:20,color:"#fff"})})]})})]})}):P?null:r.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[r.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),r.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[r.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),r.jsx("div",{children:"• Click video to toggle mute/unmute"}),r.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!be&&r.jsxs("div",{style:{position:"absolute",right:f?12:16,top:"50%",display:"flex",flexDirection:"column",gap:f?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:f?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[r.jsx(tt,{to:`/profile/${(Ge=t.uploader)==null?void 0:Ge.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Ke=t.uploader)!=null&&Ke.avatar_url?r.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):r.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:ct,disabled:st,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?r.jsx(St,{size:28}):r.jsx(Et,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:()=>je(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(kt,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{ref:we,onClick:()=>G(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(nt,{size:24})}),ye&&r.jsxs("div",{ref:ve,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>G(!1),children:[r.jsx(nt,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&r.jsx("button",{className:"menu-item",onClick:()=>{U(!0),G(!1)},children:"Preview"})]})]}),Je?r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>ge(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(rt,{size:24})}),he&&r.jsxs("div",{ref:xe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("button",{className:"menu-item",onClick:gt,children:t.is_starred?"Unstar post":"Star post"}),r.jsx("button",{className:"menu-item",onClick:Xe,children:"Delete video"})]})]}):r.jsx("button",{onClick:()=>Q(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(Ct,{size:24})}),me&&r.jsxs("div",{ref:pe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),r.jsx("button",{className:"menu-item",onClick:()=>qe("unrelated"),children:"Unrelated"}),r.jsx("button",{className:"menu-item",onClick:()=>qe("explicit"),children:"Explicit"}),Je&&r.jsx("button",{className:"menu-item",onClick:Xe,children:"Delete video"})]})]}),t&&!be&&r.jsxs("div",{style:{position:"absolute",left:f?12:16,bottom:f?"55%":80,right:f?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:f?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:f?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:r.jsx(tt,{to:`/profile/${(Ze=t.uploader)==null?void 0:Ze.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:f?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var i,o,c;const e=(i=t.uploader)==null?void 0:i.is_admin,n=(o=t.uploader)==null?void 0:o.is_mod,s=e?"#fff3bf":n?"#d7fbe8":"#fff";return r.jsxs(r.Fragment,{children:[r.jsxs("span",{style:{color:s},children:["@",(c=t.uploader)==null?void 0:c.username]}),t.is_starred&&r.jsx(Rt,{size:f?14:16,color:"#f59e0b",title:"Starred"}),(e||n)&&r.jsx(rt,{size:f?12:14,color:s,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&r.jsx("div",{style:{color:"#fff",fontSize:f?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&r.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:f?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),f&&t&&r.jsxs(r.Fragment,{children:[r.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),r.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[r.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),r.jsx("button",{onClick:()=>je(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:r.jsx(It,{size:24})})]}),r.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Ye.length===0?r.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):r.jsx("div",{className:"col",style:{gap:0},children:Ye.map(e=>r.jsx(zt,{comment:e,replies:ie.get(e.id)||[],me:z,section:"mappi",onReply:n=>Se(n),onDelete:ft,replyingTo:_e,replyText:B,onReplyTextChange:K,onReplySubmit:We,posting:Ee,onCancelReply:()=>{Se(null),K("")}},e.id))})}),z&&!_e&&r.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:r.jsxs("form",{onSubmit:We,style:{display:"flex",alignItems:"flex-end",gap:8},children:[r.jsx("textarea",{placeholder:"Write a comment...",value:B,onChange:e=>K(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),r.jsx("button",{type:"submit",className:"btn compact",disabled:Ee||!B.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:Ee?"...":"Post"})]})})]})]})]})]})}export{Bt as default};
