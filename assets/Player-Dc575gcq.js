import{r as i,j as t}from"./vendor-react-BxoNMQk4.js";import{H as l}from"./vendor-CmWQUY7N.js";const k=({playbackUrl:u,streamUID:s,aspectRatio:a,preferNative:d=!1,autoplay:f=!1,loop:M=!1,muted:S=!1,controls:H=!0,onVideoRef:w,onClick:h})=>{const[g,L]=i.useState(1.7777777777777777),c=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches;i.useEffect(()=>{if(!c)return;const e=()=>L(window.innerWidth/Math.max(1,window.innerHeight));return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[c]);const p=i.useRef(null),E=`${i.useMemo(()=>{const e=1.3333333333333333,o=16/9,m=typeof a=="number"&&isFinite(a)&&a>0?a:null;if(m)return Math.min(o,Math.max(e,m));const x=c?g:16/9;return Math.min(o,Math.max(e,x))},[c,g,a])} / 1`,n=i.useMemo(()=>d?u||(s?`https://videodelivery.net/${s}/manifest/video.m3u8`:null):null,[d,u,s]);i.useEffect(()=>{if(!d||!n)return;let e=null,o=null;const x=setTimeout(()=>{const r=p.current;r&&(r.canPlayType("application/vnd.apple.mpegurl")?(r.src=n,o=()=>{console.warn("Native HLS playback failed")},r.addEventListener("error",o),f&&r.play().catch(v=>{console.debug("Autoplay prevented:",v)})):l.isSupported()?(e=new l({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90}),e.loadSource(n),e.attachMedia(r),e.on(l.Events.MANIFEST_PARSED,()=>{f&&r.play().catch(v=>{console.debug("Autoplay prevented:",v)})}),e.on(l.Events.ERROR,(v,b)=>{if(b.fatal)switch(b.type){case l.ErrorTypes.NETWORK_ERROR:console.warn("HLS network error, trying to recover..."),e==null||e.startLoad();break;case l.ErrorTypes.MEDIA_ERROR:console.warn("HLS media error, trying to recover..."),e==null||e.recoverMediaError();break;default:console.error("HLS fatal error:",b),e==null||e.destroy(),e=null;break}})):console.error("HLS is not supported in this browser"))},0);return()=>{clearTimeout(x);const r=p.current;e&&(e.destroy(),e=null),r&&(o&&r.removeEventListener("error",o),r.src="")}},[d,n,f]),i.useEffect(()=>{w&&w(p.current)},[w,d,n]);const R="100%",y=c?{width:"100%",maxWidth:R,maxHeight:"100%",aspectRatio:E,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"}:{width:"auto",maxWidth:R,maxHeight:"100%",height:"var(--player-height)",aspectRatio:E,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"};if(d&&n)return t.jsx("div",{style:y,onClick:h,onTouchEnd:e=>{h&&(e.preventDefault(),h())},children:t.jsx("video",{ref:p,autoPlay:f,loop:M,muted:S,controls:H,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:h?"pointer":"default"},children:"Your browser does not support the video tag."},n)});if(s){const e=`https://iframe.videodelivery.net/${s}`;return t.jsx(t.Fragment,{children:t.jsx("div",{style:y,children:t.jsx("iframe",{src:e,title:"Clip",allow:"autoplay; encrypted-media; picture-in-picture; fullscreen",allowFullScreen:!0,style:{flex:1,width:"100%",height:"100%",border:0}},s)})})}return u?t.jsx("div",{style:y,children:t.jsx("video",{controls:!0,style:{width:"100%",height:"100%"},poster:void 0,children:t.jsx("source",{src:u,type:"application/x-mpegURL"})})}):t.jsx("div",{children:"No video"})};export{k as P};
