import{s as ht,t as fe,v as be,w as ke,r as o,e as ft,R as Y,j as e,c as he,L as Se,x as bt,y as ge,z as je,B as qe,d as we,C as Ie,D as yt,E as xt,l as le,k as ve,f as Ue,G as $e,H as He,I as me,o as vt,u as et,q as jt,J as St,K as tt,M as wt,N as kt,O as Ye,P as Je,A as Ge,h as Xe,Q as Ke,S as Ze}from"./vendor-react-CJJ8g4j9.js";import{a as N,A as _,g as Nt,O as Re,u as ue,b as _t,c as Tt}from"./mappi-routes-CKcQyKBC.js";import{B as Ct}from"./editor-2rGn0xn5.js";const zt=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",a=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{standard:a.has("standard")||a.size===0,taiko:a.has("taiko"),mania:a.has("mania"),catch:a.has("catch")}}catch{return{standard:!0,taiko:!1,mania:!1,catch:!1}}},qt=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help",a=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{untagged:a.has("untagged")||a.size===0,help:a.has("help")||a.size===0}}catch{return{untagged:!0,help:!0}}},Ft=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",a=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{unchecked:a.has("unchecked")||a.size===0,accepted:a.has("accepted")||a.size===0,denied:a.has("denied")||a.size===0,finished:a.has("finished")||a.size===0,archived:a.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},It=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",a=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{open:a.has("open")||a.size===0,closed:a.has("closed")}}catch{return{open:!0,closed:!1}}},Rt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator",a=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{modder:a.has("modder")||a.size===0,nominator:a.has("nominator")||a.size===0}}catch{return{modder:!0,nominator:!0}}},Mt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Et=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Me=ht(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:zt(),tagFilters:qt(),queueStatusFilters:Ft(),queueOpenFilters:It(),queueTypeFilters:Rt(),lastSection:Mt(),previousLocation:null,theme:Et(),setMenuOpen:a=>t({menuOpen:a}),setMobileNavOpen:a=>t({mobileNavOpen:a}),setNotifOpen:a=>t({notifOpen:a}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:a=>{t({modeFilters:a});try{const m=Object.entries(a).filter(([b,c])=>c).map(([b])=>b),u=m.length?m:["standard"];localStorage.setItem("filter_modes",u.join(","))}catch{}},setTagFilters:a=>{t({tagFilters:a});try{const m=Object.entries(a).filter(([b,c])=>c).map(([b])=>b),u=m.length?m:["untagged","help"];localStorage.setItem("filter_moddi_tags",u.join(","))}catch{}},setQueueStatusFilters:a=>{t({queueStatusFilters:a});try{const m=Object.entries(a).filter(([b,c])=>c).map(([b])=>b),u=m.length?m:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",u.join(","))}catch{}},setQueueOpenFilters:a=>{t({queueOpenFilters:a});try{const m=Object.entries(a).filter(([b,c])=>c).map(([b])=>b),u=m.length?m:["open"];localStorage.setItem("filter_queue_open",u.join(","))}catch{}},setQueueTypeFilters:a=>{t({queueTypeFilters:a});try{const m=Object.entries(a).filter(([b,c])=>c).map(([b])=>b),u=m.length?m:["modder","nominator"];localStorage.setItem("filter_queue_type",u.join(","))}catch{}},setLastSection:a=>{t({lastSection:a});try{a?localStorage.setItem("last_section",a):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:a=>{t({previousLocation:a})},setTheme:a=>{t({theme:a});try{localStorage.setItem("theme",a)}catch{}}}));function Lt(t=!0){return fe({queryKey:["notifications"],queryFn:async()=>{try{const a=await N(_.user.notifications);return Array.isArray(a.items)?a.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function At(){return fe({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await N("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function Xt(){const{data:t=[]}=Lt();return t.filter(a=>a.kind==="system"&&a.id.startsWith("b:")&&(a.expiresAt||0)<=Date.now()?!1:!a.read).length}function Pt(){const t=be();return ke({mutationFn:async a=>{await N(_.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:a})})},onSuccess:()=>{t.setQueryData(["notifications"],a=>(a==null?void 0:a.map(n=>({...n,read:!0})))||[])}})}function Bt(){const t=be();return ke({mutationFn:async a=>{const n=Nt();await N(_.user.deleteNotification(a),{method:"DELETE",headers:{"X-CSRF-Token":n}})},onSuccess:(a,n)=>{t.setQueryData(["notifications"],m=>(m==null?void 0:m.filter(u=>u.id!==n))||[]),t.setQueryData(["notifications","detailed"],m=>(m==null?void 0:m.filter(u=>u.id!==n))||[])}})}function Ee(){return fe({queryKey:["user","me"],queryFn:async()=>{try{return await N(_.auth.me)}catch{return null}},staleTime:5*60*1e3})}function Kt(t=!0){return fe({queryKey:["user","quota"],queryFn:async()=>{try{return await N(_.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function Zt(){const t=be();return ke({mutationFn:async()=>{await N(_.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function Ot(t,a,n,m){o.useEffect(()=>{if(!n)return;const u=b=>{const c=b.target;a.current&&!a.current.contains(c)&&t.current&&!t.current.contains(c)&&m()};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[n,m,t,a])}const Dt=({context:t,onClose:a,style:n})=>{const m=ft(),u=Y.useMemo(()=>{if(t)return t;const C=m.pathname;return C==="/feed"||C==="/mp/feed"?"mappi-feed":C==="/md/feed"?"moddi-feed":C==="/queues"||C==="/md/queues"?"moddi-queues":C.startsWith("/queues/")||C.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,m.pathname]),{modeFilters:b,setModeFilters:c,tagFilters:x,setTagFilters:f,queueOpenFilters:y,setQueueOpenFilters:d,queueStatusFilters:T,setQueueStatusFilters:S,queueTypeFilters:I,setQueueTypeFilters:z}=Me(),M=C=>{const w={...x,[C]:!x[C]};!w.untagged&&!w.help&&(w.help=!0),f(w);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},q=C=>{const w={...y,[C]:!y[C]};!w.open&&!w.closed&&(w.open=!0),d(w)},A=C=>{const w={...T,[C]:!T[C]};["unchecked","accepted","denied","finished"].some(P=>w[P])||(w.unchecked=!0),S(w)},K=C=>{const w={...I,[C]:!I[C]};!w.modder&&!w.nominator&&(w.modder=!0),z(w)},J=({title:C,children:w})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:C}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:w})]}),O=({active:C,onClick:w,label:te})=>e.jsx("button",{type:"button",onClick:w,className:"chip","aria-pressed":C,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:C?"rgba(125,211,252,0.6)":"var(--border)",background:C?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:te});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{zIndex:1e4,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...n},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),a&&e.jsx("button",{className:"icon-link",onClick:a,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(he,{size:16})})]}),u==="moddi-feed"&&e.jsxs(J,{title:"Tags",children:[e.jsx(O,{active:x.untagged,onClick:()=>M("untagged"),label:"Untagged"}),e.jsx(O,{active:x.help,onClick:()=>M("help"),label:"Help"})]}),u==="moddi-queues"&&e.jsxs(e.Fragment,{children:[e.jsxs(J,{title:"Status",children:[e.jsx(O,{active:y.open,onClick:()=>q("open"),label:"Open"}),e.jsx(O,{active:y.closed,onClick:()=>q("closed"),label:"Closed"})]}),e.jsxs(J,{title:"Type",children:[e.jsx(O,{active:I.modder,onClick:()=>K("modder"),label:"Modder"}),e.jsx(O,{active:I.nominator,onClick:()=>K("nominator"),label:"Nominator"})]})]}),u==="moddi-queue-detail"&&e.jsxs(J,{title:"Submissions",children:[e.jsx(O,{active:T.unchecked,onClick:()=>A("unchecked"),label:"Pending"}),e.jsx(O,{active:T.accepted,onClick:()=>A("accepted"),label:"Accepted"}),e.jsx(O,{active:T.denied,onClick:()=>A("denied"),label:"Denied"}),e.jsx(O,{active:T.finished,onClick:()=>A("finished"),label:"Finished"})]})]})};function Wt({queue:t}){const a=t.type||"modder";return e.jsx(Se,{to:`/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:n=>n.currentTarget.style.background="rgba(255,255,255,0.02)",onMouseLeave:n=>n.currentTarget.style.background="rgba(255,255,255,0.01)",children:[e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:a==="nominator"?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.1)",color:a==="nominator"?"#a78bfa":"var(--muted)",border:a==="nominator"?"1px solid rgba(139, 92, 246, 0.3)":"1px solid rgba(255, 255, 255, 0.1)"},children:a==="nominator"?"Nominator":"Modder"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(bt,{size:18}):e.jsx(ge,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name}),(t.is_open??1)===1?e.jsx(je,{size:18,style:{color:"#10b981"}}):e.jsx(qe,{size:18,style:{color:"#ef4444"}})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(Re,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const n=t.member_count||0;return n===0?null:n===1&&t.first_member_username?` and ${t.first_member_username}`:n>1?` & ${n} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function Le(){return fe({queryKey:["moddi","queues"],queryFn:async()=>{const t=await N(_.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function st(){const t=be();return ke({mutationFn:async a=>{var n;return await N(_.moddi.queues,{method:"POST",body:JSON.stringify({name:a.name.trim(),description:((n=a.description)==null?void 0:n.trim())||null,is_group:a.is_group??!1,type:a.type||"modder"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function Ae({open:t,onClose:a,children:n}){const m=o.useRef(null),u=o.useRef(null),b=o.useRef(!1),c=d=>{var T;u.current=((T=d.touches[0])==null?void 0:T.clientY)??null,b.current=!1},x=d=>{var z,M;if(u.current==null)return;const T=((z=d.touches[0])==null?void 0:z.clientY)??null;if(T==null)return;const S=T-u.current;(((M=m.current)==null?void 0:M.scrollTop)??0)<=0&&S>60?b.current=!0:b.current=!1},f=()=>{b.current&&a(),u.current=null,b.current=!1};if(!t)return null;const y=e.jsx("div",{className:"mobile-upload-overlay",onClick:a,children:e.jsx("div",{ref:m,className:"mobile-upload-sheet",onClick:d=>d.stopPropagation(),onTouchStart:c,onTouchMove:x,onTouchEnd:f,children:n})});return we.createPortal(y,document.body)}function Qt(){const[t,a]=Y.useState(!1),[n,m]=Y.useState(""),[u,b]=Y.useState(""),{data:c=[]}=Le(),{data:x}=Ee(),{notify:f}=ue(),y=st(),d=Y.useMemo(()=>x?c.some(S=>S.owner_id===x.id):!1,[x,c]),T=S=>{if(S&&S.preventDefault(),d){f("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!n.trim()){f("Queue name is required",{variant:"error"});return}y.mutate({name:n.trim(),description:u.trim()||null,is_group:!1},{onSuccess:()=>{f("Queue created!",{variant:"success"}),a(!1),m(""),b("")},onError:I=>{f((I==null?void 0:I.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>a(!0),children:e.jsx(Ie,{size:22})}),e.jsx(Ae,{open:t,onClose:()=>a(!1),children:e.jsxs("form",{onSubmit:T,className:"col",style:{gap:12},children:[d?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:n,onChange:S=>m(S.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:u,onChange:S=>b(S.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>a(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:y.isPending||d,children:y.isPending?"Creating...":"Create"})]})]})})]})}function Ut(){const[t,a]=Y.useState(!1);return Y.useEffect(()=>{var u;const n=window.matchMedia("(max-width: 768px)"),m=()=>a(n.matches);return m(),(u=n.addEventListener)==null||u.call(n,"change",m),()=>{var b;return(b=n.removeEventListener)==null?void 0:b.call(n,"change",m)}},[]),t}const at=({context:t})=>{const a=Ut(),[n,m]=Y.useState(!1),u=Y.useRef(null),b=12,c=18,d=84+56+12;return Y.useEffect(()=>{const T=S=>{if(!n)return;const I=S.target;if(u.current&&u.current.contains(I))return;const z=document.getElementById("desktop-filters-panel");z&&z.contains(I)||m(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[n]),a?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:u,className:"desktop-fab",onClick:()=>m(T=>!T),"aria-haspopup":"dialog","aria-expanded":n,title:"Filters","aria-label":"Filters",children:e.jsx(yt,{size:22})}),n&&e.jsx("div",{id:"desktop-filters-panel",style:{position:"fixed",right:c,bottom:d,zIndex:1e4},children:e.jsx(Dt,{context:t,onClose:()=>m(!1),style:{maxHeight:`calc(100vh - ${d+b}px)`,maxWidth:`calc(100vw - ${c+b}px)`,overflow:"auto"}})})]})};function Vt(){const{data:t=[],isLoading:a}=Le(),{data:n}=Ee(),{queueOpenFilters:m,queueTypeFilters:u}=Me(),b=st(),{notify:c}=ue(),[x,f]=o.useState(!1),[y,d]=o.useState(""),[T,S]=o.useState(""),I=o.useMemo(()=>n?t.some(q=>q.owner_id===n.id):!1,[n,t]),z=async q=>{if(q.preventDefault(),I){c("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!y.trim()){c("Queue name is required",{variant:"error"});return}b.mutate({name:y.trim(),description:T.trim()||null,is_group:!1},{onSuccess:()=>{c("Queue created!",{variant:"success"}),f(!1),d(""),S("")},onError:A=>{c((A==null?void 0:A.message)||"Failed to create queue",{variant:"error"})}})},M=Y.useMemo(()=>t.filter(q=>{const A=(q.is_open??1)===1;if(!(m.open&&m.closed||m.open&&!m.closed&&A||!m.open&&m.closed&&!A))return!1;const J=q.type||"modder";return J==="modder"&&u.modder||J==="nominator"&&u.nominator}),[t,m,u]);return e.jsxs("div",{className:"feed-container queues-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx(Qt,{}),e.jsx(at,{context:"moddi-queues"}),e.jsx("div",{className:"feed-header",children:e.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:0},children:I?e.jsx("div",{style:{padding:"12px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>f(!x),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Create a queue!"}),x?e.jsx(xt,{size:16}):e.jsx(le,{size:16})]}),x&&e.jsx("form",{onSubmit:z,style:{padding:"12px",borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:y,onChange:q=>d(q.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:T,onChange:q=>S(q.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:q=>{q.stopPropagation(),f(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:b.isPending||I,onClick:q=>q.stopPropagation(),children:b.isPending?"Creating...":"Create"})]})]})})]})})}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsx("div",{className:"col",style:{gap:0},children:a?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):M.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):M.map(q=>e.jsx(Wt,{queue:q},q.id))})})]})}function $t({beatmapMeta:t,beatmapVersion:a}){const n=o.useRef(null),m=o.useRef(null),[u,b]=o.useState(!1),[c,x]=o.useState(!1),[f,y]=o.useState(0);o.useEffect(()=>{if(n.current&&m.current){const S=n.current.offsetWidth,I=m.current.scrollWidth;y(I),x(I>S)}},[t,a]);const d=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",a?` [${a}]`:""]}):a?`[${a}]`:"Beatmap",T=f>0?Math.max(3,f/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:n,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&b(!0),onMouseLeave:()=>b(!1),children:[e.jsx("span",{ref:m,style:{display:"inline-block",animation:u&&c?`beatmap-marquee ${T}s linear infinite`:"none"},children:d}),u&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:d})]})]})}function Fe({submission:t,canManage:a,onUpdate:n,onDelete:m,isGroup:u=!1,allowSelfActions:b=!1}){const[c,x]=o.useState(!1),[f,y]=o.useState(!1),[d,T]=o.useState(null),[S,I]=o.useState(t.beatmapset_id),[z,M]=o.useState(t.beatmap_id),[q,A]=o.useState(!1),[K,J]=o.useState(!1),[O,C]=o.useState(null),[w,te]=o.useState(!1),[P,de]=o.useState(t.acknowledgments||[]),[G,ne]=o.useState(t.acknowledged_by_me||!1),B=o.useRef(null),g=o.useRef(null),v=o.useRef(null),h=o.useRef(null),E=o.useRef(null),{notify:X}=ue();o.useEffect(()=>{de(t.acknowledgments||[]),ne(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),o.useEffect(()=>{if(t.beatmap_url)try{const r=new URL(t.beatmap_url),p=r.pathname.match(/\/beatmapsets\/(\d+)/);if(p&&!t.beatmapset_id){const F=Number(p[1]);isNaN(F)||I(F)}const k=r.hash.match(/#osu\/(\d+)/);if(k&&!t.beatmap_id){const F=Number(k[1]);isNaN(F)||M(F)}}catch(r){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,r)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),o.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:S,extracted_beatmap_id:z,beatmap_version:t.beatmap_version})},[t.id,S,z]),o.useEffect(()=>{if(!t.beatmap_url||d&&S)return;let r=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let p;try{p=new URL(t.beatmap_url)}catch(D){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,D);return}const k=p.hash.match(/#osu\/(\d+)/),F=k?k[1]:null;p.hash="";const Q={url:p.toString()};if(F?Q.beatmap_id=F:t.beatmap_id&&(Q.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",Q),!r){const D=await N(_.osu.resolveBeatmap+_t(Q),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",D),D.setId&&!S&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",D.setId),I(Number(D.setId))),(D.title||D.artist)&&T({title:D.title||null,artist:D.artist||null,mapper:D.mapper||null})}}catch(p){console.error("[QueueSubmission] Error fetching beatmap metadata:",p)}})(),()=>{r=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,d,S]),o.useEffect(()=>{if(!q){C(null),E.current&&(window.removeEventListener("resize",E.current),window.removeEventListener("scroll",E.current,!0),E.current=null);return}let r=null;const p=()=>{let k=null;const F=h.current;if(F){const $=F.querySelector(".queue-submission-beatmap-btn-desktop button"),Q=F.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),D=F.querySelector(".queue-submission-beatmap-btn-mobile button");$&&window.getComputedStyle($.parentElement).display!=="none"?k=$:Q&&window.getComputedStyle(Q.parentElement).display!=="none"?k=Q:D&&window.getComputedStyle(D.parentElement).display!=="none"&&(k=D)}if(!k&&v.current&&(k=v.current),k){const $=k.getBoundingClientRect();C({top:$.bottom+8,right:window.innerWidth-$.right})}else C(null)};return E.current=p,r=requestAnimationFrame(()=>{p(),window.addEventListener("resize",p),window.addEventListener("scroll",p,!0)}),()=>{r!==null&&cancelAnimationFrame(r),E.current&&(window.removeEventListener("resize",E.current),window.removeEventListener("scroll",E.current,!0),E.current=null)}},[q]),o.useEffect(()=>{if(!f)return;const r=p=>{const k=p.target;B.current&&!B.current.contains(k)&&!k.closest("[data-status-dropdown]")&&y(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[f]),o.useEffect(()=>{if(!q)return;const r=p=>{const k=p.target;if(g.current&&g.current.contains(k))return;const F=h.current;if(F){if(v.current&&v.current.contains(k))return;const $=F.querySelector(".queue-submission-beatmap-btn-desktop button"),Q=F.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),D=F.querySelector(".queue-submission-beatmap-btn-mobile button");if($&&$.contains(k)||Q&&Q.contains(k)||D&&D.contains(k))return}A(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[q]);const pe=async r=>{if(!c){x(!0);try{await N(_.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:r})});const p={...t,status:r,updated_at:Math.floor(Date.now()/1e3)};n&&n(p),X("Status updated",{variant:"success"})}catch{X("Failed to update status",{variant:"error"})}finally{x(!1),y(!1)}}},re=async()=>{if(!c){x(!0);try{const r=!!t.is_archived;await N(_.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!r})});const p={...t,is_archived:r?0:1,updated_at:Math.floor(Date.now()/1e3)};n&&n(p),X(r?"Unarchived":"Archived",{variant:"success"})}catch{X("Failed to update archive status",{variant:"error"})}finally{x(!1)}}},W=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){x(!0);try{await N(_.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),X("Submission deleted",{variant:"success"}),m&&m(t.id)}catch{X("Failed to delete submission",{variant:"error"})}finally{x(!1)}}},se=async()=>{if(!w){te(!0);try{if(G){if(await N(_.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),ne(!1),X("Unacknowledged",{variant:"info"}),n){const r={...t,acknowledged_by_me:!1};n(r)}}else if(await N(_.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),ne(!0),X("Acknowledged",{variant:"success"}),n){const r={...t,acknowledged_by_me:!0};n(r)}}catch{X("Failed to update acknowledgment",{variant:"error"})}finally{te(!1)}}},j={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},V={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},Z=S||t.beatmapset_id,ae=Z?`https://assets.ppy.sh/beatmaps/${Z}/covers/card.jpg`:null;o.useEffect(()=>{ae?console.log("[QueueSubmission] Background image URL:",ae,"for beatmapset_id:",Z):console.log("[QueueSubmission] No background image URL - beatmapset_id:",Z,"submission.beatmapset_id:",t.beatmapset_id)},[ae,Z,t.beatmapset_id]);const U=!!t.is_archived,ee=a||b?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),A(p=>!p)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(le,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),A(p=>!p)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(le,{size:12,style:{marginLeft:4,opacity:.7}})]})}),P&&P.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[P.slice(0,5).map((r,p)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:P.length-p,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:P.length-p,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),P.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${P.length-5} more`,children:["+",P.length-5]})]}),a&&e.jsx("button",{className:"icon-link",onClick:se,disabled:w||c,title:G?"Unacknowledge":"Acknowledge",style:{color:G?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:G?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!w&&!c&&(r.currentTarget.style.background=G?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=G?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ue,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re,disabled:c,title:U?"Unarchive":"Archive",style:{color:U?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:U?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=U?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=U?"rgba(99, 102, 241, 0.1)":"transparent"},children:U?e.jsx($e,{size:16}):e.jsx(He,{size:16})}),e.jsx("button",{className:"icon-link",onClick:W,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(me,{size:16})}),a&&e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:B,onClick:()=>y(!f),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:j[t.status]+"15",border:`1.5px solid ${j[t.status]}50`,color:j[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=j[t.status]+"25",r.currentTarget.style.borderColor=j[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=j[t.status]+"15",r.currentTarget.style.borderColor=j[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:V[t.status]}),e.jsx(le,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:f?"rotate(180deg)":"rotate(0deg)"}})]}),f&&we.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const r=document.querySelector(".queue-submission-status-btn-desktop button"),p=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),k=document.querySelector(".queue-submission-status-btn-mobile button");let F=null;if(r&&window.getComputedStyle(r.parentElement).display!=="none"?F=r:k&&window.getComputedStyle(k.parentElement).display!=="none"?F=k:p&&window.getComputedStyle(p.parentElement).display!=="none"?F=p:B.current&&(F=B.current),F){const $=F.getBoundingClientRect();return{top:$.bottom+6,right:window.innerWidth-$.right}}return{top:0,right:0}})()},onClick:r=>r.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(r=>e.jsx("button",{onClick:()=>pe(r),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:r===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:r===t.status?j[r]+"15":"transparent",color:r===t.status?j[r]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:p=>{r!==t.status&&(p.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:p=>{r!==t.status&&(p.currentTarget.style.background="transparent")},children:V[r]},r))}),document.body)]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:h,className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:U?.6:1},children:[ae&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ae,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.35,zIndex:0,pointerEvents:"none"},onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.75) 100%)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:v,className:"chip-btn link",onClick:r=>{r.preventDefault(),r.stopPropagation(),A(p=>!p)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(le,{size:12,style:{marginLeft:4,opacity:.7}})]})}),a&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[P&&P.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[P.slice(0,5).map((r,p)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:P.length-p,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:P.length-p,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),P.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${P.length-5} more`,children:["+",P.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:se,disabled:w||c,title:G?"Unacknowledge":"Acknowledge",style:{color:G?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:G?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!w&&!c&&(r.currentTarget.style.background=G?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=G?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ue,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re,disabled:c,title:U?"Unarchive":"Archive",style:{color:U?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:U?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=U?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=U?"rgba(99, 102, 241, 0.1)":"transparent"},children:U?e.jsx($e,{size:16}):e.jsx(He,{size:16})}),e.jsx("button",{className:"icon-link",onClick:W,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(me,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:B,onClick:()=>y(!f),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:j[t.status]+"15",border:`1.5px solid ${j[t.status]}50`,color:j[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=j[t.status]+"25",r.currentTarget.style.borderColor=j[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=j[t.status]+"15",r.currentTarget.style.borderColor=j[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:V[t.status]}),e.jsx(le,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:f?"rotate(180deg)":"rotate(0deg)"}})]})})]}),a&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>y(!f),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:j[t.status]+"15",border:`1.5px solid ${j[t.status]}50`,color:j[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=j[t.status]+"25",r.currentTarget.style.borderColor=j[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=j[t.status]+"15",r.currentTarget.style.borderColor=j[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:V[t.status]}),e.jsx(le,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:f?"rotate(180deg)":"rotate(0deg)"}})]})}),!a&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:j[t.status]+"15",border:`1.5px solid ${j[t.status]}50`,color:j[t.status],whiteSpace:"nowrap"},children:V[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx($t,{beatmapMeta:d,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:e.jsx(Re,{text:t.message})}),ee]})]}),q&&O&&t.beatmap_url&&we.createPortal(e.jsxs("div",{ref:g,style:{position:"fixed",top:O.top,right:O.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>A(!1),children:[e.jsx(ve,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),Z&&e.jsx("button",{className:"menu-item",onClick:()=>{J(!0),A(!1)},children:"Preview"})]}),document.body),K&&Z&&e.jsx(Ct,{open:K,onClose:()=>J(!1),downloadUrl:`${Tt}${_.osu.downloadBeatmapset(Z)}`,beatmapId:z??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}function Ht({queueId:t,onSubmitted:a}){const[n,m]=Y.useState(!1),[u,b]=Y.useState(t),[c,x]=Y.useState(""),[f,y]=Y.useState(""),[d,T]=Y.useState(!1),{notify:S}=ue(),{data:I=[]}=Le();Y.useEffect(()=>{b(t)},[t]);const z=async()=>{if(!u){S("Please select a queue",{variant:"error"});return}if(!c.trim()){S("Beatmap URL is required",{variant:"error"});return}T(!0);try{await N(_.moddi.queueSubmit(u),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:f.trim()||null})}),S("Submission created!",{variant:"success"}),x(""),y(""),m(!1),a==null||a()}catch(M){S((M==null?void 0:M.message)||"Failed to create submission",{variant:"error"})}finally{T(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>m(!0),children:e.jsx(Ie,{size:22})}),e.jsx(Ae,{open:n,onClose:()=>m(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:u??"",onChange:M=>b(M.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),I.map(M=>e.jsx("option",{value:String(M.id),children:M.name},M.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:M=>x(M.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:f,onChange:M=>y(M.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),f.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[f.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:d,onClick:z,children:d?"Submitting...":"Submit"})]})]})})]})}const Ve=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(kt,{components:{p:({children:a})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:a}),ul:({children:a})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:a}),ol:({children:a})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:a}),li:({children:a})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:a}),strong:({children:a})=>e.jsx("strong",{style:{fontWeight:600},children:a}),em:({children:a})=>e.jsx("em",{children:a}),code:({children:a})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:a}),h1:({children:a})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:a}),h2:({children:a})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:a}),h3:({children:a})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:a})},children:t})});function es(){const{id:t}=vt(),a=et(),[n,m]=o.useState(null),[u,b]=o.useState([]),[c,x]=o.useState([]),[f,y]=o.useState(!0),[d,T]=o.useState(null),[S,I]=o.useState(!1),[z,M]=o.useState(!1),[q,A]=o.useState(""),[K,J]=o.useState(""),[O,C]=o.useState(null),[w,te]=o.useState(!1),[P,de]=o.useState(""),[G,ne]=o.useState(""),[B,g]=o.useState(""),[v,h]=o.useState("modder"),[E,X]=o.useState(!1),[pe,re]=o.useState(!1),[W,se]=o.useState("general"),[j,V]=o.useState(!1),[Z,ae]=o.useState(!1),[U,ee]=o.useState(null),[r,p]=o.useState(""),[k,F]=o.useState([]),[$,Q]=o.useState(!1),D=o.useRef(null),Ne=o.useRef(null),_e=o.useRef(null),[Te,nt]=o.useState([]),[Pe,Be]=o.useState(!1),[Ce,Oe]=o.useState(null),{notify:L}=ue(),{queueStatusFilters:ye}=Me(),ie=async()=>{var s,l;if(t){y(!0);try{const i=await N(_.moddi.queue(t),{requireAuth:!1});m(i.queue||null),b(i.members||[]),x(i.submissions||[])}catch(i){(s=i==null?void 0:i.message)!=null&&s.includes("403")||(l=i==null?void 0:i.message)!=null&&l.includes("Forbidden")?(L("You do not have access to this queue",{variant:"error"}),a("/queues")):L("Failed to load queue",{variant:"error"})}finally{y(!1)}}};o.useEffect(()=>{ie(),N(_.auth.me,{requireAuth:!1}).then(s=>T(s)).catch(()=>{})},[t]);const oe=d&&n&&(n.owner_id===d.id||u.some(s=>s.user_id===d.id&&s.joined_at)||d.is_mod||d.is_admin);d&&u.some(s=>s.user_id===d.id&&s.joined_at);const De=d&&n&&(n.owner_id===d.id||u.some(s=>s.user_id===d.id&&s.joined_at)),rt=async s=>{if(s.preventDefault(),!n||n.is_open===0){L("Queue is closed for submissions",{variant:"error"});return}if(!q.trim()){L("Beatmap URL is required",{variant:"error"});return}M(!0);try{await N(_.moddi.queueSubmit(t),{method:"POST",body:JSON.stringify({beatmap_url:q.trim(),message:K.trim()||null})}),L("Submission created!",{variant:"success"}),I(!1),A(""),J(""),ie()}catch(l){L((l==null?void 0:l.message)||"Failed to create submission",{variant:"error"})}finally{M(!1)}},We=s=>{x(l=>l.map(i=>i.id===s.id?s:i)),s.acknowledged_by_me!==void 0&&ie()},it=()=>{n&&(de(n.name),ne(n.description||""),g(n.rules||""),h(n.type||"modder"),te(!0),se("general"))},ce=()=>{te(!1),de(""),ne(""),g(""),h("modder")},ot=async()=>{if(!(!n||!De)){re(!0);try{const s=n.is_open!==1;await N(_.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:s})}),L(`Queue ${s?"opened":"closed"}`,{variant:"success"}),ie()}catch(s){L((s==null?void 0:s.message)||"Failed to update status",{variant:"error"})}finally{re(!1)}}},lt=async s=>{if(s.preventDefault(),!n||!P.trim()){L("Queue name is required",{variant:"error"});return}V(!0);try{const l=u.filter(R=>R.user_id!==n.owner_id&&R.role!=="owner").length>0,i={name:P.trim(),description:G.trim()||null,rules:B.trim()||null,is_group:l};(d!=null&&d.is_mod||d!=null&&d.is_admin)&&(i.type=v),await N(_.moddi.queue(t),{method:"PATCH",body:JSON.stringify(i)}),L("Queue updated!",{variant:"success"}),ce(),ie()}catch(l){L((l==null?void 0:l.message)||"Failed to update queue",{variant:"error"})}finally{V(!1)}};o.useEffect(()=>{if(!r.trim()){F([]),Q(!1);return}const s=setTimeout(async()=>{try{const i=(await N(_.moddi.usersSearch(r),{requireAuth:!1})).items||[];F(i),Q(i.length>0)}catch(l){console.error("Search failed:",l),F([]),Q(!1)}},300);return()=>clearTimeout(s)},[r]);const dt=async s=>{if(!Z){ae(!0);try{await N(_.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:s})}),L("Invite sent!",{variant:"success"}),p(""),F([]),Q(!1),ie()}catch(l){L((l==null?void 0:l.message)||"Failed to invite member",{variant:"error"})}finally{ae(!1)}}},ze=async()=>{if(!(!t||!oe))try{const s=await N(_.moddi.queueBlockedUsers(t));nt(s.blocked||[])}catch(s){console.error("Failed to load blocked users:",s)}},ct=async s=>{if(!(!t||Pe)&&confirm("Block this user from submitting to this queue?")){Be(!0);try{await N(_.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:s})}),L("User blocked",{variant:"success"}),ze(),p(""),F([]),Q(!1)}catch(l){L((l==null?void 0:l.message)||"Failed to block user",{variant:"error"})}finally{Be(!1)}}},Qe=async s=>{if(!(!t||Ce===s)){Oe(s);try{await N(_.moddi.queueUnblockUser(t,s),{method:"DELETE"}),L("User unblocked",{variant:"success"}),ze()}catch(l){L((l==null?void 0:l.message)||"Failed to unblock user",{variant:"error"})}finally{Oe(null)}}};o.useEffect(()=>{W==="members"&&oe&&t&&ze()},[W,oe,t]);const ut=async()=>{if(n&&confirm(`Are you sure you want to delete "${n.name}"? This action cannot be undone.`)){X(!0);try{await N(_.moddi.queue(t),{method:"DELETE"}),L("Queue deleted",{variant:"success"}),a("/queues")}catch(s){L((s==null?void 0:s.message)||"Failed to delete queue",{variant:"error"})}finally{X(!1)}}},mt=async s=>{if(!d||!n||d.id!==n.owner_id){L("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){ee(s);try{await N(_.moddi.queueMember(t,s),{method:"DELETE"}),L("Member removed",{variant:"success"});const i=u.filter(R=>R.user_id!==s).some(R=>R.user_id!==(n==null?void 0:n.owner_id)&&R.role!=="owner");if(n&&n.is_group===1&&!i)try{await N(_.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}ie()}catch(l){L((l==null?void 0:l.message)||"Failed to remove member",{variant:"error"})}finally{ee(null)}}},pt=async()=>{if(d&&confirm("Leave this queue? You will need to be invited again to rejoin.")){ee(d.id);try{await N(_.moddi.queueMember(t,d.id),{method:"DELETE"}),L("Left queue",{variant:"success"});const l=u.filter(i=>i.user_id!==d.id).some(i=>i.user_id!==(n==null?void 0:n.owner_id)&&i.role!=="owner");if(n&&n.is_group===1&&!l)try{await N(_.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}a("/queues")}catch(s){L((s==null?void 0:s.message)||"Failed to leave queue",{variant:"error"})}finally{ee(null)}}},gt=async s=>{if(confirm("Cancel this invitation?")){ee(s);try{await N(_.moddi.queueMember(t,s),{method:"DELETE"}),L("Invitation canceled",{variant:"success"}),ie()}catch(l){L((l==null?void 0:l.message)||"Failed to cancel invitation",{variant:"error"})}finally{ee(null)}}};return o.useEffect(()=>{if(!w)return;const s=l=>{const i=l.target;i.closest(".manage-overlay")||i.closest(".manage-overlay-backdrop")||!i.closest(".manage-popup")&&_e.current&&!_e.current.contains(i)&&ce()};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[w]),o.useEffect(()=>{if(!$)return;const s=l=>{const i=l.target;D.current&&!D.current.contains(i)&&Ne.current&&!Ne.current.contains(i)&&Q(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[$]),f?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):n?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t&&e.jsx(Ht,{queueId:t,onSubmitted:()=>ie()}),e.jsx(at,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>a("/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(jt,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:n.name}),De&&e.jsxs("button",{onClick:ot,disabled:pe,className:`queue-status-badge ${n.is_open===1?"status-open":"status-closed"}`,title:n.is_open===1?"Close queue":"Open queue","aria-label":n.is_open===1?"Close queue":"Open queue",children:[n.is_open===1?e.jsx(je,{size:14}):e.jsx(qe,{size:14}),e.jsx("span",{children:n.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[oe&&e.jsx("button",{ref:_e,className:"icon-link",onClick:it,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(St,{size:18})}),u.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:u.filter(s=>s.joined_at!==null).sort((s,l)=>{const i=s.role==="owner"||s.user_id===(n==null?void 0:n.owner_id),R=l.role==="owner"||l.user_id===(n==null?void 0:n.owner_id);return i&&!R?-1:!i&&R?1:(l.joined_at||0)-(s.joined_at||0)}).map(s=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>C(s.user_id),onMouseLeave:()=>C(null),children:[e.jsx(Se,{to:`/profile/${s.user_id}`,className:"queue-member-avatar",title:s.username,children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:s.username.charAt(0).toUpperCase()})}),O===s.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[s.username," ",s.role!=="member"?`(${s.role})`:""]})]},s.user_id))})]})]}),n.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:e.jsx(Re,{text:n.description})}),n.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(Ve,{content:n.rules})]}),n.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{className:"queue-submit-desktop-only",style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:12,opacity:n.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:n.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>n.is_open===1&&I(!S),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",n.is_open===0&&"(Closed)"]}),n.is_open===1&&(S?e.jsx(he,{size:16}):e.jsx(Ie,{size:16}))]}),S&&e.jsx("form",{onSubmit:rt,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:q,onChange:s=>A(s.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:K,onChange:s=>J(s.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),K.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[K.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:s=>{s.stopPropagation(),I(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:z,onClick:s=>s.stopPropagation(),children:z?"Submitting...":"Submit"})]})]})})]}),e.jsxs("div",{className:"profile-tabs-unified",style:{marginTop:24},children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Submission sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"active",onClick:s=>{const l=s.currentTarget.closest(".profile-tabs-unified");l.querySelectorAll(".profile-tab").forEach(R=>{R.classList.remove("active"),R.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),l.querySelector(".profile-tabs-content").setAttribute("data-active","active")},children:"Active"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"archived",onClick:s=>{const l=s.currentTarget.closest(".profile-tabs-unified");l.querySelectorAll(".profile-tab").forEach(R=>{R.classList.remove("active"),R.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),l.querySelector(".profile-tabs-content").setAttribute("data-active","archived")},children:"Archived"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"active",children:[e.jsx("div",{className:"panel active",children:e.jsx("div",{className:"col",style:{gap:0},children:c.filter(s=>!!!s.is_archived&&ye[s.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):c.filter(s=>!!!s.is_archived&&ye[s.status]).map(s=>e.jsx(Fe,{submission:s,canManage:!!oe,isGroup:(n==null?void 0:n.is_group)===1,onUpdate:We,onDelete:l=>{x(i=>i.filter(R=>R.id!==l))}},s.id))})}),e.jsx("div",{className:"panel archived",children:e.jsx("div",{className:"col",style:{gap:0},children:c.filter(s=>!!s.is_archived&&ye[s.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):c.filter(s=>!!s.is_archived&&ye[s.status]).map(s=>e.jsx(Fe,{submission:s,canManage:!!oe,isGroup:(n==null?void 0:n.is_group)===1,onUpdate:We,onDelete:l=>{x(i=>i.filter(R=>R.id!==l))}},s.id))})})]})]}),w&&we.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:ce}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:ce,"aria-label":"Close",children:e.jsx(he,{size:18})}),e.jsxs("div",{className:"settings-header",style:{padding:"20px 16px 12px"},children:[e.jsx("div",{className:"settings-title",children:"Manage Queue"}),e.jsx("div",{className:"settings-description",children:"Configure queue settings, rules, and members."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Manage Queue",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Manage Queue tabs",children:[e.jsx("button",{role:"tab","aria-selected":W==="general",className:`profile-tab ${W==="general"?"active":""}`,"data-tab":"general",onClick:s=>{const l=s.currentTarget.closest(".profile-tabs-unified"),i=l==null?void 0:l.querySelector(".profile-tabs-content");i==null||i.setAttribute("data-active","general"),se("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":W==="rules",className:`profile-tab ${W==="rules"?"active":""}`,"data-tab":"rules",onClick:s=>{const l=s.currentTarget.closest(".profile-tabs-unified"),i=l==null?void 0:l.querySelector(".profile-tabs-content");i==null||i.setAttribute("data-active","rules"),se("rules")},children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":W==="members",className:`profile-tab ${W==="members"?"active":""}`,"data-tab":"members",onClick:s=>{const l=s.currentTarget.closest(".profile-tabs-unified"),i=l==null?void 0:l.querySelector(".profile-tabs-content");i==null||i.setAttribute("data-active","members"),se("members")},children:"Members"})]}),e.jsx("div",{className:"profile-tabs-content","data-active":W,children:e.jsxs("form",{onSubmit:lt,className:"col",style:{gap:0},children:[e.jsx("div",{className:"panel general",hidden:W!=="general",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:P,onChange:s=>de(s.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:G,onChange:s=>ne(s.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),((d==null?void 0:d.is_mod)||(d==null?void 0:d.is_admin))&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsxs("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Queue Type ",n.owner_id!==(d==null?void 0:d.id)&&e.jsx("span",{style:{fontSize:12,color:"var(--muted)",fontWeight:400},children:"(Mod/Admin only)"})]}),e.jsxs("select",{value:v,onChange:s=>h(s.target.value),style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14},children:[e.jsx("option",{value:"modder",children:"Modder"}),e.jsx("option",{value:"nominator",children:"Nominator"})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:ut,disabled:E||j,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(me,{size:14,style:{marginRight:6}}),E?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:ce,disabled:j||E,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:j||E,style:{fontSize:13,padding:"8px 16px"},children:j?"Updating...":"Save Changes"})]})]})]})}),e.jsx("div",{className:"panel rules",hidden:W!=="rules",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:B,onChange:s=>g(s.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),B&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(Ve,{content:B})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:ce,disabled:j||E,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:j||E,style:{fontSize:13,padding:"8px 16px"},children:j?"Updating...":"Save Changes"})]})]})}),e.jsx("div",{className:"panel members",hidden:W!=="members",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:D,type:"text",placeholder:"Search username or ID",value:r,onChange:s=>p(s.target.value),onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()},onFocus:()=>{k.length>0&&Q(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),$&&k.length>0&&e.jsx("div",{ref:Ne,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:k.map(s=>{const l=u.some(H=>H.user_id===s.id&&H.joined_at),i=u.some(H=>H.user_id===s.id&&H.invited_at&&!H.joined_at),R=Te.some(H=>H.user_id===s.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:s.username}),l&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),i&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",s.id," • osu ",s.osu_user_id]})]})]}),oe&&!l&&!i&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:H=>{H.stopPropagation(),Z||dt(s.id)},disabled:Z,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(tt,{size:16})}),e.jsx("button",{className:"icon-link",onClick:H=>{H.stopPropagation(),R?Qe(s.id):ct(s.id)},disabled:Pe||Ce===s.id,title:R?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:R?"var(--accent)":"var(--danger)"},children:R?e.jsx(je,{size:16}):e.jsx(qe,{size:16})})]})]},s.id)})})})]})]}),u.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const s=u.filter(i=>i.joined_at!==null).sort((i,R)=>{const H=i.role==="owner"||i.user_id===(n==null?void 0:n.owner_id),xe=R.role==="owner"||R.user_id===(n==null?void 0:n.owner_id);return H&&!xe?-1:!H&&xe?1:(R.joined_at||0)-(i.joined_at||0)}),l=u.filter(i=>i.invited_at!==null&&i.joined_at===null);return e.jsxs(e.Fragment,{children:[s.map(i=>{const R=d&&n&&d.id===n.owner_id,H=i.user_id===(d==null?void 0:d.id),xe=i.user_id===(n==null?void 0:n.owner_id)||i.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:i.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:i.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:i.role})]})]}),R&&!xe&&e.jsx("button",{className:"icon-link",onClick:()=>mt(i.user_id),disabled:U===i.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(me,{size:16})}),!R&&H&&e.jsx("button",{className:"icon-link",onClick:pt,disabled:U===i.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(wt,{size:16})})]},i.user_id)}),l.length>0&&e.jsx(e.Fragment,{children:l.map(i=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:i.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:i.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>gt(i.user_id),disabled:U===i.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(he,{size:16})})]},i.user_id))})]})})()})]}),oe&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),Te.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:Te.map(s=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:s.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:s.username}),s.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",s.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Qe(s.user_id),disabled:Ce===s.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(je,{size:16})})]},s.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:ce,disabled:j||E,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:j||E,style:{fontSize:13,padding:"8px 16px"},children:j?"Updating...":"Save Changes"})]})]})})]})})]})]})]}),document.body),e.jsx("style",{children:`
        /* Hide inline submit form on mobile – mobile uses floating FAB instead */
        html.is-mobile .queue-submit-desktop-only {
          display: none;
        }

        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function ts(){const{data:t=[],isLoading:a}=At(),n=Pt(),m=Bt(),{notify:u}=ue(),b=et(),c=be(),[x,f]=o.useState(new Set),{data:y}=Ee(),[d,T]=o.useState(!1),[S,I]=o.useState(!1),[z,M]=o.useState(!1),q=o.useRef(null),A=o.useRef(null),K=!!(y!=null&&y.is_admin||y!=null&&y.is_mod);Ot(q,A,d,()=>T(!1));const J=async g=>{n.mutate(g,{onSuccess:()=>{}})},O=async g=>{g.startsWith("n:")&&m.mutate(g)},C=async()=>{const g=t.filter(v=>!v.read&&(v.id.startsWith("n:")||v.kind==="system"&&!v.id.startsWith("b:"))).map(v=>v.id);g.length>0&&(await J(g),u("All notifications marked as read",{variant:"success"}))},w=g=>{if(!g)return null;try{const v=JSON.parse(g);if((v==null?void 0:v.type)==="queue_invite"&&(v!=null&&v.queue_id))return v}catch{}return null},te=async(g,v)=>{if(!x.has(g.id)){f(h=>new Set(h).add(g.id));try{await N(_.moddi.queueAccept(String(v)),{method:"POST"}),u("Invitation accepted!",{variant:"success"}),O(g.id),b(`/queues/${v}`)}catch(h){u((h==null?void 0:h.message)||"Failed to accept invitation",{variant:"error"})}finally{f(h=>{const E=new Set(h);return E.delete(g.id),E})}}},P=async(g,v)=>{if(!x.has(g.id)){f(h=>new Set(h).add(g.id));try{await N(_.moddi.queueDeny(String(v)),{method:"POST"}),u("Invitation declined",{variant:"success"}),O(g.id)}catch(h){u((h==null?void 0:h.message)||"Failed to decline invitation",{variant:"error"})}finally{f(h=>{const E=new Set(h);return E.delete(g.id),E})}}},de=g=>w(g.text)?e.jsx(tt,{size:20,color:"#a78bfa"}):g.kind==="star"?e.jsx(Ge,{size:20,color:"#f59e0b"}):g.kind==="likes5"?e.jsx(Xe,{size:20,color:"#f472b6"}):g.kind==="comment"?e.jsx(ge,{size:20,color:"#60a5fa"}):g.kind==="inspiration"?e.jsx(ge,{size:20,color:"#7dd3fc"}):g.kind==="reaction"?e.jsx(Ke,{size:20,color:"#10b981"}):g.id.startsWith("b:")?e.jsx(Ze,{size:20,color:"#a78bfa"}):null,G=g=>w(g.text)?"Queue Invitation":g.kind==="star"?"Star":g.kind==="likes5"?"Likes":g.kind==="comment"?"Comment":g.kind==="inspiration"?"Inspiration":g.kind==="reaction"?"Reaction":g.id.startsWith("b:")?"Global":"System",ne=t.filter(g=>!g.read&&!(g.id.startsWith("b:")&&g.expiresAt&&g.expiresAt<=Date.now())).length,B=async g=>{if(!(!(y!=null&&y.id)||z)){M(!0);try{const v={kind:g};g==="system"&&(v.text="Test system notification"),await N(_.admin.notificationsTest,{method:"POST",body:JSON.stringify(v)}),u("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(v){u((v==null?void 0:v.message)||"Failed to send test notification",{variant:"error"})}finally{M(!1),T(!1),I(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[K&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:q,className:"btn secondary",onClick:()=>T(!d),disabled:z,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Ye,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(le,{size:14,style:{transition:"transform 0.2s ease",transform:d?"rotate(180deg)":"rotate(0deg)"}})]}),d&&e.jsxs("div",{ref:A,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>B("star"),disabled:z,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>B("likes5"),disabled:z,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>B("comment"),disabled:z,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>B("inspiration"),disabled:z,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>B("reaction"),disabled:z,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>B("system"),disabled:z,children:"Test System"})]})]}),ne>0&&e.jsxs("button",{className:"btn secondary",onClick:C,children:[e.jsx(Je,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),K&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>I(!0),children:e.jsx(Ye,{size:22})}),e.jsx(Ae,{open:S,onClose:()=>I(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>B("star"),disabled:z,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ge,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>B("likes5"),disabled:z,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Xe,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>B("comment"),disabled:z,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(ge,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>B("inspiration"),disabled:z,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(ge,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>B("reaction"),disabled:z,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ke,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>B("system"),disabled:z,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ze,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:a?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(g=>!(g.id.startsWith("b:")&&g.expiresAt&&g.expiresAt<=Date.now())).map(g=>{const v=({notif:h})=>{const[E,X]=o.useState(0),[pe,re]=o.useState(!1),W=o.useRef(null),se=o.useRef(null),j=o.useRef(null),V=o.useRef(null),Z=p=>{h.id.startsWith("n:")&&(W.current=p.touches[0].clientX,V.current=p.touches[0].clientY,se.current=Date.now(),re(!1))},ae=p=>{if(W.current===null||V.current===null||!h.id.startsWith("n:"))return;const k=p.touches[0].clientX,F=p.touches[0].clientY,$=k-W.current,Q=Math.abs(F-V.current);Math.abs($)>Q&&(re(!0),X(Math.max(-80,Math.min(0,$))))},U=()=>{if(W.current===null)return;E<=-60&&O(h.id),X(0),re(!1),W.current=null,V.current=null,se.current=null},ee=h.id.startsWith("n:"),r=typeof h.targetPath=="string"&&h.targetPath.trim().length>0?h.targetPath.trim():null;return e.jsxs("div",{ref:j,style:{position:"relative",background:h.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:r?"pointer":"default",opacity:h.read?.7:1,transform:`translateX(${E}px)`,transition:pe?"none":"transform 0.2s ease",touchAction:ee?"pan-x pan-y":"pan-y"},onTouchStart:Z,onTouchMove:ae,onTouchEnd:U,onTouchCancel:U,onClick:()=>{if(!(Math.abs(E)>10)){if(!h.read&&h.id.startsWith("n:")&&J([h.id]),r){b(r);return}h.videoId&&(window.location.hash="/feed")}},children:[ee&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(E)/80,pointerEvents:"none",zIndex:0},children:e.jsx(me,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:de(h)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:G(h)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(h.createdAt).toLocaleDateString()}),h.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:p=>{p.stopPropagation(),O(h.id)},style:{padding:4},children:e.jsx(me,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const p=w(h.text);return p?`${p.inviter_username} invited you to join queue: ${p.queue_name}`:h.text||(h.kind==="star"?"One of your posts was starred!":h.kind==="likes5"?"One of your posts reached 5 likes!":h.kind==="comment"?"Someone commented on your post":h.kind==="inspiration"?"Someone is inspired by you!":h.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const p=w(h.text);return p&&!x.has(h.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:k=>{k.stopPropagation(),te(h,p.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Je,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:k=>{k.stopPropagation(),P(h,p.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(he,{size:14,style:{marginRight:4}}),"Decline"]})]}):p&&x.has(h.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),h.read&&h.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(h.readAt).toLocaleString()]})]})]})]},h.id)};return e.jsx(v,{notif:g},g.id)})})})]})}function ss(){const[t,a]=o.useState([]),[n,m]=o.useState(!0),{notify:u}=ue();o.useEffect(()=>{b()},[]);const b=async()=>{try{m(!0);const f=await N(_.moddi.mySubmissions);a(f.items)}catch(f){console.error(f),u("Failed to load submissions",{variant:"error"})}finally{m(!1)}},c=f=>{a(y=>y.map(d=>d.id===f.id?{...d,...f}:d))},x=f=>{a(y=>y.filter(d=>d.id!==f))};return e.jsxs("div",{className:"col",style:{width:"100%",maxWidth:1e3,margin:"0 auto",padding:"24px 16px"},children:[e.jsx("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:24},children:e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"title",children:"My Submissions"}),e.jsx("div",{className:"muted",children:"Track your modding queue submissions"})]})}),n?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):t.length===0?e.jsxs("div",{className:"panel",style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx(Se,{to:"/queues",className:"btn",style:{marginTop:16,display:"inline-block"},children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:16},children:t.map(f=>e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",padding:"0 4px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(Se,{to:`/queues/${f.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:y=>y.currentTarget.style.textDecoration="underline",onMouseLeave:y=>y.currentTarget.style.textDecoration="none",children:f.queue_name}),f.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(f.created_at*1e3).toLocaleDateString()})]}),e.jsx(Fe,{submission:f,canManage:!1,allowSelfActions:!0,onUpdate:c,onDelete:x})]},f.id))})]})}export{at as D,Dt as F,ss as M,ts as N,Vt as Q,Xt as a,Ee as b,Ot as c,Kt as d,Lt as e,Zt as f,Pt as g,Bt as h,At as i,es as j,Me as u};
