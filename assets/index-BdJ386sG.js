var zt=Object.defineProperty;var Ft=(s,c,d)=>c in s?zt(s,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[c]=d;var ft=(s,c,d)=>Ft(s,typeof c!="symbol"?c+"":c,d);import{r as a,j as e,e as tt,u as st,R as re,L as U,T as Ge,U as Dt,V as Pt,B as Xe,W as Nt,X as $t,Y as Wt,Z as Ot,O as xt,K as qt,A as kt,h as St,P as Ut,Q as Bt,E as Ht,c as at,H as Vt,l as Ct,_ as gt,y as Qt,v as Yt,b as Jt,a as Kt,i as _t,g as Et,k as Ze,$ as Gt,a0 as bt,o as Xt,x as Zt,a1 as es,a2 as ts,a3 as ss,a4 as as,a5 as te}from"./vendor-react-O-yBVenC.js";import{y as ns}from"./vendor-CDuzPMMG.js";import{u as Ue,a as _,A as k,c as et,P as is,b as Ce,d as rs,C as os,T as ls,e as cs}from"./mappi-routes-ecbEJYKg.js";import{H as ds,c as us,b as ms,a as ps,i as hs}from"./editor-components-n6sMInZP.js";import{u as Be,a as nt,b as fs,c as xs,d as gs,e as bs,f as ys,g as vs,C as js,M as ws,P as Ns,Q as ks,h as Ss,N as Cs}from"./moddi-routes-4O_pegaN.js";import{B as _s,E as Es}from"./editor-lib-DWtn2wJw.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-C79RZ3qw.js";import"./vendor-zip-ChfUW0Uy.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))i(g);new MutationObserver(g=>{for(const h of g)if(h.type==="childList")for(const A of h.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&i(A)}).observe(document,{childList:!0,subtree:!0});function d(g){const h={};return g.integrity&&(h.integrity=g.integrity),g.referrerPolicy&&(h.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?h.credentials="include":g.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(g){if(g.ep)return;g.ep=!0;const h=d(g);fetch(g.href,h)}})();const Ts=new ns({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Rs extends a.Component{constructor(d){super(d);ft(this,"handleRetry",()=>{const d=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),d&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(d){return{hasError:!0,error:d}}componentDidCatch(d,i){console.error("ErrorBoundary caught an error:",d,i)}isChunkLoadingError(d){if(!d)return!1;const i=d.message.toLowerCase();return i.includes("loading chunk")||i.includes("failed to load")||i.includes("chunk load failed")||i.includes("loading css chunk")||d.name==="ChunkLoadError"}render(){var d;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const i=this.isChunkLoadingError(this.state.error),g=((d=this.state.error)==null?void 0:d.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:i?"Failed to load page. This might be a network issue.":g}),i&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:i?"Reload Page":"Try Again"}),!i&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const be=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Is({i:s}){const c=s*1337,d=(T,R)=>{const O=Math.sin(c+T+R)*1e4,B=O-Math.floor(O);return Math.floor(B*(R-T+1)+T)},i=d(0,100),g=d(24,50),h=.7+d(0,100)/100*.3,A=g*h,G=d(0,4e3),N=d(-10,10),D=d(-8,8),v=d(0,100),E=v<60?1:v<80?1.5:2,L=[{size:200*E,alpha:.06,dx:-22,dy:12,color:be[d(0,be.length-1)]},{size:150*E,alpha:.08,dx:-9,dy:7,color:be[d(0,be.length-1)]},{size:120*E,alpha:.1,dx:0,dy:0,color:be[d(0,be.length-1)]},{size:90*E,alpha:.12,dx:12,dy:-4,color:be[d(0,be.length-1)]},{size:64*E,alpha:.13,dx:20,dy:-7,color:be[d(0,be.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${i}vw`,animationDuration:`${A}s`,animationDelay:`${G}ms`,"--tx":`${N}vw`,transform:`rotate(${D}deg)`},children:L.map((T,R)=>e.jsx("svg",{width:T.size,height:T.size,viewBox:"0 0 100 100",style:{left:`${50+T.dx}%`,bottom:`${T.dy}px`,transform:"translateX(-50%)","--alpha":T.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:T.color})},R))})}function Tt({paused:s=!1}){const c=a.useMemo(()=>new Array(20).fill(0).map((d,i)=>i),[]);return e.jsx("div",{className:`triangles ${s?"paused":""}`,children:c.map(d=>e.jsx(Is,{i:d},d))})}function Ms(){const s=tt(),c=st(),{lastSection:d}=Be(),i=re.useRef(null),g=re.useRef(!1),h=re.useRef(0),A=re.useRef(0),G=300,N=2e3;re.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]);const D=s.pathname==="/"||s.pathname==="/about"||s.pathname==="/md/notifications",v=s.pathname==="/editor";s.pathname.startsWith("/mp/")||!D&&s.pathname.startsWith("/md/");const E=s.pathname.startsWith("/md/")&&s.pathname!=="/md/notifications"||!D&&!s.pathname.startsWith("/mp/")&&d==="moddi";if(v||D)return null;const L=()=>{const y=Date.now();if(y<A.current)return;const F=y-h.current;if(F<G&&F>0){A.current=y+N,h.current=0,c("/editor");return}h.current=y,A.current=y+N,c(E?"/mp/feed":"/md/feed")},T=()=>{g.current=!1,i.current=setTimeout(()=>{g.current=!0,c("/")},500)},R=()=>{i.current&&(clearTimeout(i.current),i.current=null),g.current&&setTimeout(()=>{g.current=!1},100)},O=y=>{if(g.current){y.preventDefault(),y.stopPropagation();return}L()},B=y=>{if(R(),g.current){y.preventDefault();return}L()};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(U,{to:E?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${s.pathname==="/mp/feed"||s.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(Ge,{size:20})}),E?e.jsx(U,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${s.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Dt,{size:20})}):e.jsx(U,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${s.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Pt,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:O,onTouchStart:T,onTouchEnd:B,onMouseDown:T,onMouseUp:R,onMouseLeave:R,"aria-label":E?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:E?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:E?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsx(U,{to:"/profile",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${s.pathname.startsWith("/profile")?"active":""}`,"aria-label":"Profile",children:e.jsx(Xe,{size:20})}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${s.pathname==="/settings"?"active":""}`,onClick:()=>c("/settings"),"aria-label":"Settings",children:e.jsx(Nt,{size:20})})]})]})}function Ls(){const s=tt(),c=st(),{notify:d}=Ue(),{data:i,isLoading:g}=nt(),{data:h}=fs(!!i),{data:A=[]}=xs(!!i),G=gs(),N=bs(),D=ys(),v=vs(),[E,L]=a.useState(new Set),T=a.useRef(null),R=a.useRef(null),O=a.useRef(null),B=a.useRef(null),y=a.useRef(null),F=a.useRef(null),P=a.useRef(null),f=a.useRef(null),{menuOpen:j,mobileNavOpen:w,notifOpen:p,filtersOpen:J,modeFilters:ie,tagFilters:oe,queueStatusFilters:le,lastSection:W,setMenuOpen:X,setMobileNavOpen:ee,setNotifOpen:$,setFiltersOpen:H,closeAllPanels:ae,setModeFilters:l,setTagFilters:M,setQueueStatusFilters:I,setLastSection:Y}=Be(),me=a.useRef(0),r=a.useRef(0),V=300,S=2e3,ce=t=>{t.preventDefault();const u=Date.now();if(u<r.current)return;const x=u-me.current;if(x<V&&x>0){r.current=u+S,me.current=0,c("/editor");return}me.current=u,r.current=u+S,c(ne?"/mp/feed":"/md/feed")},de=s.pathname==="/"||s.pathname==="/about"||s.pathname==="/md/notifications",ge=s.pathname==="/editor",he=s.pathname.startsWith("/mp/")||!de&&!s.pathname.startsWith("/md/")&&W==="mappi",ne=s.pathname.startsWith("/md/")&&s.pathname!=="/md/notifications"||!de&&!s.pathname.startsWith("/mp/")&&W==="moddi",We=s.pathname.startsWith("/md/queues/")&&s.pathname!=="/md/queues";re.useEffect(()=>{s.pathname.startsWith("/mp/")?Y("mappi"):s.pathname.startsWith("/md/")&&s.pathname!=="/md/notifications"&&Y("moddi")},[s.pathname,Y]);const[He,Z]=re.useState(0);re.useEffect(()=>{const t=setInterval(()=>Z(u=>u+1),1e3);return()=>clearInterval(t)},[]);const[ze,_e]=re.useState(null);re.useEffect(()=>{!i||!i.is_mod||(async()=>{try{const t=await _(k.admin.debugState,{requireAuth:!1}),u=Array.isArray(t==null?void 0:t.counts)?t.counts.find(x=>String(x.status)==="ready"):null;u&&_e(Number(u.c)||0)}catch{}})()},[i]);const[ke,Ee]=re.useState(!1),Te=async()=>{Ee(!0);try{const t=await _(k.admin.clearViews,{method:"POST"});d(`Cleared ${Number((t==null?void 0:t.deleted)||0)} views from your history.`,{variant:"success"});try{localStorage.removeItem("feed_seen_ids")}catch{}try{window.dispatchEvent(new Event("filterchange"))}catch{}}catch{d("Failed to clear view history",{variant:"error"})}finally{Ee(!1)}},Fe=t=>{if(!t)return null;try{const u=JSON.parse(t);if((u==null?void 0:u.type)==="queue_invite"&&(u!=null&&u.queue_id))return u}catch{}return null},De=async(t,u)=>{if(!E.has(t.id)){L(x=>new Set(x).add(t.id));try{await _(k.moddi.queueAccept(String(u)),{method:"POST"}),d("Invitation accepted!",{variant:"success"}),v.mutate(t.id),$(!1),c(`/md/queues/${u}`)}catch(x){d((x==null?void 0:x.message)||"Failed to accept invitation",{variant:"error"})}finally{L(x=>{const z=new Set(x);return z.delete(t.id),z})}}},Re=async(t,u)=>{if(!E.has(t.id)){L(x=>new Set(x).add(t.id));try{await _(k.moddi.queueDeny(String(u)),{method:"POST"}),d("Invitation declined",{variant:"success"}),v.mutate(t.id)}catch(x){d((x==null?void 0:x.message)||"Failed to decline invitation",{variant:"error"})}finally{L(x=>{const z=new Set(x);return z.delete(t.id),z})}}},Oe=async()=>{const t=A.filter(u=>u.id.startsWith("n:")||u.kind==="system"&&!u.read).map(u=>u.id);t.length>0&&D.mutate(t)},Ie=async t=>{if($(!1),D.mutate([t.id]),t.kind==="system"||t.id.startsWith("n:"))try{await _(k.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[t.id]})})}catch{}},Me=async(t,u)=>{t.stopPropagation(),v.mutate(u)},Le=()=>{const u=Object.entries(ie).filter(([x,z])=>z).map(([x])=>x);u.length,u.length===0&&l({standard:!0,taiko:!1,mania:!1,catch:!1});try{window.dispatchEvent(new Event("filterchange"))}catch{}H(!1)},Ve=()=>{const u=Object.entries(oe).filter(([x,z])=>z).map(([x])=>x);u.length,u.length===0&&M({untagged:!0,help:!0});try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}H(!1)};return re.useEffect(()=>{i&&!localStorage.getItem("welcomed")&&(d(`Welcome, ${i.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[i,d]),re.useEffect(()=>{if(!p)return;const t=u=>{const x=u.target;R.current&&!R.current.contains(x)&&T.current&&!T.current.contains(x)&&$(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[p,$]),re.useEffect(()=>{if(!j)return;const t=u=>{const x=u.target;B.current&&!B.current.contains(x)&&O.current&&!O.current.contains(x)&&X(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[j,X]),re.useEffect(()=>{if(!w)return;const t=u=>{const x=u.target;F.current&&!F.current.contains(x)&&y.current&&!y.current.contains(x)&&ee(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[w,ee]),re.useEffect(()=>{if(!J)return;const t=u=>{const x=u.target;f.current&&!f.current.contains(x)&&P.current&&!P.current.contains(x)&&H(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[J,H]),e.jsxs("div",{className:"app-shell","data-section":ne?"moddi":he?"mappi":W==="moddi"?"moddi":W==="mappi"?"mappi":void 0,children:[e.jsx(Tt,{paused:s.pathname==="/editor"}),e.jsxs("header",{className:"top-nav",children:[s.pathname!=="/editor"&&e.jsxs("div",{className:"mobile-nav",children:[e.jsx("button",{ref:y,className:"icon-link hamburger",onClick:()=>{w||ae(),ee(t=>!t)},"aria-label":"Menu","aria-expanded":w,children:e.jsx($t,{size:18})}),w&&e.jsxs("div",{ref:F,className:"menu-panel",role:"menu",children:[de&&e.jsx(U,{to:s.pathname==="/"?"/about":"/",className:`menu-item ${s.pathname==="/about"?"active":""}`,onClick:()=>ee(!1),children:s.pathname==="/"?"About":"Home"}),he&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:`menu-item ${s.pathname==="/mp/feed"?"active":""}`,onClick:()=>ee(!1),children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:`menu-item ${s.pathname==="/mp/discover"?"active":""}`,onClick:()=>ee(!1),children:"Discover"})]}),ne&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/md/feed",className:`menu-item ${s.pathname==="/md/feed"?"active":""}`,onClick:()=>ee(!1),children:"Feed"}),e.jsx(U,{to:"/md/queues",className:`menu-item ${s.pathname.startsWith("/md/queues")?"active":""}`,onClick:()=>ee(!1),children:"Queues"})]}),!he&&!ne&&!de&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:`menu-item ${s.pathname==="/mp/feed"?"active":""}`,onClick:()=>ee(!1),children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:`menu-item ${s.pathname==="/mp/discover"?"active":""}`,onClick:()=>ee(!1),children:"Discover"})]})]})]}),de?e.jsx(U,{to:"/",className:"title",children:ne?"osu!moddi.ng":he?"osu!mappi.ng":"mappi!"}):ge?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(U,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Ge,{size:18})}),e.jsx(U,{to:ne?"/md/feed":"/mp/feed",className:"title",children:ne?"osu!moddi.ng":"osu!mappi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(U,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Ge,{size:18})}),e.jsxs("button",{onClick:ce,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit",font:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:ne?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:ne?"osu!mappi.ng":"osu!moddi.ng"})]})]}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),s.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(ds,{})}):e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[de&&e.jsx(U,{to:s.pathname==="/"?"/about":"/",className:s.pathname==="/about"?"active":"",children:s.pathname==="/"?"About":"Home"}),he&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:s.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:s.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(U,{to:"/editor",className:s.pathname==="/editor"?"active":"",children:"Editor"})]}),ne&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/md/feed",className:s.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(U,{to:"/md/queues",className:s.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!he&&!ne&&!de&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:s.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:s.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(U,{to:"/editor",className:s.pathname==="/editor"?"active":"",children:"Editor"})]})]}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Wt,{size:18})}),i?e.jsxs("div",{className:"user-menu",children:[e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:T,className:"icon-link",onClick:()=>{p||ae(),$(t=>!t)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Ot,{size:18})}),G>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),p&&e.jsxs("div",{ref:R,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(U,{to:"/md/notifications",onClick:()=>$(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:t=>t.currentTarget.style.opacity="1",onMouseLeave:t=>t.currentTarget.style.opacity="0.7",children:"View all"}),A.filter(t=>!(t.kind==="system"&&t.id.startsWith("b:")&&(t.expiresAt||0)<=Date.now())).length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:Oe,children:e.jsx(xt,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[A.filter(t=>!(t.kind==="system"&&t.id.startsWith("b:")&&(t.expiresAt||0)<=Date.now())).length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),A.filter(t=>!(t.kind==="system"&&t.id.startsWith("b:")&&(t.expiresAt||0)<=Date.now())).map(t=>{const u=Fe(t.text),x=t.id.startsWith("b:"),z=u?"queue-invite":t.kind==="star"?"star":t.kind==="likes5"?"likes":t.kind==="comment"?"comment":t.kind==="inspiration"?"inspiration":t.kind==="reaction"?"reaction":x?"global":"system",Q=t.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${z}`,role:"button",onClick:()=>!u&&Ie(t),children:[e.jsxs("div",{className:`notif-icon ${Q?"deletable":""}`,"aria-hidden":"true",onClick:Q&&!u?ve=>Me(ve,t.id):void 0,title:Q&&!u?"Remove":void 0,role:Q&&!u?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:u?e.jsx(qt,{}):z==="star"?e.jsx(kt,{}):z==="likes"?e.jsx(St,{}):z==="comment"?e.jsx(Xe,{}):z==="inspiration"?e.jsx(Xe,{}):z==="reaction"?e.jsx(Ut,{}):z==="global"?e.jsx(Bt,{}):null}),Q&&!u?e.jsx("span",{className:"swap-trash",children:e.jsx(Ht,{})}):null]}),e.jsx("div",{className:"notif-body",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[u.inviter_username," invited you to join queue: ",u.queue_name]}),E.has(t.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:ve=>{ve.stopPropagation(),De(t,u.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(xt,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:ve=>{ve.stopPropagation(),Re(t,u.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(at,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):t.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:x?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:t.text||""}),x&&t.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(t.expiresAt).toLocaleString()]}):null]}):t.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:t.text||"Someone commented on your post"})]}):t.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:t.text||"Someone is inspired by you!"})]}):t.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:t.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:t.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:t.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},t.id)})]})]})]}),h!=null&&h.blocked?e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(Vt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:(()=>{const t=Math.max(0,Math.floor((((h==null?void 0:h.reset_at)??0)*1e3-Date.now())/1e3)),u=Math.floor(t/3600),x=Math.floor(t%3600/60),z=t%60,Q=ve=>String(ve).padStart(2,"0");return u>0?`${u}:${Q(x)}:${Q(z)}`:`${x}:${Q(z)}`})()})]}):null,e.jsxs("button",{ref:O,className:"icon-link",onClick:()=>{j||ae(),X(t=>!t)},title:i.username,"aria-label":"User menu","aria-expanded":j,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:i.username}),e.jsx(Ct,{size:14,style:{opacity:.8}})]}),j&&e.jsxs("div",{ref:B,className:"menu-panel",role:"menu",children:[e.jsx(U,{to:"/profile",className:"menu-item",onClick:()=>X(!1),children:"Profile"}),i!=null&&i.is_admin||i!=null&&i.is_mod?e.jsx(U,{to:"/moderation",className:"menu-item",onClick:()=>X(!1),children:"Moderation"}):null,e.jsx("button",{className:"menu-item",type:"button",onClick:()=>N.mutate(),children:"Log out"})]})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=et+k.auth.login},disabled:g,children:g?"Checking…":"Login with osu!"})]})]}),e.jsx("main",{className:`page ${s.pathname==="/editor"||s.pathname==="/mp/discover"?"fullscreen":""}`,children:s.pathname==="/about"||s.pathname==="/moderation"||s.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(gt,{})}):e.jsx(gt,{})}),s.pathname!=="/editor"&&e.jsxs(e.Fragment,{children:[i&&i.is_mod&&ze!==null&&e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[ze," videos ready"]})}),e.jsxs("div",{className:"site-controls","aria-hidden":!1,children:[e.jsx("button",{ref:P,className:"settings-btn",onClick:()=>{J||ae(),H(t=>!t)},"aria-expanded":J,"aria-label":"Filter settings",title:"Filter settings",children:e.jsx(Nt,{size:18})}),J&&e.jsx("div",{ref:f,className:"settings-panel",role:"dialog","aria-modal":"false",children:We?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:8},children:[["unchecked","Pending","#f59e0b"],["accepted","Accepted","#10b981"],["denied","Denied","#ef4444"],["finished","Finished","#6366f1"],["archived","Archived","#6b7280"]].map(([t,u,x])=>{const z=le[t];return e.jsx("button",{className:`mode-cell ${z?"selected":""}`,"aria-pressed":z,onClick:()=>{I({...le,[t]:!z})},style:{padding:"10px 14px",borderRadius:8,fontSize:13,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontWeight:z?600:500,background:z?x+"15":"transparent",border:`1.5px solid ${z?x+"50":"rgba(255,255,255,0.08)"}`,color:z?x:"var(--text)",transition:"all 0.2s ease",cursor:"pointer",textAlign:"left",width:"100%"},onMouseEnter:Q=>{z?(Q.currentTarget.style.background=x+"25",Q.currentTarget.style.borderColor=x+"70"):(Q.currentTarget.style.background="rgba(255,255,255,0.05)",Q.currentTarget.style.borderColor="rgba(255,255,255,0.12)")},onMouseLeave:Q=>{Q.currentTarget.style.background=z?x+"15":"transparent",Q.currentTarget.style.borderColor=z?x+"50":"rgba(255,255,255,0.08)"},children:u},t)})}),e.jsx("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn secondary compact",onClick:()=>H(!1),children:"Close"})})]}):ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:6},children:[["untagged","Untagged"],["help","Help"]].map(([t,u])=>{const x=oe[t];return e.jsx("button",{className:`mode-cell ${x?"selected":""}`,"aria-pressed":x,onClick:()=>{M({...oe,[t]:!x})},children:e.jsx("span",{children:u})},t)})}),i&&(i.is_admin||i.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:ke,onClick:Te,children:ke?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>H(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:Ve,children:"Apply"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Game modes"}),e.jsx("div",{className:"col",style:{gap:6},children:[["standard","Standard",us],["taiko","Taiko",ms],["mania","Mania",ps],["catch","Catch",hs]].map(([t,u,x])=>{const z=ie[t];return e.jsxs("button",{className:`mode-cell ${z?"selected":""}`,"aria-pressed":z,onClick:()=>{l({...ie,[t]:!z})},children:[e.jsx("img",{className:"mode-icon",src:x,width:24,height:24,alt:""}),e.jsx("span",{children:u})]},t)})}),i&&(i.is_admin||i.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:ke,onClick:Te,children:ke?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>H(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:Le,children:"Apply"})]})]})})]})]}),e.jsx(Ms,{})]})}function As(){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions",children:[e.jsx(U,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(U,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function zs(){const{data:s}=nt(),{modeFilters:c}=Be(),d=Object.entries(c).filter(([g,h])=>h).map(([g])=>g),i=d.length?d.join(","):"standard";return Qt({queryKey:["mappi","feed",i],queryFn:async({pageParam:g=0})=>{const h=new URLSearchParams({limit:"20",offset:String(g),modes:i}),A=`${k.feed.recent}?${h.toString()}`;return await _(A)},enabled:!!s,initialPageParam:0,getNextPageParam:(g,h)=>{var N;const A=h.reduce((D,v)=>{var E;return D+(((E=v.items)==null?void 0:E.length)||0)},0);return(((N=g.items)==null?void 0:N.length)||0)===20?A:void 0}})}function $e(){const s=tt(),c=Yt(),{data:d}=nt(),{modeFilters:i}=Be(),{data:g,fetchNextPage:h,hasNextPage:A,isFetching:G,isFetchingNextPage:N,refetch:D}=zs(),v=a.useMemo(()=>(g==null?void 0:g.pages.flatMap(y=>y.items||[]))||[],[g]),E=a.useMemo(()=>{const y=Object.entries(i).filter(([P,f])=>f).map(([P])=>P.toLowerCase()),F=new Set(y.length?y:["standard"]);return v.filter(P=>{const f=String(P.mode||"standard").toLowerCase();return F.has(f)})},[v,i]);a.useEffect(()=>{s.pathname==="/mp/feed"&&D()},[s.pathname,D]),a.useEffect(()=>{const y=()=>{D()};return window.addEventListener("filterchange",y),()=>window.removeEventListener("filterchange",y)},[D]);const L=y=>{c.setQueryData(["mappi","feed"],F=>F&&{...F,pages:F.pages.map(P=>({...P,items:P.items.map(f=>f.id===y.id?y:f)}))})},T=y=>{c.setQueryData(["mappi","feed"],F=>F&&{...F,pages:F.pages.map(P=>({...P,items:P.items.filter(f=>f.id!==y)}))})},R=()=>{D()},O=G&&!N,B=A??!1;return e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(js,{section:"mappi",onUpload:R})]}),e.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[E.length===0&&!O&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),E.map(y=>e.jsx(is,{post:y,section:"mappi",onUpdate:L,onDelete:T,me:d},y.id)),E.length>0&&B&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>h(),disabled:N,children:N?"Loading...":"Load more"})})]})})]})}const xe={};function Fs(){try{const s=localStorage.getItem("feed_seen_ids");if(s){const c=JSON.parse(s);Array.isArray(c)&&(xe.seenIds=c.filter(d=>typeof d=="number"))}}catch{}return xe}function yt(s){Object.assign(xe,s);try{const c=Array.from(new Set(xe.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(c))}catch{}}function vt(){var mt,pt,ht;const{notify:s}=Ue(),[c,d]=a.useState(xe.history||[]),[i,g]=a.useState(xe.index??-1),[h,A]=a.useState(xe.queue||[]),[G,N]=a.useState(!1),[D,v]=a.useState(!1),[E,L]=a.useState(xe.eligibleCount??null),[T,R]=a.useState(xe.viewedCount??0),[O,B]=a.useState(!1),[y,F]=a.useState(!0),[P,f]=a.useState(!1),[j,w]=a.useState(!1),[p,J]=a.useState(!1),[ie,oe]=a.useState(!1),[le,W]=a.useState(!1),[X,ee]=a.useState([]),[$,H]=a.useState(""),[ae,l]=a.useState(null),[M,I]=a.useState(!1),[Y,me]=a.useState(null),[r,V]=a.useState(!1),S=a.useRef(new Set(xe.seenIds||[])),ce=a.useRef(new Set),de=a.useRef(!1),ge=a.useRef(xe.lastShownVideoId??null),he=a.useRef(!1),ne=a.useRef(0),We=a.useRef(0),He=a.useRef(0),Z=a.useRef(null),ze=a.useRef(null),_e=a.useRef(null),ke=a.useRef(null),Ee=a.useRef(null),Te=a.useRef(null),Fe=a.useRef(null),De=a.useRef(null),Re=a.useRef(0),Oe=a.useRef(0),Ie=a.useRef(null),Me=a.useRef(null),[Le,Ve]=a.useState(0),t=a.useMemo(()=>i>=0?c[i]:null,[c,i]);a.useEffect(()=>{Fs()},[]),a.useEffect(()=>{yt({history:c,index:i,queue:h,seenIds:Array.from(S.current),eligibleCount:E??void 0,viewedCount:T,lastShownVideoId:ge.current??void 0})},[c,i,h,E,T]);const u=a.useCallback(()=>{try{const n=localStorage.getItem("filter_modes"),o=(n?String(n):"standard").toLowerCase().split(",").map(C=>C.trim()).filter(Boolean),m=["standard","taiko","mania","catch"],b=Array.from(new Set(o.filter(C=>m.includes(C))));return b.length?b:["standard"]}catch{return["standard"]}},[]),x=a.useCallback(()=>{const n=new Set;return ge.current!==null&&n.add(ge.current),Array.from(S.current).slice(-200).forEach(m=>n.add(m)),h.forEach(m=>n.add(m.id)),Array.from(n)},[h]),z=a.useCallback(async(n=3)=>{var b,C,K,je;if(de.current)return[];const o=Date.now();if(o<ne.current){const ue=Math.ceil((ne.current-o)/1e3);return s(`Rate limited. Please wait ${ue}s.`,{durationMs:3e3,variant:"warn"}),[]}const m=o-He.current;if(m<2e3){const ue=2e3-m;await new Promise(we=>setTimeout(we,ue))}de.current=!0,He.current=Date.now();try{const ue=x(),we=u().join(","),pe=[],Ne=new Set(h.map(fe=>fe.id));let Pe=[...ue];const Je=Math.min(n,3);for(let fe=0;fe<Je;fe++){if(fe>0){const q=Date.now()-We.current,se=1e3;q<se&&await new Promise(Se=>setTimeout(Se,se-q))}try{We.current=Date.now();const q=await _(k.feed.next+Ce({exclude:Pe.join(","),modes:we}),{requireAuth:!1}),se=q&&("id"in q?q:q.video)||null;if(!se)break;if(S.current.has(se.id)||Ne.has(se.id)||se.id===ge.current){Pe.push(se.id);continue}pe.push(se),Pe.push(se.id),Ne.add(se.id)}catch(q){if((b=q==null?void 0:q.message)!=null&&b.includes("401")||(C=q==null?void 0:q.message)!=null&&C.includes("Unauthorized")){B(!0);break}else if((K=q==null?void 0:q.message)!=null&&K.includes("429")||(je=q==null?void 0:q.message)!=null&&je.includes("rate limit")){ne.current=Date.now()+5e3,s("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(pe.length>0&&A(fe=>{const q=new Set(fe.map(Se=>Se.id)),se=pe.filter(Se=>!q.has(Se.id));return[...fe,...se]}),pe.length===0&&h.length===0)try{const fe=u().join(","),q=await _(k.feed.progress(fe),{requireAuth:!1});L(Number(q.eligible||0)),R(Number(q.viewed||0)),v(Number(q.caught_up||0)===1)}catch{}return pe}catch{return[]}finally{de.current=!1}},[x,u,h,s]),Q=a.useCallback(async()=>{if(!G){N(!0);try{h.length<=2&&z(3).catch(()=>{});let n;if(h.length>0)n=h[0],A(o=>o.filter(m=>m.id!==n.id));else{const o=await z(3);o.length>0&&(n=o[0],o.length>1&&A(m=>{const b=new Set(m.map(K=>K.id)),C=o.slice(1).filter(K=>!b.has(K.id));return[...m,...C]}))}if(n)ge.current=n.id,S.current.add(n.id),yt({seenIds:Array.from(S.current)}),d(o=>{const m=[...o.slice(0,i+1),n];return g(m.length-1),m}),ce.current.has(n.id)||(ce.current.add(n.id),_(k.videos.view(n.id),{method:"POST"}).then(o=>{o&&d(m=>{const b=[...m],C=b.findIndex(K=>K.id===n.id);return C!==-1&&(b[C]={...b[C],views_count:o.views_count??b[C].views_count??0,viewed_by_me:!0}),b})}).catch(()=>{}));else try{const o=u().join(","),m=await _(k.feed.progress(o),{requireAuth:!1});L(Number(m.eligible||0)),R(Number(m.viewed||0)),v(Number(m.eligible||0)>0&&Number(m.viewed||0)>=Number(m.eligible||0))}catch{}}finally{N(!1)}}},[G,h,z,i,u]),ve=a.useCallback(()=>{Z.current&&!Z.current.paused&&Z.current.pause(),f(!0),W(!1)},[]),Qe=a.useCallback(()=>{i>0&&(g(i-1),f(!1))},[i]),Ye=a.useCallback(()=>{const n=Date.now();if(!(n-Oe.current<300)){if(Oe.current=n,y||(he.current=!0,F(!1)),i<c.length-1){const o=c[i+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:i,nextIndex:i+1,currentVideoId:t==null?void 0:t.id,nextVideoId:o==null?void 0:o.id,nextVideoStreamUID:o==null?void 0:o.stream_uid}),o&&(ge.current=o.id),g(i+1),f(!1);return}if(!D){if(Date.now()<ne.current){const o=Math.ceil((ne.current-Date.now())/1e3);s(`Rate limited. Please wait ${o}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),Q()}}},[i,c,y,D,Q,s,t]);a.useEffect(()=>{const n=ze.current;if(!n)return;const o=C=>{if(O||Math.abs(C.deltaY)<Math.abs(C.deltaX))return;C.preventDefault(),C.stopPropagation();const K=Date.now();if(!(K<Re.current)){if(Re.current=K+1e3,!t){C.deltaY>0&&!G&&Q();return}C.deltaY>0?Ye():Qe()}},m=C=>{Ie.current=C.touches[0].clientY,Me.current=Date.now()},b=C=>{if(O||Ie.current===null||Me.current===null)return;const K=C.changedTouches[0].clientY,je=Date.now(),ue=Ie.current-K,we=je-Me.current;if(Ie.current=null,Me.current=null,Math.abs(ue)<50||we>300)return;const pe=Date.now();if(!(pe<Re.current)){if(Re.current=pe+1e3,!t){ue>0&&!G&&Q();return}ue>0?Ye():Qe()}};return n.addEventListener("wheel",o,{passive:!1,capture:!0}),n.addEventListener("touchstart",m,{passive:!0}),n.addEventListener("touchend",b,{passive:!0}),window.addEventListener("wheel",o,{passive:!1,capture:!0}),()=>{n.removeEventListener("wheel",o,{capture:!0}),n.removeEventListener("touchstart",m),n.removeEventListener("touchend",b),window.removeEventListener("wheel",o,{capture:!0})}},[Ye,Qe,t,G,Q,O]);const Rt=a.useCallback(async()=>{var n,o;if(!(!t||r)){V(!0);try{const m=t.liked_by_me?"DELETE":"POST",b=await _(k.videos.like(t.id),{method:m});d(C=>{const K=[...C],je=K.findIndex(ue=>ue.id===t.id);return je!==-1&&(K[je]={...K[je],liked_by_me:!t.liked_by_me,likes_count:b.likes_count}),K})}catch(m){((n=m==null?void 0:m.message)!=null&&n.includes("429")||(o=m==null?void 0:m.message)!=null&&o.includes("rate limit"))&&s("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{V(!1)}}},[t,r,s]),it=a.useCallback(async n=>{if(t)try{await _(k.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:n})}),s("Thanks for your report.",{variant:"info"})}catch{s("Report failed",{variant:"error"})}finally{J(!1)}},[t,s]),It=a.useCallback(async()=>{if(!t)return;const n=!t.is_starred,o=n?"star":"unstar";try{await _(k.admin.videosAction(t.id,o),{method:"POST"}),d(m=>{const b=[...m],C=b.findIndex(K=>K.id===t.id);return C!==-1&&(b[C]={...b[C],is_starred:n}),b}),oe(!1),s(n?"Post starred":"Star removed",{variant:"success"})}catch{s("Action failed",{variant:"error"})}},[t,s]),rt=a.useCallback(async()=>{if(!(!t||!confirm("Permanently delete this video?")))try{await _(k.videos.delete(t.id),{method:"DELETE"}),s("Deleted",{variant:"warn"}),J(!1),d(n=>{const o=n.filter((m,b)=>b!==i);return o.length===0?(g(-1),setTimeout(Q,0)):g(m=>Math.max(0,Math.min(m,o.length-1))),o})}catch{alert("Delete failed")}},[t,i,Q,s]),qe=a.useCallback(async()=>{if(t!=null&&t.id)try{const n=await _(k.videos.comments(t.id),{requireAuth:!1});ee(n.items||[])}catch{}},[t==null?void 0:t.id]);a.useEffect(()=>{j&&(t!=null&&t.id)&&qe()},[j,t==null?void 0:t.id,qe]);const ot=a.useCallback(async n=>{if(n.preventDefault(),!(!$.trim()||!(t!=null&&t.id))){I(!0);try{await _(k.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:$.trim(),parent_id:ae||void 0})}),H(""),l(null),qe(),d(o=>{const m=[...o],b=m.findIndex(C=>C.id===t.id);return b!==-1&&(m[b]={...m[b],comments_count:(m[b].comments_count||0)+1}),m}),s("Comment posted!",{variant:"success"})}catch(o){s((o==null?void 0:o.message)||"Failed to post comment",{variant:"error"})}finally{I(!1)}}},[$,t,ae,qe,s]),Mt=a.useCallback(n=>{ee(o=>o.filter(m=>m.id!==n)),d(o=>{const m=[...o],b=m.findIndex(C=>C.id===(t==null?void 0:t.id));return b!==-1&&(m[b]={...m[b],comments_count:Math.max(0,(m[b].comments_count||0)-1)}),m})},[t==null?void 0:t.id]),{topLevelComments:lt,repliesMap:ct}=a.useMemo(()=>{const n=X.filter(m=>!m.parent_id),o=new Map;return X.filter(m=>m.parent_id).forEach(m=>{const b=m.parent_id;o.has(b)||o.set(b,[]),o.get(b).push(m)}),{topLevelComments:n,repliesMap:o}},[X]),Lt=a.useCallback(()=>{if(!Z.current)return;const n=!y;F(n),Z.current.muted=n,n||(he.current=!0),!n&&Z.current.paused&&Z.current.play().catch(()=>{})},[y]),At=a.useCallback(n=>{Z.current=n,n&&(n.muted=y)},[y]);a.useEffect(()=>{f(!1),w(!1),he.current?F(!1):F(!0)},[t==null?void 0:t.id,t==null?void 0:t.stream_uid,i,c.length]),a.useEffect(()=>{Z.current&&(Z.current.muted=y)},[y]),a.useEffect(()=>{if(!t)return;const n=!he.current;F(n);const o=setTimeout(()=>{Z.current&&(Z.current.muted=n)},100);return()=>clearTimeout(o)},[t==null?void 0:t.id]),a.useEffect(()=>{t&&(ge.current=t.id)},[t==null?void 0:t.id]),a.useEffect(()=>{P&&Z.current&&!Z.current.paused&&Z.current.pause()},[P]),a.useEffect(()=>{c.length===0&&Q()},[]),a.useEffect(()=>{(async()=>{try{const n=u().join(","),o=await _(k.feed.progress(n),{requireAuth:!1}),m=Number(o.eligible||0),b=Number(o.viewed||0);L(m),R(b),v(m>0&&b>=m)}catch{}})()},[u]),a.useEffect(()=>{const n=()=>{d([]),A([]),S.current.clear(),ge.current=null,g(-1),v(!1),(async()=>{try{const o=u().join(","),m=await _(k.feed.progress(o),{requireAuth:!1}),b=Number(m.eligible||0),C=Number(m.viewed||0);L(b),R(C),v(!1)}catch{}Q()})()};return window.addEventListener("filterchange",n),()=>window.removeEventListener("filterchange",n)},[u,Q]),a.useEffect(()=>{(async()=>{try{const n=await _(k.auth.me,{requireAuth:!1});me(n)}catch{}})()},[]);const[Ae,dt]=a.useState(!1);a.useEffect(()=>{const n=()=>{const b=document.querySelector(".top-nav");b&&Ve(b.offsetHeight),dt(window.matchMedia("(max-width: 480px)").matches)};n();const o=window.matchMedia("(max-width: 480px)"),m=()=>dt(o.matches);return o.addEventListener("change",m),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),o.removeEventListener("change",m)}},[]),a.useEffect(()=>{var m;if(!_e.current||!ke.current||!t||!Z.current)return;const n=()=>{var Se;const b=(Se=ke.current)==null?void 0:Se.querySelector("div"),C=Z.current;if(!b||!C||!_e.current)return;const K=_e.current,ue=window.matchMedia("(max-width: 480px)").matches?0:32,we=K.offsetWidth-ue,pe=K.offsetHeight-ue;let Ne;t.width&&t.height?Ne=t.width/t.height:C.videoWidth>0&&C.videoHeight>0?Ne=C.videoWidth/C.videoHeight:Ne=16/9;const Pe=16/9,Je=we/Pe;let q=Math.min(pe,Je),se=q*Ne;se>we&&(se=we,q=se/Ne),q>pe&&(q=pe,se=q*Ne),b.style.width=`${se}px`,b.style.height=`${q}px`,b.style.maxWidth="100%",b.style.maxHeight="100%"},o=()=>{requestAnimationFrame(n)};if(Z.current.readyState>=1)n();else{const b=()=>{var C;n(),(C=Z.current)==null||C.removeEventListener("loadedmetadata",b)};(m=Z.current)==null||m.addEventListener("loadedmetadata",b)}return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[t==null?void 0:t.id,t==null?void 0:t.width,t==null?void 0:t.height]),a.useEffect(()=>{if(!p)return;const n=o=>{Ee.current&&!Ee.current.contains(o.target)&&J(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[p]),a.useEffect(()=>{if(!ie)return;const n=o=>{Te.current&&!Te.current.contains(o.target)&&oe(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[ie]),a.useEffect(()=>{if(!le)return;const n=o=>{Fe.current&&!Fe.current.contains(o.target)&&De.current&&!De.current.contains(o.target)&&W(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[le]);const ut=!!(Y!=null&&Y.is_admin||Y!=null&&Y.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Tt,{paused:Ae}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
      `}),e.jsxs("div",{ref:ze,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[D&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:Le+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:_e,className:"video-area discover-video-container",style:{position:"absolute",top:Ae?0:Le,left:0,right:0,bottom:Ae?"calc(68px + env(safe-area-inset-bottom))":0,maxHeight:Ae?"calc(100dvh - 68px - env(safe-area-inset-bottom))":`calc(100dvh - ${Le}px)`,height:Ae?"calc(100dvh - 68px - env(safe-area-inset-bottom))":`calc(100dvh - ${Le}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:Ae?"0":"16px",maxWidth:"100vw",width:"100%"},children:O?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=et+k.auth.login,children:"Login with osu!"})]}):t?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:Lt,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:ke,className:"discover-player-wrapper",children:e.jsx(rs,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t.width&&t.height?t.width/t.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:y,controls:!1,onVideoRef:At})}),e.jsx("div",{style:{position:"absolute",top:16,right:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:y?1:0,zIndex:2},children:y?e.jsx(Jt,{size:28,color:"#fff"}):e.jsx(Kt,{size:28,color:"#fff"})})]})]})}):D?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"• Click video to toggle mute/unmute"}),e.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!P&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:n=>n.stopPropagation(),children:[e.jsx(U,{to:`/profile/${(mt=t.uploader)==null?void 0:mt.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(pt=t.uploader)!=null&&pt.avatar_url?e.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:Rt,disabled:r,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:t.liked_by_me?e.jsx(St,{size:28}):e.jsx(_t,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>w(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Et,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:De,onClick:()=>W(n=>!n),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Ze,{size:24})}),le&&e.jsxs("div",{ref:Fe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>W(!1),children:[e.jsx(Ze,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:ve,children:"Preview"})]})]}),ut?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>oe(n=>!n),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(bt,{size:24})}),ie&&e.jsxs("div",{ref:Te,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:It,children:t.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:rt,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>J(n=>!n),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Gt,{size:24})}),p&&e.jsxs("div",{ref:Ee,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>it("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>it("explicit"),children:"Explicit"}),ut&&e.jsx("button",{className:"menu-item",onClick:rt,children:"Delete video"})]})]}),t&&!P&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(U,{to:`/profile/${(ht=t.uploader)==null?void 0:ht.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var b,C,K;const n=(b=t.uploader)==null?void 0:b.is_admin,o=(C=t.uploader)==null?void 0:C.is_mod,m=n?"#fff3bf":o?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:m},children:["@",(K=t.uploader)==null?void 0:K.username]}),t.is_starred&&e.jsx(kt,{size:16,color:"#f59e0b",title:"Starred"}),(n||o)&&e.jsx(bt,{size:14,color:m,title:n?"admin":"mod"})]})})()})}),(t.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),j&&t&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),e.jsx("button",{onClick:()=>w(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(at,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:lt.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:lt.map(n=>e.jsx(os,{comment:n,replies:ct.get(n.id)||[],me:Y,section:"mappi",onReply:o=>l(o),onDelete:Mt,replyingTo:ae,replyText:$,onReplyTextChange:H,onReplySubmit:ot,posting:M,onCancelReply:()=>{l(null),H("")},repliesMap:ct},n.id))})}),Y&&!ae&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:ot,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:$,onChange:n=>H(n.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:n=>{const o=n.target;o.style.height="auto",o.style.height=`${Math.min(o.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:M||!$.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:M?"...":"Post"})]})})]})]}),P&&(t==null?void 0:t.beatmapset_id)&&e.jsx(_s,{open:P,onClose:()=>f(!1),downloadUrl:`${et}${k.osu.downloadBeatmapset(t.beatmapset_id)}`,beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})]})}function jt(s){if(!s)return"standard";const c=String(s).toLowerCase().trim();return c==="osu"||c==="0"||c==="standard"?"standard":c==="taiko"||c==="1"?"taiko":c==="catch"||c==="fruits"||c==="2"?"catch":c==="mania"||c==="3"?"mania":"standard"}const Ds=({open:s,onClose:c,videoId:d,initialDescription:i,initialBeatmapUrl:g,onSave:h})=>{const[A,G]=a.useState(i||""),[N,D]=a.useState(g||""),[v,E]=a.useState(null),[L,T]=a.useState(null),[R,O]=a.useState(""),[B,y]=a.useState(!1),F=a.useRef(0);a.useEffect(()=>{s&&(G(i||""),D(g||""),E(null),T(null),O(""))},[s,i,g]),a.useEffect(()=>{if(!s)return;F.current&&window.clearTimeout(F.current);const f=(N||"").trim();if(!f){O(""),E(null),T(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(f)){O(""),E(null),T(null);return}return F.current=window.setTimeout(async()=>{var w;try{let p;try{p=new URL(f)}catch{O("Invalid URL format");return}const J=p.hash.match(/#osu\/(\d+)/),ie=J?J[1]:null;p.hash="";const le={url:p.toString()};ie&&(le.beatmap_id=ie);const W=await _(k.osu.resolveBeatmap+Ce(le),{requireAuth:!1}),X=Array.isArray(W==null?void 0:W.diffs)?W.diffs:[];if(!X.length&&!W.setId){O("No difficulties found"),E(null),T(null);return}if(E({setId:Number(W.setId)||0,beatmapId:W.beatmapId??null,title:String(W.title||""),artist:String(W.artist||""),mapper:String(W.mapper||""),diffs:X}),X.length>0){const ee=Number.isFinite(Number(W.beatmapId))?Number(W.beatmapId):Number((w=X[0])==null?void 0:w.id),$=X.find(ae=>Number(ae.id)===ee)||X[0],H=jt($==null?void 0:$.mode);T({beatmapId:Number($==null?void 0:$.id)||null,version:String(($==null?void 0:$.version)||""),mode:H})}O("")}catch(p){O(`Failed to resolve: ${(p==null?void 0:p.message)||"Unknown error"}`),E(null),T(null)}},400),()=>{F.current&&window.clearTimeout(F.current)}},[N,s]);const P=async()=>{if(!B){y(!0);try{await _(k.videos.update(d),{method:"PATCH",body:JSON.stringify({description:A.slice(0,100),beatmap_url:N.trim()||void 0})});const f=!!N.trim();if(v||!f)try{await _(k.videos.update(d)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:f&&v&&v.setId>0?v.setId:null,beatmap_id:f&&(L!=null&&L.beatmapId)?L.beatmapId:null,beatmap_version:f&&(L!=null&&L.version)?L.version:null,beatmap_title:f&&(v!=null&&v.title)?v.title:null,beatmap_artist:f&&(v!=null&&v.artist)?v.artist:null,beatmap_mapper:f&&(v!=null&&v.mapper)?v.mapper:null,beatmap_url:f?N.trim():null})})}catch(w){console.warn("Failed to update beatmap metadata:",w)}h(A,N.trim()||null),c()}catch(f){alert((f==null?void 0:f.message)||"Failed to update post")}finally{y(!1)}}};return s?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:f=>f.target===f.currentTarget&&c(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:c}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:c,"aria-label":"Close",children:e.jsx(at,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:A,onChange:f=>G(f.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),v?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[v.artist," – ",v.title]}),e.jsxs("span",{className:"muted",children:["by ",v.mapper]})]}),e.jsx("select",{value:(L==null?void 0:L.beatmapId)??v.beatmapId??void 0,onChange:f=>{const j=Number(f.target.value),w=(v==null?void 0:v.diffs.find(p=>Number(p.id)===j))||null;if(w){const p=jt(w.mode);T({beatmapId:j,version:w.version,mode:p})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:v.diffs.map(f=>e.jsxs("option",{value:f.id,children:[f.version," (",f.mode,")"]},f.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{E(null),T(null),D("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:N,onChange:f=>D(f.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),R&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:R})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:c,disabled:B,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:P,disabled:B,children:B?"Saving...":"Save"})]})]})]})]}):null};function wt(){const s=Xt(),c=st(),{notify:d}=Ue(),[i,g]=a.useState(null),[h,A]=a.useState(null),[G,N]=a.useState(""),[D,v]=a.useState([]),[E,L]=a.useState([]),[T,R]=a.useState([]),[O,B]=a.useState(""),[y,F]=a.useState(null),[P,f]=a.useState([]),[j,w]=a.useState(null),[p,J]=a.useState(""),[ie,oe]=a.useState([]),[le,W]=a.useState(null),[X,ee]=a.useState(!1),$=a.useMemo(()=>{const l=s.id?Number(s.id):null;return l?i?i.id===l:!1:!0},[s.id,i]);function H(l){const M=l.stream_uid||String(l.id),I=s.id?`/profile/${s.id}`:"/profile";c(`/mp/feed/${M}`,{state:{returnTo:I}})}a.useEffect(()=>{(async()=>{try{const l=await _(k.auth.me,{requireAuth:!1});g(l),l&&Array.isArray(l.inspirations)&&f(l.inspirations)}catch(l){N((l==null?void 0:l.message)||"Not logged in")}})()},[]),a.useEffect(()=>{(async()=>{try{const l=s.id?Number(s.id):null;if(l){const M=await _(k.users.get(l),{requireAuth:!1});A(M),B(M.about||""),Array.isArray(M.inspirations)&&f(M.inspirations);const I=await _(k.users.videos(l)+Ce({limit:"60"}),{requireAuth:!1});R(I.items||[]);const Y=await _(k.users.likes(l)+Ce({limit:"60"}),{requireAuth:!1});L(Y.items||[])}else{if(!i)return;A(i),B(i.about||""),Array.isArray(i.inspirations)&&f(i.inspirations);const M=await _(k.users.myVideos+Ce({limit:"50"}),{requireAuth:!1});v(M.items||[]);const I=await _(k.users.likes(i.id)+Ce({limit:"60"}),{requireAuth:!1});L(I.items||[])}}catch{}})()},[s.id,i]),a.useEffect(()=>{ee(!1)},[h==null?void 0:h.id]);async function ae(l){try{const I=(await _(k.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:l})})).user||h;A(I),Array.isArray(I==null?void 0:I.inspirations)&&f(I.inspirations),s.id||g(I)}catch{}}return a.useEffect(()=>{let l;return j!==null&&p.trim().length>=2?l=setTimeout(async()=>{try{const M=await _(k.osu.usersSearch(p),{requireAuth:!1});oe(Array.isArray(M.items)?M.items:[])}catch{}},250):oe([]),()=>{l&&clearTimeout(l)}},[p,j]),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:h?e.jsxs(e.Fragment,{children:[h.avatar_url&&e.jsx("img",{src:h.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[h.username,h.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${h.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:l=>l.currentTarget.style.opacity="1",onMouseLeave:l=>l.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Ze,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",h.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!$&&P.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),P.map((l,M)=>$?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(l.id),onMouseLeave:()=>W(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const I=P.filter((Y,me)=>me!==M);f(I),ae(I)},children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),le===l.id&&e.jsxs("div",{className:"insp-tooltip",children:[l.username," — click to remove"]})]},l.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(l.id),onMouseLeave:()=>W(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${l.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),le===l.id&&e.jsx("div",{className:"insp-tooltip",children:l.username})]},l.id)),$&&P.length<3&&new Array(3-P.length).fill(0).map((l,M)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(-M-1),onMouseLeave:()=>W(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{w(M),J(""),oe([])},children:"+"}),le===-M-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),j===M&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:p,onChange:I=>J(I.target.value)}),e.jsxs("div",{className:"insp-results",children:[ie.length===0&&p.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),ie.map(I=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(i&&Number(i.osu_user_id)===Number(I.id)){d("Kinda based, but no.",{variant:"warn"}),w(null);return}if(P.some(me=>me.id===I.id)){w(null);return}const Y=[...P,{id:I.id,username:I.username,avatar_url:I.avatar_url}].slice(0,3);f(Y),w(null),ae(Y)},children:[e.jsx("img",{src:I.avatar_url,alt:"avatar"}),e.jsx("span",{children:I.username})]},I.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>w(null),children:"Close"})]})]},`slot-${M}`))]}),$&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:G||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),$?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:O,onChange:l=>B(l.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn compact",onClick:async()=>{try{const l=await _(k.auth.me,{method:"PATCH",body:JSON.stringify({about:O})});A(l.user||h),g(l.user||i)}catch{}},children:"Save"})})]}):(()=>{const l=((h==null?void 0:h.about)||"").trim()||"No bio.",M=l.length>200,I=M&&!X?l.slice(0,200)+"...":l;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:I}),M&&e.jsx("button",{onClick:()=>ee(!X),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(Zt,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Ct,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:l=>{const M=l.currentTarget.closest(".profile-tabs-unified");M.querySelectorAll(".profile-tab").forEach(Y=>{Y.classList.remove("active"),Y.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),M.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:l=>{const M=l.currentTarget.closest(".profile-tabs-unified");M.querySelectorAll(".profile-tab").forEach(Y=>{Y.classList.remove("active"),Y.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),M.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[($?D:T).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),($?D:T).map(l=>($&&h?(h.id,h.username,h.avatar_url,h.is_admin,h.is_mod):l.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>H({...l}),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(_t,{size:12}),e.jsx("span",{children:l.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:12}),e.jsx("span",{children:l.comments_count??0})]})]})})]},l.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[E.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),E.map(l=>{var M,I;return e.jsxs("button",{className:"recent-cell",onClick:()=>H(l),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((M=l.uploader)==null?void 0:M.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:l.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(I=l.uploader)==null?void 0:I.username})]})]},l.id)})]})})})]})]}),y&&e.jsx(Ds,{open:!!y,onClose:()=>F(null),videoId:y.id,initialDescription:y.description,initialBeatmapUrl:y.beatmap_url,onSave:(l,M)=>{v(D.map(I=>I.id===y.id?{...I,description:l||null,beatmap_url:M}:I)),F(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function Ps(){var l,M,I,Y,me;const[s,c]=a.useState(null),[d,i]=a.useState([]),[g,h]=a.useState(""),[A,G]=a.useState([]),[N,D]=a.useState(null),[v,E]=a.useState([]),[L,T]=a.useState("all"),[R,O]=a.useState("approvals"),[B,y]=a.useState(null),[F,P]=a.useState(""),[f,j]=a.useState(!1),{notify:w}=Ue(),[p,J]=a.useState(null),[ie,oe]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const r=await _(k.auth.me,{requireAuth:!1});if(c(r),r!=null&&r.is_admin)try{const V=await _(k.admin.settingsModeration,{requireAuth:!1});y(!!V.require_approval)}catch{}}catch{}try{const r=await _(k.admin.videosPending+Ce({limit:"50"}),{requireAuth:!1});i(r.items||[])}catch{}})()},[]);async function le(){oe(!0);try{const r=await _(k.admin.analytics,{requireAuth:!1});J(r)}finally{oe(!1)}}async function W(){try{const r=await _(k.admin.usersSearch(g),{requireAuth:!1});G(r.items||[])}catch{}}async function X(r){D(r),E([]);try{const V=await _(k.admin.userVideos(r.id)+Ce({limit:"50"}),{requireAuth:!1});E(V.items||[])}catch{}}async function ee(r,V){try{const S=await _(k.admin.user(r.id),{method:"PATCH",body:JSON.stringify({is_mod:V})}),ce=(S==null?void 0:S.user)||{...r,is_mod:V};w(V?"Granted moderation":"Revoked moderation",{variant:V?"success":"warn"}),D(ce),G(A.map(de=>de.id===r.id?ce:de))}catch{alert("Failed to update")}}const $=!!(s!=null&&s.is_admin||s!=null&&s.is_mod),H=!!(s!=null&&s.is_admin),ae=B===null?null:!B;return e.jsxs("div",{className:"col",style:{width:"100%"},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[e.jsx("div",{className:"title",children:"Moderation"}),H&&ae!==null&&e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:"Auto-approve"}),e.jsx("button",{className:`btn ${ae?"":"secondary"}`,style:{padding:"6px 10px"},onClick:async()=>{if(B===null)return;const r=!B;try{await _(k.admin.settingsModeration,{method:"POST",body:JSON.stringify({require_approval:r})}),y(r),w(r?"Auto-approve disabled":"Auto-approve enabled",{variant:r?"warn":"success"})}catch{alert("Failed to update setting")}},children:ae?"On":"Off"})]})]}),$&&e.jsxs("div",{className:"tabs",role:"tablist","aria-label":"Moderation tabs",children:[e.jsx("button",{role:"tab","aria-selected":R==="approvals",className:`tab ${R==="approvals"?"active":""}`,onClick:()=>O("approvals"),children:"Approvals"}),(H||(s==null?void 0:s.is_mod))&&e.jsx("button",{role:"tab","aria-selected":R==="manage",className:`tab ${R==="manage"?"active":""}`,onClick:()=>O("manage"),children:"Manage"}),(H||(s==null?void 0:s.is_mod))&&e.jsx("button",{role:"tab","aria-selected":R==="analytics",className:`tab ${R==="analytics"?"active":""}`,onClick:()=>{O("analytics"),p||le()},children:"Analytics"}),(H||(s==null?void 0:s.is_mod))&&e.jsx("button",{role:"tab","aria-selected":R==="message",className:`tab ${R==="message"?"active":""}`,onClick:()=>O("message"),children:"Message"})]})]}),e.jsx("hr",{className:"subtle-divider"}),!$&&e.jsx("div",{className:"muted",children:"You do not have access."}),R==="approvals"&&$&&(()=>{const r=d.filter(S=>!S.flagged_only),V=d.filter(S=>!!S.flagged_only);return e.jsxs("div",{className:"row wrap",style:{marginTop:12,gap:16,alignItems:"flex-start"},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[r.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",children:[r.length===0&&e.jsx("div",{className:"muted",children:"Nothing pending."}),r.map(S=>e.jsxs("div",{className:"row wrap",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[S.poster_url?e.jsx("img",{src:S.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:S.description||"",children:S.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:["uploader: ",S.username,S.needs_review?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{marginLeft:6,color:"#60a5fa"},children:"(pending)"}),typeof S.flags_count=="number"&&S.flags_count>0?e.jsxs("span",{className:"muted",style:{marginLeft:6},children:["• ",S.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"row wrap",children:[e.jsx("button",{className:"btn secondary",onClick:async()=>{try{await _(k.admin.videosReject(S.id),{method:"POST"}),i(d.filter(ce=>ce.id!==S.id)),w("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn",style:{marginLeft:8},onClick:async()=>{try{await _(k.admin.videosApprove(S.id),{method:"POST"}),i(d.filter(ce=>ce.id!==S.id)),w("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await _(k.videos.delete(S.id),{method:"DELETE"}),i(d.filter(ce=>ce.id!==S.id)),w("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},S.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[V.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",children:[V.length===0&&e.jsx("div",{className:"muted",children:"No flagged items."}),V.map(S=>e.jsxs("div",{className:"row wrap",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[S.poster_url?e.jsx("img",{src:S.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:S.description||"",children:S.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:["uploader: ",S.username,e.jsx("span",{style:{marginLeft:6,color:"#9ca3af"},children:"(flagged)"}),typeof S.flags_count=="number"&&S.flags_count>0?e.jsxs("span",{className:"muted",style:{marginLeft:6},children:["• ",S.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"row wrap",children:e.jsx("button",{className:"btn secondary",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await _(k.videos.delete(S.id),{method:"DELETE"}),i(d.filter(ce=>ce.id!==S.id)),w("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},S.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:6},children:"Flagged items don’t require approval; use Delete only if necessary."})]})]})})(),R==="manage"&&(H||(s==null?void 0:s.is_mod))&&e.jsx("div",{className:"col",style:{marginTop:16},children:e.jsxs("div",{className:"mod-manage-grid",children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"User management"}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:g,onChange:r=>h(r.target.value),onKeyDown:r=>{r.key==="Enter"&&W()}}),e.jsx("button",{className:"btn",onClick:W,style:{padding:"6px 10px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:8},children:e.jsx("div",{className:"col",style:{gap:6},children:A.map(r=>e.jsxs("button",{className:"btn secondary",onClick:()=>X(r),style:{justifyContent:"flex-start"},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:18,height:18,style:{borderRadius:"50%",marginRight:8}}),e.jsx("span",{className:"one-line",style:{marginRight:8},children:r.username}),e.jsxs("span",{className:"muted",children:["(id ",r.id,", osu ",r.osu_user_id,")"]}),r.is_admin?e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"admin"}):r.is_mod?e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"mod"}):r.is_blacklisted?e.jsx("span",{style:{marginLeft:"auto",color:"#f87171"},children:"blacklisted"}):null]},r.id))})})]}),e.jsx("div",{className:"v-divider","aria-hidden":"true"}),e.jsx("div",{className:"col",style:{minWidth:0},children:N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row wrap",style:{alignItems:"center"},children:[N.avatar_url&&e.jsx("img",{src:N.avatar_url,width:28,height:28,style:{borderRadius:"50%",marginRight:8}}),e.jsx("div",{className:"title",style:{marginRight:8,fontSize:18},children:N.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",N.id," • osu ",N.osu_user_id]}),e.jsx("div",{style:{marginLeft:"auto"}}),H?N.is_admin?e.jsx("span",{}):N.is_mod?e.jsx("button",{className:"btn secondary",style:{padding:"6px 10px"},onClick:()=>ee(N,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn",style:{padding:"6px 10px"},onClick:()=>ee(N,!0),children:"Grant moderation"}):null,!N.is_admin&&(N.is_blacklisted?e.jsx("button",{className:"btn",style:{marginLeft:8,padding:"6px 10px"},onClick:async()=>{try{await _(k.admin.user(N.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),D({...N,is_blacklisted:!1}),w("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{marginLeft:8,padding:"6px 10px"},onClick:async()=>{try{await _(k.admin.user(N.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),D({...N,is_blacklisted:!0}),w("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),N.is_admin?e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"}):null,e.jsxs("div",{className:"col",style:{marginTop:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:"Show"}),e.jsx("button",{className:`btn ${L==="all"?"":"secondary"}`,onClick:()=>T("all"),children:"All"}),e.jsx("button",{className:`btn ${L==="review"?"":"secondary"}`,onClick:()=>T("review"),children:"Needs review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{marginTop:8},children:[v.length===0&&e.jsx("div",{className:"muted",children:"No uploads."}),v.filter(r=>{if(L==="all")return!0;const V=(B?!r.approved_at:!1)&&r.status==="ready",S=!!r.needs_review;return V||S}).map(r=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[r.poster_url?e.jsx("img",{src:r.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:r.description||"",children:r.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:[r.status.toUpperCase()," • ",new Date(r.created_at*1e3).toLocaleString(),r.needs_review?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(purgatory)"}):null,B&&!r.approved_at&&r.status==="ready"?e.jsx("span",{style:{marginLeft:6,color:"#60a5fa"},children:"(pending)"}):null]})]})]}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",children:r.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)"},children:"★"}),(H||(s==null?void 0:s.is_mod))&&(!!r.needs_review||B&&!r.approved_at&&r.status==="ready")&&e.jsx("button",{className:"btn",onClick:async()=>{try{await _(k.admin.videosApprove(r.id),{method:"POST"}),E(v.map(V=>V.id===r.id?{...V,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:V)),w("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(H||(s==null?void 0:s.is_mod))&&e.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await _(k.videos.delete(r.id),{method:"DELETE"}),E(v.filter(V=>V.id!==r.id)),w("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},r.id))]})]})]}):e.jsx("div",{className:"muted",children:"Select a user to view details and uploads."})})]})}),!1,R==="message"&&(H||(s==null?void 0:s.is_mod))&&e.jsx("div",{className:"col",style:{marginTop:16},children:e.jsxs("div",{className:"mod-manage-grid",children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"Send a system message"}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:g,onChange:r=>h(r.target.value),onKeyDown:r=>{r.key==="Enter"&&W()}}),e.jsx("button",{className:"btn",onClick:W,style:{padding:"6px 10px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:8},children:e.jsx("div",{className:"col",style:{gap:6},children:A.map(r=>e.jsxs("button",{className:"btn secondary",onClick:()=>D(r),style:{justifyContent:"flex-start"},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:18,height:18,style:{borderRadius:"50%",marginRight:8}}),e.jsx("span",{className:"one-line",style:{marginRight:8},children:r.username}),e.jsxs("span",{className:"muted",children:["(id ",r.id,", osu ",r.osu_user_id,")"]}),(N==null?void 0:N.id)===r.id&&e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"selected"})]},r.id))})})]}),e.jsx("div",{className:"v-divider","aria-hidden":"true"}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:f,onChange:r=>j(r.currentTarget.checked)}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",style:{height:120,resize:"vertical"},value:F,onChange:r=>P(r.target.value)}),e.jsx("div",{className:"row wrap",style:{justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn",onClick:()=>{const r=(F||"").trim();if(!r){alert("Enter a message");return}(async()=>{try{const V={text:r,global:f};!f&&(N!=null&&N.id)&&(V.user_id=N.id),await _(k.admin.notificationsSystem,{method:"POST",body:JSON.stringify(V)}),P(""),w("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"})}),e.jsx("div",{className:"caption",style:{marginTop:6},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),R==="analytics"&&(H||(s==null?void 0:s.is_mod))&&e.jsxs("div",{className:"col",style:{marginTop:16,gap:12},children:[e.jsx("div",{className:"title",children:"Analytics"}),ie&&e.jsx("div",{className:"muted",children:"Loading…"}),!ie&&!p&&e.jsx("div",{className:"muted",children:"No data."}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{flexWrap:"wrap",gap:10},children:[e.jsx(ye,{label:"Users",value:p.totals.users_total}),e.jsx(ye,{label:"Admins",value:p.totals.users_admin}),e.jsx(ye,{label:"Mods",value:p.totals.users_mod}),e.jsx(ye,{label:"Blacklisted",value:p.totals.users_blacklisted}),e.jsx(ye,{label:"Videos",value:p.totals.videos_total}),e.jsx(ye,{label:"Ready",value:p.totals.videos_ready}),e.jsx(ye,{label:"Pending",value:p.totals.pending_count}),e.jsx(ye,{label:"Purgatory",value:p.totals.purgatory_count}),e.jsx(ye,{label:"Likes",value:p.totals.likes_total}),e.jsx(ye,{label:"Flags",value:p.totals.flags_total})]}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap",gap:20,marginTop:8},children:[e.jsx(Ke,{title:"New users (30d)",series:p.series.users,color:"#60a5fa"}),e.jsx(Ke,{title:"New videos (30d)",series:p.series.videos,color:"#34d399"}),((M=(l=p.stream)==null?void 0:l.graphql)==null?void 0:M.minutes_viewed)&&p.stream.graphql.minutes_viewed.length>0&&e.jsx(Ke,{title:"Minutes viewed (30d)",series:p.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:6,marginTop:8},children:[e.jsx("div",{className:"title",children:"Feed & Stream"}),e.jsxs("div",{className:"muted",children:["Feed: ",p.feed.count," items in rotation",p.feed.cursor?` • cursor ${p.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",children:["Approx. ready seconds: ",p.stream.approximate.total_duration_sec," • ready videos: ",p.stream.approximate.videos_ready]}),p.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12},children:["Stream API: ",p.stream.api.ok?"ok":"unavailable",(Y=(I=p.stream.api)==null?void 0:I.result_info)!=null&&Y.count?` • count ${p.stream.api.result_info.count}`:"",(me=p.stream.api)!=null&&me.sample_status?` • sample status ${String(p.stream.api.sample_status)}`:""]})]})]})]})]})}function ye({label:s,value:c}){return e.jsxs("div",{className:"col",style:{padding:"8px 10px",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,minWidth:120},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:s}),e.jsx("div",{className:"title",children:c})]})}function Ke({title:s,series:c,color:d}){const D=c.map(j=>j.count),v=Math.max(1,...D),E=a.useMemo(()=>{const j=v,w=Math.pow(10,Math.floor(Math.log10(j))),p=j/w;return(p<=1?1:p<=2?2:p<=5?5:10)*w},[v]),L=350,T=124,R=a.useMemo(()=>c.map((j,w)=>{const p=42+w/Math.max(1,c.length-1)*L,J=8+(1-j.count/(E||1))*T;return[p,J]}),[c,E,L,T]),O=a.useMemo(()=>R.map((j,w)=>w===0?`M ${j[0]} ${j[1]}`:`L ${j[0]} ${j[1]}`).join(" "),[R]),B=[0,.25,.5,.75,1],y=a.useMemo(()=>{if(c.length===0)return[];const j=[0,.25,.5,.75,1].map(w=>Math.min(c.length-1,Math.round(w*(c.length-1))));return Array.from(new Set(j))},[c]),F=j=>{if(!j||j.length<10)return j||"";const w=j.slice(5,7).replace(/^0/,""),p=j.slice(8,10).replace(/^0/,"");return`${w}/${p}`};function P(j){const w=Number.isInteger(j);return j>=1e6?`${(j/1e6).toFixed(1).replace(/\.0$/,"")}M`:j>=1e3?`${(j/1e3).toFixed(1).replace(/\.0$/,"")}k`:w?String(j):j<10?j.toFixed(1):j.toFixed(1).replace(/\.0$/,"")}const f=c.length?c[c.length-1].count:0;return e.jsxs("div",{className:"col",style:{border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:10},children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{className:"muted",children:s}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["latest: ",P(f)]})]}),e.jsxs("svg",{width:400,height:160,role:"img","aria-label":s,children:[e.jsx("rect",{x:0,y:0,width:400,height:160,fill:"#0f1217",rx:8}),B.map((j,w)=>{const p=8+(1-j)*T,J=j*E;return e.jsxs("g",{children:[e.jsx("line",{x1:42,y1:p,x2:392,y2:p,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:36,y:p+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:P(J)})]},w)}),e.jsx("line",{x1:42,y1:8,x2:42,y2:8+T,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:42,y1:8+T,x2:42+L,y2:8+T,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),y.map((j,w)=>{var J;const p=42+j/Math.max(1,c.length-1)*L;return e.jsxs("g",{children:[e.jsx("line",{x1:p,y1:8,x2:p,y2:8+T,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:p,y:8+T+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:F((J=c[j])==null?void 0:J.day)})]},w)}),e.jsx("path",{d:O,fill:"none",stroke:d,strokeWidth:2}),R.length>0&&e.jsx("circle",{cx:R[R.length-1][0],cy:R[R.length-1][1],r:3,fill:d})]})]})}function $s(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Ws(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const Os=()=>e.jsx(Es,{}),qs=()=>e.jsx(as,{children:e.jsxs(te,{element:e.jsx(Ls,{}),children:[e.jsx(te,{path:"/",element:e.jsx(As,{})}),e.jsx(te,{path:"/mp/discover",element:e.jsx(vt,{})}),e.jsx(te,{path:"/mp/feed",element:e.jsx($e,{})}),e.jsx(te,{path:"/mp/feed/:uid",element:e.jsx(cs,{})}),e.jsx(te,{path:"/md/feed",element:e.jsx(ws,{})}),e.jsx(te,{path:"/md/feed/:uid",element:e.jsx(Ns,{})}),e.jsx(te,{path:"/md/queues",element:e.jsx(ks,{})}),e.jsx(te,{path:"/md/queues/:id",element:e.jsx(Ss,{})}),e.jsx(te,{path:"/md/notifications",element:e.jsx(Cs,{})}),e.jsx(te,{path:"/profile",element:e.jsx(wt,{})}),e.jsx(te,{path:"/profile/:id",element:e.jsx(wt,{})}),e.jsx(te,{path:"/moderation",element:e.jsx(Ps,{})}),e.jsx(te,{path:"/about",element:e.jsx($s,{})}),e.jsx(te,{path:"/settings",element:e.jsx(Ws,{})}),e.jsx(te,{path:"/editor",element:e.jsx(Os,{})}),e.jsx(te,{path:"/feed",element:e.jsx(vt,{})}),e.jsx(te,{path:"/upload",element:e.jsx($e,{})}),e.jsx(te,{path:"/posts",element:e.jsx($e,{})}),e.jsx(te,{path:"/recents",element:e.jsx($e,{})}),e.jsx(te,{path:"/recent",element:e.jsx($e,{})})]})}),Us=()=>e.jsx(ss,{children:e.jsx(qs,{})});es(document.getElementById("root")).render(e.jsx(Rs,{children:e.jsx(ts,{client:Ts,children:e.jsx(ls,{children:e.jsx(Us,{})})})}));
