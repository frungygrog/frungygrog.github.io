import{r as s,j as n,b as ot,a as lt,L as ye,p as ct,D as dt,E as ut,G as Ye,I as mt,J as $e,A as Ve,c as pt}from"./vendor-react-_vsaDC62.js";import{P as ft}from"./Popup-D-8ssjeF.js";import{O as ht}from"./Overlay-DfMiSqaj.js";import{C as gt}from"./Comment-BW92-hju.js";import{u as xt,a as y,A as h,b as bt,B as yt,c as vt}from"./index-D3mogye1.js";import"./vendor-DBgzFpze.js";import"./beatmap-preview-iFLBdsja.js";import"./editor-lib-BGkr3wNG.js";import"./editor-components-CKFEosPJ.js";const j={};function wt(){try{const c=localStorage.getItem("feed_seen_ids");if(c){const p=JSON.parse(c);Array.isArray(p)&&(j.seenIds=p.filter(S=>typeof S=="number"))}}catch{}return j}function Je(c){Object.assign(j,c);try{const p=Array.from(new Set(j.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(p))}catch{}}function Tt(){var Fe,Oe,Be,qe,He,We;const{notify:c}=xt(),[p,S]=s.useState(j.history||[]),[u,T]=s.useState(j.index??-1),[v,q]=s.useState(j.queue||[]),[ve,we]=s.useState(!1),[H,A]=s.useState(!1),[je,W]=s.useState(j.eligibleCount??null),[Se,U]=s.useState(j.viewedCount??0),[Xe,Qe]=s.useState(!1),[w,P]=s.useState(!0),[F,D]=s.useState(!1),[m,ee]=s.useState(!1),[te,Y]=s.useState(!1),[ne,re]=s.useState(!1),[se,$]=s.useState(!1),[ie,ke]=s.useState([]),[L,V]=s.useState(""),[J,ae]=s.useState(null),[oe,Ce]=s.useState(!1),[I,Ge]=s.useState(null),[le,Ie]=s.useState(!1),M=s.useRef(new Set(j.seenIds||[])),Ee=s.useRef(new Set),ce=s.useRef(!1),E=s.useRef(j.lastShownVideoId??null),X=s.useRef(!1),O=s.useRef(0),_e=s.useRef(0),Re=s.useRef(0),f=s.useRef(null),ze=s.useRef(null),de=s.useRef(null),ue=s.useRef(null),me=s.useRef(null),pe=s.useRef(null),fe=s.useRef(null),Q=s.useRef(0),Te=s.useRef(0),G=s.useRef(null),K=s.useRef(null),[N,Ke]=s.useState(0),t=s.useMemo(()=>u>=0?p[u]:null,[p,u]);s.useEffect(()=>{wt()},[]),s.useEffect(()=>{Je({history:p,index:u,queue:v,seenIds:Array.from(M.current),eligibleCount:je??void 0,viewedCount:Se,lastShownVideoId:E.current??void 0})},[p,u,v,je,Se]);const C=s.useCallback(()=>{try{const e=localStorage.getItem("filter_modes"),r=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),i=["standard","taiko","mania","catch"],a=Array.from(new Set(r.filter(o=>i.includes(o))));return a.length?a:["standard"]}catch{return["standard"]}},[]),De=s.useCallback(()=>{const e=new Set;return E.current!==null&&e.add(E.current),Array.from(M.current).slice(-200).forEach(i=>e.add(i)),v.forEach(i=>e.add(i.id)),Array.from(e)},[v]),he=s.useCallback(async(e=3)=>{var a,o,d,g;if(ce.current)return[];const r=Date.now();if(r<O.current){const x=Math.ceil((O.current-r)/1e3);return c(`Rate limited. Please wait ${x}s.`,{durationMs:3e3,variant:"warn"}),[]}const i=r-Re.current;if(i<2e3){const x=2e3-i;await new Promise(_=>setTimeout(_,x))}ce.current=!0,Re.current=Date.now();try{const x=De(),_=C().join(","),R=[],Ue=new Set(v.map(k=>k.id));let be=[...x];const at=Math.min(e,3);for(let k=0;k<at;k++){if(k>0){const l=Date.now()-_e.current,b=1e3;l<b&&await new Promise(B=>setTimeout(B,b-l))}try{_e.current=Date.now();const l=await y(h.feed.next+bt({exclude:be.join(","),modes:_}),{requireAuth:!1}),b=l&&("id"in l?l:l.video)||null;if(!b)break;if(M.current.has(b.id)||Ue.has(b.id)||b.id===E.current){be.push(b.id);continue}R.push(b),be.push(b.id),Ue.add(b.id)}catch(l){if((a=l==null?void 0:l.message)!=null&&a.includes("401")||(o=l==null?void 0:l.message)!=null&&o.includes("Unauthorized")){Qe(!0);break}else if((d=l==null?void 0:l.message)!=null&&d.includes("429")||(g=l==null?void 0:l.message)!=null&&g.includes("rate limit")){O.current=Date.now()+5e3,c("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(R.length>0&&q(k=>{const l=new Set(k.map(B=>B.id)),b=R.filter(B=>!l.has(B.id));return[...k,...b]}),R.length===0&&v.length===0)try{const k=C().join(","),l=await y(h.feed.progress(k),{requireAuth:!1});W(Number(l.eligible||0)),U(Number(l.viewed||0)),A(Number(l.caught_up||0)===1)}catch{}return R}catch{return[]}finally{ce.current=!1}},[De,C,v,c]),z=s.useCallback(async()=>{if(!ve){we(!0);try{v.length<=2&&he(3).catch(()=>{});let e;if(v.length>0)e=v[0],q(r=>r.filter(i=>i.id!==e.id));else{const r=await he(3);r.length>0&&(e=r[0],r.length>1&&q(i=>{const a=new Set(i.map(d=>d.id)),o=r.slice(1).filter(d=>!a.has(d.id));return[...i,...o]}))}if(e)E.current=e.id,M.current.add(e.id),Je({seenIds:Array.from(M.current)}),S(r=>{const i=[...r.slice(0,u+1),e];return T(i.length-1),i}),Ee.current.has(e.id)||(Ee.current.add(e.id),y(h.videos.view(e.id),{method:"POST"}).then(r=>{r&&S(i=>{const a=[...i],o=a.findIndex(d=>d.id===e.id);return o!==-1&&(a[o]={...a[o],views_count:r.views_count??a[o].views_count??0,viewed_by_me:!0}),a})}).catch(()=>{}));else try{const r=C().join(","),i=await y(h.feed.progress(r),{requireAuth:!1});W(Number(i.eligible||0)),U(Number(i.viewed||0)),A(Number(i.eligible||0)>0&&Number(i.viewed||0)>=Number(i.eligible||0))}catch{}}finally{we(!1)}}},[ve,v,he,u,C]),Ze=s.useCallback(()=>{f.current&&!f.current.paused&&f.current.pause(),D(!0),$(!1)},[]),ge=s.useCallback(()=>{u>0&&(T(u-1),D(!1))},[u]),xe=s.useCallback(()=>{const e=Date.now();if(!(e-Te.current<300)){if(Te.current=e,w||(X.current=!0,P(!1)),u<p.length-1){const r=p[u+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:u,nextIndex:u+1,currentVideoId:t==null?void 0:t.id,nextVideoId:r==null?void 0:r.id,nextVideoStreamUID:r==null?void 0:r.stream_uid}),r&&(E.current=r.id),T(u+1),D(!1);return}if(!H){if(Date.now()<O.current){const r=Math.ceil((O.current-Date.now())/1e3);c(`Rate limited. Please wait ${r}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),z()}}},[u,p,w,H,z,c,t]);s.useEffect(()=>{const e=ze.current;if(!e)return;const r=o=>{if(e){const g=e.getBoundingClientRect(),x=o.clientX,_=o.clientY;if(x<g.left||x>g.right||_<g.top||_>g.bottom)return}o.preventDefault(),o.stopPropagation();const d=Date.now();d<Q.current||(Q.current=d+1e3,!(Math.abs(o.deltaY)<Math.abs(o.deltaX))&&(o.deltaY>0?xe():ge()))},i=o=>{G.current=o.touches[0].clientY,K.current=Date.now()},a=o=>{if(G.current===null||K.current===null)return;const d=o.changedTouches[0].clientY,g=Date.now(),x=G.current-d,_=g-K.current;if(G.current=null,K.current=null,Math.abs(x)<50||_>300)return;const R=Date.now();R<Q.current||(Q.current=R+1e3,x>0?xe():ge())};return e.addEventListener("wheel",r,{passive:!1,capture:!0}),e.addEventListener("touchstart",i,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",r,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",r,{capture:!0}),e.removeEventListener("touchstart",i),e.removeEventListener("touchend",a),window.removeEventListener("wheel",r,{capture:!0})}},[xe,ge]);const et=s.useCallback(async()=>{var e,r;if(!(!t||le)){Ie(!0);try{const i=t.liked_by_me?"DELETE":"POST",a=await y(h.videos.like(t.id),{method:i});S(o=>{const d=[...o],g=d.findIndex(x=>x.id===t.id);return g!==-1&&(d[g]={...d[g],liked_by_me:!t.liked_by_me,likes_count:a.likes_count}),d})}catch(i){((e=i==null?void 0:i.message)!=null&&e.includes("429")||(r=i==null?void 0:i.message)!=null&&r.includes("rate limit"))&&c("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{Ie(!1)}}},[t,le,c]),Le=s.useCallback(async e=>{if(t)try{await y(h.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),c("Thanks for your report.",{variant:"info"})}catch{c("Report failed",{variant:"error"})}finally{Y(!1)}},[t,c]),tt=s.useCallback(async()=>{if(!t)return;const e=!t.is_starred,r=e?"star":"unstar";try{await y(h.admin.videosAction(t.id,r),{method:"POST"}),S(i=>{const a=[...i],o=a.findIndex(d=>d.id===t.id);return o!==-1&&(a[o]={...a[o],is_starred:e}),a}),re(!1),c(e?"Post starred":"Star removed",{variant:"success"})}catch{c("Action failed",{variant:"error"})}},[t,c]),Me=s.useCallback(async()=>{if(!(!t||!confirm("Permanently delete this video?")))try{await y(h.videos.delete(t.id),{method:"DELETE"}),c("Deleted",{variant:"warn"}),Y(!1),S(e=>{const r=e.filter((i,a)=>a!==u);return r.length===0?(T(-1),setTimeout(z,0)):T(i=>Math.max(0,Math.min(i,r.length-1))),r})}catch{alert("Delete failed")}},[t,u,z,c]),Z=s.useCallback(async()=>{if(t!=null&&t.id)try{const e=await y(h.videos.comments(t.id),{requireAuth:!1});ke(e.items||[])}catch{}},[t==null?void 0:t.id]);s.useEffect(()=>{m&&(t!=null&&t.id)&&Z()},[m,t==null?void 0:t.id,Z]);const Ne=s.useCallback(async e=>{if(e.preventDefault(),!(!L.trim()||!(t!=null&&t.id))){Ce(!0);try{await y(h.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:L.trim(),parent_id:J||void 0})}),V(""),ae(null),Z(),S(r=>{const i=[...r],a=i.findIndex(o=>o.id===t.id);return a!==-1&&(i[a]={...i[a],comments_count:(i[a].comments_count||0)+1}),i}),c("Comment posted!",{variant:"success"})}catch(r){c((r==null?void 0:r.message)||"Failed to post comment",{variant:"error"})}finally{Ce(!1)}}},[L,t,J,Z,c]),nt=s.useCallback(e=>{ke(r=>r.filter(i=>i.id!==e)),S(r=>{const i=[...r],a=i.findIndex(o=>o.id===(t==null?void 0:t.id));return a!==-1&&(i[a]={...i[a],comments_count:Math.max(0,(i[a].comments_count||0)-1)}),i})},[t==null?void 0:t.id]),{topLevelComments:Ae,repliesMap:rt}=s.useMemo(()=>{const e=ie.filter(i=>!i.parent_id),r=new Map;return ie.filter(i=>i.parent_id).forEach(i=>{const a=i.parent_id;r.has(a)||r.set(a,[]),r.get(a).push(i)}),{topLevelComments:e,repliesMap:r}},[ie]),st=s.useCallback(()=>{if(!f.current)return;const e=!w;P(e),f.current.muted=e,e||(X.current=!0),!e&&f.current.paused&&f.current.play().catch(()=>{})},[w]),it=s.useCallback(e=>{f.current=e,e&&(e.muted=w)},[w]);s.useEffect(()=>{console.log("[Discover] Video changed:",{videoId:t==null?void 0:t.id,streamUID:t==null?void 0:t.stream_uid,index:u,historyLength:p.length}),D(!1),ee(!1),X.current?P(!1):P(!0)},[t==null?void 0:t.id,t==null?void 0:t.stream_uid,u,p.length]),s.useEffect(()=>{f.current&&(f.current.muted=w)},[w]),s.useEffect(()=>{if(!t)return;const e=!X.current;P(e);const r=setTimeout(()=>{f.current&&(f.current.muted=e)},100);return()=>clearTimeout(r)},[t==null?void 0:t.id]),s.useEffect(()=>{t&&(E.current=t.id)},[t==null?void 0:t.id]),s.useEffect(()=>{F&&f.current&&!f.current.paused&&f.current.pause()},[F]),s.useEffect(()=>{p.length===0&&z()},[]),s.useEffect(()=>{(async()=>{try{const e=C().join(","),r=await y(h.feed.progress(e),{requireAuth:!1}),i=Number(r.eligible||0),a=Number(r.viewed||0);W(i),U(a),A(i>0&&a>=i)}catch{}})()},[C]),s.useEffect(()=>{const e=()=>{S([]),q([]),M.current.clear(),E.current=null,T(-1),A(!1),(async()=>{try{const r=C().join(","),i=await y(h.feed.progress(r),{requireAuth:!1}),a=Number(i.eligible||0),o=Number(i.viewed||0);W(a),U(o),A(!1)}catch{}z()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[C,z]),s.useEffect(()=>{(async()=>{try{const e=await y(h.auth.me,{requireAuth:!1});Ge(e)}catch{}})()},[]),s.useEffect(()=>{const e=()=>{const r=document.querySelector(".top-nav");r&&Ke(r.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{if(!de.current||!t)return;const e=()=>{var i;const r=(i=de.current)==null?void 0:i.querySelector("div");r&&(r.style.width="auto",r.style.maxWidth="100%")};requestAnimationFrame(()=>{e(),setTimeout(e,100)})},[t]),s.useEffect(()=>{if(!te)return;const e=r=>{ue.current&&!ue.current.contains(r.target)&&Y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[te]),s.useEffect(()=>{if(!ne)return;const e=r=>{me.current&&!me.current.contains(r.target)&&re(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ne]),s.useEffect(()=>{if(!se)return;const e=r=>{pe.current&&!pe.current.contains(r.target)&&fe.current&&!fe.current.contains(r.target)&&$(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[se]);const Pe=!!(I!=null&&I.is_admin||I!=null&&I.is_mod);return n.jsxs(n.Fragment,{children:[n.jsx(yt,{paused:!1}),n.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          width: auto !important;
          max-width: 100% !important;
          height: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          /* Ensure it scales to fit both dimensions */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          width: auto !important;
          max-width: 100% !important;
          height: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        .video-area .discover-player-wrapper video {
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
      `}),n.jsxs("div",{ref:ze,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[H&&n.jsx("div",{className:"chip info",style:{position:"absolute",top:N+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),n.jsx("div",{className:"video-area",style:{position:"absolute",top:N,left:0,right:0,bottom:m?"50%":0,maxHeight:m?`calc(50dvh - ${N}px)`:`calc(100dvh - ${N}px)`,height:m?`calc(50dvh - ${N}px)`:`calc(100dvh - ${N}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:"16px",maxWidth:"100vw",width:"100%"},children:Xe?n.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[n.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),n.jsx("button",{className:"btn",onClick:()=>window.location.href=h.auth.login,children:"Login with osu!"})]}):t?n.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:n.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),n.jsxs("div",{onClick:st,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[n.jsx("div",{ref:de,className:"discover-player-wrapper",children:n.jsx(ft,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t.width&&t.height?t.width/t.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:w,controls:!1,onVideoRef:it})}),n.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:w?1:0,zIndex:2},children:w?n.jsx(ot,{size:20,color:"#fff"}):n.jsx(lt,{size:20,color:"#fff"})})]})]})}):H?null:n.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[n.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),n.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[n.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),n.jsx("div",{children:"• Click video to toggle mute/unmute"}),n.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!F&&n.jsxs("div",{style:{position:"absolute",right:m?12:16,top:"50%",display:"flex",flexDirection:"column",gap:m?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:m?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[n.jsx(ye,{to:`/profile/${(Fe=t.uploader)==null?void 0:Fe.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Oe=t.uploader)!=null&&Oe.avatar_url?n.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):n.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("button",{onClick:et,disabled:le,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?n.jsx(ct,{size:28}):n.jsx(dt,{size:28})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("button",{onClick:()=>ee(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(ut,{size:28})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{ref:fe,onClick:()=>$(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(Ye,{size:24})}),se&&n.jsxs("div",{ref:pe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>$(!1),children:[n.jsx(Ye,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&n.jsx("button",{className:"menu-item",onClick:Ze,children:"Preview"})]})]}),Pe?n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{onClick:()=>re(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx($e,{size:24})}),ne&&n.jsxs("div",{ref:me,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsx("button",{className:"menu-item",onClick:tt,children:t.is_starred?"Unstar post":"Star post"}),n.jsx("button",{className:"menu-item",onClick:Me,children:"Delete video"})]})]}):n.jsx("button",{onClick:()=>Y(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(mt,{size:24})}),te&&n.jsxs("div",{ref:ue,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),n.jsx("button",{className:"menu-item",onClick:()=>Le("unrelated"),children:"Unrelated"}),n.jsx("button",{className:"menu-item",onClick:()=>Le("explicit"),children:"Explicit"}),Pe&&n.jsx("button",{className:"menu-item",onClick:Me,children:"Delete video"})]})]}),t&&!F&&n.jsxs("div",{style:{position:"absolute",left:m?12:16,bottom:m?"55%":80,right:m?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:m?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:m?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[n.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:n.jsx(ye,{to:`/profile/${(Be=t.uploader)==null?void 0:Be.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:m?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var a,o,d;const e=(a=t.uploader)==null?void 0:a.is_admin,r=(o=t.uploader)==null?void 0:o.is_mod,i=e?"#fff3bf":r?"#d7fbe8":"#fff";return n.jsxs(n.Fragment,{children:[n.jsxs("span",{style:{color:i},children:["@",(d=t.uploader)==null?void 0:d.username]}),t.is_starred&&n.jsx(Ve,{size:m?14:16,color:"#f59e0b",title:"Starred"}),(e||r)&&n.jsx($e,{size:m?12:14,color:i,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&n.jsx("div",{style:{color:"#fff",fontSize:m?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&n.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:m?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),m&&t&&n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),n.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[n.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),n.jsx("button",{onClick:()=>ee(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:n.jsx(pt,{size:24})})]}),n.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Ae.length===0?n.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):n.jsx("div",{className:"col",style:{gap:0},children:Ae.map(e=>n.jsx(gt,{comment:e,replies:rt.get(e.id)||[],me:I,section:"mappi",onReply:r=>ae(r),onDelete:nt,replyingTo:J,replyText:L,onReplyTextChange:V,onReplySubmit:Ne,posting:oe,onCancelReply:()=>{ae(null),V("")}},e.id))})}),I&&!J&&n.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:n.jsxs("form",{onSubmit:Ne,style:{display:"flex",alignItems:"flex-end",gap:8},children:[n.jsx("textarea",{placeholder:"Write a comment...",value:L,onChange:e=>V(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const r=e.target;r.style.height="auto",r.style.height=`${Math.min(r.scrollHeight,120)}px`}}),n.jsx("button",{type:"submit",className:"btn compact",disabled:oe||!L.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:oe?"...":"Post"})]})})]})]}),t&&F&&t.beatmapset_id&&n.jsx(ht,{streamUID:null,playbackUrl:null,aspectRatio:16/9,onClose:()=>D(!1),beatmapDownloadUrl:`${vt}${h.osu.downloadBeatmapset(t.beatmapset_id)}`,beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{D(!1),window.location.hash="/editor"},headerLeft:n.jsxs(n.Fragment,{children:[((qe=t.uploader)==null?void 0:qe.avatar_url)&&n.jsx("img",{src:t.uploader.avatar_url,width:28,height:28,style:{borderRadius:"50%"}}),n.jsxs(ye,{to:`/profile/${(He=t.uploader)==null?void 0:He.id}`,style:{marginLeft:6,display:"inline-flex",alignItems:"center",gap:6,textDecoration:"none",color:"inherit",fontWeight:700},children:[n.jsx("span",{children:(We=t.uploader)==null?void 0:We.username}),t.is_starred?n.jsx(Ve,{size:14,color:"#f59e0b",title:"Starred"}):null]})]})})]})]})}export{Tt as default};
