var Dt=Object.defineProperty;var Pt=(t,o,r)=>o in t?Dt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r;var ut=(t,o,r)=>Pt(t,typeof o!="symbol"?o+"":o,r);import{r as s,j as e,e as we,u as Fe,R as U,q as Wt,d as Ht,T as qt,L as Y,U as $t,V as Ut,W as Bt,X as jt,Y as Ot,Z as mt,O as pt,K as Qt,A as wt,h as Nt,C as ht,P as Yt,Q as Vt,G as Jt,c as Je,I as Gt,l as kt,_ as Kt,$ as ft,z as Xt,v as Zt,b as es,a as ts,i as St,g as Ct,k as Ye,a0 as ss,a1 as xt,o as as,x as is,a2 as ns,a3 as rs,a4 as os,a5 as ls,a6 as J}from"./vendor-react-D9qJr8_Y.js";import{y as cs}from"./vendor-C5U2GP1d.js";import{u as _e,a as A,A as z,c as Ve,P as ds,b as je,d as us,C as ms,T as ps,e as hs}from"./mappi-routes-Drub60bt.js";import{u as Ne,a as _t,b as Te,c as fs,d as xs,e as gs,f as bs,g as ys,C as vs,M as js,h as ws,P as Ns,Q as ks,i as Ss,N as Cs}from"./moddi-routes-BJlOv88j.js";import{H as _s}from"./editor-components-ByPZokBD.js";import{B as Ts,E as Es}from"./editor-lib-CnQh_pvm.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-DLsULFER.js";import"./vendor-zip-DZqGqjoP.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))c(f);new MutationObserver(f=>{for(const d of f)if(d.type==="childList")for(const x of d.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function r(f){const d={};return f.integrity&&(d.integrity=f.integrity),f.referrerPolicy&&(d.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?d.credentials="include":f.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(f){if(f.ep)return;f.ep=!0;const d=r(f);fetch(f.href,d)}})();const Ms=new cs({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class zs extends s.Component{constructor(r){super(r);ut(this,"handleRetry",()=>{const r=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),r&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,c){console.error("ErrorBoundary caught an error:",r,c)}isChunkLoadingError(r){if(!r)return!1;const c=r.message.toLowerCase();return c.includes("loading chunk")||c.includes("failed to load")||c.includes("chunk load failed")||c.includes("loading css chunk")||r.name==="ChunkLoadError"}render(){var r;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const c=this.isChunkLoadingError(this.state.error),f=((r=this.state.error)==null?void 0:r.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:c?"Failed to load page. This might be a network issue.":f}),c&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:c?"Reload Page":"Try Again"}),!c&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const pe=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Is({i:t}){const o=t*1337,r=(M,p)=>{const b=Math.sin(o+M+p)*1e4,S=b-Math.floor(b);return Math.floor(S*(p-M+1)+M)},c=r(0,100),f=r(24,50),d=.7+r(0,100)/100*.3,x=f*d,N=r(0,4e3),v=r(-10,10),C=r(-8,8),g=r(0,100),w=g<60?1:g<80?1.5:2,I=[{size:200*w,alpha:.06,dx:-22,dy:12,color:pe[r(0,pe.length-1)]},{size:150*w,alpha:.08,dx:-9,dy:7,color:pe[r(0,pe.length-1)]},{size:120*w,alpha:.1,dx:0,dy:0,color:pe[r(0,pe.length-1)]},{size:90*w,alpha:.12,dx:12,dy:-4,color:pe[r(0,pe.length-1)]},{size:64*w,alpha:.13,dx:20,dy:-7,color:pe[r(0,pe.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${c}vw`,animationDuration:`${x}s`,animationDelay:`${N}ms`,"--tx":`${v}vw`,transform:`rotate(${C}deg)`},children:I.map((M,p)=>e.jsx("svg",{width:M.size,height:M.size,viewBox:"0 0 100 100",style:{left:`${50+M.dx}%`,bottom:`${M.dy}px`,transform:"translateX(-50%)","--alpha":M.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:M.color})},p))})}function Tt({paused:t=!1}){const o=s.useMemo(()=>new Array(20).fill(0).map((r,c)=>c),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:o.map(r=>e.jsx(Is,{i:r},r))})}function Rs(){const t=we(),o=Fe(),{lastSection:r,previousLocation:c,setPreviousLocation:f}=Ne(),d=U.useRef(null),x=U.useRef(!1),N=U.useRef(0),v=U.useRef(0),C=U.useRef(null),g=U.useRef(null),w=U.useRef(!1),I=300,M=2e3,p=U.useRef(null),b=U.useRef(null),S=U.useRef(null),[u,_]=U.useState(!1),[F,j]=U.useState(12),W=U.useCallback(()=>{if(!b.current)return;const l=b.current.getBoundingClientRect(),T=window.innerWidth||document.documentElement.clientWidth||320,E=160;let B=l.left;B+E+8>T&&(B=Math.max(8,T-E-8)),B=Math.max(8,B),j(B)},[]);U.useEffect(()=>()=>{d.current&&clearTimeout(d.current),C.current&&clearTimeout(C.current),g.current&&clearTimeout(g.current)},[]),U.useEffect(()=>{if(!u)return;const l=T=>{const E=T.target;S.current&&!S.current.contains(E)&&b.current&&!b.current.contains(E)&&_(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[u]),U.useEffect(()=>{if(!u)return;W();const l=()=>W();return window.addEventListener("resize",l),window.addEventListener("orientationchange",l),()=>{window.removeEventListener("resize",l),window.removeEventListener("orientationchange",l)}},[u,W]);const D=t.pathname==="/"||t.pathname==="/about",m=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!D&&t.pathname.startsWith("/md/");const P=t.pathname.startsWith("/md/")||!D&&!t.pathname.startsWith("/mp/")&&r==="moddi",$=_t();if(D)return null;const V=()=>{o(c||(r==="moddi"?"/md/feed":"/mp/feed"))},ae=()=>{_(l=>!l)},q=()=>{var l;_(!1),(l=p.current)==null||l.click()};if(m)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:p,type:"file",accept:".osz,.zip",onChange:l=>{var E;const T=(E=l.target.files)==null?void 0:E[0];T&&window.dispatchEvent(new CustomEvent("editor:file",{detail:T}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:V,"aria-label":"Back",title:"Go back",children:e.jsx(Wt,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:b,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ae,"aria-label":"File",title:"File menu","aria-expanded":u,children:e.jsx(qt,{size:20})}),u&&Ht.createPortal(e.jsx("div",{ref:S,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${F}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:q,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:V,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsx("div",{className:"mobile-bottom-nav-right"})]})]});const X=()=>{const l=Date.now();if(N.current>0){const T=l-N.current;if(T<I&&T>0){C.current&&(clearTimeout(C.current),C.current=null),g.current&&(clearTimeout(g.current),g.current=null),d.current&&(clearTimeout(d.current),d.current=null),v.current=l+M,N.current=0,x.current=!1,f(t.pathname),o("/editor");return}}l<v.current&&N.current===0||(C.current&&(clearTimeout(C.current),C.current=null),g.current&&(clearTimeout(g.current),g.current=null),N.current=l,g.current=setTimeout(()=>{g.current!==null&&(o(P?"/mp/feed":"/md/feed"),g.current=null)},I),C.current=setTimeout(()=>{N.current>0&&(N.current=0,v.current=Date.now()+M),C.current=null},I))},ie=()=>{x.current=!1,d.current=setTimeout(()=>{x.current=!0,o("/")},500)},H=()=>{d.current&&(clearTimeout(d.current),d.current=null),x.current&&setTimeout(()=>{x.current=!1},100)},ee=l=>{if(w.current){l.preventDefault(),l.stopPropagation(),w.current=!1;return}if(x.current){l.preventDefault(),l.stopPropagation();return}X()},se=l=>{if(H(),x.current){l.preventDefault(),w.current=!0;return}l.preventDefault(),X(),w.current=!0,setTimeout(()=>{w.current=!1},I+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(Y,{to:P?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx($t,{size:20})}),P?e.jsx(Y,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Ut,{size:20})}):e.jsx(Y,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Bt,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:ee,onTouchStart:ie,onTouchEnd:se,onMouseDown:ie,onMouseUp:H,onMouseLeave:H,"aria-label":P?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:P?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:P?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(Y,{to:"/md/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/md/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative"},children:[e.jsx(jt,{size:20}),$>0&&e.jsx("span",{style:{position:"absolute",top:8,right:8,width:8,height:8,background:"#f87171",borderRadius:9999}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>o("/settings"),"aria-label":"Settings",children:e.jsx(Ot,{size:20})})]})]})}function Ls({isModdi:t,onClick:o}){return e.jsxs("button",{onClick:o,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:t?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:t?"osu!mappi.ng":"osu!moddi.ng"})]})}function As({isNeutralPage:t,isEditor:o,isModdi:r,isMappi:c,onCoinFlipClick:f}){return t?e.jsx(Y,{to:"/",className:"title",children:r?"osu!moddi.ng":c?"osu!mappi.ng":"mappi!"}):o?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Y,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(mt,{size:18})}),e.jsx(Y,{to:r?"/md/feed":"/mp/feed",className:"title",children:"osu!editi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Y,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(mt,{size:18})}),e.jsx(Ls,{isModdi:r,onClick:f})]})}function Fs({isNeutralPage:t,isMappi:o,isModdi:r}){const c=we();return e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[t&&e.jsx(Y,{to:c.pathname==="/"?"/about":"/",className:c.pathname==="/about"?"active":"",children:c.pathname==="/"?"About":"Home"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{to:"/mp/feed",className:c.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(Y,{to:"/mp/discover",className:c.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(Y,{to:"/editor",className:c.pathname==="/editor"?"active":"",children:"Editor"})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{to:"/md/feed",className:c.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(Y,{to:"/md/queues",className:c.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!o&&!r&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{to:"/mp/feed",className:c.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(Y,{to:"/mp/discover",className:c.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(Y,{to:"/editor",className:c.pathname==="/editor"?"active":"",children:"Editor"})]})]})}function Et(t,o,r,c){s.useEffect(()=>{if(!r)return;const f=d=>{const x=d.target;o.current&&!o.current.contains(x)&&t.current&&!t.current.contains(x)&&c()};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[r,c,t,o])}function Ds(t,o,r,c){const f=Fe(),{notify:d}=_e(),[x,N]=s.useState(new Set);return{parseQueueInvite:p=>{if(!p)return null;try{const b=JSON.parse(p);if((b==null?void 0:b.type)==="queue_invite"&&(b!=null&&b.queue_id))return b}catch{}return null},handleAcceptInvite:async(p,b)=>{if(!x.has(p.id)){N(S=>new Set(S).add(p.id));try{await A(z.moddi.queueAccept(String(b)),{method:"POST"}),d("Invitation accepted!",{variant:"success"}),r.mutate(p.id),c(!1),f(`/md/queues/${b}`)}catch(S){d((S==null?void 0:S.message)||"Failed to accept invitation",{variant:"error"})}finally{N(S=>{const u=new Set(S);return u.delete(p.id),u})}}},handleDenyInvite:async(p,b)=>{if(!x.has(p.id)){N(S=>new Set(S).add(p.id));try{await A(z.moddi.queueDeny(String(b)),{method:"POST"}),d("Invitation declined",{variant:"success"}),r.mutate(p.id)}catch(S){d((S==null?void 0:S.message)||"Failed to decline invitation",{variant:"error"})}finally{N(S=>{const u=new Set(S);return u.delete(p.id),u})}}},handleMarkAllRead:async()=>{const p=t.filter(b=>b.id.startsWith("n:")||b.kind==="system"&&!b.read).map(b=>b.id);p.length>0&&o.mutate(p)},handleNotificationClick:async p=>{if(c(!1),o.mutate([p.id]),p.kind==="system"||p.id.startsWith("n:"))try{await A(z.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[p.id]})})}catch{}},handleDeleteNotification:async(p,b)=>{p.stopPropagation(),r.mutate(b)},processing:x}}function Ps({notifications:t,unreadCount:o,notifOpen:r,setNotifOpen:c,markReadMutation:f,deleteNotificationMutation:d,closeAllPanels:x}){const N=s.useRef(null),v=s.useRef(null),{parseQueueInvite:C,handleAcceptInvite:g,handleDenyInvite:w,handleMarkAllRead:I,handleNotificationClick:M,handleDeleteNotification:p,processing:b}=Ds(t,f,d,c);Et(N,v,r,()=>c(!1));const S=t.filter(u=>!(u.kind==="system"&&u.id.startsWith("b:")&&(u.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:N,className:"icon-link",onClick:()=>{r||x(),c(!r)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(jt,{size:18})}),o>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),r&&e.jsxs("div",{ref:v,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(Y,{to:"/md/notifications",onClick:()=>c(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:u=>u.currentTarget.style.opacity="1",onMouseLeave:u=>u.currentTarget.style.opacity="0.7",children:"View all"}),S.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:I,children:e.jsx(pt,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[S.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),S.map(u=>{const _=C(u.text),F=u.id.startsWith("b:"),j=_?"queue-invite":u.kind==="star"?"star":u.kind==="likes5"?"likes":u.kind==="comment"?"comment":u.kind==="inspiration"?"inspiration":u.kind==="reaction"?"reaction":F?"global":"system",W=u.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${j}`,role:"button",onClick:()=>!_&&M(u),children:[e.jsxs("div",{className:`notif-icon ${W?"deletable":""}`,"aria-hidden":"true",onClick:W&&!_?D=>p(D,u.id):void 0,title:W&&!_?"Remove":void 0,role:W&&!_?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:_?e.jsx(Qt,{}):j==="star"?e.jsx(wt,{}):j==="likes"?e.jsx(Nt,{}):j==="comment"?e.jsx(ht,{}):j==="inspiration"?e.jsx(ht,{}):j==="reaction"?e.jsx(Yt,{}):j==="global"?e.jsx(Vt,{}):null}),W&&!_?e.jsx("span",{className:"swap-trash",children:e.jsx(Jt,{})}):null]}),e.jsx("div",{className:"notif-body",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[_.inviter_username," invited you to join queue: ",_.queue_name]}),b.has(u.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:D=>{D.stopPropagation(),g(u,_.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(pt,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:D=>{D.stopPropagation(),w(u,_.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Je,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):u.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:F?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:u.text||""}),F&&u.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(u.expiresAt).toLocaleString()]}):null]}):u.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone commented on your post"})]}):u.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone is inspired by you!"})]}):u.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:u.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:u.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:u.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},u.id)})]})]})]})}function Ws({quota:t,nowTick:o}){if(!(t!=null&&t.blocked))return null;const r=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),c=Math.floor(r/3600),f=Math.floor(r%3600/60),d=r%60,x=v=>String(v).padStart(2,"0"),N=c>0?`${c}:${x(f)}:${x(d)}`:`${f}:${x(d)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(Gt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:N})]})}function Hs({me:t,menuOpen:o,setMenuOpen:r,onLogout:c,closeAllPanels:f}){const d=s.useRef(null),x=s.useRef(null);return Et(d,x,o,()=>r(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:d,className:"icon-link",onClick:()=>{o||f(),r(!o)},title:t.username,"aria-label":"User menu","aria-expanded":o,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(kt,{size:14,style:{opacity:.8}})]}),o&&e.jsxs("div",{ref:x,className:"menu-panel",role:"menu",children:[e.jsx(Y,{to:"/profile",className:"menu-item",onClick:()=>r(!1),children:"Profile"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(Y,{to:"/moderation",className:"menu-item",onClick:()=>r(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:c,children:"Log out"})]})]})}function qs({isNeutralPage:t,isEditor:o,isMappi:r,isModdi:c,onCoinFlipClick:f}){const d=we(),{data:x,isLoading:N}=Te(),{data:v}=fs(!!x),{data:C=[]}=xs(!!x),g=_t(),w=gs(),I=bs(),M=ys(),{menuOpen:p,notifOpen:b,setMenuOpen:S,setNotifOpen:u,closeAllPanels:_}=Ne(),[F,j]=U.useState(0);return U.useEffect(()=>{const W=setInterval(()=>j(D=>D+1),1e3);return()=>clearInterval(W)},[]),e.jsxs("header",{className:"top-nav",children:[e.jsx(As,{isNeutralPage:t,isEditor:o,isModdi:c,isMappi:r,onCoinFlipClick:f}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),d.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(_s,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Fs,{isNeutralPage:t,isMappi:r,isModdi:c}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Kt,{size:18})}),x?e.jsxs("div",{className:"user-menu",children:[e.jsx(Ps,{notifications:C,unreadCount:g,notifOpen:b,setNotifOpen:u,markReadMutation:I,deleteNotificationMutation:M,closeAllPanels:_}),e.jsx(Ws,{quota:v,nowTick:F}),e.jsx(Hs,{me:x,menuOpen:p,setMenuOpen:S,onLogout:()=>w.mutate(),closeAllPanels:_})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Ve+z.auth.login},disabled:N,children:N?"Checkingâ€¦":"Login with osu!"})]})]})}function $s({title:t,onRefresh:o}){const{data:r}=Te(),[c,f]=U.useState(!0),[d,x]=U.useState(0),[N,v]=U.useState(!1),C=U.useRef(!1),g=U.useRef(0);return U.useEffect(()=>{const w=document.querySelector(".page");if(!w)return;let I=w.scrollTop,M=!1;const p=()=>{M||(M=!0,requestAnimationFrame(()=>{const b=w.scrollTop,S=b-I;b<=12||S<-12?f(!0):S>12&&f(!1),I=b,M=!1}))};return w.addEventListener("scroll",p,{passive:!0}),()=>w.removeEventListener("scroll",p)},[]),U.useEffect(()=>{const w=document.querySelector(".page");if(!w)return;const I=120,M=70,p=_=>{var F;N||(w.scrollTop<=0?(C.current=!0,g.current=((F=_.touches[0])==null?void 0:F.clientY)??0):C.current=!1)},b=_=>{var W;if(!C.current||N)return;const F=((W=_.touches[0])==null?void 0:W.clientY)??0,j=Math.max(0,F-g.current);if(j>0){const D=Math.min(I,j*.5);x(D)}},S=async()=>{try{if(v(!0),o)await o();else{window.location.reload();return}}finally{setTimeout(()=>{v(!1),x(0)},400)}},u=()=>{!C.current||N||(d>=M?S():x(0),C.current=!1)};return w.addEventListener("touchstart",p,{passive:!0}),w.addEventListener("touchmove",b,{passive:!0}),w.addEventListener("touchend",u),w.addEventListener("touchcancel",u),()=>{w.removeEventListener("touchstart",p),w.removeEventListener("touchmove",b),w.removeEventListener("touchend",u),w.removeEventListener("touchcancel",u)}},[d,N,o]),e.jsxs("div",{className:"mobile-page-header",children:[e.jsxs("div",{className:`mobile-page-header-inner ${c?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:e.jsx(Y,{to:"/profile",className:"icon-link","aria-label":"Profile",children:r!=null&&r.avatar_url?e.jsx("img",{src:r.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"rgba(255,255,255,0.2)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:N||d>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(d,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${N?"spin":d>60?"ready":""}`})})]})}function Us({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function Bs(){const t=we(),{lastSection:o}=Ne(),r=t.pathname==="/"||t.pathname==="/about",c=t.pathname==="/editor",f=t.pathname.startsWith("/mp/")||!r&&!t.pathname.startsWith("/md/")&&o==="mappi",d=t.pathname.startsWith("/md/")||!r&&!t.pathname.startsWith("/mp/")&&o==="moddi",x=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";return{isNeutralPage:r,isEditor:c,isMappi:f,isModdi:d,isQueueDetail:x}}function Os(t){const o=Fe(),r=we(),{setPreviousLocation:c}=Ne(),f=s.useRef(0),d=s.useRef(0),x=s.useRef(null),N=500,v=2e3;return s.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]),g=>{g.preventDefault();const w=Date.now();if(!(w<d.current)){if(x.current&&f.current>0){const I=w-f.current;if(I<N&&I>0){clearTimeout(x.current),x.current=null,d.current=w+v,f.current=0,c(r.pathname),o("/editor");return}}x.current&&(clearTimeout(x.current),x.current=null),f.current=w,x.current=setTimeout(()=>{d.current=Date.now()+v,x.current=null,f.current=0,o(t?"/mp/feed":"/md/feed")},N)}}}function Qs(){const t=we(),{notify:o}=_e(),{data:r}=Te(),{lastSection:c,setLastSection:f}=Ne(),{isNeutralPage:d,isEditor:x,isMappi:N,isModdi:v}=Bs(),C=Os(v);U.useEffect(()=>{t.pathname.startsWith("/mp/")?f("mappi"):t.pathname.startsWith("/md/")&&f("moddi")},[t.pathname,f]);const[g,w]=U.useState(null);U.useEffect(()=>{!r||!r.is_mod||(async()=>{try{const p=await A(z.admin.debugState,{requireAuth:!1}),b=Array.isArray(p==null?void 0:p.counts)?p.counts.find(S=>String(S.status)==="ready"):null;b&&w(Number(b.c)||0)}catch{}})()},[r]),U.useEffect(()=>{r&&!localStorage.getItem("welcomed")&&(o(`Welcome, ${r.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[r,o]);const{showMobileHeader:I,headerTitle:M}=U.useMemo(()=>{const p=t.pathname;if(p==="/"||p==="/about"||p==="/editor"||p==="/mp/discover"||p.startsWith("/profile"))return{showMobileHeader:!1,headerTitle:""};const b=p.split("/").filter(Boolean),S=b[0]||"",u=b[1]||"";if(p==="/feed")return{showMobileHeader:!0,headerTitle:"Discover"};if(p==="/upload"||p==="/posts"||p==="/recents"||p==="/recent")return{showMobileHeader:!0,headerTitle:"Feed"};if(S==="mp"){if(u==="discover")return{showMobileHeader:!0,headerTitle:"Discover"};if(u==="feed")return{showMobileHeader:!0,headerTitle:b.length>2?"Post":"Feed"}}if(S==="md"){if(u==="feed")return{showMobileHeader:!0,headerTitle:b.length>2?"Post":"Feed"};if(u==="queues")return{showMobileHeader:!0,headerTitle:b.length>2?"Queue":"Queues"};if(u==="notifications")return{showMobileHeader:!0,headerTitle:"Notifications"}}return p==="/settings"?{showMobileHeader:!0,headerTitle:"Settings"}:p==="/moderation"?{showMobileHeader:!0,headerTitle:"Moderation"}:{showMobileHeader:!0,headerTitle:""}},[t.pathname]);return e.jsxs("div",{className:"app-shell","data-section":v?"moddi":N?"mappi":c==="moddi"?"moddi":c==="mappi"?"mappi":void 0,children:[e.jsx(Tt,{paused:t.pathname==="/editor"}),e.jsx(qs,{isNeutralPage:d,isEditor:x,isMappi:N,isModdi:v,onCoinFlipClick:C}),e.jsxs("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:[I&&e.jsx($s,{title:M}),t.pathname==="/about"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(ft,{})}):e.jsx(ft,{})]}),t.pathname!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(Us,{readyCount:g})}),e.jsx(Rs,{})]})}function Ys(){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions",children:[e.jsx(Y,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(Y,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function Vs(){const{data:t}=Te(),{modeFilters:o}=Ne(),r=Object.entries(o).filter(([f,d])=>d).map(([f])=>f),c=r.length?r.join(","):"standard";return Xt({queryKey:["mappi","feed",c],queryFn:async({pageParam:f=0})=>{const d=new URLSearchParams({limit:"20",offset:String(f),modes:c}),x=`${z.feed.recent}?${d.toString()}`;return await A(x)},enabled:!!t,initialPageParam:0,getNextPageParam:(f,d)=>{var v;const x=d.reduce((C,g)=>{var w;return C+(((w=g.items)==null?void 0:w.length)||0)},0);return(((v=f.items)==null?void 0:v.length)||0)===20?x:void 0}})}function Ce(){const t=we(),o=Zt(),{data:r}=Te(),{modeFilters:c}=Ne(),{data:f,fetchNextPage:d,hasNextPage:x,isFetching:N,isFetchingNextPage:v,refetch:C}=Vs(),g=s.useMemo(()=>(f==null?void 0:f.pages.flatMap(u=>u.items||[]))||[],[f]),w=s.useMemo(()=>{const u=Object.entries(c).filter(([F,j])=>j).map(([F])=>F.toLowerCase()),_=new Set(u.length?u:["standard"]);return g.filter(F=>{const j=String(F.mode||"standard").toLowerCase();return _.has(j)})},[g,c]);s.useEffect(()=>{t.pathname==="/mp/feed"&&C()},[t.pathname,C]),s.useEffect(()=>{const u=()=>{C()};return window.addEventListener("filterchange",u),()=>window.removeEventListener("filterchange",u)},[C]);const I=u=>{o.setQueryData(["mappi","feed"],_=>_&&{..._,pages:_.pages.map(F=>({...F,items:F.items.map(j=>j.id===u.id?u:j)}))})},M=u=>{o.setQueryData(["mappi","feed"],_=>_&&{..._,pages:_.pages.map(F=>({...F,items:F.items.filter(j=>j.id!==u)}))})},p=()=>{C()},b=N&&!v,S=x??!1;return e.jsxs("div",{className:"feed-container mappi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(vs,{section:"mappi",onUpload:p})]}),e.jsx(js,{section:"mappi",onUpload:p}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[w.length===0&&!b&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),w.map(u=>e.jsx(ds,{post:u,section:"mappi",onUpdate:I,onDelete:M,me:r},u.id)),w.length>0&&S&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>d(),disabled:v,children:v?"Loading...":"Load more"})})]})})]})}const ce={};function Js(){try{const t=localStorage.getItem("feed_seen_ids");if(t){const o=JSON.parse(t);Array.isArray(o)&&(ce.seenIds=o.filter(r=>typeof r=="number"))}}catch{}return ce}function gt(t){Object.assign(ce,t);try{const o=Array.from(new Set(ce.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(o))}catch{}}function bt(){var lt,ct,dt;const{notify:t}=_e(),[o,r]=s.useState(ce.history||[]),[c,f]=s.useState(ce.index??-1),[d,x]=s.useState(ce.queue||[]),[N,v]=s.useState(!1),[C,g]=s.useState(!1),[w,I]=s.useState(ce.eligibleCount??null),[M,p]=s.useState(ce.viewedCount??0),[b,S]=s.useState(!1),[u,_]=s.useState(!0),[F,j]=s.useState(!1),[W,D]=s.useState(!1),[m,P]=s.useState(!1),[$,V]=s.useState(!1),[ae,q]=s.useState(!1),[X,ie]=s.useState([]),[H,ee]=s.useState(""),[se,l]=s.useState(null),[T,E]=s.useState(!1),[B,be]=s.useState(null),[ke,a]=s.useState(!1),L=s.useRef(new Set(ce.seenIds||[])),ne=s.useRef(new Set),te=s.useRef(!1),oe=s.useRef(ce.lastShownVideoId??null),Ee=s.useRef(!1),Se=s.useRef(0),Ge=s.useRef(0),Ke=s.useRef(0),G=s.useRef(null),Xe=s.useRef(null),Me=s.useRef(null),De=s.useRef(null),Pe=s.useRef(null),We=s.useRef(null),He=s.useRef(null),qe=s.useRef(null),ze=s.useRef(0),Ze=s.useRef(0),Ie=s.useRef(null),Re=s.useRef(null),[Le,Mt]=s.useState(0),n=s.useMemo(()=>c>=0?o[c]:null,[o,c]);s.useEffect(()=>{Js()},[]),s.useEffect(()=>{gt({history:o,index:c,queue:d,seenIds:Array.from(L.current),eligibleCount:w??void 0,viewedCount:M,lastShownVideoId:oe.current??void 0})},[o,c,d,w,M]);const fe=s.useCallback(()=>{try{const i=localStorage.getItem("filter_modes"),h=(i?String(i):"standard").toLowerCase().split(",").map(R=>R.trim()).filter(Boolean),y=["standard","taiko","mania","catch"],k=Array.from(new Set(h.filter(R=>y.includes(R))));return k.length?k:["standard"]}catch{return["standard"]}},[]),et=s.useCallback(()=>{const i=new Set;return oe.current!==null&&i.add(oe.current),Array.from(L.current).slice(-200).forEach(y=>i.add(y)),d.forEach(y=>i.add(y.id)),Array.from(i)},[d]),$e=s.useCallback(async(i=3)=>{var k,R,O,ue;if(te.current)return[];const h=Date.now();if(h<Se.current){const Z=Math.ceil((Se.current-h)/1e3);return t(`Rate limited. Please wait ${Z}s.`,{durationMs:3e3,variant:"warn"}),[]}const y=h-Ke.current;if(y<2e3){const Z=2e3-y;await new Promise(ve=>setTimeout(ve,Z))}te.current=!0,Ke.current=Date.now();try{const Z=et(),ve=fe().join(","),me=[],xe=new Set(d.map(re=>re.id));let ge=[...Z];const Oe=Math.min(i,3);for(let re=0;re<Oe;re++){if(re>0){const Q=Date.now()-Ge.current,K=1e3;Q<K&&await new Promise(le=>setTimeout(le,K-Q))}try{Ge.current=Date.now();const Q=await A(z.feed.next+je({exclude:ge.join(","),modes:ve}),{requireAuth:!1}),K=Q&&("id"in Q?Q:Q.video)||null;if(!K)break;if(L.current.has(K.id)||xe.has(K.id)||K.id===oe.current){ge.push(K.id);continue}me.push(K),ge.push(K.id),xe.add(K.id)}catch(Q){if((k=Q==null?void 0:Q.message)!=null&&k.includes("401")||(R=Q==null?void 0:Q.message)!=null&&R.includes("Unauthorized")){S(!0);break}else if((O=Q==null?void 0:Q.message)!=null&&O.includes("429")||(ue=Q==null?void 0:Q.message)!=null&&ue.includes("rate limit")){Se.current=Date.now()+5e3,t("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(me.length>0&&x(re=>{const Q=new Set(re.map(le=>le.id)),K=me.filter(le=>!Q.has(le.id));return[...re,...K]}),me.length===0&&d.length===0)try{const re=fe().join(","),Q=await A(z.feed.progress(re),{requireAuth:!1});I(Number(Q.eligible||0)),p(Number(Q.viewed||0)),g(Number(Q.caught_up||0)===1)}catch{}return me}catch{return[]}finally{te.current=!1}},[et,fe,d,t]),de=s.useCallback(async()=>{if(!N){v(!0);try{d.length<=2&&$e(3).catch(()=>{});let i;if(d.length>0)i=d[0],x(h=>h.filter(y=>y.id!==i.id));else{const h=await $e(3);h.length>0&&(i=h[0],h.length>1&&x(y=>{const k=new Set(y.map(O=>O.id)),R=h.slice(1).filter(O=>!k.has(O.id));return[...y,...R]}))}if(i)oe.current=i.id,L.current.add(i.id),gt({seenIds:Array.from(L.current)}),r(h=>{const y=[...h.slice(0,c+1),i];return f(y.length-1),y}),ne.current.has(i.id)||(ne.current.add(i.id),A(z.videos.view(i.id),{method:"POST"}).then(h=>{h&&r(y=>{const k=[...y],R=k.findIndex(O=>O.id===i.id);return R!==-1&&(k[R]={...k[R],views_count:h.views_count??k[R].views_count??0,viewed_by_me:!0}),k})}).catch(()=>{}));else try{const h=fe().join(","),y=await A(z.feed.progress(h),{requireAuth:!1});I(Number(y.eligible||0)),p(Number(y.viewed||0)),g(Number(y.eligible||0)>0&&Number(y.viewed||0)>=Number(y.eligible||0))}catch{}}finally{v(!1)}}},[N,d,$e,c,fe]),zt=s.useCallback(()=>{G.current&&!G.current.paused&&G.current.pause(),j(!0),q(!1)},[]),Ue=s.useCallback(()=>{c>0&&(f(c-1),j(!1))},[c]),Be=s.useCallback(()=>{const i=Date.now();if(!(i-Ze.current<300)){if(Ze.current=i,u||(Ee.current=!0,_(!1)),c<o.length-1){const h=o[c+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:c,nextIndex:c+1,currentVideoId:n==null?void 0:n.id,nextVideoId:h==null?void 0:h.id,nextVideoStreamUID:h==null?void 0:h.stream_uid}),h&&(oe.current=h.id),f(c+1),j(!1);return}if(!C){if(Date.now()<Se.current){const h=Math.ceil((Se.current-Date.now())/1e3);t(`Rate limited. Please wait ${h}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),de()}}},[c,o,u,C,de,t,n]);s.useEffect(()=>{const i=Xe.current;if(!i)return;const h=R=>{if(b||Math.abs(R.deltaY)<Math.abs(R.deltaX))return;R.preventDefault(),R.stopPropagation();const O=Date.now();if(!(O<ze.current)){if(ze.current=O+1e3,!n){R.deltaY>0&&!N&&de();return}R.deltaY>0?Be():Ue()}},y=R=>{Ie.current=R.touches[0].clientY,Re.current=Date.now()},k=R=>{if(b||Ie.current===null||Re.current===null)return;const O=R.changedTouches[0].clientY,ue=Date.now(),Z=Ie.current-O,ve=ue-Re.current;if(Ie.current=null,Re.current=null,Math.abs(Z)<50||ve>300)return;const me=Date.now();if(!(me<ze.current)){if(ze.current=me+1e3,!n){Z>0&&!N&&de();return}Z>0?Be():Ue()}};return i.addEventListener("wheel",h,{passive:!1,capture:!0}),i.addEventListener("touchstart",y,{passive:!0}),i.addEventListener("touchend",k,{passive:!0}),window.addEventListener("wheel",h,{passive:!1,capture:!0}),()=>{i.removeEventListener("wheel",h,{capture:!0}),i.removeEventListener("touchstart",y),i.removeEventListener("touchend",k),window.removeEventListener("wheel",h,{capture:!0})}},[Be,Ue,n,N,de,b]);const It=s.useCallback(async()=>{var i,h;if(!(!n||ke)){a(!0);try{const y=n.liked_by_me?"DELETE":"POST",k=await A(z.videos.like(n.id),{method:y});r(R=>{const O=[...R],ue=O.findIndex(Z=>Z.id===n.id);return ue!==-1&&(O[ue]={...O[ue],liked_by_me:!n.liked_by_me,likes_count:k.likes_count}),O})}catch(y){((i=y==null?void 0:y.message)!=null&&i.includes("429")||(h=y==null?void 0:y.message)!=null&&h.includes("rate limit"))&&t("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{a(!1)}}},[n,ke,t]),tt=s.useCallback(async i=>{if(n)try{await A(z.videos.flag(n.id),{method:"POST",body:JSON.stringify({reason:i})}),t("Thanks for your report.",{variant:"info"})}catch{t("Report failed",{variant:"error"})}finally{P(!1)}},[n,t]),Rt=s.useCallback(async()=>{if(!n)return;const i=!n.is_starred,h=i?"star":"unstar";try{await A(z.admin.videosAction(n.id,h),{method:"POST"}),r(y=>{const k=[...y],R=k.findIndex(O=>O.id===n.id);return R!==-1&&(k[R]={...k[R],is_starred:i}),k}),V(!1),t(i?"Post starred":"Star removed",{variant:"success"})}catch{t("Action failed",{variant:"error"})}},[n,t]),st=s.useCallback(async()=>{if(!(!n||!confirm("Permanently delete this video?")))try{await A(z.videos.delete(n.id),{method:"DELETE"}),t("Deleted",{variant:"warn"}),P(!1),r(i=>{const h=i.filter((y,k)=>k!==c);return h.length===0?(f(-1),setTimeout(de,0)):f(y=>Math.max(0,Math.min(y,h.length-1))),h})}catch{alert("Delete failed")}},[n,c,de,t]),Ae=s.useCallback(async()=>{if(n!=null&&n.id)try{const i=await A(z.videos.comments(n.id),{requireAuth:!1});ie(i.items||[])}catch{}},[n==null?void 0:n.id]);s.useEffect(()=>{W&&(n!=null&&n.id)&&Ae()},[W,n==null?void 0:n.id,Ae]);const at=s.useCallback(async i=>{if(i.preventDefault(),!(!H.trim()||!(n!=null&&n.id))){E(!0);try{await A(z.videos.comments(n.id),{method:"POST",body:JSON.stringify({text:H.trim(),parent_id:se||void 0})}),ee(""),l(null),Ae(),r(h=>{const y=[...h],k=y.findIndex(R=>R.id===n.id);return k!==-1&&(y[k]={...y[k],comments_count:(y[k].comments_count||0)+1}),y}),t("Comment posted!",{variant:"success"})}catch(h){t((h==null?void 0:h.message)||"Failed to post comment",{variant:"error"})}finally{E(!1)}}},[H,n,se,Ae,t]),Lt=s.useCallback(i=>{ie(h=>h.filter(y=>y.id!==i)),r(h=>{const y=[...h],k=y.findIndex(R=>R.id===(n==null?void 0:n.id));return k!==-1&&(y[k]={...y[k],comments_count:Math.max(0,(y[k].comments_count||0)-1)}),y})},[n==null?void 0:n.id]),{topLevelComments:it,repliesMap:nt}=s.useMemo(()=>{const i=X.filter(y=>!y.parent_id),h=new Map;return X.filter(y=>y.parent_id).forEach(y=>{const k=y.parent_id;h.has(k)||h.set(k,[]),h.get(k).push(y)}),{topLevelComments:i,repliesMap:h}},[X]),At=s.useCallback(()=>{if(!G.current)return;const i=!u;_(i),G.current.muted=i,i||(Ee.current=!0),!i&&G.current.paused&&G.current.play().catch(()=>{})},[u]),Ft=s.useCallback(i=>{G.current=i,i&&(i.muted=u)},[u]);s.useEffect(()=>{j(!1),D(!1),Ee.current?_(!1):_(!0)},[n==null?void 0:n.id,n==null?void 0:n.stream_uid,c,o.length]),s.useEffect(()=>{G.current&&(G.current.muted=u)},[u]),s.useEffect(()=>{if(!n)return;const i=!Ee.current;_(i);const h=setTimeout(()=>{G.current&&(G.current.muted=i)},100);return()=>clearTimeout(h)},[n==null?void 0:n.id]),s.useEffect(()=>{n&&(oe.current=n.id)},[n==null?void 0:n.id]),s.useEffect(()=>{F&&G.current&&!G.current.paused&&G.current.pause()},[F]),s.useEffect(()=>{o.length===0&&de()},[]),s.useEffect(()=>{(async()=>{try{const i=fe().join(","),h=await A(z.feed.progress(i),{requireAuth:!1}),y=Number(h.eligible||0),k=Number(h.viewed||0);I(y),p(k),g(y>0&&k>=y)}catch{}})()},[fe]),s.useEffect(()=>{const i=()=>{r([]),x([]),L.current.clear(),oe.current=null,f(-1),g(!1),(async()=>{try{const h=fe().join(","),y=await A(z.feed.progress(h),{requireAuth:!1}),k=Number(y.eligible||0),R=Number(y.viewed||0);I(k),p(R),g(!1)}catch{}de()})()};return window.addEventListener("filterchange",i),()=>window.removeEventListener("filterchange",i)},[fe,de]),s.useEffect(()=>{(async()=>{try{const i=await A(z.auth.me,{requireAuth:!1});be(i)}catch{}})()},[]);const[ye,rt]=s.useState(()=>typeof window<"u"?window.matchMedia("(max-width: 480px)").matches:!1);s.useEffect(()=>{const i=()=>{const k=document.querySelector(".top-nav");k&&Mt(k.offsetHeight),rt(window.matchMedia("(max-width: 480px)").matches)};i();const h=window.matchMedia("(max-width: 480px)"),y=()=>rt(h.matches);return h.addEventListener("change",y),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),h.removeEventListener("change",y)}},[]),s.useEffect(()=>{var y;if(!Me.current||!De.current||!n||!G.current)return;const i=()=>{var ve;const k=(ve=De.current)==null?void 0:ve.querySelector("div"),R=G.current;if(!k||!R||!Me.current)return;const O=Me.current,ue=window.matchMedia("(max-width: 480px)").matches;let Z;if(n.width&&n.height?Z=n.width/n.height:R.videoWidth>0&&R.videoHeight>0?Z=R.videoWidth/R.videoHeight:Z=16/9,ue){const xe=O.offsetWidth,ge=xe/Z;k.style.width=`${xe}px`,k.style.height=`${ge}px`,k.style.maxWidth="100%",k.style.maxHeight="100%"}else{const xe=O.offsetWidth-32,ge=O.offsetHeight-32,Oe=16/9,re=xe/Oe;let K=Math.min(ge,re),le=K*Z;le>xe&&(le=xe,K=le/Z),K>ge&&(K=ge,le=K*Z),k.style.width=`${le}px`,k.style.height=`${K}px`,k.style.maxWidth="100%",k.style.maxHeight="100%"}},h=()=>{requestAnimationFrame(i)};if(G.current.readyState>=1)i();else{const k=()=>{var R;i(),(R=G.current)==null||R.removeEventListener("loadedmetadata",k)};(y=G.current)==null||y.addEventListener("loadedmetadata",k)}return window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[n==null?void 0:n.id,n==null?void 0:n.width,n==null?void 0:n.height]),s.useEffect(()=>{if(!m)return;const i=h=>{Pe.current&&!Pe.current.contains(h.target)&&P(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[m]),s.useEffect(()=>{if(!$)return;const i=h=>{We.current&&!We.current.contains(h.target)&&V(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[$]),s.useEffect(()=>{if(!ae)return;const i=h=>{He.current&&!He.current.contains(h.target)&&qe.current&&!qe.current.contains(h.target)&&q(!1)};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[ae]);const ot=!!(B!=null&&B.is_admin||B!=null&&B.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Tt,{paused:ye}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
        /* Mobile-specific: ensure videos take full width */
        @media (max-width: 480px) {
          .video-area .discover-player-wrapper > div {
            min-width: 100% !important;
            max-width: 100% !important;
          }
          .video-area .discover-player-wrapper > div[style] {
            min-width: 100% !important;
            max-width: 100% !important;
          }
        }
      `}),e.jsxs("div",{ref:Xe,className:"player-wrap",style:{height:"100dvh",width:"100vw",position:"fixed",top:ye?"calc(0px - env(safe-area-inset-top, 0px))":0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1,margin:0,padding:0,boxSizing:"border-box"},children:[C&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:Le+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:Me,className:"video-area discover-video-container",style:{position:"absolute",top:ye?0:Le,left:0,right:0,bottom:ye?"-10px":0,maxHeight:ye?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${Le}px)`,height:ye?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${Le}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:ye?"none":"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:ye?"0":"16px",maxWidth:"100vw",width:"100%"},children:b?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=Ve+z.auth.login,children:"Login with osu!"})]}):n?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:At,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:De,className:"discover-player-wrapper",children:e.jsx(us,{streamUID:n.stream_uid,playbackUrl:n.playback_url,aspectRatio:n.width&&n.height?n.width/n.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:u,controls:!1,onVideoRef:Ft})}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:u?1:0,zIndex:2},children:u?e.jsx(es,{size:28,color:"#fff"}):e.jsx(ts,{size:28,color:"#fff"})})]})]})}):C?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"â€¢ Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"â€¢ Click video to toggle mute/unmute"}),e.jsx("div",{children:"â€¢ Hold to pause temporarily"})]})]})}),n&&!F&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:i=>i.stopPropagation(),children:[e.jsx(Y,{to:`/profile/${(lt=n.uploader)==null?void 0:lt.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(ct=n.uploader)!=null&&ct.avatar_url?e.jsx("img",{src:n.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:n.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:It,disabled:ke,"aria-label":n.liked_by_me?"Unlike":"Like",title:n.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:n.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:i=>i.currentTarget.style.transform="scale(1.1)",onMouseLeave:i=>i.currentTarget.style.transform="scale(1)",children:n.liked_by_me?e.jsx(Nt,{size:28}):e.jsx(St,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>D(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:i=>i.currentTarget.style.transform="scale(1.1)",onMouseLeave:i=>i.currentTarget.style.transform="scale(1)",children:e.jsx(Ct,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.comments_count??0})]}),n.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:qe,onClick:()=>q(i=>!i),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:i=>i.currentTarget.style.transform="scale(1.1)",onMouseLeave:i=>i.currentTarget.style.transform="scale(1)",children:e.jsx(Ye,{size:24})}),ae&&e.jsxs("div",{ref:He,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:n.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>q(!1),children:[e.jsx(Ye,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),n.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:zt,children:"Preview"})]})]}),ot?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>V(i=>!i),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:i=>i.currentTarget.style.transform="scale(1.1)",onMouseLeave:i=>i.currentTarget.style.transform="scale(1)",children:e.jsx(xt,{size:24})}),$&&e.jsxs("div",{ref:We,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:Rt,children:n.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:st,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>P(i=>!i),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:i=>i.currentTarget.style.transform="scale(1.1)",onMouseLeave:i=>i.currentTarget.style.transform="scale(1)",children:e.jsx(ss,{size:24})}),m&&e.jsxs("div",{ref:Pe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report asâ€¦"}),e.jsx("button",{className:"menu-item",onClick:()=>tt("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>tt("explicit"),children:"Explicit"}),ot&&e.jsx("button",{className:"menu-item",onClick:st,children:"Delete video"})]})]}),n&&!F&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:i=>i.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(Y,{to:`/profile/${(dt=n.uploader)==null?void 0:dt.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var k,R,O;const i=(k=n.uploader)==null?void 0:k.is_admin,h=(R=n.uploader)==null?void 0:R.is_mod,y=i?"#fff3bf":h?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:y},children:["@",(O=n.uploader)==null?void 0:O.username]}),n.is_starred&&e.jsx(wt,{size:16,color:"#f59e0b",title:"Starred"}),(i||h)&&e.jsx(xt,{size:14,color:y,title:i?"admin":"mod"})]})})()})}),(n.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:n.description}),n.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[n.beatmap_artist," â€“ ",n.beatmap_title," ",n.beatmap_mapper?`(by ${n.beatmap_mapper})`:""," ",n.beatmap_version?`[${n.beatmap_version}]`:""]})]}),W&&n&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",n.comments_count??0,")"]}),e.jsx("button",{onClick:()=>D(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(Je,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:it.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:it.map(i=>e.jsx(ms,{comment:i,replies:nt.get(i.id)||[],me:B,section:"mappi",onReply:h=>l(h),onDelete:Lt,replyingTo:se,replyText:H,onReplyTextChange:ee,onReplySubmit:at,posting:T,onCancelReply:()=>{l(null),ee("")},repliesMap:nt},i.id))})}),B&&!se&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:at,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:H,onChange:i=>ee(i.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:i=>{const h=i.target;h.style.height="auto",h.style.height=`${Math.min(h.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:T||!H.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:T?"...":"Post"})]})})]})]}),F&&(n==null?void 0:n.beatmapset_id)&&e.jsx(Ts,{open:F,onClose:()=>j(!1),downloadUrl:`${Ve}${z.osu.downloadBeatmapset(n.beatmapset_id)}`,beatmapId:n.beatmap_id??void 0,beatmapVersion:n.beatmap_version??void 0})]})]})}function yt(t){if(!t)return"standard";const o=String(t).toLowerCase().trim();return o==="osu"||o==="0"||o==="standard"?"standard":o==="taiko"||o==="1"?"taiko":o==="catch"||o==="fruits"||o==="2"?"catch":o==="mania"||o==="3"?"mania":"standard"}const Gs=({open:t,onClose:o,videoId:r,initialDescription:c,initialBeatmapUrl:f,onSave:d})=>{const[x,N]=s.useState(c||""),[v,C]=s.useState(f||""),[g,w]=s.useState(null),[I,M]=s.useState(null),[p,b]=s.useState(""),[S,u]=s.useState(!1),_=s.useRef(0);s.useEffect(()=>{t&&(N(c||""),C(f||""),w(null),M(null),b(""))},[t,c,f]),s.useEffect(()=>{if(!t)return;_.current&&window.clearTimeout(_.current);const j=(v||"").trim();if(!j){b(""),w(null),M(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(j)){b(""),w(null),M(null);return}return _.current=window.setTimeout(async()=>{var D;try{let m;try{m=new URL(j)}catch{b("Invalid URL format");return}const P=m.hash.match(/#osu\/(\d+)/),$=P?P[1]:null;m.hash="";const ae={url:m.toString()};$&&(ae.beatmap_id=$);const q=await A(z.osu.resolveBeatmap+je(ae),{requireAuth:!1}),X=Array.isArray(q==null?void 0:q.diffs)?q.diffs:[];if(!X.length&&!q.setId){b("No difficulties found"),w(null),M(null);return}if(w({setId:Number(q.setId)||0,beatmapId:q.beatmapId??null,title:String(q.title||""),artist:String(q.artist||""),mapper:String(q.mapper||""),diffs:X}),X.length>0){const ie=Number.isFinite(Number(q.beatmapId))?Number(q.beatmapId):Number((D=X[0])==null?void 0:D.id),H=X.find(se=>Number(se.id)===ie)||X[0],ee=yt(H==null?void 0:H.mode);M({beatmapId:Number(H==null?void 0:H.id)||null,version:String((H==null?void 0:H.version)||""),mode:ee})}b("")}catch(m){b(`Failed to resolve: ${(m==null?void 0:m.message)||"Unknown error"}`),w(null),M(null)}},400),()=>{_.current&&window.clearTimeout(_.current)}},[v,t]);const F=async()=>{if(!S){u(!0);try{await A(z.videos.update(r),{method:"PATCH",body:JSON.stringify({description:x.slice(0,100),beatmap_url:v.trim()||void 0})});const j=!!v.trim();if(g||!j)try{await A(z.videos.update(r)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:j&&g&&g.setId>0?g.setId:null,beatmap_id:j&&(I!=null&&I.beatmapId)?I.beatmapId:null,beatmap_version:j&&(I!=null&&I.version)?I.version:null,beatmap_title:j&&(g!=null&&g.title)?g.title:null,beatmap_artist:j&&(g!=null&&g.artist)?g.artist:null,beatmap_mapper:j&&(g!=null&&g.mapper)?g.mapper:null,beatmap_url:j?v.trim():null})})}catch(D){console.warn("Failed to update beatmap metadata:",D)}d(x,v.trim()||null),o()}catch(j){alert((j==null?void 0:j.message)||"Failed to update post")}finally{u(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:j=>j.target===j.currentTarget&&o(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:o}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:o,"aria-label":"Close",children:e.jsx(Je,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:x,onChange:j=>N(j.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),g?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[g.artist," â€“ ",g.title]}),e.jsxs("span",{className:"muted",children:["by ",g.mapper]})]}),e.jsx("select",{value:(I==null?void 0:I.beatmapId)??g.beatmapId??void 0,onChange:j=>{const W=Number(j.target.value),D=(g==null?void 0:g.diffs.find(m=>Number(m.id)===W))||null;if(D){const m=yt(D.mode);M({beatmapId:W,version:D.version,mode:m})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:g.diffs.map(j=>e.jsxs("option",{value:j.id,children:[j.version," (",j.mode,")"]},j.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{w(null),M(null),C("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:v,onChange:j=>C(j.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),p&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:p})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:o,disabled:S,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:F,disabled:S,children:S?"Saving...":"Save"})]})]})]})]}):null};function vt(){const t=as(),o=Fe(),{notify:r}=_e(),[c,f]=s.useState(null),[d,x]=s.useState(null),[N,v]=s.useState(""),[C,g]=s.useState([]),[w,I]=s.useState([]),[M,p]=s.useState([]),[b,S]=s.useState(""),[u,_]=s.useState(null),[F,j]=s.useState([]),[W,D]=s.useState(null),[m,P]=s.useState(""),[$,V]=s.useState([]),[ae,q]=s.useState(null),[X,ie]=s.useState(!1),H=s.useMemo(()=>{const l=t.id?Number(t.id):null;return l?c?c.id===l:!1:!0},[t.id,c]);function ee(l){const T=l.stream_uid||String(l.id),E=t.id?`/profile/${t.id}`:"/profile";o(`/mp/feed/${T}`,{state:{returnTo:E}})}s.useEffect(()=>{(async()=>{try{const l=await A(z.auth.me,{requireAuth:!1});f(l),l&&Array.isArray(l.inspirations)&&j(l.inspirations)}catch(l){v((l==null?void 0:l.message)||"Not logged in")}})()},[]),s.useEffect(()=>{(async()=>{try{const l=t.id?Number(t.id):null;if(l){const T=await A(z.users.get(l),{requireAuth:!1});x(T),S(T.about||""),Array.isArray(T.inspirations)&&j(T.inspirations);const E=await A(z.users.videos(l)+je({limit:"60"}),{requireAuth:!1});p(E.items||[]);const B=await A(z.users.likes(l)+je({limit:"60"}),{requireAuth:!1});I(B.items||[])}else{if(!c)return;x(c),S(c.about||""),Array.isArray(c.inspirations)&&j(c.inspirations);const T=await A(z.users.myVideos+je({limit:"50"}),{requireAuth:!1});g(T.items||[]);const E=await A(z.users.likes(c.id)+je({limit:"60"}),{requireAuth:!1});I(E.items||[])}}catch{}})()},[t.id,c]),s.useEffect(()=>{ie(!1)},[d==null?void 0:d.id]);async function se(l){try{const E=(await A(z.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:l})})).user||d;x(E),Array.isArray(E==null?void 0:E.inspirations)&&j(E.inspirations),t.id||f(E)}catch{}}return s.useEffect(()=>{let l;return W!==null&&m.trim().length>=2?l=setTimeout(async()=>{try{const T=await A(z.osu.usersSearch(m),{requireAuth:!1});V(Array.isArray(T.items)?T.items:[])}catch{}},250):V([]),()=>{l&&clearTimeout(l)}},[m,W]),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:d?e.jsxs(e.Fragment,{children:[d.avatar_url&&e.jsx("img",{src:d.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[d.username,d.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${d.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:l=>l.currentTarget.style.opacity="1",onMouseLeave:l=>l.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Ye,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",d.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!H&&F.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),F.map((l,T)=>H?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>q(l.id),onMouseLeave:()=>q(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const E=F.filter((B,be)=>be!==T);j(E),se(E)},children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),ae===l.id&&e.jsxs("div",{className:"insp-tooltip",children:[l.username," â€” click to remove"]})]},l.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>q(l.id),onMouseLeave:()=>q(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${l.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),ae===l.id&&e.jsx("div",{className:"insp-tooltip",children:l.username})]},l.id)),H&&F.length<3&&new Array(3-F.length).fill(0).map((l,T)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>q(-T-1),onMouseLeave:()=>q(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{D(T),P(""),V([])},children:"+"}),ae===-T-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),W===T&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:m,onChange:E=>P(E.target.value)}),e.jsxs("div",{className:"insp-results",children:[$.length===0&&m.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),$.map(E=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(c&&Number(c.osu_user_id)===Number(E.id)){r("Kinda based, but no.",{variant:"warn"}),D(null);return}if(F.some(be=>be.id===E.id)){D(null);return}const B=[...F,{id:E.id,username:E.username,avatar_url:E.avatar_url}].slice(0,3);j(B),D(null),se(B)},children:[e.jsx("img",{src:E.avatar_url,alt:"avatar"}),e.jsx("span",{children:E.username})]},E.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>D(null),children:"Close"})]})]},`slot-${T}`))]}),H&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:N||"Loadingâ€¦"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),H?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:b,onChange:l=>S(l.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{const l=await A(z.auth.me,{method:"PATCH",body:JSON.stringify({about:b})});x(l.user||d),f(l.user||c)}catch{}},children:"Save"})})]}):(()=>{const l=((d==null?void 0:d.about)||"").trim()||"No bio.",T=l.length>200,E=T&&!X?l.slice(0,200)+"...":l;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:E}),T&&e.jsx("button",{onClick:()=>ie(!X),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(is,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(kt,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:l=>{const T=l.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(B=>{B.classList.remove("active"),B.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:l=>{const T=l.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(B=>{B.classList.remove("active"),B.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(H?C:M).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(H?C:M).map(l=>(H&&d?(d.id,d.username,d.avatar_url,d.is_admin,d.is_mod):l.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>ee({...l}),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(St,{size:12}),e.jsx("span",{children:l.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ct,{size:12}),e.jsx("span",{children:l.comments_count??0})]})]})})]},l.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[w.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),w.map(l=>{var T,E;return e.jsxs("button",{className:"recent-cell",onClick:()=>ee(l),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((T=l.uploader)==null?void 0:T.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:l.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(E=l.uploader)==null?void 0:E.username})]})]},l.id)})]})})})]})]}),u&&e.jsx(Gs,{open:!!u,onClose:()=>_(null),videoId:u.id,initialDescription:u.description,initialBeatmapUrl:u.beatmap_url,onSave:(l,T)=>{g(C.map(E=>E.id===u.id?{...E,description:l||null,beatmap_url:T}:E)),_(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function Ks(){var T,E,B,be,ke;const[t,o]=s.useState(null),[r,c]=s.useState([]),[f,d]=s.useState(""),[x,N]=s.useState([]),[v,C]=s.useState(null),[g,w]=s.useState([]),[I,M]=s.useState("all"),[p,b]=s.useState("approvals"),[S,u]=s.useState(null),[_,F]=s.useState(""),[j,W]=s.useState(!1),{notify:D}=_e(),[m,P]=s.useState(null),[$,V]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const a=await A(z.auth.me,{requireAuth:!1});if(o(a),a!=null&&a.is_admin)try{const L=await A(z.admin.settingsModeration,{requireAuth:!1});u(!!L.require_approval)}catch{}}catch{}try{const a=await A(z.admin.videosPending+je({limit:"50"}),{requireAuth:!1});c(a.items||[])}catch{}})()},[]);async function ae(){V(!0);try{const a=await A(z.admin.analytics,{requireAuth:!1});P(a)}finally{V(!1)}}async function q(){try{const a=await A(z.admin.usersSearch(f),{requireAuth:!1});N(a.items||[])}catch{}}async function X(a){C(a),w([]);try{const L=await A(z.admin.userVideos(a.id)+je({limit:"50"}),{requireAuth:!1});w(L.items||[])}catch{}}async function ie(a,L){try{const ne=await A(z.admin.user(a.id),{method:"PATCH",body:JSON.stringify({is_mod:L})}),te=(ne==null?void 0:ne.user)||{...a,is_mod:L};D(L?"Granted moderation":"Revoked moderation",{variant:L?"success":"warn"}),C(te),N(x.map(oe=>oe.id===a.id?te:oe))}catch{alert("Failed to update")}}const H=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),ee=!!(t!=null&&t.is_admin);if(!H)return e.jsx("div",{className:"muted",children:"You do not have access."});const se=r.filter(a=>!a.flagged_only),l=r.filter(a=>!!a.flagged_only);return e.jsx("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"muted moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[e.jsx("button",{role:"tab","aria-selected":p==="approvals",className:`profile-tab ${p==="approvals"?"active":""}`,"data-tab":"approvals",onClick:a=>{const L=a.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach(te=>{te.classList.remove("active"),te.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),b("approvals")},children:"Approvals"}),(ee||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":p==="manage",className:`profile-tab ${p==="manage"?"active":""}`,"data-tab":"manage",onClick:a=>{const L=a.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach(te=>{te.classList.remove("active"),te.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),b("manage")},children:"Manage"}),(ee||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":p==="analytics",className:`profile-tab ${p==="analytics"?"active":""}`,"data-tab":"analytics",onClick:a=>{const L=a.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach(te=>{te.classList.remove("active"),te.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),b("analytics"),m||ae()},children:"Analytics"}),(ee||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":p==="message",className:`profile-tab ${p==="message"?"active":""}`,"data-tab":"message",onClick:a=>{const L=a.currentTarget.closest(".profile-tabs-unified");L.querySelectorAll(".profile-tab").forEach(te=>{te.classList.remove("active"),te.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),L.querySelector(".profile-tabs-content").setAttribute("data-active","message"),b("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":p,children:[e.jsx("div",{className:"panel approvals",hidden:p!=="approvals",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[se.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[se.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),se.map(a=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[a.poster_url?e.jsx("img",{src:a.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:a.description||"",children:a.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",a.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[a.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof a.flags_count=="number"&&a.flags_count>0?e.jsxs("span",{className:"muted",children:["â€¢ ",a.flags_count," reports"]}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await A(z.admin.videosReject(a.id),{method:"POST"}),c(r.filter(L=>L.id!==a.id)),D("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await A(z.admin.videosApprove(a.id),{method:"POST"}),c(r.filter(L=>L.id!==a.id)),D("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await A(z.videos.delete(a.id),{method:"DELETE"}),c(r.filter(L=>L.id!==a.id)),D("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},a.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[l.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[l.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),l.map(a=>e.jsxs("div",{className:"col moderation-video-card flagged",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[a.poster_url?e.jsx("img",{src:a.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:a.description||"",children:a.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",a.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof a.flags_count=="number"&&a.flags_count>0?e.jsxs("span",{className:"muted",children:["â€¢ ",a.flags_count," reports"]}):null]})]})]})]}),e.jsx("div",{className:"row",children:e.jsx("button",{className:"btn secondary",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await A(z.videos.delete(a.id),{method:"DELETE"}),c(r.filter(L=>L.id!==a.id)),D("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},a.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:p!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:f,onChange:a=>d(a.target.value),onKeyDown:a=>{a.key==="Enter"&&q()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:q,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:x.map(a=>e.jsxs("button",{className:"btn secondary moderation-user-result",onClick:()=>X(a),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center"},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:a.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",a.id," â€¢ osu ",a.osu_user_id]})]}),a.is_admin?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"admin"}):a.is_mod?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"mod"}):a.is_blacklisted?e.jsx("span",{style:{color:"#f87171",fontSize:12,flexShrink:0},children:"blacklisted"}):null]},a.id))})})]}),v?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flexWrap:"wrap"},children:[v.avatar_url&&e.jsx("img",{src:v.avatar_url,width:40,height:40,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:4},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:v.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",v.id," â€¢ osu ",v.osu_user_id]})]})]}),e.jsxs("div",{className:"col",style:{gap:10},children:[ee&&!v.is_admin&&(v.is_mod?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>ie(v,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>ie(v,!0),children:"Grant moderation"})),!v.is_admin&&(v.is_blacklisted?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await A(z.admin.user(v.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),C({...v,is_blacklisted:!1}),D("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await A(z.admin.user(v.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),C({...v,is_blacklisted:!0}),D("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),v.is_admin&&e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"})]}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>M("all"),children:"All"}),e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>M("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[g.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),g.filter(a=>{if(I==="all")return!0;const L=(S?!a.approved_at:!1)&&a.status==="ready",ne=!!a.needs_review;return L||ne}).map(a=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[a.poster_url?e.jsx("img",{src:a.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:a.description||"",children:a.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:[a.status.toUpperCase()," â€¢ ",new Date(a.created_at*1e3).toLocaleString()]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[a.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,S&&!a.approved_at&&a.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:14},children:a.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)",fontSize:16},children:"â˜…"})]}),e.jsxs("div",{className:"row",style:{gap:8},children:[(ee||(t==null?void 0:t.is_mod))&&(!!a.needs_review||S&&!a.approved_at&&a.status==="ready")&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await A(z.admin.videosApprove(a.id),{method:"POST"}),w(g.map(L=>L.id===a.id?{...L,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:L)),D("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(ee||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await A(z.videos.delete(a.id),{method:"DELETE"}),w(g.filter(L=>L.id!==a.id)),D("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]})]},a.id))]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:p!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:f,onChange:a=>d(a.target.value),onKeyDown:a=>{a.key==="Enter"&&q()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:q,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:x.map(a=>e.jsxs("button",{className:`btn secondary moderation-user-result ${(v==null?void 0:v.id)===a.id,""}`,onClick:()=>C(a),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center",border:(v==null?void 0:v.id)===a.id?"2px solid var(--accent)":void 0},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:a.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",a.id," â€¢ osu ",a.osu_user_id]})]}),(v==null?void 0:v.id)===a.id&&e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"selected"})]},a.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:j,onChange:a=>W(a.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",width:"100%",fontSize:16,color:"inherit",fontFamily:"inherit"},value:_,onChange:a=>F(a.target.value)}),e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const a=(_||"").trim();if(!a){alert("Enter a message");return}(async()=>{try{const L={text:a,global:j};!j&&(v!=null&&v.id)&&(L.user_id=v.id),await A(z.admin.notificationsSystem,{method:"POST",body:JSON.stringify(L)}),F(""),D("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:p!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Analytics"}),$&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loadingâ€¦"}),!$&&!m&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(he,{label:"Users",value:m.totals.users_total}),e.jsx(he,{label:"Admins",value:m.totals.users_admin}),e.jsx(he,{label:"Mods",value:m.totals.users_mod}),e.jsx(he,{label:"Blacklisted",value:m.totals.users_blacklisted}),e.jsx(he,{label:"Videos",value:m.totals.videos_total}),e.jsx(he,{label:"Ready",value:m.totals.videos_ready}),e.jsx(he,{label:"Pending",value:m.totals.pending_count}),e.jsx(he,{label:"Purgatory",value:m.totals.purgatory_count}),e.jsx(he,{label:"Likes",value:m.totals.likes_total}),e.jsx(he,{label:"Flags",value:m.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Qe,{title:"New users (30d)",series:m.series.users,color:"#60a5fa"}),e.jsx(Qe,{title:"New videos (30d)",series:m.series.videos,color:"#34d399"}),((E=(T=m.stream)==null?void 0:T.graphql)==null?void 0:E.minutes_viewed)&&m.stream.graphql.minutes_viewed.length>0&&e.jsx(Qe,{title:"Minutes viewed (30d)",series:m.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",m.feed.count," items in rotation",m.feed.cursor?` â€¢ cursor ${m.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",m.stream.approximate.total_duration_sec," â€¢ ready videos: ",m.stream.approximate.videos_ready]}),m.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",m.stream.api.ok?"ok":"unavailable",(be=(B=m.stream.api)==null?void 0:B.result_info)!=null&&be.count?` â€¢ count ${m.stream.api.result_info.count}`:"",(ke=m.stream.api)!=null&&ke.sample_status?` â€¢ sample status ${String(m.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})})}function he({label:t,value:o}){return e.jsxs("div",{className:"col moderation-stat-card",children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",style:{fontSize:"clamp(18px, 4vw, 20px)"},children:o})]})}function Qe({title:t,series:o,color:r}){const[c,f]=s.useState(!1);s.useEffect(()=>{const m=()=>{f(window.matchMedia("(max-width: 480px)").matches)};m();const P=window.matchMedia("(max-width: 480px)");return P.addEventListener("change",m),()=>P.removeEventListener("change",m)},[]);const d=c?Math.min(400,window.innerWidth-48):400,x=160,N=8,v=8,C=28,g=c?36:42,w=o.map(m=>m.count),I=Math.max(1,...w),M=s.useMemo(()=>{const m=I,P=Math.pow(10,Math.floor(Math.log10(m))),$=m/P;return($<=1?1:$<=2?2:$<=5?5:10)*P},[I]),p=d-g-v,b=x-N-C,S=s.useMemo(()=>o.map((m,P)=>{const $=g+P/Math.max(1,o.length-1)*p,V=N+(1-m.count/(M||1))*b;return[$,V]}),[o,M,p,b]),u=s.useMemo(()=>S.map((m,P)=>P===0?`M ${m[0]} ${m[1]}`:`L ${m[0]} ${m[1]}`).join(" "),[S]),_=[0,.25,.5,.75,1],F=s.useMemo(()=>{if(o.length===0)return[];const m=[0,.25,.5,.75,1].map(P=>Math.min(o.length-1,Math.round(P*(o.length-1))));return Array.from(new Set(m))},[o]),j=m=>{if(!m||m.length<10)return m||"";const P=m.slice(5,7).replace(/^0/,""),$=m.slice(8,10).replace(/^0/,"");return`${P}/${$}`};function W(m){const P=Number.isInteger(m);return m>=1e6?`${(m/1e6).toFixed(1).replace(/\.0$/,"")}M`:m>=1e3?`${(m/1e3).toFixed(1).replace(/\.0$/,"")}k`:P?String(m):m<10?m.toFixed(1):m.toFixed(1).replace(/\.0$/,"")}const D=o.length?o[o.length-1].count:0;return e.jsxs("div",{className:"col moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:c?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:c?11:12},children:["latest: ",W(D)]})]}),e.jsx("div",{style:{width:"100%",overflowX:"auto"},children:e.jsxs("svg",{width:d,height:x,role:"img","aria-label":t,style:{display:"block"},children:[e.jsx("rect",{x:0,y:0,width:d,height:x,fill:"#0f1217",rx:12}),_.map((m,P)=>{const $=N+(1-m)*b,V=m*M;return e.jsxs("g",{children:[e.jsx("line",{x1:g,y1:$,x2:d-v,y2:$,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:g-6,y:$+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:W(V)})]},P)}),e.jsx("line",{x1:g,y1:N,x2:g,y2:N+b,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:g,y1:N+b,x2:g+p,y2:N+b,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),F.map((m,P)=>{var V;const $=g+m/Math.max(1,o.length-1)*p;return e.jsxs("g",{children:[e.jsx("line",{x1:$,y1:N,x2:$,y2:N+b,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:$,y:N+b+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:j((V=o[m])==null?void 0:V.day)})]},P)}),e.jsx("path",{d:u,fill:"none",stroke:r,strokeWidth:2}),S.length>0&&e.jsx("circle",{cx:S[S.length-1][0],cy:S[S.length-1][1],r:3,fill:r})]})})]})}function Xs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Zs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const ea=()=>e.jsx(Es,{}),ta=()=>e.jsx(ls,{children:e.jsxs(J,{element:e.jsx(Qs,{}),children:[e.jsx(J,{path:"/",element:e.jsx(Ys,{})}),e.jsx(J,{path:"/mp/discover",element:e.jsx(bt,{})}),e.jsx(J,{path:"/mp/feed",element:e.jsx(Ce,{})}),e.jsx(J,{path:"/mp/feed/:uid",element:e.jsx(hs,{})}),e.jsx(J,{path:"/md/feed",element:e.jsx(ws,{})}),e.jsx(J,{path:"/md/feed/:uid",element:e.jsx(Ns,{})}),e.jsx(J,{path:"/md/queues",element:e.jsx(ks,{})}),e.jsx(J,{path:"/md/queues/:id",element:e.jsx(Ss,{})}),e.jsx(J,{path:"/md/notifications",element:e.jsx(Cs,{})}),e.jsx(J,{path:"/profile",element:e.jsx(vt,{})}),e.jsx(J,{path:"/profile/:id",element:e.jsx(vt,{})}),e.jsx(J,{path:"/moderation",element:e.jsx(Ks,{})}),e.jsx(J,{path:"/about",element:e.jsx(Xs,{})}),e.jsx(J,{path:"/settings",element:e.jsx(Zs,{})}),e.jsx(J,{path:"/editor",element:e.jsx(ea,{})}),e.jsx(J,{path:"/feed",element:e.jsx(bt,{})}),e.jsx(J,{path:"/upload",element:e.jsx(Ce,{})}),e.jsx(J,{path:"/posts",element:e.jsx(Ce,{})}),e.jsx(J,{path:"/recents",element:e.jsx(Ce,{})}),e.jsx(J,{path:"/recent",element:e.jsx(Ce,{})})]})}),sa=()=>e.jsx(os,{children:e.jsx(ta,{})});ns(document.getElementById("root")).render(e.jsx(zs,{children:e.jsx(rs,{client:Ms,children:e.jsx(ps,{children:e.jsx(sa,{})})})}));
