const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-DXZ_DknC.js","assets/vendor-react-CJJ8g4j9.js","assets/vendor-9gT45Spz.js","assets/mappi-routes-CKcQyKBC.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-2rGn0xn5.js","assets/vendor-zip-BMVqRzO9.js","assets/beatmap-preview-BPnr1eYJ.js","assets/editor-CG1yLUbS.css","assets/moddi-routes-DYxhFabR.js","assets/editor-components-D4aeOjRG.js","assets/editor-components-Bzmrvihl.css"])))=>i.map(i=>d[i]);
var ot=Object.defineProperty;var lt=(t,n,a)=>n in t?ot(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;var Fe=(t,n,a)=>lt(t,typeof n!="symbol"?n+"":n,a);import{r as g,j as e,e as ye,u as we,R as N,q as Ie,d as Le,U as ct,V as We,W as dt,L as V,X as ut,Y as mt,O as Je,Z as pt,_ as ht,P as _e,K as ft,A as gt,h as xt,y as qe,Q as bt,S as vt,I as yt,c as Te,B as jt,l as Ge,$ as Nt,D as wt,a0 as De,o as kt,k as St,E as _t,i as Tt,g as Ct,a1 as Ue,a2 as Et,a3 as Ve,v as Mt,a4 as Lt,a5 as At,a6 as Pt,a7 as It,a8 as G,a9 as he}from"./vendor-react-CJJ8g4j9.js";import{y as zt}from"./vendor-9gT45Spz.js";import{u as ge,a as $,A as q,O as Ne,c as Ce,i as ce,d as Pe,b as fe,P as Rt,e as Ft,T as Wt,f as qt}from"./mappi-routes-CKcQyKBC.js";import{u as me,a as Ye,b as de,c as Xe,d as Dt,e as Ut,f as $t,g as Ze,h as Bt,i as Ot,F as Ht,D as Qt,Q as Kt,j as Jt,M as Gt,N as Vt}from"./moddi-routes-DYxhFabR.js";import{i as et,a as tt,b as st,c as at,H as Yt}from"./editor-components-D4aeOjRG.js";import{s as Xt,E as Zt,B as es}from"./editor-2rGn0xn5.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-BPnr1eYJ.js";import"./vendor-zip-BMVqRzO9.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();const ts="modulepreload",ss=function(t){return"/"+t},$e={},as=function(n,a,r){let s=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),j=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=Promise.allSettled(a.map(u=>{if(u=ss(u),u in $e)return;$e[u]=!0;const f=u.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const l=document.createElement("link");if(l.rel=f?"stylesheet":ts,f||(l.as="script"),l.crossOrigin="",l.href=u,j&&l.setAttribute("nonce",j),document.head.appendChild(l),f)return new Promise((k,C)=>{l.addEventListener("load",k),l.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(h){const j=new Event("vite:preloadError",{cancelable:!0});if(j.payload=h,window.dispatchEvent(j),!j.defaultPrevented)throw h}return s.then(h=>{for(const j of h||[])j.status==="rejected"&&o(j.reason);return n().catch(o)})},is=new zt({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class ns extends g.Component{constructor(a){super(a);Fe(this,"handleRetry",()=>{const a=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),a&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r)}isChunkLoadingError(a){if(!a)return!1;const r=a.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||a.name==="ChunkLoadError"}render(){var a;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),s=((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":s}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const oe=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function rs({i:t}){const n=t*1337,a=(C,_)=>{const v=Math.sin(n+C+_)*1e4,S=v-Math.floor(v);return Math.floor(S*(_-C+1)+C)},r=a(0,100),s=a(24,50),o=.7+a(0,100)/100*.3,h=s*o,j=a(0,4e3),u=a(-10,10),f=a(-8,8),m=a(0,100),l=m<60?1:m<80?1.5:2,k=[{size:200*l,alpha:.06,dx:-22,dy:12,color:oe[a(0,oe.length-1)]},{size:150*l,alpha:.08,dx:-9,dy:7,color:oe[a(0,oe.length-1)]},{size:120*l,alpha:.1,dx:0,dy:0,color:oe[a(0,oe.length-1)]},{size:90*l,alpha:.12,dx:12,dy:-4,color:oe[a(0,oe.length-1)]},{size:64*l,alpha:.13,dx:20,dy:-7,color:oe[a(0,oe.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${h}s`,animationDelay:`${j}ms`,"--tx":`${u}vw`,transform:`rotate(${f}deg)`},children:k.map((C,_)=>e.jsx("svg",{width:C.size,height:C.size,viewBox:"0 0 100 100",style:{left:`${50+C.dx}%`,bottom:`${C.dy}px`,transform:"translateX(-50%)","--alpha":C.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:C.color})},_))})}function os({paused:t=!1}){const n=g.useMemo(()=>new Array(20).fill(0).map((a,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:n.map(a=>e.jsx(rs,{i:a},a))})}function ls(){const t=ye(),n=we(),{lastSection:a,previousLocation:r,setPreviousLocation:s}=me(),o=N.useRef(null);N.useRef(!1),N.useRef(0),N.useRef(0);const h=N.useRef(null),j=N.useRef(null);N.useRef(!1);const u=N.useRef(null),f=N.useRef(null),m=N.useRef(null),[l,k]=N.useState(!1),[C,_]=N.useState(12),v=N.useRef(null),S=N.useRef(null),[x,R]=N.useState(!1),[O,b]=N.useState(12),[Q,F]=N.useState([]),[c,U]=N.useState(""),H=N.useRef(null),T=N.useRef(null),[M,E]=N.useState(!1),[w,A]=N.useState(12),[y,B]=N.useState(null),K=N.useCallback(()=>{if(!f.current)return;const d=f.current.getBoundingClientRect(),L=window.innerWidth||document.documentElement.clientWidth||320,D=160;let P=d.left;P+D+8>L&&(P=Math.max(8,L-D-8)),P=Math.max(8,P),_(P)},[]),p=N.useCallback(()=>{if(!v.current)return;const d=v.current.getBoundingClientRect(),L=window.innerWidth||document.documentElement.clientWidth||320,D=220;let P=d.left;P+D+8>L&&(P=Math.max(8,L-D-8)),P=Math.max(8,P),b(P)},[]),W=N.useCallback(()=>{if(!H.current)return;const d=H.current.getBoundingClientRect(),L=window.innerWidth||document.documentElement.clientWidth||320,D=280;let P=d.left;P+D+8>L&&(P=Math.max(8,L-D-8)),P=Math.max(8,P),A(P)},[]);N.useEffect(()=>()=>{o.current&&clearTimeout(o.current),h.current&&clearTimeout(h.current),j.current&&clearTimeout(j.current)},[]),N.useEffect(()=>{if(!l)return;const d=L=>{const D=L.target;m.current&&!m.current.contains(D)&&f.current&&!f.current.contains(D)&&k(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[l]),N.useEffect(()=>{if(!x)return;const d=L=>{const D=L.target;S.current&&!S.current.contains(D)&&v.current&&!v.current.contains(D)&&R(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[x]),N.useEffect(()=>{if(!M)return;const d=L=>{const D=L.target;T.current&&!T.current.contains(D)&&H.current&&!H.current.contains(D)&&E(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[M]),N.useEffect(()=>{if(!l)return;K();const d=()=>K();return window.addEventListener("resize",d),window.addEventListener("orientationchange",d),()=>{window.removeEventListener("resize",d),window.removeEventListener("orientationchange",d)}},[l,K]),N.useEffect(()=>{if(!x)return;p();const d=()=>p();return window.addEventListener("resize",d),window.addEventListener("orientationchange",d),()=>{window.removeEventListener("resize",d),window.removeEventListener("orientationchange",d)}},[x,p]),N.useEffect(()=>{if(!M)return;W();const d=()=>W();return window.addEventListener("resize",d),window.addEventListener("orientationchange",d),()=>{window.removeEventListener("resize",d),window.removeEventListener("orientationchange",d)}},[M,W]);const z=t.pathname==="/feed"||t.pathname.startsWith("/feed/")||t.pathname==="/queues"||t.pathname.startsWith("/queues/")||t.pathname==="/discover"||t.pathname==="/submissions",Y=t.pathname==="/"||t.pathname==="/about",se=t.pathname==="/editor";t.pathname.startsWith("/mp/")||z&&a==="mappi"||!Y&&!z&&t.pathname.startsWith("/md/"),t.pathname.startsWith("/md/")||z&&a==="moddi"||!Y&&!z&&t.pathname.startsWith("/mp/"),N.useEffect(()=>{if(!se)return;const d=D=>{const P=D.detail||{},ae=Array.isArray(P.items)?P.items:[];F(ae),U(String(P.selected||""))},L=D=>{const P=D.detail||{};B({title:String(P.title||""),artist:String(P.artist||""),mapper:String(P.mapper||""),version:String(P.version||""),beatmapId:Number(P.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",d),window.addEventListener("editor:info",L),()=>{window.removeEventListener("editor:difficulty:list",d),window.removeEventListener("editor:info",L)}},[se]);const xe=Ye(),{data:J}=de(),ee=N.useRef(null),ie=N.useRef(!1),be=d=>{ie.current=!1,(J!=null&&J.is_mod||J!=null&&J.is_admin)&&(d.preventDefault(),d.stopPropagation(),ee.current=setTimeout(()=>{ie.current=!0,n("/moderation")},500))},pe=()=>{ee.current&&(clearTimeout(ee.current),ee.current=null),ie.current&&setTimeout(()=>{ie.current=!1},100)},i=d=>{if(ie.current){d.preventDefault(),d.stopPropagation();return}n("/settings")},I=d=>{if(pe(),ie.current){d.preventDefault();return}n("/settings")};if(N.useEffect(()=>()=>{ee.current&&clearTimeout(ee.current)},[]),Y)return null;const te=()=>{n(r||"/feed")},Z=()=>{k(d=>!d)},ve=()=>{var d;k(!1),(d=u.current)==null||d.click()},Ee=()=>{R(d=>!d)},Me=d=>{R(!1),U(d),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:d}}))},ke=()=>{E(d=>!d)};return se?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:u,type:"file",accept:".osz,.zip",onChange:d=>{var D;const L=(D=d.target.files)==null?void 0:D[0];L&&window.dispatchEvent(new CustomEvent("editor:file",{detail:L}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:te,"aria-label":"Back",title:"Go back",children:e.jsx(Ie,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:f,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Z,"aria-label":"File",title:"File menu","aria-expanded":l,children:e.jsx(ct,{size:20})}),l&&Le.createPortal(e.jsx("div",{ref:m,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${C}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:ve,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:te,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[Q.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:v,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Ee,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":x,children:e.jsx(We,{size:20})}),x&&Le.createPortal(e.jsx("div",{ref:S,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${O}px`,minWidth:220},children:Q.map(d=>{const L=d.mode==="taiko"?et:d.mode==="mania"?tt:d.mode==="catch"?st:at;return e.jsxs("button",{className:`mode-option ${c===d.path?"selected":""}`,type:"button",onClick:()=>Me(d.path),children:[e.jsx("img",{className:"mode-icon",src:L,width:24,height:24,alt:""}),e.jsx("span",{children:d.version||"(Untitled)"})]},d.path)})}),document.body)]}),y&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:H,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ke,"aria-label":"Map Info",title:"Map Info","aria-expanded":M,children:e.jsx(dt,{size:20})}),M&&Le.createPortal(e.jsx("div",{ref:T,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${w}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[y.artist||"Artist"," – ",y.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",y.mapper||"Unknown"]}),y.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",y.version]}),y.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${y.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]}):e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(V,{to:"/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/feed"||t.pathname.startsWith("/feed/")?"active":""}`,"aria-label":"Feed",children:e.jsx(We,{size:20})}),e.jsx(V,{to:"/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(ut,{size:20})}),e.jsx(V,{to:"/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/queues"||t.pathname.startsWith("/queues/")?"active":""}`,"aria-label":"Queues",children:e.jsx(mt,{size:20})})]}),e.jsx(V,{to:"/",className:"mobile-bottom-nav-coin-flip","aria-label":"Home",title:"Go to home",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"m!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(V,{to:"/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(Je,{size:20}),xe>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:i,onTouchStart:be,onTouchEnd:I,onMouseDown:be,onMouseUp:pe,onMouseLeave:pe,"aria-label":J!=null&&J.is_mod||J!=null&&J.is_admin?"Settings (long press for moderation)":"Settings",title:J!=null&&J.is_mod||J!=null&&J.is_admin?"Settings (long press for moderation)":"Settings",children:e.jsx(pt,{size:20})})]})]})}function cs(){return e.jsx(V,{to:"/feed",className:"title",style:{textDecoration:"none",color:"inherit"},children:"mappi"})}function ds({isEditor:t}){return ye(),t?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(V,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ht,{size:18})}),e.jsx(V,{to:"/feed",className:"title",children:"osu!editi.ng"})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:4},children:e.jsx(cs,{})})}function us({isNeutralPage:t}){const a=ye().pathname;return t&&a!=="/"?e.jsx("nav",{className:"nav-links","aria-label":"Primary",children:e.jsx(V,{to:a==="/about"?"/":"/about",className:a==="/about"?"active":"",children:a==="/about"?"Home":"About"})}):e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[e.jsx(V,{to:"/feed",className:a==="/feed"||a.startsWith("/feed/")?"active":"",children:"Feed"}),e.jsx(V,{to:"/discover",className:a==="/discover"?"active":"",children:"Discover"}),e.jsx(V,{to:"/queues",className:a==="/queues"||a.startsWith("/queues/")?"active":"",children:"Queues"}),e.jsx(V,{to:"/submissions",className:a==="/submissions"?"active":"",children:"Submissions"}),e.jsx(V,{to:"/editor",className:a==="/editor"?"active":"",children:"Editor"})]})}function ms(t,n,a,r){const s=we(),{notify:o}=ge(),[h,j]=g.useState(new Set);return{parseQueueInvite:_=>{if(!_)return null;try{const v=JSON.parse(_);if((v==null?void 0:v.type)==="queue_invite"&&(v!=null&&v.queue_id))return v}catch{}return null},handleAcceptInvite:async(_,v)=>{if(!h.has(_.id)){j(S=>new Set(S).add(_.id));try{await $(q.moddi.queueAccept(String(v)),{method:"POST"}),o("Invitation accepted!",{variant:"success"}),a.mutate(_.id),r(!1),s(`/queues/${v}`)}catch(S){o((S==null?void 0:S.message)||"Failed to accept invitation",{variant:"error"})}finally{j(S=>{const x=new Set(S);return x.delete(_.id),x})}}},handleDenyInvite:async(_,v)=>{if(!h.has(_.id)){j(S=>new Set(S).add(_.id));try{await $(q.moddi.queueDeny(String(v)),{method:"POST"}),o("Invitation declined",{variant:"success"}),a.mutate(_.id)}catch(S){o((S==null?void 0:S.message)||"Failed to decline invitation",{variant:"error"})}finally{j(S=>{const x=new Set(S);return x.delete(_.id),x})}}},handleMarkAllRead:async()=>{const _=t.filter(v=>v.id.startsWith("n:")||v.kind==="system"&&!v.read).map(v=>v.id);_.length>0&&n.mutate(_)},handleNotificationClick:async _=>{r(!1),n.mutate([_.id]);const v=typeof _.targetPath=="string"&&_.targetPath.trim().length>0?_.targetPath:null;if(v&&s(v),_.kind==="system"||_.id.startsWith("n:"))try{await $(q.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[_.id]})})}catch{}},handleDeleteNotification:async(_,v)=>{_.stopPropagation(),a.mutate(v)},processing:h}}function ps({notifications:t,unreadCount:n,notifOpen:a,setNotifOpen:r,markReadMutation:s,deleteNotificationMutation:o,closeAllPanels:h}){const j=g.useRef(null),u=g.useRef(null),{parseQueueInvite:f,handleAcceptInvite:m,handleDenyInvite:l,handleMarkAllRead:k,handleNotificationClick:C,handleDeleteNotification:_,processing:v}=ms(t,s,o,r);Xe(j,u,a,()=>r(!1));const S=t.filter(x=>!(x.kind==="system"&&x.id.startsWith("b:")&&(x.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:j,className:"icon-link",onClick:()=>{a||h(),r(!a)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Je,{size:18})}),n>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),a&&e.jsxs("div",{ref:u,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(V,{to:"/notifications",onClick:()=>r(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:x=>x.currentTarget.style.opacity="1",onMouseLeave:x=>x.currentTarget.style.opacity="0.7",children:"View all"}),S.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:k,children:e.jsx(_e,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[S.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),S.map(x=>{const R=f(x.text),O=x.id.startsWith("b:"),b=R?"queue-invite":x.kind==="star"?"star":x.kind==="likes5"?"likes":x.kind==="comment"?"comment":x.kind==="inspiration"?"inspiration":x.kind==="reaction"?"reaction":O?"global":"system",Q=x.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${b}`,role:"button",onClick:()=>!R&&C(x),children:[e.jsxs("div",{className:`notif-icon ${Q?"deletable":""}`,"aria-hidden":"true",onClick:Q&&!R?F=>_(F,x.id):void 0,title:Q&&!R?"Remove":void 0,role:Q&&!R?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:R?e.jsx(ft,{}):b==="star"?e.jsx(gt,{}):b==="likes"?e.jsx(xt,{}):b==="comment"?e.jsx(qe,{}):b==="inspiration"?e.jsx(qe,{}):b==="reaction"?e.jsx(bt,{}):b==="global"?e.jsx(vt,{}):null}),Q&&!R?e.jsx("span",{className:"swap-trash",children:e.jsx(yt,{})}):null]}),e.jsx("div",{className:"notif-body",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[R.inviter_username," invited you to join queue: ",R.queue_name]}),v.has(x.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:F=>{F.stopPropagation(),m(x,R.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(_e,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:F=>{F.stopPropagation(),l(x,R.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Te,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):x.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:O?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ne,{text:x.text||""})}),O&&x.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(x.expiresAt).toLocaleString()]}):null]}):x.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ne,{text:x.text||"Someone commented on your post"})})]}):x.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ne,{text:x.text||"Someone is inspired by you!"})})]}):x.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Ne,{text:x.text||"Someone raised their hand on your post!"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:x.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:x.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},x.id)})]})]})]})}function hs({quota:t,nowTick:n}){if(!(t!=null&&t.blocked))return null;const a=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),r=Math.floor(a/3600),s=Math.floor(a%3600/60),o=a%60,h=u=>String(u).padStart(2,"0"),j=r>0?`${r}:${h(s)}:${h(o)}`:`${s}:${h(o)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(jt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:j})]})}function fs({me:t,menuOpen:n,setMenuOpen:a,onLogout:r,closeAllPanels:s}){const o=g.useRef(null),h=g.useRef(null);return Xe(o,h,n,()=>a(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:o,className:"icon-link",onClick:()=>{n||s(),a(!n)},title:t.username,"aria-label":"User menu","aria-expanded":n,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(Ge,{size:14,style:{opacity:.8}})]}),n&&e.jsxs("div",{ref:h,className:"menu-panel",role:"menu",children:[e.jsx(V,{to:"/profile",className:"menu-item",onClick:()=>a(!1),children:"Profile"}),e.jsx(V,{to:"/settings",className:"menu-item",onClick:()=>a(!1),children:"Settings"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(V,{to:"/moderation",className:"menu-item",onClick:()=>a(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:r,children:"Log out"})]})]})}function gs({isNeutralPage:t,isEditor:n}){const a=ye(),r=we(),{data:s,isLoading:o}=de(),{data:h}=Dt(!!s),{data:j=[]}=Ut(!!s),u=Ye(),f=$t(),m=Ze(),l=Bt(),{menuOpen:k,notifOpen:C,setMenuOpen:_,setNotifOpen:v,closeAllPanels:S,previousLocation:x,lastSection:R}=me(),O=a.pathname==="/settings",b=a.pathname==="/moderation",Q=a.pathname==="/profile"||a.pathname.startsWith("/profile/"),F=O||b||Q,c=()=>{r(x||"/feed")},[U,H]=N.useState(0);return N.useEffect(()=>{const T=setInterval(()=>H(M=>M+1),1e3);return()=>clearInterval(T)},[]),e.jsxs("header",{className:"top-nav",children:[F&&e.jsx("button",{onClick:c,className:"icon-link",title:"Go back","aria-label":"Go back",style:{width:"auto",height:"auto",padding:"4px",marginRight:4},children:e.jsx(Ie,{size:18})}),e.jsx(ds,{isEditor:n}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),a.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Yt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(us,{isNeutralPage:t}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Nt,{size:18})}),s?e.jsxs("div",{className:"user-menu",children:[e.jsx(ps,{notifications:j,unreadCount:u,notifOpen:C,setNotifOpen:v,markReadMutation:m,deleteNotificationMutation:l,closeAllPanels:S}),e.jsx(hs,{quota:h,nowTick:U}),e.jsx(fs,{me:s,menuOpen:k,setMenuOpen:_,onLogout:()=>f.mutate(),closeAllPanels:S})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Ce+q.auth.login},disabled:o,children:o?"Checking…":"Login with osu!"})]})]})}function xs({title:t,onRefresh:n}){const{data:a}=de(),r=ye(),s=we(),{lastSection:o}=me(),[h,j]=N.useState(!0),[u,f]=N.useState(0),[m,l]=N.useState(!1),k=N.useRef(!1),C=N.useRef(0),[_,v]=N.useState(!1),S=N.useRef(null),{data:x=[]}=Ot(),R=Ze(),{notify:O}=ge();N.useEffect(()=>{const c=document.querySelector(".page");if(!c)return;let U=c.scrollTop,H=!1;const T=()=>{H||(H=!0,requestAnimationFrame(()=>{const M=c.scrollTop,E=M-U;M<=12||E<-12?j(!0):E>12&&j(!1),U=M,H=!1}))};return c.addEventListener("scroll",T,{passive:!0}),()=>c.removeEventListener("scroll",T)},[]),N.useEffect(()=>{const c=document.querySelector(".page");if(!c)return;const U=120,H=70,T=A=>{var y;m||(c.scrollTop<=0?(k.current=!0,C.current=((y=A.touches[0])==null?void 0:y.clientY)??0):k.current=!1)},M=A=>{var K;if(!k.current||m)return;const y=((K=A.touches[0])==null?void 0:K.clientY)??0,B=Math.max(0,y-C.current);if(B>0){const p=Math.min(U,B*.5);f(p)}},E=async()=>{try{if(l(!0),n)await n();else{window.location.reload();return}}finally{setTimeout(()=>{l(!1),f(0)},400)}},w=()=>{!k.current||m||(u>=H?E():f(0),k.current=!1)};return c.addEventListener("touchstart",T,{passive:!0}),c.addEventListener("touchmove",M,{passive:!0}),c.addEventListener("touchend",w),c.addEventListener("touchcancel",w),()=>{c.removeEventListener("touchstart",T),c.removeEventListener("touchmove",M),c.removeEventListener("touchend",w),c.removeEventListener("touchcancel",w)}},[u,m,n]);const{showBack:b,onBack:Q}=N.useMemo(()=>{const c=r.pathname;if(/^\/feed\/.+/.test(c))return{showBack:!0,onBack:()=>s("/feed")};if(/^\/mp\/feed\/.+/.test(c))return{showBack:!0,onBack:()=>s("/feed")};if(/^\/md\/feed\/.+/.test(c))return{showBack:!0,onBack:()=>s("/feed")};if(/^\/queues\/.+/.test(c))return{showBack:!0,onBack:()=>s("/queues")};if(/^\/md\/queues\/.+/.test(c))return{showBack:!0,onBack:()=>s("/queues")};if(c==="/profile"||c.startsWith("/profile/")){const U="/feed";return{showBack:!0,onBack:()=>{window.history.length>2?s(-1):s(U)}}}return{showBack:!1,onBack:()=>{}}},[r.pathname,s,o]),F=r.pathname==="/notifications";return e.jsxs("div",{className:`mobile-page-header ${h?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${h?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:b?e.jsx("button",{className:"icon-link",onClick:Q,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ie,{size:18})}):e.jsx(V,{to:"/profile",className:"icon-link","aria-label":"Profile",children:a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"var(--hover-overlay-strong)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:F?e.jsx("button",{className:"icon-link","aria-label":"Mark all read",title:"Mark all read",style:{padding:4},onClick:()=>{const c=x.filter(U=>!U.read&&(U.id.startsWith("n:")||U.kind==="system"&&!U.id.startsWith("b:"))).map(U=>U.id);c.length!==0&&R.mutate(c,{onSuccess:()=>{O("All notifications marked as read",{variant:"success"})}})},children:e.jsx(_e,{size:18})}):(()=>{const c=r.pathname;let U=null;return c==="/feed"||c==="/mp/feed"?U="mappi-feed":c==="/md/feed"?U="moddi-feed":c==="/queues"||c==="/md/queues"?U="moddi-queues":(c.startsWith("/queues/")||c.startsWith("/md/queues/"))&&(U="moddi-queue-detail"),U?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:S,className:"icon-link","aria-haspopup":"dialog","aria-expanded":_,onClick:()=>v(H=>!H),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(wt,{size:18})}),_&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(Ht,{context:U,onClose:()=>v(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:m||u>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(u,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${m?"spin":u>60?"ready":""}`})})]})}function bs({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function vs(){const t=ye(),{notify:n}=ge(),{data:a}=de(),{setPreviousLocation:r}=me(),s=t.pathname,o=s==="/"||s==="/about",h=s==="/editor";N.useEffect(()=>{s==="/settings"||s==="/moderation"||s==="/profile"||s.startsWith("/profile/")||r(s)},[s,r]);const[j,u]=N.useState(null);N.useEffect(()=>{!a||!a.is_mod||(async()=>{try{const l=await $(q.admin.debugState,{requireAuth:!1}),k=Array.isArray(l==null?void 0:l.counts)?l.counts.find(C=>String(C.status)==="ready"):null;k&&u(Number(k.c)||0)}catch{}})()},[a]),N.useEffect(()=>{a&&!localStorage.getItem("welcomed")&&(n(`Welcome, ${a.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[a,n]),N.useEffect(()=>{if(typeof window>"u"||!ce()||s==="/editor")return;const k=document.querySelector(".page");k&&(k.scrollTop=0)},[s]);const{showMobileHeader:f,headerTitle:m}=N.useMemo(()=>{if(s==="/"||s==="/about"||s==="/editor"||s==="/discover"||s==="/mobile")return{showMobileHeader:!1,headerTitle:""};if(s==="/feed"||s.startsWith("/feed/"))return{showMobileHeader:!0,headerTitle:s==="/feed"?"Feed":"Post"};if(s==="/queues"||s.startsWith("/queues/"))return{showMobileHeader:!0,headerTitle:s==="/queues"?"Queues":"Queue"};if(s==="/submissions")return{showMobileHeader:!0,headerTitle:"Submissions"};if(s==="/notifications")return{showMobileHeader:!0,headerTitle:"Notifications"};if(s==="/profile"||s.startsWith("/profile/"))return{showMobileHeader:!0,headerTitle:"Profile"};if(s==="/settings")return{showMobileHeader:!0,headerTitle:"Settings"};if(s==="/moderation")return{showMobileHeader:!0,headerTitle:"Moderation"};if(s.startsWith("/mp/")||s.startsWith("/md/")){const l=s.split("/").filter(Boolean),k=l[1]||"";if(k==="feed")return{showMobileHeader:!0,headerTitle:l.length>2?"Post":"Feed"};if(k==="discover")return{showMobileHeader:!1,headerTitle:""};if(k==="queues")return{showMobileHeader:!0,headerTitle:l.length>2?"Queue":"Queues"}}return{showMobileHeader:!0,headerTitle:""}},[s]);return e.jsxs("div",{className:"app-shell",children:[e.jsx(os,{paused:s==="/editor"}),e.jsx(gs,{isNeutralPage:o,isEditor:h}),e.jsxs("main",{className:`page ${s==="/editor"||s==="/discover"?"fullscreen":""}`,children:[f&&e.jsx(xs,{title:m}),s==="/about"?e.jsx("div",{className:"card",children:e.jsx(De,{})}):e.jsx(De,{})]}),s!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(bs,{readyCount:j})}),s!=="/mobile"&&e.jsx(ls,{})]})}const ys="theme";function js(){try{const t=localStorage.getItem(ys);if(t==="light"||t==="dark")return t}catch{}return null}function it(t){if(!(typeof document>"u")){document.documentElement.setAttribute("data-theme",t);try{const n=document.querySelector('meta[name="theme-color"]');n&&(n.content=t==="light"?"#ffffff":"#1a1a1a")}catch{}}}function Ns(t="dark"){const n=js()||t;it(n)}function ws(){const{data:t,isLoading:n}=de(),a=!!t,r=we(),{lastSection:s}=me(),[o,h]=N.useState(!1);return N.useEffect(()=>{if(typeof window>"u")return;const j=localStorage.getItem("hide_mobile_install_prompt")==="1",u=ce()&&!Pe()&&!j;h(u)},[]),N.useEffect(()=>{Pe()?r("/feed",{replace:!0}):a&&r("/feed",{replace:!0})},[r,a]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
        }
        
        .landing-btn-secondary {
          background: var(--panel);
          color: var(--text);
          border: 1px solid var(--border);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: var(--border-strong);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsx("div",{className:"landing-actions landing-actions-desktop",children:e.jsx(V,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})}),!a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Ce+q.auth.login},disabled:n,children:n?"Checking…":"Login with osu!"})}),a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx(V,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})})]})]}),o&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{h(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(V,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}function Be(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}const ks=({open:t,onClose:n,videoId:a,initialDescription:r,initialBeatmapUrl:s,onSave:o})=>{const[h,j]=g.useState(r||""),[u,f]=g.useState(s||""),[m,l]=g.useState(null),[k,C]=g.useState(null),[_,v]=g.useState(""),[S,x]=g.useState(!1),R=g.useRef(0);g.useEffect(()=>{t&&(j(r||""),f(s||""),l(null),C(null),v(""))},[t,r,s]),g.useEffect(()=>{if(!t)return;R.current&&window.clearTimeout(R.current);const b=(u||"").trim();if(!b){v(""),l(null),C(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(b)){v(""),l(null),C(null);return}return R.current=window.setTimeout(async()=>{var F;try{let c;try{c=new URL(b)}catch{v("Invalid URL format");return}const U=c.hash.match(/#osu\/(\d+)/),H=U?U[1]:null;c.hash="";const M={url:c.toString()};H&&(M.beatmap_id=H);const E=await $(q.osu.resolveBeatmap+fe(M),{requireAuth:!1}),w=Array.isArray(E==null?void 0:E.diffs)?E.diffs:[];if(!w.length&&!E.setId){v("No difficulties found"),l(null),C(null);return}if(l({setId:Number(E.setId)||0,beatmapId:E.beatmapId??null,title:String(E.title||""),artist:String(E.artist||""),mapper:String(E.mapper||""),diffs:w}),w.length>0){const A=Number.isFinite(Number(E.beatmapId))?Number(E.beatmapId):Number((F=w[0])==null?void 0:F.id),y=w.find(K=>Number(K.id)===A)||w[0],B=Be(y==null?void 0:y.mode);C({beatmapId:Number(y==null?void 0:y.id)||null,version:String((y==null?void 0:y.version)||""),mode:B})}v("")}catch(c){v(`Failed to resolve: ${(c==null?void 0:c.message)||"Unknown error"}`),l(null),C(null)}},400),()=>{R.current&&window.clearTimeout(R.current)}},[u,t]);const O=async()=>{if(!S){x(!0);try{await $(q.videos.update(a),{method:"PATCH",body:JSON.stringify({description:h.slice(0,100),beatmap_url:u.trim()||void 0})});const b=!!u.trim();if(m||!b)try{await $(q.videos.update(a)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:b&&m&&m.setId>0?m.setId:null,beatmap_id:b&&(k!=null&&k.beatmapId)?k.beatmapId:null,beatmap_version:b&&(k!=null&&k.version)?k.version:null,beatmap_title:b&&(m!=null&&m.title)?m.title:null,beatmap_artist:b&&(m!=null&&m.artist)?m.artist:null,beatmap_mapper:b&&(m!=null&&m.mapper)?m.mapper:null,beatmap_url:b?u.trim():null})})}catch(F){console.warn("Failed to update beatmap metadata:",F)}o(h,u.trim()||null),n()}catch(b){alert((b==null?void 0:b.message)||"Failed to update post")}finally{x(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:b=>b.target===b.currentTarget&&n(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:n}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:n,"aria-label":"Close",children:e.jsx(Te,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:h,onChange:b=>j(b.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),m?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[m.artist," – ",m.title]}),e.jsxs("span",{className:"muted",children:["by ",m.mapper]})]}),e.jsx("select",{value:(k==null?void 0:k.beatmapId)??m.beatmapId??void 0,onChange:b=>{const Q=Number(b.target.value),F=(m==null?void 0:m.diffs.find(c=>Number(c.id)===Q))||null;if(F){const c=Be(F.mode);C({beatmapId:Q,version:F.version,mode:c})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"},children:m.diffs.map(b=>e.jsxs("option",{value:b.id,children:[b.version," (",b.mode,")"]},b.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{l(null),C(null),f("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:u,onChange:b=>f(b.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}}),_&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:_})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:n,disabled:S,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:O,disabled:S,children:S?"Saving...":"Save"})]})]})]})]}):null};function Oe(){const t=kt(),n=we(),{notify:a}=ge(),[r,s]=g.useState(null),[o,h]=g.useState(null),[j,u]=g.useState(""),[f,m]=g.useState([]),[l,k]=g.useState([]),[C,_]=g.useState([]),[v,S]=g.useState(""),[x,R]=g.useState(null),[O,b]=g.useState([]),[Q,F]=g.useState(null),[c,U]=g.useState(""),[H,T]=g.useState([]),[M,E]=g.useState(null),[w,A]=g.useState(!1),y=g.useMemo(()=>{const p=t.id?Number(t.id):null;return p?r?r.id===p:!1:!0},[t.id,r]);function B(p){const W=p.stream_uid||String(p.id),z=t.id?`/profile/${t.id}`:"/profile";n(`/feed/${W}`,{state:{returnTo:z}})}g.useEffect(()=>{(async()=>{try{const p=await $(q.auth.me,{requireAuth:!1});s(p),p&&Array.isArray(p.inspirations)&&b(p.inspirations)}catch(p){u((p==null?void 0:p.message)||"Not logged in")}})()},[]),g.useEffect(()=>{(async()=>{try{const p=t.id?Number(t.id):null;if(p){const W=await $(q.users.get(p),{requireAuth:!1});h(W),S(W.about||""),Array.isArray(W.inspirations)&&b(W.inspirations);const z=await $(q.users.videos(p)+fe({limit:"60"}),{requireAuth:!1});_(z.items||[]);const Y=await $(q.users.likes(p)+fe({limit:"60"}),{requireAuth:!1});k(Y.items||[])}else{if(!r)return;h(r),S(r.about||""),Array.isArray(r.inspirations)&&b(r.inspirations);const W=await $(q.users.myVideos+fe({limit:"50"}),{requireAuth:!1});m(W.items||[]);const z=await $(q.users.likes(r.id)+fe({limit:"60"}),{requireAuth:!1});k(z.items||[])}}catch{}})()},[t.id,r]),g.useEffect(()=>{A(!1)},[o==null?void 0:o.id]);async function K(p){try{const z=(await $(q.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:p})})).user||o;h(z),Array.isArray(z==null?void 0:z.inspirations)&&b(z.inspirations),t.id||s(z)}catch{}}return g.useEffect(()=>{let p;return Q!==null&&c.trim().length>=2?p=setTimeout(async()=>{try{const W=await $(q.osu.usersSearch(c),{requireAuth:!1});T(Array.isArray(W.items)?W.items:[])}catch{}},250):T([]),()=>{p&&clearTimeout(p)}},[c,Q]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:o?e.jsxs(e.Fragment,{children:[o.avatar_url&&e.jsx("img",{src:o.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[o.username,o.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${o.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:p=>p.currentTarget.style.opacity="1",onMouseLeave:p=>p.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",o.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!y&&O.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),O.map((p,W)=>y?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(p.id),onMouseLeave:()=>E(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const z=O.filter((Y,se)=>se!==W);b(z),K(z)},children:e.jsx("img",{src:p.avatar_url,alt:p.username})}),M===p.id&&e.jsxs("div",{className:"insp-tooltip",children:[p.username," — click to remove"]})]},p.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(p.id),onMouseLeave:()=>E(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${p.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:p.avatar_url,alt:p.username})}),M===p.id&&e.jsx("div",{className:"insp-tooltip",children:p.username})]},p.id)),y&&O.length<3&&new Array(3-O.length).fill(0).map((p,W)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(-W-1),onMouseLeave:()=>E(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{F(W),U(""),T([])},children:"+"}),M===-W-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),Q===W&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:c,onChange:z=>U(z.target.value)}),e.jsxs("div",{className:"insp-results",children:[H.length===0&&c.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),H.map(z=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(z.id)){a("Kinda based, but no.",{variant:"warn"}),F(null);return}if(O.some(se=>se.id===z.id)){F(null);return}const Y=[...O,{id:z.id,username:z.username,avatar_url:z.avatar_url}].slice(0,3);b(Y),F(null),K(Y)},children:[e.jsx("img",{src:z.avatar_url,alt:"avatar"}),e.jsx("span",{children:z.username})]},z.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>F(null),children:"Close"})]})]},`slot-${W}`))]}),y&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:j||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),y?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:v,onChange:p=>S(p.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const p=await $(q.auth.me,{method:"PATCH",body:JSON.stringify({about:v})});h(p.user||o),s(p.user||r)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(_e,{size:16})})]})}):(()=>{const p=((o==null?void 0:o.about)||"").trim()||"No bio.",W=p.length>200,z=W&&!w?p.slice(0,200)+"...":p;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:z}),W&&e.jsx("button",{onClick:()=>A(!w),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(_t,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Ge,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:p=>{const W=p.currentTarget.closest(".profile-tabs-unified");W.querySelectorAll(".profile-tab").forEach(Y=>{Y.classList.remove("active"),Y.setAttribute("aria-selected","false")}),p.currentTarget.classList.add("active"),p.currentTarget.setAttribute("aria-selected","true"),W.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:p=>{const W=p.currentTarget.closest(".profile-tabs-unified");W.querySelectorAll(".profile-tab").forEach(Y=>{Y.classList.remove("active"),Y.setAttribute("aria-selected","false")}),p.currentTarget.classList.add("active"),p.currentTarget.setAttribute("aria-selected","true"),W.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(y?f:C).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(y?f:C).map(p=>(y&&o?(o.id,o.username,o.avatar_url,o.is_admin,o.is_mod):p.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>B({...p}),children:[p.poster_url?e.jsx("img",{className:"recent-thumb",src:p.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Tt,{size:12}),e.jsx("span",{children:p.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ct,{size:12}),e.jsx("span",{children:p.comments_count??0})]})]})})]},p.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[l.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),l.map(p=>{var W,z;return e.jsxs("button",{className:"recent-cell",onClick:()=>B(p),children:[p.poster_url?e.jsx("img",{className:"recent-thumb",src:p.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((W=p.uploader)==null?void 0:W.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:p.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(z=p.uploader)==null?void 0:z.username})]})]},p.id)})]})})})]})]}),x&&e.jsx(ks,{open:!!x,onClose:()=>R(null),videoId:x.id,initialDescription:x.description,initialBeatmapUrl:x.beatmap_url,onSave:(p,W)=>{m(f.map(z=>z.id===x.id?{...z,description:p||null,beatmap_url:W}:z)),R(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: var(--hover-overlay); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid var(--divider); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed var(--divider); background: transparent; color: var(--text); font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: var(--border-strong); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid var(--divider);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid var(--divider); border-radius: 10px; padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel-dark); color: var(--text); outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: var(--text); cursor: pointer; text-align: left; }
        .insp-result:hover { background: var(--hover-overlay); border-color: var(--divider); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--divider); background: var(--hover-overlay); color: var(--text); cursor: pointer; }
      `})]})}function Ss(){var W,z,Y,se,xe,J,ee,ie,be,pe;const[t,n]=g.useState(null),[a,r]=g.useState([]),[s,o]=g.useState(""),[h,j]=g.useState([]),[u,f]=g.useState(null),[m,l]=g.useState([]),[k,C]=g.useState("all"),[_,v]=g.useState("approvals"),[S,x]=g.useState(null),[R,O]=g.useState(""),[b,Q]=g.useState(!1),{notify:F}=ge(),[c,U]=g.useState(null),[H,T]=g.useState(!1);g.useEffect(()=>{(async()=>{try{const i=await $(q.auth.me,{requireAuth:!1});if(n(i),i!=null&&i.is_admin)try{const I=await $(q.admin.settingsModeration,{requireAuth:!1});x(!!I.require_approval)}catch{}}catch{}try{const i=await $(q.admin.videosPending+fe({limit:"50"}),{requireAuth:!1});r(i.items||[])}catch{}})()},[]);async function M(){T(!0);try{const i=await $(q.admin.analytics,{requireAuth:!1});U(i)}finally{T(!1)}}async function E(){try{const i=await $(q.admin.usersSearch(s),{requireAuth:!1});j(i.items||[])}catch{}}async function w(i){f(i),l([]);try{const I=await $(q.admin.userVideos(i.id)+fe({limit:"50"}),{requireAuth:!1});l(I.items||[])}catch{}}async function A(i,I){try{const te=await $(q.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_mod:I})}),Z=(te==null?void 0:te.user)||{...i,is_mod:I};F(I?"Granted moderation":"Revoked moderation",{variant:I?"success":"warn"}),f(Z),j(h.map(ve=>ve.id===i.id?Z:ve))}catch{alert("Failed to update")}}const y=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),B=!!(t!=null&&t.is_admin);if(!y)return e.jsx("div",{className:"muted",style:{padding:20},children:"You do not have access."});const K=a.filter(i=>!i.flagged_only),p=a.filter(i=>!!i.flagged_only);return e.jsxs("div",{className:"moderation-container",children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:ce()?"nowrap":"wrap",gap:ce()?"2px":"4px",overflowX:ce()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":_==="approvals",className:`profile-tab ${_==="approvals"?"active":""}`,"data-tab":"approvals",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),v("approvals")},children:"Approvals"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":_==="manage",className:`profile-tab ${_==="manage"?"active":""}`,"data-tab":"manage",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),v("manage")},children:"Manage"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":_==="analytics",className:`profile-tab ${_==="analytics"?"active":""}`,"data-tab":"analytics",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),v("analytics"),c||M()},children:"Analytics"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":_==="message",className:`profile-tab ${_==="message"?"active":""}`,"data-tab":"message",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","message"),v("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":_,children:[e.jsx("div",{className:"panel approvals",hidden:_!=="approvals",children:e.jsxs("div",{className:"moderation-grid",style:{paddingTop:16},children:[e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Pending approvals"}),e.jsx("div",{className:"moderation-column-count",children:K.length})]}),K.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),K.map(i=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:e.jsx(Ne,{text:i.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.username}),i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(q.admin.videosReject(i.id),{method:"POST"}),r(a.filter(I=>I.id!==i.id)),F("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await $(q.admin.videosApprove(i.id),{method:"POST"}),r(a.filter(I=>I.id!==i.id)),F("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(q.videos.delete(i.id),{method:"DELETE"}),r(a.filter(I=>I.id!==i.id)),F("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))]}),e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Flagged (FYI)"}),e.jsx("div",{className:"moderation-column-count",children:p.length})]}),p.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),p.map(i=>e.jsxs("div",{className:"moderation-video-card flagged",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:e.jsx(Ne,{text:i.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.username}),e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"mod-card-actions",children:e.jsx("button",{className:"btn secondary compact",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(q.videos.delete(i.id),{method:"DELETE"}),r(a.filter(I=>I.id!==i.id)),F("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},i.id)),p.length>0&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:_!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:s,onChange:i=>o(i.target.value),onKeyDown:i=>{i.key==="Enter"&&E()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:E,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:h.map(i=>e.jsxs("button",{className:`moderation-user-result ${(u==null?void 0:u.id)===i.id?"selected":""}`,onClick:()=>w(i),children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),i.is_admin?e.jsx("span",{className:"chip info",children:"admin"}):i.is_mod?e.jsx("span",{className:"chip success",children:"mod"}):i.is_blacklisted?e.jsx("span",{className:"chip error",children:"blacklisted"}):null]},i.id))})})]}),u?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:24},children:[e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:64,height:64,style:{borderRadius:"50%",flexShrink:0,border:"2px solid var(--border)"}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"title",style:{fontSize:"24px"},children:u.username}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["id ",u.id," • osu ",u.osu_user_id]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[B&&!u.is_admin&&(u.is_mod?e.jsx("button",{className:"btn secondary compact",onClick:()=>A(u,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary compact",onClick:()=>A(u,!0),children:"Grant moderation"})),!u.is_admin&&(u.is_blacklisted?e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(q.admin.userUpdate(u.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),f({...u,is_blacklisted:!1}),F("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(q.admin.userUpdate(u.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),f({...u,is_blacklisted:!0}),F("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]})]})]}),e.jsxs("div",{className:"col",style:{gap:16},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:`btn compact ${k==="all"?"primary":"secondary"}`,onClick:()=>C("all"),children:"All"}),e.jsx("button",{className:`btn compact ${k==="review"?"primary":"secondary"}`,onClick:()=>C("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[m.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),e.jsx("div",{className:"col",style:{gap:12},children:m.filter(i=>{if(k==="all")return!0;const I=(S?!i.approved_at:!1)&&i.status==="ready",te=!!i.needs_review;return I||te}).map(i=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.status.toUpperCase()}),e.jsxs("span",{className:"muted",children:["• ",new Date(i.created_at*1e3).toLocaleDateString()]}),i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,S&&!i.approved_at&&i.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]}),e.jsxs("div",{className:"row",style:{gap:4,marginTop:4},children:[e.jsx("span",{style:{color:"var(--accent)",fontSize:14},children:"★"}),e.jsx("span",{className:"muted",style:{fontSize:13},children:i.likes_count??0})]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[(B||(t==null?void 0:t.is_mod))&&(!!i.needs_review||S&&!i.approved_at&&i.status==="ready")&&e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await $(q.admin.videosApprove(i.id),{method:"POST"}),l(m.map(I=>I.id===i.id?{...I,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:I)),F("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(q.videos.delete(i.id),{method:"DELETE"}),l(m.filter(I=>I.id!==i.id)),F("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))})]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center",border:"1px dashed var(--border)",borderRadius:"12px"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:_!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:s,onChange:i=>o(i.target.value),onKeyDown:i=>{i.key==="Enter"&&E()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:E,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:h.map(i=>e.jsxs("button",{className:`moderation-user-result ${(u==null?void 0:u.id)===i.id?"selected":""}`,onClick:()=>f(i),children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),(u==null?void 0:u.id)===i.id&&e.jsx("span",{className:"chip info",children:"selected"})]},i.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:i=>Q(i.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",fontFamily:"inherit"},value:R,onChange:i=>O(i.target.value)}),e.jsx("button",{className:"btn primary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const i=(R||"").trim();if(!i){alert("Enter a message");return}(async()=>{try{const I={text:i,global:b};!b&&(u!=null&&u.id)&&(I.user_id=u.id),await $(q.admin.notificationsSystem,{method:"POST",body:JSON.stringify(I)}),O(""),F("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:_!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Analytics"}),H&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!H&&!c&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(le,{label:"Users",value:c.totals.users_total}),e.jsx(le,{label:"Admins",value:c.totals.users_admin}),e.jsx(le,{label:"Mods",value:c.totals.users_mod}),e.jsx(le,{label:"Blacklisted",value:c.totals.users_blacklisted}),e.jsx(le,{label:"Videos",value:c.totals.videos_total}),e.jsx(le,{label:"Ready",value:c.totals.videos_ready}),e.jsx(le,{label:"Pending",value:c.totals.pending_count}),e.jsx(le,{label:"Purgatory",value:c.totals.purgatory_count}),e.jsx(le,{label:"Likes",value:c.totals.likes_total}),e.jsx(le,{label:"Flags",value:c.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Ae,{title:"New users (30d)",series:c.series.users,color:"#60a5fa"}),e.jsx(Ae,{title:"New videos (30d)",series:c.series.videos,color:"#34d399"}),(z=(W=c.stream)==null?void 0:W.graphql)!=null&&z.minutes_viewed?e.jsx(Ae,{title:"Minutes viewed (30d)",series:c.stream.graphql.minutes_viewed,color:"#f59e0b"}):e.jsxs("div",{className:"moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:ce()?13:14},children:"Minutes viewed (30d)"}),e.jsx("div",{className:"muted",style:{fontSize:ce()?11:12},children:"Data unavailable"})]}),e.jsxs("div",{className:"col",style:{padding:"24px",gap:12},children:[e.jsx("div",{className:"muted",style:{textAlign:"center",fontSize:14},children:"Minutes viewed data is not currently available."}),((se=(Y=c.stream)==null?void 0:Y.graphql)==null?void 0:se.errors)&&Array.isArray(c.stream.graphql.errors)&&c.stream.graphql.errors.length>0&&e.jsxs("div",{className:"col",style:{gap:8,padding:"12px",background:"var(--panel-dark)",borderRadius:8,border:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:600,color:"var(--danger)"},children:"Error details:"}),c.stream.graphql.errors.map((i,I)=>e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.5,fontFamily:"monospace"},children:typeof i=="string"?i:(i==null?void 0:i.message)||JSON.stringify(i)},I)),((J=(xe=c.stream)==null?void 0:xe.graphql)==null?void 0:J.raw)&&e.jsxs("div",{className:"col",style:{gap:4,marginTop:8,paddingTop:8,borderTop:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:11,fontWeight:600},children:"Debug info:"}),c.stream.graphql.raw.account_keys&&c.stream.graphql.raw.account_keys.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:10,fontFamily:"monospace"},children:["Available account fields: ",c.stream.graphql.raw.account_keys.join(", ")]}),c.stream.graphql.raw.response_sample&&e.jsxs("details",{style:{fontSize:10},children:[e.jsx("summary",{className:"muted",style:{cursor:"pointer",marginTop:4},children:"Response sample"}),e.jsx("pre",{style:{fontSize:9,overflow:"auto",maxHeight:"200px",marginTop:4,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:4},children:c.stream.graphql.raw.response_sample})]})]})]}),!((ee=c.stream)!=null&&ee.graphql)&&e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",padding:"8px",background:"var(--panel-dark)",borderRadius:8},children:"GraphQL API not configured. Set CF_GRAPHQL_API_TOKEN secret."})]})]})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",c.feed.count," items in rotation",c.feed.cursor?` • cursor ${c.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",c.stream.approximate.total_duration_sec," • ready videos: ",c.stream.approximate.videos_ready]}),c.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",c.stream.api.ok?"ok":"unavailable",(be=(ie=c.stream.api)==null?void 0:ie.result_info)!=null&&be.count?` • count ${c.stream.api.result_info.count}`:"",(pe=c.stream.api)!=null&&pe.sample_status?` • sample status ${String(c.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})}function le({label:t,value:n}){return e.jsxs("div",{className:"moderation-stat-card",children:[e.jsx("div",{className:"mod-stat-label",children:t}),e.jsx("div",{className:"mod-stat-value",children:n})]})}function Ae({title:t,series:n,color:a}){const[r,s]=g.useState(()=>ce()),o=N.useRef(null),[h,j]=g.useState(400);g.useEffect(()=>{const T=()=>{if(s(ce()),o.current){const E=o.current.offsetWidth-48;j(Math.max(300,E))}};T();let M=null;return o.current&&typeof ResizeObserver<"u"&&(M=new ResizeObserver(T),M.observe(o.current)),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T),M&&o.current&&M.unobserve(o.current)}},[]);const u=r?Math.min(400,Math.max(300,window.innerWidth-48)):Math.max(400,Math.min(1e3,h)),f=160,m=8,l=8,k=28,C=r?36:42,_=n.map(T=>T.count),v=Math.max(1,..._),S=g.useMemo(()=>{const T=v,M=Math.pow(10,Math.floor(Math.log10(T))),E=T/M;return(E<=1?1:E<=2?2:E<=5?5:10)*M},[v]),x=u-C-l,R=f-m-k,O=g.useMemo(()=>n.map((T,M)=>{const E=C+M/Math.max(1,n.length-1)*x,w=m+(1-T.count/(S||1))*R;return[E,w]}),[n,S,x,R]),b=g.useMemo(()=>O.map((T,M)=>M===0?`M ${T[0]} ${T[1]}`:`L ${T[0]} ${T[1]}`).join(" "),[O]),Q=[0,.25,.5,.75,1],F=g.useMemo(()=>{if(n.length===0)return[];const T=[0,.25,.5,.75,1].map(M=>Math.min(n.length-1,Math.round(M*(n.length-1))));return Array.from(new Set(T))},[n]),c=T=>{if(!T||T.length<10)return T||"";const M=T.slice(5,7).replace(/^0/,""),E=T.slice(8,10).replace(/^0/,"");return`${M}/${E}`};function U(T){const M=Number.isInteger(T);return T>=1e6?`${(T/1e6).toFixed(1).replace(/\.0$/,"")}M`:T>=1e3?`${(T/1e3).toFixed(1).replace(/\.0$/,"")}k`:M?String(T):T<10?T.toFixed(1):T.toFixed(1).replace(/\.0$/,"")}const H=n.length?n[n.length-1].count:0;return e.jsxs("div",{className:"moderation-chart-card",ref:o,children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:r?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:r?11:12},children:["latest: ",U(H)]})]}),e.jsx("div",{style:{width:"100%"},children:e.jsxs("svg",{width:u,height:f,role:"img","aria-label":t,style:{display:"block",width:`${u}px`,height:`${f}px`,maxWidth:"100%"},children:[e.jsx("rect",{x:0,y:0,width:u,height:f,rx:12,style:{fill:"var(--panel-dark)"}}),Q.map((T,M)=>{const E=m+(1-T)*R,w=T*S;return e.jsxs("g",{children:[e.jsx("line",{x1:C,y1:E,x2:u-l,y2:E,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:C-6,y:E+4,textAnchor:"end",fontSize:10,style:{fill:"var(--muted)"},children:U(w)})]},M)}),e.jsx("line",{x1:C,y1:m,x2:C,y2:m+R,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),e.jsx("line",{x1:C,y1:m+R,x2:C+x,y2:m+R,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),F.map((T,M)=>{var w;const E=C+T/Math.max(1,n.length-1)*x;return e.jsxs("g",{children:[e.jsx("line",{x1:E,y1:m,x2:E,y2:m+R,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:E,y:m+R+12,textAnchor:"middle",fontSize:10,style:{fill:"var(--muted)"},children:c((w=n[T])==null?void 0:w.day)})]},M)}),e.jsx("path",{d:b,fill:"none",stroke:a,strokeWidth:2}),O.length>0&&e.jsx("circle",{cx:O[O.length-1][0],cy:O[O.length-1][1],r:3,fill:a})]})})]})}function _s(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Ts(t){const n="=".repeat((4-t.length%4)%4),a=(t+n).replace(/-/g,"+").replace(/_/g,"/"),r=atob(a),s=new Uint8Array(r.length);for(let o=0;o<r.length;o++)s[o]=r.charCodeAt(o);return s}async function Se(){return!("serviceWorker"in navigator)||!("PushManager"in window)?null:(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function Cs(){try{const t=await fetch(`${Ce}/api/push/public_key`,{credentials:"include"});if(!t.ok)return null;const n=await t.json().catch(()=>null);return n&&typeof n.publicKey=="string"?n.publicKey:null}catch{return null}}async function Es(t){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)||await Notification.requestPermission()!=="granted")return!1;const a=await navigator.serviceWorker.ready;let r=await a.pushManager.getSubscription();r||(r=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ts(t)}));try{await $(q.user.pushSubscribe,{method:"POST",body:JSON.stringify({...r.toJSON(),ua:navigator.userAgent})})}catch{}return!0}async function Ms(){const t=await Se();if(!t)return!0;try{await $(q.user.pushUnsubscribe,{method:"POST",body:JSON.stringify({endpoint:t.endpoint})})}catch{}try{await t.unsubscribe()}catch{}return!0}function Ls(){const{theme:t,setTheme:n}=me(),{data:a}=de(),{notify:r}=ge(),[s,o]=N.useState("general"),[h,j]=N.useState(!1),[u,f]=N.useState(!1),[m,l]=N.useState(!1),[k,C]=N.useState(typeof Notification<"u"?Notification.permission:"default"),_=v=>{n(v),it(v)};return N.useEffect(()=>{j(typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),f(Pe()),Se().then(v=>l(!!v)).catch(()=>l(!1)),typeof Notification<"u"&&C(Notification.permission)},[]),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("div",{className:"settings-title",children:"Settings"}),e.jsx("div",{className:"settings-description",children:"Personalize appearance and app behavior."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Settings",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Settings tabs",children:[e.jsx("button",{role:"tab","aria-selected":s==="general",className:`profile-tab ${s==="general"?"active":""}`,"data-tab":"general",onClick:v=>{const S=v.currentTarget.closest(".profile-tabs-unified"),x=S==null?void 0:S.querySelector(".profile-tabs-content");x==null||x.setAttribute("data-active","general"),o("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":s==="notifications",className:`profile-tab ${s==="notifications"?"active":""}`,"data-tab":"notifications",onClick:v=>{const S=v.currentTarget.closest(".profile-tabs-unified"),x=S==null?void 0:S.querySelector(".profile-tabs-content");x==null||x.setAttribute("data-active","notifications"),o("notifications")},children:"Notifications"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":s,children:[e.jsx("div",{className:"panel general",hidden:s!=="general",children:e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Appearance"}),e.jsx("span",{className:"settings-section-desc",children:"Customize how the app looks on this device."})]}),e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Theme"}),e.jsx("span",{className:"settings-sublabel",children:"Select your preferred color scheme"})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("div",{className:"theme-toggle-group",role:"group","aria-label":"Theme selection",children:[e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="dark"?"active":""}`,"aria-pressed":t==="dark",onClick:()=>_("dark"),children:"Dark"}),e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="light"?"active":""}`,"aria-pressed":t==="light",onClick:()=>_("light"),children:"Light"})]})})]})]})}),e.jsx("div",{className:"panel notifications",hidden:s!=="notifications",children:e.jsxs("div",{className:"col",style:{gap:24},children:[e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Push Notifications"}),e.jsx("span",{className:"settings-section-desc",children:"Manage push alerts for this device."})]}),!h&&e.jsx("div",{className:"settings-hint",children:"Push notifications are not supported on this device."}),h&&e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Push Alerts"}),e.jsx("span",{className:"settings-sublabel",children:k==="granted"&&m?"Enabled on this device":"Disabled on this device"}),!u&&e.jsx("div",{className:"settings-hint",style:{marginTop:4},children:"On iOS, install the app to your Home Screen to enable push."})]}),e.jsx("div",{className:"settings-action",children:k!=="granted"||!m?e.jsx("button",{className:"btn primary compact",onClick:async()=>{const v=await Cs();if(!v)return;await Es(v),C(typeof Notification<"u"?Notification.permission:"default");const S=await Se();l(!!S)},title:u?void 0:"On iOS, install as PWA to enable",children:"Enable"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{await Ms();const v=await Se();l(!!v),C(typeof Notification<"u"?Notification.permission:"default")},children:"Disable"})})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Preferences"}),e.jsx("span",{className:"settings-section-desc",children:"Choose which activities trigger notifications."})]}),e.jsx(As,{})]})]})})]})]})]})}function As(){const{notify:t}=ge(),[n,a]=N.useState(!0),[r,s]=N.useState(!1),[o,h]=N.useState({star:!0,likes5:!0,comment:!0,inspiration:!0,reaction:!0,system:!0,invites:!0});N.useEffect(()=>{(async()=>{a(!0);try{const m=await $(q.user.notifPrefs,{requireAuth:!0});m&&m.prefs&&h(l=>({...l,...m.prefs}))}finally{a(!1)}})()},[]);async function j(m){s(!0);try{await $(q.user.notifPrefs,{method:"POST",body:JSON.stringify(m)}),t("Preferences saved",{variant:"success"})}catch(l){t((l==null?void 0:l.message)||"Failed to save",{variant:"error"})}finally{s(!1)}}function u(m){const l={...o,[m]:!o[m]};h(l),j(l)}const f=({k:m,label:l,desc:k})=>e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:l}),k&&e.jsx("span",{className:"settings-sublabel",children:k})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("label",{className:"settings-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:o[m],onChange:()=>u(m),"aria-label":`Toggle ${l}`}),e.jsx("span",{className:"settings-toggle-slider"})]})})]});return n?e.jsx("div",{className:"settings-hint",children:"Loading preferences…"}):e.jsxs(e.Fragment,{children:[e.jsx(f,{k:"star",label:"Stars",desc:"When someone stars your map"}),e.jsx(f,{k:"likes5",label:"Likes milestone",desc:"When you reach 5+ likes"}),e.jsx(f,{k:"comment",label:"Comments",desc:"When someone comments on your post"}),e.jsx(f,{k:"inspiration",label:"Inspirations",desc:"When someone is inspired by you"}),e.jsx(f,{k:"reaction",label:"Reactions",desc:"When someone reacts to your comment"}),e.jsx(f,{k:"invites",label:"Queue invitations",desc:"When you are invited to a queue"}),e.jsx(f,{k:"system",label:"System messages",desc:"Important announcements"}),r&&e.jsx("div",{className:"settings-hint",style:{marginTop:8},children:"Saving…"})]})}const Ps=()=>(g.useEffect(()=>()=>{Xt.clearAll()},[]),e.jsx(Zt,{}));function Is(){const[t,n]=N.useState({mobile:!1,standalone:!1,platform:""}),[a,r]=N.useState("ios");return N.useEffect(()=>{const s=typeof navigator<"u"&&navigator.userAgent||"",o=/iPad|iPhone|iPod/i.test(s)||/(Macintosh).*Mobile/.test(s),h=/Android/i.test(s),j=o?"ios":h?"android":"other";n({mobile:ce(),standalone:!1,platform:j}),r(j==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":a==="ios",className:`profile-tab ${a==="ios"?"active":""}`,"data-tab":"ios",onClick:s=>{const o=s.currentTarget.closest(".profile-tabs-unified");o.querySelectorAll(".profile-tab").forEach(j=>{j.classList.remove("active"),j.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),o.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),r("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":a==="android",className:`profile-tab ${a==="android"?"active":""}`,"data-tab":"android",onClick:s=>{const o=s.currentTarget.closest(".profile-tabs-unified");o.querySelectorAll(".profile-tab").forEach(j=>{j.classList.remove("active"),j.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),o.querySelector(".profile-tabs-content").setAttribute("data-active","android"),r("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":a,children:[e.jsx("div",{className:"panel",hidden:a!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:a!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const He={standard:at,taiko:et,mania:tt,catch:st},Qe={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},zs=({value:t,onChange:n})=>{const[a,r]=g.useState(!1),s=g.useRef(null);g.useEffect(()=>{if(!a)return;const h=u=>{s.current&&!s.current.contains(u.target)&&r(!1)},j=u=>{u.key==="Escape"&&r(!1)};return document.addEventListener("mousedown",h),document.addEventListener("keydown",j),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("keydown",j)}},[a]);const o=h=>e.jsxs("button",{className:`mode-option${h===t?" selected":""}`,onClick:()=>{n(h),r(!1)},role:"option","aria-selected":h===t,children:[e.jsx("img",{className:"mode-icon",src:He[h],width:24,height:24,alt:""}),e.jsx("span",{children:Qe[h]})]},h);return e.jsxs("div",{className:"mode-select",ref:s,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":a,onClick:()=>r(h=>!h),children:[e.jsx("img",{className:"mode-icon",src:He[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:Qe[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),a&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(o)})]})};function Ke(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}function Rs({section:t,onUpload:n,onPost:a}){const{notify:r}=ge(),{data:s}=de(),[o,h]=g.useState(""),[j,u]=g.useState(""),[f,m]=g.useState(null),[l,k]=g.useState(null),[C,_]=g.useState(!1),[v,S]=g.useState(""),x=g.useRef(0),[R,O]=g.useState("standard"),[b,Q]=g.useState(null),[F,c]=g.useState(0),[U,H]=g.useState(""),[T,M]=g.useState(""),[E,w]=g.useState(""),[A,y]=g.useState(""),[B,K]=g.useState(null),[p,W]=g.useState(!1),[z,Y]=g.useState(null),se=100*1024*1024,xe=g.useMemo(()=>b?`${b.name}:${b.size}:${b.lastModified}`:null,[b]),[J,ee]=g.useState(!1),[ie,be]=g.useState([]),pe=g.useRef(null),i=g.useRef(null);g.useEffect(()=>{const d=o.match(/https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\/[^\s]+/);d&&d[0]!==j?u(d[0]):!d&&j&&(u(""),m(null),k(null))},[o,j]),g.useEffect(()=>{x.current&&window.clearTimeout(x.current);const d=(j||"").trim();if(!d){S(""),m(null),k(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(d)){S(""),m(null),k(null);return}return x.current=window.setTimeout(async()=>{var D;try{let P;try{P=new URL(d)}catch{S("Invalid URL format");return}const ae=P.hash.match(/#osu\/(\d+)/),X=ae?ae[1]:null;P.hash="";const ze={url:P.toString()};X&&(ze.beatmap_id=X);const re=await $(q.osu.resolveBeatmap+fe(ze),{requireAuth:!1}),je=Array.isArray(re==null?void 0:re.diffs)?re.diffs:[];if(!je.length&&!re.setId){S("No difficulties found"),m(null),k(null);return}if(m({setId:Number(re.setId)||0,beatmapId:re.beatmapId??null,title:String(re.title||""),artist:String(re.artist||""),mapper:String(re.mapper||""),diffs:je}),je.length>0){const nt=Number.isFinite(Number(re.beatmapId))?Number(re.beatmapId):Number((D=je[0])==null?void 0:D.id),ue=je.find(rt=>Number(rt.id)===nt)||je[0],Re=Ke(ue==null?void 0:ue.mode);k({beatmapId:Number(ue==null?void 0:ue.id)||null,version:String((ue==null?void 0:ue.version)||""),mode:Re}),O(Re)}else k(null);S("")}catch(P){const ae=(P==null?void 0:P.message)||"Unknown error";S(`Failed to resolve: ${ae}`),m(null),k(null)}},400),()=>{x.current&&window.clearTimeout(x.current)}},[j]);const I=o.replace(/https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\/[^\s]+/g,"").trim(),te=d=>{var P;const L=((P=d.target.files)==null?void 0:P[0])||null;if(Q(L),K(null),L&&L.size>se?w("File exceeds 100MB limit"):w(""),L)try{const ae=URL.createObjectURL(L),X=document.createElement("video");X.preload="metadata",X.src=ae,X.onloadedmetadata=()=>{URL.revokeObjectURL(ae);const ne=Number.isFinite(X.duration)?X.duration:NaN;Number.isFinite(ne)&&K(ne),Number.isFinite(ne)&&ne>60.5?y("Clip exceeds 60s limit"):y("")},X.onerror=()=>{URL.revokeObjectURL(ae),K(null)}}catch{K(null)}else y("");const D=L?`${L.name}:${L.size}:${L.lastModified}`:null;D&&D!==z&&W(!1)};async function Z(){return M("info"),H("Requesting upload URL..."),await $(q.uploads.new,{method:"POST",body:JSON.stringify({description:I.slice(0,100),beatmap_url:j||void 0,size_bytes:(b==null?void 0:b.size)??void 0,mode:R,beatmapset_id:(f==null?void 0:f.setId)??void 0,beatmap_id:(l==null?void 0:l.beatmapId)??void 0,beatmap_version:(l==null?void 0:l.version)??void 0,beatmap_title:f?`${f.title}`:void 0,beatmap_artist:f?`${f.artist}`:void 0,beatmap_mapper:f?`${f.mapper}`:void 0})})}async function ve(d,L,D="form"){await new Promise((P,ae)=>{const X=new XMLHttpRequest;if(X.open("POST",d),X.upload.onprogress=ne=>{ne.lengthComputable&&c(Math.round(ne.loaded/ne.total*100))},X.onload=()=>X.status>=200&&X.status<300?P():ae(new Error(`Upload failed (${X.status}) ${X.responseText||""}`)),X.onerror=()=>ae(new Error("Network error")),D==="form"){const ne=new FormData;ne.append("file",L,L.name),X.send(ne)}else X.setRequestHeader("Content-Type","application/octet-stream"),X.send(L)})}async function Ee(){if(b){if(b.size>se){w("File exceeds 100MB limit");return}if(typeof B=="number"&&B>60.5){y("Clip exceeds 60s limit");return}xe&&(W(!0),Y(xe)),c(0),M("info"),ee(!0);try{const d=await Z();let L=d.streamUID;try{H("Uploading..."),await ve(d.uploadURL,b,"form")}catch(D){M("warn"),H(`Retrying upload... (${(D==null?void 0:D.message)||D})`);const P=await Z();L=P.streamUID,await ve(P.uploadURL,b,"binary")}M("info"),H("Processing...");for(let D=0;D<60;D++){await new Promise(P=>setTimeout(P,3e3));try{if((await $(q.videos.get(L),{requireAuth:!1})).status==="ready"){M("success"),H("Ready!"),r("Upload complete!",{variant:"success"}),Q(null),h(""),u(""),m(null),k(null),O("standard"),c(0),w(""),y(""),K(null),W(!1),Y(null),H(""),n&&n();break}}catch{}}}catch(d){M("error"),H(d.message||"Error"),r(d.message||"Upload failed",{variant:"error"})}finally{ee(!1)}}}const Me=async()=>{if(!I.trim()){r("Text is required",{variant:"error"});return}if(I.length>200){r("Text must be 200 characters or less",{variant:"error"});return}ee(!0);try{const d=await $(q.moddi.posts,{method:"POST",body:JSON.stringify({text:I,beatmap_url:j.trim()||void 0,beatmapset_id:(f==null?void 0:f.setId)??void 0,beatmap_id:(l==null?void 0:l.beatmapId)??(f==null?void 0:f.beatmapId)??void 0,beatmap_version:(l==null?void 0:l.version)??void 0,tags:ie.length>0?ie.join(","):void 0})});if(d){const L=d==null?void 0:d.post;L?(!L.uid&&L.id&&(L.uid=String(L.id)),a&&a(L)):a&&a(),r("Post created!",{variant:"success"}),h(""),u(""),m(null),k(null),S(""),be([])}}catch{r("Failed to create post",{variant:"error"})}finally{ee(!1)}},ke=b?!E&&!A&&!p&&!J:I.trim().length>0&&I.length<=200&&!J;return e.jsxs("div",{className:"compose-twitter",style:{background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",padding:"12px 16px"},children:[e.jsxs("div",{style:{display:"flex",gap:12},children:[s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",style:{width:40,height:40,borderRadius:"50%",flexShrink:0,objectFit:"cover"}}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("textarea",{ref:pe,placeholder:"What's happening?",value:o,onChange:d=>h(d.target.value),maxLength:500,style:{width:"100%",background:"transparent",border:"none",padding:"8px 0",color:"var(--text)",fontFamily:"inherit",fontSize:18,resize:"none",minHeight:52,outline:"none",lineHeight:1.4},rows:1,onInput:d=>{const L=d.target;L.style.height="auto",L.style.height=L.scrollHeight+"px"}}),f&&e.jsxs("div",{style:{marginTop:8,padding:"10px 12px",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,display:"flex",alignItems:"center",gap:10},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500},children:[f.artist," – ",f.title]}),e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:2},children:["Mapped by ",f.mapper]})]}),f.diffs.length>0&&e.jsx("select",{value:(l==null?void 0:l.beatmapId)??f.beatmapId??void 0,onChange:d=>{const L=Number(d.target.value),D=(f==null?void 0:f.diffs.find(P=>Number(P.id)===L))||null;if(D){const P=Ke(D.mode);k({beatmapId:L,version:D.version,mode:P}),O(P)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,padding:"4px 8px",fontSize:11},children:f.diffs.map(d=>e.jsx("option",{value:d.id,children:d.version},d.id))}),e.jsx("button",{type:"button",onClick:()=>{h(o.replace(/https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\/[^\s]+/g,"").trim()),m(null),k(null),u("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:16,padding:4},children:e.jsx(Te,{size:14})})]}),v&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:v}),b&&e.jsxs("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.2)",borderRadius:8,display:"flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx(Ue,{size:16}),e.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:b.name}),e.jsxs("span",{className:"muted",children:[(b.size/1024/1024).toFixed(1),"MB",B&&e.jsxs("span",{children:[" • ",Math.round(B),"s"]})]}),e.jsx("button",{type:"button",onClick:()=>{Q(null),w(""),y("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:14,padding:2},children:e.jsx(Te,{size:14})})]}),E&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:E}),A&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:A}),(F>0||U)&&e.jsxs("div",{style:{marginTop:8},children:[U&&e.jsx("div",{className:`chip ${T||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:U}),F>0&&e.jsx("div",{style:{marginTop:6,height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.min(100,Math.max(0,F))}%`,height:"100%",background:"#667eea",borderRadius:2,transition:"width 0.2s"}})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{type:"button",disabled:!0,style:{background:"transparent",border:"none",padding:8,cursor:"not-allowed",opacity:.4,color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center"},title:"Image upload (coming soon)",children:e.jsx(Et,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{var d;return(d=i.current)==null?void 0:d.click()},style:{background:b?"rgba(102, 126, 234, 0.15)":"transparent",border:"none",padding:8,cursor:"pointer",color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},title:"Add video clip (max 60s, 100MB)",children:e.jsx(Ue,{size:20})}),e.jsx("input",{ref:i,type:"file",accept:"video/*",onChange:te,style:{display:"none"}}),b&&e.jsx("div",{style:{marginLeft:8},children:e.jsx(zs,{value:R,onChange:O})}),e.jsxs("span",{className:"muted",style:{fontSize:11,marginLeft:12},children:[I.length,"/",b?100:200]})]}),e.jsx("button",{type:"button",onClick:b?Ee:Me,disabled:!ke,style:{background:ke?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:999,padding:"8px 18px",color:"#fff",fontWeight:600,fontSize:14,cursor:ke?"pointer":"not-allowed",transition:"all 0.15s"},children:J?"Posting...":"Post"})]})]})]}),C&&f&&e.jsx(es,{open:C,onClose:()=>_(!1),downloadUrl:q.osu.downloadBeatmapset(f.setId),beatmapId:(l==null?void 0:l.beatmapId)??f.beatmapId??void 0,beatmapVersion:l==null?void 0:l.version})]})}function Fs(){const{data:t}=de(),{modeFilters:n}=me(),a=Object.entries(n).filter(([s,o])=>o).map(([s])=>s),r=a.length?a.join(","):"standard";return Ve({queryKey:["mappi","feed",r],queryFn:async({pageParam:s=0})=>{const o=new URLSearchParams({limit:"20",offset:String(s),modes:r}),h=`${q.feed.recent}?${o.toString()}`;return await $(h)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,o)=>{var u;const h=o.reduce((f,m)=>{var l;return f+(((l=m.items)==null?void 0:l.length)||0)},0);return(((u=s.items)==null?void 0:u.length)||0)===20?h:void 0}})}function Ws(){const{data:t}=de(),{tagFilters:n}=me();return Ve({queryKey:["moddi","feed",n],queryFn:async({pageParam:a=0})=>{const r=new URLSearchParams({limit:"20",offset:String(a)}),s=`${q.moddi.posts}?${r.toString()}`;return await $(s)},enabled:!!t,initialPageParam:0,getNextPageParam:(a,r)=>{var h;const s=r.reduce((j,u)=>{var f;return j+(((f=u.items)==null?void 0:f.length)||0)},0);return(((h=a.items)==null?void 0:h.length)||0)===20?s:void 0}})}function qs(){const t=ye(),n=Mt(),{data:a}=de(),{modeFilters:r,tagFilters:s}=me(),{data:o,fetchNextPage:h,hasNextPage:j,isFetching:u,isFetchingNextPage:f,refetch:m}=Fs(),{data:l,fetchNextPage:k,hasNextPage:C,isFetching:_,isFetchingNextPage:v,refetch:S}=Ws(),x=g.useMemo(()=>(o==null?void 0:o.pages.flatMap(w=>w.items||[]))||[],[o]),R=g.useMemo(()=>l!=null&&l.pages?l.pages.flatMap(w=>(w.items||[]).map(y=>({...y,user_id:y.user_id??0,username:y.username||"Unknown",avatar_url:y.avatar_url||null,text:y.text??null,uid:y.uid||String(y.id||""),reactions_count:Number(y.reactions_count??0),reacted_by_me:y.reacted_by_me??!1,comments_count:Number(y.comments_count??0),_type:"moddi"}))):[],[l]),O=g.useMemo(()=>{const A=[...x.map(y=>({...y,_type:"mappi"})),...R];return A.sort((y,B)=>{const K=y.created_at||0;return(B.created_at||0)-K}),A},[x,R]),b=g.useMemo(()=>O.filter(w=>{if(w._type==="mappi"){const A=Object.entries(r).filter(([K,p])=>p).map(([K])=>K.toLowerCase());if(A.length===0)return!0;const y=new Set(A),B=String(w.mode||"standard").toLowerCase();return y.has(B)}else{const A=w.tags?typeof w.tags=="string"?w.tags.split(",").map(K=>K.trim()):[]:[],y=!A.length,B=A.includes("help");return s.untagged&&s.help?!0:s.untagged&&!s.help?y:!s.untagged&&s.help?B:!0}}),[O,r,s]);g.useEffect(()=>{t.pathname==="/feed"&&(m(),S())},[t.pathname,m,S]);const Q=w=>{n.setQueryData(["mappi","feed"],A=>A&&{...A,pages:A.pages.map(y=>({...y,items:y.items.map(B=>B.id===w.id?w:B)}))})},F=w=>{n.setQueryData(["moddi","feed"],A=>A&&{...A,pages:A.pages.map(y=>({...y,items:y.items.map(B=>B.id===w.id?w:B)}))})},c=w=>{n.setQueryData(["mappi","feed"],A=>A&&{...A,pages:A.pages.map(y=>({...y,items:y.items.filter(B=>B.id!==w)}))}),n.setQueryData(["moddi","feed"],A=>A&&{...A,pages:A.pages.map(y=>({...y,items:y.items.filter(B=>B.id!==w)}))})},U=()=>{m()},H=w=>{w&&n.setQueryData(["moddi","feed"],A=>{if(!A)return A;const y={...w,user_id:w.user_id??0,username:w.username||"Unknown",avatar_url:w.avatar_url||null,text:w.text??null,uid:w.uid||String(w.id||""),reactions_count:Number(w.reactions_count??0),reacted_by_me:w.reacted_by_me??!1,comments_count:Number(w.comments_count??0)};return{...A,pages:A.pages.map((B,K)=>K===0?{...B,items:[y,...B.items||[]]}:B)}}),n.invalidateQueries({queryKey:["moddi","feed"]}),S()},T=u&&!f||_&&!v,M=j||C,E=()=>{j&&h(),C&&k()};return e.jsxs("div",{className:"feed-container unified-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto"},children:[e.jsx(Rs,{section:"mappi",onUpload:U,onPost:H}),e.jsx(Qt,{context:"unified-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[b.length===0&&!T&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to share something!"}),b.map(w=>e.jsx(Rt,{post:w,section:w._type,onUpdate:w._type==="mappi"?Q:F,onDelete:c,me:a},`${w._type}-${w.id}`)),b.length>0&&M&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:E,disabled:f||v,children:f||v?"Loading...":"Load more"})})]})})]})}const Ds=N.lazy(()=>as(()=>import("./Discover-DXZ_DknC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));Ns("dark");Ft();"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t=encodeURIComponent(Ce);navigator.serviceWorker.register(`/sw.js?api=${t}`).then(n=>{console.log("Service Worker registered successfully:",n.scope)}).catch(n=>{console.error("Service Worker registration failed:",n)})});const Us=()=>e.jsx(It,{children:e.jsxs(G,{element:e.jsx(vs,{}),children:[e.jsx(G,{path:"/",element:e.jsx(ws,{})}),e.jsx(G,{path:"/feed",element:e.jsx(qs,{})}),e.jsx(G,{path:"/feed/:uid",element:e.jsx(qt,{})}),e.jsx(G,{path:"/discover",element:e.jsx(g.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(Ds,{})})}),e.jsx(G,{path:"/queues",element:e.jsx(Kt,{})}),e.jsx(G,{path:"/queues/:id",element:e.jsx(Jt,{})}),e.jsx(G,{path:"/submissions",element:e.jsx(Gt,{})}),e.jsx(G,{path:"/mp/feed",element:e.jsx(he,{to:"/feed",replace:!0})}),e.jsx(G,{path:"/mp/feed/:uid",element:e.jsx(he,{to:"/feed/:uid",replace:!0})}),e.jsx(G,{path:"/mp/discover",element:e.jsx(he,{to:"/discover",replace:!0})}),e.jsx(G,{path:"/md/feed",element:e.jsx(he,{to:"/feed",replace:!0})}),e.jsx(G,{path:"/md/feed/:uid",element:e.jsx(he,{to:"/feed/:uid",replace:!0})}),e.jsx(G,{path:"/md/queues",element:e.jsx(he,{to:"/queues",replace:!0})}),e.jsx(G,{path:"/md/queues/:id",element:e.jsx(he,{to:"/queues/:id",replace:!0})}),e.jsx(G,{path:"/md/submissions",element:e.jsx(he,{to:"/submissions",replace:!0})}),e.jsx(G,{path:"/notifications",element:e.jsx(Vt,{})}),e.jsx(G,{path:"/profile",element:e.jsx(Oe,{})}),e.jsx(G,{path:"/profile/:id",element:e.jsx(Oe,{})}),e.jsx(G,{path:"/moderation",element:e.jsx(Ss,{})}),e.jsx(G,{path:"/about",element:e.jsx(_s,{})}),e.jsx(G,{path:"/settings",element:e.jsx(Ls,{})}),e.jsx(G,{path:"/mobile",element:e.jsx(Is,{})}),e.jsx(G,{path:"/editor",element:e.jsx(Ps,{})})]})}),$s=()=>e.jsx(Pt,{children:e.jsx(Us,{})});Lt(document.getElementById("root")).render(e.jsx(ns,{children:e.jsx(At,{client:is,children:e.jsx(Wt,{children:e.jsx($s,{})})})}));export{os as B,as as _};
