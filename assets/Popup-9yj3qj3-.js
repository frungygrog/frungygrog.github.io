import{r as i,j as o,Z as H}from"./vendor-react-_vsaDC62.js";import{H as h}from"./vendor-DBgzFpze.js";const T=({playbackUrl:s,streamUID:c,aspectRatio:r,preferNative:l=!1,autoplay:d=!1,loop:E=!1,muted:w=!1,controls:m=!0,onVideoRef:u,onClick:g})=>{const[t,a]=i.useState(1.7777777777777777),v=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches;i.useEffect(()=>{if(!v)return;const e=()=>a(window.innerWidth/Math.max(1,window.innerHeight));return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[v]);const x=i.useRef(null),R=`${i.useMemo(()=>{const e=1.3333333333333333,p=16/9,L=typeof r=="number"&&isFinite(r)&&r>0?r:null;if(L)return Math.min(p,Math.max(e,L));const S=v?t:16/9;return Math.min(p,Math.max(e,S))},[v,t,r])} / 1`,f=i.useMemo(()=>l?s||(c?`https://videodelivery.net/${c}/manifest/video.m3u8`:null):null,[l,s,c]);i.useEffect(()=>{if(!l||!f)return;let e=null,p=null;const S=setTimeout(()=>{const n=x.current;n&&(n.canPlayType("application/vnd.apple.mpegurl")?(n.src=f,p=()=>{console.warn("Native HLS playback failed")},n.addEventListener("error",p),d&&n.play().catch(y=>{console.debug("Autoplay prevented:",y)})):h.isSupported()?(e=new h({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90}),e.loadSource(f),e.attachMedia(n),e.on(h.Events.MANIFEST_PARSED,()=>{d&&n.play().catch(y=>{console.debug("Autoplay prevented:",y)})}),e.on(h.Events.ERROR,(y,M)=>{if(M.fatal)switch(M.type){case h.ErrorTypes.NETWORK_ERROR:console.warn("HLS network error, trying to recover..."),e==null||e.startLoad();break;case h.ErrorTypes.MEDIA_ERROR:console.warn("HLS media error, trying to recover..."),e==null||e.recoverMediaError();break;default:console.error("HLS fatal error:",M),e==null||e.destroy(),e=null;break}})):console.error("HLS is not supported in this browser"))},0);return()=>{clearTimeout(S);const n=x.current;e&&(e.destroy(),e=null),n&&(p&&n.removeEventListener("error",p),n.src="")}},[l,f,d]),i.useEffect(()=>{u&&u(x.current)},[u,l,f]);const j="100%",b=v?{width:"100%",maxWidth:j,maxHeight:"100%",aspectRatio:R,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"}:{width:"auto",maxWidth:j,maxHeight:"100%",height:"var(--player-height)",aspectRatio:R,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"};if(l&&f)return o.jsx("div",{style:b,children:o.jsx("video",{ref:x,autoPlay:d,loop:E,muted:w,controls:m,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:g?"pointer":"default"},children:"Your browser does not support the video tag."},f)});if(c){const e=`https://iframe.videodelivery.net/${c}`;return o.jsx(o.Fragment,{children:o.jsx("div",{style:b,children:o.jsx("iframe",{src:e,title:"Clip",allow:"autoplay; encrypted-media; picture-in-picture; fullscreen",allowFullScreen:!0,style:{flex:1,width:"100%",height:"100%",border:0}},c)})})}return s?o.jsx("div",{style:b,children:o.jsx("video",{controls:!0,style:{width:"100%",height:"100%"},poster:void 0,children:o.jsx("source",{src:s,type:"application/x-mpegURL"})})}):o.jsx("div",{children:"No video"})},A=({open:s,onClose:c,buttonRef:r,children:l,align:d="right",minWidth:E=160})=>{const[w,m]=i.useState(null),u=i.useRef(null);if(i.useEffect(()=>{if(!s||!r.current){m(null);return}const t=()=>{if(!r.current)return;const a=r.current.getBoundingClientRect();m({top:a.bottom+8,[d]:window.innerWidth-a[d==="right"?"right":"left"]})};return t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[s,r,d]),i.useEffect(()=>{if(!s)return;const t=a=>{u.current&&!u.current.contains(a.target)&&r.current&&!r.current.contains(a.target)&&c()};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[s,c,r]),!s||!w)return null;const g=o.jsx("div",{ref:u,style:{position:"fixed",top:w.top,[d]:w[d],background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:E,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:l});return H.createPortal(g,document.body)};export{T as P,A as a};
