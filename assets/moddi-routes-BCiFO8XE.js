import{r as l,j as e,d as Mt,u as ye,e as ve,f as Ne,g as Te,h as pe,i as et,k as tt,l as st,m as be,n as he,R as re,o as xe,p as Ft,q as Lt,s as gt,L as Ce,t as Et,v as Bt,w as ft,x as fe,y as bt,z as nt,A as At,M as Dt,B as rt,C as at,D as it,E as ot,G as lt,H as dt,c as Wt,I as Pt}from"./vendor-react-MN-buO7Z.js";import{B as Ot}from"./editor-CLI2Ah_r.js";function ht(){if(typeof window>"u")return!1;try{const t=navigator.userAgentData;if(t&&typeof t.mobile=="boolean"&&t.mobile||window.matchMedia&&(window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(hover: none)").matches))return!0;const s=navigator.userAgent||"";if(/Android|iPhone|iPad|iPod|Mobile|Silk|Kindle|Opera Mini|IEMobile|WPDesktop/i.test(s))return!0}catch{}return!1}function ms(){var u;if(typeof window>"u"||typeof document>"u")return()=>{};const t=()=>{const i=ht();document.documentElement.classList.toggle("is-mobile",i),document.documentElement.setAttribute("data-mobile",i?"true":"false")};t();const s=["(pointer: coarse)","(hover: none)","(orientation: landscape)","(orientation: portrait)"],r=[];try{for(const i of s)if(window.matchMedia){const d=window.matchMedia(i);(u=d.addEventListener)==null||u.call(d,"change",t),r.push(d)}}catch{}return window.addEventListener("resize",t),()=>{try{r.forEach(i=>{var d;return(d=i.removeEventListener)==null?void 0:d.call(i,"change",t)}),window.removeEventListener("resize",t)}catch{}}}function gs(){if(typeof window>"u")return!1;try{const t=navigator.standalone===!0,s=window.matchMedia&&window.matchMedia("(display-mode: standalone)"),r=!!(s&&s.matches),u=window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)"),i=window.matchMedia&&window.matchMedia("(display-mode: fullscreen)");return t||r||!!(u&&u.matches)||!!(i&&i.matches)}catch{return!1}}const xt=l.createContext(null);function fs({children:t}){const[s,r]=l.useState([]),u=l.useRef(1),i=l.useRef(new Map),d=o=>{const y=i.current.get(o);y&&(clearTimeout(y),i.current.delete(o))},c=(o,y)=>{d(o);const g=window.setTimeout(()=>b(o),y);i.current.set(o,g)},b=l.useCallback(o=>{d(o),r(y=>y.filter(g=>g.id!==o))},[]),h=l.useCallback((o,y)=>{const g=typeof y=="number"?y:(y==null?void 0:y.durationMs)??5e3,I=typeof y=="number"?"info":(y==null?void 0:y.variant)??"info",C=ht();let T=null;return r(C?_=>{const k=_[0];if(k&&k.message===o&&k.variant===I){const w={...k,count:k.count+1,duration:g};return T=w.id,[w]}_.forEach(w=>d(w.id));const L=u.current++,j={id:L,message:o,duration:g,variant:I,count:1};return T=L,[j]}:_=>{const k=_.findIndex(w=>w.message===o&&w.variant===I);if(k!==-1){const w=[..._],A={...w[k],count:w[k].count+1};return w[k]=A,T=A.id,w}const L=u.current++,j={id:L,message:o,duration:g,variant:I,count:1};return T=L,[..._,j]}),T!=null&&c(T,g),T??-1},[]),v=l.useMemo(()=>({notify:h,close:b}),[h,b]);return e.jsxs(xt.Provider,{value:v,children:[t,e.jsx("div",{className:"toasts",children:s.map(o=>e.jsxs("div",{className:`toast ${o.variant}`,children:[e.jsxs("div",{className:"toast-text",children:[o.message,o.count>1&&e.jsxs("span",{style:{marginLeft:6,opacity:.8},children:["×",o.count]})]}),e.jsx("button",{className:"toast-close",onClick:()=>b(o.id),"aria-label":"Close",children:"×"})]},o.id))})]})}function le(){const t=l.useContext(xt);if(!t)throw new Error("useToasts must be used within ToastProvider");return t}const Qt=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",s=new Set(t.toLowerCase().split(",").map(r=>r.trim()).filter(Boolean));return{standard:!0,taiko:!0,mania:!0,catch:!0}}catch{return{standard:!0,taiko:!0,mania:!0,catch:!0}}},$t=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help,showcase,request",s=new Set(t.toLowerCase().split(",").map(r=>r.trim()).filter(Boolean));return{untagged:s.has("untagged")||s.size===0,help:s.has("help")||s.size===0,showcase:s.has("showcase")||s.size===0,request:s.has("request")||s.size===0}}catch{return{untagged:!0,help:!0,showcase:!0,request:!0}}},Ut=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",s=new Set(t.toLowerCase().split(",").map(r=>r.trim()).filter(Boolean));return{unchecked:s.has("unchecked")||s.size===0,accepted:s.has("accepted")||s.size===0,denied:s.has("denied")||s.size===0,finished:s.has("finished")||s.size===0,archived:s.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Ht=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",s=new Set(t.toLowerCase().split(",").map(r=>r.trim()).filter(Boolean));return{open:s.has("open")||s.size===0,closed:s.has("closed")}}catch{return{open:!0,closed:!1}}},Yt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator,timing,audio",s=new Set(t.toLowerCase().split(",").map(r=>r.trim()).filter(Boolean));return{modder:s.has("modder")||s.size===0,nominator:s.has("nominator")||s.size===0,timing:s.has("timing")||s.size===0,audio:s.has("audio")||s.size===0}}catch{return{modder:!0,nominator:!0,timing:!0,audio:!0}}},Xt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Jt=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Ae=Mt(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Qt(),tagFilters:$t(),queueStatusFilters:Ut(),queueOpenFilters:Ht(),queueTypeFilters:Yt(),lastSection:Xt(),previousLocation:null,theme:Jt(),setMenuOpen:s=>t({menuOpen:s}),setMobileNavOpen:s=>t({mobileNavOpen:s}),setNotifOpen:s=>t({notifOpen:s}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:s=>{t({modeFilters:s});try{const u=Object.entries(s).filter(([d,c])=>c).map(([d])=>d),i=u.length?u:["standard"];localStorage.setItem("filter_modes",i.join(","))}catch{}},setTagFilters:s=>{t({tagFilters:s});try{const u=Object.entries(s).filter(([d,c])=>c).map(([d])=>d),i=u.length?u:["untagged","help","showcase","request"];localStorage.setItem("filter_moddi_tags",i.join(","))}catch{}},setQueueStatusFilters:s=>{t({queueStatusFilters:s});try{const u=Object.entries(s).filter(([d,c])=>c).map(([d])=>d),i=u.length?u:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",i.join(","))}catch{}},setQueueOpenFilters:s=>{t({queueOpenFilters:s});try{const u=Object.entries(s).filter(([d,c])=>c).map(([d])=>d),i=u.length?u:["open"];localStorage.setItem("filter_queue_open",i.join(","))}catch{}},setQueueTypeFilters:s=>{t({queueTypeFilters:s});try{const u=Object.entries(s).filter(([d,c])=>c).map(([d])=>d),i=u.length?u:["modder","nominator","timing","audio"];localStorage.setItem("filter_queue_type",i.join(","))}catch{}},setLastSection:s=>{t({lastSection:s});try{s?localStorage.setItem("last_section",s):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:s=>{t({previousLocation:s})},setTheme:s=>{t({theme:s});try{localStorage.setItem("theme",s)}catch{}}})),yt="https://api.osumappi.ng";function vt(){var t;try{return((t=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s==="csrf"))==null?void 0:t[1])||""}catch{return""}}async function q(t,s={}){const{requireAuth:r=!0,skipCsrf:u=!1,...i}=s,d={...i.headers};if(i.body&&!d["Content-Type"]&&(d["Content-Type"]="application/json"),r&&!u){const b=vt();b&&(d["X-CSRF-Token"]=b)}const c=await fetch(`${yt}${t}`,{...i,credentials:"include",headers:d});if(!c.ok){const b=await c.json().catch(()=>({error:`HTTP ${c.status}`}));throw new Error(b.error||`HTTP ${c.status}: ${c.statusText}`)}return c.json()}function Gt(t){const s=new URLSearchParams;for(const[u,i]of Object.entries(t))i!=null&&s.append(u,String(i));const r=s.toString();return r?`?${r}`:""}const z={auth:{login:"/api/auth/login",logout:"/api/auth/logout",me:"/api/me"},user:{quota:"/api/me/upload_quota",notifications:"/api/me/notifications",markNotificationsRead:"/api/me/notifications/mark_read",deleteNotification:t=>`/api/me/notifications/${encodeURIComponent(t)}`,pushSubscribe:"/api/me/push/subscribe",pushUnsubscribe:"/api/me/push/unsubscribe",pushList:"/api/me/push/subscriptions",pushTest:"/api/me/push/test",notifPrefs:"/api/me/notification_prefs",bannerUpload:"/api/users/me/banner/upload-url",bannerImageUpload:"/api/users/me/banner/image/upload-url",bannerImageConfirm:"/api/users/me/banner/image/confirm"},feed:{next:"/api/feed/next",batch:"/api/feed/batch",progress:t=>`/api/feed/progress${t?`?modes=${encodeURIComponent(t)}`:""}`,recent:"/api/videos/recent"},videos:{like:t=>`/api/videos/${t}/like`,view:t=>`/api/videos/${t}/view`,update:t=>`/api/videos/${t}`,delete:t=>`/api/videos/${t}`,flag:t=>`/api/videos/${t}/flag`,comments:t=>`/api/videos/${t}/comments`,get:t=>`/api/videos/${t}`},uploads:{new:"/api/uploads/new"},moddi:{mySubmissions:"/api/moddi/me/submissions",posts:"/api/moddiposts",post:t=>`/api/moddiposts/${t}`,postReact:t=>`/api/moddiposts/${t}/react`,postComments:t=>`/api/moddiposts/${t}/comments`,queues:"/api/moddi/queues",queue:t=>`/api/moddi/queues/${t}`,queueSubmit:t=>`/api/moddi/queues/${t}/submit`,queueAccept:t=>`/api/moddi/queues/${t}/accept`,queueDeny:t=>`/api/moddi/queues/${t}/deny`,queueInvite:t=>`/api/moddi/queues/${t}/invite`,queueMember:(t,s)=>`/api/moddi/queues/${t}/members/${s}`,queueSubmission:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueSubmissionDelete:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueBlockUser:t=>`/api/moddi/queues/${t}/block`,queueUnblockUser:(t,s)=>`/api/moddi/queues/${t}/block/${s}`,queueBlockedUsers:t=>`/api/moddi/queues/${t}/blocked`,queueSubmissionAcknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueSubmissionUnacknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueBannerUpload:t=>`/api/moddi/queues/${t}/banner/upload-url`,queueBannerImageUpload:t=>`/api/moddi/queues/${t}/banner/image/upload-url`,queueBannerImageConfirm:t=>`/api/moddi/queues/${t}/banner/image/confirm`,usersSearch:t=>`/api/moddi/users/search?q=${encodeURIComponent(t)}`},osu:{resolveBeatmap:"/api/osu/beatmap/resolve",downloadBeatmapset:t=>`/api/osu/beatmapsets/${t}/download?noVideo=1`,usersSearch:t=>`/api/osu/users/search?q=${encodeURIComponent(t)}`},users:{get:t=>`/api/users/${t}`,videos:t=>`/api/users/${t}/videos`,likes:t=>`/api/users/${t}/likes`,myVideos:"/api/me/videos"},admin:{clearViews:"/api/admin/me/clear_views",debugState:"/api/debug/state",settingsModeration:"/api/admin/settings/moderation",videosPending:"/api/admin/videos/pending",videosApprove:t=>`/api/admin/videos/${t}/approve`,videosReject:t=>`/api/admin/videos/${t}/reject`,videosAction:(t,s)=>`/api/admin/videos/${t}/${s}`,analytics:"/api/admin/analytics",usersSearch:t=>`/api/admin/users/search?q=${encodeURIComponent(t)}`,userVideos:t=>`/api/admin/users/${t}/videos`,userUpdate:t=>`/api/admin/users/${t}`,notificationsSystem:"/api/admin/notifications/system",notificationsTest:"/api/admin/notifications/test"}};function Kt(t=!0){return ye({queryKey:["notifications"],queryFn:async()=>{try{const s=await q(z.user.notifications);return Array.isArray(s.items)?s.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Vt(){return ye({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await q("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function bs(){const{data:t=[]}=Kt();return t.filter(s=>s.kind==="system"&&s.id.startsWith("b:")&&(s.expiresAt||0)<=Date.now()?!1:!s.read).length}function Zt(){const t=ve();return Ne({mutationFn:async s=>{await q(z.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:s})})},onSuccess:()=>{t.setQueryData(["notifications"],s=>(s==null?void 0:s.map(r=>({...r,read:!0})))||[])}})}function es(){const t=ve();return Ne({mutationFn:async s=>{const r=vt();await q(z.user.deleteNotification(s),{method:"DELETE",headers:{"X-CSRF-Token":r}})},onSuccess:(s,r)=>{t.setQueryData(["notifications"],u=>(u==null?void 0:u.filter(i=>i.id!==r))||[]),t.setQueryData(["notifications","detailed"],u=>(u==null?void 0:u.filter(i=>i.id!==r))||[])}})}function qe(){return ye({queryKey:["user","me"],queryFn:async()=>{try{return await q(z.auth.me)}catch{return null}},staleTime:5*60*1e3})}function hs(t=!0){return ye({queryKey:["user","quota"],queryFn:async()=>{try{return await q(z.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function xs(){const t=ve();return Ne({mutationFn:async()=>{await q(z.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function ts(t,s,r,u){l.useEffect(()=>{if(!r)return;const i=d=>{const c=d.target;s.current&&!s.current.contains(c)&&t.current&&!t.current.contains(c)&&u()};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[r,u,t,s])}const ct=/(\d{2}:\d{2}:\d{3})(?:\s+\(([\d,]+)\))?/g;function ut(t,s){return s?`osu://edit/${t}-(${s})`:`osu://edit/${t}`}function De({text:t,className:s,style:r}){ct.lastIndex=0;const u=[];let i=0,d;for(;(d=ct.exec(t))!==null;){d.index>i&&u.push(t.substring(i,d.index));const c=d[1],b=d[2],h=d[0];u.push(e.jsx("a",{href:ut(c,b),onClick:v=>{v.preventDefault(),window.location.href=ut(c,b)},style:{color:"var(--primary)",textDecoration:"none",cursor:"pointer"},onMouseEnter:v=>{v.currentTarget.style.textDecoration="underline"},onMouseLeave:v=>{v.currentTarget.style.textDecoration="none"},title:"Open in osu! editor",children:h},d.index)),i=d.index+d[0].length}return i<t.length&&u.push(t.substring(i)),u.length===0?e.jsx("span",{className:s,style:r,children:t}):e.jsx("span",{className:s,style:r,children:u})}function ss({beatmapMeta:t,beatmapVersion:s}){const r=l.useRef(null),u=l.useRef(null),[i,d]=l.useState(!1),[c,b]=l.useState(!1),[h,v]=l.useState(0);l.useEffect(()=>{if(r.current&&u.current){const g=r.current.offsetWidth,I=u.current.scrollWidth;v(I),b(I>g)}},[t,s]);const o=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",s?` [${s}]`:""]}):s?`[${s}]`:"Beatmap",y=h>0?Math.max(3,h/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:r,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("span",{ref:u,style:{display:"inline-block",animation:i&&c?`beatmap-marquee ${y}s linear infinite`:"none"},children:o}),i&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:o})]})]})}function Ee({submission:t,canManage:s,onUpdate:r,onDelete:u,isGroup:i=!1,allowSelfActions:d=!1}){const[c,b]=l.useState(!1),[h,v]=l.useState(!1),[o,y]=l.useState(null),[g,I]=l.useState(t.beatmapset_id),[C,T]=l.useState(t.beatmap_id),[_,k]=l.useState(!1),[L,j]=l.useState(!1),[w,A]=l.useState(null),[J,R]=l.useState(!1),[F,H]=l.useState(t.acknowledgments||[]),[$,ee]=l.useState(t.acknowledged_by_me||!1),O=l.useRef(null),x=l.useRef(null),N=l.useRef(null),f=l.useRef(null),W=l.useRef(null),{notify:X}=le();l.useEffect(()=>{H(t.acknowledgments||[]),ee(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),l.useEffect(()=>{if(t.beatmap_url)try{const a=new URL(t.beatmap_url),p=a.pathname.match(/\/beatmapsets\/(\d+)/);if(p&&!t.beatmapset_id){const B=Number(p[1]);isNaN(B)||I(B)}const M=a.hash.match(/#osu\/(\d+)/);if(M&&!t.beatmap_id){const B=Number(M[1]);isNaN(B)||T(B)}}catch(a){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,a)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),l.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:g,extracted_beatmap_id:C,beatmap_version:t.beatmap_version})},[t.id,g,C]),l.useEffect(()=>{if(!t.beatmap_url||o&&g)return;let a=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let p;try{p=new URL(t.beatmap_url)}catch(U){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,U);return}const M=p.hash.match(/#osu\/(\d+)/),B=M?M[1]:null;p.hash="";const K={url:p.toString()};if(B?K.beatmap_id=B:t.beatmap_id&&(K.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",K),!a){const U=await q(z.osu.resolveBeatmap+Gt(K),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",U),U.setId&&!g&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",U.setId),I(Number(U.setId))),(U.title||U.artist)&&y({title:U.title||null,artist:U.artist||null,mapper:U.mapper||null})}}catch(p){console.error("[QueueSubmission] Error fetching beatmap metadata:",p)}})(),()=>{a=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,o,g]),l.useEffect(()=>{if(!_){A(null),W.current&&(window.removeEventListener("resize",W.current),window.removeEventListener("scroll",W.current,!0),W.current=null);return}let a=null;const p=()=>{let M=null;const B=f.current;if(B){const Y=B.querySelector(".queue-submission-beatmap-btn-desktop button"),K=B.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),U=B.querySelector(".queue-submission-beatmap-btn-mobile button");Y&&window.getComputedStyle(Y.parentElement).display!=="none"?M=Y:K&&window.getComputedStyle(K.parentElement).display!=="none"?M=K:U&&window.getComputedStyle(U.parentElement).display!=="none"&&(M=U)}if(!M&&N.current&&(M=N.current),M){const Y=M.getBoundingClientRect();A({top:Y.bottom+8,right:window.innerWidth-Y.right})}else A(null)};return W.current=p,a=requestAnimationFrame(()=>{p(),window.addEventListener("resize",p),window.addEventListener("scroll",p,!0)}),()=>{a!==null&&cancelAnimationFrame(a),W.current&&(window.removeEventListener("resize",W.current),window.removeEventListener("scroll",W.current,!0),W.current=null)}},[_]),l.useEffect(()=>{if(!h)return;const a=p=>{const M=p.target;O.current&&!O.current.contains(M)&&!M.closest("[data-status-dropdown]")&&v(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[h]),l.useEffect(()=>{if(!_)return;const a=p=>{const M=p.target;if(x.current&&x.current.contains(M))return;const B=f.current;if(B){if(N.current&&N.current.contains(M))return;const Y=B.querySelector(".queue-submission-beatmap-btn-desktop button"),K=B.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),U=B.querySelector(".queue-submission-beatmap-btn-mobile button");if(Y&&Y.contains(M)||K&&K.contains(M)||U&&U.contains(M))return}k(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[_]);const me=async a=>{if(!c){b(!0);try{await q(z.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:a})});const p={...t,status:a,updated_at:Math.floor(Date.now()/1e3)};r&&r(p),X("Status updated",{variant:"success"})}catch{X("Failed to update status",{variant:"error"})}finally{b(!1),v(!1)}}},ae=async()=>{if(!c){b(!0);try{const a=!!t.is_archived;await q(z.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!a})});const p={...t,is_archived:a?0:1,updated_at:Math.floor(Date.now()/1e3)};r&&r(p),X(a?"Unarchived":"Archived",{variant:"success"})}catch{X("Failed to update archive status",{variant:"error"})}finally{b(!1)}}},se=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){b(!0);try{await q(z.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),X("Submission deleted",{variant:"success"}),u&&u(t.id)}catch{X("Failed to delete submission",{variant:"error"})}finally{b(!1)}}},ge=async()=>{if(!J){R(!0);try{if($){if(await q(z.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),ee(!1),X("Unacknowledged",{variant:"info"}),r){const a={...t,acknowledged_by_me:!1};r(a)}}else if(await q(z.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),ee(!0),X("Acknowledged",{variant:"success"}),r){const a={...t,acknowledged_by_me:!0};r(a)}}catch{X("Failed to update acknowledgment",{variant:"error"})}finally{R(!1)}}},E={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},G={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},Z=g||t.beatmapset_id,ne=Z?`https://assets.ppy.sh/beatmaps/${Z}/covers/card.jpg`:null;l.useEffect(()=>{ne?console.log("[QueueSubmission] Background image URL:",ne,"for beatmapset_id:",Z):console.log("[QueueSubmission] No background image URL - beatmapset_id:",Z,"submission.beatmapset_id:",t.beatmapset_id)},[ne,Z,t.beatmapset_id]);const Q=!!t.is_archived,ie=s||d?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),k(p=>!p)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Te,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(pe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),k(p=>!p)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Te,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(pe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),F&&F.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[F.slice(0,5).map((a,p)=>a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:a.username,title:a.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:F.length-p,position:"relative",cursor:"pointer"}},a.user_id):e.jsx("div",{title:a.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:F.length-p,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:a.username.charAt(0).toUpperCase()},a.user_id)),F.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${F.length-5} more`,children:["+",F.length-5]})]}),s&&e.jsx("button",{className:"icon-link",onClick:ge,disabled:J||c,title:$?"Unacknowledge":"Acknowledge",style:{color:$?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:$?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:a=>{!J&&!c&&(a.currentTarget.style.background=$?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=$?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(et,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ae,disabled:c,title:Q?"Unarchive":"Archive",style:{color:Q?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:Q?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:a=>{c||(a.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.1)":"transparent"},children:Q?e.jsx(tt,{size:16}):e.jsx(st,{size:16})}),e.jsx("button",{className:"icon-link",onClick:se,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:a=>{c||(a.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:a=>{a.currentTarget.style.background="transparent"},children:e.jsx(be,{size:16})}),s&&e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:O,onClick:()=>v(!h),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:E[t.status]+"15",border:`1.5px solid ${E[t.status]}50`,color:E[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:a=>{c||(a.currentTarget.style.background=E[t.status]+"25",a.currentTarget.style.borderColor=E[t.status]+"70",a.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:a=>{a.currentTarget.style.background=E[t.status]+"15",a.currentTarget.style.borderColor=E[t.status]+"50",a.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:G[t.status]}),e.jsx(pe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:h?"rotate(180deg)":"rotate(0deg)"}})]}),h&&he.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const a=document.querySelector(".queue-submission-status-btn-desktop button"),p=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),M=document.querySelector(".queue-submission-status-btn-mobile button");let B=null;if(a&&window.getComputedStyle(a.parentElement).display!=="none"?B=a:M&&window.getComputedStyle(M.parentElement).display!=="none"?B=M:p&&window.getComputedStyle(p.parentElement).display!=="none"?B=p:O.current&&(B=O.current),B){const Y=B.getBoundingClientRect();return{top:Y.bottom+6,right:window.innerWidth-Y.right}}return{top:0,right:0}})()},onClick:a=>a.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(a=>e.jsx("button",{onClick:()=>me(a),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:a===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:a===t.status?E[a]+"15":"transparent",color:a===t.status?E[a]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:p=>{a!==t.status&&(p.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:p=>{a!==t.status&&(p.currentTarget.style.background="transparent")},children:G[a]},a))}),document.body)]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:f,className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:Q?.6:1},children:[ne&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ne,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.25,zIndex:0,pointerEvents:"none",filter:"blur(2px) saturate(0.6)"},onError:a=>{a.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%)",backdropFilter:"blur(4px)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:N,className:"chip-btn link",onClick:a=>{a.preventDefault(),a.stopPropagation(),k(p=>!p)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)",a.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.05)",a.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Te,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(pe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),s&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[F&&F.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[F.slice(0,5).map((a,p)=>a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:a.username,title:a.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:F.length-p,position:"relative",cursor:"pointer"}},a.user_id):e.jsx("div",{title:a.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:p>0?-8:0,zIndex:F.length-p,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:a.username.charAt(0).toUpperCase()},a.user_id)),F.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${F.length-5} more`,children:["+",F.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:ge,disabled:J||c,title:$?"Unacknowledge":"Acknowledge",style:{color:$?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:$?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:a=>{!J&&!c&&(a.currentTarget.style.background=$?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=$?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(et,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ae,disabled:c,title:Q?"Unarchive":"Archive",style:{color:Q?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:Q?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:a=>{c||(a.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:a=>{a.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.1)":"transparent"},children:Q?e.jsx(tt,{size:16}):e.jsx(st,{size:16})}),e.jsx("button",{className:"icon-link",onClick:se,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:a=>{c||(a.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:a=>{a.currentTarget.style.background="transparent"},children:e.jsx(be,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:O,onClick:()=>v(!h),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:E[t.status]+"15",border:`1.5px solid ${E[t.status]}50`,color:E[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:a=>{c||(a.currentTarget.style.background=E[t.status]+"25",a.currentTarget.style.borderColor=E[t.status]+"70",a.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:a=>{a.currentTarget.style.background=E[t.status]+"15",a.currentTarget.style.borderColor=E[t.status]+"50",a.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:G[t.status]}),e.jsx(pe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:h?"rotate(180deg)":"rotate(0deg)"}})]})})]}),s&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>v(!h),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:E[t.status]+"15",border:`1.5px solid ${E[t.status]}50`,color:E[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:a=>{c||(a.currentTarget.style.background=E[t.status]+"25",a.currentTarget.style.borderColor=E[t.status]+"70",a.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:a=>{a.currentTarget.style.background=E[t.status]+"15",a.currentTarget.style.borderColor=E[t.status]+"50",a.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:G[t.status]}),e.jsx(pe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:h?"rotate(180deg)":"rotate(0deg)"}})]})}),!s&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:E[t.status]+"15",border:`1.5px solid ${E[t.status]}50`,color:E[t.status],whiteSpace:"nowrap"},children:G[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx(ss,{beatmapMeta:o,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:e.jsx(De,{text:t.message})}),ie]})]}),_&&w&&t.beatmap_url&&he.createPortal(e.jsxs("div",{ref:x,style:{position:"fixed",top:w.top,right:w.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:a=>a.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>k(!1),children:[e.jsx(Te,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),Z&&e.jsx("button",{className:"menu-item",onClick:()=>{j(!0),k(!1)},children:"Preview"})]}),document.body),L&&Z&&e.jsx(Ot,{open:L,onClose:()=>j(!1),downloadUrl:`${yt}${z.osu.downloadBeatmapset(Z)}`,beatmapId:C??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}const pt=["modding","timing","audio"],Fe=["nominator","subdivision"];function ze(){return ye({queryKey:["moddi","queues"],queryFn:async()=>{const t=await q(z.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function jt(){const t=ve();return Ne({mutationFn:async s=>{var r;return await q(z.moddi.queues,{method:"POST",body:JSON.stringify({name:s.name.trim(),description:((r=s.description)==null?void 0:r.trim())||null,is_group:s.is_group??!1,type:s.type||"modder",tags:s.tags||"modding"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function We({open:t,onClose:s,children:r}){const u=l.useRef(null),i=l.useRef(null),d=l.useRef(!1),c=o=>{var y;i.current=((y=o.touches[0])==null?void 0:y.clientY)??null,d.current=!1},b=o=>{var C,T;if(i.current==null)return;const y=((C=o.touches[0])==null?void 0:C.clientY)??null;if(y==null)return;const g=y-i.current;(((T=u.current)==null?void 0:T.scrollTop)??0)<=0&&g>60?d.current=!0:d.current=!1},h=()=>{d.current&&s(),i.current=null,d.current=!1};if(!t)return null;const v=e.jsx("div",{className:"mobile-upload-overlay",onClick:s,children:e.jsx("div",{ref:u,className:"mobile-upload-sheet",onClick:o=>o.stopPropagation(),onTouchStart:c,onTouchMove:b,onTouchEnd:h,children:r})});return he.createPortal(v,document.body)}function ns({queueId:t,onSubmitted:s}){const[r,u]=re.useState(!1),[i,d]=re.useState(t),[c,b]=re.useState(""),[h,v]=re.useState(""),[o,y]=re.useState(!1),{notify:g}=le(),{data:I=[]}=ze();re.useEffect(()=>{d(t)},[t]);const C=async()=>{if(!i){g("Please select a queue",{variant:"error"});return}if(!c.trim()){g("Beatmap URL is required",{variant:"error"});return}y(!0);try{await q(z.moddi.queueSubmit(i),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:h.trim()||null})}),g("Submission created!",{variant:"success"}),b(""),v(""),u(!1),s==null||s()}catch(T){g((T==null?void 0:T.message)||"Failed to create submission",{variant:"error"})}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>u(!0),children:e.jsx(xe,{size:22})}),e.jsx(We,{open:r,onClose:()=>u(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:i??"",onChange:T=>d(T.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),I.map(T=>e.jsx("option",{value:String(T.id),children:T.name},T.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:T=>b(T.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:h,onChange:T=>v(T.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),h.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[h.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:o,onClick:C,children:o?"Submitting...":"Submit"})]})]})})]})}const wt=({context:t})=>{const s=Ft(),{tagFilters:r,setTagFilters:u,queueTypeFilters:i,setQueueTypeFilters:d,queueStatusFilters:c,setQueueStatusFilters:b}=Ae(),h=re.useMemo(()=>{if(t)return t;const _=s.pathname;return _==="/feed"?"unified-feed":_==="/mp/feed"?"mappi-feed":_==="/md/feed"?"moddi-feed":_==="/queues"||_==="/md/queues"?"moddi-queues":_.startsWith("/queues/")||_.startsWith("/md/queues/")?"moddi-queue-detail":"unified-feed"},[t,s.pathname]),v=_=>{const k={...r,[_]:!r[_]};!k.untagged&&!k.help&&!k.showcase&&!k.request&&(k.untagged=!0),u(k);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},o=_=>{const k={...i,[_]:!i[_]};!k.modder&&!k.nominator&&!k.timing&&!k.audio&&(k.modder=!0),d(k)},y=_=>{const k={...c,[_]:!c[_]};["unchecked","accepted","denied","finished"].some(j=>k[j])||(k.unchecked=!0),b(k)},g=({active:_,onClick:k,label:L})=>e.jsx("button",{type:"button",onClick:k,className:"desktop-filter-chip","aria-pressed":_,"data-active":_,children:L}),I=h==="unified-feed"||h==="moddi-feed",C=h==="moddi-queues",T=h==="moddi-queue-detail";return e.jsxs("div",{className:"desktop-filter-bar",children:[I&&e.jsxs(e.Fragment,{children:[e.jsx(g,{active:r.untagged,onClick:()=>v("untagged"),label:"untagged"}),e.jsx(g,{active:r.help,onClick:()=>v("help"),label:"help"}),e.jsx(g,{active:r.showcase,onClick:()=>v("showcase"),label:"showcase"}),e.jsx(g,{active:r.request,onClick:()=>v("request"),label:"request"})]}),C&&e.jsxs(e.Fragment,{children:[e.jsx(g,{active:i.modder,onClick:()=>o("modder"),label:"modding"}),e.jsx(g,{active:i.nominator,onClick:()=>o("nominator"),label:"bn/subdivision"}),e.jsx(g,{active:i.timing,onClick:()=>o("timing"),label:"timing"}),e.jsx(g,{active:i.audio,onClick:()=>o("audio"),label:"audio"})]}),T&&e.jsxs(e.Fragment,{children:[e.jsx(g,{active:c.unchecked,onClick:()=>y("unchecked"),label:"pending"}),e.jsx(g,{active:c.accepted,onClick:()=>y("accepted"),label:"accepted"}),e.jsx(g,{active:c.denied,onClick:()=>y("denied"),label:"denied"}),e.jsx(g,{active:c.finished,onClick:()=>y("finished"),label:"finished"})]})]})};function Be({tabs:t,activeTab:s,onChange:r,rightAction:u,style:i}){return e.jsxs("div",{className:"tab-header",style:{display:"flex",background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",position:"relative",...i},children:[t.map((d,c)=>{const b=d.id===s,h=c===t.length-1;return e.jsxs("button",{onClick:()=>r(d.id),style:{flex:1,padding:"14px 16px",background:"transparent",border:"none",borderRight:!h||u?"1px solid rgba(255,255,255,0.08)":"none",color:b?"var(--text)":"var(--muted)",fontWeight:b?600:400,fontSize:14,fontFamily:"inherit",cursor:"pointer",transition:"all 0.15s ease",position:"relative"},onMouseEnter:v=>{b||(v.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="transparent"},children:[d.label,b&&e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:"var(--accent, #667eea)",borderRadius:"2px 2px 0 0"}})]},d.id)}),u&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:u})]})}function rs({isOpen:t,onClose:s,onSubmitted:r,queueId:u,isQueueOpen:i,anchorRef:d,rules:c}){const{notify:b}=le(),[h,v]=l.useState(""),[o,y]=l.useState(""),[g,I]=l.useState(!1),[C,T]=l.useState(!1),_=l.useRef(null);l.useEffect(()=>{if(!t)return;const L=j=>{const w=j.target;if(_.current&&!_.current.contains(w)&&(d!=null&&d.current)&&!d.current.contains(w)){const A=document.getElementById("rules-modal-overlay");if(A&&A.contains(w))return;s()}};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[t,s,d]);const k=async L=>{if(L.preventDefault(),!i){b("Queue is closed for submissions",{variant:"error"});return}if(!h.trim()){b("Beatmap URL is required",{variant:"error"});return}I(!0);try{await q(z.moddi.queueSubmit(u),{method:"POST",body:JSON.stringify({beatmap_url:h.trim(),message:o.trim()||null})}),b("Submission created!",{variant:"success"}),s(),v(""),y(""),r()}catch(j){b((j==null?void 0:j.message)||"Failed to create submission",{variant:"error"})}finally{I(!1)}};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:_,className:"submit-beatmap-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:i?e.jsx("form",{onSubmit:k,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:h,onChange:L=>v(L.target.value),required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:o,onChange:L=>y(L.target.value.slice(0,100)),maxLength:100,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),o.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right"},children:[o.length,"/100"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:4},children:[c?e.jsx("button",{type:"button",onClick:()=>T(!0),style:{background:"transparent",border:"none",padding:0,color:"var(--text)",fontSize:13,textDecoration:"underline",cursor:"pointer",opacity:.8},children:"Rules"}):e.jsx("div",{}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g||!h.trim(),style:{background:h.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:h.trim()?"pointer":"not-allowed"},children:g?"Submitting...":"Submit"})]})]})]})}):e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"This queue is currently closed for submissions."})})}),C&&c&&e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>T(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>T(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6,whiteSpace:"pre-wrap"},children:c})]})})]}):null}const mt={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},as=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Dt,{components:{p:({children:s})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:s}),ul:({children:s})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),ol:({children:s})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),li:({children:s})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:s}),strong:({children:s})=>e.jsx("strong",{style:{fontWeight:600},children:s}),em:({children:s})=>e.jsx("em",{children:s}),code:({children:s})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:s}),h1:({children:s})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:s}),h2:({children:s})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:s}),h3:({children:s})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:s})},children:t})});function ys(){var Ve;const{id:t}=Lt(),s=gt(),[r,u]=l.useState(null),[i,d]=l.useState([]),[c,b]=l.useState([]),[h,v]=l.useState(!0),[o,y]=l.useState(null),[g,I]=l.useState(!1),C=l.useRef(null),[T,_]=l.useState(null),[k,L]=l.useState(!1),[j,w]=l.useState(""),[A,J]=l.useState(""),[R,F]=l.useState(""),[H,$]=l.useState("modder"),[ee,O]=l.useState(!1),[x,N]=l.useState(!1),[f,W]=l.useState("general"),[X,me]=l.useState(!1),[ae,se]=l.useState(!1),[ge,E]=l.useState(null),[G,Z]=l.useState(""),[ne,Q]=l.useState([]),[ie,a]=l.useState(!1),p=l.useRef(null),M=l.useRef(null),B=l.useRef(null),[Y,K]=l.useState([]),[U,Pe]=l.useState(!1),[Oe,Qe]=l.useState(null),[Ie,St]=l.useState("active"),[kt,je]=l.useState(!1),[$e,Ue]=l.useState(!1),[He,Re]=l.useState(0),we=l.useRef(null),{notify:P}=le(),{queueStatusFilters:Se}=Ae(),oe=async()=>{var n,m;if(t){v(!0);try{const S=await q(z.moddi.queue(t),{requireAuth:!1});u(S.queue||null),d(S.members||[]),b(S.submissions||[])}catch(S){(n=S==null?void 0:S.message)!=null&&n.includes("403")||(m=S==null?void 0:S.message)!=null&&m.includes("Forbidden")?(P("You do not have access to this queue",{variant:"error"}),s("/queues")):P("Failed to load queue",{variant:"error"})}finally{v(!1)}}};l.useEffect(()=>{oe(),q(z.auth.me,{requireAuth:!1}).then(n=>y(n)).catch(()=>{})},[t]);const de=o&&r&&(r.owner_id===o.id||i.some(n=>n.user_id===o.id&&n.joined_at)||o.is_mod||o.is_admin),_t=o&&i.some(n=>n.user_id===o.id&&n.joined_at),Ye=o&&r&&(r.owner_id===o.id||i.some(n=>n.user_id===o.id&&n.joined_at)),Xe=n=>{b(m=>m.map(S=>S.id===n.id?n:S)),n.acknowledged_by_me!==void 0&&oe()},Tt=()=>{r&&(w(r.name),J(r.description||""),F(r.rules||""),$(r.type||"modder"),L(!0),W("general"))},ke=()=>{L(!1),w(""),J(""),F(""),$("modder"),je(!1)},Je=async()=>{if(!(!r||!Ye)){N(!0);try{const n=r.is_open!==1;await q(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:n})}),P(`Queue ${n?"opened":"closed"} `,{variant:"success"}),oe()}catch(n){P((n==null?void 0:n.message)||"Failed to update status",{variant:"error"})}finally{N(!1)}}},Ge=async n=>{if(n.preventDefault(),!r||!j.trim()){P("Queue name is required",{variant:"error"});return}me(!0);try{const m=i.filter(D=>D.user_id!==r.owner_id&&D.role!=="owner").length>0,S={name:j.trim(),description:A.trim()||null,rules:R.trim()||null,is_group:m};(o!=null&&o.is_mod||o!=null&&o.is_admin)&&(S.type=H),await q(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify(S)}),P("Queue updated!",{variant:"success"}),ke(),oe()}catch(m){P((m==null?void 0:m.message)||"Failed to update queue",{variant:"error"})}finally{me(!1)}};l.useEffect(()=>{if(!G.trim()){Q([]),a(!1);return}const n=setTimeout(async()=>{try{const S=(await q(z.moddi.usersSearch(G),{requireAuth:!1})).items||[];Q(S),a(S.length>0)}catch(m){console.error("Search failed:",m),Q([]),a(!1)}},300);return()=>clearTimeout(n)},[G]);const Ct=async n=>{if(!ae){se(!0);try{await q(z.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:n})}),P("Invite sent!",{variant:"success"}),Z(""),Q([]),a(!1),oe()}catch(m){P((m==null?void 0:m.message)||"Failed to invite member",{variant:"error"})}finally{se(!1)}}},Me=async()=>{if(!(!t||!de))try{const n=await q(z.moddi.queueBlockedUsers(t));K(n.blocked||[])}catch(n){console.error("Failed to load blocked users:",n)}},Nt=async n=>{if(!(!t||U)&&confirm("Block this user from submitting to this queue?")){Pe(!0);try{await q(z.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:n})}),P("User blocked",{variant:"success"}),Me(),Z(""),Q([]),a(!1)}catch(m){P((m==null?void 0:m.message)||"Failed to block user",{variant:"error"})}finally{Pe(!1)}}},Ke=async n=>{if(!(!t||Oe===n)){Qe(n);try{await q(z.moddi.queueUnblockUser(t,n),{method:"DELETE"}),P("User unblocked",{variant:"success"}),Me()}catch(m){P((m==null?void 0:m.message)||"Failed to unblock user",{variant:"error"})}finally{Qe(null)}}};l.useEffect(()=>{f==="members"&&de&&t&&Me()},[f,de,t]);const qt=async()=>{if(r&&confirm(`Are you sure you want to delete "${r.name}" ? This action cannot be undone.`)){O(!0);try{await q(z.moddi.queue(t),{method:"DELETE"}),P("Queue deleted",{variant:"success"}),s("/queues")}catch(n){P((n==null?void 0:n.message)||"Failed to delete queue",{variant:"error"})}finally{O(!1)}}},zt=async n=>{if(!o||!r||o.id!==r.owner_id){P("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){E(n);try{await q(z.moddi.queueMember(t,n),{method:"DELETE"}),P("Member removed",{variant:"success"});const S=i.filter(D=>D.user_id!==n).some(D=>D.user_id!==(r==null?void 0:r.owner_id)&&D.role!=="owner");if(r&&r.is_group===1&&!S)try{await q(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}oe()}catch(m){P((m==null?void 0:m.message)||"Failed to remove member",{variant:"error"})}finally{E(null)}}},It=async()=>{if(o&&confirm("Leave this queue? You will need to be invited again to rejoin.")){E(o.id);try{await q(z.moddi.queueMember(t,o.id),{method:"DELETE"}),P("Left queue",{variant:"success"});const m=i.filter(S=>S.user_id!==o.id).some(S=>S.user_id!==(r==null?void 0:r.owner_id)&&S.role!=="owner");if(r&&r.is_group===1&&!m)try{await q(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}s("/queues")}catch(n){P((n==null?void 0:n.message)||"Failed to leave queue",{variant:"error"})}finally{E(null)}}},Rt=async n=>{var S;const m=(S=n.target.files)==null?void 0:S[0];if(!(!m||!t)){Ue(!0),Re(0);try{const D=m.type.startsWith("image/");let te="",_e="";if(D){const V=await q(z.moddi.queueBannerImageUpload(t),{method:"POST"});te=V.uploadURL,_e=V.imageID}else{const V=await q(z.moddi.queueBannerUpload(t),{method:"POST"});te=V.uploadURL,_e=V.streamUID}const ce=new XMLHttpRequest;if(ce.open("POST",te,!0),ce.upload.onprogress=V=>{if(V.lengthComputable){const ue=Math.round(V.loaded/V.total*100);Re(ue)}},await new Promise((V,ue)=>{ce.onload=()=>{ce.status>=200&&ce.status<300?V():ue(new Error("Upload failed"))},ce.onerror=()=>ue(new Error("Network error"));const Ze=new FormData;Ze.append("file",m),ce.send(Ze)}),D){const V=await q(z.moddi.queueBannerImageConfirm(t),{method:"POST",body:JSON.stringify({imageID:_e})});u(ue=>ue?{...ue,banner_stream_uid:V.banner_stream_uid}:null),P("Banner updated!",{variant:"success"})}else{const V=await q(z.moddi.queue(t),{method:"PATCH",body:JSON.stringify({banner_stream_uid:_e})});u(V.queue||null),P("Banner updated!",{variant:"success"})}}catch(D){console.error(D),P(D.message||"Banner upload failed",{variant:"error"})}finally{Ue(!1),Re(0),we.current&&(we.current.value="")}}};return l.useEffect(()=>{if(!k)return;const n=m=>{var D;const S=m.target;(D=document.getElementById("rules-modal-overlay"))!=null&&D.contains(S)||S.closest(".manage-overlay")||S.closest(".manage-overlay-backdrop")||!S.closest(".manage-popup")&&B.current&&!B.current.contains(S)&&ke()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[k]),l.useEffect(()=>{if(!ie)return;const n=m=>{const S=m.target;p.current&&!p.current.contains(S)&&M.current&&!M.current.contains(S)&&a(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[ie]),h?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):r?e.jsxs("div",{className:"feed-container queue-detail-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0,minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t&&e.jsx(ns,{queueId:t,onSubmitted:()=>oe()}),e.jsx(wt,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"queue-detail-header",style:{background:"var(--panel)",borderBottom:"1px solid var(--divider)",position:"relative"},children:[e.jsxs("div",{style:{height:120,background:"var(--panel)",width:"100%",position:"relative",overflow:"hidden"},children:[r.banner_stream_uid?r.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:r.banner_stream_uid.slice(4),alt:"Banner",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("video",{src:`https://videodelivery.net/${r.banner_stream_uid}/manifest/video.m3u8`,poster:`https://videodelivery.net/${r.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),$e&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:20,backdropFilter:"blur(4px)"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#fff",marginBottom:8},children:["Uploading... ",He,"%"]}),e.jsx("div",{style:{width:"60%",height:4,background:"rgba(255,255,255,0.2)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${He}%`,height:"100%",background:"#fff",transition:"width 0.1s ease"}})})]}),e.jsx(Ce,{to:"/queues",style:{position:"absolute",top:12,left:12,width:36,height:36,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",color:"#fff",zIndex:10},title:"Back to queues",children:e.jsx(Et,{size:18})}),de&&e.jsxs("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8,zIndex:10},children:[e.jsx("input",{ref:we,type:"file",accept:"video/*,image/*",style:{display:"none"},onChange:Rt}),e.jsxs("button",{className:"btn secondary",onClick:()=>{var n;return(n=we.current)==null?void 0:n.click()},disabled:$e,style:{padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff"},title:r.banner_stream_uid?"Change Banner":"Add Banner",children:[e.jsx(xe,{size:14,style:{marginRight:6}}),r.banner_stream_uid?"Edit":"Add Banner"]}),e.jsxs("button",{ref:B,className:"btn secondary",onClick:Tt,style:{padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff"},title:"Manage Queue",children:[e.jsx(Bt,{size:14,style:{marginRight:6}}),"Manage"]})]}),e.jsxs("div",{style:{position:"absolute",bottom:12,right:16,display:"flex",gap:8,alignItems:"center",zIndex:10},children:[(()=>{const n=(r.tags||r.type||"modding").split(",")[0].trim().toLowerCase(),m=n==="modder"?"modding":n==="subdivisions"?"subdivision":n;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)"},children:m})})(),Ye?e.jsx("button",{onClick:Je,disabled:x,className:`queue - status - badge ${r.is_open===1?"status-open":"status-closed"} `,title:r.is_open===1?"Close queue":"Open queue","aria-label":r.is_open===1?"Close queue":"Open queue",style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:r.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:r.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",cursor:"pointer",display:"flex",alignItems:"center"},children:r.is_open===1?"Open":"Closed"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:r.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:r.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",display:"inline-flex",alignItems:"center"},children:r.is_open===1?"Open":"Closed"})]})]}),e.jsxs("div",{style:{padding:"0 16px 16px",position:"relative"},children:[e.jsx("div",{style:{marginTop:-32,marginBottom:12,display:"flex",alignItems:"flex-end",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.filter(n=>n.joined_at!==null).sort((n,m)=>{const S=n.role==="owner"||n.user_id===(r==null?void 0:r.owner_id),D=m.role==="owner"||m.user_id===(r==null?void 0:r.owner_id);return S&&!D?-1:!S&&D?1:(m.joined_at||0)-(n.joined_at||0)}).slice(0,5).map((n,m)=>e.jsxs("div",{style:{position:"relative",marginLeft:m>0?-12:0,zIndex:10-m},onMouseEnter:()=>_(n.user_id),onMouseLeave:()=>_(null),children:[e.jsx(Ce,{to:`/ profile / ${n.user_id} `,style:{display:"block",width:m===0?64:40,height:m===0?64:40,borderRadius:"50%",overflow:"hidden",border:"3px solid var(--panel)",background:"var(--bg)"},title:n.username,children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:m===0?24:14,fontWeight:600,color:"var(--muted)"},children:n.username.charAt(0).toUpperCase()})}),T===n.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[n.username," ",n.role!=="member"?`(${n.role})`:""]})]},n.user_id)),i.filter(n=>n.joined_at!==null).length>5&&e.jsxs("div",{style:{width:40,height:40,borderRadius:"50%",border:"3px solid var(--panel)",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,color:"var(--muted)",marginLeft:-12,zIndex:0},children:["+",i.filter(n=>n.joined_at!==null).length-5]})]})}),e.jsxs("div",{className:"col",style:{gap:2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.is_group?e.jsx(ft,{size:18,style:{color:"var(--muted)"}}):e.jsx(fe,{size:18,style:{color:"var(--muted)"}}),e.jsx("h1",{style:{fontSize:20,fontWeight:700,margin:0},children:r.name})]}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["by ",r.owner_username||((Ve=i.find(n=>n.user_id===r.owner_id))==null?void 0:Ve.username)||"Unknown"," • ",new Date(r.created_at*1e3).toLocaleDateString()]}),r.description&&e.jsx("div",{style:{fontSize:14,lineHeight:1.5,marginTop:8},children:e.jsx(De,{text:r.description})})]})]}),e.jsx(Be,{tabs:[{id:"active",label:"Active"},{id:"archived",label:"Archived"}],activeTab:Ie,onChange:n=>St(n),rightAction:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:C,onClick:()=>I(!g),style:{width:48,height:"100%",minHeight:48,background:g?"rgba(255,255,255,0.05)":"transparent",border:"none",color:r.is_open===1?"var(--text)":"var(--muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s",opacity:r.is_open===0?.5:1},onMouseEnter:n=>{g||(n.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:n=>{g||(n.currentTarget.style.backgroundColor="transparent")},title:r.is_open===1?"Submit a beatmap":"Queue is closed",children:e.jsx(xe,{size:18})}),t&&e.jsx(rs,{isOpen:g,onClose:()=>I(!1),onSubmitted:()=>oe(),queueId:t,isQueueOpen:r.is_open===1,anchorRef:C,rules:r.rules})]})})]}),r.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[Ie==="active"&&e.jsx(e.Fragment,{children:c.filter(n=>!!!n.is_archived&&Se[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):c.filter(n=>!!!n.is_archived&&Se[n.status]).map(n=>e.jsx(Ee,{submission:n,canManage:!!de,isGroup:(r==null?void 0:r.is_group)===1,onUpdate:Xe,onDelete:m=>{b(S=>S.filter(D=>D.id!==m))}},n.id))}),Ie==="archived"&&e.jsx(e.Fragment,{children:c.filter(n=>!!n.is_archived&&Se[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):c.filter(n=>!!n.is_archived&&Se[n.status]).map(n=>e.jsx(Ee,{submission:n,canManage:!!de,isGroup:(r==null?void 0:r.is_group)===1,onUpdate:Xe,onDelete:m=>{b(S=>S.filter(D=>D.id!==m))}},n.id))})]})}),k&&he.createPortal(e.jsx("div",{className:"manage-overlay-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",backdropFilter:"blur(5px)",zIndex:9998,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:ke,children:e.jsxs("div",{className:"manage-popup",style:{width:"100%",maxWidth:"800px",height:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",borderRadius:0},onClick:n=>n.stopPropagation(),children:[e.jsx(Be,{tabs:[{id:"general",label:"General"},{id:"rules",label:"Rules"},{id:"members",label:"Members"}],activeTab:f,onChange:n=>W(n),style:{borderBottom:"1px solid var(--divider)"}}),e.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:e.jsxs("form",{onSubmit:Ge,style:{display:"flex",flexDirection:"column",flex:1},children:[f==="general"&&e.jsxs("div",{className:"col",style:{gap:20,padding:24},children:[e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Name"}),e.jsx("input",{type:"text",value:j,onChange:n=>w(n.target.value),placeholder:"e.g. My Modding Queue",required:!0,style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Short Description"}),e.jsx("input",{type:"text",value:A,onChange:n=>J(n.target.value),placeholder:"Brief description of your queue...",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),((o==null?void 0:o.is_mod)||(o==null?void 0:o.is_admin))&&e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:["modder","nominator","timing","audio","subdivision"].map(n=>{const m=H===n,S=mt[n==="modder"?"modding":n]||mt.modding;return e.jsx("button",{type:"button",onClick:()=>$(n),style:{background:m?S.bg:"transparent",border:m?S.border:"1px solid var(--border)",color:m?S.color:"var(--muted)",padding:"8px 16px",borderRadius:0,fontSize:13,fontWeight:m?600:400,cursor:"pointer",textTransform:"capitalize",transition:"all 0.15s ease"},children:n},n)})})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",border:"1px solid var(--border)",marginTop:8},children:[e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:"Queue Status"}),e.jsx("div",{className:"muted",style:{fontSize:13},children:r.is_open?"Queue is currently open for submissions":"Queue is currently closed"})]}),e.jsx("button",{type:"button",onClick:Je,disabled:x,className:`btn ${r.is_open?"secondary":"primary"}`,style:{borderRadius:0},children:r.is_open?"Close Queue":"Open Queue"})]})]}),f==="rules"&&e.jsxs("div",{className:"col",style:{gap:12,padding:24,flex:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between"},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Queue Rules (Markdown)"}),e.jsx("button",{type:"button",onClick:()=>je(!0),className:"btn secondary",style:{fontSize:11,padding:"4px 8px",height:"auto",borderRadius:0},children:"Preview Rules"})]}),e.jsx("textarea",{value:R,onChange:n=>F(n.target.value),placeholder:"Enter your queue rules here... Markdown is supported.",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"none",flex:1,lineHeight:1.6}})]}),f==="members"&&e.jsxs("div",{className:"col",style:{gap:20,padding:24},children:[e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{className:"row",style:{gap:0},children:[e.jsx("div",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--muted)",pointerEvents:"none"},children:e.jsx(bt,{})}),e.jsx("input",{ref:p,type:"text",placeholder:"Search by username or ID...",value:G,onChange:n=>Z(n.target.value),onFocus:()=>{ne.length>0&&a(!0)},style:{background:"transparent",border:"1px solid var(--border)",borderRadius:0,padding:"10px 12px 10px 36px",color:"var(--text)",fontFamily:"inherit",fontSize:14,width:"100%"}})]}),ie&&ne.length>0&&e.jsx("div",{ref:M,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:-1,background:"var(--bg)",border:"1px solid var(--border)",borderTop:"none",maxHeight:250,overflowY:"auto",zIndex:100},children:ne.map(n=>{const m=i.some(te=>te.user_id===n.id&&te.joined_at),S=i.some(te=>te.user_id===n.id&&te.invited_at&&!te.joined_at),D=Y.some(te=>te.user_id===n.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"8px 12px",gap:10,borderBottom:"1px solid var(--divider)"},children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,style:{width:24,height:24,borderRadius:"50%"}}):e.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"var(--panel)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10},children:n.username[0]}),e.jsxs("div",{className:"col",style:{flex:1,gap:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username}),e.jsxs("div",{className:"muted",style:{fontSize:11},children:["ID: ",n.id]})]}),e.jsxs("div",{className:"row",style:{gap:4},children:[m?e.jsx("span",{className:"badge",style:{fontSize:10,opacity:.6},children:"Member"}):S?e.jsx("span",{className:"badge",style:{fontSize:10,color:"var(--accent)",background:"rgba(var(--accent-rgb), 0.1)"},children:"Invited"}):e.jsx("button",{type:"button",onClick:()=>Ct(n.id),disabled:ae,style:{background:"var(--primary)",border:"none",borderRadius:0,padding:"4px 10px",color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"},children:"Invite"}),de&&e.jsx("button",{type:"button",onClick:()=>D?Ke(n.id):Nt(n.id),disabled:U||Oe===n.id,style:{background:"transparent",border:"1px solid var(--border)",padding:4,color:D?"var(--accent)":"var(--muted)",cursor:"pointer",display:"flex"},title:D?"Unblock":"Block",children:D?e.jsx(nt,{size:12}):e.jsx(At,{size:12})})]})]},n.id)})})]})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Current Members"}),e.jsx("div",{className:"col",style:{gap:0,border:"1px solid var(--border)"},children:i.length===0?e.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--muted)",fontSize:13},children:"No members yet"}):i.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"10px 12px",borderBottom:"1px solid var(--divider)",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,style:{width:32,height:32,borderRadius:"50%"}}):e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"var(--panel)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:n.username[0]}),e.jsxs("div",{className:"col",style:{gap:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username}),e.jsxs("div",{className:"muted",style:{fontSize:11,textTransform:"capitalize"},children:[n.role," ",n.invited_at&&!n.joined_at&&"(Pending Invite)"]})]})]}),e.jsx("div",{className:"row",style:{gap:8},children:n.user_id!==(o==null?void 0:o.id)&&(n.role!=="owner"||o.id===r.owner_id)&&e.jsx("button",{type:"button",onClick:()=>zt(n.user_id),title:"Remove Member",style:{background:"transparent",border:"none",color:"var(--danger)",cursor:"pointer",padding:4},children:e.jsx(be,{size:16})})})]},n.user_id))})]}),Y.length>0&&e.jsxs("div",{className:"col",style:{gap:8,marginTop:10},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--muted)"},children:"Blocked Users"}),e.jsx("div",{className:"col",style:{gap:0,border:"1px solid var(--border)"},children:Y.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",padding:"10px 12px",borderBottom:"1px solid var(--divider)",justifyContent:"space-between"},children:[e.jsx("div",{className:"row",style:{alignItems:"center",gap:10},children:e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.username})}),e.jsx("button",{type:"button",onClick:()=>Ke(n.user_id),title:"Unblock",style:{background:"transparent",border:"none",color:"var(--accent)",cursor:"pointer",padding:4},children:e.jsx(nt,{size:16})})]},n.user_id))})]})]})]})}),e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"1px solid var(--divider)",background:"rgba(255,255,255,0.02)"},children:[e.jsxs("div",{className:"row",style:{gap:12},children:[((o==null?void 0:o.is_mod)||(o==null?void 0:o.is_admin)||r.owner_id===(o==null?void 0:o.id))&&e.jsx("button",{type:"button",onClick:qt,disabled:ee||X,style:{background:"transparent",border:"none",color:"var(--danger)",fontSize:13,fontWeight:600,cursor:"pointer",padding:0},children:"Delete Queue"}),_t&&r.owner_id!==(o==null?void 0:o.id)&&e.jsx("button",{type:"button",onClick:It,disabled:ee||X,style:{background:"transparent",border:"none",color:"var(--danger)",fontSize:13,fontWeight:600,cursor:"pointer",padding:0},children:"Leave Queue"})]}),e.jsxs("div",{className:"row",style:{gap:12},children:[e.jsx("button",{type:"button",onClick:ke,disabled:X||ee,style:{background:"transparent",border:"1px solid var(--border)",color:"var(--text)",padding:"8px 20px",fontSize:13,fontWeight:600,cursor:"pointer",borderRadius:0},children:"Cancel"}),e.jsx("button",{type:"button",onClick:n=>{X||Ge({preventDefault:()=>{}})},disabled:X||ee,style:{background:"#667eea",border:"none",color:"#fff",padding:"8px 20px",fontSize:13,fontWeight:600,cursor:"pointer",borderRadius:0},children:X?"Saving...":"Save Changes"})]})]})]})}),document.body),kt&&he.createPortal(e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>je(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>je(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6},children:e.jsx(as,{content:R||"*No rules defined.*"})})]})}),document.body),e.jsx("style",{children:`
/* Hide inline submit form on mobile – mobile uses floating FAB instead */
html.is - mobile.queue - submit - desktop - only {
  display: none;
}

        .queue - member - avatar {
  width: 32px;
  height: 32px;
  border - radius: 9999px;
  padding: 0;
  border: 1px solid rgba(255, 255, 255, 0.08);
  overflow: hidden;
  cursor: pointer;
  background: transparent;
  display: inline - flex;
  align - items: center;
  justify - content: center;
  text - decoration: none;
  transition: border - color 0.2s;
}
        .queue - member - avatar:hover {
  border - color: rgba(167, 139, 250, 0.4);
}
        .queue - member - avatar img {
  width: 100 %;
  height: 100 %;
  object - fit: cover;
  display: block;
}
        .queue - member - tooltip {
  position: absolute;
  bottom: calc(100 % + 8px);
  left: 50 %;
  transform: translateX(-50 %);
  background: rgba(18, 20, 24, 0.95);
  color: var(--text, #e5e7eb);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border - radius: 6px;
  padding: 6px 10px;
  font - size: 14px;
  white - space: nowrap;
  z - index: 10000;
  pointer - events: none;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
}
        .queue - member - tooltip::after {
  content: '';
  position: absolute;
  top: 100 %;
  left: 50 %;
  transform: translateX(-50 %);
  width: 0;
  height: 0;
  border - left: 5px solid transparent;
  border - right: 5px solid transparent;
  border - top: 5px solid rgba(18, 20, 24, 0.95);
}
        .queue - status - badge {
  display: inline - flex;
  align - items: center;
  gap: 6px;
  padding: 6px 12px;
  border - radius: 12px;
  font - size: 12px;
  font - weight: 600;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
  border: 1px solid;
  cursor: pointer;
  transition: all 0.2s;
  white - space: nowrap;
}
        .queue - status - badge:disabled {
  cursor: not - allowed;
  opacity: 0.6;
}
        .queue - status - badge.status - open {
  background: rgba(52, 211, 153, 0.15);
  border - color: rgba(52, 211, 153, 0.4);
  color: #34d399;
}
        .queue - status - badge.status - open: hover: not(: disabled) {
  background: rgba(52, 211, 153, 0.25);
  border - color: rgba(52, 211, 153, 0.5);
}
        .queue - status - badge.status - closed {
  background: rgba(245, 158, 11, 0.15);
  border - color: rgba(245, 158, 11, 0.4);
  color: #f59e0b;
}
        .queue - status - badge.status - closed: hover: not(: disabled) {
  background: rgba(245, 158, 11, 0.25);
  border - color: rgba(245, 158, 11, 0.5);
}
`})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function vs(){const{data:t=[],isLoading:s}=Vt(),r=Zt(),u=es(),{notify:i}=le(),d=gt(),c=ve(),[b,h]=l.useState(new Set),{data:v}=qe(),[o,y]=l.useState(!1),[g,I]=l.useState(!1),[C,T]=l.useState(!1),_=l.useRef(null),k=l.useRef(null),L=!!(v!=null&&v.is_admin||v!=null&&v.is_mod);ts(_,k,o,()=>y(!1));const j=async x=>{r.mutate(x,{onSuccess:()=>{}})},w=async x=>{x.startsWith("n:")&&u.mutate(x)},A=async()=>{const x=t.filter(N=>!N.read&&(N.id.startsWith("n:")||N.kind==="system"&&!N.id.startsWith("b:"))).map(N=>N.id);x.length>0&&(await j(x),i("All notifications marked as read",{variant:"success"}))},J=x=>{if(!x)return null;try{const N=JSON.parse(x);if((N==null?void 0:N.type)==="queue_invite"&&(N!=null&&N.queue_id))return N}catch{}return null},R=async(x,N)=>{if(!b.has(x.id)){h(f=>new Set(f).add(x.id));try{await q(z.moddi.queueAccept(String(N)),{method:"POST"}),i("Invitation accepted!",{variant:"success"}),w(x.id),d(`/queues/${N}`)}catch(f){i((f==null?void 0:f.message)||"Failed to accept invitation",{variant:"error"})}finally{h(f=>{const W=new Set(f);return W.delete(x.id),W})}}},F=async(x,N)=>{if(!b.has(x.id)){h(f=>new Set(f).add(x.id));try{await q(z.moddi.queueDeny(String(N)),{method:"POST"}),i("Invitation declined",{variant:"success"}),w(x.id)}catch(f){i((f==null?void 0:f.message)||"Failed to decline invitation",{variant:"error"})}finally{h(f=>{const W=new Set(f);return W.delete(x.id),W})}}},H=x=>J(x.text)?e.jsx(bt,{size:20,color:"#a78bfa"}):x.kind==="star"?e.jsx(it,{size:20,color:"#f59e0b"}):x.kind==="likes5"?e.jsx(ot,{size:20,color:"#f472b6"}):x.kind==="comment"?e.jsx(fe,{size:20,color:"#60a5fa"}):x.kind==="inspiration"?e.jsx(fe,{size:20,color:"#7dd3fc"}):x.kind==="reaction"?e.jsx(lt,{size:20,color:"#10b981"}):x.id.startsWith("b:")?e.jsx(dt,{size:20,color:"#a78bfa"}):null,$=x=>J(x.text)?"Queue Invitation":x.kind==="star"?"Star":x.kind==="likes5"?"Likes":x.kind==="comment"?"Comment":x.kind==="inspiration"?"Inspiration":x.kind==="reaction"?"Reaction":x.id.startsWith("b:")?"Global":"System",ee=t.filter(x=>!x.read&&!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).length,O=async x=>{if(!(!(v!=null&&v.id)||C)){T(!0);try{const N={kind:x};x==="system"&&(N.text="Test system notification"),await q(z.admin.notificationsTest,{method:"POST",body:JSON.stringify(N)}),i("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(N){i((N==null?void 0:N.message)||"Failed to send test notification",{variant:"error"})}finally{T(!1),y(!1),I(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[L&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:_,className:"btn secondary",onClick:()=>y(!o),disabled:C,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(rt,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(pe,{size:14,style:{transition:"transform 0.2s ease",transform:o?"rotate(180deg)":"rotate(0deg)"}})]}),o&&e.jsxs("div",{ref:k,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("star"),disabled:C,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("likes5"),disabled:C,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("comment"),disabled:C,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("inspiration"),disabled:C,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("reaction"),disabled:C,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("system"),disabled:C,children:"Test System"})]})]}),ee>0&&e.jsxs("button",{className:"btn secondary",onClick:A,children:[e.jsx(at,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),L&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>I(!0),children:e.jsx(rt,{size:22})}),e.jsx(We,{open:g,onClose:()=>I(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>O("star"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(it,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("likes5"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(ot,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("comment"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(fe,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("inspiration"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(fe,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("reaction"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(lt,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("system"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(dt,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(x=>!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).map(x=>{const N=({notif:f})=>{const[W,X]=l.useState(0),[me,ae]=l.useState(!1),se=l.useRef(null),ge=l.useRef(null),E=l.useRef(null),G=l.useRef(null),Z=p=>{f.id.startsWith("n:")&&(se.current=p.touches[0].clientX,G.current=p.touches[0].clientY,ge.current=Date.now(),ae(!1))},ne=p=>{if(se.current===null||G.current===null||!f.id.startsWith("n:"))return;const M=p.touches[0].clientX,B=p.touches[0].clientY,Y=M-se.current,K=Math.abs(B-G.current);Math.abs(Y)>K&&(ae(!0),X(Math.max(-80,Math.min(0,Y))))},Q=()=>{if(se.current===null)return;W<=-60&&w(f.id),X(0),ae(!1),se.current=null,G.current=null,ge.current=null},ie=f.id.startsWith("n:"),a=typeof f.targetPath=="string"&&f.targetPath.trim().length>0?f.targetPath.trim():null;return e.jsxs("div",{ref:E,style:{position:"relative",background:f.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:a?"pointer":"default",opacity:f.read?.7:1,transform:`translateX(${W}px)`,transition:me?"none":"transform 0.2s ease",touchAction:ie?"pan-x pan-y":"pan-y"},onTouchStart:Z,onTouchMove:ne,onTouchEnd:Q,onTouchCancel:Q,onClick:()=>{if(!(Math.abs(W)>10)){if(!f.read&&f.id.startsWith("n:")&&j([f.id]),a){d(a);return}f.videoId&&(window.location.hash="/feed")}},children:[ie&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(W)/80,pointerEvents:"none",zIndex:0},children:e.jsx(be,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:H(f)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:$(f)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(f.createdAt).toLocaleDateString()}),f.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:p=>{p.stopPropagation(),w(f.id)},style:{padding:4},children:e.jsx(be,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const p=J(f.text);return p?`${p.inviter_username} invited you to join queue: ${p.queue_name}`:f.text||(f.kind==="star"?"One of your posts was starred!":f.kind==="likes5"?"One of your posts reached 5 likes!":f.kind==="comment"?"Someone commented on your post":f.kind==="inspiration"?"Someone is inspired by you!":f.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const p=J(f.text);return p&&!b.has(f.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:M=>{M.stopPropagation(),R(f,p.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(at,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:M=>{M.stopPropagation(),F(f,p.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Wt,{size:14,style:{marginRight:4}}),"Decline"]})]}):p&&b.has(f.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),f.read&&f.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(f.readAt).toLocaleString()]})]})]})]},f.id)};return e.jsx(N,{notif:x},x.id)})})})]})}const Le={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"},subdivisions:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},is=["nominator","subdivision","subdivisions"];function os({queue:t}){const r=(t.tags||t.type||"modding").split(",").map(d=>d.trim().toLowerCase()).filter(Boolean).map(d=>d==="modder"?"modding":d==="subdivisions"?"subdivision":d),u=r.find(d=>is.includes(d)),i=u?[u==="subdivisions"?"subdivision":u]:r.filter(d=>Le[d]);return e.jsx(Ce,{to:`/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.04)",onMouseLeave:d=>d.currentTarget.style.background="var(--panel)",children:[t.banner_stream_uid&&e.jsxs("div",{style:{position:"absolute",inset:0,zIndex:0,opacity:.12,pointerEvents:"none",overflow:"hidden"},children:[t.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:t.banner_stream_uid.slice(4),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("img",{src:`https://videodelivery.net/${t.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to bottom, transparent, var(--panel))"}})]}),e.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:4,flexWrap:"wrap",justifyContent:"flex-end",maxWidth:"50%"},children:[i.map(d=>{const c=Le[d]||Le.modding;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:c.bg,color:c.color,border:c.border},children:d},d)}),(t.is_open??1)===1?e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(16, 185, 129, 0.12)",color:"#10b981",border:"1px solid rgba(16, 185, 129, 0.2)"},children:"Open"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(239, 68, 68, 0.12)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)"},children:"Closed"})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(ft,{size:18}):e.jsx(fe,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(De,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12,position:"relative",zIndex:1},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const d=t.member_count||0;return d===0?null:d===1&&t.first_member_username?` and ${t.first_member_username}`:d>1?` & ${d} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function ls({isOpen:t,onClose:s,anchorRef:r}){const{notify:u}=le(),{data:i}=qe(),{data:d=[]}=ze(),c=jt(),[b,h]=l.useState(""),[v,o]=l.useState(""),[y,g]=l.useState(["modding"]),I=l.useRef(null),C=i?d.some(j=>j.owner_id===i.id):!1,T=(i==null?void 0:i.is_admin)||(i==null?void 0:i.is_mod);l.useEffect(()=>{if(!t)return;const j=w=>{const A=w.target;I.current&&!I.current.contains(A)&&(r!=null&&r.current)&&!r.current.contains(A)&&s()};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[t,s,r]);const _=j=>{if(Fe.includes(j)){y.includes(j)?g(["modding"]):g([j]);return}const w=y.filter(A=>pt.includes(A));if(w.includes(j)){const A=w.filter(J=>J!==j);if(A.length===0)return;g(A)}else g([...w,j])},k=async j=>{if(j.preventDefault(),C){u("You can only create one queue",{variant:"error"});return}if(!b.trim()){u("Queue name is required",{variant:"error"});return}c.mutate({name:b.trim(),description:v.trim()||null,is_group:!1,tags:y.join(",")},{onSuccess:()=>{u("Queue created!",{variant:"success"}),s(),h(""),o(""),g(["modding"])},onError:w=>{u((w==null?void 0:w.message)||"Failed to create queue",{variant:"error"})}})};if(!t)return null;const L=y.some(j=>Fe.includes(j));return e.jsx("div",{ref:I,className:"create-queue-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:C?e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsx("form",{onSubmit:k,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:b,onChange:j=>h(j.target.value),maxLength:100,required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("textarea",{placeholder:"Description (optional)",value:v,onChange:j=>o(j.target.value),maxLength:500,rows:2,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",outline:"none"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:pt.map(j=>{const w=y.includes(j),A=L;return e.jsx("button",{type:"button",onClick:()=>_(j),disabled:A,style:{background:w?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:w?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:w?"#667eea":A?"var(--muted)":"var(--text)",cursor:A?"not-allowed":"pointer",transition:"all 0.15s",fontWeight:w?500:400,opacity:A?.5:1,textTransform:"capitalize"},children:j},j)})}),T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:10,color:"var(--muted)",marginTop:10,marginBottom:6,fontWeight:500},children:"Admin Only"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:Fe.map(j=>{const w=y.includes(j);return e.jsx("button",{type:"button",onClick:()=>_(j),style:{background:w?"rgba(139, 92, 246, 0.2)":"rgba(255,255,255,0.05)",border:w?"1px solid #a78bfa":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:w?"#a78bfa":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:w?500:400,textTransform:"capitalize"},children:j},j)})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:4},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c.isPending||!b.trim(),style:{background:b.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:b.trim()?"pointer":"not-allowed"},children:c.isPending?"Creating...":"Create"})]})]})})})}function ds(){const[t,s]=re.useState(!1),[r,u]=re.useState(""),[i,d]=re.useState(""),{data:c=[]}=ze(),{data:b}=qe(),{notify:h}=le(),v=jt(),o=re.useMemo(()=>b?c.some(g=>g.owner_id===b.id):!1,[b,c]),y=g=>{if(g&&g.preventDefault(),o){h("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!r.trim()){h("Queue name is required",{variant:"error"});return}v.mutate({name:r.trim(),description:i.trim()||null,is_group:!1},{onSuccess:()=>{h("Queue created!",{variant:"success"}),s(!1),u(""),d("")},onError:I=>{h((I==null?void 0:I.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>s(!0),children:e.jsx(xe,{size:22})}),e.jsx(We,{open:t,onClose:()=>s(!1),children:e.jsxs("form",{onSubmit:y,className:"col",style:{gap:12},children:[o?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:r,onChange:g=>u(g.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:i,onChange:g=>d(g.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:v.isPending||o,children:v.isPending?"Creating...":"Create"})]})]})})]})}const cs=[{id:"queues",label:"Queues"},{id:"submissions",label:"Submissions"}];function js(){const[t,s]=Pt(),r=t.get("tab")||"queues",[u,i]=l.useState(r),{data:d=[],isLoading:c}=ze(),{data:b}=qe(),{queueTypeFilters:h}=Ae(),{notify:v}=le(),[o,y]=l.useState(!1),g=l.useRef(null),[I,C]=l.useState([]),[T,_]=l.useState(!1);l.useEffect(()=>{u==="submissions"&&k()},[u]);const k=async()=>{try{_(!0);const R=await q(z.moddi.mySubmissions);C(R.items)}catch(R){console.error(R),v("Failed to load submissions",{variant:"error"})}finally{_(!1)}},L=R=>{i(R),s(R==="queues"?{}:{tab:R})},j=l.useMemo(()=>d.filter(F=>{const H=F.type||"modder";return H==="modder"&&h.modder||(H==="nominator"||H==="subdivision")&&h.nominator||H==="timing"&&h.timing||H==="audio"&&h.audio}).sort((F,H)=>{const $=(F.is_open??1)===1,ee=(H.is_open??1)===1;return $&&!ee?-1:!$&&ee?1:0}),[d,h]),w=R=>{C(F=>F.map(H=>H.id===R.id?{...H,...R}:H))},A=R=>{C(F=>F.filter(H=>H.id!==R))},J=e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:g,onClick:()=>y(!o),style:{width:48,height:"100%",minHeight:48,background:o?"rgba(255,255,255,0.05)":"transparent",border:"none",color:"var(--text)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},onMouseEnter:R=>{o||(R.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:R=>{o||(R.currentTarget.style.backgroundColor="transparent")},title:"Create queue",children:e.jsx(xe,{size:18})}),e.jsx(ls,{isOpen:o,onClose:()=>y(!1),anchorRef:g})]});return e.jsxs("div",{className:"feed-container unified-queues",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0},children:[e.jsx(Be,{tabs:cs,activeTab:u,onChange:L,rightAction:J}),u==="queues"&&e.jsxs(e.Fragment,{children:[e.jsx(ds,{}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsx("div",{className:"col",style:{gap:0},children:c?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):j.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):j.map(R=>e.jsx(os,{queue:R},R.id))})}),e.jsx(wt,{context:"moddi-queues"})]}),u==="submissions"&&e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:T?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):I.length===0?e.jsxs("div",{style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx("button",{className:"btn",style:{marginTop:16},onClick:()=>L("queues"),children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:0},children:I.map(R=>e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(Ce,{to:`/queues/${R.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:F=>F.currentTarget.style.textDecoration="underline",onMouseLeave:F=>F.currentTarget.style.textDecoration="none",children:R.queue_name}),R.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(R.created_at*1e3).toLocaleDateString()})]}),e.jsx(Ee,{submission:R,canManage:!1,allowSelfActions:!0,onUpdate:w,onDelete:A})]},R.id))})})]})}export{z as A,wt as D,vs as N,De as O,ys as Q,Be as T,js as U,bs as a,qe as b,le as c,q as d,ts as e,hs as f,Kt as g,xs as h,Zt as i,es as j,yt as k,Vt as l,ht as m,gs as n,Gt as o,ms as p,fs as q,Ae as u};
