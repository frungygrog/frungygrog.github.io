import{s as _t,t as ze,v as ke,w as Be,r as i,e as ct,R as re,j as e,c as Ce,x as ut,l as fe,d as Pe,y as Ae,z as Tt,B as Ct,o as mt,u as $e,q as pt,L as gt,C as zt,D as Te,E as Ee,G as Qe,k as Se,f as Ge,H as Xe,I as Ze,J as we,K as Ft,M as ft,N as It,O as qt,P as Ve,Q as et,A as tt,h as st,S as at,T as nt}from"./vendor-react-CcFPULbg.js";import{a as L,A as I,g as Mt,u as xe,b as ht,P as bt,C as Rt,O as He,c as Lt}from"./mappi-routes-By7v_liC.js";import{i as Et,a as Pt,b as Bt,c as At}from"./editor-components-COwEyuAl.js";import{B as xt}from"./editor-DFVt6kvD.js";const Ot=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{standard:s.has("standard")||s.size===0,taiko:s.has("taiko"),mania:s.has("mania"),catch:s.has("catch")}}catch{return{standard:!0,taiko:!1,mania:!1,catch:!1}}},Dt=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{untagged:s.has("untagged")||s.size===0,help:s.has("help")||s.size===0}}catch{return{untagged:!0,help:!0}}},Ut=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{unchecked:s.has("unchecked")||s.size===0,accepted:s.has("accepted")||s.size===0,denied:s.has("denied")||s.size===0,finished:s.has("finished")||s.size===0,archived:s.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Wt=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{open:s.has("open")||s.size===0,closed:s.has("closed")}}catch{return{open:!0,closed:!1}}},Qt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{modder:s.has("modder")||s.size===0,nominator:s.has("nominator")||s.size===0}}catch{return{modder:!0,nominator:!0}}},$t=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Ht=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Fe=_t(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Ot(),tagFilters:Dt(),queueStatusFilters:Ut(),queueOpenFilters:Wt(),queueTypeFilters:Qt(),lastSection:$t(),previousLocation:null,theme:Ht(),setMenuOpen:s=>t({menuOpen:s}),setMobileNavOpen:s=>t({mobileNavOpen:s}),setNotifOpen:s=>t({notifOpen:s}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:s=>{t({modeFilters:s});try{const c=Object.entries(s).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["standard"];localStorage.setItem("filter_modes",l.join(","))}catch{}},setTagFilters:s=>{t({tagFilters:s});try{const c=Object.entries(s).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["untagged","help"];localStorage.setItem("filter_moddi_tags",l.join(","))}catch{}},setQueueStatusFilters:s=>{t({queueStatusFilters:s});try{const c=Object.entries(s).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",l.join(","))}catch{}},setQueueOpenFilters:s=>{t({queueOpenFilters:s});try{const c=Object.entries(s).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["open"];localStorage.setItem("filter_queue_open",l.join(","))}catch{}},setQueueTypeFilters:s=>{t({queueTypeFilters:s});try{const c=Object.entries(s).filter(([d,m])=>m).map(([d])=>d),l=c.length?c:["modder","nominator"];localStorage.setItem("filter_queue_type",l.join(","))}catch{}},setLastSection:s=>{t({lastSection:s});try{s?localStorage.setItem("last_section",s):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:s=>{t({previousLocation:s})},setTheme:s=>{t({theme:s});try{localStorage.setItem("theme",s)}catch{}}}));function Yt(t=!0){return ze({queryKey:["notifications"],queryFn:async()=>{try{const s=await L(I.user.notifications);return Array.isArray(s.items)?s.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Kt(){return ze({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await L("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function us(){const{data:t=[]}=Yt();return t.filter(s=>s.kind==="system"&&s.id.startsWith("b:")&&(s.expiresAt||0)<=Date.now()?!1:!s.read).length}function Jt(){const t=ke();return Be({mutationFn:async s=>{await L(I.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:s})})},onSuccess:()=>{t.setQueryData(["notifications"],s=>(s==null?void 0:s.map(a=>({...a,read:!0})))||[])}})}function Gt(){const t=ke();return Be({mutationFn:async s=>{const a=Mt();await L(I.user.deleteNotification(s),{method:"DELETE",headers:{"X-CSRF-Token":a}})},onSuccess:(s,a)=>{t.setQueryData(["notifications"],c=>(c==null?void 0:c.filter(l=>l.id!==a))||[]),t.setQueryData(["notifications","detailed"],c=>(c==null?void 0:c.filter(l=>l.id!==a))||[])}})}function Ie(){return ze({queryKey:["user","me"],queryFn:async()=>{try{return await L(I.auth.me)}catch{return null}},staleTime:5*60*1e3})}function ms(t=!0){return ze({queryKey:["user","quota"],queryFn:async()=>{try{return await L(I.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function ps(){const t=ke();return Be({mutationFn:async()=>{await L(I.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function Xt(t,s,a,c){i.useEffect(()=>{if(!a)return;const l=d=>{const m=d.target;s.current&&!s.current.contains(m)&&t.current&&!t.current.contains(m)&&c()};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[a,c,t,s])}const Zt=({context:t,onClose:s,style:a})=>{const c=ct(),l=re.useMemo(()=>{if(t)return t;const M=c.pathname;return M==="/mp/feed"?"mappi-feed":M==="/md/feed"?"moddi-feed":M==="/md/queues"?"moddi-queues":M.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,c.pathname]),{modeFilters:d,setModeFilters:m,tagFilters:_,setTagFilters:w,queueOpenFilters:k,setQueueOpenFilters:o,queueStatusFilters:v,setQueueStatusFilters:b,queueTypeFilters:T,setQueueTypeFilters:E}=Fe(),z=M=>{const p={...d,[M]:!d[M]};Object.values(p).some(Boolean)||(p.standard=!0),m(p);try{window.dispatchEvent(new Event("filterchange"))}catch{}},C=M=>{const p={..._,[M]:!_[M]};!p.untagged&&!p.help&&(p.help=!0),w(p);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},j=M=>{const p={...k,[M]:!k[M]};!p.open&&!p.closed&&(p.open=!0),o(p)},q=M=>{const p={...v,[M]:!v[M]};["unchecked","accepted","denied","finished"].some(h=>p[h])||(p.unchecked=!0),b(p)},P=M=>{const p={...T,[M]:!T[M]};!p.modder&&!p.nominator&&(p.modder=!0),E(p)},U=({title:M,children:p})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:M}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:p})]}),D=({active:M,onClick:p,label:se})=>e.jsx("button",{type:"button",onClick:p,className:"chip","aria-pressed":M,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:M?"rgba(125,211,252,0.6)":"var(--border)",background:M?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:se});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{zIndex:1e4,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...a},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),s&&e.jsx("button",{className:"icon-link",onClick:s,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(Ce,{size:16})})]}),l==="mappi-feed"&&e.jsxs(U,{title:"Gamemode",children:[e.jsx(D,{active:d.standard,onClick:()=>z("standard"),label:"Standard"}),e.jsx(D,{active:d.taiko,onClick:()=>z("taiko"),label:"Taiko"}),e.jsx(D,{active:d.mania,onClick:()=>z("mania"),label:"Mania"}),e.jsx(D,{active:d.catch,onClick:()=>z("catch"),label:"Catch"})]}),l==="moddi-feed"&&e.jsxs(U,{title:"Tags",children:[e.jsx(D,{active:_.untagged,onClick:()=>C("untagged"),label:"Untagged"}),e.jsx(D,{active:_.help,onClick:()=>C("help"),label:"Help"})]}),l==="moddi-queues"&&e.jsxs(e.Fragment,{children:[e.jsxs(U,{title:"Status",children:[e.jsx(D,{active:k.open,onClick:()=>j("open"),label:"Open"}),e.jsx(D,{active:k.closed,onClick:()=>j("closed"),label:"Closed"})]}),e.jsxs(U,{title:"Type",children:[e.jsx(D,{active:T.modder,onClick:()=>P("modder"),label:"Modder"}),e.jsx(D,{active:T.nominator,onClick:()=>P("nominator"),label:"Nominator"})]})]}),l==="moddi-queue-detail"&&e.jsxs(U,{title:"Submissions",children:[e.jsx(D,{active:v.unchecked,onClick:()=>q("unchecked"),label:"Pending"}),e.jsx(D,{active:v.accepted,onClick:()=>q("accepted"),label:"Accepted"}),e.jsx(D,{active:v.denied,onClick:()=>q("denied"),label:"Denied"}),e.jsx(D,{active:v.finished,onClick:()=>q("finished"),label:"Finished"})]})]})},rt={standard:At,taiko:Bt,mania:Pt,catch:Et},it={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},Vt=({value:t,onChange:s})=>{const[a,c]=i.useState(!1),l=i.useRef(null);i.useEffect(()=>{if(!a)return;const m=w=>{l.current&&!l.current.contains(w.target)&&c(!1)},_=w=>{w.key==="Escape"&&c(!1)};return document.addEventListener("mousedown",m),document.addEventListener("keydown",_),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("keydown",_)}},[a]);const d=m=>e.jsxs("button",{className:`mode-option${m===t?" selected":""}`,onClick:()=>{s(m),c(!1)},role:"option","aria-selected":m===t,children:[e.jsx("img",{className:"mode-icon",src:rt[m],width:24,height:24,alt:""}),e.jsx("span",{children:it[m]})]},m);return e.jsxs("div",{className:"mode-select",ref:l,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":a,onClick:()=>c(m=>!m),children:[e.jsx("img",{className:"mode-icon",src:rt[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:it[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),a&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(d)})]})};function ot(t){if(!t)return"standard";const s=String(t).toLowerCase().trim();return s==="osu"||s==="0"||s==="standard"?"standard":s==="taiko"||s==="1"?"taiko":s==="catch"||s==="fruits"||s==="2"?"catch":s==="mania"||s==="3"?"mania":"standard"}function yt({section:t,onUpload:s,onPost:a,forceExpanded:c}){const{notify:l}=xe(),d=t==="mappi",[m,_]=i.useState(!1),[w,k]=i.useState(""),[o,v]=i.useState(null),[b,T]=i.useState(null),[E,z]=i.useState(!1),[C,j]=i.useState(""),q=i.useRef(0),[P,U]=i.useState(""),[D,M]=i.useState("standard"),[p,se]=i.useState(null),[h,Y]=i.useState(0),[ne,J]=i.useState(""),[x,R]=i.useState(""),[f,W]=i.useState(null),[ue,me]=i.useState(""),[ce,G]=i.useState(""),[A,X]=i.useState(null),[ae,oe]=i.useState(!1),[V,pe]=i.useState(null),n=100*1024*1024,y=i.useMemo(()=>p?`${p.name}:${p.size}:${p.lastModified}`:null,[p]),[N,B]=i.useState(""),[Z,ee]=i.useState(!1),[O,ye]=i.useState([]),Ne=i.useRef(null);i.useEffect(()=>{q.current&&window.clearTimeout(q.current);const F=(w||"").trim();if(!F){j(""),v(null),T(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(F)){j(""),v(null),T(null);return}return q.current=window.setTimeout(async()=>{var S;try{let $;try{$=new URL(F)}catch{j("Invalid URL format");return}const te=$.hash.match(/#osu\/(\d+)/),K=te?te[1]:null;$.hash="";const Me={url:$.toString()};K&&(Me.beatmap_id=K);const de=await L(I.osu.resolveBeatmap+ht(Me),{requireAuth:!1}),be=Array.isArray(de==null?void 0:de.diffs)?de.diffs:[];if(!be.length&&!de.setId){j("No difficulties found"),v(null),T(null);return}if(v({setId:Number(de.setId)||0,beatmapId:de.beatmapId??null,title:String(de.title||""),artist:String(de.artist||""),mapper:String(de.mapper||""),diffs:be}),be.length>0){const he=Number.isFinite(Number(de.beatmapId))?Number(de.beatmapId):Number((S=be[0])==null?void 0:S.id),ge=be.find(Ue=>Number(Ue.id)===he)||be[0],Re=ot(ge==null?void 0:ge.mode);T({beatmapId:Number(ge==null?void 0:ge.id)||null,version:String((ge==null?void 0:ge.version)||""),mode:Re}),d&&M(Re)}else T(null);j("")}catch($){const te=($==null?void 0:$.message)||"Unknown error";j(`Failed to resolve: ${te}`),v(null),T(null)}},400),()=>{q.current&&window.clearTimeout(q.current)}},[w,d]);async function ve(){return R("info"),J("Requesting upload URL..."),await L(I.uploads.new,{method:"POST",body:JSON.stringify({description:P.slice(0,100),beatmap_url:w||void 0,size_bytes:(p==null?void 0:p.size)??void 0,mode:D,beatmapset_id:(o==null?void 0:o.setId)??void 0,beatmap_id:(b==null?void 0:b.beatmapId)??void 0,beatmap_version:(b==null?void 0:b.version)??void 0,beatmap_title:o?`${o.title}`:void 0,beatmap_artist:o?`${o.artist}`:void 0,beatmap_mapper:o?`${o.mapper}`:void 0})})}async function je(F,Q,S="form"){await new Promise(($,te)=>{const K=new XMLHttpRequest;if(K.open("POST",F),K.upload.onprogress=le=>{le.lengthComputable&&Y(Math.round(le.loaded/le.total*100))},K.onload=()=>K.status>=200&&K.status<300?$():te(new Error(`Upload failed (${K.status}) ${K.responseText||""}`)),K.onerror=()=>te(new Error("Network error")),S==="form"){const le=new FormData;le.append("file",Q,Q.name),K.send(le)}else K.setRequestHeader("Content-Type","application/octet-stream"),K.send(Q)})}async function De(){if(!(!p||!d)){if(p.size>n){me("File exceeds 100MB limit");return}if(typeof A=="number"&&A>60.5){G("Clip exceeds 60s limit");return}y&&(oe(!0),pe(y)),Y(0),R("info");try{const F=await ve();W(F.streamUID);let Q=F.streamUID;try{J("Uploading..."),await je(F.uploadURL,p,"form")}catch(S){R("warn"),J(`Retrying upload... (${(S==null?void 0:S.message)||S})`);const $=await ve();W($.streamUID),Q=$.streamUID,await je($.uploadURL,p,"binary")}R("info"),J("Processing...");for(let S=0;S<60;S++){await new Promise($=>setTimeout($,3e3));try{if((await L(I.videos.get(Q),{requireAuth:!1})).status==="ready"){R("success"),J("Ready!"),l("Upload complete!",{variant:"success"}),se(null),U(""),k(""),v(null),T(null),M("standard"),Y(0),W(null),me(""),G(""),X(null),oe(!1),pe(null),s&&s();break}}catch{}}}catch(F){R("error"),J(F.message||"Error"),l(F.message||"Upload failed",{variant:"error"})}}}const qe=async F=>{if(F.preventDefault(),!d){if(!N.trim()){l("Text is required",{variant:"error"});return}if(N.length>200){l("Text must be 200 characters or less",{variant:"error"});return}ee(!0);try{const Q=await L(I.moddi.posts,{method:"POST",body:JSON.stringify({text:N.trim(),beatmap_url:w.trim()||void 0,beatmapset_id:(o==null?void 0:o.setId)??void 0,beatmap_id:(b==null?void 0:b.beatmapId)??(o==null?void 0:o.beatmapId)??void 0,beatmap_version:(b==null?void 0:b.version)??void 0,tags:O.length>0?O.join(","):void 0})});if(Q){console.log("Post created response:",Q);const S=Q==null?void 0:Q.post;S?(!S.uid&&S.id&&(console.warn("Created post missing uid, using id as fallback:",S),S.uid=String(S.id)),a&&a(S)):a&&a(),l("Post created!",{variant:"success"}),B(""),k(""),v(null),T(null),j(""),z(!1),ye([])}}catch{l("Failed to create post",{variant:"error"})}finally{ee(!1)}}},_e=!!c||m;return e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:d?12:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:c?"default":"pointer",padding:"8px 12px",minHeight:36},onClick:()=>{c||_(!m)},children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:d?"Upload a clip":"Create a post!"}),_e?e.jsx(ut,{size:16}):e.jsx(fe,{size:16})]}),_e&&e.jsx("div",{style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.4,marginBottom:12},children:"Max: 60s, 100MB. Only osu! mapping content is permitted."}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Game mode:"}),e.jsx(Vt,{value:D,onChange:M})]}),o?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[o.artist," – ",o.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",o.mapper]})]}),o.diffs.length>0&&e.jsx("select",{value:(b==null?void 0:b.beatmapId)??o.beatmapId??void 0,onChange:F=>{const Q=Number(F.target.value),S=(o==null?void 0:o.diffs.find($=>Number($.id)===Q))||null;if(S){const $=ot(S.mode);T({beatmapId:Q,version:S.version,mode:$}),M($)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"4px 8px",fontSize:12},children:o.diffs.map(F=>e.jsxs("option",{value:F.id,children:[F.version," (",F.mode,")"]},F.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>z(!0),style:{padding:"6px 12px",fontSize:13},children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{v(null),T(null),k("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:w,onChange:F=>k(F.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:P,onChange:F=>U(F.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:64}}),C&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:C}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("input",{type:"file",accept:"video/*",onChange:F=>{var $;const Q=(($=F.target.files)==null?void 0:$[0])||null;if(se(Q),X(null),Q&&Q.size>n?me("File exceeds 100MB limit"):me(""),Q)try{const te=URL.createObjectURL(Q),K=document.createElement("video");K.preload="metadata",K.src=te,K.onloadedmetadata=()=>{URL.revokeObjectURL(te);const le=Number.isFinite(K.duration)?K.duration:NaN;Number.isFinite(le)&&X(le),Number.isFinite(le)&&le>60.5?G("Clip exceeds 60s limit"):G("")},K.onerror=()=>{URL.revokeObjectURL(te),X(null)}}catch{X(null)}else G("");const S=Q?`${Q.name}:${Q.size}:${Q.lastModified}`:null;S&&S!==V&&oe(!1)},style:{flex:1,minWidth:0}}),e.jsx("button",{className:"btn",onClick:De,disabled:!p||!!ue||!!ce||ae,style:{flexShrink:0},children:"Upload"})]}),ue&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:ue}),ce&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:ce}),p&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Selected: ",p.name," • ",(p.size/1024/1024).toFixed(1)," MB",ae&&V===y?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(locked)"}):null]}),(h>0||ne)&&e.jsxs("div",{className:"upload-status",children:[ne&&e.jsx("div",{className:`chip ${x||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:ne}),h>0&&e.jsx("div",{className:"progress",style:{marginTop:8},"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":h,children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,Math.max(0,h))}%`}})})]}),f&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Stream UID: ",f]})]})]}):e.jsx("form",{onSubmit:qe,children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("textarea",{ref:Ne,placeholder:"Ask for feedback! Or, say anything! Woo! (max 200 chars)",value:N,onChange:F=>B(F.target.value),maxLength:200,rows:2,style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:50}}),o?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[o.artist," – ",o.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",o.mapper]})]}),o.diffs.length>0&&e.jsx("select",{value:(b==null?void 0:b.beatmapId)??o.beatmapId??void 0,onChange:F=>{const Q=Number(F.target.value),S=(o==null?void 0:o.diffs.find($=>Number($.id)===Q))||null;S&&T({beatmapId:Q,version:S.version,mode:String(S.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:o.diffs.map(F=>e.jsxs("option",{value:F.id,children:[F.version," (",F.mode,")"]},F.id))})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:w,onChange:F=>k(F.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),C&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:C}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("span",{className:"muted",style:{fontSize:11},children:"Tags:"}),e.jsx("button",{type:"button",onClick:()=>{O.includes("help")?ye(O.filter(F=>F!=="help")):ye([...O,"help"])},style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:O.includes("help")?"rgba(234, 179, 8, 0.2)":"rgba(255,255,255,0.05)",border:O.includes("help")?"1px solid rgba(234, 179, 8, 0.4)":"1px solid rgba(255,255,255,0.12)",color:O.includes("help")?"#fbbf24":"var(--text)",fontWeight:500,lineHeight:1.2,cursor:"pointer",transition:"all 0.15s ease"},children:"Help"})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>z(!0),children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{v(null),T(null),k("")},children:"Clear"})]}),e.jsx("button",{type:"submit",className:"btn",disabled:Z||!N.trim()||N.length>200,children:Z?"Posting...":"Post"})]})]})})}),E&&o&&e.jsx(xt,{open:E,onClose:()=>z(!1),downloadUrl:I.osu.downloadBeatmapset(o.setId),beatmapId:(b==null?void 0:b.beatmapId)??o.beatmapId??void 0,beatmapVersion:b==null?void 0:b.version})]})}function Oe({open:t,onClose:s,children:a}){const c=i.useRef(null),l=i.useRef(null),d=i.useRef(!1),m=o=>{var v;l.current=((v=o.touches[0])==null?void 0:v.clientY)??null,d.current=!1},_=o=>{var E,z;if(l.current==null)return;const v=((E=o.touches[0])==null?void 0:E.clientY)??null;if(v==null)return;const b=v-l.current;(((z=c.current)==null?void 0:z.scrollTop)??0)<=0&&b>60?d.current=!0:d.current=!1},w=()=>{d.current&&s(),l.current=null,d.current=!1};if(!t)return null;const k=e.jsx("div",{className:"mobile-upload-overlay",onClick:s,children:e.jsx("div",{ref:c,className:"mobile-upload-sheet",onClick:o=>o.stopPropagation(),onTouchStart:m,onTouchMove:_,onTouchEnd:w,children:a})});return Pe.createPortal(k,document.body)}function es({section:t,onUpload:s,onPost:a}){const[c,l]=re.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":t==="mappi"?"Upload clip":"New post",title:t==="mappi"?"Upload clip":"New post",onClick:()=>l(!0),children:e.jsx(Ae,{size:22})}),e.jsx(Oe,{open:c,onClose:()=>l(!1),children:e.jsx("div",{style:{paddingTop:6},children:e.jsx(yt,{section:t,forceExpanded:!0,onUpload:()=>{s==null||s(),l(!1)},onPost:d=>{a==null||a(d),l(!1)}})})})]})}function ts(){const[t,s]=re.useState(!1);return re.useEffect(()=>{var l;const a=window.matchMedia("(max-width: 768px)"),c=()=>s(a.matches);return c(),(l=a.addEventListener)==null||l.call(a,"change",c),()=>{var d;return(d=a.removeEventListener)==null?void 0:d.call(a,"change",c)}},[]),t}const Ye=({context:t})=>{const s=ts(),[a,c]=re.useState(!1),l=re.useRef(null),d=12,m=18,o=84+56+12;return re.useEffect(()=>{const v=b=>{if(!a)return;const T=b.target;if(l.current&&l.current.contains(T))return;const E=document.getElementById("desktop-filters-panel");E&&E.contains(T)||c(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[a]),s?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:l,className:"desktop-fab",onClick:()=>c(v=>!v),"aria-haspopup":"dialog","aria-expanded":a,title:"Filters","aria-label":"Filters",children:e.jsx(Tt,{size:22})}),a&&e.jsx("div",{id:"desktop-filters-panel",style:{position:"fixed",right:m,bottom:o,zIndex:1e4},children:e.jsx(Zt,{context:t,onClose:()=>c(!1),style:{maxHeight:`calc(100vh - ${o+d}px)`,maxWidth:`calc(100vw - ${m+d}px)`,overflow:"auto"}})})]})};function ss(){const{data:t}=Ie(),{tagFilters:s}=Fe();return Ct({queryKey:["moddi","feed",s],queryFn:async({pageParam:a=0})=>{const c=new URLSearchParams({limit:"20",offset:String(a)}),l=`${I.moddi.posts}?${c.toString()}`;return await L(l)},enabled:!!t,initialPageParam:0,getNextPageParam:(a,c)=>{var m;const l=c.reduce((_,w)=>{var k;return _+(((k=w.items)==null?void 0:k.length)||0)},0);return(((m=a.items)==null?void 0:m.length)||0)===20?l:void 0}})}function gs(){const t=ct(),s=ke(),{data:a}=Ie(),{tagFilters:c}=Fe(),{data:l,fetchNextPage:d,hasNextPage:m,isFetching:_,isFetchingNextPage:w,refetch:k}=ss(),o=i.useMemo(()=>l!=null&&l.pages?l.pages.flatMap(j=>(j.items||[]).map(P=>({...P,user_id:P.user_id??0,username:P.username||"Unknown",avatar_url:P.avatar_url||null,text:P.text??null,uid:P.uid||String(P.id||""),reactions_count:Number(P.reactions_count??0),reacted_by_me:P.reacted_by_me??!1,comments_count:Number(P.comments_count??0)}))):[],[l]),v=i.useMemo(()=>o.filter(j=>{const q=j.tags?typeof j.tags=="string"?j.tags.split(",").map(D=>D.trim()):[]:[],P=!j.tags||q.length===0,U=q.includes("help");return c.untagged&&c.help?!0:c.untagged&&!c.help?P:!c.untagged&&c.help?U:!1}),[o,c]);i.useEffect(()=>{t.pathname==="/md/feed"&&k()},[t.pathname,k]),i.useEffect(()=>{const j=()=>{k()};return window.addEventListener("moddifilterchange",j),()=>window.removeEventListener("moddifilterchange",j)},[k]);const b=j=>{s.setQueryData(["moddi","feed"],q=>q&&{...q,pages:q.pages.map(P=>({...P,items:P.items.map(U=>U.id===j.id?j:U)}))})},T=j=>{s.setQueryData(["moddi","feed"],q=>q&&{...q,pages:q.pages.map(P=>({...P,items:P.items.filter(U=>U.id!==j)}))})},E=j=>{j&&s.setQueryData(["moddi","feed"],q=>{if(!q)return q;const P={...j,user_id:j.user_id??0,username:j.username||"Unknown",avatar_url:j.avatar_url||null,text:j.text??null,uid:j.uid||String(j.id||""),reactions_count:Number(j.reactions_count??0),reacted_by_me:j.reacted_by_me??!1,comments_count:Number(j.comments_count??0)};return{...q,pages:q.pages.map((U,D)=>D===0?{...U,items:[P,...U.items||[]]}:U)}}),s.invalidateQueries({queryKey:["moddi","feed"]}),k()},z=_&&!w,C=m??!1;return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Say anything! If you want help, tag it accordingly and others can raise their hand."}),e.jsx(yt,{section:"moddi",onPost:E})]}),e.jsx(es,{section:"moddi",onPost:E}),e.jsx(Ye,{context:"moddi-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[v.length===0&&!z&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to post!"}),v.map(j=>e.jsx(bt,{post:j,section:"moddi",onUpdate:b,onDelete:T,me:a},j.id)),v.length>0&&C&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>d(),disabled:w,children:w?"Loading...":"Load more"})})]})})]})}function fs(){const{uid:t}=mt(),s=$e(),[a,c]=i.useState(null),[l,d]=i.useState([]),[m,_]=i.useState(!0),[w,k]=i.useState(null),[o,v]=i.useState(""),[b,T]=i.useState(null),[E,z]=i.useState(!1),{notify:C}=xe();i.useEffect(()=>{L(I.auth.me,{requireAuth:!1}).then(h=>k(h)).catch(()=>{})},[]);const j=async()=>{if(!t||t==="null"||t==="undefined"){C("Invalid post identifier",{variant:"error"}),s("/md/feed");return}_(!0);try{const h=await L(I.moddi.post(t),{requireAuth:!1}),Y={...h,user_id:h.user_id??0,username:h.username||"Unknown",avatar_url:h.avatar_url||null,uid:h.uid||String(h.id)||t,text:h.text??null,beatmap_url:h.beatmap_url??null,beatmapset_id:h.beatmapset_id??null,beatmap_id:h.beatmap_id??null,beatmap_version:h.beatmap_version??null,tags:h.tags??null,reactions_count:Number(h.reactions_count??0),reacted_by_me:h.reacted_by_me??!1,comments_count:Number(h.comments_count??0)};c(Y)}catch{C("Failed to load post",{variant:"error"}),s("/md/feed")}finally{_(!1)}},q=async()=>{if(a!=null&&a.id)try{const h=await L(I.moddi.postComments(a.id),{requireAuth:!1});d(h.items||[])}catch{}};i.useEffect(()=>{j()},[t]),i.useEffect(()=>{a!=null&&a.id&&q()},[a==null?void 0:a.id]);const P=h=>{c(h)},U=()=>{s("/md/feed")},D=async h=>{if(h.preventDefault(),!(!o.trim()||!(a!=null&&a.id))){z(!0);try{await L(I.moddi.postComments(a.id),{method:"POST",body:JSON.stringify({text:o.trim(),parent_id:b||void 0})}),v(""),T(null),q(),j(),C("Comment posted!",{variant:"success"})}catch(Y){C((Y==null?void 0:Y.message)||"Failed to post comment",{variant:"error"})}finally{z(!1)}}},M=h=>{d(Y=>Y.filter(ne=>ne.id!==h))};if(m)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!a)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const p=l.filter(h=>!h.parent_id),se=new Map;return l.filter(h=>h.parent_id).forEach(h=>{const Y=h.parent_id;se.has(Y)||se.set(Y,[]),se.get(Y).push(h)}),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"post-detail-header",style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>s("/md/feed"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(pt,{size:20})}),e.jsx("span",{className:"hide-on-mobile",style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx(bt,{post:a,section:"moddi",onUpdate:P,onDelete:U,me:w})}),w&&!b&&e.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid var(--border-subtle)",borderRadius:6},children:e.jsxs("form",{onSubmit:D,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:o,onChange:h=>v(h.target.value),rows:1,style:{flex:1,background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:h=>{const Y=h.target;Y.style.height="auto",Y.style.height=`${Math.min(Y.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:E||!o.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:E?"...":"Post"})]})}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:p.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:p.map(h=>e.jsx(Rt,{comment:h,replies:se.get(h.id)||[],me:w,section:"moddi",onReply:Y=>T(Y),onDelete:M,replyingTo:b,replyText:o,onReplyTextChange:v,onReplySubmit:D,posting:E,onCancelReply:()=>{T(null),v("")},repliesMap:se},h.id))})})]})}function as({queue:t}){const s=t.type||"modder";return e.jsx(gt,{to:`/md/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:a=>a.currentTarget.style.background="rgba(255,255,255,0.02)",onMouseLeave:a=>a.currentTarget.style.background="rgba(255,255,255,0.01)",children:[e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:s==="nominator"?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.1)",color:s==="nominator"?"#a78bfa":"var(--muted)",border:s==="nominator"?"1px solid rgba(139, 92, 246, 0.3)":"1px solid rgba(255, 255, 255, 0.1)"},children:s==="nominator"?"Nominator":"Modder"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(zt,{size:18}):e.jsx(Te,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name}),(t.is_open??1)===1?e.jsx(Ee,{size:18,style:{color:"#10b981"}}):e.jsx(Qe,{size:18,style:{color:"#ef4444"}})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(He,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function Ke(){return ze({queryKey:["moddi","queues"],queryFn:async()=>{const t=await L(I.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function vt(){const t=ke();return Be({mutationFn:async s=>{var a;return await L(I.moddi.queues,{method:"POST",body:JSON.stringify({name:s.name.trim(),description:((a=s.description)==null?void 0:a.trim())||null,is_group:s.is_group??!1,type:s.type||"modder"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function ns(){const[t,s]=re.useState(!1),[a,c]=re.useState(""),[l,d]=re.useState(""),{data:m=[]}=Ke(),{data:_}=Ie(),{notify:w}=xe(),k=vt(),o=re.useMemo(()=>_?m.some(b=>b.owner_id===_.id):!1,[_,m]),v=b=>{if(b&&b.preventDefault(),o){w("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!a.trim()){w("Queue name is required",{variant:"error"});return}k.mutate({name:a.trim(),description:l.trim()||null,is_group:!1},{onSuccess:()=>{w("Queue created!",{variant:"success"}),s(!1),c(""),d("")},onError:T=>{w((T==null?void 0:T.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>s(!0),children:e.jsx(Ae,{size:22})}),e.jsx(Oe,{open:t,onClose:()=>s(!1),children:e.jsxs("form",{onSubmit:v,className:"col",style:{gap:12},children:[o?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:a,onChange:b=>c(b.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:l,onChange:b=>d(b.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:k.isPending||o,children:k.isPending?"Creating...":"Create"})]})]})})]})}function hs(){const{data:t=[],isLoading:s}=Ke(),{data:a}=Ie(),{queueOpenFilters:c,queueTypeFilters:l}=Fe(),d=vt(),{notify:m}=xe(),[_,w]=i.useState(!1),[k,o]=i.useState(""),[v,b]=i.useState(""),T=i.useMemo(()=>a?t.some(C=>C.owner_id===a.id):!1,[a,t]),E=async C=>{if(C.preventDefault(),T){m("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!k.trim()){m("Queue name is required",{variant:"error"});return}d.mutate({name:k.trim(),description:v.trim()||null,is_group:!1},{onSuccess:()=>{m("Queue created!",{variant:"success"}),w(!1),o(""),b("")},onError:j=>{m((j==null?void 0:j.message)||"Failed to create queue",{variant:"error"})}})},z=re.useMemo(()=>t.filter(C=>{const j=(C.is_open??1)===1;if(!(c.open&&c.closed||c.open&&!c.closed&&j||!c.open&&c.closed&&!j))return!1;const P=C.type||"modder";return P==="modder"&&l.modder||P==="nominator"&&l.nominator}),[t,c,l]);return e.jsxs("div",{className:"feed-container queues-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx(ns,{}),e.jsx(Ye,{context:"moddi-queues"}),e.jsx("div",{className:"feed-header",children:e.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:0},children:T?e.jsx("div",{style:{padding:"12px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>w(!_),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Create a queue!"}),_?e.jsx(ut,{size:16}):e.jsx(fe,{size:16})]}),_&&e.jsx("form",{onSubmit:E,style:{padding:"12px",borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:k,onChange:C=>o(C.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:v,onChange:C=>b(C.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:C=>{C.stopPropagation(),w(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:d.isPending||T,onClick:C=>C.stopPropagation(),children:d.isPending?"Creating...":"Create"})]})]})})]})})}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsx("div",{className:"col",style:{gap:0},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):z.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):z.map(C=>e.jsx(as,{queue:C},C.id))})})]})}function rs({beatmapMeta:t,beatmapVersion:s}){const a=i.useRef(null),c=i.useRef(null),[l,d]=i.useState(!1),[m,_]=i.useState(!1),[w,k]=i.useState(0);i.useEffect(()=>{if(a.current&&c.current){const b=a.current.offsetWidth,T=c.current.scrollWidth;k(T),_(T>b)}},[t,s]);const o=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",s?` [${s}]`:""]}):s?`[${s}]`:"Beatmap",v=w>0?Math.max(3,w/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:a,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:m?"pointer":"default"},onMouseEnter:()=>m&&d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("span",{ref:c,style:{display:"inline-block",animation:l&&m?`beatmap-marquee ${v}s linear infinite`:"none"},children:o}),l&&m&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:o})]})]})}function lt({submission:t,canManage:s,onUpdate:a,onDelete:c,isGroup:l=!1}){const[d,m]=i.useState(!1),[_,w]=i.useState(!1),[k,o]=i.useState(null),[v,b]=i.useState(t.beatmapset_id),[T,E]=i.useState(t.beatmap_id),[z,C]=i.useState(!1),[j,q]=i.useState(!1),[P,U]=i.useState(null),[D,M]=i.useState(!1),[p,se]=i.useState(t.acknowledgments||[]),[h,Y]=i.useState(t.acknowledged_by_me||!1),ne=i.useRef(null),J=i.useRef(null),x=i.useRef(null),R=i.useRef(null),f=i.useRef(null),{notify:W}=xe();i.useEffect(()=>{se(t.acknowledgments||[]),Y(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),i.useEffect(()=>{if(t.beatmap_url)try{const n=new URL(t.beatmap_url),y=n.pathname.match(/\/beatmapsets\/(\d+)/);if(y&&!t.beatmapset_id){const B=Number(y[1]);isNaN(B)||b(B)}const N=n.hash.match(/#osu\/(\d+)/);if(N&&!t.beatmap_id){const B=Number(N[1]);isNaN(B)||E(B)}}catch(n){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,n)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),i.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:v,extracted_beatmap_id:T,beatmap_version:t.beatmap_version})},[t.id,v,T]),i.useEffect(()=>{if(!t.beatmap_url||k&&v)return;let n=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let y;try{y=new URL(t.beatmap_url)}catch(O){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,O);return}const N=y.hash.match(/#osu\/(\d+)/),B=N?N[1]:null;y.hash="";const ee={url:y.toString()};if(B?ee.beatmap_id=B:t.beatmap_id&&(ee.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",ee),!n){const O=await L(I.osu.resolveBeatmap+ht(ee),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",O),O.setId&&!v&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",O.setId),b(Number(O.setId))),(O.title||O.artist)&&o({title:O.title||null,artist:O.artist||null,mapper:O.mapper||null})}}catch(y){console.error("[QueueSubmission] Error fetching beatmap metadata:",y)}})(),()=>{n=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,k,v]),i.useEffect(()=>{if(!z){U(null),f.current&&(window.removeEventListener("resize",f.current),window.removeEventListener("scroll",f.current,!0),f.current=null);return}let n=null;const y=()=>{let N=null;const B=R.current;if(B){const Z=B.querySelector(".queue-submission-beatmap-btn-desktop button"),ee=B.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),O=B.querySelector(".queue-submission-beatmap-btn-mobile button");Z&&window.getComputedStyle(Z.parentElement).display!=="none"?N=Z:ee&&window.getComputedStyle(ee.parentElement).display!=="none"?N=ee:O&&window.getComputedStyle(O.parentElement).display!=="none"&&(N=O)}if(!N&&x.current&&(N=x.current),N){const Z=N.getBoundingClientRect();U({top:Z.bottom+8,right:window.innerWidth-Z.right})}else U(null)};return f.current=y,n=requestAnimationFrame(()=>{y(),window.addEventListener("resize",y),window.addEventListener("scroll",y,!0)}),()=>{n!==null&&cancelAnimationFrame(n),f.current&&(window.removeEventListener("resize",f.current),window.removeEventListener("scroll",f.current,!0),f.current=null)}},[z]),i.useEffect(()=>{if(!_)return;const n=y=>{const N=y.target;ne.current&&!ne.current.contains(N)&&!N.closest("[data-status-dropdown]")&&w(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[_]),i.useEffect(()=>{if(!z)return;const n=y=>{const N=y.target;if(J.current&&J.current.contains(N))return;const B=R.current;if(B){if(x.current&&x.current.contains(N))return;const Z=B.querySelector(".queue-submission-beatmap-btn-desktop button"),ee=B.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),O=B.querySelector(".queue-submission-beatmap-btn-mobile button");if(Z&&Z.contains(N)||ee&&ee.contains(N)||O&&O.contains(N))return}C(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[z]);const ue=async n=>{if(!d){m(!0);try{await L(I.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:n})});const y={...t,status:n,updated_at:Math.floor(Date.now()/1e3)};a&&a(y),W("Status updated",{variant:"success"})}catch{W("Failed to update status",{variant:"error"})}finally{m(!1),w(!1)}}},me=async()=>{if(!d){m(!0);try{const n=!!t.is_archived;await L(I.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!n})});const y={...t,is_archived:n?0:1,updated_at:Math.floor(Date.now()/1e3)};a&&a(y),W(n?"Unarchived":"Archived",{variant:"success"})}catch{W("Failed to update archive status",{variant:"error"})}finally{m(!1)}}},ce=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!d){m(!0);try{await L(I.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),W("Submission deleted",{variant:"success"}),c&&c(t.id)}catch{W("Failed to delete submission",{variant:"error"})}finally{m(!1)}}},G=async()=>{if(!D){M(!0);try{if(h){if(await L(I.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),Y(!1),W("Unacknowledged",{variant:"info"}),a){const n={...t,acknowledged_by_me:!1};a(n)}}else if(await L(I.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),Y(!0),W("Acknowledged",{variant:"success"}),a){const n={...t,acknowledged_by_me:!0};a(n)}}catch{W("Failed to update acknowledgment",{variant:"error"})}finally{M(!1)}}},A={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},X={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},ae=v||t.beatmapset_id,oe=ae?`https://assets.ppy.sh/beatmaps/${ae}/covers/card.jpg`:null;i.useEffect(()=>{oe?console.log("[QueueSubmission] Background image URL:",oe,"for beatmapset_id:",ae):console.log("[QueueSubmission] No background image URL - beatmapset_id:",ae,"submission.beatmapset_id:",t.beatmapset_id)},[oe,ae,t.beatmapset_id]);const V=!!t.is_archived,pe=s?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),C(y=>!y)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(255,255,255,0.1)",n.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255,255,255,0.05)",n.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Se,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(fe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),C(y=>!y)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(255,255,255,0.1)",n.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255,255,255,0.05)",n.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Se,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(fe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),p&&p.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[p.slice(0,5).map((n,y)=>n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,title:n.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:y>0?-8:0,zIndex:p.length-y,position:"relative",cursor:"pointer"}},n.user_id):e.jsx("div",{title:n.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:y>0?-8:0,zIndex:p.length-y,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:n.username.charAt(0).toUpperCase()},n.user_id)),p.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${p.length-5} more`,children:["+",p.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:G,disabled:D||d,title:h?"Unacknowledge":"Acknowledge",style:{color:h?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:h?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:n=>{!D&&!d&&(n.currentTarget.style.background=h?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:n=>{n.currentTarget.style.background=h?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ge,{size:16})}),e.jsx("button",{className:"icon-link",onClick:me,disabled:d,title:V?"Unarchive":"Archive",style:{color:V?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:V?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:n=>{d||(n.currentTarget.style.background=V?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:n=>{n.currentTarget.style.background=V?"rgba(99, 102, 241, 0.1)":"transparent"},children:V?e.jsx(Xe,{size:16}):e.jsx(Ze,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ce,disabled:d,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:n=>{d||(n.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:n=>{n.currentTarget.style.background="transparent"},children:e.jsx(we,{size:16})}),e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:ne,onClick:()=>w(!_),disabled:d,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:A[t.status]+"15",border:`1.5px solid ${A[t.status]}50`,color:A[t.status],whiteSpace:"nowrap",cursor:d?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:d?.6:1},onMouseEnter:n=>{d||(n.currentTarget.style.background=A[t.status]+"25",n.currentTarget.style.borderColor=A[t.status]+"70",n.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:n=>{n.currentTarget.style.background=A[t.status]+"15",n.currentTarget.style.borderColor=A[t.status]+"50",n.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:X[t.status]}),e.jsx(fe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:_?"rotate(180deg)":"rotate(0deg)"}})]}),_&&Pe.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const n=document.querySelector(".queue-submission-status-btn-desktop button"),y=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),N=document.querySelector(".queue-submission-status-btn-mobile button");let B=null;if(n&&window.getComputedStyle(n.parentElement).display!=="none"?B=n:N&&window.getComputedStyle(N.parentElement).display!=="none"?B=N:y&&window.getComputedStyle(y.parentElement).display!=="none"?B=y:ne.current&&(B=ne.current),B){const Z=B.getBoundingClientRect();return{top:Z.bottom+6,right:window.innerWidth-Z.right}}return{top:0,right:0}})()},onClick:n=>n.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(n=>e.jsx("button",{onClick:()=>ue(n),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:n===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:n===t.status?A[n]+"15":"transparent",color:n===t.status?A[n]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:y=>{n!==t.status&&(y.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:y=>{n!==t.status&&(y.currentTarget.style.background="transparent")},children:X[n]},n))}),document.body)]})]}):e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),C(y=>!y)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(255,255,255,0.1)",n.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255,255,255,0.05)",n.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Se,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(fe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),C(y=>!y)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(255,255,255,0.1)",n.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255,255,255,0.05)",n.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Se,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(fe,{size:12,style:{marginLeft:4,opacity:.7}})]})})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:R,className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:V?.6:1},children:[oe&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:oe,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.35,zIndex:0,pointerEvents:"none"},onError:n=>{n.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.75) 100%)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:x,className:"chip-btn link",onClick:n=>{n.preventDefault(),n.stopPropagation(),C(y=>!y)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(255,255,255,0.1)",n.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255,255,255,0.05)",n.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Se,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(fe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),s&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[p&&p.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[p.slice(0,5).map((n,y)=>n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,title:n.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:y>0?-8:0,zIndex:p.length-y,position:"relative",cursor:"pointer"}},n.user_id):e.jsx("div",{title:n.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:y>0?-8:0,zIndex:p.length-y,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:n.username.charAt(0).toUpperCase()},n.user_id)),p.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${p.length-5} more`,children:["+",p.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:G,disabled:D||d,title:h?"Unacknowledge":"Acknowledge",style:{color:h?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:h?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:n=>{!D&&!d&&(n.currentTarget.style.background=h?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:n=>{n.currentTarget.style.background=h?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ge,{size:16})}),e.jsx("button",{className:"icon-link",onClick:me,disabled:d,title:V?"Unarchive":"Archive",style:{color:V?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:V?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:n=>{d||(n.currentTarget.style.background=V?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:n=>{n.currentTarget.style.background=V?"rgba(99, 102, 241, 0.1)":"transparent"},children:V?e.jsx(Xe,{size:16}):e.jsx(Ze,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ce,disabled:d,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:n=>{d||(n.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:n=>{n.currentTarget.style.background="transparent"},children:e.jsx(we,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:ne,onClick:()=>w(!_),disabled:d,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:A[t.status]+"15",border:`1.5px solid ${A[t.status]}50`,color:A[t.status],whiteSpace:"nowrap",cursor:d?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:d?.6:1},onMouseEnter:n=>{d||(n.currentTarget.style.background=A[t.status]+"25",n.currentTarget.style.borderColor=A[t.status]+"70",n.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:n=>{n.currentTarget.style.background=A[t.status]+"15",n.currentTarget.style.borderColor=A[t.status]+"50",n.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:X[t.status]}),e.jsx(fe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:_?"rotate(180deg)":"rotate(0deg)"}})]})})]}),s&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>w(!_),disabled:d,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:A[t.status]+"15",border:`1.5px solid ${A[t.status]}50`,color:A[t.status],whiteSpace:"nowrap",cursor:d?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:d?.6:1},onMouseEnter:n=>{d||(n.currentTarget.style.background=A[t.status]+"25",n.currentTarget.style.borderColor=A[t.status]+"70",n.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:n=>{n.currentTarget.style.background=A[t.status]+"15",n.currentTarget.style.borderColor=A[t.status]+"50",n.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:X[t.status]}),e.jsx(fe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:_?"rotate(180deg)":"rotate(0deg)"}})]})}),!s&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:A[t.status]+"15",border:`1.5px solid ${A[t.status]}50`,color:A[t.status],whiteSpace:"nowrap"},children:X[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx(rs,{beatmapMeta:k,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:e.jsx(He,{text:t.message})}),pe]})]}),z&&P&&t.beatmap_url&&Pe.createPortal(e.jsxs("div",{ref:J,style:{position:"fixed",top:P.top,right:P.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:n=>n.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>C(!1),children:[e.jsx(Se,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ae&&e.jsx("button",{className:"menu-item",onClick:()=>{q(!0),C(!1)},children:"Preview"})]}),document.body),j&&ae&&e.jsx(xt,{open:j,onClose:()=>q(!1),downloadUrl:`${Lt}${I.osu.downloadBeatmapset(ae)}`,beatmapId:T??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}function is({queueId:t,onSubmitted:s}){const[a,c]=re.useState(!1),[l,d]=re.useState(t),[m,_]=re.useState(""),[w,k]=re.useState(""),[o,v]=re.useState(!1),{notify:b}=xe(),{data:T=[]}=Ke();re.useEffect(()=>{d(t)},[t]);const E=async()=>{if(!l){b("Please select a queue",{variant:"error"});return}if(!m.trim()){b("Beatmap URL is required",{variant:"error"});return}v(!0);try{await L(I.moddi.queueSubmit(l),{method:"POST",body:JSON.stringify({beatmap_url:m.trim(),message:w.trim()||null})}),b("Submission created!",{variant:"success"}),_(""),k(""),c(!1),s==null||s()}catch(z){b((z==null?void 0:z.message)||"Failed to create submission",{variant:"error"})}finally{v(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>c(!0),children:e.jsx(Ae,{size:22})}),e.jsx(Oe,{open:a,onClose:()=>c(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:l??"",onChange:z=>d(z.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),T.map(z=>e.jsx("option",{value:String(z.id),children:z.name},z.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:m,onChange:z=>_(z.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:w,onChange:z=>k(z.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),w.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[w.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:o,onClick:E,children:o?"Submitting...":"Submit"})]})]})})]})}const dt=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(qt,{components:{p:({children:s})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:s}),ul:({children:s})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),ol:({children:s})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),li:({children:s})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:s}),strong:({children:s})=>e.jsx("strong",{style:{fontWeight:600},children:s}),em:({children:s})=>e.jsx("em",{children:s}),code:({children:s})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:s}),h1:({children:s})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:s}),h2:({children:s})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:s}),h3:({children:s})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:s})},children:t})});function bs(){const{id:t}=mt(),s=$e(),[a,c]=i.useState(null),[l,d]=i.useState([]),[m,_]=i.useState([]),[w,k]=i.useState(!0),[o,v]=i.useState(null),[b,T]=i.useState(!1),[E,z]=i.useState(!1),[C,j]=i.useState(""),[q,P]=i.useState(""),[U,D]=i.useState(null),[M,p]=i.useState(!1),[se,h]=i.useState(""),[Y,ne]=i.useState(""),[J,x]=i.useState(""),[R,f]=i.useState("modder"),[W,ue]=i.useState(!1),[me,ce]=i.useState(!1),[G,A]=i.useState("general"),[X,ae]=i.useState(!1),[oe,V]=i.useState(!1),[pe,n]=i.useState(null),[y,N]=i.useState(""),[B,Z]=i.useState([]),[ee,O]=i.useState(!1),ye=i.useRef(null),Ne=i.useRef(null),ve=i.useRef(null),[je,De]=i.useState([]),[qe,_e]=i.useState(!1),[F,Q]=i.useState(null),{notify:S}=xe(),{queueStatusFilters:$}=Fe(),te=async()=>{var r,g;if(t){k(!0);try{const u=await L(I.moddi.queue(t),{requireAuth:!1});c(u.queue||null),d(u.members||[]),_(u.submissions||[])}catch(u){(r=u==null?void 0:u.message)!=null&&r.includes("403")||(g=u==null?void 0:u.message)!=null&&g.includes("Forbidden")?(S("You do not have access to this queue",{variant:"error"}),s("/md/queues")):S("Failed to load queue",{variant:"error"})}finally{k(!1)}}};i.useEffect(()=>{te(),L(I.auth.me,{requireAuth:!1}).then(r=>v(r)).catch(()=>{})},[t]);const K=o&&a&&(a.owner_id===o.id||l.some(r=>r.user_id===o.id&&r.joined_at)||o.is_mod||o.is_admin);o&&l.some(r=>r.user_id===o.id&&r.joined_at);const le=o&&a&&(a.owner_id===o.id||l.some(r=>r.user_id===o.id&&r.joined_at)),Me=async r=>{if(r.preventDefault(),!a||a.is_open===0){S("Queue is closed for submissions",{variant:"error"});return}if(!C.trim()){S("Beatmap URL is required",{variant:"error"});return}z(!0);try{await L(I.moddi.queueSubmit(t),{method:"POST",body:JSON.stringify({beatmap_url:C.trim(),message:q.trim()||null})}),S("Submission created!",{variant:"success"}),T(!1),j(""),P(""),te()}catch(g){S((g==null?void 0:g.message)||"Failed to create submission",{variant:"error"})}finally{z(!1)}},de=r=>{_(g=>g.map(u=>u.id===r.id?r:u)),r.acknowledged_by_me!==void 0&&te()},be=()=>{a&&(h(a.name),ne(a.description||""),x(a.rules||""),f(a.type||"modder"),p(!0),A("general"))},he=()=>{p(!1),h(""),ne(""),x(""),f("modder")},ge=async()=>{if(!(!a||!le)){ce(!0);try{const r=a.is_open!==1;await L(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:r})}),S(`Queue ${r?"opened":"closed"}`,{variant:"success"}),te()}catch(r){S((r==null?void 0:r.message)||"Failed to update status",{variant:"error"})}finally{ce(!1)}}},Re=async r=>{if(r.preventDefault(),!a||!se.trim()){S("Queue name is required",{variant:"error"});return}ae(!0);try{const g=l.filter(H=>H.user_id!==a.owner_id&&H.role!=="owner").length>0,u={name:se.trim(),description:Y.trim()||null,rules:J.trim()||null,is_group:g};(o!=null&&o.is_mod||o!=null&&o.is_admin)&&(u.type=R),await L(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify(u)}),S("Queue updated!",{variant:"success"}),he(),te()}catch(g){S((g==null?void 0:g.message)||"Failed to update queue",{variant:"error"})}finally{ae(!1)}};i.useEffect(()=>{if(!y.trim()){Z([]),O(!1);return}const r=setTimeout(async()=>{try{const u=(await L(I.moddi.usersSearch(y),{requireAuth:!1})).items||[];Z(u),O(u.length>0)}catch(g){console.error("Search failed:",g),Z([]),O(!1)}},300);return()=>clearTimeout(r)},[y]);const Ue=async r=>{if(!oe){V(!0);try{await L(I.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:r})}),S("Invite sent!",{variant:"success"}),N(""),Z([]),O(!1),te()}catch(g){S((g==null?void 0:g.message)||"Failed to invite member",{variant:"error"})}finally{V(!1)}}},We=async()=>{if(!(!t||!K))try{const r=await L(I.moddi.queueBlockedUsers(t));De(r.blocked||[])}catch(r){console.error("Failed to load blocked users:",r)}},jt=async r=>{if(!(!t||qe)&&confirm("Block this user from submitting to this queue?")){_e(!0);try{await L(I.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:r})}),S("User blocked",{variant:"success"}),We(),N(""),Z([]),O(!1)}catch(g){S((g==null?void 0:g.message)||"Failed to block user",{variant:"error"})}finally{_e(!1)}}},Je=async r=>{if(!(!t||F===r)){Q(r);try{await L(I.moddi.queueUnblockUser(t,r),{method:"DELETE"}),S("User unblocked",{variant:"success"}),We()}catch(g){S((g==null?void 0:g.message)||"Failed to unblock user",{variant:"error"})}finally{Q(null)}}};i.useEffect(()=>{G==="members"&&K&&t&&We()},[G,K,t]);const St=async()=>{if(a&&confirm(`Are you sure you want to delete "${a.name}"? This action cannot be undone.`)){ue(!0);try{await L(I.moddi.queue(t),{method:"DELETE"}),S("Queue deleted",{variant:"success"}),s("/md/queues")}catch(r){S((r==null?void 0:r.message)||"Failed to delete queue",{variant:"error"})}finally{ue(!1)}}},wt=async r=>{if(!o||!a||o.id!==a.owner_id){S("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){n(r);try{await L(I.moddi.queueMember(t,r),{method:"DELETE"}),S("Member removed",{variant:"success"});const u=l.filter(H=>H.user_id!==r).some(H=>H.user_id!==(a==null?void 0:a.owner_id)&&H.role!=="owner");if(a&&a.is_group===1&&!u)try{await L(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}te()}catch(g){S((g==null?void 0:g.message)||"Failed to remove member",{variant:"error"})}finally{n(null)}}},kt=async()=>{if(o&&confirm("Leave this queue? You will need to be invited again to rejoin.")){n(o.id);try{await L(I.moddi.queueMember(t,o.id),{method:"DELETE"}),S("Left queue",{variant:"success"});const g=l.filter(u=>u.user_id!==o.id).some(u=>u.user_id!==(a==null?void 0:a.owner_id)&&u.role!=="owner");if(a&&a.is_group===1&&!g)try{await L(I.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}s("/md/queues")}catch(r){S((r==null?void 0:r.message)||"Failed to leave queue",{variant:"error"})}finally{n(null)}}},Nt=async r=>{if(confirm("Cancel this invitation?")){n(r);try{await L(I.moddi.queueMember(t,r),{method:"DELETE"}),S("Invitation canceled",{variant:"success"}),te()}catch(g){S((g==null?void 0:g.message)||"Failed to cancel invitation",{variant:"error"})}finally{n(null)}}};return i.useEffect(()=>{if(!M)return;const r=g=>{const u=g.target;u.closest(".manage-overlay")||u.closest(".manage-overlay-backdrop")||!u.closest(".manage-popup")&&ve.current&&!ve.current.contains(u)&&he()};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[M]),i.useEffect(()=>{if(!ee)return;const r=g=>{const u=g.target;ye.current&&!ye.current.contains(u)&&Ne.current&&!Ne.current.contains(u)&&O(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[ee]),w?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):a?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t&&e.jsx(is,{queueId:t,onSubmitted:()=>te()}),e.jsx(Ye,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>s("/md/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(pt,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:a.name}),le&&e.jsxs("button",{onClick:ge,disabled:me,className:`queue-status-badge ${a.is_open===1?"status-open":"status-closed"}`,title:a.is_open===1?"Close queue":"Open queue","aria-label":a.is_open===1?"Close queue":"Open queue",children:[a.is_open===1?e.jsx(Ee,{size:14}):e.jsx(Qe,{size:14}),e.jsx("span",{children:a.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[K&&e.jsx("button",{ref:ve,className:"icon-link",onClick:be,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(Ft,{size:18})}),l.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:l.filter(r=>r.joined_at!==null).sort((r,g)=>{const u=r.role==="owner"||r.user_id===(a==null?void 0:a.owner_id),H=g.role==="owner"||g.user_id===(a==null?void 0:a.owner_id);return u&&!H?-1:!u&&H?1:(g.joined_at||0)-(r.joined_at||0)}).map(r=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>D(r.user_id),onMouseLeave:()=>D(null),children:[e.jsx(gt,{to:`/profile/${r.user_id}`,className:"queue-member-avatar",title:r.username,children:r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:r.username.charAt(0).toUpperCase()})}),U===r.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[r.username," ",r.role!=="member"?`(${r.role})`:""]})]},r.user_id))})]})]}),a.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:e.jsx(He,{text:a.description})}),a.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(dt,{content:a.rules})]}),a.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{className:"queue-submit-desktop-only",style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:12,opacity:a.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:a.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>a.is_open===1&&T(!b),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",a.is_open===0&&"(Closed)"]}),a.is_open===1&&(b?e.jsx(Ce,{size:16}):e.jsx(Ae,{size:16}))]}),b&&e.jsx("form",{onSubmit:Me,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:C,onChange:r=>j(r.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:q,onChange:r=>P(r.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),q.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[q.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:r=>{r.stopPropagation(),T(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:E,onClick:r=>r.stopPropagation(),children:E?"Submitting...":"Submit"})]})]})})]}),e.jsxs("div",{className:"profile-tabs-unified",style:{marginTop:24},children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Submission sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"active",onClick:r=>{const g=r.currentTarget.closest(".profile-tabs-unified");g.querySelectorAll(".profile-tab").forEach(H=>{H.classList.remove("active"),H.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),g.querySelector(".profile-tabs-content").setAttribute("data-active","active")},children:"Active"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"archived",onClick:r=>{const g=r.currentTarget.closest(".profile-tabs-unified");g.querySelectorAll(".profile-tab").forEach(H=>{H.classList.remove("active"),H.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),g.querySelector(".profile-tabs-content").setAttribute("data-active","archived")},children:"Archived"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"active",children:[e.jsx("div",{className:"panel active",children:e.jsx("div",{className:"col",style:{gap:0},children:m.filter(r=>!!!r.is_archived&&$[r.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):m.filter(r=>!!!r.is_archived&&$[r.status]).map(r=>e.jsx(lt,{submission:r,canManage:!!K,isGroup:(a==null?void 0:a.is_group)===1,onUpdate:de,onDelete:g=>{_(u=>u.filter(H=>H.id!==g))}},r.id))})}),e.jsx("div",{className:"panel archived",children:e.jsx("div",{className:"col",style:{gap:0},children:m.filter(r=>!!r.is_archived&&$[r.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):m.filter(r=>!!r.is_archived&&$[r.status]).map(r=>e.jsx(lt,{submission:r,canManage:!!K,isGroup:(a==null?void 0:a.is_group)===1,onUpdate:de,onDelete:g=>{_(u=>u.filter(H=>H.id!==g))}},r.id))})})]})]}),M&&Pe.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:he}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:he,"aria-label":"Close",children:e.jsx(Ce,{size:18})}),e.jsxs("div",{className:"col",style:{gap:0,padding:"0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:16,padding:"20px 16px 12px",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("div",{className:"title",style:{fontSize:20,margin:0,padding:0,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Manage Queue"}),e.jsxs("div",{className:"tabs",role:"tablist",style:{margin:0},children:[e.jsx("button",{role:"tab","aria-selected":G==="general",className:`tab ${G==="general"?"active":""}`,onClick:()=>A("general"),children:"General"}),e.jsx("button",{role:"tab","aria-selected":G==="rules",className:`tab ${G==="rules"?"active":""}`,onClick:()=>A("rules"),children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":G==="members",className:`tab ${G==="members"?"active":""}`,onClick:()=>A("members"),children:"Members"})]})]}),e.jsx("hr",{className:"subtle-divider",style:{margin:"0 16px"}}),e.jsxs("form",{onSubmit:Re,className:"col",style:{gap:0,padding:"16px"},children:[G==="general"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:se,onChange:r=>h(r.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:Y,onChange:r=>ne(r.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),((o==null?void 0:o.is_mod)||(o==null?void 0:o.is_admin))&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsxs("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Queue Type ",a.owner_id!==(o==null?void 0:o.id)&&e.jsx("span",{style:{fontSize:12,color:"var(--muted)",fontWeight:400},children:"(Mod/Admin only)"})]}),e.jsxs("select",{value:R,onChange:r=>f(r.target.value),style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14},children:[e.jsx("option",{value:"modder",children:"Modder"}),e.jsx("option",{value:"nominator",children:"Nominator"})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:St,disabled:W||X,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(we,{size:14,style:{marginRight:6}}),W?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:X||W,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:X||W,style:{fontSize:13,padding:"8px 16px"},children:X?"Updating...":"Save Changes"})]})]})]}),G==="rules"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:J,onChange:r=>x(r.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),J&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(dt,{content:J})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:X||W,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:X||W,style:{fontSize:13,padding:"8px 16px"},children:X?"Updating...":"Save Changes"})]})]}),G==="members"&&e.jsxs("div",{className:"col",style:{gap:10},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ye,type:"text",placeholder:"Search username or ID",value:y,onChange:r=>N(r.target.value),onKeyDown:r=>{r.key==="Enter"&&r.preventDefault()},onFocus:()=>{B.length>0&&O(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),ee&&B.length>0&&e.jsx("div",{ref:Ne,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:B.map(r=>{const g=l.some(ie=>ie.user_id===r.id&&ie.joined_at),u=l.some(ie=>ie.user_id===r.id&&ie.invited_at&&!ie.joined_at),H=je.some(ie=>ie.user_id===r.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:r.username}),g&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),u&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",r.id," • osu ",r.osu_user_id]})]})]}),K&&!g&&!u&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:ie=>{ie.stopPropagation(),oe||Ue(r.id)},disabled:oe,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ft,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ie=>{ie.stopPropagation(),H?Je(r.id):jt(r.id)},disabled:qe||F===r.id,title:H?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:H?"var(--accent)":"var(--danger)"},children:H?e.jsx(Ee,{size:16}):e.jsx(Qe,{size:16})})]})]},r.id)})})})]})]}),l.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const r=l.filter(u=>u.joined_at!==null).sort((u,H)=>{const ie=u.role==="owner"||u.user_id===(a==null?void 0:a.owner_id),Le=H.role==="owner"||H.user_id===(a==null?void 0:a.owner_id);return ie&&!Le?-1:!ie&&Le?1:(H.joined_at||0)-(u.joined_at||0)}),g=l.filter(u=>u.invited_at!==null&&u.joined_at===null);return e.jsxs(e.Fragment,{children:[r.map(u=>{const H=o&&a&&o.id===a.owner_id,ie=u.user_id===(o==null?void 0:o.id),Le=u.user_id===(a==null?void 0:a.owner_id)||u.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.role})]})]}),H&&!Le&&e.jsx("button",{className:"icon-link",onClick:()=>wt(u.user_id),disabled:pe===u.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(we,{size:16})}),!H&&ie&&e.jsx("button",{className:"icon-link",onClick:kt,disabled:pe===u.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(It,{size:16})})]},u.user_id)}),g.length>0&&e.jsx(e.Fragment,{children:g.map(u=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Nt(u.user_id),disabled:pe===u.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(Ce,{size:16})})]},u.user_id))})]})})()})]}),K&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),je.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:je.map(r=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:r.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:r.username}),r.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",r.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Je(r.user_id),disabled:F===r.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(Ee,{size:16})})]},r.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:X||W,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:X||W,style:{fontSize:13,padding:"8px 16px"},children:X?"Updating...":"Save Changes"})]})]})]})]})]})]}),document.body),e.jsx("style",{children:`
        /* Hide inline submit form on mobile – mobile uses floating FAB instead */
        html.is-mobile .queue-submit-desktop-only {
          display: none;
        }

        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function xs(){const{data:t=[],isLoading:s}=Kt(),a=Jt(),c=Gt(),{notify:l}=xe(),d=$e(),m=ke(),[_,w]=i.useState(new Set),{data:k}=Ie(),[o,v]=i.useState(!1),[b,T]=i.useState(!1),[E,z]=i.useState(!1),C=i.useRef(null),j=i.useRef(null),q=!!(k!=null&&k.is_admin||k!=null&&k.is_mod);Xt(C,j,o,()=>v(!1));const P=async x=>{a.mutate(x,{onSuccess:()=>{}})},U=async x=>{x.startsWith("n:")&&c.mutate(x)},D=async()=>{const x=t.filter(R=>!R.read&&(R.id.startsWith("n:")||R.kind==="system"&&!R.id.startsWith("b:"))).map(R=>R.id);x.length>0&&(await P(x),l("All notifications marked as read",{variant:"success"}))},M=x=>{if(!x)return null;try{const R=JSON.parse(x);if((R==null?void 0:R.type)==="queue_invite"&&(R!=null&&R.queue_id))return R}catch{}return null},p=async(x,R)=>{if(!_.has(x.id)){w(f=>new Set(f).add(x.id));try{await L(I.moddi.queueAccept(String(R)),{method:"POST"}),l("Invitation accepted!",{variant:"success"}),U(x.id),d(`/md/queues/${R}`)}catch(f){l((f==null?void 0:f.message)||"Failed to accept invitation",{variant:"error"})}finally{w(f=>{const W=new Set(f);return W.delete(x.id),W})}}},se=async(x,R)=>{if(!_.has(x.id)){w(f=>new Set(f).add(x.id));try{await L(I.moddi.queueDeny(String(R)),{method:"POST"}),l("Invitation declined",{variant:"success"}),U(x.id)}catch(f){l((f==null?void 0:f.message)||"Failed to decline invitation",{variant:"error"})}finally{w(f=>{const W=new Set(f);return W.delete(x.id),W})}}},h=x=>M(x.text)?e.jsx(ft,{size:20,color:"#a78bfa"}):x.kind==="star"?e.jsx(tt,{size:20,color:"#f59e0b"}):x.kind==="likes5"?e.jsx(st,{size:20,color:"#f472b6"}):x.kind==="comment"?e.jsx(Te,{size:20,color:"#60a5fa"}):x.kind==="inspiration"?e.jsx(Te,{size:20,color:"#7dd3fc"}):x.kind==="reaction"?e.jsx(at,{size:20,color:"#10b981"}):x.id.startsWith("b:")?e.jsx(nt,{size:20,color:"#a78bfa"}):null,Y=x=>M(x.text)?"Queue Invitation":x.kind==="star"?"Star":x.kind==="likes5"?"Likes":x.kind==="comment"?"Comment":x.kind==="inspiration"?"Inspiration":x.kind==="reaction"?"Reaction":x.id.startsWith("b:")?"Global":"System",ne=t.filter(x=>!x.read&&!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).length,J=async x=>{if(!(!(k!=null&&k.id)||E)){z(!0);try{const R={kind:x};x==="system"&&(R.text="Test system notification"),await L(I.admin.notificationsTest,{method:"POST",body:JSON.stringify(R)}),l("Test notification sent",{variant:"success"}),m.invalidateQueries({queryKey:["notifications","detailed"]}),m.invalidateQueries({queryKey:["notifications"]})}catch(R){l((R==null?void 0:R.message)||"Failed to send test notification",{variant:"error"})}finally{z(!1),v(!1),T(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[q&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:C,className:"btn secondary",onClick:()=>v(!o),disabled:E,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(fe,{size:14,style:{transition:"transform 0.2s ease",transform:o?"rotate(180deg)":"rotate(0deg)"}})]}),o&&e.jsxs("div",{ref:j,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>J("star"),disabled:E,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>J("likes5"),disabled:E,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>J("comment"),disabled:E,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>J("inspiration"),disabled:E,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>J("reaction"),disabled:E,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>J("system"),disabled:E,children:"Test System"})]})]}),ne>0&&e.jsxs("button",{className:"btn secondary",onClick:D,children:[e.jsx(et,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),q&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>T(!0),children:e.jsx(Ve,{size:22})}),e.jsx(Oe,{open:b,onClose:()=>T(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>J("star"),disabled:E,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(tt,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>J("likes5"),disabled:E,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(st,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>J("comment"),disabled:E,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Te,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>J("inspiration"),disabled:E,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Te,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>J("reaction"),disabled:E,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(at,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>J("system"),disabled:E,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(nt,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(x=>!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).map(x=>{const R=({notif:f})=>{const[W,ue]=i.useState(0),[me,ce]=i.useState(!1),G=i.useRef(null),A=i.useRef(null),X=i.useRef(null),ae=i.useRef(null),oe=N=>{f.id.startsWith("n:")&&(G.current=N.touches[0].clientX,ae.current=N.touches[0].clientY,A.current=Date.now(),ce(!1))},V=N=>{if(G.current===null||ae.current===null||!f.id.startsWith("n:"))return;const B=N.touches[0].clientX,Z=N.touches[0].clientY,ee=B-G.current,O=Math.abs(Z-ae.current);Math.abs(ee)>O&&(ce(!0),ue(Math.max(-80,Math.min(0,ee))))},pe=()=>{if(G.current===null)return;W<=-60&&U(f.id),ue(0),ce(!1),G.current=null,ae.current=null,A.current=null},n=f.id.startsWith("n:"),y=typeof f.targetPath=="string"&&f.targetPath.trim().length>0?f.targetPath.trim():null;return e.jsxs("div",{ref:X,style:{position:"relative",background:f.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:y?"pointer":"default",opacity:f.read?.7:1,transform:`translateX(${W}px)`,transition:me?"none":"transform 0.2s ease",touchAction:n?"pan-x pan-y":"pan-y"},onTouchStart:oe,onTouchMove:V,onTouchEnd:pe,onTouchCancel:pe,onClick:()=>{if(!(Math.abs(W)>10)){if(!f.read&&f.id.startsWith("n:")&&P([f.id]),y){d(y);return}f.videoId&&(window.location.hash="/mp/feed")}},children:[n&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(W)/80,pointerEvents:"none",zIndex:0},children:e.jsx(we,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:h(f)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:Y(f)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(f.createdAt).toLocaleDateString()}),f.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:N=>{N.stopPropagation(),U(f.id)},style:{padding:4},children:e.jsx(we,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const N=M(f.text);return N?`${N.inviter_username} invited you to join queue: ${N.queue_name}`:f.text||(f.kind==="star"?"One of your posts was starred!":f.kind==="likes5"?"One of your posts reached 5 likes!":f.kind==="comment"?"Someone commented on your post":f.kind==="inspiration"?"Someone is inspired by you!":f.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const N=M(f.text);return N&&!_.has(f.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:B=>{B.stopPropagation(),p(f,N.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(et,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:B=>{B.stopPropagation(),se(f,N.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Ce,{size:14,style:{marginRight:4}}),"Decline"]})]}):N&&_.has(f.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),f.read&&f.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(f.readAt).toLocaleString()]})]})]})]},f.id)};return e.jsx(R,{notif:x},x.id)})})})]})}export{yt as C,Ye as D,Zt as F,es as M,xs as N,fs as P,hs as Q,us as a,Ie as b,Xt as c,ms as d,Yt as e,ps as f,Jt as g,Gt as h,Kt as i,gs as j,bs as k,Fe as u};
