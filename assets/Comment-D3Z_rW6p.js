import{r as j,j as e,U as S,F as z}from"./vendor-react-_vsaDC62.js";import{a as I}from"./Popup-BJgH66i5.js";import{u as M,A as v,a as w}from"./index-C1iRGETr.js";function C({comment:t,replies:c,me:s,onReply:p,onDelete:u,replyingTo:g,replyText:r,onReplyTextChange:a,onReplySubmit:x,posting:n,onCancelReply:o,section:f}){const[h,d]=j.useState(!1),b=j.useRef(null),{notify:m}=M(),y=s&&(s.id===t.user_id||s.is_admin||s.is_mod),k=async()=>{if(confirm("Delete this comment?"))try{const i=f==="mappi"?v.videos.comments(t.post_id)+`/${t.id}`:v.moddi.postComments(t.post_id)+`/${t.id}`;await w(i,{method:"DELETE"}),u(t.id),m("Comment deleted",{variant:"success"})}catch{m("Failed to delete comment",{variant:"error"})}finally{d(!1)}};return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease"},onMouseEnter:i=>i.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:i=>i.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:13,fontWeight:500},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(t.created_at*1e3).toLocaleDateString()})]}),e.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:t.text}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:e.jsxs("button",{onClick:()=>p(t.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[e.jsx(S,{size:14}),"Reply"]})}),g===t.id&&s&&e.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("form",{onSubmit:x,style:{display:"flex",alignItems:"flex-end",gap:6},children:[e.jsx("textarea",{placeholder:`Reply to ${t.username}...`,value:r||"",onChange:i=>a==null?void 0:a(i.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:i=>{const l=i.target;l.style.height="auto",l.style.height=`${Math.min(l.scrollHeight,100)}px`},autoFocus:!0}),e.jsx("button",{type:"submit",className:"btn compact",disabled:n||!(r!=null&&r.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:n?"...":"Reply"}),o&&e.jsx("button",{type:"button",onClick:o,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid rgba(255,255,255,0.12)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),y&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:b,className:"icon-link",onClick:()=>d(!h),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:e.jsx(z,{size:16})}),e.jsx(I,{open:h,onClose:()=>d(!1),buttonRef:b,children:e.jsx("button",{className:"menu-item",onClick:k,style:{color:"var(--danger)"},children:"Delete"})})]})]}),c.length>0&&e.jsx("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid rgba(255,255,255,0.06)"},children:c.map(i=>e.jsx(C,{comment:i,replies:[],me:s,onReply:p,onDelete:u,replyingTo:g,replyText:r,onReplyTextChange:a,onReplySubmit:x,posting:n,onCancelReply:o,section:f},i.id))})]})}export{C};
