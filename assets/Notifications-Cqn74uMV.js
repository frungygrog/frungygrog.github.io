import{i as A,r as z,j as i,n as m,t as D,c as I,o as R,A as C,p as W,q as p,s as q}from"./vendor-react-BcGuPv3N.js";import{f as F,g as P,h as T,u as _,a as h,A as g}from"./index-Bt7aG2Ch.js";import"./vendor-5bngNAZ_.js";import"./editor-components-ZomeoNmo.js";function B(){const{data:r=[],isLoading:x}=F(),y=P(),v=T(),{notify:a}=_(),j=A(),[d,c]=z.useState(new Set),u=async e=>{y.mutate(e,{onSuccess:()=>{}})},l=async e=>{e.startsWith("n:")&&v.mutate(e)},k=async()=>{const e=r.filter(t=>!t.read&&(t.id.startsWith("n:")||t.kind==="system"&&!t.id.startsWith("b:"))).map(t=>t.id);e.length>0&&(await u(e),a("All notifications marked as read",{variant:"success"}))},o=e=>{if(!e)return null;try{const t=JSON.parse(e);if((t==null?void 0:t.type)==="queue_invite"&&(t!=null&&t.queue_id))return t}catch{}return null},N=async(e,t)=>{if(!d.has(e.id)){c(s=>new Set(s).add(e.id));try{await h(g.moddi.queueAccept(String(t)),{method:"POST"}),a("Invitation accepted!",{variant:"success"}),l(e.id),j(`/md/queues/${t}`)}catch(s){a((s==null?void 0:s.message)||"Failed to accept invitation",{variant:"error"})}finally{c(s=>{const n=new Set(s);return n.delete(e.id),n})}}},b=async(e,t)=>{if(!d.has(e.id)){c(s=>new Set(s).add(e.id));try{await h(g.moddi.queueDeny(String(t)),{method:"POST"}),a("Invitation declined",{variant:"success"}),l(e.id)}catch(s){a((s==null?void 0:s.message)||"Failed to decline invitation",{variant:"error"})}finally{c(s=>{const n=new Set(s);return n.delete(e.id),n})}}},S=e=>o(e.text)?i.jsx(R,{size:20,color:"#a78bfa"}):e.kind==="star"?i.jsx(C,{size:20,color:"#f59e0b"}):e.kind==="likes5"?i.jsx(W,{size:20,color:"#f472b6"}):e.kind==="comment"?i.jsx(p,{size:20,color:"#60a5fa"}):e.kind==="inspiration"?i.jsx(p,{size:20,color:"#7dd3fc"}):e.id.startsWith("b:")?i.jsx(q,{size:20,color:"#a78bfa"}):null,f=e=>o(e.text)?"Queue Invitation":e.kind==="star"?"Star":e.kind==="likes5"?"Likes":e.kind==="comment"?"Comment":e.kind==="inspiration"?"Inspiration":e.id.startsWith("b:")?"Global":"System",w=r.filter(e=>!e.read&&!(e.id.startsWith("b:")&&e.expiresAt&&e.expiresAt<=Date.now())).length;return i.jsxs("div",{className:"col",style:{width:"100%",maxWidth:700,margin:"0 auto"},children:[i.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[i.jsx("div",{className:"title",children:"Notifications"}),w>0&&i.jsxs("button",{className:"btn secondary",onClick:k,children:[i.jsx(m,{size:16,style:{marginRight:6}}),"Mark all read"]})]}),x?i.jsx("div",{className:"muted",style:{textAlign:"center",padding:32},children:"Loading..."}):r.length===0?i.jsx("div",{className:"muted",style:{textAlign:"center",padding:32},children:"No notifications yet."}):i.jsx("div",{className:"col",style:{gap:8},children:r.filter(e=>!(e.id.startsWith("b:")&&e.expiresAt&&e.expiresAt<=Date.now())).map(e=>i.jsx("div",{style:{background:e.read?"var(--panel-dark)":"var(--panel)",border:`1px solid ${e.read?"rgba(255,255,255,0.08)":"rgba(125, 211, 252, 0.3)"}`,borderRadius:12,padding:16,cursor:e.videoId?"pointer":"default",opacity:e.read?.7:1},onClick:()=>{!e.read&&e.id.startsWith("n:")&&u([e.id]),e.videoId&&(window.location.hash="/mp/feed")},children:i.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12},children:[i.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:S(e)}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[i.jsx("strong",{style:{fontSize:14},children:f(e)}),i.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[i.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(e.createdAt).toLocaleDateString()}),e.id.startsWith("n:")&&i.jsx("button",{className:"icon-link",onClick:t=>{t.stopPropagation(),l(e.id)},style:{padding:4},children:i.jsx(D,{size:14})})]})]}),i.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const t=o(e.text);return t?`${t.inviter_username} invited you to join queue: ${t.queue_name}`:e.text||(e.kind==="star"?"One of your posts was starred!":e.kind==="likes5"?"One of your posts reached 5 likes!":e.kind==="comment"?"Someone commented on your post":e.kind==="inspiration"?"Someone is inspired by you!":"")})()}),(()=>{const t=o(e.text);return t&&!d.has(e.id)?i.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[i.jsxs("button",{className:"btn",onClick:s=>{s.stopPropagation(),N(e,t.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[i.jsx(m,{size:14,style:{marginRight:4}}),"Accept"]}),i.jsxs("button",{className:"btn secondary",onClick:s=>{s.stopPropagation(),b(e,t.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[i.jsx(I,{size:14,style:{marginRight:4}}),"Decline"]})]}):t&&d.has(e.id)?i.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),e.read&&e.readAt&&i.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(e.readAt).toLocaleString()]})]})]})},e.id))})]})}export{B as default};
