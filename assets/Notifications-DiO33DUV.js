import{e as A,r as z,j as t,s as m,y as D,c as I,t as R,A as C,v as F,k as h,w as W,x as P}from"./vendor-react-C7NF2CWg.js";import{f as T,g as q,h as _,u as O,a as p,A as g}from"./index-DqZma11j.js";import"./vendor-RuoRctBR.js";import"./editor-components-CZPSM51n.js";function E(){const{data:r=[],isLoading:x}=T(),y=q(),v=_(),{notify:a}=O(),k=A(),[d,c]=z.useState(new Set),u=async e=>{y.mutate(e,{onSuccess:()=>{}})},l=async e=>{e.startsWith("n:")&&v.mutate(e)},j=async()=>{const e=r.filter(i=>!i.read&&(i.id.startsWith("n:")||i.kind==="system"&&!i.id.startsWith("b:"))).map(i=>i.id);e.length>0&&(await u(e),a("All notifications marked as read",{variant:"success"}))},o=e=>{if(!e)return null;try{const i=JSON.parse(e);if((i==null?void 0:i.type)==="queue_invite"&&(i!=null&&i.queue_id))return i}catch{}return null},b=async(e,i)=>{if(!d.has(e.id)){c(s=>new Set(s).add(e.id));try{await p(g.moddi.queueAccept(String(i)),{method:"POST"}),a("Invitation accepted!",{variant:"success"}),l(e.id),k(`/md/queues/${i}`)}catch(s){a((s==null?void 0:s.message)||"Failed to accept invitation",{variant:"error"})}finally{c(s=>{const n=new Set(s);return n.delete(e.id),n})}}},N=async(e,i)=>{if(!d.has(e.id)){c(s=>new Set(s).add(e.id));try{await p(g.moddi.queueDeny(String(i)),{method:"POST"}),a("Invitation declined",{variant:"success"}),l(e.id)}catch(s){a((s==null?void 0:s.message)||"Failed to decline invitation",{variant:"error"})}finally{c(s=>{const n=new Set(s);return n.delete(e.id),n})}}},S=e=>o(e.text)?t.jsx(R,{size:20,color:"#a78bfa"}):e.kind==="star"?t.jsx(C,{size:20,color:"#f59e0b"}):e.kind==="likes5"?t.jsx(F,{size:20,color:"#f472b6"}):e.kind==="comment"?t.jsx(h,{size:20,color:"#60a5fa"}):e.kind==="inspiration"?t.jsx(h,{size:20,color:"#7dd3fc"}):e.kind==="reaction"?t.jsx(W,{size:20,color:"#10b981"}):e.id.startsWith("b:")?t.jsx(P,{size:20,color:"#a78bfa"}):null,w=e=>o(e.text)?"Queue Invitation":e.kind==="star"?"Star":e.kind==="likes5"?"Likes":e.kind==="comment"?"Comment":e.kind==="inspiration"?"Inspiration":e.kind==="reaction"?"Reaction":e.id.startsWith("b:")?"Global":"System",f=r.filter(e=>!e.read&&!(e.id.startsWith("b:")&&e.expiresAt&&e.expiresAt<=Date.now())).length;return t.jsxs("div",{className:"col",style:{width:"100%",maxWidth:700,margin:"0 auto"},children:[t.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[t.jsx("div",{className:"title",children:"Notifications"}),f>0&&t.jsxs("button",{className:"btn secondary",onClick:j,children:[t.jsx(m,{size:16,style:{marginRight:6}}),"Mark all read"]})]}),x?t.jsx("div",{className:"muted",style:{textAlign:"center",padding:32},children:"Loading..."}):r.length===0?t.jsx("div",{className:"muted",style:{textAlign:"center",padding:32},children:"No notifications yet."}):t.jsx("div",{className:"col",style:{gap:8},children:r.filter(e=>!(e.id.startsWith("b:")&&e.expiresAt&&e.expiresAt<=Date.now())).map(e=>t.jsx("div",{style:{background:e.read?"var(--panel-dark)":"var(--panel)",border:`1px solid ${e.read?"rgba(255,255,255,0.08)":"rgba(125, 211, 252, 0.3)"}`,borderRadius:12,padding:16,cursor:e.videoId?"pointer":"default",opacity:e.read?.7:1},onClick:()=>{!e.read&&e.id.startsWith("n:")&&u([e.id]),e.videoId&&(window.location.hash="/mp/feed")},children:t.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12},children:[t.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:S(e)}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[t.jsx("strong",{style:{fontSize:14},children:w(e)}),t.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[t.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(e.createdAt).toLocaleDateString()}),e.id.startsWith("n:")&&t.jsx("button",{className:"icon-link",onClick:i=>{i.stopPropagation(),l(e.id)},style:{padding:4},children:t.jsx(D,{size:14})})]})]}),t.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const i=o(e.text);return i?`${i.inviter_username} invited you to join queue: ${i.queue_name}`:e.text||(e.kind==="star"?"One of your posts was starred!":e.kind==="likes5"?"One of your posts reached 5 likes!":e.kind==="comment"?"Someone commented on your post":e.kind==="inspiration"?"Someone is inspired by you!":e.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const i=o(e.text);return i&&!d.has(e.id)?t.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[t.jsxs("button",{className:"btn",onClick:s=>{s.stopPropagation(),b(e,i.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[t.jsx(m,{size:14,style:{marginRight:4}}),"Accept"]}),t.jsxs("button",{className:"btn secondary",onClick:s=>{s.stopPropagation(),N(e,i.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[t.jsx(I,{size:14,style:{marginRight:4}}),"Decline"]})]}):i&&d.has(e.id)?t.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),e.read&&e.readAt&&t.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(e.readAt).toLocaleString()]})]})]})},e.id))})]})}export{E as default};
