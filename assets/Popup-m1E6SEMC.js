import{r as i,j as o,Z as H}from"./vendor-react-BxoNMQk4.js";import{H as w}from"./vendor-CmWQUY7N.js";const z=({playbackUrl:s,streamUID:c,aspectRatio:r,preferNative:u=!1,autoplay:d=!1,loop:g=!1,muted:v=!1,controls:x=!0,onVideoRef:l,onClick:h})=>{const[t,a]=i.useState(1.7777777777777777),m=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches;i.useEffect(()=>{if(!m)return;const e=()=>a(window.innerWidth/Math.max(1,window.innerHeight));return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[m]);const y=i.useRef(null),R=`${i.useMemo(()=>{const e=1.3333333333333333,p=16/9,L=typeof r=="number"&&isFinite(r)&&r>0?r:null;if(L)return Math.min(p,Math.max(e,L));const S=m?t:16/9;return Math.min(p,Math.max(e,S))},[m,t,r])} / 1`,f=i.useMemo(()=>u?s||(c?`https://videodelivery.net/${c}/manifest/video.m3u8`:null):null,[u,s,c]);i.useEffect(()=>{if(!u||!f)return;let e=null,p=null;const S=setTimeout(()=>{const n=y.current;n&&(n.canPlayType("application/vnd.apple.mpegurl")?(n.src=f,p=()=>{console.warn("Native HLS playback failed")},n.addEventListener("error",p),d&&n.play().catch(E=>{console.debug("Autoplay prevented:",E)})):w.isSupported()?(e=new w({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90}),e.loadSource(f),e.attachMedia(n),e.on(w.Events.MANIFEST_PARSED,()=>{d&&n.play().catch(E=>{console.debug("Autoplay prevented:",E)})}),e.on(w.Events.ERROR,(E,M)=>{if(M.fatal)switch(M.type){case w.ErrorTypes.NETWORK_ERROR:console.warn("HLS network error, trying to recover..."),e==null||e.startLoad();break;case w.ErrorTypes.MEDIA_ERROR:console.warn("HLS media error, trying to recover..."),e==null||e.recoverMediaError();break;default:console.error("HLS fatal error:",M),e==null||e.destroy(),e=null;break}})):console.error("HLS is not supported in this browser"))},0);return()=>{clearTimeout(S);const n=y.current;e&&(e.destroy(),e=null),n&&(p&&n.removeEventListener("error",p),n.src="")}},[u,f,d]),i.useEffect(()=>{l&&l(y.current)},[l,u,f]);const j="100%",b=m?{width:"100%",maxWidth:j,maxHeight:"100%",aspectRatio:R,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"}:{width:"auto",maxWidth:j,maxHeight:"100%",height:"var(--player-height)",aspectRatio:R,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"};if(u&&f)return o.jsx("div",{style:b,onClick:h,onTouchEnd:e=>{h&&(e.preventDefault(),h())},children:o.jsx("video",{ref:y,autoPlay:d,loop:g,muted:v,controls:x,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:h?"pointer":"default"},children:"Your browser does not support the video tag."},f)});if(c){const e=`https://iframe.videodelivery.net/${c}`;return o.jsx(o.Fragment,{children:o.jsx("div",{style:b,children:o.jsx("iframe",{src:e,title:"Clip",allow:"autoplay; encrypted-media; picture-in-picture; fullscreen",allowFullScreen:!0,style:{flex:1,width:"100%",height:"100%",border:0}},c)})})}return s?o.jsx("div",{style:b,children:o.jsx("video",{controls:!0,style:{width:"100%",height:"100%"},poster:void 0,children:o.jsx("source",{src:s,type:"application/x-mpegURL"})})}):o.jsx("div",{children:"No video"})},A=({open:s,onClose:c,buttonRef:r,children:u,align:d="right",minWidth:g=160})=>{const[v,x]=i.useState(null),l=i.useRef(null);if(i.useEffect(()=>{if(!s||!r.current){x(null);return}const t=()=>{if(!r.current)return;const a=r.current.getBoundingClientRect();x({top:a.bottom+8,[d]:window.innerWidth-a[d==="right"?"right":"left"]})};return t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[s,r,d]),i.useEffect(()=>{if(!s)return;const t=a=>{l.current&&!l.current.contains(a.target)&&r.current&&!r.current.contains(a.target)&&c()};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[s,c,r]),!s||!v)return null;const h=o.jsx("div",{ref:l,style:{position:"fixed",top:v.top,[d]:v[d],background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:g,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:u});return H.createPortal(h,document.body)};export{z as P,A as a};
