const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-C0LnxBtm.js","assets/vendor-react-KNlIICER.js","assets/vendor-B51QgEgr.js","assets/moddi-routes-2MlJSwxv.js","assets/editor-CKaGu5o2.js","assets/vendor-zip-BgoDCYlF.js","assets/beatmap-preview-BTtknFFO.js","assets/editor-CG1yLUbS.css","assets/editor-components-C3VM5Nj7.js","assets/editor-components-Bzmrvihl.css","assets/vendor-hls-B_fsdCYC.js"])))=>i.map(i=>d[i]);
var Tt=Object.defineProperty;var Mt=(t,l,a)=>l in t?Tt(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a;var tt=(t,l,a)=>Mt(t,typeof l!="symbol"?l+"":l,a);import{r as o,j as e,q as Ne,t as Fe,R as T,v as Ke,g as qe,N as Pt,O as st,P as Rt,L as ce,Q as zt,S as At,C as mt,T as It,U as Ft,D as Oe,z as Dt,E as Ze,G as Ye,y as at,H as Wt,I as Bt,m as Ht,c as We,B as $t,h as et,V as qt,W as Ut,X as it,F as pt,i as Ot,Y as Qt,Z as nt,o as Ve,_ as Kt,$ as Gt,s as ht,J as Jt,w as Yt,p as Vt,a0 as rt,a1 as Xt,a2 as Zt,a3 as ft,e as es,a4 as ts,a5 as ss,a6 as as,a7 as is,a8 as ue,a9 as Le}from"./vendor-react-KNlIICER.js";import{y as ns}from"./vendor-B51QgEgr.js";import{u as Se,a as gt,b as ke,c as ve,d as Q,A as I,e as xt,O as Te,f as rs,g as os,h as ls,i as bt,j as ds,k as Be,l as cs,m as we,n as Xe,o as Me,T as us,D as ms,p as ps,q as hs,U as fs,Q as gs,N as xs}from"./moddi-routes-2MlJSwxv.js";import{i as vt,a as yt,b as jt,c as wt,H as bs}from"./editor-components-C3VM5Nj7.js";import{H as ge}from"./vendor-hls-B_fsdCYC.js";import{B as Nt,s as vs,E as ys}from"./editor-CKaGu5o2.js";import{P as js}from"./beatmap-preview-BTtknFFO.js";import"./vendor-zip-BgoDCYlF.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const p of s)if(p.type==="childList")for(const c of p.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const p={};return s.integrity&&(p.integrity=s.integrity),s.referrerPolicy&&(p.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?p.credentials="include":s.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function u(s){if(s.ep)return;s.ep=!0;const p=a(s);fetch(s.href,p)}})();const ws="modulepreload",Ns=function(t){return"/"+t},ot={},Ss=function(l,a,u){let s=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),b=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=Promise.allSettled(a.map(i=>{if(i=Ns(i),i in ot)return;ot[i]=!0;const f=i.endsWith(".css"),x=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${x}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":ws,f||(m.as="script"),m.crossOrigin="",m.href=i,b&&m.setAttribute("nonce",b),document.head.appendChild(m),f)return new Promise((N,k)=>{m.addEventListener("load",N),m.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${i}`)))})}))}function p(c){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=c,window.dispatchEvent(b),!b.defaultPrevented)throw c}return s.then(c=>{for(const b of c||[])b.status==="rejected"&&p(b.reason);return l().catch(p)})},ks=new ns({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class _s extends o.Component{constructor(a){super(a);tt(this,"handleRetry",()=>{const a=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),a&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,u){console.error("ErrorBoundary caught an error:",a,u)}isChunkLoadingError(a){if(!a)return!1;const u=a.message.toLowerCase();return u.includes("loading chunk")||u.includes("failed to load")||u.includes("chunk load failed")||u.includes("loading css chunk")||a.name==="ChunkLoadError"}render(){var a;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const u=this.isChunkLoadingError(this.state.error),s=((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:u?"Failed to load page. This might be a network issue.":s}),u&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:u?"Reload Page":"Try Again"}),!u&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const ye=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Es({i:t}){const l=t*1337,a=(k,S)=>{const y=Math.sin(l+k+S)*1e4,j=y-Math.floor(y);return Math.floor(j*(S-k+1)+k)},u=a(0,100),s=a(24,50),p=.7+a(0,100)/100*.3,c=s*p,b=a(0,4e3),i=a(-10,10),f=a(-8,8),x=a(0,100),m=x<60?1:x<80?1.5:2,N=[{size:200*m,alpha:.06,dx:-22,dy:12,color:ye[a(0,ye.length-1)]},{size:150*m,alpha:.08,dx:-9,dy:7,color:ye[a(0,ye.length-1)]},{size:120*m,alpha:.1,dx:0,dy:0,color:ye[a(0,ye.length-1)]},{size:90*m,alpha:.12,dx:12,dy:-4,color:ye[a(0,ye.length-1)]},{size:64*m,alpha:.13,dx:20,dy:-7,color:ye[a(0,ye.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${u}vw`,animationDuration:`${c}s`,animationDelay:`${b}ms`,"--tx":`${i}vw`,transform:`rotate(${f}deg)`},children:N.map((k,S)=>e.jsx("svg",{width:k.size,height:k.size,viewBox:"0 0 100 100",style:{left:`${50+k.dx}%`,bottom:`${k.dy}px`,transform:"translateX(-50%)","--alpha":k.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:k.color})},S))})}function Cs({paused:t=!1}){const l=o.useMemo(()=>new Array(20).fill(0).map((a,u)=>u),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:l.map(a=>e.jsx(Es,{i:a},a))})}function Ls(){const t=Ne(),l=Fe(),{lastSection:a,previousLocation:u,setPreviousLocation:s}=Se(),p=T.useRef(null);T.useRef(!1),T.useRef(0),T.useRef(0);const c=T.useRef(null),b=T.useRef(null);T.useRef(!1);const i=T.useRef(null),f=T.useRef(null),x=T.useRef(null),[m,N]=T.useState(!1),[k,S]=T.useState(12),y=T.useRef(null),j=T.useRef(null),[g,C]=T.useState(!1),[U,w]=T.useState(12),[F,D]=T.useState([]),[n,H]=T.useState(""),W=T.useRef(null),L=T.useRef(null),[$,K]=T.useState(!1),[P,B]=T.useState(12),[z,G]=T.useState(null),V=T.useCallback(()=>{if(!f.current)return;const A=f.current.getBoundingClientRect(),ae=window.innerWidth||document.documentElement.clientWidth||320,M=160;let R=A.left;R+M+8>ae&&(R=Math.max(8,ae-M-8)),R=Math.max(8,R),S(R)},[]),_=T.useCallback(()=>{if(!y.current)return;const A=y.current.getBoundingClientRect(),ae=window.innerWidth||document.documentElement.clientWidth||320,M=220;let R=A.left;R+M+8>ae&&(R=Math.max(8,ae-M-8)),R=Math.max(8,R),w(R)},[]),Y=T.useCallback(()=>{if(!W.current)return;const A=W.current.getBoundingClientRect(),ae=window.innerWidth||document.documentElement.clientWidth||320,M=280;let R=A.left;R+M+8>ae&&(R=Math.max(8,ae-M-8)),R=Math.max(8,R),B(R)},[]);T.useEffect(()=>()=>{p.current&&clearTimeout(p.current),c.current&&clearTimeout(c.current),b.current&&clearTimeout(b.current)},[]),T.useEffect(()=>{if(!m)return;const A=ae=>{const M=ae.target;x.current&&!x.current.contains(M)&&f.current&&!f.current.contains(M)&&N(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[m]),T.useEffect(()=>{if(!g)return;const A=ae=>{const M=ae.target;j.current&&!j.current.contains(M)&&y.current&&!y.current.contains(M)&&C(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[g]),T.useEffect(()=>{if(!$)return;const A=ae=>{const M=ae.target;L.current&&!L.current.contains(M)&&W.current&&!W.current.contains(M)&&K(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[$]),T.useEffect(()=>{if(!m)return;V();const A=()=>V();return window.addEventListener("resize",A),window.addEventListener("orientationchange",A),()=>{window.removeEventListener("resize",A),window.removeEventListener("orientationchange",A)}},[m,V]),T.useEffect(()=>{if(!g)return;_();const A=()=>_();return window.addEventListener("resize",A),window.addEventListener("orientationchange",A),()=>{window.removeEventListener("resize",A),window.removeEventListener("orientationchange",A)}},[g,_]),T.useEffect(()=>{if(!$)return;Y();const A=()=>Y();return window.addEventListener("resize",A),window.addEventListener("orientationchange",A),()=>{window.removeEventListener("resize",A),window.removeEventListener("orientationchange",A)}},[$,Y]);const se=t.pathname==="/feed"||t.pathname.startsWith("/feed/")||t.pathname==="/queues"||t.pathname.startsWith("/queues/")||t.pathname==="/discover"||t.pathname==="/submissions",ie=t.pathname==="/"||t.pathname==="/about",v=t.pathname==="/editor";t.pathname.startsWith("/mp/")||se&&a==="mappi"||!ie&&!se&&t.pathname.startsWith("/md/"),t.pathname.startsWith("/md/")||se&&a==="moddi"||!ie&&!se&&t.pathname.startsWith("/mp/"),T.useEffect(()=>{if(!v)return;const A=M=>{const R=M.detail||{},re=Array.isArray(R.items)?R.items:[];D(re),H(String(R.selected||""))},ae=M=>{const R=M.detail||{};G({title:String(R.title||""),artist:String(R.artist||""),mapper:String(R.mapper||""),version:String(R.version||""),beatmapId:Number(R.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",A),window.addEventListener("editor:info",ae),()=>{window.removeEventListener("editor:difficulty:list",A),window.removeEventListener("editor:info",ae)}},[v]);const O=gt(),{data:h}=ke(),E=T.useRef(null),X=T.useRef(!1),ee=A=>{X.current=!1,(h!=null&&h.is_mod||h!=null&&h.is_admin)&&(A.preventDefault(),A.stopPropagation(),E.current=setTimeout(()=>{X.current=!0,l("/moderation")},500))},de=()=>{E.current&&(clearTimeout(E.current),E.current=null),X.current&&setTimeout(()=>{X.current=!1},100)},r=A=>{if(X.current){A.preventDefault(),A.stopPropagation();return}l("/settings")},q=A=>{if(de(),X.current){A.preventDefault();return}l("/settings")};if(T.useEffect(()=>()=>{E.current&&clearTimeout(E.current)},[]),ie)return null;const ne=()=>{l(u||"/feed")},Z=()=>{N(A=>!A)},fe=()=>{var A;N(!1),(A=i.current)==null||A.click()},Ae=()=>{C(A=>!A)},Ie=A=>{C(!1),H(A),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:A}}))},He=()=>{K(A=>!A)};return v?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:i,type:"file",accept:".osz,.zip",onChange:A=>{var M;const ae=(M=A.target.files)==null?void 0:M[0];ae&&window.dispatchEvent(new CustomEvent("editor:file",{detail:ae}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ne,"aria-label":"Back",title:"Go back",children:e.jsx(Ke,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:f,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Z,"aria-label":"File",title:"File menu","aria-expanded":m,children:e.jsx(Pt,{size:20})}),m&&qe.createPortal(e.jsx("div",{ref:x,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${k}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:fe,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:ne,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[F.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:y,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Ae,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":g,children:e.jsx(st,{size:20})}),g&&qe.createPortal(e.jsx("div",{ref:j,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${U}px`,minWidth:220},children:F.map(A=>{const ae=A.mode==="taiko"?vt:A.mode==="mania"?yt:A.mode==="catch"?jt:wt;return e.jsxs("button",{className:`mode-option ${n===A.path?"selected":""}`,type:"button",onClick:()=>Ie(A.path),children:[e.jsx("img",{className:"mode-icon",src:ae,width:24,height:24,alt:""}),e.jsx("span",{children:A.version||"(Untitled)"})]},A.path)})}),document.body)]}),z&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:W,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:He,"aria-label":"Map Info",title:"Map Info","aria-expanded":$,children:e.jsx(Rt,{size:20})}),$&&qe.createPortal(e.jsx("div",{ref:L,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${P}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[z.artist||"Artist"," – ",z.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",z.mapper||"Unknown"]}),z.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",z.version]}),z.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${z.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]}):e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(ce,{to:"/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/feed"||t.pathname.startsWith("/feed/")?"active":""}`,"aria-label":"Feed",children:e.jsx(st,{size:20})}),e.jsx(ce,{to:"/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(zt,{size:20})}),e.jsx(ce,{to:"/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/queues"||t.pathname.startsWith("/queues/")?"active":""}`,"aria-label":"Queues",children:e.jsx(At,{size:20})})]}),e.jsx(ce,{to:"/",className:"mobile-bottom-nav-coin-flip","aria-label":"Home",title:"Go to home",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"m!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(ce,{to:"/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(mt,{size:20}),O>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:r,onTouchStart:ee,onTouchEnd:q,onMouseDown:ee,onMouseUp:de,onMouseLeave:de,"aria-label":h!=null&&h.is_mod||h!=null&&h.is_admin?"Settings (long press for moderation)":"Settings",title:h!=null&&h.is_mod||h!=null&&h.is_admin?"Settings (long press for moderation)":"Settings",children:e.jsx(It,{size:20})})]})]})}function Ts(){return e.jsx(ce,{to:"/feed",className:"title",style:{textDecoration:"none",color:"inherit"},children:"mappi"})}function Ms({isEditor:t}){return Ne(),t?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ce,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Ft,{size:18})}),e.jsx(ce,{to:"/feed",className:"title",children:"osu!editi.ng"})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:4},children:e.jsx(Ts,{})})}function Ps({isNeutralPage:t}){const a=Ne().pathname;return t&&a!=="/"?e.jsx("nav",{className:"nav-links","aria-label":"Primary",children:e.jsx(ce,{to:a==="/about"?"/":"/about",className:a==="/about"?"active":"",children:a==="/about"?"Home":"About"})}):e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[e.jsx(ce,{to:"/feed",className:a==="/feed"||a.startsWith("/feed/")?"active":"",children:"Feed"}),e.jsx(ce,{to:"/discover",className:a==="/discover"?"active":"",children:"Discover"}),e.jsx(ce,{to:"/queues",className:a==="/queues"||a.startsWith("/queues/")?"active":"",children:"Queues"}),e.jsx(ce,{to:"/editor",className:a==="/editor"?"active":"",children:"Editor"})]})}function Rs(t,l,a,u){const s=Fe(),{notify:p}=ve(),[c,b]=o.useState(new Set);return{parseQueueInvite:S=>{if(!S)return null;try{const y=JSON.parse(S);if((y==null?void 0:y.type)==="queue_invite"&&(y!=null&&y.queue_id))return y}catch{}return null},handleAcceptInvite:async(S,y)=>{if(!c.has(S.id)){b(j=>new Set(j).add(S.id));try{await Q(I.moddi.queueAccept(String(y)),{method:"POST"}),p("Invitation accepted!",{variant:"success"}),a.mutate(S.id),u(!1),s(`/queues/${y}`)}catch(j){p((j==null?void 0:j.message)||"Failed to accept invitation",{variant:"error"})}finally{b(j=>{const g=new Set(j);return g.delete(S.id),g})}}},handleDenyInvite:async(S,y)=>{if(!c.has(S.id)){b(j=>new Set(j).add(S.id));try{await Q(I.moddi.queueDeny(String(y)),{method:"POST"}),p("Invitation declined",{variant:"success"}),a.mutate(S.id)}catch(j){p((j==null?void 0:j.message)||"Failed to decline invitation",{variant:"error"})}finally{b(j=>{const g=new Set(j);return g.delete(S.id),g})}}},handleMarkAllRead:async()=>{const S=t.filter(y=>y.id.startsWith("n:")||y.kind==="system"&&!y.read).map(y=>y.id);S.length>0&&l.mutate(S)},handleNotificationClick:async S=>{u(!1),l.mutate([S.id]);const y=typeof S.targetPath=="string"&&S.targetPath.trim().length>0?S.targetPath:null;if(y&&s(y),S.kind==="system"||S.id.startsWith("n:"))try{await Q(I.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[S.id]})})}catch{}},handleDeleteNotification:async(S,y)=>{S.stopPropagation(),a.mutate(y)},processing:c}}function zs({notifications:t,unreadCount:l,notifOpen:a,setNotifOpen:u,markReadMutation:s,deleteNotificationMutation:p,closeAllPanels:c}){const b=o.useRef(null),i=o.useRef(null),{parseQueueInvite:f,handleAcceptInvite:x,handleDenyInvite:m,handleMarkAllRead:N,handleNotificationClick:k,handleDeleteNotification:S,processing:y}=Rs(t,s,p,u);xt(b,i,a,()=>u(!1));const j=t.filter(g=>!(g.kind==="system"&&g.id.startsWith("b:")&&(g.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:b,className:"icon-link",onClick:()=>{a||c(),u(!a)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(mt,{size:18})}),l>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),a&&e.jsxs("div",{ref:i,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(ce,{to:"/notifications",onClick:()=>u(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.7",children:"View all"}),j.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:N,children:e.jsx(Oe,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[j.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),j.map(g=>{const C=f(g.text),U=g.id.startsWith("b:"),w=C?"queue-invite":g.kind==="star"?"star":g.kind==="likes5"?"likes":g.kind==="comment"?"comment":g.kind==="inspiration"?"inspiration":g.kind==="reaction"?"reaction":U?"global":"system",F=g.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${w}`,role:"button",onClick:()=>!C&&k(g),children:[e.jsxs("div",{className:`notif-icon ${F?"deletable":""}`,"aria-hidden":"true",onClick:F&&!C?D=>S(D,g.id):void 0,title:F&&!C?"Remove":void 0,role:F&&!C?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:C?e.jsx(Dt,{}):w==="star"?e.jsx(Ze,{}):w==="likes"?e.jsx(Ye,{}):w==="comment"?e.jsx(at,{}):w==="inspiration"?e.jsx(at,{}):w==="reaction"?e.jsx(Wt,{}):w==="global"?e.jsx(Bt,{}):null}),F&&!C?e.jsx("span",{className:"swap-trash",children:e.jsx(Ht,{})}):null]}),e.jsx("div",{className:"notif-body",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[C.inviter_username," invited you to join queue: ",C.queue_name]}),y.has(g.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:D=>{D.stopPropagation(),x(g,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Oe,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:D=>{D.stopPropagation(),m(g,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(We,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):g.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:U?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Te,{text:g.text||""})}),U&&g.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(g.expiresAt).toLocaleString()]}):null]}):g.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Te,{text:g.text||"Someone commented on your post"})})]}):g.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Te,{text:g.text||"Someone is inspired by you!"})})]}):g.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:e.jsx(Te,{text:g.text||"Someone raised their hand on your post!"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:g.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:g.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},g.id)})]})]})]})}function As({quota:t,nowTick:l}){if(!(t!=null&&t.blocked))return null;const a=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),u=Math.floor(a/3600),s=Math.floor(a%3600/60),p=a%60,c=i=>String(i).padStart(2,"0"),b=u>0?`${u}:${c(s)}:${c(p)}`:`${s}:${c(p)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx($t,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:b})]})}function Is({me:t,menuOpen:l,setMenuOpen:a,onLogout:u,closeAllPanels:s}){const p=o.useRef(null),c=o.useRef(null);return xt(p,c,l,()=>a(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:p,className:"icon-link",onClick:()=>{l||s(),a(!l)},title:t.username,"aria-label":"User menu","aria-expanded":l,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(et,{size:14,style:{opacity:.8}})]}),l&&e.jsxs("div",{ref:c,className:"menu-panel",role:"menu",children:[e.jsx(ce,{to:"/profile",className:"menu-item",onClick:()=>a(!1),children:"Profile"}),e.jsx(ce,{to:"/settings",className:"menu-item",onClick:()=>a(!1),children:"Settings"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(ce,{to:"/moderation",className:"menu-item",onClick:()=>a(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:u,children:"Log out"})]})]})}function Fs({isNeutralPage:t,isEditor:l}){const a=Ne(),u=Fe(),{data:s,isLoading:p}=ke(),{data:c}=rs(!!s),{data:b=[]}=os(!!s),i=gt(),f=ls(),x=bt(),m=ds(),{menuOpen:N,notifOpen:k,setMenuOpen:S,setNotifOpen:y,closeAllPanels:j,previousLocation:g,lastSection:C}=Se(),U=a.pathname==="/settings",w=a.pathname==="/moderation",F=a.pathname==="/profile"||a.pathname.startsWith("/profile/"),D=U||w||F,n=()=>{u(g||"/feed")},[H,W]=T.useState(0);return T.useEffect(()=>{const L=setInterval(()=>W($=>$+1),1e3);return()=>clearInterval(L)},[]),e.jsxs("header",{className:"top-nav",children:[D?e.jsx("button",{onClick:n,className:"icon-link",title:"Go back","aria-label":"Go back",style:{width:"auto",height:"auto",padding:"2px"},children:e.jsx(Ke,{size:18})}):e.jsx("img",{src:"/icon.png",alt:"o!m",width:24,height:24,style:{objectFit:"contain"}}),e.jsx(Ms,{isEditor:l}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),a.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(bs,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{isNeutralPage:t}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(qt,{size:18})}),s?e.jsxs("div",{className:"user-menu",children:[e.jsx(zs,{notifications:b,unreadCount:i,notifOpen:k,setNotifOpen:y,markReadMutation:x,deleteNotificationMutation:m,closeAllPanels:j}),e.jsx(As,{quota:c,nowTick:H}),e.jsx(Is,{me:s,menuOpen:N,setMenuOpen:S,onLogout:()=>f.mutate(),closeAllPanels:j})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Be+I.auth.login},disabled:p,children:p?"Checking…":"Login with osu!"})]})]})}const Ds=({context:t,onClose:l,style:a})=>{const u=Ne(),s=T.useMemo(()=>{if(t)return t;const w=u.pathname;return w==="/feed"||w==="/mp/feed"?"mappi-feed":w==="/md/feed"?"moddi-feed":w==="/queues"||w==="/md/queues"?"moddi-queues":w.startsWith("/queues/")||w.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,u.pathname]),{modeFilters:p,setModeFilters:c,tagFilters:b,setTagFilters:i,queueOpenFilters:f,setQueueOpenFilters:x,queueStatusFilters:m,setQueueStatusFilters:N,queueTypeFilters:k,setQueueTypeFilters:S}=Se(),y=w=>{const F={...b,[w]:!b[w]};!F.untagged&&!F.help&&(F.help=!0),i(F);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},j=w=>{const F={...m,[w]:!m[w]};["unchecked","accepted","denied","finished"].some(n=>F[n])||(F.unchecked=!0),N(F)},g=w=>{const F={...k,[w]:!k[w]};!F.modder&&!F.nominator&&!F.timing&&!F.audio&&(F.modder=!0),S(F)},C=({title:w,children:F})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:w}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:F})]}),U=({active:w,onClick:F,label:D})=>e.jsx("button",{type:"button",onClick:F,className:"chip","aria-pressed":w,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:w?"rgba(125,211,252,0.6)":"var(--border)",background:w?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:D});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{zIndex:1e4,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...a},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),l&&e.jsx("button",{className:"icon-link",onClick:l,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(We,{size:16})})]}),s==="moddi-feed"&&e.jsxs(C,{title:"Tags",children:[e.jsx(U,{active:b.untagged,onClick:()=>y("untagged"),label:"Untagged"}),e.jsx(U,{active:b.help,onClick:()=>y("help"),label:"Help"})]}),s==="moddi-queues"&&e.jsxs(C,{title:"Type",children:[e.jsx(U,{active:k.modder,onClick:()=>g("modder"),label:"Modding"}),e.jsx(U,{active:k.nominator,onClick:()=>g("nominator"),label:"BN/Subdivision"}),e.jsx(U,{active:k.timing,onClick:()=>g("timing"),label:"Timing"}),e.jsx(U,{active:k.audio,onClick:()=>g("audio"),label:"Audio"})]}),s==="moddi-queue-detail"&&e.jsxs(C,{title:"Submissions",children:[e.jsx(U,{active:m.unchecked,onClick:()=>j("unchecked"),label:"Pending"}),e.jsx(U,{active:m.accepted,onClick:()=>j("accepted"),label:"Accepted"}),e.jsx(U,{active:m.denied,onClick:()=>j("denied"),label:"Denied"}),e.jsx(U,{active:m.finished,onClick:()=>j("finished"),label:"Finished"})]})]})};function Ws({title:t,onRefresh:l}){const{data:a}=ke(),u=Ne(),s=Fe(),{lastSection:p}=Se(),[c,b]=T.useState(!0),[i,f]=T.useState(0),[x,m]=T.useState(!1),N=T.useRef(!1),k=T.useRef(0),[S,y]=T.useState(!1),j=T.useRef(null),{data:g=[]}=cs(),C=bt(),{notify:U}=ve();T.useEffect(()=>{const n=document.querySelector(".page");if(!n)return;let H=n.scrollTop,W=!1;const L=()=>{W||(W=!0,requestAnimationFrame(()=>{const $=n.scrollTop,K=$-H;$<=12||K<-12?b(!0):K>12&&b(!1),H=$,W=!1}))};return n.addEventListener("scroll",L,{passive:!0}),()=>n.removeEventListener("scroll",L)},[]),T.useEffect(()=>{const n=document.querySelector(".page");if(!n)return;const H=120,W=70,L=B=>{var z;x||(n.scrollTop<=0?(N.current=!0,k.current=((z=B.touches[0])==null?void 0:z.clientY)??0):N.current=!1)},$=B=>{var V;if(!N.current||x)return;const z=((V=B.touches[0])==null?void 0:V.clientY)??0,G=Math.max(0,z-k.current);if(G>0){const _=Math.min(H,G*.5);f(_)}},K=async()=>{try{if(m(!0),l)await l();else{window.location.reload();return}}finally{setTimeout(()=>{m(!1),f(0)},400)}},P=()=>{!N.current||x||(i>=W?K():f(0),N.current=!1)};return n.addEventListener("touchstart",L,{passive:!0}),n.addEventListener("touchmove",$,{passive:!0}),n.addEventListener("touchend",P),n.addEventListener("touchcancel",P),()=>{n.removeEventListener("touchstart",L),n.removeEventListener("touchmove",$),n.removeEventListener("touchend",P),n.removeEventListener("touchcancel",P)}},[i,x,l]);const{showBack:w,onBack:F}=T.useMemo(()=>{const n=u.pathname;if(/^\/feed\/.+/.test(n))return{showBack:!0,onBack:()=>s("/feed")};if(/^\/mp\/feed\/.+/.test(n))return{showBack:!0,onBack:()=>s("/feed")};if(/^\/md\/feed\/.+/.test(n))return{showBack:!0,onBack:()=>s("/feed")};if(/^\/queues\/.+/.test(n))return{showBack:!0,onBack:()=>s("/queues")};if(/^\/md\/queues\/.+/.test(n))return{showBack:!0,onBack:()=>s("/queues")};if(n==="/profile"||n.startsWith("/profile/")){const H="/feed";return{showBack:!0,onBack:()=>{window.history.length>2?s(-1):s(H)}}}return{showBack:!1,onBack:()=>{}}},[u.pathname,s,p]),D=u.pathname==="/notifications";return e.jsxs("div",{className:`mobile-page-header ${c?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${c?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:w?e.jsx("button",{className:"icon-link",onClick:F,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ke,{size:18})}):e.jsx(ce,{to:"/profile",className:"icon-link","aria-label":"Profile",children:a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"var(--hover-overlay-strong)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:D?e.jsx("button",{className:"icon-link","aria-label":"Mark all read",title:"Mark all read",style:{padding:4},onClick:()=>{const n=g.filter(H=>!H.read&&(H.id.startsWith("n:")||H.kind==="system"&&!H.id.startsWith("b:"))).map(H=>H.id);n.length!==0&&C.mutate(n,{onSuccess:()=>{U("All notifications marked as read",{variant:"success"})}})},children:e.jsx(Oe,{size:18})}):(()=>{const n=u.pathname;let H=null;return n==="/feed"||n==="/mp/feed"?H="mappi-feed":n==="/md/feed"?H="moddi-feed":n==="/queues"||n==="/md/queues"?H="moddi-queues":(n.startsWith("/queues/")||n.startsWith("/md/queues/"))&&(H="moddi-queue-detail"),H?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:j,className:"icon-link","aria-haspopup":"dialog","aria-expanded":S,onClick:()=>y(W=>!W),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(Ut,{size:18})}),S&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(Ds,{context:H,onClose:()=>y(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:x||i>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(i,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${x?"spin":i>60?"ready":""}`})})]})}function Bs({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function Hs(){const t=Ne(),{notify:l}=ve(),{data:a}=ke(),{setPreviousLocation:u}=Se(),s=t.pathname,p=s==="/"||s==="/about",c=s==="/editor";T.useEffect(()=>{s==="/settings"||s==="/moderation"||s==="/profile"||s.startsWith("/profile/")||u(s)},[s,u]);const[b,i]=T.useState(null);T.useEffect(()=>{!a||!a.is_mod||(async()=>{try{const m=await Q(I.admin.debugState,{requireAuth:!1}),N=Array.isArray(m==null?void 0:m.counts)?m.counts.find(k=>String(k.status)==="ready"):null;N&&i(Number(N.c)||0)}catch{}})()},[a]),T.useEffect(()=>{a&&!localStorage.getItem("welcomed")&&(l(`Welcome, ${a.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[a,l]),T.useEffect(()=>{if(typeof window>"u"||!we()||s==="/editor")return;const N=document.querySelector(".page");N&&(N.scrollTop=0)},[s]);const{showMobileHeader:f,headerTitle:x}=T.useMemo(()=>{if(s==="/"||s==="/about"||s==="/editor"||s==="/discover"||s==="/mobile")return{showMobileHeader:!1,headerTitle:""};if(s==="/feed"||s.startsWith("/feed/"))return{showMobileHeader:!0,headerTitle:s==="/feed"?"Feed":"Post"};if(s==="/queues"||s.startsWith("/queues/"))return{showMobileHeader:!0,headerTitle:s==="/queues"?"Queues":"Queue"};if(s==="/notifications")return{showMobileHeader:!0,headerTitle:"Notifications"};if(s==="/profile"||s.startsWith("/profile/"))return{showMobileHeader:!0,headerTitle:"Profile"};if(s==="/settings")return{showMobileHeader:!0,headerTitle:"Settings"};if(s==="/moderation")return{showMobileHeader:!0,headerTitle:"Moderation"};if(s.startsWith("/mp/")||s.startsWith("/md/")){const m=s.split("/").filter(Boolean),N=m[1]||"";if(N==="feed")return{showMobileHeader:!0,headerTitle:m.length>2?"Post":"Feed"};if(N==="discover")return{showMobileHeader:!1,headerTitle:""};if(N==="queues")return{showMobileHeader:!0,headerTitle:m.length>2?"Queue":"Queues"}}return{showMobileHeader:!0,headerTitle:""}},[s]);return e.jsxs("div",{className:"app-shell",children:[e.jsx(Cs,{paused:s==="/editor"}),e.jsx(Fs,{isNeutralPage:p,isEditor:c}),e.jsxs("main",{className:`page ${s==="/editor"||s==="/discover"?"fullscreen":""} ${s.startsWith("/profile")?"flush":""}`,children:[f&&e.jsx(Ws,{title:x}),s==="/about"?e.jsx("div",{className:"card",children:e.jsx(it,{})}):e.jsx(it,{})]}),s!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(Bs,{readyCount:b})}),s!=="/mobile"&&e.jsx(Ls,{})]})}const $s="theme";function qs(){try{const t=localStorage.getItem($s);if(t==="light"||t==="dark")return t}catch{}return null}function St(t){if(!(typeof document>"u")){document.documentElement.setAttribute("data-theme",t);try{const l=document.querySelector('meta[name="theme-color"]');l&&(l.content=t==="light"?"#ffffff":"#1a1a1a")}catch{}}}function Us(t="dark"){const l=qs()||t;St(l)}function Os(){const{data:t,isLoading:l}=ke(),a=!!t,u=Fe(),{lastSection:s}=Se(),[p,c]=T.useState(!1);return T.useEffect(()=>{if(typeof window>"u")return;const b=localStorage.getItem("hide_mobile_install_prompt")==="1",i=we()&&!Xe()&&!b;c(i)},[]),T.useEffect(()=>{Xe()?u("/feed",{replace:!0}):a&&u("/feed",{replace:!0})},[u,a]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
        }
        
        .landing-btn-secondary {
          background: var(--panel);
          color: var(--text);
          border: 1px solid var(--border);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: var(--border-strong);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsx("div",{className:"landing-actions landing-actions-desktop",children:e.jsx(ce,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})}),!a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Be+I.auth.login},disabled:l,children:l?"Checking…":"Login with osu!"})}),a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx(ce,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})})]})]}),p&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{c(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(ce,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}const kt=({open:t,onClose:l,buttonRef:a,children:u,align:s="right",minWidth:p=160})=>{const[c,b]=o.useState(null),i=o.useRef(null);if(o.useEffect(()=>{if(!t||!a.current){b(null);return}const x=()=>{if(!a.current)return;const m=a.current.getBoundingClientRect();b({top:m.bottom+8,[s]:window.innerWidth-m[s==="right"?"right":"left"]})};return x(),window.addEventListener("resize",x),window.addEventListener("scroll",x,!0),()=>{window.removeEventListener("resize",x),window.removeEventListener("scroll",x,!0)}},[t,a,s]),o.useEffect(()=>{if(!t)return;const x=m=>{i.current&&!i.current.contains(m.target)&&a.current&&!a.current.contains(m.target)&&l()};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[t,l,a]),!t||!c)return null;const f=e.jsx("div",{ref:i,style:{position:"fixed",top:c.top,[s]:c[s],background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,padding:6,zIndex:1e3,minWidth:p,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:u});return qe.createPortal(f,document.body)},_t=({playbackUrl:t,streamUID:l,aspectRatio:a,preferNative:u=!1,autoplay:s=!1,loop:p=!1,muted:c=!1,controls:b=!0,onVideoRef:i,onClick:f,inOverlay:x=!1})=>{const m=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches,N=o.useRef(null),[k,S]=o.useState(null),y=o.useMemo(()=>{const n=typeof a=="number"&&isFinite(a)&&a>0?a:null;return n||16/9},[a]),g=`${k??y} / 1`,C=o.useMemo(()=>t||(l?`https://videodelivery.net/${l}/manifest/video.m3u8`:null),[t,l]),U=o.useRef(null);o.useEffect(()=>{C&&(U.current=C)},[C]),o.useEffect(()=>{S(null)},[C]),o.useEffect(()=>{if(!u||!N.current)return;const n=N.current;let H=!1;const W=()=>{if(!H)if(n.videoWidth>0&&n.videoHeight>0){const L=n.videoWidth/n.videoHeight;S(L),H=!0}else S(y),H=!0};return n.addEventListener("loadedmetadata",W),n.readyState>=1&&W(),()=>{n.removeEventListener("loadedmetadata",W)}},[u,y,C]);const w=o.useRef(null),F=o.useRef(null);o.useEffect(()=>{if(!C)return;let n=w.current,H=null,W=!1,L=null;if(n&&F.current&&F.current!==C){console.log(`[HLS] URL changed from ${F.current} to ${C}, using loadSource`);try{n.stopLoad(),n.loadSource(C),F.current=C;const _=N.current;if(_)try{_.pause(),_.currentTime=0,_.load()}catch(Y){console.warn("[HLS] Error resetting video element:",Y)}}catch(_){console.error("[HLS] Error switching source:",_);try{n.destroy()}catch{}n=null,w.current=null,F.current=null}}if(n&&F.current===C)return console.log(`[HLS] URL unchanged (${C}), reusing existing HLS instance`),()=>{W=!0};const $=()=>{if(document.hidden&&n){const _=N.current;if(_)try{_.pause()}catch{}try{n.stopLoad()}catch{}}},K=()=>{if(W=!0,n){try{n.stopLoad(),n.detachMedia(),n.destroy()}catch{}n=null}};document.addEventListener("visibilitychange",$),window.addEventListener("beforeunload",K);const P=()=>{const _=N.current;if(!_||W)return;try{for(_.pause(),_.currentTime=0,_.src="",_.srcObject=null;_.firstChild;)_.removeChild(_.firstChild);_.load()}catch(se){console.warn("[HLS] Error resetting video element:",se)}const Y=performance.now();if(console.log(`[HLS] Starting HLS setup for ${C} at ${Y.toFixed(2)}ms`),console.log("[HLS] Video element ready:",{readyState:_.readyState,isConnected:_.isConnected,paused:_.paused,currentTime:_.currentTime}),ge.isSupported()){console.log("[HLS] HLS.js is supported, creating instance");const se={enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,startLevel:-1,maxBufferLength:20,maxMaxBufferLength:60,maxBufferSize:60*1e3*1e3,maxBufferHole:.3,maxLoadingDelay:2,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxFragLoadingTimeMs:2e4,fragLoadingTimeOut:2e4,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,fragLoadingMaxRetry:3};try{const ie=performance.now();n=new ge(se),w.current=n,F.current=C;const v=performance.now()-ie;console.log(`[HLS] HLS instance created in ${v.toFixed(2)}ms`);const O=performance.now();n.loadSource(C);const h=performance.now()-O;console.log(`[HLS] loadSource() called in ${h.toFixed(2)}ms`);const E=performance.now();n.attachMedia(_);const X=performance.now()-E;console.log(`[HLS] attachMedia() completed in ${X.toFixed(2)}ms`);const ee=performance.now()-Y;console.log(`[HLS] Total HLS setup time: ${ee.toFixed(2)}ms`)}catch(ie){const v=performance.now()-Y;if(console.error(`[HLS] Failed to initialize HLS after ${v.toFixed(2)}ms:`,ie),n){try{n.destroy()}catch{}n=null}return}n.on(ge.Events.MANIFEST_PARSED,()=>{const ie=performance.now()-Y;if(console.log(`[HLS] MANIFEST_PARSED event fired at ${ie.toFixed(2)}ms after setup start`),W||!_)return;p&&(L=()=>{if(!(W||!_||!n))try{_.currentTime=0,_.play().catch(O=>{O.name!=="AbortError"&&O.name!=="NotAllowedError"&&console.debug("Loop play failed:",O)})}catch{_.currentTime=0,_.play().catch(()=>{})}},_.addEventListener("ended",L)),(()=>{if(!(W||!_))if(_.readyState>=2){if(s){const O=performance.now();_.play().then(()=>{const h=performance.now()-O;console.log(`[HLS] Autoplay succeeded in ${h.toFixed(2)}ms after MANIFEST_PARSED`)}).catch(h=>{const E=performance.now()-O;h.name!=="AbortError"&&h.name!=="NotAllowedError"&&console.warn(`[HLS] Autoplay prevented after ${E.toFixed(2)}ms:`,h)})}}else{const O=()=>{if(!(W||!_)&&(_.removeEventListener("canplay",O),s)){const h=performance.now();_.play().then(()=>{const E=performance.now()-h;console.log(`[HLS] Autoplay succeeded in ${E.toFixed(2)}ms after canplay event`)}).catch(E=>{const X=performance.now()-h;E.name!=="AbortError"&&E.name!=="NotAllowedError"&&console.warn(`[HLS] Autoplay prevented after ${X.toFixed(2)}ms:`,E)})}};_.addEventListener("canplay",O,{once:!0})}})()}),n.on(ge.Events.ERROR,(ie,v)=>{if(!W&&v.fatal)switch(v.type){case ge.ErrorTypes.NETWORK_ERROR:if(!W&&n)try{n.startLoad()}catch{}break;case ge.ErrorTypes.MEDIA_ERROR:if(!W&&n)try{n.recoverMediaError()}catch{}break;default:n&&(n.destroy(),n=null);break}})}else W||console.warn("HLS.js not supported, falling back to native HLS"),_.src=C,_.loop=p,H=()=>{W||console.warn("Native HLS playback failed")},_.addEventListener("error",H),s&&!W&&_.play().catch(se=>{se.name!=="AbortError"&&se.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",se)})};let B=0;const z=10,G=()=>{if(W)return;if(B++,B>z){console.error("[HLS] Failed to setup HLS after max attempts - video element may not be ready");return}const _=N.current;if(!_){requestAnimationFrame(G);return}if(!_.isConnected){requestAnimationFrame(G);return}P()},V=requestAnimationFrame(()=>{requestAnimationFrame(G)});return()=>{cancelAnimationFrame(V),W=!0,document.removeEventListener("visibilitychange",$),window.removeEventListener("beforeunload",K);const _=N.current;if(_&&L&&(_.removeEventListener("ended",L),L=null),n){try{n.stopLoad(),n.off(ge.Events.MANIFEST_PARSED),n.off(ge.Events.ERROR),n.off(ge.Events.MEDIA_ATTACHED),n.off(ge.Events.MEDIA_DETACHED),n.off(ge.Events.MANIFEST_LOADED),n.off(ge.Events.MEDIA_ATTACHING),n.off(ge.Events.MEDIA_DETACHING),n.off(ge.Events.DESTROYING),n.destroy()}catch{try{n&&n.detachMedia()}catch{}}n=null,w.current=null,F.current=null}if(_){H&&(_.removeEventListener("error",H),H=null);try{_.pause()}catch{}}}},[C,s]),o.useEffect(()=>(i&&N.current&&i(N.current),()=>{i&&i(null)}),[i,u,C]);const D=m||!x?{width:"auto",maxWidth:"100%",height:"100%",maxHeight:"100%",aspectRatio:g,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box",minWidth:0,minHeight:0,flexShrink:1,alignSelf:"center"}:{width:"100%",maxWidth:"100%",maxHeight:"calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 160px)",aspectRatio:g,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box",minWidth:0,minHeight:0,flexShrink:1,alignSelf:"center"};return C?e.jsx("div",{style:D,children:e.jsx("video",{ref:N,autoPlay:s,loop:!1,muted:c,controls:b,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:f?"pointer":"default"},children:"Your browser does not support the video tag."})}):e.jsx("div",{style:D,children:"No video available"})};function Qs({beatmapMeta:t,beatmapVersion:l}){const a=o.useRef(null),u=o.useRef(null),[s,p]=o.useState(!1),[c,b]=o.useState(!1),[i,f]=o.useState(0);o.useEffect(()=>{if(a.current&&u.current){const N=a.current.offsetWidth,k=u.current.scrollWidth;f(k),b(k>N)}},[t,l]);const x=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",l?` [${l}]`:""]}):l?`[${l}]`:"Beatmap",m=i>0?Math.max(3,i/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:a,className:"muted one-line",style:{fontSize:12,color:"var(--muted)",flex:"0 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&p(!0),onMouseLeave:()=>p(!1),children:[e.jsx("span",{ref:u,style:{display:"inline-block",animation:s&&c?`beatmap-marquee ${m}s linear infinite`:"none"},children:x}),s&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:x})]})]})}function Ks(t){return"post_type"in t?t.post_type==="mappi":!!t.stream_uid}function Qe({post:t,section:l,onUpdate:a,onDelete:u,me:s}){const p=Fe(),b=Ne().pathname.startsWith("/feed/"),i=Ks(t);t.id;const f=i?t.stream_uid||String(t.id||""):t.uid||String(t.id||""),x=f&&f!=="null"&&f!=="undefined"?`/feed/${f}`:`/feed/${t.id}`,[m,N]=o.useState(!1),[k,S]=o.useState(!1),[y,j]=o.useState(!1),[g,C]=o.useState(!1),[U,w]=o.useState(!1),F=o.useRef(null),D=o.useRef(null),n=o.useRef(null),[H,W]=o.useState(null),[L,$]=o.useState(null),{notify:K}=ve(),[P,B]=o.useState(i?t.liked_by_me:void 0),[z,G]=o.useState(i?t.likes_count:0),[V,_]=o.useState(i?void 0:t.reacted_by_me),[Y,se]=o.useState(i?0:t.reactions_count);o.useEffect(()=>{if(i){const d=t;B(d.liked_by_me),G(d.likes_count)}else{const d=t;_(!!d.reacted_by_me),se(d.reactions_count)}},[t,i]);const[ie,v]=o.useState(!1),[O,h]=o.useState(i?"":t.text??""),[E,X]=o.useState(t.beatmap_url||""),[ee,de]=o.useState(null),[r,q]=o.useState(null),[ne,Z]=o.useState(""),fe=o.useRef(0),Ae=s&&((i?t.uploader&&s.id===t.uploader.id:s.id===t.user_id)||s.is_admin||s.is_mod),Ie=(()=>{const d=t.created_at;if(!d)return"";const J=Math.floor(Date.now()/1e3)-d;return J<60?"just now":J<3600?`${Math.floor(J/60)}m`:J<86400?`${Math.floor(J/3600)}h`:J<604800?`${Math.floor(J/86400)}d`:new Date(d*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})})();o.useEffect(()=>{if(!ie&&!i){const d=t;h(d.text??""),X(d.beatmap_url||""),de(null),q(null),Z("")}},[t,ie,i]),o.useEffect(()=>{if(!ie||i)return;fe.current&&window.clearTimeout(fe.current);const d=(E||"").trim();if(!d){Z(""),de(null),q(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(d)){Z(""),de(null),q(null);return}return fe.current=window.setTimeout(async()=>{var te;try{let me;try{me=new URL(d)}catch{Z("Invalid URL format");return}const _e=me.hash.match(/#osu\/(\d+)/),Ee=_e?_e[1]:null;me.hash="";const ze={url:me.toString()};Ee&&(ze.beatmap_id=Ee);const be=await Q(I.osu.resolveBeatmap+Me(ze),{requireAuth:!1}),De=Array.isArray(be==null?void 0:be.diffs)?be.diffs:[];if(!De.length&&!be.setId){Z("No difficulties found"),de(null),q(null);return}if(de({setId:Number(be.setId)||0,beatmapId:be.beatmapId??null,title:String(be.title||""),artist:String(be.artist||""),mapper:String(be.mapper||""),diffs:De}),De.length>0){const Ct=Number.isFinite(Number(be.beatmapId))?Number(be.beatmapId):Number((te=De[0])==null?void 0:te.id),Ce=De.find(Lt=>Number(Lt.id)===Ct)||De[0];q({beatmapId:Number(Ce==null?void 0:Ce.id)||null,version:String((Ce==null?void 0:Ce.version)||""),mode:String((Ce==null?void 0:Ce.mode)||"standard")})}else q(null);Z("")}catch(me){Z(`Failed to resolve: ${(me==null?void 0:me.message)||"Unknown error"}`),de(null),q(null)}},400),()=>{fe.current&&window.clearTimeout(fe.current)}},[E,ie,i]),o.useEffect(()=>{if(i||!t.beatmap_url||L)return;const d=t;let J=!1;return(async()=>{try{let te;try{te=new URL(d.beatmap_url)}catch{return}const me=te.hash.match(/#osu\/(\d+)/),_e=me?me[1]:null;te.hash="";const Re={url:te.toString()};if(_e?Re.beatmap_id=_e:d.beatmap_id&&(Re.beatmap_id=String(d.beatmap_id)),!J){const ze=await Q(I.osu.resolveBeatmap+Me(Re),{requireAuth:!1});(ze.title||ze.artist)&&$({title:ze.title||null,artist:ze.artist||null,mapper:ze.mapper||null})}}catch{}})(),()=>{J=!0}},[t,i,L]);const He=async()=>{if(m||!i)return;N(!0);const d=P??!1,J=z,te=!d,me=te?z+1:Math.max(0,z-1);B(te),G(me);try{const _e=d?"DELETE":"POST",Ee=await Q(I.videos.like(t.id),{method:_e}),Re={...t,liked_by_me:te,likes_count:Ee.likes_count||me};B(te),G(Ee.likes_count??me),a&&a(Re)}catch{B(d),G(J),K("Failed to like",{variant:"error"})}finally{N(!1)}},A=async()=>{if(k||i)return;S(!0);const d=V??!1,J=Y,te=!d,me=te?Y+1:Math.max(0,Y-1);_(te),se(me);try{const _e=d?"DELETE":"POST",Ee=await Q(I.moddi.postReact(t.id),{method:_e}),Re={...t,reacted_by_me:te,reactions_count:Ee.reactions_count||me};_(te),se(Ee.reactions_count??me),a&&a(Re)}catch{_(d),se(J),K("Failed to react",{variant:"error"})}finally{S(!1)}},ae=async()=>{if(confirm(i?"Permanently delete this video?":"Permanently delete this post?")){try{const d=i?I.videos.delete(t.id):I.moddi.post(String(t.id));await Q(d,{method:"DELETE"}),K(i?"Video deleted":"Post deleted",{variant:"warn"}),u&&u(t.id)}catch(d){K((d==null?void 0:d.message)||(i?"Failed to delete video":"Failed to delete post"),{variant:"error"})}C(!1)}},M=async()=>{if(i){try{const d=!t.is_starred,J=d?"star":"unstar";await Q(I.admin.videosAction(t.id,J),{method:"POST"});const te={...t,is_starred:d};a&&a(te),K(d?"Post starred":"Star removed",{variant:"success"})}catch{K("Action failed",{variant:"error"})}C(!1)}},R=()=>{i||(v(!0),h(t.text??""),X(t.beatmap_url||""),de(null),q(null),Z(""),C(!1))},re=async()=>{if(!i)try{await Q(I.moddi.post(String(t.id)),{method:"PATCH",body:JSON.stringify({text:O.trim(),beatmap_url:E.trim()||null,beatmapset_id:(ee==null?void 0:ee.setId)??void 0,beatmap_id:(r==null?void 0:r.beatmapId)??(ee==null?void 0:ee.beatmapId)??void 0,beatmap_version:(r==null?void 0:r.version)??void 0})});const d=await Q(I.moddi.post(String(t.id)),{method:"GET",requireAuth:!1});a&&d.post&&a({...t,...d.post}),K("Post updated",{variant:"success"}),v(!1)}catch(d){K((d==null?void 0:d.message)||"Failed to update post",{variant:"error"})}},oe=()=>{v(!1);const d=t;h(d.text??""),X(d.beatmap_url||""),de(null),q(null),Z("")};o.useEffect(()=>{if(!y||!D.current){W(null);return}const d=()=>{if(D.current){const J=D.current.getBoundingClientRect();W({top:J.bottom+8,right:window.innerWidth-J.right})}};return d(),window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),()=>{window.removeEventListener("resize",d),window.removeEventListener("scroll",d,!0)}},[y]),o.useEffect(()=>{if(!y)return;const d=J=>{F.current&&!F.current.contains(J.target)&&D.current&&!D.current.contains(J.target)&&j(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[y]);const xe=d=>{const J=d.target;if(J.closest("button")||J.closest(".menu-panel")||J.closest("input")||J.closest("textarea")||J.closest("select"))return;const te=J.closest("a");te&&te.getAttribute("href")!==`#${x}`||p(x)},le=i?t.uploader||{id:0,username:"Unknown",avatar_url:null}:{id:t.user_id||0,username:t.username||"Unknown",avatar_url:t.avatar_url||null},pe=!i&&(V??(t.reacted_by_me===!0||t.reacted_by_me===1)),$e=!i&&t.tags&&(typeof t.tags=="string"?t.tags.split(",").map(d=>d.trim()):[]).includes("help"),he=t.beatmapset_id,Pe=t.beatmap_id,Ge=t.beatmap_version;return e.jsxs("article",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",position:"relative",cursor:"pointer"},onMouseEnter:d=>d.currentTarget.style.backgroundColor="rgba(255,255,255,0.04)",onMouseLeave:d=>d.currentTarget.style.backgroundColor="var(--panel)",onClick:xe,children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[le.avatar_url?e.jsx(ce,{to:`/profile/${le.id}`,onClick:d=>d.stopPropagation(),style:{flexShrink:0},children:e.jsx("img",{src:le.avatar_url,width:40,height:40,style:{borderRadius:"50%",border:"1px solid rgba(255,255,255,0.08)",display:"block"},alt:le.username})}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.08)",flexShrink:0}}),e.jsx(ce,{to:x,style:{flex:1,minWidth:0,textDecoration:"none",color:"inherit",display:"block"},onClick:d=>{const J=d.target,te=J.closest("a");if(te&&te!==d.currentTarget){d.preventDefault(),d.stopPropagation();return}if(J.closest("button")||J.closest(".menu-panel")||J.closest("input")||J.closest("textarea")||J.closest("select")){d.preventDefault(),d.stopPropagation();return}d.stopPropagation()},children:e.jsxs("div",{style:{flex:1,minWidth:0,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6,marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(ce,{to:`/profile/${le.id}`,style:{textDecoration:"none",color:"inherit",fontWeight:600,fontSize:14},onClick:d=>d.stopPropagation(),onMouseEnter:d=>d.currentTarget.style.color="#7dd3fc",onMouseLeave:d=>d.currentTarget.style.color="inherit",children:le.username}),i&&t.is_starred&&e.jsx(Ze,{size:14,color:"#f59e0b",title:"Starred"}),i&&t.mode&&e.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:"rgba(125, 211, 252, 0.2)",border:"1px solid rgba(125, 211, 252, 0.4)",color:"#7dd3fc",fontWeight:500,lineHeight:1.2,textTransform:"capitalize"},children:t.mode}),!i&&$e&&e.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:"rgba(234, 179, 8, 0.2)",border:"1px solid rgba(234, 179, 8, 0.4)",color:"#fbbf24",fontWeight:500,lineHeight:1.2},children:"Help"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[Ie&&e.jsx("span",{className:"muted",style:{fontSize:13},children:Ie}),Ae&&e.jsx("button",{ref:n,onClick:d=>{d.preventDefault(),d.stopPropagation(),C(J=>!J)},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:4,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4},onMouseEnter:d=>d.currentTarget.style.backgroundColor="var(--hover-overlay)",onMouseLeave:d=>d.currentTarget.style.backgroundColor="transparent","aria-label":"Post options",children:e.jsx(pt,{size:16})})]})]}),i&&b&&t.playback_url&&e.jsx("div",{style:{marginBottom:10,borderRadius:8,overflow:"hidden",background:"var(--panel-dark)"},children:e.jsx(_t,{playbackUrl:t.playback_url,streamUID:t.stream_uid,aspectRatio:t.width&&t.height?t.width/t.height:null})}),i&&!b&&t.poster_url&&e.jsxs("div",{style:{marginBottom:10,borderRadius:8,overflow:"hidden",background:"var(--panel-dark)",aspectRatio:t.width&&t.height?`${t.width} / ${t.height}`:"16 / 9",position:"relative"},children:[e.jsx("img",{src:t.poster_url,alt:"Video thumbnail",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}),t.duration_sec&&e.jsxs("div",{style:{position:"absolute",bottom:8,right:8,background:"rgba(0,0,0,0.7)",color:"#fff",padding:"2px 6px",borderRadius:4,fontSize:11,fontWeight:500},children:[Math.floor(t.duration_sec/60),":",(t.duration_sec%60).toFixed(0).padStart(2,"0")]})]}),!i&&ie?e.jsx("div",{style:{marginBottom:12},children:e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("textarea",{value:O,onChange:d=>h(d.target.value),maxLength:200,rows:2,style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:8,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",width:"100%"}}),ee?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[ee.artist," – ",ee.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",ee.mapper]})]}),ee.diffs.length>0&&e.jsx("select",{value:(r==null?void 0:r.beatmapId)??(ee==null?void 0:ee.beatmapId)??void 0,onChange:d=>{const J=Number(d.target.value),te=(ee==null?void 0:ee.diffs.find(me=>Number(me.id)===J))||null;te&&q({beatmapId:J,version:te.version,mode:String(te.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"4px 8px",fontSize:12},children:ee.diffs.map(d=>e.jsxs("option",{value:d.id,children:[d.version," (",d.mode,")"]},d.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{de(null),q(null),X("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:E,onChange:d=>X(d.target.value),style:{fontSize:13,padding:"6px 8px",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6}}),ne&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:ne}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn secondary",onClick:oe,style:{padding:"6px 12px",fontSize:13},children:"Cancel"}),e.jsx("button",{className:"btn",onClick:re,style:{padding:"6px 12px",fontSize:13},children:"Save"})]})]})}):e.jsxs(e.Fragment,{children:[(()=>{if(i){const d=t.description??"";return d.trim()?e.jsx("div",{style:{marginBottom:t.beatmap_url?12:10,wordBreak:"break-word",fontSize:14,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Te,{text:d})}):null}else{const d=t.text??"";return d.trim()?e.jsx("div",{style:{marginBottom:t.beatmap_url?12:10,wordBreak:"break-word",fontSize:14,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Te,{text:d})}):null}})(),i&&t.beatmap_title&&e.jsxs("div",{style:{marginBottom:10,fontSize:12,color:"var(--muted)",lineHeight:1.4},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]}),!ie&&e.jsxs("div",{className:"row post-actions",style:{alignItems:"center",gap:8,marginTop:8,position:"relative",justifyContent:"flex-start",flexWrap:"nowrap"},children:[i&&t.beatmap_url&&!t.beatmap_title&&e.jsx("div",{className:"muted one-line",style:{fontSize:12,color:"#7b8491",flex:"0 1 auto",minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"Beatmap"}),!i&&t.beatmap_url&&(L||t.beatmapset_id||t.beatmap_id)&&e.jsx(Qs,{beatmapMeta:L,beatmapVersion:t.beatmap_version}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexShrink:0,marginLeft:"auto"},children:[i&&e.jsxs("span",{className:"views-badge","aria-label":"Views",title:"Views",onClick:d=>{d.preventDefault(),d.stopPropagation()},children:[e.jsx(Ot,{size:12}),e.jsx("span",{children:t.views_count??0})]}),e.jsxs("span",{className:"views-badge","aria-label":"Comments",title:"Comments",onClick:d=>{d.preventDefault(),d.stopPropagation()},children:[e.jsx(Qt,{size:12}),e.jsx("span",{children:t.comments_count??0})]}),i?e.jsxs("button",{className:`chip-btn like ${P?"liked":""}`,onClick:d=>{d.preventDefault(),d.stopPropagation(),He()},disabled:m,"aria-label":P?"Unlike":"Like",title:P?"Unlike":"Like",children:[P?e.jsx(Ye,{size:16}):e.jsx(nt,{size:16}),e.jsx("span",{children:z})]}):e.jsxs("button",{className:`chip-btn like ${pe?"liked":""}`,onClick:d=>{d.preventDefault(),d.stopPropagation(),A()},disabled:k,"aria-label":pe?"Remove reaction":"React",title:pe?"Remove reaction":"React",children:[$e?e.jsx("span",{style:{fontSize:16,lineHeight:1},children:"✋"}):pe?e.jsx(Ye,{size:16}):e.jsx(nt,{size:16}),e.jsx("span",{children:Y})]}),t.beatmap_url&&e.jsxs("button",{ref:D,className:"chip-btn link",onClick:d=>{d.preventDefault(),d.stopPropagation(),j(J=>!J)},title:"Beatmap options","aria-label":"Beatmap options",children:[e.jsx(Ve,{size:16}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(et,{size:14,style:{marginLeft:4,opacity:.7}})]})]})]})]})]})})]}),y&&H&&t.beatmap_url&&e.jsxs("div",{ref:F,style:{position:"fixed",top:H.top,right:H.right,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,padding:6,zIndex:1e3,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>j(!1),children:[e.jsx(Ve,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),he&&e.jsx("button",{className:"menu-item",onClick:()=>{w(!0),j(!1)},children:"Preview"})]}),U&&he&&e.jsx(Nt,{open:U,onClose:()=>w(!1),downloadUrl:`${Be}${I.osu.downloadBeatmapset(he)}`,beatmapId:Pe??void 0,beatmapVersion:Ge??void 0}),Ae&&e.jsx(kt,{open:g,onClose:()=>C(!1),buttonRef:n,minWidth:160,children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"menu-item",onClick:d=>{d.preventDefault(),d.stopPropagation(),M()},children:t.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:d=>{d.preventDefault(),d.stopPropagation(),ae()},children:"Delete video"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"menu-item",onClick:R,children:"Edit post"}),e.jsx("button",{className:"menu-item",onClick:ae,children:"Delete post"})]})})]})}function Et({comment:t,replies:l,me:a,onReply:u,onDelete:s,replyingTo:p,replyText:c,onReplyTextChange:b,onReplySubmit:i,posting:f,onCancelReply:x,section:m,repliesMap:N}){const[k,S]=o.useState(!1),y=o.useRef(null),{notify:j}=ve(),[g,C]=o.useState(!1),U=t.parent_id!==null,w=a&&(a.id===t.user_id||a.is_admin||a.is_mod),F=async()=>{if(confirm("Delete this comment?"))try{const D=m==="mappi"?I.videos.comments(t.post_id)+`/${t.id}`:I.moddi.postComments(t.post_id)+`/${t.id}`;await Q(D,{method:"DELETE"}),s(t.id),j("Comment deleted",{variant:"success"})}catch{j("Failed to delete comment",{variant:"error"})}finally{S(!1)}};return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-subtle)",background:"var(--hover-overlay)",transition:"background-color 0.15s ease"},onMouseEnter:D=>D.currentTarget.style.backgroundColor="var(--hover-overlay-strong)",onMouseLeave:D=>D.currentTarget.style.backgroundColor="var(--hover-overlay)",children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:13,fontWeight:500},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(t.created_at*1e3).toLocaleDateString()})]}),e.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:e.jsx(Te,{text:t.text})}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:e.jsxs("button",{onClick:()=>u(t.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[e.jsx(Kt,{size:14}),"Reply"]})}),p===t.id&&a&&e.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("form",{onSubmit:i,style:{display:"flex",alignItems:"flex-end",gap:6},children:[e.jsx("textarea",{placeholder:`Reply to ${t.username}...`,value:c||"",onChange:D=>b==null?void 0:b(D.target.value),rows:1,style:{flex:1,background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:D=>{const n=D.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,100)}px`},autoFocus:!0}),e.jsx("button",{type:"submit",className:"btn compact",disabled:f||!(c!=null&&c.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:f?"...":"Reply"}),x&&e.jsx("button",{type:"button",onClick:x,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid var(--border)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),w&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:y,className:"icon-link",onClick:()=>S(!k),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:e.jsx(pt,{size:16})}),e.jsx(kt,{open:k,onClose:()=>S(!1),buttonRef:y,children:e.jsx("button",{className:"menu-item",onClick:F,style:{color:"var(--danger)"},children:"Delete"})})]})]}),l.length>0&&e.jsxs("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid var(--border-subtle)"},children:[U&&e.jsxs("button",{onClick:()=>C(!g),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:11,padding:"4px 0",marginBottom:4},children:[g?e.jsx(et,{size:12}):e.jsx(Gt,{size:12}),g?"Hide":"Show"," ",l.length," ",l.length===1?"reply":"replies"]}),(!U||g)&&e.jsx(e.Fragment,{children:l.map(D=>e.jsx(Et,{comment:D,replies:(N==null?void 0:N.get(D.id))||[],me:a,onReply:u,onDelete:s,replyingTo:p,replyText:c,onReplyTextChange:b,onReplySubmit:i,posting:f,onCancelReply:x,section:m,repliesMap:N},D.id))})]})]})}const Gs=({streamUID:t,playbackUrl:l,aspectRatio:a,onClose:u,headerLeft:s,headerRight:p,children:c,beatmapDownloadUrl:b,beatmapVersion:i,beatmapId:f,onOpenInEditor:x})=>{const m=typeof a=="number"&&isFinite(a)&&a>0?a:1.7777777777777777,N=!!b;return T.useEffect(()=>(document.body.classList.add("overlay-open"),()=>{document.body.classList.remove("overlay-open")}),[]),e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:k=>k.stopPropagation(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:u}),e.jsxs("div",{className:"overlay-card",onClick:k=>k.stopPropagation(),children:[e.jsx("button",{className:"overlay-close",onClick:u,"aria-label":"Close",children:e.jsx(We,{size:18})}),e.jsx("div",{className:"section-panel",style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:N?0:"auto",maxHeight:N?"80vh":"calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 160px)",width:"100%",maxWidth:"100%",overflow:"hidden",boxSizing:"border-box",flexShrink:1,minWidth:0},onClick:k=>k.stopPropagation(),children:N?e.jsx("div",{style:{width:"100%",maxWidth:"100%",height:"auto",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box",minHeight:0},children:e.jsx(js,{downloadUrl:b,beatmapVersion:i,beatmapId:f,onOpenInEditor:x})}):e.jsx(_t,{streamUID:t||void 0,playbackUrl:l||void 0,aspectRatio:m,inOverlay:!0})}),(s||p||c)&&e.jsxs("div",{className:"section-panel",children:[(s||p)&&e.jsxs("div",{className:"row-between",children:[e.jsx("div",{className:"row",style:{alignItems:"center"},children:s}),p?e.jsx("div",{className:"row post-actions",style:{gap:8,position:"relative"},children:p}):e.jsx("div",{})]}),c]})]})]})};function Js(){var se,ie,v,O;const{uid:t}=ht(),[l,a]=Jt(),u=Fe(),p=((se=Ne().state)==null?void 0:se.returnTo)||"/feed",[c,b]=o.useState(null),[i,f]=o.useState(null),[x,m]=o.useState([]),[N,k]=o.useState(!0),[S,y]=o.useState(null),[j,g]=o.useState(""),[C,U]=o.useState(null),[w,F]=o.useState(!1),[D,n]=o.useState(!1),{notify:H}=ve(),W=o.useRef(new Set);o.useEffect(()=>{Q(I.auth.me,{requireAuth:!1}).then(h=>y(h)).catch(()=>{})},[]),o.useEffect(()=>{l.get("preview")==="true"&&n(!0)},[l]);const L=async()=>{if(!t||t==="null"||t==="undefined"){H("Invalid post identifier",{variant:"error"}),u("/feed");return}k(!0);try{const h=await Q(I.videos.get(t),{requireAuth:!1});if(h&&h.id){b(h),f("mappi"),k(!1);return}}catch{}try{const h=await Q(I.moddi.post(t),{requireAuth:!1});if(h&&h.id){const E={...h,user_id:h.user_id??0,username:h.username||"Unknown",avatar_url:h.avatar_url||null,uid:h.uid||String(h.id)||t,text:h.text??null,beatmap_url:h.beatmap_url??null,beatmapset_id:h.beatmapset_id??null,beatmap_id:h.beatmap_id??null,beatmap_version:h.beatmap_version??null,tags:h.tags??null,reactions_count:Number(h.reactions_count??0),reacted_by_me:h.reacted_by_me??!1,comments_count:Number(h.comments_count??0)};b(E),f("moddi"),k(!1);return}}catch{}H("Failed to load post",{variant:"error"}),u(p),k(!1)},$=async()=>{if(!(!(c!=null&&c.id)||!i))try{const h=i==="mappi"?I.videos.comments(c.id):I.moddi.postComments(c.id),E=await Q(h,{requireAuth:!1});m(E.items||[])}catch{}};o.useEffect(()=>{L()},[t]),o.useEffect(()=>{c!=null&&c.id&&i&&$()},[c==null?void 0:c.id,i]),o.useEffect(()=>{!(c!=null&&c.id)||i!=="mappi"||W.current.has(c.id)||(W.current.add(c.id),Q(I.videos.view(c.id),{method:"POST"}).then(h=>{if(!h)return;const E=Number(h.views_count??0);b(X=>X?{...X,views_count:E,viewed_by_me:!0}:null)}).catch(()=>{}))},[c==null?void 0:c.id,i]);const K=h=>{b(h)},P=()=>{u(p)},B=async h=>{if(h.preventDefault(),!(!j.trim()||!(c!=null&&c.id)||!i)){F(!0);try{const E=i==="mappi"?I.videos.comments(c.id):I.moddi.postComments(c.id);await Q(E,{method:"POST",body:JSON.stringify({text:j.trim(),parent_id:C||void 0})}),g(""),U(null),$(),L(),H("Comment posted!",{variant:"success"})}catch(E){H((E==null?void 0:E.message)||"Failed to post comment",{variant:"error"})}finally{F(!1)}}},z=h=>{m(E=>E.filter(X=>X.id!==h))};if(N)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!c||!i)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const G=x.filter(h=>!h.parent_id),V=new Map;x.filter(h=>h.parent_id).forEach(h=>{const E=h.parent_id;V.has(E)||V.set(E,[]),V.get(E).push(h)});const _=i==="mappi",Y=_?c:null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"post-detail-header",style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>u(p),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(Ke,{size:20})}),e.jsx("span",{className:"hide-on-mobile",style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx(Qe,{post:c,section:i,onUpdate:K,onDelete:P,me:S})}),S&&!C&&e.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:6},children:e.jsxs("form",{onSubmit:B,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:j,onChange:h=>g(h.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:h=>{const E=h.target;E.style.height="auto",E.style.height=`${Math.min(E.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:w||!j.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:w?"...":"Post"})]})}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:G.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:G.map(h=>e.jsx(Et,{comment:h,replies:V.get(h.id)||[],me:S,section:i,onReply:E=>U(E),onDelete:z,replyingTo:C,replyText:j,onReplyTextChange:g,onReplySubmit:B,posting:w,onCancelReply:()=>{U(null),g("")},repliesMap:V},h.id))})})]}),_&&Y&&D&&Y.beatmapset_id&&e.jsx(Gs,{streamUID:null,playbackUrl:null,aspectRatio:16/9,onClose:()=>{n(!1),a({})},beatmapDownloadUrl:`${Be}${I.osu.downloadBeatmapset(Y.beatmapset_id)}`,beatmapId:Y.beatmap_id??void 0,beatmapVersion:Y.beatmap_version??void 0,onOpenInEditor:()=>{n(!1),a({}),window.location.hash="/editor"},headerLeft:e.jsxs(e.Fragment,{children:[((ie=Y.uploader)==null?void 0:ie.avatar_url)&&e.jsx("img",{src:Y.uploader.avatar_url,width:28,height:28,style:{borderRadius:"50%"}}),e.jsxs(ce,{to:`/profile/${(v=Y.uploader)==null?void 0:v.id}`,style:{marginLeft:6,display:"inline-flex",alignItems:"center",gap:6,textDecoration:"none",color:"inherit",fontWeight:700},children:[e.jsx("span",{children:(O=Y.uploader)==null?void 0:O.username}),Y.is_starred?e.jsx(Ze,{size:14,color:"#f59e0b",title:"Starred"}):null]})]})})]})}function lt(){const t=ht(),{notify:l}=ve(),[a,u]=o.useState(null),[s,p]=o.useState(null),[c,b]=o.useState(""),[i,f]=o.useState("uploads"),[x,m]=o.useState([]),[N,k]=o.useState([]),[S,y]=o.useState(""),[j,g]=o.useState([]),[C,U]=o.useState(null),[w,F]=o.useState(""),[D,n]=o.useState([]),[H,W]=o.useState(null),[L,$]=o.useState(!1),[K,P]=o.useState(null),[B,z]=o.useState(!1),[G,V]=o.useState(0),_=T.useRef(null),Y=o.useMemo(()=>{const v=t.id?Number(t.id):null;return v?a?a.id===v:!1:!0},[t.id,a]);o.useEffect(()=>{(async()=>{try{const v=await Q(I.auth.me,{requireAuth:!1});u(v),v&&Array.isArray(v.inspirations)&&g(v.inspirations)}catch(v){b((v==null?void 0:v.message)||"Not logged in")}})()},[]),o.useEffect(()=>{(async()=>{try{const v=t.id?Number(t.id):null;if(v){try{const E=await Q(I.users.get(v),{requireAuth:!1});p(E),y(E.about||""),Array.isArray(E.inspirations)&&g(E.inspirations)}catch(E){b((E==null?void 0:E.message)||"User not found")}const O=await Q(I.users.videos(v)+Me({limit:"60"}),{requireAuth:!1});m(O.items||[]);const h=await Q(I.users.likes(v)+Me({limit:"60"}),{requireAuth:!1});k(h.items||[])}else{if(!a)return;p(a),y(a.about||""),Array.isArray(a.inspirations)&&g(a.inspirations);const O=await Q(I.users.myVideos+Me({limit:"60"}),{requireAuth:!1});m(O.items||[]);const h=await Q(I.users.likes(a.id)+Me({limit:"60"}),{requireAuth:!1});k(h.items||[])}}catch(v){console.error("Profile load error:",v)}})()},[t.id,a]),o.useEffect(()=>{$(!1)},[s==null?void 0:s.id]);async function se(v){try{const h=(await Q(I.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:v})})).user||s;p(h),Array.isArray(h==null?void 0:h.inspirations)&&g(h.inspirations),t.id||u(h)}catch{}}o.useEffect(()=>{let v;return C!==null&&w.trim().length>=2?v=setTimeout(async()=>{try{const O=await Q(I.osu.usersSearch(w),{requireAuth:!1});n(Array.isArray(O.items)?O.items:[])}catch{}},250):n([]),()=>{v&&clearTimeout(v)}},[w,C]);const ie=async v=>{var h;const O=(h=v.target.files)==null?void 0:h[0];if(O){if(O.size>100*1024*1024){l("File too large (max 100MB)",{variant:"error"});return}z(!0),V(0);try{const E=await Q(I.user.bannerImageUpload,{method:"POST"}),X=E.uploadURL,ee=E.imageID,de=new XMLHttpRequest;de.open("POST",X,!0),de.upload.onprogress=ne=>{ne.lengthComputable&&V(ne.loaded/ne.total*100)},await new Promise((ne,Z)=>{de.onload=()=>{de.status>=200&&de.status<300?ne():Z(new Error("Upload failed"))},de.onerror=()=>Z(new Error("Network error"));const fe=new FormData;fe.append("file",O),de.send(fe)});const r=await Q(I.user.bannerImageConfirm,{method:"POST",body:JSON.stringify({imageID:ee})}),q=s?{...s,banner_stream_uid:r.banner_stream_uid}:null;u(ne=>({...ne,banner_stream_uid:r.banner_stream_uid})),s&&Y&&p(ne=>({...ne,banner_stream_uid:r.banner_stream_uid})),l("Banner updated!",{variant:"success"})}catch(E){console.error(E),l(E.message||"Banner upload failed",{variant:"error"})}finally{z(!1),V(0),_.current&&(_.current.value="")}}};return e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",minHeight:"100vh",display:"flex",flexDirection:"column",paddingTop:0},children:[e.jsxs("div",{className:"profile-twitter-header",style:{background:"var(--panel)",borderBottom:"1px solid var(--divider)",position:"relative"},children:[e.jsxs("div",{style:{height:120,background:"var(--panel)",width:"100%",position:"relative",overflow:"hidden"},children:[s!=null&&s.banner_stream_uid?s.banner_stream_uid.startsWith("img:")?e.jsx("img",{src:s.banner_stream_uid.slice(4),alt:"Banner",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("video",{src:`https://videodelivery.net/${s.banner_stream_uid}/manifest/video.m3u8`,poster:`https://videodelivery.net/${s.banner_stream_uid}/thumbnails/thumbnail.jpg?time=1s`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(to right, #667eea, #764ba2)"}}),Y&&e.jsxs(e.Fragment,{children:[B&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:20,backdropFilter:"blur(4px)"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#fff",marginBottom:8},children:["Uploading... ",Math.round(G),"%"]}),e.jsx("div",{style:{width:"60%",height:4,background:"rgba(255,255,255,0.2)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${G}%`,height:"100%",background:"#fff",transition:"width 0.1s ease"}})})]}),e.jsx("input",{ref:_,type:"file",accept:"image/*",style:{display:"none"},onChange:ie}),e.jsx("button",{className:"btn secondary",onClick:()=>{var v;return(v=_.current)==null?void 0:v.click()},disabled:B,style:{position:"absolute",top:12,right:12,padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff",zIndex:10},title:s!=null&&s.banner_stream_uid?"Change Banner":"Add Banner",children:s!=null&&s.banner_stream_uid?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{size:14,style:{marginRight:6}}),"Edit"]}):e.jsxs(e.Fragment,{children:[e.jsx(Vt,{size:14,style:{marginRight:6}}),"Add Banner"]})})]})]}),e.jsxs("div",{style:{padding:"0 16px 16px",position:"relative"},children:[e.jsxs("div",{style:{marginTop:-40,marginBottom:12,display:"flex",alignItems:"flex-end",justifyContent:"space-between"},children:[e.jsx("div",{style:{width:80,height:80,borderRadius:"50%",border:"4px solid var(--panel)",background:"var(--bg)",overflow:"hidden",flexShrink:0},children:(s==null?void 0:s.avatar_url)&&e.jsx("img",{src:s.avatar_url,width:"100%",height:"100%",style:{objectFit:"cover"},alt:"Avatar"})}),e.jsxs("div",{className:"col",style:{alignItems:"flex-start",gap:6,paddingTop:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[j.map((v,O)=>Y?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(v.id),onMouseLeave:()=>W(null),children:[e.jsx("button",{className:"insp-avatar",style:{width:28,height:28},onClick:()=>{if(!confirm("Remove this inspiration?"))return;const h=j.filter((E,X)=>X!==O);g(h),se(h)},children:e.jsx("img",{src:v.avatar_url,alt:v.username})}),H===v.id&&e.jsx("div",{className:"insp-tooltip",children:v.username})]},v.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(v.id),onMouseLeave:()=>W(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${v.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",style:{width:28,height:28},children:e.jsx("img",{src:v.avatar_url,alt:v.username})}),H===v.id&&e.jsx("div",{className:"insp-tooltip",children:v.username})]},v.id)),Y&&j.length<3&&e.jsx("button",{className:"insp-add",style:{width:28,height:28,fontSize:16},onClick:()=>{U(0),F(""),n([])},children:"+"})]}),e.jsx("div",{className:"muted",style:{fontSize:11,fontWeight:400},children:Y?"Who inspires you?":"Inspired by"}),C!==null&&e.jsxs("div",{className:"insp-pop",style:{top:32,right:0},children:[e.jsx("input",{autoFocus:!0,placeholder:"Search osu! users",value:w,onChange:v=>F(v.target.value)}),e.jsx("div",{className:"insp-results",children:D.map(v=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(a&&Number(a.osu_user_id)===Number(v.id)){l("Kinda based, but no.",{variant:"warn"}),U(null);return}if(j.some(h=>h.id===v.id)){U(null);return}const O=[...j,{id:v.id,username:v.username,avatar_url:v.avatar_url}].slice(0,3);g(O),U(null),se(O)},children:[e.jsx("img",{src:v.avatar_url,alt:"avatar"}),e.jsx("span",{children:v.username})]},v.id))}),e.jsx("button",{className:"insp-close",onClick:()=>U(null),children:"Close"})]})]})]}),s?e.jsxs("div",{className:"col",style:{gap:2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("h1",{style:{fontSize:20,fontWeight:700,margin:0},children:s.username}),s.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${s.osu_user_id}`,target:"_blank",rel:"noreferrer",className:"muted",style:{display:"flex"},title:"View osu! profile",children:e.jsx(Ve,{size:14})})]}),e.jsxs("div",{className:"muted",style:{fontSize:14},children:["ID: ",s.id]}),e.jsx("div",{style:{marginTop:8},children:Y?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:S,onChange:v=>y(v.target.value),rows:2,maxLength:1e3,placeholder:"Write something about yourself",style:{padding:"8px 32px 8px 8px",fontSize:14,background:"rgba(255,255,255,0.03)",borderRadius:8,border:"1px solid var(--divider)",width:"100%",resize:"none",minHeight:60}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const v=await Q(I.auth.me,{method:"PATCH",body:JSON.stringify({about:S})});p(v.user||s),u(v.user||a),l("Bio updated!",{variant:"success"})}catch{}},style:{position:"absolute",right:8,bottom:8,padding:4,color:"var(--accent)"},children:e.jsx(Oe,{size:18})})]}):e.jsx("div",{style:{fontSize:15,lineHeight:1.4,whiteSpace:"pre-wrap"},children:s.about||e.jsx("span",{className:"muted italic",children:"No bio."})})})]}):e.jsx("div",{className:"muted",children:c||"Loading…"})]}),e.jsx(us,{tabs:[{id:"uploads",label:"Uploads"},{id:"likes",label:"Likes"}],activeTab:i,onChange:f})]}),e.jsxs("div",{className:"profile-tabs-content",style:{background:"var(--panel)",flex:1,display:"flex",flexDirection:"column"},children:[i==="uploads"&&e.jsx("div",{className:"profile-feed",style:{flex:1},children:x.length===0?e.jsx("div",{className:"muted",style:{padding:40,textAlign:"center"},children:"No uploads yet."}):x.map(v=>e.jsx(Qe,{post:v,section:v.post_type||"mappi",me:a,onUpdate:O=>m(h=>h.map(E=>E.id===O.id&&E.post_type===O.post_type?O:E)),onDelete:O=>m(h=>h.filter(E=>E.id!==O))},`${v.post_type||"mappi"}-${v.id}`))}),i==="likes"&&e.jsx("div",{className:"profile-feed",style:{flex:1},children:N.length===0?e.jsx("div",{className:"muted",style:{padding:40,textAlign:"center"},children:"No likes yet."}):N.map(v=>e.jsx(Qe,{post:v,section:v.post_type||"mappi",me:a,onUpdate:O=>k(h=>h.map(E=>E.id===O.id&&E.post_type===O.post_type?O:E)),onDelete:O=>k(h=>h.filter(E=>E.id!==O))},`${v.post_type||"mappi"}-${v.id}`))}),e.jsx("div",{style:{flex:1,minHeight:16}})]}),e.jsx("style",{children:`
        .profile-twitter-header .insp-avatar {
          padding: 0;
          border: 2px solid var(--panel);
          border-radius: 50%;
          overflow: hidden;
          background: var(--bg);
          cursor: pointer;
          transition: transform 0.2s;
        }
        .profile-twitter-header .insp-avatar:hover {
          transform: scale(1.1);
          z-index: 2;
        }
        .profile-twitter-header .insp-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
        .profile-twitter-header .insp-add {
          border: 2px dashed rgba(255,255,255,0.2);
          border-radius: 50%;
          background: transparent;
          color: rgba(255,255,255,0.5);
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .profile-twitter-header .insp-add:hover {
          border-color: var(--accent);
          color: var(--accent);
        }
        .insp-tooltip {
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background: rgba(0,0,0,0.8);
          color: white;
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 11px;
          white-space: nowrap;
          margin-bottom: 8px;
          pointer-events: none;
          z-index: 10;
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid var(--divider); border-radius: 10px; padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel-dark); color: var(--text); outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: var(--text); cursor: pointer; text-align: left; }
        .insp-result:hover { background: var(--hover-overlay); border-color: var(--divider); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--divider); background: var(--hover-overlay); color: var(--text); cursor: pointer; }
      `})]})}function Ys(){var Y,se,ie,v,O,h,E,X,ee,de;const[t,l]=o.useState(null),[a,u]=o.useState([]),[s,p]=o.useState(""),[c,b]=o.useState([]),[i,f]=o.useState(null),[x,m]=o.useState([]),[N,k]=o.useState("all"),[S,y]=o.useState("approvals"),[j,g]=o.useState(null),[C,U]=o.useState(""),[w,F]=o.useState(!1),{notify:D}=ve(),[n,H]=o.useState(null),[W,L]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const r=await Q(I.auth.me,{requireAuth:!1});if(l(r),r!=null&&r.is_admin)try{const q=await Q(I.admin.settingsModeration,{requireAuth:!1});g(!!q.require_approval)}catch{}}catch{}try{const r=await Q(I.admin.videosPending+Me({limit:"50"}),{requireAuth:!1});u(r.items||[])}catch{}})()},[]);async function $(){L(!0);try{const r=await Q(I.admin.analytics,{requireAuth:!1});H(r)}finally{L(!1)}}async function K(){try{const r=await Q(I.admin.usersSearch(s),{requireAuth:!1});b(r.items||[])}catch{}}async function P(r){f(r),m([]);try{const q=await Q(I.admin.userVideos(r.id)+Me({limit:"50"}),{requireAuth:!1});m(q.items||[])}catch{}}async function B(r,q){try{const ne=await Q(I.admin.userUpdate(r.id),{method:"PATCH",body:JSON.stringify({is_mod:q})}),Z=(ne==null?void 0:ne.user)||{...r,is_mod:q};D(q?"Granted moderation":"Revoked moderation",{variant:q?"success":"warn"}),f(Z),b(c.map(fe=>fe.id===r.id?Z:fe))}catch{alert("Failed to update")}}const z=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),G=!!(t!=null&&t.is_admin);if(!z)return e.jsx("div",{className:"muted",style:{padding:20},children:"You do not have access."});const V=a.filter(r=>!r.flagged_only),_=a.filter(r=>!!r.flagged_only);return e.jsxs("div",{className:"moderation-container",children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:we()?"nowrap":"wrap",gap:we()?"2px":"4px",overflowX:we()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":S==="approvals",className:`profile-tab ${S==="approvals"?"active":""}`,"data-tab":"approvals",onClick:r=>{const q=r.currentTarget.closest(".profile-tabs-unified");q.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),q.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),y("approvals")},children:"Approvals"}),(G||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":S==="manage",className:`profile-tab ${S==="manage"?"active":""}`,"data-tab":"manage",onClick:r=>{const q=r.currentTarget.closest(".profile-tabs-unified");q.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),q.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),y("manage")},children:"Manage"}),(G||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":S==="analytics",className:`profile-tab ${S==="analytics"?"active":""}`,"data-tab":"analytics",onClick:r=>{const q=r.currentTarget.closest(".profile-tabs-unified");q.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),q.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),y("analytics"),n||$()},children:"Analytics"}),(G||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":S==="message",className:`profile-tab ${S==="message"?"active":""}`,"data-tab":"message",onClick:r=>{const q=r.currentTarget.closest(".profile-tabs-unified");q.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),r.currentTarget.classList.add("active"),r.currentTarget.setAttribute("aria-selected","true"),q.querySelector(".profile-tabs-content").setAttribute("data-active","message"),y("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":S,children:[e.jsx("div",{className:"panel approvals",hidden:S!=="approvals",children:e.jsxs("div",{className:"moderation-grid",style:{paddingTop:16},children:[e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Pending approvals"}),e.jsx("div",{className:"moderation-column-count",children:V.length})]}),V.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),V.map(r=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[r.poster_url?e.jsx("img",{src:r.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:r.description||"",children:e.jsx(Te,{text:r.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:r.username}),r.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof r.flags_count=="number"&&r.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",r.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await Q(I.admin.videosReject(r.id),{method:"POST"}),u(a.filter(q=>q.id!==r.id)),D("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await Q(I.admin.videosApprove(r.id),{method:"POST"}),u(a.filter(q=>q.id!==r.id)),D("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await Q(I.videos.delete(r.id),{method:"DELETE"}),u(a.filter(q=>q.id!==r.id)),D("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},r.id))]}),e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Flagged (FYI)"}),e.jsx("div",{className:"moderation-column-count",children:_.length})]}),_.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),_.map(r=>e.jsxs("div",{className:"moderation-video-card flagged",children:[e.jsxs("div",{className:"mod-card-content",children:[r.poster_url?e.jsx("img",{src:r.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:r.description||"",children:e.jsx(Te,{text:r.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:r.username}),e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof r.flags_count=="number"&&r.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",r.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"mod-card-actions",children:e.jsx("button",{className:"btn secondary compact",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await Q(I.videos.delete(r.id),{method:"DELETE"}),u(a.filter(q=>q.id!==r.id)),D("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},r.id)),_.length>0&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:S!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:s,onChange:r=>p(r.target.value),onKeyDown:r=>{r.key==="Enter"&&K()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:K,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:c.map(r=>e.jsxs("button",{className:`moderation-user-result ${(i==null?void 0:i.id)===r.id?"selected":""}`,onClick:()=>P(r),children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:r.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",r.id," • osu ",r.osu_user_id]})]}),r.is_admin?e.jsx("span",{className:"chip info",children:"admin"}):r.is_mod?e.jsx("span",{className:"chip success",children:"mod"}):r.is_blacklisted?e.jsx("span",{className:"chip error",children:"blacklisted"}):null]},r.id))})})]}),i?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:24},children:[e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:64,height:64,style:{borderRadius:"50%",flexShrink:0,border:"2px solid var(--border)"}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"title",style:{fontSize:"24px"},children:i.username}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["id ",i.id," • osu ",i.osu_user_id]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[G&&!i.is_admin&&(i.is_mod?e.jsx("button",{className:"btn secondary compact",onClick:()=>B(i,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary compact",onClick:()=>B(i,!0),children:"Grant moderation"})),!i.is_admin&&(i.is_blacklisted?e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await Q(I.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),f({...i,is_blacklisted:!1}),D("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await Q(I.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),f({...i,is_blacklisted:!0}),D("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]})]})]}),e.jsxs("div",{className:"col",style:{gap:16},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:`btn compact ${N==="all"?"primary":"secondary"}`,onClick:()=>k("all"),children:"All"}),e.jsx("button",{className:`btn compact ${N==="review"?"primary":"secondary"}`,onClick:()=>k("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[x.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),e.jsx("div",{className:"col",style:{gap:12},children:x.filter(r=>{if(N==="all")return!0;const q=(j?!r.approved_at:!1)&&r.status==="ready",ne=!!r.needs_review;return q||ne}).map(r=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[r.poster_url?e.jsx("img",{src:r.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:r.description||"",children:r.description||"No description."}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:r.status.toUpperCase()}),e.jsxs("span",{className:"muted",children:["• ",new Date(r.created_at*1e3).toLocaleDateString()]}),r.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,j&&!r.approved_at&&r.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]}),e.jsxs("div",{className:"row",style:{gap:4,marginTop:4},children:[e.jsx("span",{style:{color:"var(--accent)",fontSize:14},children:"★"}),e.jsx("span",{className:"muted",style:{fontSize:13},children:r.likes_count??0})]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[(G||(t==null?void 0:t.is_mod))&&(!!r.needs_review||j&&!r.approved_at&&r.status==="ready")&&e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await Q(I.admin.videosApprove(r.id),{method:"POST"}),m(x.map(q=>q.id===r.id?{...q,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:q)),D("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(G||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await Q(I.videos.delete(r.id),{method:"DELETE"}),m(x.filter(q=>q.id!==r.id)),D("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},r.id))})]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center",border:"1px dashed var(--border)",borderRadius:"12px"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:S!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:s,onChange:r=>p(r.target.value),onKeyDown:r=>{r.key==="Enter"&&K()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:K,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:c.map(r=>e.jsxs("button",{className:`moderation-user-result ${(i==null?void 0:i.id)===r.id?"selected":""}`,onClick:()=>f(r),children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:r.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",r.id," • osu ",r.osu_user_id]})]}),(i==null?void 0:i.id)===r.id&&e.jsx("span",{className:"chip info",children:"selected"})]},r.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:r=>F(r.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",fontFamily:"inherit"},value:C,onChange:r=>U(r.target.value)}),e.jsx("button",{className:"btn primary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const r=(C||"").trim();if(!r){alert("Enter a message");return}(async()=>{try{const q={text:r,global:w};!w&&(i!=null&&i.id)&&(q.user_id=i.id),await Q(I.admin.notificationsSystem,{method:"POST",body:JSON.stringify(q)}),U(""),D("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:S!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Analytics"}),W&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!W&&!n&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(je,{label:"Users",value:n.totals.users_total}),e.jsx(je,{label:"Admins",value:n.totals.users_admin}),e.jsx(je,{label:"Mods",value:n.totals.users_mod}),e.jsx(je,{label:"Blacklisted",value:n.totals.users_blacklisted}),e.jsx(je,{label:"Videos",value:n.totals.videos_total}),e.jsx(je,{label:"Ready",value:n.totals.videos_ready}),e.jsx(je,{label:"Pending",value:n.totals.pending_count}),e.jsx(je,{label:"Purgatory",value:n.totals.purgatory_count}),e.jsx(je,{label:"Likes",value:n.totals.likes_total}),e.jsx(je,{label:"Flags",value:n.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Je,{title:"New users (30d)",series:n.series.users,color:"#60a5fa"}),e.jsx(Je,{title:"New videos (30d)",series:n.series.videos,color:"#34d399"}),(se=(Y=n.stream)==null?void 0:Y.graphql)!=null&&se.minutes_viewed?e.jsx(Je,{title:"Minutes viewed (30d)",series:n.stream.graphql.minutes_viewed,color:"#f59e0b"}):e.jsxs("div",{className:"moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:we()?13:14},children:"Minutes viewed (30d)"}),e.jsx("div",{className:"muted",style:{fontSize:we()?11:12},children:"Data unavailable"})]}),e.jsxs("div",{className:"col",style:{padding:"24px",gap:12},children:[e.jsx("div",{className:"muted",style:{textAlign:"center",fontSize:14},children:"Minutes viewed data is not currently available."}),((v=(ie=n.stream)==null?void 0:ie.graphql)==null?void 0:v.errors)&&Array.isArray(n.stream.graphql.errors)&&n.stream.graphql.errors.length>0&&e.jsxs("div",{className:"col",style:{gap:8,padding:"12px",background:"var(--panel-dark)",borderRadius:8,border:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:600,color:"var(--danger)"},children:"Error details:"}),n.stream.graphql.errors.map((r,q)=>e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.5,fontFamily:"monospace"},children:typeof r=="string"?r:(r==null?void 0:r.message)||JSON.stringify(r)},q)),((h=(O=n.stream)==null?void 0:O.graphql)==null?void 0:h.raw)&&e.jsxs("div",{className:"col",style:{gap:4,marginTop:8,paddingTop:8,borderTop:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:11,fontWeight:600},children:"Debug info:"}),n.stream.graphql.raw.account_keys&&n.stream.graphql.raw.account_keys.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:10,fontFamily:"monospace"},children:["Available account fields: ",n.stream.graphql.raw.account_keys.join(", ")]}),n.stream.graphql.raw.response_sample&&e.jsxs("details",{style:{fontSize:10},children:[e.jsx("summary",{className:"muted",style:{cursor:"pointer",marginTop:4},children:"Response sample"}),e.jsx("pre",{style:{fontSize:9,overflow:"auto",maxHeight:"200px",marginTop:4,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:4},children:n.stream.graphql.raw.response_sample})]})]})]}),!((E=n.stream)!=null&&E.graphql)&&e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",padding:"8px",background:"var(--panel-dark)",borderRadius:8},children:"GraphQL API not configured. Set CF_GRAPHQL_API_TOKEN secret."})]})]})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",n.feed.count," items in rotation",n.feed.cursor?` • cursor ${n.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",n.stream.approximate.total_duration_sec," • ready videos: ",n.stream.approximate.videos_ready]}),n.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",n.stream.api.ok?"ok":"unavailable",(ee=(X=n.stream.api)==null?void 0:X.result_info)!=null&&ee.count?` • count ${n.stream.api.result_info.count}`:"",(de=n.stream.api)!=null&&de.sample_status?` • sample status ${String(n.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})}function je({label:t,value:l}){return e.jsxs("div",{className:"moderation-stat-card",children:[e.jsx("div",{className:"mod-stat-label",children:t}),e.jsx("div",{className:"mod-stat-value",children:l})]})}function Je({title:t,series:l,color:a}){const[u,s]=o.useState(()=>we()),p=T.useRef(null),[c,b]=o.useState(400);o.useEffect(()=>{const L=()=>{if(s(we()),p.current){const K=p.current.offsetWidth-48;b(Math.max(300,K))}};L();let $=null;return p.current&&typeof ResizeObserver<"u"&&($=new ResizeObserver(L),$.observe(p.current)),window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L),$&&p.current&&$.unobserve(p.current)}},[]);const i=u?Math.min(400,Math.max(300,window.innerWidth-48)):Math.max(400,Math.min(1e3,c)),f=160,x=8,m=8,N=28,k=u?36:42,S=l.map(L=>L.count),y=Math.max(1,...S),j=o.useMemo(()=>{const L=y,$=Math.pow(10,Math.floor(Math.log10(L))),K=L/$;return(K<=1?1:K<=2?2:K<=5?5:10)*$},[y]),g=i-k-m,C=f-x-N,U=o.useMemo(()=>l.map((L,$)=>{const K=k+$/Math.max(1,l.length-1)*g,P=x+(1-L.count/(j||1))*C;return[K,P]}),[l,j,g,C]),w=o.useMemo(()=>U.map((L,$)=>$===0?`M ${L[0]} ${L[1]}`:`L ${L[0]} ${L[1]}`).join(" "),[U]),F=[0,.25,.5,.75,1],D=o.useMemo(()=>{if(l.length===0)return[];const L=[0,.25,.5,.75,1].map($=>Math.min(l.length-1,Math.round($*(l.length-1))));return Array.from(new Set(L))},[l]),n=L=>{if(!L||L.length<10)return L||"";const $=L.slice(5,7).replace(/^0/,""),K=L.slice(8,10).replace(/^0/,"");return`${$}/${K}`};function H(L){const $=Number.isInteger(L);return L>=1e6?`${(L/1e6).toFixed(1).replace(/\.0$/,"")}M`:L>=1e3?`${(L/1e3).toFixed(1).replace(/\.0$/,"")}k`:$?String(L):L<10?L.toFixed(1):L.toFixed(1).replace(/\.0$/,"")}const W=l.length?l[l.length-1].count:0;return e.jsxs("div",{className:"moderation-chart-card",ref:p,children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:u?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:u?11:12},children:["latest: ",H(W)]})]}),e.jsx("div",{style:{width:"100%"},children:e.jsxs("svg",{width:i,height:f,role:"img","aria-label":t,style:{display:"block",width:`${i}px`,height:`${f}px`,maxWidth:"100%"},children:[e.jsx("rect",{x:0,y:0,width:i,height:f,rx:12,style:{fill:"var(--panel-dark)"}}),F.map((L,$)=>{const K=x+(1-L)*C,P=L*j;return e.jsxs("g",{children:[e.jsx("line",{x1:k,y1:K,x2:i-m,y2:K,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:k-6,y:K+4,textAnchor:"end",fontSize:10,style:{fill:"var(--muted)"},children:H(P)})]},$)}),e.jsx("line",{x1:k,y1:x,x2:k,y2:x+C,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),e.jsx("line",{x1:k,y1:x+C,x2:k+g,y2:x+C,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),D.map((L,$)=>{var P;const K=k+L/Math.max(1,l.length-1)*g;return e.jsxs("g",{children:[e.jsx("line",{x1:K,y1:x,x2:K,y2:x+C,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:K,y:x+C+12,textAnchor:"middle",fontSize:10,style:{fill:"var(--muted)"},children:n((P=l[L])==null?void 0:P.day)})]},$)}),e.jsx("path",{d:w,fill:"none",stroke:a,strokeWidth:2}),U.length>0&&e.jsx("circle",{cx:U[U.length-1][0],cy:U[U.length-1][1],r:3,fill:a})]})})]})}function Vs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Xs(t){const l="=".repeat((4-t.length%4)%4),a=(t+l).replace(/-/g,"+").replace(/_/g,"/"),u=atob(a),s=new Uint8Array(u.length);for(let p=0;p<u.length;p++)s[p]=u.charCodeAt(p);return s}async function Ue(){return!("serviceWorker"in navigator)||!("PushManager"in window)?null:(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function Zs(){try{const t=await fetch(`${Be}/api/push/public_key`,{credentials:"include"});if(!t.ok)return null;const l=await t.json().catch(()=>null);return l&&typeof l.publicKey=="string"?l.publicKey:null}catch{return null}}async function ea(t){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)||await Notification.requestPermission()!=="granted")return!1;const a=await navigator.serviceWorker.ready;let u=await a.pushManager.getSubscription();u||(u=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Xs(t)}));try{await Q(I.user.pushSubscribe,{method:"POST",body:JSON.stringify({...u.toJSON(),ua:navigator.userAgent})})}catch{}return!0}async function ta(){const t=await Ue();if(!t)return!0;try{await Q(I.user.pushUnsubscribe,{method:"POST",body:JSON.stringify({endpoint:t.endpoint})})}catch{}try{await t.unsubscribe()}catch{}return!0}function sa(){const{theme:t,setTheme:l}=Se(),{data:a}=ke(),{notify:u}=ve(),[s,p]=T.useState("general"),[c,b]=T.useState(!1),[i,f]=T.useState(!1),[x,m]=T.useState(!1),[N,k]=T.useState(typeof Notification<"u"?Notification.permission:"default"),S=y=>{l(y),St(y)};return T.useEffect(()=>{b(typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),f(Xe()),Ue().then(y=>m(!!y)).catch(()=>m(!1)),typeof Notification<"u"&&k(Notification.permission)},[]),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("div",{className:"settings-title",children:"Settings"}),e.jsx("div",{className:"settings-description",children:"Personalize appearance and app behavior."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Settings",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Settings tabs",children:[e.jsx("button",{role:"tab","aria-selected":s==="general",className:`profile-tab ${s==="general"?"active":""}`,"data-tab":"general",onClick:y=>{const j=y.currentTarget.closest(".profile-tabs-unified"),g=j==null?void 0:j.querySelector(".profile-tabs-content");g==null||g.setAttribute("data-active","general"),p("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":s==="notifications",className:`profile-tab ${s==="notifications"?"active":""}`,"data-tab":"notifications",onClick:y=>{const j=y.currentTarget.closest(".profile-tabs-unified"),g=j==null?void 0:j.querySelector(".profile-tabs-content");g==null||g.setAttribute("data-active","notifications"),p("notifications")},children:"Notifications"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":s,children:[e.jsx("div",{className:"panel general",hidden:s!=="general",children:e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Appearance"}),e.jsx("span",{className:"settings-section-desc",children:"Customize how the app looks on this device."})]}),e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Theme"}),e.jsx("span",{className:"settings-sublabel",children:"Select your preferred color scheme"})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("div",{className:"theme-toggle-group",role:"group","aria-label":"Theme selection",children:[e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="dark"?"active":""}`,"aria-pressed":t==="dark",onClick:()=>S("dark"),children:"Dark"}),e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="light"?"active":""}`,"aria-pressed":t==="light",onClick:()=>S("light"),children:"Light"})]})})]})]})}),e.jsx("div",{className:"panel notifications",hidden:s!=="notifications",children:e.jsxs("div",{className:"col",style:{gap:24},children:[e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Push Notifications"}),e.jsx("span",{className:"settings-section-desc",children:"Manage push alerts for this device."})]}),!c&&e.jsx("div",{className:"settings-hint",children:"Push notifications are not supported on this device."}),c&&e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Push Alerts"}),e.jsx("span",{className:"settings-sublabel",children:N==="granted"&&x?"Enabled on this device":"Disabled on this device"}),!i&&e.jsx("div",{className:"settings-hint",style:{marginTop:4},children:"On iOS, install the app to your Home Screen to enable push."})]}),e.jsx("div",{className:"settings-action",children:N!=="granted"||!x?e.jsx("button",{className:"btn primary compact",onClick:async()=>{const y=await Zs();if(!y)return;await ea(y),k(typeof Notification<"u"?Notification.permission:"default");const j=await Ue();m(!!j)},title:i?void 0:"On iOS, install as PWA to enable",children:"Enable"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{await ta();const y=await Ue();m(!!y),k(typeof Notification<"u"?Notification.permission:"default")},children:"Disable"})})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Preferences"}),e.jsx("span",{className:"settings-section-desc",children:"Choose which activities trigger notifications."})]}),e.jsx(aa,{})]})]})})]})]})]})}function aa(){const{notify:t}=ve(),[l,a]=T.useState(!0),[u,s]=T.useState(!1),[p,c]=T.useState({star:!0,likes5:!0,comment:!0,inspiration:!0,reaction:!0,system:!0,invites:!0});T.useEffect(()=>{(async()=>{a(!0);try{const x=await Q(I.user.notifPrefs,{requireAuth:!0});x&&x.prefs&&c(m=>({...m,...x.prefs}))}finally{a(!1)}})()},[]);async function b(x){s(!0);try{await Q(I.user.notifPrefs,{method:"POST",body:JSON.stringify(x)}),t("Preferences saved",{variant:"success"})}catch(m){t((m==null?void 0:m.message)||"Failed to save",{variant:"error"})}finally{s(!1)}}function i(x){const m={...p,[x]:!p[x]};c(m),b(m)}const f=({k:x,label:m,desc:N})=>e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:m}),N&&e.jsx("span",{className:"settings-sublabel",children:N})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("label",{className:"settings-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:p[x],onChange:()=>i(x),"aria-label":`Toggle ${m}`}),e.jsx("span",{className:"settings-toggle-slider"})]})})]});return l?e.jsx("div",{className:"settings-hint",children:"Loading preferences…"}):e.jsxs(e.Fragment,{children:[e.jsx(f,{k:"star",label:"Stars",desc:"When someone stars your map"}),e.jsx(f,{k:"likes5",label:"Likes milestone",desc:"When you reach 5+ likes"}),e.jsx(f,{k:"comment",label:"Comments",desc:"When someone comments on your post"}),e.jsx(f,{k:"inspiration",label:"Inspirations",desc:"When someone is inspired by you"}),e.jsx(f,{k:"reaction",label:"Reactions",desc:"When someone reacts to your comment"}),e.jsx(f,{k:"invites",label:"Queue invitations",desc:"When you are invited to a queue"}),e.jsx(f,{k:"system",label:"System messages",desc:"Important announcements"}),u&&e.jsx("div",{className:"settings-hint",style:{marginTop:8},children:"Saving…"})]})}const ia=()=>(o.useEffect(()=>()=>{vs.clearAll()},[]),e.jsx(ys,{}));function na(){const[t,l]=T.useState({mobile:!1,standalone:!1,platform:""}),[a,u]=T.useState("ios");return T.useEffect(()=>{const s=typeof navigator<"u"&&navigator.userAgent||"",p=/iPad|iPhone|iPod/i.test(s)||/(Macintosh).*Mobile/.test(s),c=/Android/i.test(s),b=p?"ios":c?"android":"other";l({mobile:we(),standalone:!1,platform:b}),u(b==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":a==="ios",className:`profile-tab ${a==="ios"?"active":""}`,"data-tab":"ios",onClick:s=>{const p=s.currentTarget.closest(".profile-tabs-unified");p.querySelectorAll(".profile-tab").forEach(b=>{b.classList.remove("active"),b.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),p.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),u("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":a==="android",className:`profile-tab ${a==="android"?"active":""}`,"data-tab":"android",onClick:s=>{const p=s.currentTarget.closest(".profile-tabs-unified");p.querySelectorAll(".profile-tab").forEach(b=>{b.classList.remove("active"),b.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),p.querySelector(".profile-tabs-content").setAttribute("data-active","android"),u("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":a,children:[e.jsx("div",{className:"panel",hidden:a!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:a!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const dt={standard:wt,taiko:vt,mania:yt,catch:jt},ct={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},ra=({value:t,onChange:l})=>{const[a,u]=o.useState(!1),s=o.useRef(null);o.useEffect(()=>{if(!a)return;const c=i=>{s.current&&!s.current.contains(i.target)&&u(!1)},b=i=>{i.key==="Escape"&&u(!1)};return document.addEventListener("mousedown",c),document.addEventListener("keydown",b),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("keydown",b)}},[a]);const p=c=>e.jsxs("button",{className:`mode-option${c===t?" selected":""}`,onClick:()=>{l(c),u(!1)},role:"option","aria-selected":c===t,children:[e.jsx("img",{className:"mode-icon",src:dt[c],width:24,height:24,alt:""}),e.jsx("span",{children:ct[c]})]},c);return e.jsxs("div",{className:"mode-select",ref:s,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":a,onClick:()=>u(c=>!c),children:[e.jsx("img",{className:"mode-icon",src:dt[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:ct[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),a&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(p)})]})},oa=["help","showcase","request"];function ut(t){if(!t)return"standard";const l=String(t).toLowerCase().trim();return l==="osu"||l==="0"||l==="standard"?"standard":l==="taiko"||l==="1"?"taiko":l==="catch"||l==="fruits"||l==="2"?"catch":l==="mania"||l==="3"?"mania":"standard"}function la({section:t,onUpload:l,onPost:a}){const{notify:u}=ve(),{data:s}=ke(),[p,c]=o.useState(""),[b,i]=o.useState(""),[f,x]=o.useState(null),[m,N]=o.useState(null),[k,S]=o.useState(!1),[y,j]=o.useState(""),g=o.useRef(0),[C,U]=o.useState("standard"),[w,F]=o.useState(null),[D,n]=o.useState(0),[H,W]=o.useState(""),[L,$]=o.useState(""),[K,P]=o.useState(""),[B,z]=o.useState(""),[G,V]=o.useState(null),[_,Y]=o.useState(!1),[se,ie]=o.useState(null),v=100*1024*1024,O=o.useMemo(()=>w?`${w.name}:${w.size}:${w.lastModified}`:null,[w]),[h,E]=o.useState(!1),[X,ee]=o.useState([]),[de,r]=o.useState(!1),q=o.useRef(null),ne=o.useRef(null);o.useEffect(()=>{g.current&&window.clearTimeout(g.current);const M=(b||"").trim();if(!M){j(""),x(null),N(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(M)){j(""),x(null),N(null);return}return g.current=window.setTimeout(async()=>{var re;try{let oe;try{oe=new URL(M)}catch{j("Invalid URL format");return}const xe=oe.hash.match(/#osu\/(\d+)/),le=xe?xe[1]:null;oe.hash="";const $e={url:oe.toString()};le&&($e.beatmap_id=le);const he=await Q(I.osu.resolveBeatmap+Me($e),{requireAuth:!1}),Pe=Array.isArray(he==null?void 0:he.diffs)?he.diffs:[];if(!Pe.length&&!he.setId){j("No difficulties found"),x(null),N(null);return}if(x({setId:Number(he.setId)||0,beatmapId:he.beatmapId??null,title:String(he.title||""),artist:String(he.artist||""),mapper:String(he.mapper||""),diffs:Pe}),Pe.length>0){const Ge=Number.isFinite(Number(he.beatmapId))?Number(he.beatmapId):Number((re=Pe[0])==null?void 0:re.id),d=Pe.find(te=>Number(te.id)===Ge)||Pe[0],J=ut(d==null?void 0:d.mode);N({beatmapId:Number(d==null?void 0:d.id)||null,version:String((d==null?void 0:d.version)||""),mode:J}),U(J)}else N(null);j("")}catch(oe){const xe=(oe==null?void 0:oe.message)||"Unknown error";j(`Failed to resolve: ${xe}`),x(null),N(null)}},400),()=>{g.current&&window.clearTimeout(g.current)}},[b]);const Z=p.trim(),fe=M=>{var oe;const R=((oe=M.target.files)==null?void 0:oe[0])||null;if(F(R),V(null),R&&R.size>v?P("File exceeds 100MB limit"):P(""),R)try{const xe=URL.createObjectURL(R),le=document.createElement("video");le.preload="metadata",le.src=xe,le.onloadedmetadata=()=>{URL.revokeObjectURL(xe);const pe=Number.isFinite(le.duration)?le.duration:NaN;Number.isFinite(pe)&&V(pe),Number.isFinite(pe)&&pe>60.5?z("Clip exceeds 60s limit"):z("")},le.onerror=()=>{URL.revokeObjectURL(xe),V(null)}}catch{V(null)}else z("");const re=R?`${R.name}:${R.size}:${R.lastModified}`:null;re&&re!==se&&Y(!1)};async function Ae(){return $("info"),W("Requesting upload URL..."),await Q(I.uploads.new,{method:"POST",body:JSON.stringify({description:Z.slice(0,100),beatmap_url:b||void 0,size_bytes:(w==null?void 0:w.size)??void 0,mode:C,beatmapset_id:(f==null?void 0:f.setId)??void 0,beatmap_id:(m==null?void 0:m.beatmapId)??void 0,beatmap_version:(m==null?void 0:m.version)??void 0,beatmap_title:f?`${f.title}`:void 0,beatmap_artist:f?`${f.artist}`:void 0,beatmap_mapper:f?`${f.mapper}`:void 0,tags:X.length>0?X.join(","):void 0})})}async function Ie(M,R,re="form"){await new Promise((oe,xe)=>{const le=new XMLHttpRequest;if(le.open("POST",M),le.upload.onprogress=pe=>{pe.lengthComputable&&n(Math.round(pe.loaded/pe.total*100))},le.onload=()=>le.status>=200&&le.status<300?oe():xe(new Error(`Upload failed (${le.status}) ${le.responseText||""}`)),le.onerror=()=>xe(new Error("Network error")),re==="form"){const pe=new FormData;pe.append("file",R,R.name),le.send(pe)}else le.setRequestHeader("Content-Type","application/octet-stream"),le.send(R)})}async function He(){if(w){if(w.size>v){P("File exceeds 100MB limit");return}if(typeof G=="number"&&G>60.5){z("Clip exceeds 60s limit");return}O&&(Y(!0),ie(O)),n(0),$("info"),E(!0);try{const M=await Ae();let R=M.streamUID;try{W("Uploading..."),await Ie(M.uploadURL,w,"form")}catch(re){$("warn"),W(`Retrying upload... (${(re==null?void 0:re.message)||re})`);const oe=await Ae();R=oe.streamUID,await Ie(oe.uploadURL,w,"binary")}$("info"),W("Processing...");for(let re=0;re<60;re++){await new Promise(oe=>setTimeout(oe,3e3));try{if((await Q(I.videos.get(R),{requireAuth:!1})).status==="ready"){$("success"),W("Ready!"),u("Upload complete!",{variant:"success"}),F(null),c(""),i(""),x(null),N(null),U("standard"),n(0),P(""),z(""),V(null),Y(!1),ie(null),W(""),l&&l();break}}catch{}}}catch(M){$("error"),W(M.message||"Error"),u(M.message||"Upload failed",{variant:"error"})}finally{E(!1)}}}const A=async()=>{if(!Z.trim()){u("Text is required",{variant:"error"});return}if(Z.length>200){u("Text must be 200 characters or less",{variant:"error"});return}E(!0);try{const M=await Q(I.moddi.posts,{method:"POST",body:JSON.stringify({text:Z,beatmap_url:b.trim()||void 0,beatmapset_id:(f==null?void 0:f.setId)??void 0,beatmap_id:(m==null?void 0:m.beatmapId)??(f==null?void 0:f.beatmapId)??void 0,beatmap_version:(m==null?void 0:m.version)??void 0,tags:X.length>0?X.join(","):void 0})});if(M){const R=M==null?void 0:M.post;R?(!R.uid&&R.id&&(R.uid=String(R.id)),a&&a(R)):a&&a(),u("Post created!",{variant:"success"}),c(""),i(""),x(null),N(null),j(""),ee([])}}catch{u("Failed to create post",{variant:"error"})}finally{E(!1)}},ae=w?!K&&!B&&!_&&!h:Z.trim().length>0&&Z.length<=200&&!h;return e.jsxs("div",{className:"compose-twitter",style:{background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",padding:"12px 16px"},children:[e.jsxs("div",{style:{display:"flex",gap:12},children:[s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",style:{width:40,height:40,borderRadius:"50%",flexShrink:0,objectFit:"cover"}}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("textarea",{ref:q,placeholder:"What's happening?",value:p,onChange:M=>c(M.target.value),maxLength:500,style:{width:"100%",background:"transparent",border:"none",padding:"8px 0",color:"var(--text)",fontFamily:"inherit",fontSize:18,resize:"none",minHeight:52,outline:"none",lineHeight:1.4},rows:1,onInput:M=>{const R=M.target;R.style.height="auto",R.style.height=R.scrollHeight+"px"}}),X.length>0&&e.jsx("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:6},children:X.map(M=>e.jsxs("span",{style:{background:"rgba(102, 126, 234, 0.2)",border:"1px solid rgba(102, 126, 234, 0.4)",borderRadius:12,padding:"2px 8px",fontSize:11,color:"#667eea",display:"flex",alignItems:"center",gap:4},children:[M,e.jsx("button",{type:"button",onClick:()=>ee(R=>R.filter(re=>re!==M)),style:{background:"transparent",border:"none",color:"#667eea",cursor:"pointer",padding:0,display:"flex",alignItems:"center",lineHeight:1},children:e.jsx(We,{size:12})})]},M))}),y&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:y}),w&&e.jsxs("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.2)",borderRadius:8,display:"flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx(rt,{size:16}),e.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:w.name}),e.jsxs("span",{className:"muted",children:[(w.size/1024/1024).toFixed(1),"MB",G&&e.jsxs("span",{children:[" • ",Math.round(G),"s"]})]}),e.jsx("button",{type:"button",onClick:()=>{F(null),P(""),z("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:14,padding:2},children:e.jsx(We,{size:14})})]}),K&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:K}),B&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:B}),(D>0||H)&&e.jsxs("div",{style:{marginTop:8},children:[H&&e.jsx("div",{className:`chip ${L||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:H}),D>0&&e.jsx("div",{style:{marginTop:6,height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.min(100,Math.max(0,D))}%`,height:"100%",background:"#667eea",borderRadius:2,transition:"width 0.2s"}})})]}),de&&e.jsxs("div",{style:{marginTop:12,padding:12,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Tags"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:oa.map(M=>{const R=X.includes(M);return e.jsx("button",{type:"button",onClick:()=>{ee(re=>R?re.filter(oe=>oe!==M):[...re,M])},style:{background:R?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:R?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:16,padding:"4px 10px",fontSize:12,color:R?"#667eea":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:R?500:400},children:M},M)})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Beatmap URL"}),f?e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,padding:"8px 10px",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[f.artist," – ",f.title]}),e.jsxs("div",{className:"muted",style:{fontSize:10,marginTop:2},children:["by ",f.mapper]})]}),f.diffs.length>0&&e.jsx("select",{value:(m==null?void 0:m.beatmapId)??f.beatmapId??void 0,onChange:M=>{const R=Number(M.target.value),re=(f==null?void 0:f.diffs.find(oe=>Number(oe.id)===R))||null;if(re){const oe=ut(re.mode);N({beatmapId:R,version:re.version,mode:oe}),U(oe)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,padding:"4px 8px",fontSize:11,marginRight:4},children:f.diffs.map(M=>e.jsx("option",{value:M.id,children:M.version},M.id))}),e.jsx("button",{type:"button",onClick:()=>{x(null),N(null),i("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:4,display:"flex"},children:e.jsx(We,{size:14})})]}):e.jsx("input",{type:"url",placeholder:"https://osu.ppy.sh/beatmapsets/...",value:b,onChange:M=>i(M.target.value),style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:8,padding:"8px 10px",fontSize:12,color:"var(--text)",outline:"none",boxSizing:"border-box"}}),y&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:y})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{type:"button",disabled:!0,style:{background:"transparent",border:"none",padding:8,cursor:"not-allowed",opacity:.4,color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center"},title:"Image upload (coming soon)",children:e.jsx(Xt,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{var M;return(M=ne.current)==null?void 0:M.click()},style:{background:w?"rgba(102, 126, 234, 0.15)":"transparent",border:"none",padding:8,cursor:"pointer",color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},title:"Add video clip (max 60s, 100MB)",children:e.jsx(rt,{size:20})}),e.jsx("input",{ref:ne,type:"file",accept:"video/*",onChange:fe,style:{display:"none"}}),w&&e.jsx("div",{style:{marginLeft:8},children:e.jsx(ra,{value:C,onChange:U})}),e.jsx("button",{type:"button",onClick:()=>r(M=>!M),style:{background:X.length>0||f||de?"rgba(102, 126, 234, 0.15)":"transparent",border:"none",padding:8,marginLeft:4,cursor:"pointer",color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},title:"Attach tags or beatmap",children:e.jsx(Zt,{size:20})}),e.jsxs("span",{className:"muted",style:{fontSize:11,marginLeft:12},children:[Z.length,"/",w?100:200]})]}),e.jsx("button",{type:"button",onClick:w?He:A,disabled:!ae,style:{background:ae?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:999,padding:"8px 18px",color:"#fff",fontWeight:600,fontSize:14,cursor:ae?"pointer":"not-allowed",transition:"all 0.15s"},children:h?"Posting...":"Post"})]})]})]}),k&&f&&e.jsx(Nt,{open:k,onClose:()=>S(!1),downloadUrl:I.osu.downloadBeatmapset(f.setId),beatmapId:(m==null?void 0:m.beatmapId)??f.beatmapId??void 0,beatmapVersion:m==null?void 0:m.version})]})}function da(){const{data:t}=ke(),{modeFilters:l}=Se(),a=Object.entries(l).filter(([s,p])=>p).map(([s])=>s),u=a.length?a.join(","):"standard";return ft({queryKey:["mappi","feed",u],queryFn:async({pageParam:s=0})=>{const p=new URLSearchParams({limit:"20",offset:String(s),modes:u}),c=`${I.feed.recent}?${p.toString()}`;return await Q(c)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,p)=>{var i;const c=p.reduce((f,x)=>{var m;return f+(((m=x.items)==null?void 0:m.length)||0)},0);return(((i=s.items)==null?void 0:i.length)||0)===20?c:void 0}})}function ca(){const{data:t}=ke(),{tagFilters:l}=Se(),a=Object.entries(l).filter(([u,s])=>s).map(([u])=>u).join(",");return ft({queryKey:["moddi","feed",a],queryFn:async({pageParam:u=0})=>{const s=new URLSearchParams({limit:"20",offset:String(u)});a&&s.append("tags",a);const p=`${I.moddi.posts}?${s.toString()}`;return await Q(p)},enabled:!!t,initialPageParam:0,getNextPageParam:(u,s)=>{var b;const p=s.reduce((i,f)=>{var x;return i+(((x=f.items)==null?void 0:x.length)||0)},0);return(((b=u.items)==null?void 0:b.length)||0)===20?p:void 0}})}function ua(){const t=Ne(),l=es(),{data:a}=ke(),{modeFilters:u,tagFilters:s}=Se(),{data:p,fetchNextPage:c,hasNextPage:b,isFetching:i,isFetchingNextPage:f,refetch:x}=da(),{data:m,fetchNextPage:N,hasNextPage:k,isFetching:S,isFetchingNextPage:y,refetch:j}=ca(),g=o.useMemo(()=>(p==null?void 0:p.pages.flatMap(P=>P.items||[]))||[],[p]),C=o.useMemo(()=>m!=null&&m.pages?m.pages.flatMap(P=>(P.items||[]).map(z=>({...z,user_id:z.user_id??0,username:z.username||"Unknown",avatar_url:z.avatar_url||null,text:z.text??null,uid:z.uid||String(z.id||""),reactions_count:Number(z.reactions_count??0),reacted_by_me:z.reacted_by_me??!1,comments_count:Number(z.comments_count??0),_type:"moddi"}))):[],[m]),U=o.useMemo(()=>{const B=[...g.map(z=>({...z,_type:"mappi"})),...C];return B.sort((z,G)=>{const V=z.created_at||0;return(G.created_at||0)-V}),B},[g,C]),w=o.useMemo(()=>U.filter(P=>{if(P._type==="mappi"){const B=Object.entries(u).filter(([V,_])=>_).map(([V])=>V.toLowerCase());if(B.length===0)return!0;const z=new Set(B),G=String(P.mode||"standard").toLowerCase();return z.has(G)}else{const B=P.tags?typeof P.tags=="string"?P.tags.split(",").map(V=>V.trim()):[]:[],z=!B.length,G=B.includes("help");return s.untagged&&s.help?!0:s.untagged&&!s.help?z:!s.untagged&&s.help?G:!0}}),[U,u,s]);o.useEffect(()=>{t.pathname==="/feed"&&(x(),j())},[t.pathname,x,j]);const F=P=>{l.setQueryData(["mappi","feed"],B=>B&&{...B,pages:B.pages.map(z=>({...z,items:z.items.map(G=>G.id===P.id?P:G)}))})},D=P=>{l.setQueryData(["moddi","feed"],B=>B&&{...B,pages:B.pages.map(z=>({...z,items:z.items.map(G=>G.id===P.id?P:G)}))})},n=P=>{l.setQueryData(["mappi","feed"],B=>B&&{...B,pages:B.pages.map(z=>({...z,items:z.items.filter(G=>G.id!==P)}))}),l.setQueryData(["moddi","feed"],B=>B&&{...B,pages:B.pages.map(z=>({...z,items:z.items.filter(G=>G.id!==P)}))})},H=()=>{x()},W=P=>{P&&l.setQueryData(["moddi","feed"],B=>{if(!B)return B;const z={...P,user_id:P.user_id??0,username:P.username||"Unknown",avatar_url:P.avatar_url||null,text:P.text??null,uid:P.uid||String(P.id||""),reactions_count:Number(P.reactions_count??0),reacted_by_me:P.reacted_by_me??!1,comments_count:Number(P.comments_count??0)};return{...B,pages:B.pages.map((G,V)=>V===0?{...G,items:[z,...G.items||[]]}:G)}}),l.invalidateQueries({queryKey:["moddi","feed"]}),j()},L=i&&!f||S&&!y,$=b||k,K=()=>{b&&c(),k&&N()};return e.jsxs("div",{className:"feed-container unified-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto"},children:[e.jsx(la,{section:"mappi",onUpload:H,onPost:W}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[w.length===0&&!L&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to share something!"}),w.map(P=>e.jsx(Qe,{post:P,section:P._type,onUpdate:P._type==="mappi"?F:D,onDelete:n,me:a},`${P._type}-${P.id}`)),w.length>0&&$&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:K,disabled:f||y,children:f||y?"Loading...":"Load more"})})]})}),e.jsx(ms,{context:"unified-feed"})]})}const ma=T.lazy(()=>Ss(()=>import("./Discover-C0LnxBtm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));Us("dark");ps();"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t=encodeURIComponent(Be);navigator.serviceWorker.register(`/sw.js?api=${t}`).then(l=>{console.log("Service Worker registered successfully:",l.scope)}).catch(l=>{console.error("Service Worker registration failed:",l)})});const pa=()=>e.jsx(is,{children:e.jsxs(ue,{element:e.jsx(Hs,{}),children:[e.jsx(ue,{path:"/",element:e.jsx(Os,{})}),e.jsx(ue,{path:"/feed",element:e.jsx(ua,{})}),e.jsx(ue,{path:"/feed/:uid",element:e.jsx(Js,{})}),e.jsx(ue,{path:"/discover",element:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(ma,{})})}),e.jsx(ue,{path:"/queues",element:e.jsx(fs,{})}),e.jsx(ue,{path:"/queues/:id",element:e.jsx(gs,{})}),e.jsx(ue,{path:"/submissions",element:e.jsx(Le,{to:"/queues?tab=submissions",replace:!0})}),e.jsx(ue,{path:"/mp/feed",element:e.jsx(Le,{to:"/feed",replace:!0})}),e.jsx(ue,{path:"/mp/feed/:uid",element:e.jsx(Le,{to:"/feed/:uid",replace:!0})}),e.jsx(ue,{path:"/mp/discover",element:e.jsx(Le,{to:"/discover",replace:!0})}),e.jsx(ue,{path:"/md/feed",element:e.jsx(Le,{to:"/feed",replace:!0})}),e.jsx(ue,{path:"/md/feed/:uid",element:e.jsx(Le,{to:"/feed/:uid",replace:!0})}),e.jsx(ue,{path:"/md/queues",element:e.jsx(Le,{to:"/queues",replace:!0})}),e.jsx(ue,{path:"/md/queues/:id",element:e.jsx(Le,{to:"/queues/:id",replace:!0})}),e.jsx(ue,{path:"/md/submissions",element:e.jsx(Le,{to:"/submissions",replace:!0})}),e.jsx(ue,{path:"/notifications",element:e.jsx(xs,{})}),e.jsx(ue,{path:"/profile",element:e.jsx(lt,{})}),e.jsx(ue,{path:"/profile/:id",element:e.jsx(lt,{})}),e.jsx(ue,{path:"/moderation",element:e.jsx(Ys,{})}),e.jsx(ue,{path:"/about",element:e.jsx(Vs,{})}),e.jsx(ue,{path:"/settings",element:e.jsx(sa,{})}),e.jsx(ue,{path:"/mobile",element:e.jsx(na,{})}),e.jsx(ue,{path:"/editor",element:e.jsx(ia,{})})]})}),ha=()=>e.jsx(as,{children:e.jsx(pa,{})});ts(document.getElementById("root")).render(e.jsx(_s,{children:e.jsx(ss,{client:ks,children:e.jsx(hs,{children:e.jsx(ha,{})})})}));export{Cs as B,Et as C,_t as P,Ss as _};
