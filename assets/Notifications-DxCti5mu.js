import{i as S,r as A,j as i,n as m,t as D,c as I,o as z,A as R,p as W,q,s as C}from"./vendor-react-_vsaDC62.js";import{e as F,f as P,g as T,u as _,a as p,A as g}from"./index-B1MAaWze.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";function B(){const{data:r=[],isLoading:h}=F(),x=P(),y=T(),{notify:a}=_(),v=S(),[d,c]=A.useState(new Set),u=async e=>{x.mutate(e,{onSuccess:()=>{}})},o=async e=>{e.startsWith("n:")&&y.mutate(e)},j=async()=>{const e=r.filter(t=>!t.read&&(t.id.startsWith("n:")||t.kind==="system"&&!t.id.startsWith("b:"))).map(t=>t.id);e.length>0&&(await u(e),a("All notifications marked as read",{variant:"success"}))},l=e=>{if(!e)return null;try{const t=JSON.parse(e);if((t==null?void 0:t.type)==="queue_invite"&&(t!=null&&t.queue_id))return t}catch{}return null},k=async(e,t)=>{if(!d.has(e.id)){c(s=>new Set(s).add(e.id));try{await p(g.moddi.queueAccept(String(t)),{method:"POST"}),a("Invitation accepted!",{variant:"success"}),o(e.id),v(`/md/queues/${t}`)}catch(s){a((s==null?void 0:s.message)||"Failed to accept invitation",{variant:"error"})}finally{c(s=>{const n=new Set(s);return n.delete(e.id),n})}}},N=async(e,t)=>{if(!d.has(e.id)){c(s=>new Set(s).add(e.id));try{await p(g.moddi.queueDeny(String(t)),{method:"POST"}),a("Invitation declined",{variant:"success"}),o(e.id)}catch(s){a((s==null?void 0:s.message)||"Failed to decline invitation",{variant:"error"})}finally{c(s=>{const n=new Set(s);return n.delete(e.id),n})}}},b=e=>l(e.text)?i.jsx(z,{size:20,color:"#a78bfa"}):e.kind==="star"?i.jsx(R,{size:20,color:"#f59e0b"}):e.kind==="likes5"?i.jsx(W,{size:20,color:"#f472b6"}):e.kind==="inspiration"?i.jsx(q,{size:20,color:"#7dd3fc"}):e.id.startsWith("b:")?i.jsx(C,{size:20,color:"#a78bfa"}):null,f=e=>l(e.text)?"Queue Invitation":e.kind==="star"?"Star":e.kind==="likes5"?"Likes":e.kind==="inspiration"?"Inspiration":e.id.startsWith("b:")?"Global":"System",w=r.filter(e=>!e.read&&!(e.id.startsWith("b:")&&e.expiresAt&&e.expiresAt<=Date.now())).length;return i.jsxs("div",{className:"col",style:{width:"100%",maxWidth:700,margin:"0 auto"},children:[i.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[i.jsx("div",{className:"title",children:"Notifications"}),w>0&&i.jsxs("button",{className:"btn secondary",onClick:j,children:[i.jsx(m,{size:16,style:{marginRight:6}}),"Mark all read"]})]}),h?i.jsx("div",{className:"muted",style:{textAlign:"center",padding:32},children:"Loading..."}):r.length===0?i.jsx("div",{className:"muted",style:{textAlign:"center",padding:32},children:"No notifications yet."}):i.jsx("div",{className:"col",style:{gap:8},children:r.filter(e=>!(e.id.startsWith("b:")&&e.expiresAt&&e.expiresAt<=Date.now())).map(e=>i.jsx("div",{style:{background:e.read?"var(--panel-dark)":"var(--panel)",border:`1px solid ${e.read?"rgba(255,255,255,0.08)":"rgba(125, 211, 252, 0.3)"}`,borderRadius:12,padding:16,cursor:e.videoId?"pointer":"default",opacity:e.read?.7:1},onClick:()=>{!e.read&&e.id.startsWith("n:")&&u([e.id]),e.videoId&&(window.location.hash="/mp/feed")},children:i.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12},children:[i.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:b(e)}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[i.jsx("strong",{style:{fontSize:14},children:f(e)}),i.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[i.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(e.createdAt).toLocaleDateString()}),e.id.startsWith("n:")&&i.jsx("button",{className:"icon-link",onClick:t=>{t.stopPropagation(),o(e.id)},style:{padding:4},children:i.jsx(D,{size:14})})]})]}),i.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const t=l(e.text);return t?`${t.inviter_username} invited you to join queue: ${t.queue_name}`:e.text||(e.kind==="star"?"One of your posts was starred!":e.kind==="likes5"?"One of your posts reached 5 likes!":e.kind==="inspiration"?"Someone is inspired by you!":"")})()}),(()=>{const t=l(e.text);return t&&!d.has(e.id)?i.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[i.jsxs("button",{className:"btn",onClick:s=>{s.stopPropagation(),k(e,t.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[i.jsx(m,{size:14,style:{marginRight:4}}),"Accept"]}),i.jsxs("button",{className:"btn secondary",onClick:s=>{s.stopPropagation(),N(e,t.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[i.jsx(I,{size:14,style:{marginRight:4}}),"Decline"]})]}):t&&d.has(e.id)?i.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),e.read&&e.readAt&&i.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(e.readAt).toLocaleString()]})]})]})},e.id))})]})}export{B as default};
