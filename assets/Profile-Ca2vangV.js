import{r as n,j as e,c as $,P as J,e as W,J as Q,V as X,B as G,G as K,I as Y}from"./vendor-react-C7NF2CWg.js";import{a as b,A as g,b as P,u as Z}from"./index-DqZma11j.js";import"./vendor-RuoRctBR.js";import"./editor-components-CZPSM51n.js";function V(c){if(!c)return"standard";const u=String(c).toLowerCase().trim();return u==="osu"||u==="0"||u==="standard"?"standard":u==="taiko"||u==="1"?"taiko":u==="catch"||u==="fruits"||u==="2"?"catch":u==="mania"||u==="3"?"mania":"standard"}const ee=({open:c,onClose:u,videoId:F,initialDescription:m,initialBeatmapUrl:T,onSave:l})=>{const[_,q]=n.useState(m||""),[k,E]=n.useState(T||""),[i,y]=n.useState(null),[h,f]=n.useState(null),[U,j]=n.useState(""),[A,w]=n.useState(!1),I=n.useRef(0);n.useEffect(()=>{c&&(q(m||""),E(T||""),y(null),f(null),j(""))},[c,m,T]),n.useEffect(()=>{if(!c)return;I.current&&window.clearTimeout(I.current);const t=(k||"").trim();if(!t){j(""),y(null),f(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(t)){j(""),y(null),f(null);return}return I.current=window.setTimeout(async()=>{var x;try{let p;try{p=new URL(t)}catch{j("Invalid URL format");return}const L=p.hash.match(/#osu\/(\d+)/),M=L?L[1]:null;p.hash="";const z={url:p.toString()};M&&(z.beatmap_id=M);const o=await b(g.osu.resolveBeatmap+P(z),{requireAuth:!1}),N=Array.isArray(o==null?void 0:o.diffs)?o.diffs:[];if(!N.length&&!o.setId){j("No difficulties found"),y(null),f(null);return}if(y({setId:Number(o.setId)||0,beatmapId:o.beatmapId??null,title:String(o.title||""),artist:String(o.artist||""),mapper:String(o.mapper||""),diffs:N}),N.length>0){const D=Number.isFinite(Number(o.beatmapId))?Number(o.beatmapId):Number((x=N[0])==null?void 0:x.id),d=N.find(B=>Number(B.id)===D)||N[0],R=V(d==null?void 0:d.mode);f({beatmapId:Number(d==null?void 0:d.id)||null,version:String((d==null?void 0:d.version)||""),mode:R})}j("")}catch(p){j(`Failed to resolve: ${(p==null?void 0:p.message)||"Unknown error"}`),y(null),f(null)}},400),()=>{I.current&&window.clearTimeout(I.current)}},[k,c]);const S=async()=>{if(!A){w(!0);try{await b(g.videos.update(F),{method:"PATCH",body:JSON.stringify({description:_.slice(0,100),beatmap_url:k.trim()||void 0})});const t=!!k.trim();if(i||!t)try{await b(g.videos.update(F)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:t&&i&&i.setId>0?i.setId:null,beatmap_id:t&&(h!=null&&h.beatmapId)?h.beatmapId:null,beatmap_version:t&&(h!=null&&h.version)?h.version:null,beatmap_title:t&&(i!=null&&i.title)?i.title:null,beatmap_artist:t&&(i!=null&&i.artist)?i.artist:null,beatmap_mapper:t&&(i!=null&&i.mapper)?i.mapper:null,beatmap_url:t?k.trim():null})})}catch(x){console.warn("Failed to update beatmap metadata:",x)}l(_,k.trim()||null),u()}catch(t){alert((t==null?void 0:t.message)||"Failed to update post")}finally{w(!1)}}};return c?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:t=>t.target===t.currentTarget&&u(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:u}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:u,"aria-label":"Close",children:e.jsx($,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:_,onChange:t=>q(t.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),i?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[i.artist," – ",i.title]}),e.jsxs("span",{className:"muted",children:["by ",i.mapper]})]}),e.jsx("select",{value:(h==null?void 0:h.beatmapId)??i.beatmapId??void 0,onChange:t=>{const C=Number(t.target.value),x=(i==null?void 0:i.diffs.find(p=>Number(p.id)===C))||null;if(x){const p=V(x.mode);f({beatmapId:C,version:x.version,mode:p})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:i.diffs.map(t=>e.jsxs("option",{value:t.id,children:[t.version," (",t.mode,")"]},t.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{y(null),f(null),E("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:k,onChange:t=>E(t.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),U&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:U})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:u,disabled:A,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:S,disabled:A,children:A?"Saving...":"Save"})]})]})]})]}):null};function ie(){const c=J(),u=W(),{notify:F}=Z(),[m,T]=n.useState(null),[l,_]=n.useState(null),[q,k]=n.useState(""),[E,i]=n.useState([]),[y,h]=n.useState([]),[f,U]=n.useState([]),[j,A]=n.useState(""),[w,I]=n.useState(null),[S,t]=n.useState([]),[C,x]=n.useState(null),[p,L]=n.useState(""),[M,O]=n.useState([]),[z,o]=n.useState(null),[N,D]=n.useState(!1),d=n.useMemo(()=>{const s=c.id?Number(c.id):null;return s?m?m.id===s:!1:!0},[c.id,m]);function R(s){const r=s.stream_uid||String(s.id),a=c.id?`/profile/${c.id}`:"/profile";u(`/mp/feed/${r}`,{state:{returnTo:a}})}n.useEffect(()=>{(async()=>{try{const s=await b(g.auth.me,{requireAuth:!1});T(s),s&&Array.isArray(s.inspirations)&&t(s.inspirations)}catch(s){k((s==null?void 0:s.message)||"Not logged in")}})()},[]),n.useEffect(()=>{(async()=>{try{const s=c.id?Number(c.id):null;if(s){const r=await b(g.users.get(s),{requireAuth:!1});_(r),A(r.about||""),Array.isArray(r.inspirations)&&t(r.inspirations);const a=await b(g.users.videos(s)+P({limit:"60"}),{requireAuth:!1});U(a.items||[]);const v=await b(g.users.likes(s)+P({limit:"60"}),{requireAuth:!1});h(v.items||[])}else{if(!m)return;_(m),A(m.about||""),Array.isArray(m.inspirations)&&t(m.inspirations);const r=await b(g.users.myVideos+P({limit:"50"}),{requireAuth:!1});i(r.items||[]);const a=await b(g.users.likes(m.id)+P({limit:"60"}),{requireAuth:!1});h(a.items||[])}}catch{}})()},[c.id,m]),n.useEffect(()=>{D(!1)},[l==null?void 0:l.id]);async function B(s){try{const a=(await b(g.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:s})})).user||l;_(a),Array.isArray(a==null?void 0:a.inspirations)&&t(a.inspirations),c.id||T(a)}catch{}}return n.useEffect(()=>{let s;return C!==null&&p.trim().length>=2?s=setTimeout(async()=>{try{const r=await b(g.osu.usersSearch(p),{requireAuth:!1});O(Array.isArray(r.items)?r.items:[])}catch{}},250):O([]),()=>{s&&clearTimeout(s)}},[p,C]),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:l?e.jsxs(e.Fragment,{children:[l.avatar_url&&e.jsx("img",{src:l.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[l.username,l.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${l.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:s=>s.currentTarget.style.opacity="1",onMouseLeave:s=>s.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Q,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",l.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!d&&S.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),S.map((s,r)=>d?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>o(s.id),onMouseLeave:()=>o(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const a=S.filter((v,H)=>H!==r);t(a),B(a)},children:e.jsx("img",{src:s.avatar_url,alt:s.username})}),z===s.id&&e.jsxs("div",{className:"insp-tooltip",children:[s.username," — click to remove"]})]},s.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>o(s.id),onMouseLeave:()=>o(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${s.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:s.avatar_url,alt:s.username})}),z===s.id&&e.jsx("div",{className:"insp-tooltip",children:s.username})]},s.id)),d&&S.length<3&&new Array(3-S.length).fill(0).map((s,r)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>o(-r-1),onMouseLeave:()=>o(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{x(r),L(""),O([])},children:"+"}),z===-r-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),C===r&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:p,onChange:a=>L(a.target.value)}),e.jsxs("div",{className:"insp-results",children:[M.length===0&&p.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),M.map(a=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(m&&Number(m.osu_user_id)===Number(a.id)){F("Kinda based, but no.",{variant:"warn"}),x(null);return}if(S.some(H=>H.id===a.id)){x(null);return}const v=[...S,{id:a.id,username:a.username,avatar_url:a.avatar_url}].slice(0,3);t(v),x(null),B(v)},children:[e.jsx("img",{src:a.avatar_url,alt:"avatar"}),e.jsx("span",{children:a.username})]},a.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>x(null),children:"Close"})]})]},`slot-${r}`))]}),d&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:q||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),d?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:j,onChange:s=>A(s.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn compact",onClick:async()=>{try{const s=await b(g.auth.me,{method:"PATCH",body:JSON.stringify({about:j})});_(s.user||l),T(s.user||m)}catch{}},children:"Save"})})]}):(()=>{const s=((l==null?void 0:l.about)||"").trim()||"No bio.",r=s.length>200,a=r&&!N?s.slice(0,200)+"...":s;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:a}),r&&e.jsx("button",{onClick:()=>D(!N),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(X,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(G,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:s=>{const r=s.currentTarget.closest(".profile-tabs-unified");r.querySelectorAll(".profile-tab").forEach(v=>{v.classList.remove("active"),v.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),r.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:s=>{const r=s.currentTarget.closest(".profile-tabs-unified");r.querySelectorAll(".profile-tab").forEach(v=>{v.classList.remove("active"),v.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),r.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(d?E:f).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(d?E:f).map(s=>(d&&l?(l.id,l.username,l.avatar_url,l.is_admin,l.is_mod):s.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>R({...s}),children:[s.poster_url?e.jsx("img",{className:"recent-thumb",src:s.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(K,{size:12}),e.jsx("span",{children:s.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Y,{size:12}),e.jsx("span",{children:s.comments_count??0})]})]})})]},s.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[y.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),y.map(s=>{var r,a;return e.jsxs("button",{className:"recent-cell",onClick:()=>R(s),children:[s.poster_url?e.jsx("img",{className:"recent-thumb",src:s.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((r=s.uploader)==null?void 0:r.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:s.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(a=s.uploader)==null?void 0:a.username})]})]},s.id)})]})})})]})]}),w&&e.jsx(ee,{open:!!w,onClose:()=>I(null),videoId:w.id,initialDescription:w.description,initialBeatmapUrl:w.beatmap_url,onSave:(s,r)=>{i(E.map(a=>a.id===w.id?{...a,description:s||null,beatmap_url:r}:a)),I(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}export{ie as default};
