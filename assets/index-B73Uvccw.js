var Lt=Object.defineProperty;var At=(t,u,c)=>u in t?Lt(t,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[u]=c;var pt=(t,u,c)=>At(t,typeof u!="symbol"?u+"":u,c);import{r as s,j as e,e as Ze,u as et,R as ce,L as U,T as Je,U as zt,V as Ft,B as Ke,W as vt,X as Pt,Y as Dt,Z as $t,O as ht,K as Wt,A as jt,h as wt,P as Ot,Q as qt,E as Ut,c as tt,H as Bt,l as Nt,_ as Pe,y as Ht,v as Vt,b as Qt,a as Yt,i as kt,g as St,k as Ge,$ as Jt,a0 as ft,o as Kt,x as Gt,a1 as Xt,a2 as Zt,a3 as es,a4 as ts,a5 as te}from"./vendor-react-O-yBVenC.js";import{y as ss}from"./vendor-CDuzPMMG.js";import{u as Ue,a as E,A as S,c as Xe,P as as,b as we,d as ns,C as is,T as rs,e as os}from"./mappi-routes-ecbEJYKg.js";import{H as ls,c as ds,b as cs,a as us,i as ms}from"./editor-components-n6sMInZP.js";import{u as Be,a as st,b as ps,c as hs,d as fs,e as xs,f as gs,g as bs,C as ys,M as vs,P as js,Q as ws,h as Ns,N as ks}from"./moddi-routes-4O_pegaN.js";import{B as Ss,E as Cs}from"./editor-lib-DWtn2wJw.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-C79RZ3qw.js";import"./vendor-zip-ChfUW0Uy.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))r(v);new MutationObserver(v=>{for(const m of v)if(m.type==="childList")for(const F of m.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&r(F)}).observe(document,{childList:!0,subtree:!0});function c(v){const m={};return v.integrity&&(m.integrity=v.integrity),v.referrerPolicy&&(m.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?m.credentials="include":v.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function r(v){if(v.ep)return;v.ep=!0;const m=c(v);fetch(v.href,m)}})();const _s=new ss({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Es extends s.Component{constructor(c){super(c);pt(this,"handleRetry",()=>{const c=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),c&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(c){return{hasError:!0,error:c}}componentDidCatch(c,r){console.error("ErrorBoundary caught an error:",c,r)}isChunkLoadingError(c){if(!c)return!1;const r=c.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||c.name==="ChunkLoadError"}render(){var c;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),v=((c=this.state.error)==null?void 0:c.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":v}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const ye=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Ts({i:t}){const u=t*1337,c=(C,L)=>{const B=Math.sin(u+C+L)*1e4,Y=B-Math.floor(B);return Math.floor(Y*(L-C+1)+C)},r=c(0,100),v=c(24,50),m=.7+c(0,100)/100*.3,F=v*m,Q=c(0,4e3),j=c(-10,10),$=c(-8,8),b=c(0,100),M=b<60?1:b<80?1.5:2,z=[{size:200*M,alpha:.06,dx:-22,dy:12,color:ye[c(0,ye.length-1)]},{size:150*M,alpha:.08,dx:-9,dy:7,color:ye[c(0,ye.length-1)]},{size:120*M,alpha:.1,dx:0,dy:0,color:ye[c(0,ye.length-1)]},{size:90*M,alpha:.12,dx:12,dy:-4,color:ye[c(0,ye.length-1)]},{size:64*M,alpha:.13,dx:20,dy:-7,color:ye[c(0,ye.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${F}s`,animationDelay:`${Q}ms`,"--tx":`${j}vw`,transform:`rotate(${$}deg)`},children:z.map((C,L)=>e.jsx("svg",{width:C.size,height:C.size,viewBox:"0 0 100 100",style:{left:`${50+C.dx}%`,bottom:`${C.dy}px`,transform:"translateX(-50%)","--alpha":C.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:C.color})},L))})}function Ct({paused:t=!1}){const u=s.useMemo(()=>new Array(20).fill(0).map((c,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:u.map(c=>e.jsx(Ts,{i:c},c))})}function Is(){const t=Ze(),u=et(),{lastSection:c}=Be(),r=t.pathname==="/"||t.pathname==="/about"||t.pathname==="/md/notifications",v=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!r&&t.pathname.startsWith("/md/");const m=t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"||!r&&!t.pathname.startsWith("/mp/")&&c==="moddi";if(v||r)return null;const F=()=>{u(m?"/mp/feed":"/md/feed")},Q=ce.useRef(null),j=ce.useRef(!1),$=()=>{j.current=!1,Q.current=setTimeout(()=>{j.current=!0,u("/")},500)},b=()=>{Q.current&&(clearTimeout(Q.current),Q.current=null),j.current&&setTimeout(()=>{j.current=!1},100)},M=C=>{if(j.current){C.preventDefault(),C.stopPropagation();return}F()},z=C=>{b(),j.current&&C.preventDefault()};return ce.useEffect(()=>()=>{Q.current&&clearTimeout(Q.current)},[]),e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(U,{to:m?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(Je,{size:20})}),m?e.jsx(U,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(zt,{size:20})}):e.jsx(U,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Ft,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:M,onTouchStart:$,onTouchEnd:z,onMouseDown:$,onMouseUp:b,onMouseLeave:b,"aria-label":m?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:m?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:m?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsx(U,{to:"/profile",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/profile")?"active":""}`,"aria-label":"Profile",children:e.jsx(Ke,{size:20})}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>u("/settings"),"aria-label":"Settings",children:e.jsx(vt,{size:20})})]})]})}function Rs(){const t=Ze(),u=et(),{notify:c}=Ue(),{data:r,isLoading:v}=st(),{data:m}=ps(!!r),{data:F=[]}=hs(!!r),Q=fs(),j=xs(),$=gs(),b=bs(),[M,z]=s.useState(new Set),C=s.useRef(null),L=s.useRef(null),B=s.useRef(null),Y=s.useRef(null),T=s.useRef(null),W=s.useRef(null),P=s.useRef(null),x=s.useRef(null),{menuOpen:w,mobileNavOpen:k,notifOpen:h,filtersOpen:K,modeFilters:ne,tagFilters:re,queueStatusFilters:oe,lastSection:O,setMenuOpen:Z,setMobileNavOpen:ee,setNotifOpen:D,setFiltersOpen:H,closeAllPanels:ae,setModeFilters:l,setTagFilters:R,setQueueStatusFilters:I,setLastSection:J}=Be(),ie=t.pathname==="/"||t.pathname==="/about"||t.pathname==="/md/notifications",o=t.pathname==="/editor",q=t.pathname.startsWith("/mp/")||!ie&&!t.pathname.startsWith("/md/")&&O==="mappi",y=t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"||!ie&&!t.pathname.startsWith("/mp/")&&O==="moddi",le=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";ce.useEffect(()=>{t.pathname.startsWith("/mp/")?J("mappi"):t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"&&J("moddi")},[t.pathname,J]);const[Ne,xe]=ce.useState(0);ce.useEffect(()=>{const i=setInterval(()=>xe(f=>f+1),1e3);return()=>clearInterval(i)},[]);const[ke,Se]=ce.useState(null);ce.useEffect(()=>{!r||!r.is_mod||(async()=>{try{const i=await E(S.admin.debugState,{requireAuth:!1}),f=Array.isArray(i==null?void 0:i.counts)?i.counts.find(g=>String(g.status)==="ready"):null;f&&Se(Number(f.c)||0)}catch{}})()},[r]);const[Ce,Te]=ce.useState(!1),X=async()=>{Te(!0);try{const i=await E(S.admin.clearViews,{method:"POST"});c(`Cleared ${Number((i==null?void 0:i.deleted)||0)} views from your history.`,{variant:"success"});try{localStorage.removeItem("feed_seen_ids")}catch{}try{window.dispatchEvent(new Event("filterchange"))}catch{}}catch{c("Failed to clear view history",{variant:"error"})}finally{Te(!1)}},$e=i=>{if(!i)return null;try{const f=JSON.parse(i);if((f==null?void 0:f.type)==="queue_invite"&&(f!=null&&f.queue_id))return f}catch{}return null},_e=async(i,f)=>{if(!M.has(i.id)){z(g=>new Set(g).add(i.id));try{await E(S.moddi.queueAccept(String(f)),{method:"POST"}),c("Invitation accepted!",{variant:"success"}),b.mutate(i.id),D(!1),u(`/md/queues/${f}`)}catch(g){c((g==null?void 0:g.message)||"Failed to accept invitation",{variant:"error"})}finally{z(g=>{const A=new Set(g);return A.delete(i.id),A})}}},Ie=async(i,f)=>{if(!M.has(i.id)){z(g=>new Set(g).add(i.id));try{await E(S.moddi.queueDeny(String(f)),{method:"POST"}),c("Invitation declined",{variant:"success"}),b.mutate(i.id)}catch(g){c((g==null?void 0:g.message)||"Failed to decline invitation",{variant:"error"})}finally{z(g=>{const A=new Set(g);return A.delete(i.id),A})}}},Re=async()=>{const i=F.filter(f=>f.id.startsWith("n:")||f.kind==="system"&&!f.read).map(f=>f.id);i.length>0&&$.mutate(i)},Me=async i=>{if(D(!1),$.mutate([i.id]),i.kind==="system"||i.id.startsWith("n:"))try{await E(S.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[i.id]})})}catch{}},Le=async(i,f)=>{i.stopPropagation(),b.mutate(f)},Ae=()=>{const f=Object.entries(ne).filter(([g,A])=>A).map(([g])=>g);f.length,f.length===0&&l({standard:!0,taiko:!1,mania:!1,catch:!1});try{window.dispatchEvent(new Event("filterchange"))}catch{}H(!1)},Ee=()=>{const f=Object.entries(re).filter(([g,A])=>A).map(([g])=>g);f.length,f.length===0&&R({untagged:!0,help:!0});try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}H(!1)};return ce.useEffect(()=>{r&&!localStorage.getItem("welcomed")&&(c(`Welcome, ${r.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[r,c]),ce.useEffect(()=>{if(!h)return;const i=f=>{const g=f.target;L.current&&!L.current.contains(g)&&C.current&&!C.current.contains(g)&&D(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[h,D]),ce.useEffect(()=>{if(!w)return;const i=f=>{const g=f.target;Y.current&&!Y.current.contains(g)&&B.current&&!B.current.contains(g)&&Z(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[w,Z]),ce.useEffect(()=>{if(!k)return;const i=f=>{const g=f.target;W.current&&!W.current.contains(g)&&T.current&&!T.current.contains(g)&&ee(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[k,ee]),ce.useEffect(()=>{if(!K)return;const i=f=>{const g=f.target;x.current&&!x.current.contains(g)&&P.current&&!P.current.contains(g)&&H(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[K,H]),e.jsxs("div",{className:"app-shell","data-section":y?"moddi":q?"mappi":O==="moddi"?"moddi":O==="mappi"?"mappi":void 0,children:[e.jsx(Ct,{paused:t.pathname==="/editor"}),e.jsxs("header",{className:"top-nav",children:[t.pathname!=="/editor"&&e.jsxs("div",{className:"mobile-nav",children:[e.jsx("button",{ref:T,className:"icon-link hamburger",onClick:()=>{k||ae(),ee(i=>!i)},"aria-label":"Menu","aria-expanded":k,children:e.jsx(Pt,{size:18})}),k&&e.jsxs("div",{ref:W,className:"menu-panel",role:"menu",children:[ie&&e.jsx(U,{to:t.pathname==="/"?"/about":"/",className:`menu-item ${t.pathname==="/about"?"active":""}`,onClick:()=>ee(!1),children:t.pathname==="/"?"About":"Home"}),q&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:`menu-item ${t.pathname==="/mp/feed"?"active":""}`,onClick:()=>ee(!1),children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:`menu-item ${t.pathname==="/mp/discover"?"active":""}`,onClick:()=>ee(!1),children:"Discover"})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/md/feed",className:`menu-item ${t.pathname==="/md/feed"?"active":""}`,onClick:()=>ee(!1),children:"Feed"}),e.jsx(U,{to:"/md/queues",className:`menu-item ${t.pathname.startsWith("/md/queues")?"active":""}`,onClick:()=>ee(!1),children:"Queues"})]}),!q&&!y&&!ie&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:`menu-item ${t.pathname==="/mp/feed"?"active":""}`,onClick:()=>ee(!1),children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:`menu-item ${t.pathname==="/mp/discover"?"active":""}`,onClick:()=>ee(!1),children:"Discover"})]})]})]}),ie?e.jsx(U,{to:"/",className:"title",children:y?"osu!moddi.ng":q?"osu!mappi.ng":"mappi!"}):o?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(U,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Je,{size:18})}),e.jsx(U,{to:y?"/md/feed":"/mp/feed",className:"title",children:y?"osu!moddi.ng":"osu!mappi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(U,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Je,{size:18})}),e.jsxs(U,{to:y?"/mp/feed":"/md/feed",className:"title coin-flip-title",children:[e.jsx("span",{className:"coin-flip-front",children:y?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:y?"osu!mappi.ng":"osu!moddi.ng"})]})]}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),t.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(ls,{})}):e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[ie&&e.jsx(U,{to:t.pathname==="/"?"/about":"/",className:t.pathname==="/about"?"active":"",children:t.pathname==="/"?"About":"Home"}),q&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:t.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:t.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(U,{to:"/editor",className:t.pathname==="/editor"?"active":"",children:"Editor"})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/md/feed",className:t.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(U,{to:"/md/queues",className:t.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!q&&!y&&!ie&&e.jsxs(e.Fragment,{children:[e.jsx(U,{to:"/mp/feed",className:t.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(U,{to:"/mp/discover",className:t.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(U,{to:"/editor",className:t.pathname==="/editor"?"active":"",children:"Editor"})]})]}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Dt,{size:18})}),r?e.jsxs("div",{className:"user-menu",children:[e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:C,className:"icon-link",onClick:()=>{h||ae(),D(i=>!i)},"aria-label":"Notifications",title:"Notifications",children:e.jsx($t,{size:18})}),Q>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),h&&e.jsxs("div",{ref:L,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(U,{to:"/md/notifications",onClick:()=>D(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:i=>i.currentTarget.style.opacity="1",onMouseLeave:i=>i.currentTarget.style.opacity="0.7",children:"View all"}),F.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:Re,children:e.jsx(ht,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[F.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),F.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).map(i=>{const f=$e(i.text),g=i.id.startsWith("b:"),A=f?"queue-invite":i.kind==="star"?"star":i.kind==="likes5"?"likes":i.kind==="comment"?"comment":i.kind==="inspiration"?"inspiration":i.kind==="reaction"?"reaction":g?"global":"system",se=i.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${A}`,role:"button",onClick:()=>!f&&Me(i),children:[e.jsxs("div",{className:`notif-icon ${se?"deletable":""}`,"aria-hidden":"true",onClick:se&&!f?a=>Le(a,i.id):void 0,title:se&&!f?"Remove":void 0,role:se&&!f?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:f?e.jsx(Wt,{}):A==="star"?e.jsx(jt,{}):A==="likes"?e.jsx(wt,{}):A==="comment"?e.jsx(Ke,{}):A==="inspiration"?e.jsx(Ke,{}):A==="reaction"?e.jsx(Ot,{}):A==="global"?e.jsx(qt,{}):null}),se&&!f?e.jsx("span",{className:"swap-trash",children:e.jsx(Ut,{})}):null]}),e.jsx("div",{className:"notif-body",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[f.inviter_username," invited you to join queue: ",f.queue_name]}),M.has(i.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:a=>{a.stopPropagation(),_e(i,f.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(ht,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:a=>{a.stopPropagation(),Ie(i,f.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(tt,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):i.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:g?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:i.text||""}),g&&i.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(i.expiresAt).toLocaleString()]}):null]}):i.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone commented on your post"})]}):i.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone is inspired by you!"})]}):i.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:i.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:i.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},i.id)})]})]})]}),m!=null&&m.blocked?e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(Bt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:(()=>{const i=Math.max(0,Math.floor((((m==null?void 0:m.reset_at)??0)*1e3-Date.now())/1e3)),f=Math.floor(i/3600),g=Math.floor(i%3600/60),A=i%60,se=a=>String(a).padStart(2,"0");return f>0?`${f}:${se(g)}:${se(A)}`:`${g}:${se(A)}`})()})]}):null,e.jsxs("button",{ref:B,className:"icon-link",onClick:()=>{w||ae(),Z(i=>!i)},title:r.username,"aria-label":"User menu","aria-expanded":w,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:r.username}),e.jsx(Nt,{size:14,style:{opacity:.8}})]}),w&&e.jsxs("div",{ref:Y,className:"menu-panel",role:"menu",children:[e.jsx(U,{to:"/profile",className:"menu-item",onClick:()=>Z(!1),children:"Profile"}),r!=null&&r.is_admin||r!=null&&r.is_mod?e.jsx(U,{to:"/moderation",className:"menu-item",onClick:()=>Z(!1),children:"Moderation"}):null,e.jsx("button",{className:"menu-item",type:"button",onClick:()=>j.mutate(),children:"Log out"})]})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Xe+S.auth.login},disabled:v,children:v?"Checking…":"Login with osu!"})]})]}),e.jsx("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:t.pathname==="/editor"?e.jsx(Pe,{}):t.pathname==="/mp/discover"?e.jsx(Pe,{}):t.pathname==="/"?e.jsx(Pe,{}):t.pathname==="/about"||t.pathname==="/moderation"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(Pe,{})}):e.jsx(Pe,{})}),t.pathname!=="/editor"&&e.jsxs(e.Fragment,{children:[r&&r.is_mod&&ke!==null&&e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[ke," videos ready"]})}),e.jsxs("div",{className:"site-controls","aria-hidden":!1,children:[e.jsx("button",{ref:P,className:"settings-btn",onClick:()=>{K||ae(),H(i=>!i)},"aria-expanded":K,"aria-label":"Filter settings",title:"Filter settings",children:e.jsx(vt,{size:18})}),K&&e.jsx("div",{ref:x,className:"settings-panel",role:"dialog","aria-modal":"false",children:le?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:8},children:[["unchecked","Pending","#f59e0b"],["accepted","Accepted","#10b981"],["denied","Denied","#ef4444"],["finished","Finished","#6366f1"],["archived","Archived","#6b7280"]].map(([i,f,g])=>{const A=oe[i];return e.jsx("button",{className:`mode-cell ${A?"selected":""}`,"aria-pressed":A,onClick:()=>{I({...oe,[i]:!A})},style:{padding:"10px 14px",borderRadius:8,fontSize:13,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontWeight:A?600:500,background:A?g+"15":"transparent",border:`1.5px solid ${A?g+"50":"rgba(255,255,255,0.08)"}`,color:A?g:"var(--text)",transition:"all 0.2s ease",cursor:"pointer",textAlign:"left",width:"100%"},onMouseEnter:se=>{A?(se.currentTarget.style.background=g+"25",se.currentTarget.style.borderColor=g+"70"):(se.currentTarget.style.background="rgba(255,255,255,0.05)",se.currentTarget.style.borderColor="rgba(255,255,255,0.12)")},onMouseLeave:se=>{se.currentTarget.style.background=A?g+"15":"transparent",se.currentTarget.style.borderColor=A?g+"50":"rgba(255,255,255,0.08)"},children:f},i)})}),e.jsx("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn secondary compact",onClick:()=>H(!1),children:"Close"})})]}):y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:6},children:[["untagged","Untagged"],["help","Help"]].map(([i,f])=>{const g=re[i];return e.jsx("button",{className:`mode-cell ${g?"selected":""}`,"aria-pressed":g,onClick:()=>{R({...re,[i]:!g})},children:e.jsx("span",{children:f})},i)})}),r&&(r.is_admin||r.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:Ce,onClick:X,children:Ce?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>H(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:Ee,children:"Apply"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Game modes"}),e.jsx("div",{className:"col",style:{gap:6},children:[["standard","Standard",ds],["taiko","Taiko",cs],["mania","Mania",us],["catch","Catch",ms]].map(([i,f,g])=>{const A=ne[i];return e.jsxs("button",{className:`mode-cell ${A?"selected":""}`,"aria-pressed":A,onClick:()=>{l({...ne,[i]:!A})},children:[e.jsx("img",{className:"mode-icon",src:g,width:24,height:24,alt:""}),e.jsx("span",{children:f})]},i)})}),r&&(r.is_admin||r.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:Ce,onClick:X,children:Ce?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>H(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:Ae,children:"Apply"})]})]})})]})]}),e.jsx(Is,{})]})}function Ms(){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions",children:[e.jsx(U,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(U,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function Ls(){const{data:t}=st(),{modeFilters:u}=Be(),c=Object.entries(u).filter(([v,m])=>m).map(([v])=>v),r=c.length?c.join(","):"standard";return Ht({queryKey:["mappi","feed",r],queryFn:async({pageParam:v=0})=>{const m=new URLSearchParams({limit:"20",offset:String(v),modes:r}),F=`${S.feed.recent}?${m.toString()}`;return await E(F)},enabled:!!t,initialPageParam:0,getNextPageParam:(v,m)=>{var j;const F=m.reduce(($,b)=>{var M;return $+(((M=b.items)==null?void 0:M.length)||0)},0);return(((j=v.items)==null?void 0:j.length)||0)===20?F:void 0}})}function De(){const t=Ze(),u=Vt(),{data:c}=st(),{modeFilters:r}=Be(),{data:v,fetchNextPage:m,hasNextPage:F,isFetching:Q,isFetchingNextPage:j,refetch:$}=Ls(),b=s.useMemo(()=>(v==null?void 0:v.pages.flatMap(T=>T.items||[]))||[],[v]),M=s.useMemo(()=>{const T=Object.entries(r).filter(([P,x])=>x).map(([P])=>P.toLowerCase()),W=new Set(T.length?T:["standard"]);return b.filter(P=>{const x=String(P.mode||"standard").toLowerCase();return W.has(x)})},[b,r]);s.useEffect(()=>{t.pathname==="/mp/feed"&&$()},[t.pathname,$]),s.useEffect(()=>{const T=()=>{$()};return window.addEventListener("filterchange",T),()=>window.removeEventListener("filterchange",T)},[$]);const z=T=>{u.setQueryData(["mappi","feed"],W=>W&&{...W,pages:W.pages.map(P=>({...P,items:P.items.map(x=>x.id===T.id?T:x)}))})},C=T=>{u.setQueryData(["mappi","feed"],W=>W&&{...W,pages:W.pages.map(P=>({...P,items:P.items.filter(x=>x.id!==T)}))})},L=()=>{$()},B=Q&&!j,Y=F??!1;return e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(ys,{section:"mappi",onUpload:L})]}),e.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[M.length===0&&!B&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),M.map(T=>e.jsx(as,{post:T,section:"mappi",onUpdate:z,onDelete:C,me:c},T.id)),M.length>0&&Y&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>m(),disabled:j,children:j?"Loading...":"Load more"})})]})})]})}const fe={};function As(){try{const t=localStorage.getItem("feed_seen_ids");if(t){const u=JSON.parse(t);Array.isArray(u)&&(fe.seenIds=u.filter(c=>typeof c=="number"))}}catch{}return fe}function xt(t){Object.assign(fe,t);try{const u=Array.from(new Set(fe.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(u))}catch{}}function gt(){var ct,ut,mt;const{notify:t}=Ue(),[u,c]=s.useState(fe.history||[]),[r,v]=s.useState(fe.index??-1),[m,F]=s.useState(fe.queue||[]),[Q,j]=s.useState(!1),[$,b]=s.useState(!1),[M,z]=s.useState(fe.eligibleCount??null),[C,L]=s.useState(fe.viewedCount??0),[B,Y]=s.useState(!1),[T,W]=s.useState(!0),[P,x]=s.useState(!1),[w,k]=s.useState(!1),[h,K]=s.useState(!1),[ne,re]=s.useState(!1),[oe,O]=s.useState(!1),[Z,ee]=s.useState([]),[D,H]=s.useState(""),[ae,l]=s.useState(null),[R,I]=s.useState(!1),[J,ie]=s.useState(null),[o,q]=s.useState(!1),y=s.useRef(new Set(fe.seenIds||[])),le=s.useRef(new Set),Ne=s.useRef(!1),xe=s.useRef(fe.lastShownVideoId??null),ke=s.useRef(!1),Se=s.useRef(0),Ce=s.useRef(0),Te=s.useRef(0),X=s.useRef(null),$e=s.useRef(null),_e=s.useRef(null),Ie=s.useRef(null),Re=s.useRef(null),Me=s.useRef(null),Le=s.useRef(null),Ae=s.useRef(null),Ee=s.useRef(0),i=s.useRef(0),f=s.useRef(null),g=s.useRef(null),[A,se]=s.useState(0),a=s.useMemo(()=>r>=0?u[r]:null,[u,r]);s.useEffect(()=>{As()},[]),s.useEffect(()=>{xt({history:u,index:r,queue:m,seenIds:Array.from(y.current),eligibleCount:M??void 0,viewedCount:C,lastShownVideoId:xe.current??void 0})},[u,r,m,M,C]);const je=s.useCallback(()=>{try{const n=localStorage.getItem("filter_modes"),d=(n?String(n):"standard").toLowerCase().split(",").map(_=>_.trim()).filter(Boolean),p=["standard","taiko","mania","catch"],N=Array.from(new Set(d.filter(_=>p.includes(_))));return N.length?N:["standard"]}catch{return["standard"]}},[]),at=s.useCallback(()=>{const n=new Set;return xe.current!==null&&n.add(xe.current),Array.from(y.current).slice(-200).forEach(p=>n.add(p)),m.forEach(p=>n.add(p.id)),Array.from(n)},[m]),He=s.useCallback(async(n=3)=>{var N,_,G,pe;if(Ne.current)return[];const d=Date.now();if(d<Se.current){const ue=Math.ceil((Se.current-d)/1e3);return t(`Rate limited. Please wait ${ue}s.`,{durationMs:3e3,variant:"warn"}),[]}const p=d-Te.current;if(p<2e3){const ue=2e3-p;await new Promise(he=>setTimeout(he,ue))}Ne.current=!0,Te.current=Date.now();try{const ue=at(),he=je().join(","),be=[],Oe=new Set(m.map(de=>de.id));let qe=[...ue];const ze=Math.min(n,3);for(let de=0;de<ze;de++){if(de>0){const V=Date.now()-Ce.current,me=1e3;V<me&&await new Promise(Fe=>setTimeout(Fe,me-V))}try{Ce.current=Date.now();const V=await E(S.feed.next+we({exclude:qe.join(","),modes:he}),{requireAuth:!1}),me=V&&("id"in V?V:V.video)||null;if(!me)break;if(y.current.has(me.id)||Oe.has(me.id)||me.id===xe.current){qe.push(me.id);continue}be.push(me),qe.push(me.id),Oe.add(me.id)}catch(V){if((N=V==null?void 0:V.message)!=null&&N.includes("401")||(_=V==null?void 0:V.message)!=null&&_.includes("Unauthorized")){Y(!0);break}else if((G=V==null?void 0:V.message)!=null&&G.includes("429")||(pe=V==null?void 0:V.message)!=null&&pe.includes("rate limit")){Se.current=Date.now()+5e3,t("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(be.length>0&&F(de=>{const V=new Set(de.map(Fe=>Fe.id)),me=be.filter(Fe=>!V.has(Fe.id));return[...de,...me]}),be.length===0&&m.length===0)try{const de=je().join(","),V=await E(S.feed.progress(de),{requireAuth:!1});z(Number(V.eligible||0)),L(Number(V.viewed||0)),b(Number(V.caught_up||0)===1)}catch{}return be}catch{return[]}finally{Ne.current=!1}},[at,je,m,t]),ge=s.useCallback(async()=>{if(!Q){j(!0);try{m.length<=2&&He(3).catch(()=>{});let n;if(m.length>0)n=m[0],F(d=>d.filter(p=>p.id!==n.id));else{const d=await He(3);d.length>0&&(n=d[0],d.length>1&&F(p=>{const N=new Set(p.map(G=>G.id)),_=d.slice(1).filter(G=>!N.has(G.id));return[...p,..._]}))}if(n)xe.current=n.id,y.current.add(n.id),xt({seenIds:Array.from(y.current)}),c(d=>{const p=[...d.slice(0,r+1),n];return v(p.length-1),p}),le.current.has(n.id)||(le.current.add(n.id),E(S.videos.view(n.id),{method:"POST"}).then(d=>{d&&c(p=>{const N=[...p],_=N.findIndex(G=>G.id===n.id);return _!==-1&&(N[_]={...N[_],views_count:d.views_count??N[_].views_count??0,viewed_by_me:!0}),N})}).catch(()=>{}));else try{const d=je().join(","),p=await E(S.feed.progress(d),{requireAuth:!1});z(Number(p.eligible||0)),L(Number(p.viewed||0)),b(Number(p.eligible||0)>0&&Number(p.viewed||0)>=Number(p.eligible||0))}catch{}}finally{j(!1)}}},[Q,m,He,r,je]),_t=s.useCallback(()=>{X.current&&!X.current.paused&&X.current.pause(),x(!0),O(!1)},[]),Ve=s.useCallback(()=>{r>0&&(v(r-1),x(!1))},[r]),Qe=s.useCallback(()=>{const n=Date.now();if(!(n-i.current<300)){if(i.current=n,T||(ke.current=!0,W(!1)),r<u.length-1){const d=u[r+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:r,nextIndex:r+1,currentVideoId:a==null?void 0:a.id,nextVideoId:d==null?void 0:d.id,nextVideoStreamUID:d==null?void 0:d.stream_uid}),d&&(xe.current=d.id),v(r+1),x(!1);return}if(!$){if(Date.now()<Se.current){const d=Math.ceil((Se.current-Date.now())/1e3);t(`Rate limited. Please wait ${d}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),ge()}}},[r,u,T,$,ge,t,a]);s.useEffect(()=>{const n=$e.current;if(!n)return;const d=_=>{if(B||Math.abs(_.deltaY)<Math.abs(_.deltaX))return;_.preventDefault(),_.stopPropagation();const G=Date.now();if(!(G<Ee.current)){if(Ee.current=G+1e3,!a){_.deltaY>0&&!Q&&ge();return}_.deltaY>0?Qe():Ve()}},p=_=>{f.current=_.touches[0].clientY,g.current=Date.now()},N=_=>{if(B||f.current===null||g.current===null)return;const G=_.changedTouches[0].clientY,pe=Date.now(),ue=f.current-G,he=pe-g.current;if(f.current=null,g.current=null,Math.abs(ue)<50||he>300)return;const be=Date.now();if(!(be<Ee.current)){if(Ee.current=be+1e3,!a){ue>0&&!Q&&ge();return}ue>0?Qe():Ve()}};return n.addEventListener("wheel",d,{passive:!1,capture:!0}),n.addEventListener("touchstart",p,{passive:!0}),n.addEventListener("touchend",N,{passive:!0}),window.addEventListener("wheel",d,{passive:!1,capture:!0}),()=>{n.removeEventListener("wheel",d,{capture:!0}),n.removeEventListener("touchstart",p),n.removeEventListener("touchend",N),window.removeEventListener("wheel",d,{capture:!0})}},[Qe,Ve,a,Q,ge,B]);const Et=s.useCallback(async()=>{var n,d;if(!(!a||o)){q(!0);try{const p=a.liked_by_me?"DELETE":"POST",N=await E(S.videos.like(a.id),{method:p});c(_=>{const G=[..._],pe=G.findIndex(ue=>ue.id===a.id);return pe!==-1&&(G[pe]={...G[pe],liked_by_me:!a.liked_by_me,likes_count:N.likes_count}),G})}catch(p){((n=p==null?void 0:p.message)!=null&&n.includes("429")||(d=p==null?void 0:p.message)!=null&&d.includes("rate limit"))&&t("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{q(!1)}}},[a,o,t]),nt=s.useCallback(async n=>{if(a)try{await E(S.videos.flag(a.id),{method:"POST",body:JSON.stringify({reason:n})}),t("Thanks for your report.",{variant:"info"})}catch{t("Report failed",{variant:"error"})}finally{K(!1)}},[a,t]),Tt=s.useCallback(async()=>{if(!a)return;const n=!a.is_starred,d=n?"star":"unstar";try{await E(S.admin.videosAction(a.id,d),{method:"POST"}),c(p=>{const N=[...p],_=N.findIndex(G=>G.id===a.id);return _!==-1&&(N[_]={...N[_],is_starred:n}),N}),re(!1),t(n?"Post starred":"Star removed",{variant:"success"})}catch{t("Action failed",{variant:"error"})}},[a,t]),it=s.useCallback(async()=>{if(!(!a||!confirm("Permanently delete this video?")))try{await E(S.videos.delete(a.id),{method:"DELETE"}),t("Deleted",{variant:"warn"}),K(!1),c(n=>{const d=n.filter((p,N)=>N!==r);return d.length===0?(v(-1),setTimeout(ge,0)):v(p=>Math.max(0,Math.min(p,d.length-1))),d})}catch{alert("Delete failed")}},[a,r,ge,t]),We=s.useCallback(async()=>{if(a!=null&&a.id)try{const n=await E(S.videos.comments(a.id),{requireAuth:!1});ee(n.items||[])}catch{}},[a==null?void 0:a.id]);s.useEffect(()=>{w&&(a!=null&&a.id)&&We()},[w,a==null?void 0:a.id,We]);const rt=s.useCallback(async n=>{if(n.preventDefault(),!(!D.trim()||!(a!=null&&a.id))){I(!0);try{await E(S.videos.comments(a.id),{method:"POST",body:JSON.stringify({text:D.trim(),parent_id:ae||void 0})}),H(""),l(null),We(),c(d=>{const p=[...d],N=p.findIndex(_=>_.id===a.id);return N!==-1&&(p[N]={...p[N],comments_count:(p[N].comments_count||0)+1}),p}),t("Comment posted!",{variant:"success"})}catch(d){t((d==null?void 0:d.message)||"Failed to post comment",{variant:"error"})}finally{I(!1)}}},[D,a,ae,We,t]),It=s.useCallback(n=>{ee(d=>d.filter(p=>p.id!==n)),c(d=>{const p=[...d],N=p.findIndex(_=>_.id===(a==null?void 0:a.id));return N!==-1&&(p[N]={...p[N],comments_count:Math.max(0,(p[N].comments_count||0)-1)}),p})},[a==null?void 0:a.id]),{topLevelComments:ot,repliesMap:lt}=s.useMemo(()=>{const n=Z.filter(p=>!p.parent_id),d=new Map;return Z.filter(p=>p.parent_id).forEach(p=>{const N=p.parent_id;d.has(N)||d.set(N,[]),d.get(N).push(p)}),{topLevelComments:n,repliesMap:d}},[Z]),Rt=s.useCallback(()=>{if(!X.current)return;const n=!T;W(n),X.current.muted=n,n||(ke.current=!0),!n&&X.current.paused&&X.current.play().catch(()=>{})},[T]),Mt=s.useCallback(n=>{X.current=n,n&&(n.muted=T)},[T]);s.useEffect(()=>{x(!1),k(!1),ke.current?W(!1):W(!0)},[a==null?void 0:a.id,a==null?void 0:a.stream_uid,r,u.length]),s.useEffect(()=>{X.current&&(X.current.muted=T)},[T]),s.useEffect(()=>{if(!a)return;const n=!ke.current;W(n);const d=setTimeout(()=>{X.current&&(X.current.muted=n)},100);return()=>clearTimeout(d)},[a==null?void 0:a.id]),s.useEffect(()=>{a&&(xe.current=a.id)},[a==null?void 0:a.id]),s.useEffect(()=>{P&&X.current&&!X.current.paused&&X.current.pause()},[P]),s.useEffect(()=>{u.length===0&&ge()},[]),s.useEffect(()=>{(async()=>{try{const n=je().join(","),d=await E(S.feed.progress(n),{requireAuth:!1}),p=Number(d.eligible||0),N=Number(d.viewed||0);z(p),L(N),b(p>0&&N>=p)}catch{}})()},[je]),s.useEffect(()=>{const n=()=>{c([]),F([]),y.current.clear(),xe.current=null,v(-1),b(!1),(async()=>{try{const d=je().join(","),p=await E(S.feed.progress(d),{requireAuth:!1}),N=Number(p.eligible||0),_=Number(p.viewed||0);z(N),L(_),b(!1)}catch{}ge()})()};return window.addEventListener("filterchange",n),()=>window.removeEventListener("filterchange",n)},[je,ge]),s.useEffect(()=>{(async()=>{try{const n=await E(S.auth.me,{requireAuth:!1});ie(n)}catch{}})()},[]),s.useEffect(()=>{const n=()=>{const d=document.querySelector(".top-nav");d&&se(d.offsetHeight)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),s.useEffect(()=>{var p;if(!_e.current||!Ie.current||!a||!X.current)return;const n=()=>{var V;const N=(V=Ie.current)==null?void 0:V.querySelector("div"),_=X.current;if(!N||!_||!_e.current)return;const G=_e.current,pe=G.offsetWidth-32,ue=G.offsetHeight-32;let he;a.width&&a.height?he=a.width/a.height:_.videoWidth>0&&_.videoHeight>0?he=_.videoWidth/_.videoHeight:he=16/9;const be=16/9,Oe=pe/be;let ze=Math.min(ue,Oe),de=ze*he;de>pe&&(de=pe,ze=de/he),N.style.width=`${de}px`,N.style.height=`${ze}px`,N.style.maxWidth="100%",N.style.maxHeight="100%"},d=()=>{requestAnimationFrame(n)};if(X.current.readyState>=1)n();else{const N=()=>{var _;n(),(_=X.current)==null||_.removeEventListener("loadedmetadata",N)};(p=X.current)==null||p.addEventListener("loadedmetadata",N)}return window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}},[a==null?void 0:a.id,a==null?void 0:a.width,a==null?void 0:a.height]),s.useEffect(()=>{if(!h)return;const n=d=>{Re.current&&!Re.current.contains(d.target)&&K(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[h]),s.useEffect(()=>{if(!ne)return;const n=d=>{Me.current&&!Me.current.contains(d.target)&&re(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[ne]),s.useEffect(()=>{if(!oe)return;const n=d=>{Le.current&&!Le.current.contains(d.target)&&Ae.current&&!Ae.current.contains(d.target)&&O(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[oe]);const dt=!!(J!=null&&J.is_admin||J!=null&&J.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Ct,{paused:!1}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
      `}),e.jsxs("div",{ref:$e,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[$&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:A+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:_e,className:"video-area discover-video-container",style:{position:"absolute",top:A,left:0,right:0,bottom:0,maxHeight:`calc(100dvh - ${A}px)`,height:`calc(100dvh - ${A}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:"16px",maxWidth:"100vw",width:"100%"},children:B?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=Xe+S.auth.login,children:"Login with osu!"})]}):a?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:Rt,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:Ie,className:"discover-player-wrapper",children:e.jsx(ns,{streamUID:a.stream_uid,playbackUrl:a.playback_url,aspectRatio:a.width&&a.height?a.width/a.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:T,controls:!1,onVideoRef:Mt})}),e.jsx("div",{style:{position:"absolute",top:16,right:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:T?1:0,zIndex:2},children:T?e.jsx(Qt,{size:28,color:"#fff"}):e.jsx(Yt,{size:28,color:"#fff"})})]})]})}):$?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"• Click video to toggle mute/unmute"}),e.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),a&&!P&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:n=>n.stopPropagation(),children:[e.jsx(U,{to:`/profile/${(ct=a.uploader)==null?void 0:ct.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(ut=a.uploader)!=null&&ut.avatar_url?e.jsx("img",{src:a.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:a.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:Et,disabled:o,"aria-label":a.liked_by_me?"Unlike":"Like",title:a.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:a.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:a.liked_by_me?e.jsx(wt,{size:28}):e.jsx(kt,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:a.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>k(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(St,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:a.comments_count??0})]}),a.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:Ae,onClick:()=>O(n=>!n),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Ge,{size:24})}),oe&&e.jsxs("div",{ref:Le,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:a.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>O(!1),children:[e.jsx(Ge,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),a.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:_t,children:"Preview"})]})]}),dt?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>re(n=>!n),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(ft,{size:24})}),ne&&e.jsxs("div",{ref:Me,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:Tt,children:a.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:it,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>K(n=>!n),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Jt,{size:24})}),h&&e.jsxs("div",{ref:Re,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>nt("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>nt("explicit"),children:"Explicit"}),dt&&e.jsx("button",{className:"menu-item",onClick:it,children:"Delete video"})]})]}),a&&!P&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(U,{to:`/profile/${(mt=a.uploader)==null?void 0:mt.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var N,_,G;const n=(N=a.uploader)==null?void 0:N.is_admin,d=(_=a.uploader)==null?void 0:_.is_mod,p=n?"#fff3bf":d?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:p},children:["@",(G=a.uploader)==null?void 0:G.username]}),a.is_starred&&e.jsx(jt,{size:16,color:"#f59e0b",title:"Starred"}),(n||d)&&e.jsx(ft,{size:14,color:p,title:n?"admin":"mod"})]})})()})}),(a.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:a.description}),a.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[a.beatmap_artist," – ",a.beatmap_title," ",a.beatmap_mapper?`(by ${a.beatmap_mapper})`:""," ",a.beatmap_version?`[${a.beatmap_version}]`:""]})]}),w&&a&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",a.comments_count??0,")"]}),e.jsx("button",{onClick:()=>k(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(tt,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:ot.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:ot.map(n=>e.jsx(is,{comment:n,replies:lt.get(n.id)||[],me:J,section:"mappi",onReply:d=>l(d),onDelete:It,replyingTo:ae,replyText:D,onReplyTextChange:H,onReplySubmit:rt,posting:R,onCancelReply:()=>{l(null),H("")},repliesMap:lt},n.id))})}),J&&!ae&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:rt,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:D,onChange:n=>H(n.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:n=>{const d=n.target;d.style.height="auto",d.style.height=`${Math.min(d.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:R||!D.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:R?"...":"Post"})]})})]})]}),P&&(a==null?void 0:a.beatmapset_id)&&e.jsx(Ss,{open:P,onClose:()=>x(!1),downloadUrl:`${Xe}${S.osu.downloadBeatmapset(a.beatmapset_id)}`,beatmapId:a.beatmap_id??void 0,beatmapVersion:a.beatmap_version??void 0})]})]})}function bt(t){if(!t)return"standard";const u=String(t).toLowerCase().trim();return u==="osu"||u==="0"||u==="standard"?"standard":u==="taiko"||u==="1"?"taiko":u==="catch"||u==="fruits"||u==="2"?"catch":u==="mania"||u==="3"?"mania":"standard"}const zs=({open:t,onClose:u,videoId:c,initialDescription:r,initialBeatmapUrl:v,onSave:m})=>{const[F,Q]=s.useState(r||""),[j,$]=s.useState(v||""),[b,M]=s.useState(null),[z,C]=s.useState(null),[L,B]=s.useState(""),[Y,T]=s.useState(!1),W=s.useRef(0);s.useEffect(()=>{t&&(Q(r||""),$(v||""),M(null),C(null),B(""))},[t,r,v]),s.useEffect(()=>{if(!t)return;W.current&&window.clearTimeout(W.current);const x=(j||"").trim();if(!x){B(""),M(null),C(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(x)){B(""),M(null),C(null);return}return W.current=window.setTimeout(async()=>{var k;try{let h;try{h=new URL(x)}catch{B("Invalid URL format");return}const K=h.hash.match(/#osu\/(\d+)/),ne=K?K[1]:null;h.hash="";const oe={url:h.toString()};ne&&(oe.beatmap_id=ne);const O=await E(S.osu.resolveBeatmap+we(oe),{requireAuth:!1}),Z=Array.isArray(O==null?void 0:O.diffs)?O.diffs:[];if(!Z.length&&!O.setId){B("No difficulties found"),M(null),C(null);return}if(M({setId:Number(O.setId)||0,beatmapId:O.beatmapId??null,title:String(O.title||""),artist:String(O.artist||""),mapper:String(O.mapper||""),diffs:Z}),Z.length>0){const ee=Number.isFinite(Number(O.beatmapId))?Number(O.beatmapId):Number((k=Z[0])==null?void 0:k.id),D=Z.find(ae=>Number(ae.id)===ee)||Z[0],H=bt(D==null?void 0:D.mode);C({beatmapId:Number(D==null?void 0:D.id)||null,version:String((D==null?void 0:D.version)||""),mode:H})}B("")}catch(h){B(`Failed to resolve: ${(h==null?void 0:h.message)||"Unknown error"}`),M(null),C(null)}},400),()=>{W.current&&window.clearTimeout(W.current)}},[j,t]);const P=async()=>{if(!Y){T(!0);try{await E(S.videos.update(c),{method:"PATCH",body:JSON.stringify({description:F.slice(0,100),beatmap_url:j.trim()||void 0})});const x=!!j.trim();if(b||!x)try{await E(S.videos.update(c)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:x&&b&&b.setId>0?b.setId:null,beatmap_id:x&&(z!=null&&z.beatmapId)?z.beatmapId:null,beatmap_version:x&&(z!=null&&z.version)?z.version:null,beatmap_title:x&&(b!=null&&b.title)?b.title:null,beatmap_artist:x&&(b!=null&&b.artist)?b.artist:null,beatmap_mapper:x&&(b!=null&&b.mapper)?b.mapper:null,beatmap_url:x?j.trim():null})})}catch(k){console.warn("Failed to update beatmap metadata:",k)}m(F,j.trim()||null),u()}catch(x){alert((x==null?void 0:x.message)||"Failed to update post")}finally{T(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:x=>x.target===x.currentTarget&&u(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:u}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:u,"aria-label":"Close",children:e.jsx(tt,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:F,onChange:x=>Q(x.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),b?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[b.artist," – ",b.title]}),e.jsxs("span",{className:"muted",children:["by ",b.mapper]})]}),e.jsx("select",{value:(z==null?void 0:z.beatmapId)??b.beatmapId??void 0,onChange:x=>{const w=Number(x.target.value),k=(b==null?void 0:b.diffs.find(h=>Number(h.id)===w))||null;if(k){const h=bt(k.mode);C({beatmapId:w,version:k.version,mode:h})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:b.diffs.map(x=>e.jsxs("option",{value:x.id,children:[x.version," (",x.mode,")"]},x.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{M(null),C(null),$("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:j,onChange:x=>$(x.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),L&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:L})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:u,disabled:Y,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:P,disabled:Y,children:Y?"Saving...":"Save"})]})]})]})]}):null};function yt(){const t=Kt(),u=et(),{notify:c}=Ue(),[r,v]=s.useState(null),[m,F]=s.useState(null),[Q,j]=s.useState(""),[$,b]=s.useState([]),[M,z]=s.useState([]),[C,L]=s.useState([]),[B,Y]=s.useState(""),[T,W]=s.useState(null),[P,x]=s.useState([]),[w,k]=s.useState(null),[h,K]=s.useState(""),[ne,re]=s.useState([]),[oe,O]=s.useState(null),[Z,ee]=s.useState(!1),D=s.useMemo(()=>{const l=t.id?Number(t.id):null;return l?r?r.id===l:!1:!0},[t.id,r]);function H(l){const R=l.stream_uid||String(l.id),I=t.id?`/profile/${t.id}`:"/profile";u(`/mp/feed/${R}`,{state:{returnTo:I}})}s.useEffect(()=>{(async()=>{try{const l=await E(S.auth.me,{requireAuth:!1});v(l),l&&Array.isArray(l.inspirations)&&x(l.inspirations)}catch(l){j((l==null?void 0:l.message)||"Not logged in")}})()},[]),s.useEffect(()=>{(async()=>{try{const l=t.id?Number(t.id):null;if(l){const R=await E(S.users.get(l),{requireAuth:!1});F(R),Y(R.about||""),Array.isArray(R.inspirations)&&x(R.inspirations);const I=await E(S.users.videos(l)+we({limit:"60"}),{requireAuth:!1});L(I.items||[]);const J=await E(S.users.likes(l)+we({limit:"60"}),{requireAuth:!1});z(J.items||[])}else{if(!r)return;F(r),Y(r.about||""),Array.isArray(r.inspirations)&&x(r.inspirations);const R=await E(S.users.myVideos+we({limit:"50"}),{requireAuth:!1});b(R.items||[]);const I=await E(S.users.likes(r.id)+we({limit:"60"}),{requireAuth:!1});z(I.items||[])}}catch{}})()},[t.id,r]),s.useEffect(()=>{ee(!1)},[m==null?void 0:m.id]);async function ae(l){try{const I=(await E(S.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:l})})).user||m;F(I),Array.isArray(I==null?void 0:I.inspirations)&&x(I.inspirations),t.id||v(I)}catch{}}return s.useEffect(()=>{let l;return w!==null&&h.trim().length>=2?l=setTimeout(async()=>{try{const R=await E(S.osu.usersSearch(h),{requireAuth:!1});re(Array.isArray(R.items)?R.items:[])}catch{}},250):re([]),()=>{l&&clearTimeout(l)}},[h,w]),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:m?e.jsxs(e.Fragment,{children:[m.avatar_url&&e.jsx("img",{src:m.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[m.username,m.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${m.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:l=>l.currentTarget.style.opacity="1",onMouseLeave:l=>l.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Ge,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",m.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!D&&P.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),P.map((l,R)=>D?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>O(l.id),onMouseLeave:()=>O(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const I=P.filter((J,ie)=>ie!==R);x(I),ae(I)},children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),oe===l.id&&e.jsxs("div",{className:"insp-tooltip",children:[l.username," — click to remove"]})]},l.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>O(l.id),onMouseLeave:()=>O(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${l.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),oe===l.id&&e.jsx("div",{className:"insp-tooltip",children:l.username})]},l.id)),D&&P.length<3&&new Array(3-P.length).fill(0).map((l,R)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>O(-R-1),onMouseLeave:()=>O(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{k(R),K(""),re([])},children:"+"}),oe===-R-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),w===R&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:h,onChange:I=>K(I.target.value)}),e.jsxs("div",{className:"insp-results",children:[ne.length===0&&h.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),ne.map(I=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(I.id)){c("Kinda based, but no.",{variant:"warn"}),k(null);return}if(P.some(ie=>ie.id===I.id)){k(null);return}const J=[...P,{id:I.id,username:I.username,avatar_url:I.avatar_url}].slice(0,3);x(J),k(null),ae(J)},children:[e.jsx("img",{src:I.avatar_url,alt:"avatar"}),e.jsx("span",{children:I.username})]},I.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>k(null),children:"Close"})]})]},`slot-${R}`))]}),D&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:Q||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),D?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:B,onChange:l=>Y(l.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn compact",onClick:async()=>{try{const l=await E(S.auth.me,{method:"PATCH",body:JSON.stringify({about:B})});F(l.user||m),v(l.user||r)}catch{}},children:"Save"})})]}):(()=>{const l=((m==null?void 0:m.about)||"").trim()||"No bio.",R=l.length>200,I=R&&!Z?l.slice(0,200)+"...":l;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:I}),R&&e.jsx("button",{onClick:()=>ee(!Z),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:Z?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(Gt,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Nt,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:l=>{const R=l.currentTarget.closest(".profile-tabs-unified");R.querySelectorAll(".profile-tab").forEach(J=>{J.classList.remove("active"),J.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),R.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:l=>{const R=l.currentTarget.closest(".profile-tabs-unified");R.querySelectorAll(".profile-tab").forEach(J=>{J.classList.remove("active"),J.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),R.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(D?$:C).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(D?$:C).map(l=>(D&&m?(m.id,m.username,m.avatar_url,m.is_admin,m.is_mod):l.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>H({...l}),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(kt,{size:12}),e.jsx("span",{children:l.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(St,{size:12}),e.jsx("span",{children:l.comments_count??0})]})]})})]},l.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[M.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),M.map(l=>{var R,I;return e.jsxs("button",{className:"recent-cell",onClick:()=>H(l),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((R=l.uploader)==null?void 0:R.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:l.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(I=l.uploader)==null?void 0:I.username})]})]},l.id)})]})})})]})]}),T&&e.jsx(zs,{open:!!T,onClose:()=>W(null),videoId:T.id,initialDescription:T.description,initialBeatmapUrl:T.beatmap_url,onSave:(l,R)=>{b($.map(I=>I.id===T.id?{...I,description:l||null,beatmap_url:R}:I)),W(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function Fs(){var l,R,I,J,ie;const[t,u]=s.useState(null),[c,r]=s.useState([]),[v,m]=s.useState(""),[F,Q]=s.useState([]),[j,$]=s.useState(null),[b,M]=s.useState([]),[z,C]=s.useState("all"),[L,B]=s.useState("approvals"),[Y,T]=s.useState(null),[W,P]=s.useState(""),[x,w]=s.useState(!1),{notify:k}=Ue(),[h,K]=s.useState(null),[ne,re]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const o=await E(S.auth.me,{requireAuth:!1});if(u(o),o!=null&&o.is_admin)try{const q=await E(S.admin.settingsModeration,{requireAuth:!1});T(!!q.require_approval)}catch{}}catch{}try{const o=await E(S.admin.videosPending+we({limit:"50"}),{requireAuth:!1});r(o.items||[])}catch{}})()},[]);async function oe(){re(!0);try{const o=await E(S.admin.analytics,{requireAuth:!1});K(o)}finally{re(!1)}}async function O(){try{const o=await E(S.admin.usersSearch(v),{requireAuth:!1});Q(o.items||[])}catch{}}async function Z(o){$(o),M([]);try{const q=await E(S.admin.userVideos(o.id)+we({limit:"50"}),{requireAuth:!1});M(q.items||[])}catch{}}async function ee(o,q){try{const y=await E(S.admin.user(o.id),{method:"PATCH",body:JSON.stringify({is_mod:q})}),le=(y==null?void 0:y.user)||{...o,is_mod:q};k(q?"Granted moderation":"Revoked moderation",{variant:q?"success":"warn"}),$(le),Q(F.map(Ne=>Ne.id===o.id?le:Ne))}catch{alert("Failed to update")}}const D=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),H=!!(t!=null&&t.is_admin),ae=Y===null?null:!Y;return e.jsxs("div",{className:"col",style:{width:"100%"},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[e.jsx("div",{className:"title",children:"Moderation"}),H&&ae!==null&&e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:"Auto-approve"}),e.jsx("button",{className:`btn ${ae?"":"secondary"}`,style:{padding:"6px 10px"},onClick:async()=>{if(Y===null)return;const o=!Y;try{await E(S.admin.settingsModeration,{method:"POST",body:JSON.stringify({require_approval:o})}),T(o),k(o?"Auto-approve disabled":"Auto-approve enabled",{variant:o?"warn":"success"})}catch{alert("Failed to update setting")}},children:ae?"On":"Off"})]})]}),D&&e.jsxs("div",{className:"tabs",role:"tablist","aria-label":"Moderation tabs",children:[e.jsx("button",{role:"tab","aria-selected":L==="approvals",className:`tab ${L==="approvals"?"active":""}`,onClick:()=>B("approvals"),children:"Approvals"}),(H||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":L==="manage",className:`tab ${L==="manage"?"active":""}`,onClick:()=>B("manage"),children:"Manage"}),(H||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":L==="analytics",className:`tab ${L==="analytics"?"active":""}`,onClick:()=>{B("analytics"),h||oe()},children:"Analytics"}),(H||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":L==="message",className:`tab ${L==="message"?"active":""}`,onClick:()=>B("message"),children:"Message"})]})]}),e.jsx("hr",{className:"subtle-divider"}),!D&&e.jsx("div",{className:"muted",children:"You do not have access."}),L==="approvals"&&D&&(()=>{const o=c.filter(y=>!y.flagged_only),q=c.filter(y=>!!y.flagged_only);return e.jsxs("div",{className:"row wrap",style:{marginTop:12,gap:16,alignItems:"flex-start"},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[o.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",children:[o.length===0&&e.jsx("div",{className:"muted",children:"Nothing pending."}),o.map(y=>e.jsxs("div",{className:"row wrap",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[y.poster_url?e.jsx("img",{src:y.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:y.description||"",children:y.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:["uploader: ",y.username,y.needs_review?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{marginLeft:6,color:"#60a5fa"},children:"(pending)"}),typeof y.flags_count=="number"&&y.flags_count>0?e.jsxs("span",{className:"muted",style:{marginLeft:6},children:["• ",y.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"row wrap",children:[e.jsx("button",{className:"btn secondary",onClick:async()=>{try{await E(S.admin.videosReject(y.id),{method:"POST"}),r(c.filter(le=>le.id!==y.id)),k("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn",style:{marginLeft:8},onClick:async()=>{try{await E(S.admin.videosApprove(y.id),{method:"POST"}),r(c.filter(le=>le.id!==y.id)),k("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await E(S.videos.delete(y.id),{method:"DELETE"}),r(c.filter(le=>le.id!==y.id)),k("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},y.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[q.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",children:[q.length===0&&e.jsx("div",{className:"muted",children:"No flagged items."}),q.map(y=>e.jsxs("div",{className:"row wrap",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[y.poster_url?e.jsx("img",{src:y.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:y.description||"",children:y.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:["uploader: ",y.username,e.jsx("span",{style:{marginLeft:6,color:"#9ca3af"},children:"(flagged)"}),typeof y.flags_count=="number"&&y.flags_count>0?e.jsxs("span",{className:"muted",style:{marginLeft:6},children:["• ",y.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"row wrap",children:e.jsx("button",{className:"btn secondary",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await E(S.videos.delete(y.id),{method:"DELETE"}),r(c.filter(le=>le.id!==y.id)),k("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},y.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:6},children:"Flagged items don’t require approval; use Delete only if necessary."})]})]})})(),L==="manage"&&(H||(t==null?void 0:t.is_mod))&&e.jsx("div",{className:"col",style:{marginTop:16},children:e.jsxs("div",{className:"mod-manage-grid",children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"User management"}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:v,onChange:o=>m(o.target.value),onKeyDown:o=>{o.key==="Enter"&&O()}}),e.jsx("button",{className:"btn",onClick:O,style:{padding:"6px 10px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:8},children:e.jsx("div",{className:"col",style:{gap:6},children:F.map(o=>e.jsxs("button",{className:"btn secondary",onClick:()=>Z(o),style:{justifyContent:"flex-start"},children:[o.avatar_url&&e.jsx("img",{src:o.avatar_url,width:18,height:18,style:{borderRadius:"50%",marginRight:8}}),e.jsx("span",{className:"one-line",style:{marginRight:8},children:o.username}),e.jsxs("span",{className:"muted",children:["(id ",o.id,", osu ",o.osu_user_id,")"]}),o.is_admin?e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"admin"}):o.is_mod?e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"mod"}):o.is_blacklisted?e.jsx("span",{style:{marginLeft:"auto",color:"#f87171"},children:"blacklisted"}):null]},o.id))})})]}),e.jsx("div",{className:"v-divider","aria-hidden":"true"}),e.jsx("div",{className:"col",style:{minWidth:0},children:j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row wrap",style:{alignItems:"center"},children:[j.avatar_url&&e.jsx("img",{src:j.avatar_url,width:28,height:28,style:{borderRadius:"50%",marginRight:8}}),e.jsx("div",{className:"title",style:{marginRight:8,fontSize:18},children:j.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",j.id," • osu ",j.osu_user_id]}),e.jsx("div",{style:{marginLeft:"auto"}}),H?j.is_admin?e.jsx("span",{}):j.is_mod?e.jsx("button",{className:"btn secondary",style:{padding:"6px 10px"},onClick:()=>ee(j,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn",style:{padding:"6px 10px"},onClick:()=>ee(j,!0),children:"Grant moderation"}):null,!j.is_admin&&(j.is_blacklisted?e.jsx("button",{className:"btn",style:{marginLeft:8,padding:"6px 10px"},onClick:async()=>{try{await E(S.admin.user(j.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),$({...j,is_blacklisted:!1}),k("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{marginLeft:8,padding:"6px 10px"},onClick:async()=>{try{await E(S.admin.user(j.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),$({...j,is_blacklisted:!0}),k("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),j.is_admin?e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"}):null,e.jsxs("div",{className:"col",style:{marginTop:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:"Show"}),e.jsx("button",{className:`btn ${z==="all"?"":"secondary"}`,onClick:()=>C("all"),children:"All"}),e.jsx("button",{className:`btn ${z==="review"?"":"secondary"}`,onClick:()=>C("review"),children:"Needs review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{marginTop:8},children:[b.length===0&&e.jsx("div",{className:"muted",children:"No uploads."}),b.filter(o=>{if(z==="all")return!0;const q=(Y?!o.approved_at:!1)&&o.status==="ready",y=!!o.needs_review;return q||y}).map(o=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[o.poster_url?e.jsx("img",{src:o.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:o.description||"",children:o.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:[o.status.toUpperCase()," • ",new Date(o.created_at*1e3).toLocaleString(),o.needs_review?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(purgatory)"}):null,Y&&!o.approved_at&&o.status==="ready"?e.jsx("span",{style:{marginLeft:6,color:"#60a5fa"},children:"(pending)"}):null]})]})]}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",children:o.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)"},children:"★"}),(H||(t==null?void 0:t.is_mod))&&(!!o.needs_review||Y&&!o.approved_at&&o.status==="ready")&&e.jsx("button",{className:"btn",onClick:async()=>{try{await E(S.admin.videosApprove(o.id),{method:"POST"}),M(b.map(q=>q.id===o.id?{...q,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:q)),k("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(H||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await E(S.videos.delete(o.id),{method:"DELETE"}),M(b.filter(q=>q.id!==o.id)),k("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},o.id))]})]})]}):e.jsx("div",{className:"muted",children:"Select a user to view details and uploads."})})]})}),!1,L==="message"&&(H||(t==null?void 0:t.is_mod))&&e.jsx("div",{className:"col",style:{marginTop:16},children:e.jsxs("div",{className:"mod-manage-grid",children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"Send a system message"}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:v,onChange:o=>m(o.target.value),onKeyDown:o=>{o.key==="Enter"&&O()}}),e.jsx("button",{className:"btn",onClick:O,style:{padding:"6px 10px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:8},children:e.jsx("div",{className:"col",style:{gap:6},children:F.map(o=>e.jsxs("button",{className:"btn secondary",onClick:()=>$(o),style:{justifyContent:"flex-start"},children:[o.avatar_url&&e.jsx("img",{src:o.avatar_url,width:18,height:18,style:{borderRadius:"50%",marginRight:8}}),e.jsx("span",{className:"one-line",style:{marginRight:8},children:o.username}),e.jsxs("span",{className:"muted",children:["(id ",o.id,", osu ",o.osu_user_id,")"]}),(j==null?void 0:j.id)===o.id&&e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"selected"})]},o.id))})})]}),e.jsx("div",{className:"v-divider","aria-hidden":"true"}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:o=>w(o.currentTarget.checked)}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",style:{height:120,resize:"vertical"},value:W,onChange:o=>P(o.target.value)}),e.jsx("div",{className:"row wrap",style:{justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn",onClick:()=>{const o=(W||"").trim();if(!o){alert("Enter a message");return}(async()=>{try{const q={text:o,global:x};!x&&(j!=null&&j.id)&&(q.user_id=j.id),await E(S.admin.notificationsSystem,{method:"POST",body:JSON.stringify(q)}),P(""),k("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"})}),e.jsx("div",{className:"caption",style:{marginTop:6},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),L==="analytics"&&(H||(t==null?void 0:t.is_mod))&&e.jsxs("div",{className:"col",style:{marginTop:16,gap:12},children:[e.jsx("div",{className:"title",children:"Analytics"}),ne&&e.jsx("div",{className:"muted",children:"Loading…"}),!ne&&!h&&e.jsx("div",{className:"muted",children:"No data."}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{flexWrap:"wrap",gap:10},children:[e.jsx(ve,{label:"Users",value:h.totals.users_total}),e.jsx(ve,{label:"Admins",value:h.totals.users_admin}),e.jsx(ve,{label:"Mods",value:h.totals.users_mod}),e.jsx(ve,{label:"Blacklisted",value:h.totals.users_blacklisted}),e.jsx(ve,{label:"Videos",value:h.totals.videos_total}),e.jsx(ve,{label:"Ready",value:h.totals.videos_ready}),e.jsx(ve,{label:"Pending",value:h.totals.pending_count}),e.jsx(ve,{label:"Purgatory",value:h.totals.purgatory_count}),e.jsx(ve,{label:"Likes",value:h.totals.likes_total}),e.jsx(ve,{label:"Flags",value:h.totals.flags_total})]}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap",gap:20,marginTop:8},children:[e.jsx(Ye,{title:"New users (30d)",series:h.series.users,color:"#60a5fa"}),e.jsx(Ye,{title:"New videos (30d)",series:h.series.videos,color:"#34d399"}),((R=(l=h.stream)==null?void 0:l.graphql)==null?void 0:R.minutes_viewed)&&h.stream.graphql.minutes_viewed.length>0&&e.jsx(Ye,{title:"Minutes viewed (30d)",series:h.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:6,marginTop:8},children:[e.jsx("div",{className:"title",children:"Feed & Stream"}),e.jsxs("div",{className:"muted",children:["Feed: ",h.feed.count," items in rotation",h.feed.cursor?` • cursor ${h.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",children:["Approx. ready seconds: ",h.stream.approximate.total_duration_sec," • ready videos: ",h.stream.approximate.videos_ready]}),h.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12},children:["Stream API: ",h.stream.api.ok?"ok":"unavailable",(J=(I=h.stream.api)==null?void 0:I.result_info)!=null&&J.count?` • count ${h.stream.api.result_info.count}`:"",(ie=h.stream.api)!=null&&ie.sample_status?` • sample status ${String(h.stream.api.sample_status)}`:""]})]})]})]})]})}function ve({label:t,value:u}){return e.jsxs("div",{className:"col",style:{padding:"8px 10px",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,minWidth:120},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",children:u})]})}function Ye({title:t,series:u,color:c}){const $=u.map(w=>w.count),b=Math.max(1,...$),M=s.useMemo(()=>{const w=b,k=Math.pow(10,Math.floor(Math.log10(w))),h=w/k;return(h<=1?1:h<=2?2:h<=5?5:10)*k},[b]),z=350,C=124,L=s.useMemo(()=>u.map((w,k)=>{const h=42+k/Math.max(1,u.length-1)*z,K=8+(1-w.count/(M||1))*C;return[h,K]}),[u,M,z,C]),B=s.useMemo(()=>L.map((w,k)=>k===0?`M ${w[0]} ${w[1]}`:`L ${w[0]} ${w[1]}`).join(" "),[L]),Y=[0,.25,.5,.75,1],T=s.useMemo(()=>{if(u.length===0)return[];const w=[0,.25,.5,.75,1].map(k=>Math.min(u.length-1,Math.round(k*(u.length-1))));return Array.from(new Set(w))},[u]),W=w=>{if(!w||w.length<10)return w||"";const k=w.slice(5,7).replace(/^0/,""),h=w.slice(8,10).replace(/^0/,"");return`${k}/${h}`};function P(w){const k=Number.isInteger(w);return w>=1e6?`${(w/1e6).toFixed(1).replace(/\.0$/,"")}M`:w>=1e3?`${(w/1e3).toFixed(1).replace(/\.0$/,"")}k`:k?String(w):w<10?w.toFixed(1):w.toFixed(1).replace(/\.0$/,"")}const x=u.length?u[u.length-1].count:0;return e.jsxs("div",{className:"col",style:{border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:10},children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{className:"muted",children:t}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["latest: ",P(x)]})]}),e.jsxs("svg",{width:400,height:160,role:"img","aria-label":t,children:[e.jsx("rect",{x:0,y:0,width:400,height:160,fill:"#0f1217",rx:8}),Y.map((w,k)=>{const h=8+(1-w)*C,K=w*M;return e.jsxs("g",{children:[e.jsx("line",{x1:42,y1:h,x2:392,y2:h,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:36,y:h+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:P(K)})]},k)}),e.jsx("line",{x1:42,y1:8,x2:42,y2:8+C,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:42,y1:8+C,x2:42+z,y2:8+C,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),T.map((w,k)=>{var K;const h=42+w/Math.max(1,u.length-1)*z;return e.jsxs("g",{children:[e.jsx("line",{x1:h,y1:8,x2:h,y2:8+C,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:h,y:8+C+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:W((K=u[w])==null?void 0:K.day)})]},k)}),e.jsx("path",{d:B,fill:"none",stroke:c,strokeWidth:2}),L.length>0&&e.jsx("circle",{cx:L[L.length-1][0],cy:L[L.length-1][1],r:3,fill:c})]})]})}function Ps(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Ds(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}function $s(){return e.jsx(Cs,{})}const Ws=()=>e.jsx(ts,{children:e.jsxs(te,{element:e.jsx(Rs,{}),children:[e.jsx(te,{path:"/",element:e.jsx(Ms,{})}),e.jsx(te,{path:"/mp/discover",element:e.jsx(gt,{})}),e.jsx(te,{path:"/mp/feed",element:e.jsx(De,{})}),e.jsx(te,{path:"/mp/feed/:uid",element:e.jsx(os,{})}),e.jsx(te,{path:"/md/feed",element:e.jsx(vs,{})}),e.jsx(te,{path:"/md/feed/:uid",element:e.jsx(js,{})}),e.jsx(te,{path:"/md/queues",element:e.jsx(ws,{})}),e.jsx(te,{path:"/md/queues/:id",element:e.jsx(Ns,{})}),e.jsx(te,{path:"/md/notifications",element:e.jsx(ks,{})}),e.jsx(te,{path:"/profile",element:e.jsx(yt,{})}),e.jsx(te,{path:"/profile/:id",element:e.jsx(yt,{})}),e.jsx(te,{path:"/moderation",element:e.jsx(Fs,{})}),e.jsx(te,{path:"/about",element:e.jsx(Ps,{})}),e.jsx(te,{path:"/settings",element:e.jsx(Ds,{})}),e.jsx(te,{path:"/editor",element:e.jsx($s,{})}),e.jsx(te,{path:"/feed",element:e.jsx(gt,{})}),e.jsx(te,{path:"/upload",element:e.jsx(De,{})}),e.jsx(te,{path:"/posts",element:e.jsx(De,{})}),e.jsx(te,{path:"/recents",element:e.jsx(De,{})}),e.jsx(te,{path:"/recent",element:e.jsx(De,{})})]})}),Os=()=>e.jsx(es,{children:e.jsx(Ws,{})});Xt(document.getElementById("root")).render(e.jsx(ce.StrictMode,{children:e.jsx(Es,{children:e.jsx(Zt,{client:_s,children:e.jsx(rs,{children:e.jsx(Os,{})})})})}));
