import{r as i,j as e,I as ie,s as ne,K as re,N as oe,X as le,P as de,Y as ce,L as ue,c as J,Z as pe,_ as me,p as he}from"./vendor-react-Bj2Cd7tG.js";import{u as G}from"./index-Cpn37iRT.js";import"./vendor-CBpd7OPg.js";import"./editor-components-B-SB05wW.js";const Y="https://api.osumappi.ng";function ge(a){var c;return(c=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s===a))==null?void 0:c[1]}function fe({submission:a,canManage:c,onUpdate:s}){const[F,d]=i.useState(!1),[M,N]=i.useState(!1),[p,q]=i.useState(null),{notify:j}=G();i.useEffect(()=>{if(!a.beatmap_url||!a.beatmapset_id&&!a.beatmap_id||p)return;let n=!1;return(async()=>{try{let m;try{m=new URL(a.beatmap_url)}catch{return}const v=m.hash.match(/#osu\/(\d+)/),y=v?v[1]:null;m.hash="";const $=m.toString(),C=new URLSearchParams({url:$});y&&C.set("beatmap_id",y);const w=await fetch(`${Y}/api/osu/beatmap/resolve?${C.toString()}`,{credentials:"include"});if(w.ok&&!n){const g=await w.json();(g.title||g.artist)&&q({title:g.title||null,artist:g.artist||null,mapper:g.mapper||null})}}catch{}})(),()=>{n=!0}},[a.beatmap_url,a.beatmapset_id,a.beatmap_id]);const x=async n=>{if(!F){d(!0);try{const m=ge("csrf")||"";if((await fetch(`${Y}/api/moddi/queues/${a.queue_id}/submissions/${a.id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":m},body:JSON.stringify({status:n})})).ok){const y={...a,status:n,updated_at:Math.floor(Date.now()/1e3)};s&&s(y),j("Status updated",{variant:"success"})}else j("Failed to update status",{variant:"error"})}catch{j("Failed to update status",{variant:"error"})}finally{d(!1),N(!1)}}},h={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},b={unchecked:"Unchecked",accepted:"Accepted",denied:"Denied",finished:"Finished"},S=a.beatmapset_id?`https://assets.ppy.sh/beatmaps/${a.beatmapset_id}/covers/card.jpg`:null;return e.jsxs("div",{style:{position:"relative",borderRadius:12,overflow:"hidden",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease"},onMouseEnter:n=>n.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:n=>n.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[S&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"200px",backgroundImage:`url(${S})`,backgroundSize:"cover",backgroundPosition:"center",opacity:.3,zIndex:0}}),e.jsx("div",{style:{position:"relative",zIndex:1,padding:"16px"},children:e.jsxs("div",{className:"row",style:{alignItems:"flex-start",justifyContent:"space-between",gap:12,marginBottom:12},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[p?e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:600,marginBottom:4},children:p.title||"Unknown Title"}),e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:2},children:p.artist||"Unknown Artist"}),p.mapper&&e.jsxs("div",{className:"muted",style:{fontSize:12},children:["Mapped by ",p.mapper]}),a.beatmap_version&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:4},children:a.beatmap_version})]}):e.jsx("div",{style:{marginBottom:8},children:e.jsxs("a",{href:a.beatmap_url,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",gap:6,color:"#7dd3fc",textDecoration:"none",fontSize:14},children:[e.jsx(ie,{size:14}),"View beatmap"]})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,marginTop:8},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:a.username}),e.jsx("span",{style:{fontSize:13},children:a.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(a.created_at*1e3).toLocaleDateString()})]})]}),c?e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{className:"chip-btn",onClick:()=>N(!M),disabled:F,style:{background:h[a.status]+"20",border:`1px solid ${h[a.status]}40`,color:h[a.status],whiteSpace:"nowrap"},children:[e.jsx("span",{style:{textTransform:"capitalize",fontSize:12},children:b[a.status]}),e.jsx(ne,{size:12,style:{marginLeft:4}})]}),M&&e.jsx("div",{style:{position:"absolute",right:0,top:"100%",marginTop:4,background:"#121418",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,padding:4,zIndex:10,minWidth:120,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:["unchecked","accepted","denied","finished"].map(n=>e.jsx("button",{className:"menu-item",onClick:()=>x(n),style:{color:n===a.status?h[n]:void 0},children:b[n]},n))})]}):e.jsx("span",{style:{padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:500,background:h[a.status]+"20",color:h[a.status],whiteSpace:"nowrap"},children:b[a.status]})]})})]})}const f="https://api.osumappi.ng";function R(a){var c;return(c=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s===a))==null?void 0:c[1]}function je(){const{id:a}=re(),c=oe(),[s,F]=i.useState(null),[d,M]=i.useState([]),[N,p]=i.useState([]),[q,j]=i.useState(!0),[x,h]=i.useState(null),[b,S]=i.useState(!1),[n,m]=i.useState(!1),[v,y]=i.useState(""),[$,C]=i.useState(null),[w,g]=i.useState(!1),[I,U]=i.useState(""),[D,L]=i.useState(""),[P,Q]=i.useState(!1),[B,W]=i.useState(""),[A,O]=i.useState(!1),[K,X]=i.useState(null),E=i.useRef(null),{notify:r}=G(),_=async()=>{if(a){j(!0);try{const t=await fetch(`${f}/api/moddi/queues/${a}`,{credentials:"include"});if(t.ok){const l=await t.json();F(l.queue),M(l.members||[]),p(l.submissions||[])}else t.status===403?(r("You do not have access to this queue",{variant:"error"}),c("/md/queues")):r("Failed to load queue",{variant:"error"})}catch{r("Failed to load queue",{variant:"error"})}finally{j(!1)}}};i.useEffect(()=>{_(),fetch(`${f}/api/me`,{credentials:"include"}).then(t=>t.ok?t.json():null).then(t=>h(t)).catch(()=>{})},[a]);const H=x&&s&&(s.owner_id===x.id||d.some(t=>t.user_id===x.id&&t.role==="owner"));x&&d.some(t=>t.user_id===x.id&&t.joined_at);const V=async t=>{if(t.preventDefault(),!v.trim()){r("Beatmap URL is required",{variant:"error"});return}m(!0);try{const l=R("csrf")||"",o=await fetch(`${f}/api/moddi/queues/${a}/submit`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({beatmap_url:v.trim()})});if(o.ok)r("Submission created!",{variant:"success"}),S(!1),y(""),_();else{const u=await o.json().catch(()=>({}));r(u.error||"Failed to submit",{variant:"error"})}}catch{r("Failed to submit",{variant:"error"})}finally{m(!1)}},Z=t=>{p(l=>l.map(o=>o.id===t.id?t:o))},ee=()=>{s&&(U(s.name),L(s.description||""),g(!0))},z=()=>{g(!1),U(""),L("")},te=async t=>{if(t.preventDefault(),!s||!I.trim()){r("Queue name is required",{variant:"error"});return}Q(!0);try{const l=R("csrf")||"",o=d.filter(k=>k.user_id!==s.owner_id&&k.role!=="owner").length>0,u=await fetch(`${f}/api/moddi/queues/${a}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({name:I.trim(),description:D.trim()||null,is_group:o})});if(u.ok)r("Queue updated!",{variant:"success"}),z(),_();else{const k=await u.json().catch(()=>({}));r(k.error||"Failed to update queue",{variant:"error"})}}catch{r("Failed to update queue",{variant:"error"})}finally{Q(!1)}},ae=async t=>{if(t.preventDefault(),!B.trim()){r("Username is required",{variant:"error"});return}O(!0);try{const l=R("csrf")||"",o=await fetch(`${f}/api/moddi/queues/${a}/invite`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({username:B.trim()})});if(o.ok)r("Member invited!",{variant:"success"}),W(""),s&&s.is_group===0&&((await fetch(`${f}/api/moddi/queues/${a}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({is_group:!0})})).ok||console.warn("Failed to convert queue to group after inviting member")),_();else{const u=await o.json().catch(()=>({}));r(u.error||"Failed to invite member",{variant:"error"})}}catch{r("Failed to invite member",{variant:"error"})}finally{O(!1)}},se=async t=>{if(confirm("Remove this member from the queue?")){X(t);try{const l=R("csrf")||"",o=await fetch(`${f}/api/moddi/queues/${a}/members/${t}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":l}});if(o.ok){r("Member removed",{variant:"success"});const k=d.filter(T=>T.user_id!==t).some(T=>T.user_id!==(s==null?void 0:s.owner_id)&&T.role!=="owner");s&&s.is_group===1&&!k&&((await fetch(`${f}/api/moddi/queues/${a}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({is_group:!1})})).ok||console.warn("Failed to convert queue back to individual after removing last member")),_()}else{const u=await o.json().catch(()=>({}));r(u.error||"Failed to remove member",{variant:"error"})}}catch{r("Failed to remove member",{variant:"error"})}finally{X(null)}}};return i.useEffect(()=>{if(!w)return;const t=l=>{const o=l.target;o.closest(".manage-overlay")||o.closest(".manage-overlay-backdrop")||!o.closest(".manage-popup")&&E.current&&!E.current.contains(o)&&z()};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[w]),q?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):s?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link",onClick:()=>c("/md/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(de,{size:20})}),e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:s.name})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[H&&e.jsx("button",{ref:E,className:"icon-link",onClick:ee,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(ce,{size:18})}),d.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:d.map(t=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>C(t.user_id),onMouseLeave:()=>C(null),children:[e.jsx(ue,{to:`/profile/${t.user_id}`,className:"queue-member-avatar",title:t.username,children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:t.username.charAt(0).toUpperCase()})}),$===t.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[t.username," ",t.role!=="member"?`(${t.role})`:""]})]},t.user_id))})]})]}),s.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:s.description}),e.jsxs("div",{style:{background:"#121418",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>S(!b),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Submit a beatmap"}),b?e.jsx(J,{size:16}):e.jsx(pe,{size:16})]}),b&&e.jsx("form",{onSubmit:V,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:v,onChange:t=>y(t.target.value),required:!0,style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:t=>{t.stopPropagation(),S(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:n,onClick:t=>t.stopPropagation(),children:n?"Submitting...":"Submit"})]})]})})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("div",{className:"col",style:{gap:0},children:N.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No submissions yet."}):N.map(t=>e.jsx(fe,{submission:t,canManage:!!H,onUpdate:Z},t.id))})}),w&&le.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:z}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:z,"aria-label":"Close",children:e.jsx(J,{size:18})}),e.jsxs("form",{onSubmit:te,className:"col",style:{gap:16,padding:"16px 0"},children:[e.jsx("div",{className:"title",style:{fontSize:20,marginBottom:4},children:"Manage Queue"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500},children:"Queue Name"}),e.jsx("input",{type:"text",value:I,onChange:t=>U(t.target.value),required:!0,style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:D,onChange:t=>L(t.target.value),rows:4,style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"col",style:{gap:12,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:16},children:"Manage Members"}),e.jsxs("form",{onSubmit:ae,className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Username to invite",value:B,onChange:t=>W(t.target.value),required:!0,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsxs("button",{type:"submit",className:"btn",disabled:A,children:[e.jsx(me,{size:16,style:{marginRight:6}}),A?"Inviting...":"Invite"]})]}),d.length>0&&e.jsx("div",{className:"col",style:{gap:8},children:d.map(t=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:t.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500},children:t.username}),e.jsx("div",{className:"muted",style:{fontSize:12},children:t.role})]})]}),t.user_id!==s.owner_id&&t.role!=="owner"&&e.jsx("button",{className:"icon-link",onClick:()=>se(t.user_id),disabled:K===t.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(he,{size:16})})]},t.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:z,disabled:P,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:P,children:P?"Updating...":"Save Changes"})]})]})]})]}),document.body),e.jsx("style",{children:`
        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}export{je as default};
