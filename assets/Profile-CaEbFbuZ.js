import{r as n,j as e,c as pe,P as ue,R as ee,M as te,I as me,p as he,J as be,K as xe,w as fe,L as ge,A as ve}from"./vendor-react-lgmFq2cc.js";import{O as ye}from"./Overlay-gtb26ixw.js";import{P as je}from"./Popup-b0klE36J.js";import{u as ke}from"./index-ClBAXmdM.js";import"./vendor-DTLGnnLV.js";import"./Player-Ct9O_Ut_.js";import"./beatmap-preview-Baf1iPqi.js";import"./editor-lib-DeTrzXBy.js";import"./editor-components-CPOGutYL.js";const ae="https://api.osumappi.ng";function ce(b){if(!b)return"standard";const u=String(b).toLowerCase().trim();return u==="osu"||u==="0"||u==="standard"?"standard":u==="taiko"||u==="1"?"taiko":u==="catch"||u==="fruits"||u==="2"?"catch":u==="mania"||u==="3"?"mania":"standard"}const we=({open:b,onClose:u,videoId:x,initialDescription:$,initialBeatmapUrl:f,onSave:M})=>{const[X,H]=n.useState($||""),[S,L]=n.useState(f||""),[c,w]=n.useState(null),[y,N]=n.useState(null),[W,C]=n.useState(""),[i,I]=n.useState(!1),A=n.useRef(0);n.useEffect(()=>{b&&(H($||""),L(f||""),w(null),N(null),C(""))},[b,$,f]),n.useEffect(()=>{if(!b)return;A.current&&window.clearTimeout(A.current);const l=(S||"").trim();if(!l){C(""),w(null),N(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(l)){C(""),w(null),N(null);return}return A.current=window.setTimeout(async()=>{var d;try{let m;try{m=new URL(l)}catch{C("Invalid URL format");return}const g=m.hash.match(/#osu\/(\d+)/),P=g?g[1]:null;m.hash="";const J=m.toString(),q=new URLSearchParams({url:J});P&&q.set("beatmap_id",P);const _=await fetch(`${ae}/api/osu/beatmap/resolve?${q.toString()}`,{credentials:"include"});if(!_.ok){const T=await _.json().catch(()=>({})),h=String((T==null?void 0:T.error)||`HTTP ${_.status}: ${_.statusText}`);C(h),w(null),N(null);return}const p=await _.json(),E=Array.isArray(p==null?void 0:p.diffs)?p.diffs:[];if(!E.length&&!p.setId){C("No difficulties found"),w(null),N(null);return}if(w({setId:Number(p.setId)||0,beatmapId:p.beatmapId??null,title:String(p.title||""),artist:String(p.artist||""),mapper:String(p.mapper||""),diffs:E}),E.length>0){const T=Number.isFinite(Number(p.beatmapId))?Number(p.beatmapId):Number((d=E[0])==null?void 0:d.id),h=E.find(Q=>Number(Q.id)===T)||E[0],K=ce(h==null?void 0:h.mode);N({beatmapId:Number(h==null?void 0:h.id)||null,version:String((h==null?void 0:h.version)||""),mode:K})}C("")}catch(m){C(`Failed to resolve: ${(m==null?void 0:m.message)||"Unknown error"}`),w(null),N(null)}},400),()=>{A.current&&window.clearTimeout(A.current)}},[S,b]);function O(l){var v;return(v=document.cookie.split("; ").map(d=>d.split("=")).find(([d])=>d===l))==null?void 0:v[1]}const z=async()=>{if(!i){I(!0);try{const l=O("csrf")||"",v=await fetch(`${ae}/api/videos/${x}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({description:X.slice(0,100),beatmap_url:S.trim()||void 0})});if(!v.ok){const g=await v.json().catch(()=>({}));throw new Error((g==null?void 0:g.error)||`HTTP ${v.status}: ${v.statusText}`)}const d=!!S.trim();if(c||!d){const g=await fetch(`${ae}/api/videos/${x}/beatmap`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({beatmapset_id:d&&c&&c.setId>0?c.setId:null,beatmap_id:d&&(y!=null&&y.beatmapId)?y.beatmapId:null,beatmap_version:d&&(y!=null&&y.version)?y.version:null,beatmap_title:d&&(c!=null&&c.title)?c.title:null,beatmap_artist:d&&(c!=null&&c.artist)?c.artist:null,beatmap_mapper:d&&(c!=null&&c.mapper)?c.mapper:null,beatmap_url:d?S.trim():null})});if(!g.ok){const P=await g.text().catch(()=>"");console.warn("Failed to update beatmap metadata:",P)}}M(X,S.trim()||null),u()}catch(l){alert((l==null?void 0:l.message)||"Failed to update post")}finally{I(!1)}}};return b?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:l=>l.target===l.currentTarget&&u(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:u}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:u,"aria-label":"Close",children:e.jsx(pe,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:X,onChange:l=>H(l.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),c?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[c.artist," – ",c.title]}),e.jsxs("span",{className:"muted",children:["by ",c.mapper]})]}),e.jsx("select",{value:(y==null?void 0:y.beatmapId)??c.beatmapId??void 0,onChange:l=>{const v=Number(l.target.value),d=(c==null?void 0:c.diffs.find(m=>Number(m.id)===v))||null;if(d){const m=ce(d.mode);N({beatmapId:v,version:d.version,mode:m})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:c.diffs.map(l=>e.jsxs("option",{value:l.id,children:[l.version," (",l.mode,")"]},l.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{w(null),N(null),L("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:S,onChange:l=>L(l.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),W&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:W})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:u,disabled:i,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:z,disabled:i,children:i?"Saving...":"Save"})]})]})]})]}):null},k="https://api.osumappi.ng";function Le(){var ne,le,oe;const b=ue(),{notify:u}=ke(),[x,$]=n.useState(null),[f,M]=n.useState(null),[X,H]=n.useState(""),[S,L]=n.useState([]),[c,w]=n.useState([]),[y,N]=n.useState([]),[W,C]=n.useState(""),[i,I]=n.useState(null),[A,O]=n.useState(!1),[z,l]=n.useState(!1),[v,d]=n.useState(!1),m=ee.useRef(null),g=ee.useRef(null),P=ee.useRef(null),[J,q]=n.useState(null),[_,p]=n.useState([]),[E,T]=n.useState(null),[h,K]=n.useState(""),[Q,V]=n.useState([]),[U,G]=n.useState(null),[Y,D]=n.useState(null),se=n.useRef(new Set),B=n.useMemo(()=>{const t=b.id?Number(b.id):null;return t?x?x.id===t:!1:!0},[b.id,x]);function Z(t){var s;return(s=document.cookie.split("; ").map(a=>a.split("=")).find(([a])=>a===t))==null?void 0:s[1]}n.useEffect(()=>{if(!i||se.current.has(i.id))return;se.current.add(i.id);const t=Z("csrf")||"";fetch(`${k}/api/videos/${i.id}/view`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":t}}).then(s=>s.ok?s.json():null).then(s=>{if(!s)return;const a=Number(s.views_count??0);w(r=>(r||[]).map(o=>o.id===i.id?{...o,views_count:a,viewed_by_me:!0}:o)),N(r=>(r||[]).map(o=>o.id===i.id?{...o,views_count:a,viewed_by_me:!0}:o)),I(r=>r&&{...r,views_count:a})}).catch(()=>{})},[i]),n.useLayoutEffect(()=>{l(!1)},[i==null?void 0:i.id]),n.useEffect(()=>{if(!v||!g.current)return;const t=()=>{if(g.current){const a=g.current.getBoundingClientRect();q({top:a.bottom+8,right:window.innerWidth-a.right})}};t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,!0);const s=a=>{m.current&&!m.current.contains(a.target)&&g.current&&!g.current.contains(a.target)&&d(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s),window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[v]);async function de(t){try{const s=Z("csrf")||"",a=t.liked_by_me?"DELETE":"POST",r=await fetch(`${k}/api/videos/${t.id}/like`,{method:a,credentials:"include",headers:{"X-CSRF-Token":s}});if(!r.ok)return;const o=await r.json().catch(()=>({})),j=Number((o==null?void 0:o.likes_count)??(t.likes_count||0));w(R=>(R||[]).map(F=>F.id===t.id?{...F,liked_by_me:!t.liked_by_me,likes_count:j}:F)),N(R=>(R||[]).map(F=>F.id===t.id?{...F,liked_by_me:!t.liked_by_me,likes_count:j}:F)),I(R=>R&&R.id===t.id?{...R,liked_by_me:!t.liked_by_me,likes_count:j}:R)}catch{}}async function ie(t,s){try{const a=Z("csrf")||"";await fetch(`${k}/api/videos/${t.id}/flag`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":a},body:JSON.stringify({reason:s})}),O(!1)}catch{}}n.useEffect(()=>{(async()=>{try{const t=await fetch(`${k}/api/me`,{credentials:"include"});if(!t.ok)throw new Error("Not logged in");const s=await t.json();$(s),s&&Array.isArray(s.inspirations)&&p(s.inspirations)}catch(t){H(t.message)}})()},[]),n.useEffect(()=>{(async()=>{try{const t=b.id?Number(b.id):null;if(t){const s=await fetch(`${k}/api/users/${t}`,{credentials:"include"});if(!s.ok){H("User not found");return}const a=await s.json();M(a),C(a.about||""),Array.isArray(a.inspirations)&&p(a.inspirations);const r=await fetch(`${k}/api/users/${t}/videos?limit=60`,{credentials:"include"});if(r.ok){const j=await r.json();N(j.items||[])}const o=await fetch(`${k}/api/users/${t}/likes?limit=60`,{credentials:"include"});if(o.ok){const j=await o.json();w(j.items||[])}}else{if(!x)return;M(x),C(x.about||""),Array.isArray(x.inspirations)&&p(x.inspirations);const s=await fetch(`${k}/api/me/videos?limit=50`,{credentials:"include"});if(s.ok){const r=await s.json();L(r.items||[])}const a=await fetch(`${k}/api/users/${x.id}/likes?limit=60`,{credentials:"include"});if(a.ok){const r=await a.json();w(r.items||[])}}}catch{}})()},[b.id,x]);async function re(t){var s;try{const a=((s=document.cookie.split("; ").map(o=>o.split("=")).find(([o])=>o==="csrf"))==null?void 0:s[1])||"",r=await fetch(`${k}/api/me`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":a},body:JSON.stringify({inspirations:t})});if(r.ok){const j=(await r.json()).user||f;M(j),Array.isArray(j==null?void 0:j.inspirations)&&p(j.inspirations),b.id||$(j)}}catch{}}return n.useEffect(()=>{let t;return E!==null&&h.trim().length>=2?t=setTimeout(async()=>{try{const s=await fetch(`${k}/api/osu/users/search?q=${encodeURIComponent(h)}`,{credentials:"include"});if(s.ok){const a=await s.json();V(Array.isArray(a.items)?a.items:[])}}catch{}},250):V([]),()=>{t&&clearTimeout(t)}},[h,E]),e.jsxs("div",{className:"col",style:{width:"100%"},children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:f?e.jsxs(e.Fragment,{children:[f.avatar_url&&e.jsx("img",{src:f.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[f.username,f.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${f.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:t=>t.currentTarget.style.opacity="1",onMouseLeave:t=>t.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(te,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",f.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!B&&_.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),_.map((t,s)=>B?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>D(t.id),onMouseLeave:()=>D(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const a=_.filter((r,o)=>o!==s);p(a),re(a)},children:e.jsx("img",{src:t.avatar_url,alt:t.username})}),Y===t.id&&e.jsxs("div",{className:"insp-tooltip",children:[t.username," — click to remove"]})]},t.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>D(t.id),onMouseLeave:()=>D(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${t.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:t.avatar_url,alt:t.username})}),Y===t.id&&e.jsx("div",{className:"insp-tooltip",children:t.username})]},t.id)),B&&_.length<3&&new Array(3-_.length).fill(0).map((t,s)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>D(-s-1),onMouseLeave:()=>D(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{T(s),K(""),V([])},children:"+"}),Y===-s-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),E===s&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:h,onChange:a=>K(a.target.value)}),e.jsxs("div",{className:"insp-results",children:[Q.length===0&&h.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),Q.map(a=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(x&&Number(x.osu_user_id)===Number(a.id)){u("Kinda based, but no",{variant:"warn"}),T(null);return}if(_.some(o=>o.id===a.id)){T(null);return}const r=[..._,{id:a.id,username:a.username,avatar_url:a.avatar_url}].slice(0,3);p(r),T(null),re(r)},children:[e.jsx("img",{src:a.avatar_url,alt:"avatar"}),e.jsx("span",{children:a.username})]},a.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>T(null),children:"Close"})]})]},`slot-${s}`))]}),B&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:X||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),B?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:W,onChange:t=>C(t.target.value),rows:3,maxLength:300,placeholder:"Write something about yourself (max 300 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn compact",onClick:async()=>{var t;try{const s=((t=document.cookie.split("; ").map(r=>r.split("=")).find(([r])=>r==="csrf"))==null?void 0:t[1])||"",a=await fetch(`${k}/api/me`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":s},body:JSON.stringify({about:W})});if(a.ok){const r=await a.json();M(r.user||f),$(r.user||x)}}catch{}},children:"Save"})})]}):e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:((f==null?void 0:f.about)||"").trim()||"No bio."})]}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsxs("div",{className:"tabs",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"tab active","data-tab":"uploads",onClick:t=>{const s=t.currentTarget.parentElement;s.querySelectorAll(".tab").forEach(r=>{r.classList.remove("active"),r.setAttribute("aria-selected","false")}),t.currentTarget.classList.add("active"),t.currentTarget.setAttribute("aria-selected","true"),s.nextElementSibling.setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"tab","data-tab":"likes",onClick:t=>{const s=t.currentTarget.parentElement;s.querySelectorAll(".tab").forEach(r=>{r.classList.remove("active"),r.setAttribute("aria-selected","false")}),t.currentTarget.classList.add("active"),t.currentTarget.setAttribute("aria-selected","true"),s.nextElementSibling.setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:B?e.jsxs("div",{className:"scroll-panel sm",children:[S.length===0&&e.jsx("div",{className:"muted",children:"No uploads yet."}),S.map(t=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[t.poster_url?e.jsx("img",{src:t.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:t.description||"",children:t.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:[t.status.toUpperCase()," • ",new Date(t.created_at*1e3).toLocaleString()]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",children:t.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)"},children:"❤"}),e.jsx("button",{className:"btn secondary",onClick:()=>G(t),children:"Edit"}),e.jsx("button",{className:"btn",onClick:async()=>{var r;if(!confirm("Delete this video? This cannot be undone."))return;const s=((r=document.cookie.split("; ").map(o=>o.split("=")).find(([o])=>o==="csrf"))==null?void 0:r[1])||"";(await fetch(`${k}/api/videos/${t.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":s}})).ok?L(S.filter(o=>o.id!==t.id)):alert("Delete failed")},children:"Delete"})]})]},t.id))]}):e.jsx("div",{className:"scroll-panel sm",style:{marginTop:0},children:e.jsxs("div",{className:"recent-grid cols4",children:[y.length===0&&e.jsx("div",{className:"muted",children:"No uploads yet."}),y.map(t=>{var s,a;return e.jsxs("button",{className:"recent-cell",onClick:()=>I(t),children:[t.poster_url?e.jsx("img",{className:"recent-thumb",src:t.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((s=t.uploader)==null?void 0:s.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:t.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(a=t.uploader)==null?void 0:a.username})]})]},t.id)})]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"scroll-panel sm",style:{marginTop:0},children:e.jsxs("div",{className:"recent-grid cols4",children:[c.length===0&&e.jsx("div",{className:"muted",children:"No likes yet."}),c.map(t=>{var s,a;return e.jsxs("button",{className:"recent-cell",onClick:()=>I(t),children:[t.poster_url?e.jsx("img",{className:"recent-thumb",src:t.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((s=t.uploader)==null?void 0:s.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:t.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(a=t.uploader)==null?void 0:a.username})]})]},t.id)})]})})})]})]}),U&&e.jsx(we,{open:!!U,onClose:()=>G(null),videoId:U.id,initialDescription:U.description,initialBeatmapUrl:U.beatmap_url,onSave:(t,s)=>{L(S.map(a=>a.id===U.id?{...a,description:t||null,beatmap_url:s}:a)),G(null)}}),i&&e.jsxs(ye,{streamUID:z?null:i.stream_uid,playbackUrl:z?null:i.playback_url,aspectRatio:i!=null&&i.width&&(i!=null&&i.height)?i.width/i.height:16/9,onClose:()=>{I(null),l(!1)},beatmapDownloadUrl:z&&i.beatmapset_id?`${k}/api/osu/beatmapsets/${i.beatmapset_id}/download?noVideo=1`:null,beatmapId:z?i.beatmap_id??void 0:void 0,beatmapVersion:z?i.beatmap_version??void 0:void 0,onOpenInEditor:()=>{I(null),l(!1),window.location.hash="/editor"},headerLeft:e.jsxs(e.Fragment,{children:[((ne=i.uploader)==null?void 0:ne.avatar_url)&&e.jsx("img",{src:i.uploader.avatar_url,width:28,height:28,style:{borderRadius:"50%"}}),e.jsxs(ge,{to:`/profile/${(le=i.uploader)==null?void 0:le.id}`,style:{marginLeft:6,display:"inline-flex",alignItems:"center",gap:6,textDecoration:"none",color:"inherit",fontWeight:700},onClick:()=>{O(!1)},children:[e.jsx("span",{children:(oe=i.uploader)==null?void 0:oe.username}),i.is_starred?e.jsx(ve,{size:14,color:"#f59e0b",title:"Starred"}):null]})]}),headerRight:e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"views-badge","aria-label":"Views",title:"Views",children:[e.jsx(me,{size:12}),e.jsx("span",{children:i.views_count??0})]}),e.jsxs("button",{className:`chip-btn like ${i.liked_by_me?"liked":""}`,onClick:()=>de(i),children:[i.liked_by_me?e.jsx(he,{size:16}):e.jsx(be,{size:16}),e.jsx("span",{children:i.likes_count??0})]}),e.jsxs("button",{ref:P,className:"chip-btn report",onClick:()=>O(t=>!t),title:"Report","aria-label":"Report",children:[e.jsx(xe,{size:16}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Report"})]}),i.beatmap_url&&e.jsx("div",{children:e.jsxs("button",{ref:g,className:"chip-btn link",onClick:()=>d(t=>!t),title:"Beatmap options","aria-label":"Beatmap options",children:[e.jsx(te,{size:16}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(fe,{size:14,style:{marginLeft:4,opacity:.7}})]})}),e.jsxs(je,{open:A,onClose:()=>O(!1),buttonRef:P,minWidth:160,children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>ie(i,"unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>ie(i,"explicit"),children:"Explicit"})]})]}),children:[e.jsx("div",{className:"muted one-line",style:{marginTop:6},children:(i.description??"").trim()||"No description."}),i.beatmap_title&&e.jsxs("div",{style:{fontSize:12,color:"#7b8491",marginTop:8},children:[i.beatmap_artist," – ",i.beatmap_title," ",i.beatmap_mapper?`(by ${i.beatmap_mapper})`:""," ",i.beatmap_version?`[${i.beatmap_version}]`:""]})]}),v&&J&&(i==null?void 0:i.beatmap_url)&&e.jsxs("div",{ref:m,style:{position:"fixed",top:J.top,right:J.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:i.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>d(!1),children:[e.jsx(te,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),i.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:()=>{l(!0),d(!1)},children:"Preview"})]}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
        .recent-grid { display: grid; gap: 10px; }
        .recent-grid.cols4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        @media (max-width: 980px) { .recent-grid.cols4 { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        @media (max-width: 720px) { .recent-grid.cols4 { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
        /* Single column on very narrow phones for readability */
        @media (max-width: 420px) {
          .recent-grid { gap: 8px; }
          .recent-grid.cols4 { grid-template-columns: 1fr; }
        }
        .recent-cell { position: relative; background: #0f1217; border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 0; overflow: hidden; cursor: pointer; text-decoration: none; color: inherit; }
        .recent-thumb { display: block; width: 100%; aspect-ratio: 16 / 9; object-fit: cover; }
        .thumb-fallback { width: 100%; aspect-ratio: 16 / 9; background: #0b0d10; }
        .cell-footer { position: absolute; left: 8px; bottom: 8px; display: inline-flex; align-items: center; gap: 6px; padding: 4px 6px; border-radius: 9999px; background: rgba(0,0,0,0.45); backdrop-filter: blur(2px); max-width: calc(100% - 16px); flex-wrap: wrap; }
        .cell-avatar { width: 18px; height: 18px; border-radius: 50%; display: inline-block; object-fit: cover; }
        .cell-name { font-size: 12px; color: #e5e7eb; word-break: break-word; }
        /* Segmented tabs tucked above content */
        .tabs-content { padding: 4px 0 0 0; border: none; }
        .tabs-content[data-active="uploads"] .panel.uploads { display: block; }
        .tabs-content[data-active="uploads"] .panel.likes { display: none; }
        .tabs-content[data-active="likes"] .panel.uploads { display: none; }
        .tabs-content[data-active="likes"] .panel.likes { display: block; }
      `})]})}export{Le as default};
