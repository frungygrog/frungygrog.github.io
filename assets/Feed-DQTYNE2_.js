import{N as M,u as S,n as C,r as f,j as a}from"./vendor-react-C7NF2CWg.js";import{P as F}from"./Post-xERaYiSO.js";import{C as L}from"./Compose-DNfmFxHl.js";import{d as y,e as v,A as E,a as U}from"./index-4noqHToJ.js";import"./vendor-RuoRctBR.js";import"./Popup-CoSBxWSJ.js";import"./editor-lib-BiYBlHYf.js";import"./beatmap-preview-zeCbv474.js";import"./editor-components-CZPSM51n.js";function D(){const{data:p}=y(),{modeFilters:u}=v(),h=Object.entries(u).filter(([t,i])=>i).map(([t])=>t),m=h.length?h.join(","):"standard";return M({queryKey:["mappi","feed",m],queryFn:async({pageParam:t=0})=>{const i=new URLSearchParams({limit:"20",offset:String(t),modes:m}),l=`${E.feed.recent}?${i.toString()}`;return await U(l)},enabled:!!p,initialPageParam:0,getNextPageParam:(t,i)=>{var d;const l=i.reduce((o,g)=>{var c;return o+(((c=g.items)==null?void 0:c.length)||0)},0);return(((d=t.items)==null?void 0:d.length)||0)===20?l:void 0}})}function K(){const p=S(),u=C(),{data:h}=y(),{modeFilters:m}=v(),{data:t,fetchNextPage:i,hasNextPage:l,isFetching:x,isFetchingNextPage:d,refetch:o}=D(),g=f.useMemo(()=>(t==null?void 0:t.pages.flatMap(e=>e.items||[]))||[],[t]),c=f.useMemo(()=>{const e=Object.entries(m).filter(([n,r])=>r).map(([n])=>n.toLowerCase()),s=new Set(e.length?e:["standard"]);return g.filter(n=>{const r=String(n.mode||"standard").toLowerCase();return s.has(r)})},[g,m]);f.useEffect(()=>{p.pathname==="/mp/feed"&&o()},[p.pathname,o]),f.useEffect(()=>{const e=()=>{o()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[o]);const j=e=>{u.setQueryData(["mappi","feed"],s=>s&&{...s,pages:s.pages.map(n=>({...n,items:n.items.map(r=>r.id===e.id?e:r)}))})},N=e=>{u.setQueryData(["mappi","feed"],s=>s&&{...s,pages:s.pages.map(n=>({...n,items:n.items.filter(r=>r.id!==e)}))})},P=()=>{o()},b=x&&!d,w=l??!1;return a.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[a.jsxs("div",{className:"feed-header",children:[a.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),a.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),a.jsx(L,{section:"mappi",onUpload:P})]}),a.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:a.jsxs("div",{className:"col",style:{gap:0},children:[c.length===0&&!b&&a.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),c.map(e=>a.jsx(F,{post:e,section:"mappi",onUpdate:j,onDelete:N,me:h},e.id)),c.length>0&&w&&a.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:a.jsx("button",{className:"btn secondary",onClick:()=>i(),disabled:d,children:d?"Loading...":"Load more"})})]})})]})}export{K as default};
