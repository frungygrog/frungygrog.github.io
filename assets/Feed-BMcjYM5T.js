import{K as M,g as S,e as C,r as f,j as n}from"./vendor-react-_vsaDC62.js";import{P as F}from"./Post-C7M61VxW.js";import{C as L}from"./Compose-BA5fbP2p.js";import{a as y,b as v,A as E,c as U}from"./index-DvC4W1nG.js";import"./vendor-DBgzFpze.js";import"./Popup-9yj3qj3-.js";import"./editor-lib-Cf56EpaA.js";import"./beatmap-preview-Da_UNwHS.js";import"./editor-components-CKFEosPJ.js";function D(){const{data:p}=y(),{modeFilters:u}=v(),g=Object.entries(u).filter(([t,i])=>i).map(([t])=>t),m=g.length?g.join(","):"standard";return M({queryKey:["mappi","feed",m],queryFn:async({pageParam:t=0})=>{const i=new URLSearchParams({limit:"20",offset:String(t),modes:m}),l=`${E.feed.recent}?${i.toString()}`;return await U(l)},enabled:!!p,initialPageParam:0,getNextPageParam:(t,i)=>{var d;const l=i.reduce((o,h)=>{var c;return o+(((c=h.items)==null?void 0:c.length)||0)},0);return(((d=t.items)==null?void 0:d.length)||0)===20?l:void 0}})}function _(){const p=S(),u=C(),{data:g}=y(),{modeFilters:m}=v(),{data:t,fetchNextPage:i,hasNextPage:l,isFetching:x,isFetchingNextPage:d,refetch:o}=D(),h=f.useMemo(()=>(t==null?void 0:t.pages.flatMap(e=>e.items||[]))||[],[t]),c=f.useMemo(()=>{const e=Object.entries(m).filter(([a,r])=>r).map(([a])=>a.toLowerCase()),s=new Set(e.length?e:["standard"]);return h.filter(a=>{const r=String(a.mode||"standard").toLowerCase();return s.has(r)})},[h,m]);f.useEffect(()=>{p.pathname==="/mp/feed"&&o()},[p.pathname,o]),f.useEffect(()=>{const e=()=>{o()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[o]);const j=e=>{u.setQueryData(["mappi","feed"],s=>s&&{...s,pages:s.pages.map(a=>({...a,items:a.items.map(r=>r.id===e.id?e:r)}))})},P=e=>{u.setQueryData(["mappi","feed"],s=>s&&{...s,pages:s.pages.map(a=>({...a,items:a.items.filter(r=>r.id!==e)}))})},b=()=>{o()},N=x&&!d,w=l??!1;return n.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[n.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),n.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),n.jsx(L,{section:"mappi",onUpload:b}),n.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:n.jsxs("div",{className:"col",style:{gap:0},children:[c.length===0&&!N&&n.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),c.map(e=>n.jsx(F,{post:e,section:"mappi",onUpdate:j,onDelete:P,me:g},e.id)),c.length>0&&w&&n.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:n.jsx("button",{className:"btn secondary",onClick:()=>i(),disabled:d,children:d?"Loading...":"Load more"})})]})})]})}export{_ as default};
