import{r as j,j as e,V as S,F as z}from"./vendor-react-B1K9M2rd.js";import{P as C}from"./Popup-CGiG0mjy.js";import{u as F}from"./index-fPOTE-EV.js";const v="https://api.osumappi.ng";function M(t){var r;return(r=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s===t))==null?void 0:r[1]}function $({comment:t,replies:r,me:s,onReply:u,onDelete:g,replyingTo:x,replyText:o,onReplyTextChange:n,onReplySubmit:f,posting:d,onCancelReply:l,section:h}){const[m,c]=j.useState(!1),b=j.useRef(null),{notify:p}=F(),k=s&&(s.id===t.user_id||s.is_admin||s.is_mod),y=async()=>{if(confirm("Delete this comment?"))try{const i=M("csrf")||"",a=h==="mappi"?`${v}/api/videos/${t.post_id}/comments/${t.id}`:`${v}/api/moddiposts/${t.post_id}/comments/${t.id}`;(await fetch(a,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":i}})).ok?(g(t.id),p("Comment deleted",{variant:"success"})):p("Failed to delete comment",{variant:"error"})}catch{p("Failed to delete comment",{variant:"error"})}finally{c(!1)}};return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease"},onMouseEnter:i=>i.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:i=>i.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:13,fontWeight:500},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(t.created_at*1e3).toLocaleDateString()})]}),e.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:t.text}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:e.jsxs("button",{onClick:()=>u(t.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[e.jsx(S,{size:14}),"Reply"]})}),x===t.id&&s&&e.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("form",{onSubmit:f,style:{display:"flex",alignItems:"flex-end",gap:6},children:[e.jsx("textarea",{placeholder:`Reply to ${t.username}...`,value:o||"",onChange:i=>n==null?void 0:n(i.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:i=>{const a=i.target;a.style.height="auto",a.style.height=`${Math.min(a.scrollHeight,100)}px`},autoFocus:!0}),e.jsx("button",{type:"submit",className:"btn compact",disabled:d||!(o!=null&&o.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:d?"...":"Reply"}),l&&e.jsx("button",{type:"button",onClick:l,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid rgba(255,255,255,0.12)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),k&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:b,className:"icon-link",onClick:()=>c(!m),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:e.jsx(z,{size:16})}),e.jsx(C,{open:m,onClose:()=>c(!1),buttonRef:b,children:e.jsx("button",{className:"menu-item",onClick:y,style:{color:"var(--danger)"},children:"Delete"})})]})]}),r.length>0&&e.jsx("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid rgba(255,255,255,0.06)"},children:r.map(i=>e.jsx($,{comment:i,replies:[],me:s,onReply:u,onDelete:g,replyingTo:x,replyText:o,onReplyTextChange:n,onReplySubmit:f,posting:d,onCancelReply:l,section:h},i.id))})]})}export{$ as C};
