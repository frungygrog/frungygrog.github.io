var Ot=Object.defineProperty;var Yt=(t,l,i)=>l in t?Ot(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i;var gt=(t,l,i)=>Yt(t,typeof l!="symbol"?l+"":l,i);import{r as s,j as e,e as Le,u as $e,R as M,q as Et,d as st,U as Qt,V as bt,W as Vt,L as K,X as Jt,Y as Gt,O as _t,Z as Kt,_ as vt,P as at,K as Xt,A as It,h as Lt,C as yt,Q as Zt,S as es,G as ts,c as rt,I as ss,l as Tt,$ as ns,a0 as jt,a1 as wt,z as as,v as is,b as rs,a as os,i as Mt,g as Rt,k as it,a2 as ls,a3 as kt,o as cs,x as ds,a4 as us,a5 as ms,a6 as ps,a7 as hs,a8 as ce}from"./vendor-react-Ccgyt8W9.js";import{y as fs}from"./vendor-B6aJEIoy.js";import{u as Re,a as F,A as R,c as Ge,i as he,P as xs,b as Ie,d as gs,C as bs,e as vs,T as ys,f as js}from"./mappi-routes-BNmuAYnk.js";import{u as Te,a as zt,b as At,c as He,d as ws,e as ks,f as Ns,g as Ss,h as Cs,C as Es,M as _s,i as Is,P as Ls,Q as Ts,j as Ms,N as Rs}from"./moddi-routes-C1vegHhZ.js";import{b as zs,a as As,i as Ds,c as Fs,H as Ps}from"./editor-components-DzFQ_Vv6.js";import{B as Ws,s as Hs,E as Bs}from"./editor-DSW_kwMi.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-CGhQYZoD.js";import"./vendor-zip-DufM7ybf.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))r(p);new MutationObserver(p=>{for(const c of p)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function i(p){const c={};return p.integrity&&(c.integrity=p.integrity),p.referrerPolicy&&(c.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?c.credentials="include":p.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(p){if(p.ep)return;p.ep=!0;const c=i(p);fetch(p.href,c)}})();const qs=new fs({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Us extends s.Component{constructor(i){super(i);gt(this,"handleRetry",()=>{const i=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),i&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,r){console.error("ErrorBoundary caught an error:",i,r)}isChunkLoadingError(i){if(!i)return!1;const r=i.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||i.name==="ChunkLoadError"}render(){var i;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),p=((i=this.state.error)==null?void 0:i.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":p}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const ye=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function $s({i:t}){const l=t*1337,i=(L,h)=>{const y=Math.sin(l+L+h)*1e4,b=y-Math.floor(y);return Math.floor(b*(h-L+1)+L)},r=i(0,100),p=i(24,50),c=.7+i(0,100)/100*.3,v=p*c,k=i(0,4e3),x=i(-10,10),E=i(-8,8),g=i(0,100),_=g<60?1:g<80?1.5:2,I=[{size:200*_,alpha:.06,dx:-22,dy:12,color:ye[i(0,ye.length-1)]},{size:150*_,alpha:.08,dx:-9,dy:7,color:ye[i(0,ye.length-1)]},{size:120*_,alpha:.1,dx:0,dy:0,color:ye[i(0,ye.length-1)]},{size:90*_,alpha:.12,dx:12,dy:-4,color:ye[i(0,ye.length-1)]},{size:64*_,alpha:.13,dx:20,dy:-7,color:ye[i(0,ye.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${v}s`,animationDelay:`${k}ms`,"--tx":`${x}vw`,transform:`rotate(${E}deg)`},children:I.map((L,h)=>e.jsx("svg",{width:L.size,height:L.size,viewBox:"0 0 100 100",style:{left:`${50+L.dx}%`,bottom:`${L.dy}px`,transform:"translateX(-50%)","--alpha":L.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:L.color})},h))})}function Dt({paused:t=!1}){const l=s.useMemo(()=>new Array(20).fill(0).map((i,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:l.map(i=>e.jsx($s,{i},i))})}function Os(){const t=Le(),l=$e(),{lastSection:i,previousLocation:r,setPreviousLocation:p}=Te(),c=M.useRef(null),v=M.useRef(!1),k=M.useRef(0),x=M.useRef(0),E=M.useRef(null),g=M.useRef(null),_=M.useRef(!1),I=300,L=2e3,h=M.useRef(null),y=M.useRef(null),b=M.useRef(null),[d,C]=M.useState(!1),[z,j]=M.useState(12),B=M.useRef(null),A=M.useRef(null),[u,H]=M.useState(!1),[U,X]=M.useState(12),[oe,Y]=M.useState([]),[ie,de]=M.useState(""),q=M.useRef(null),te=M.useRef(null),[se,f]=M.useState(!1),[W,P]=M.useState(12),[$,fe]=M.useState(null),xe=M.useCallback(()=>{if(!y.current)return;const N=y.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Q=160;let O=N.left;O+Q+8>V&&(O=Math.max(8,V-Q-8)),O=Math.max(8,O),j(O)},[]),a=M.useCallback(()=>{if(!B.current)return;const N=B.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Q=220;let O=N.left;O+Q+8>V&&(O=Math.max(8,V-Q-8)),O=Math.max(8,O),X(O)},[]),T=M.useCallback(()=>{if(!q.current)return;const N=q.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Q=280;let O=N.left;O+Q+8>V&&(O=Math.max(8,V-Q-8)),O=Math.max(8,O),P(O)},[]);M.useEffect(()=>()=>{c.current&&clearTimeout(c.current),E.current&&clearTimeout(E.current),g.current&&clearTimeout(g.current)},[]),M.useEffect(()=>{if(!d)return;const N=V=>{const Q=V.target;b.current&&!b.current.contains(Q)&&y.current&&!y.current.contains(Q)&&C(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[d]),M.useEffect(()=>{if(!u)return;const N=V=>{const Q=V.target;A.current&&!A.current.contains(Q)&&B.current&&!B.current.contains(Q)&&H(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[u]),M.useEffect(()=>{if(!se)return;const N=V=>{const Q=V.target;te.current&&!te.current.contains(Q)&&q.current&&!q.current.contains(Q)&&f(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[se]),M.useEffect(()=>{if(!d)return;xe();const N=()=>xe();return window.addEventListener("resize",N),window.addEventListener("orientationchange",N),()=>{window.removeEventListener("resize",N),window.removeEventListener("orientationchange",N)}},[d,xe]),M.useEffect(()=>{if(!u)return;a();const N=()=>a();return window.addEventListener("resize",N),window.addEventListener("orientationchange",N),()=>{window.removeEventListener("resize",N),window.removeEventListener("orientationchange",N)}},[u,a]),M.useEffect(()=>{if(!se)return;T();const N=()=>T();return window.addEventListener("resize",N),window.addEventListener("orientationchange",N),()=>{window.removeEventListener("resize",N),window.removeEventListener("orientationchange",N)}},[se,T]);const le=t.pathname==="/"||t.pathname==="/about",ee=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!le&&t.pathname.startsWith("/md/");const re=t.pathname.startsWith("/md/")||!le&&!t.pathname.startsWith("/mp/")&&i==="moddi";M.useEffect(()=>{if(!ee)return;const N=Q=>{const O=Q.detail||{},Pe=Array.isArray(O.items)?O.items:[];Y(Pe),de(String(O.selected||""))},V=Q=>{const O=Q.detail||{};fe({title:String(O.title||""),artist:String(O.artist||""),mapper:String(O.mapper||""),version:String(O.version||""),beatmapId:Number(O.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",N),window.addEventListener("editor:info",V),()=>{window.removeEventListener("editor:difficulty:list",N),window.removeEventListener("editor:info",V)}},[ee]);const ze=zt();if(le)return null;const Ce=()=>{l(r||(i==="moddi"?"/md/feed":"/mp/feed"))},Oe=()=>{C(N=>!N)},Ye=()=>{var N;C(!1),(N=h.current)==null||N.click()},Z=()=>{H(N=>!N)},Qe=N=>{H(!1),de(N),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:N}}))},Ae=()=>{f(N=>!N)};if(ee)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"file",accept:".osz,.zip",onChange:N=>{var Q;const V=(Q=N.target.files)==null?void 0:Q[0];V&&window.dispatchEvent(new CustomEvent("editor:file",{detail:V}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Ce,"aria-label":"Back",title:"Go back",children:e.jsx(Et,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:y,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Oe,"aria-label":"File",title:"File menu","aria-expanded":d,children:e.jsx(Qt,{size:20})}),d&&st.createPortal(e.jsx("div",{ref:b,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${z}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:Ye,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:Ce,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[oe.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:B,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Z,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":u,children:e.jsx(bt,{size:20})}),u&&st.createPortal(e.jsx("div",{ref:A,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${U}px`,minWidth:220},children:oe.map(N=>{const V=N.mode==="taiko"?zs:N.mode==="mania"?As:N.mode==="catch"?Ds:Fs;return e.jsxs("button",{className:`mode-option ${ie===N.path?"selected":""}`,type:"button",onClick:()=>Qe(N.path),children:[e.jsx("img",{className:"mode-icon",src:V,width:24,height:24,alt:""}),e.jsx("span",{children:N.version||"(Untitled)"})]},N.path)})}),document.body)]}),$&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:q,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Ae,"aria-label":"Map Info",title:"Map Info","aria-expanded":se,children:e.jsx(Vt,{size:20})}),se&&st.createPortal(e.jsx("div",{ref:te,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${W}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[$.artist||"Artist"," – ",$.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",$.mapper||"Unknown"]}),$.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",$.version]}),$.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${$.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]});const De=()=>{const N=Date.now();if(k.current>0){const V=N-k.current;if(V<I&&V>0){E.current&&(clearTimeout(E.current),E.current=null),g.current&&(clearTimeout(g.current),g.current=null),c.current&&(clearTimeout(c.current),c.current=null),x.current=N+L,k.current=0,v.current=!1,p(t.pathname),l("/editor");return}}N<x.current&&k.current===0||(E.current&&(clearTimeout(E.current),E.current=null),g.current&&(clearTimeout(g.current),g.current=null),k.current=N,g.current=setTimeout(()=>{g.current!==null&&(l(re?"/mp/feed":"/md/feed"),g.current=null)},I),E.current=setTimeout(()=>{k.current>0&&(k.current=0,x.current=Date.now()+L),E.current=null},I))},Fe=()=>{v.current=!1,c.current=setTimeout(()=>{v.current=!0,l("/")},500)},Me=()=>{c.current&&(clearTimeout(c.current),c.current=null),v.current&&setTimeout(()=>{v.current=!1},100)},Be=N=>{if(_.current){N.preventDefault(),N.stopPropagation(),_.current=!1;return}if(v.current){N.preventDefault(),N.stopPropagation();return}De()},qe=N=>{if(Me(),v.current){N.preventDefault(),_.current=!0;return}N.preventDefault(),De(),_.current=!0,setTimeout(()=>{_.current=!1},I+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(K,{to:re?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(bt,{size:20})}),re?e.jsx(K,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Jt,{size:20})}):e.jsx(K,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Gt,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:Be,onTouchStart:Fe,onTouchEnd:qe,onMouseDown:Fe,onMouseUp:Me,onMouseLeave:Me,"aria-label":re?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:re?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:re?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(K,{to:"/md/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/md/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(_t,{size:20}),ze>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>l("/settings"),"aria-label":"Settings",children:e.jsx(Kt,{size:20})})]})]})}function Ys({isModdi:t,onClick:l}){return e.jsxs("button",{onClick:l,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:t?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:t?"osu!mappi.ng":"osu!moddi.ng"})]})}function Qs({isNeutralPage:t,isEditor:l,isModdi:i,isMappi:r,onCoinFlipClick:p}){return t?e.jsx(K,{to:"/",className:"title",children:i?"osu!moddi.ng":r?"osu!mappi.ng":"mappi!"}):l?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(K,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(vt,{size:18})}),e.jsx(K,{to:i?"/md/feed":"/mp/feed",className:"title",children:"osu!editi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(K,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(vt,{size:18})}),e.jsx(Ys,{isModdi:i,onClick:p})]})}function Vs({isNeutralPage:t,isMappi:l,isModdi:i}){const r=Le();return e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[t&&e.jsx(K,{to:r.pathname==="/"?"/about":"/",className:r.pathname==="/about"?"active":"",children:r.pathname==="/"?"About":"Home"}),l&&e.jsxs(e.Fragment,{children:[e.jsx(K,{to:"/mp/feed",className:r.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(K,{to:"/mp/discover",className:r.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(K,{to:"/editor",className:r.pathname==="/editor"?"active":"",children:"Editor"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(K,{to:"/md/feed",className:r.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(K,{to:"/md/queues",className:r.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!l&&!i&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(K,{to:"/mp/feed",className:r.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(K,{to:"/mp/discover",className:r.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(K,{to:"/editor",className:r.pathname==="/editor"?"active":"",children:"Editor"})]})]})}function Js(t,l,i,r){const p=$e(),{notify:c}=Re(),[v,k]=s.useState(new Set);return{parseQueueInvite:h=>{if(!h)return null;try{const y=JSON.parse(h);if((y==null?void 0:y.type)==="queue_invite"&&(y!=null&&y.queue_id))return y}catch{}return null},handleAcceptInvite:async(h,y)=>{if(!v.has(h.id)){k(b=>new Set(b).add(h.id));try{await F(R.moddi.queueAccept(String(y)),{method:"POST"}),c("Invitation accepted!",{variant:"success"}),i.mutate(h.id),r(!1),p(`/md/queues/${y}`)}catch(b){c((b==null?void 0:b.message)||"Failed to accept invitation",{variant:"error"})}finally{k(b=>{const d=new Set(b);return d.delete(h.id),d})}}},handleDenyInvite:async(h,y)=>{if(!v.has(h.id)){k(b=>new Set(b).add(h.id));try{await F(R.moddi.queueDeny(String(y)),{method:"POST"}),c("Invitation declined",{variant:"success"}),i.mutate(h.id)}catch(b){c((b==null?void 0:b.message)||"Failed to decline invitation",{variant:"error"})}finally{k(b=>{const d=new Set(b);return d.delete(h.id),d})}}},handleMarkAllRead:async()=>{const h=t.filter(y=>y.id.startsWith("n:")||y.kind==="system"&&!y.read).map(y=>y.id);h.length>0&&l.mutate(h)},handleNotificationClick:async h=>{if(r(!1),l.mutate([h.id]),h.kind==="system"||h.id.startsWith("n:"))try{await F(R.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[h.id]})})}catch{}},handleDeleteNotification:async(h,y)=>{h.stopPropagation(),i.mutate(y)},processing:v}}function Gs({notifications:t,unreadCount:l,notifOpen:i,setNotifOpen:r,markReadMutation:p,deleteNotificationMutation:c,closeAllPanels:v}){const k=s.useRef(null),x=s.useRef(null),{parseQueueInvite:E,handleAcceptInvite:g,handleDenyInvite:_,handleMarkAllRead:I,handleNotificationClick:L,handleDeleteNotification:h,processing:y}=Js(t,p,c,r);At(k,x,i,()=>r(!1));const b=t.filter(d=>!(d.kind==="system"&&d.id.startsWith("b:")&&(d.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:k,className:"icon-link",onClick:()=>{i||v(),r(!i)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(_t,{size:18})}),l>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),i&&e.jsxs("div",{ref:x,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(K,{to:"/md/notifications",onClick:()=>r(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:d=>d.currentTarget.style.opacity="1",onMouseLeave:d=>d.currentTarget.style.opacity="0.7",children:"View all"}),b.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:I,children:e.jsx(at,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[b.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),b.map(d=>{const C=E(d.text),z=d.id.startsWith("b:"),j=C?"queue-invite":d.kind==="star"?"star":d.kind==="likes5"?"likes":d.kind==="comment"?"comment":d.kind==="inspiration"?"inspiration":d.kind==="reaction"?"reaction":z?"global":"system",B=d.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${j}`,role:"button",onClick:()=>!C&&L(d),children:[e.jsxs("div",{className:`notif-icon ${B?"deletable":""}`,"aria-hidden":"true",onClick:B&&!C?A=>h(A,d.id):void 0,title:B&&!C?"Remove":void 0,role:B&&!C?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:C?e.jsx(Xt,{}):j==="star"?e.jsx(It,{}):j==="likes"?e.jsx(Lt,{}):j==="comment"?e.jsx(yt,{}):j==="inspiration"?e.jsx(yt,{}):j==="reaction"?e.jsx(Zt,{}):j==="global"?e.jsx(es,{}):null}),B&&!C?e.jsx("span",{className:"swap-trash",children:e.jsx(ts,{})}):null]}),e.jsx("div",{className:"notif-body",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[C.inviter_username," invited you to join queue: ",C.queue_name]}),y.has(d.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:A=>{A.stopPropagation(),g(d,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(at,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:A=>{A.stopPropagation(),_(d,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(rt,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):d.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:z?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:d.text||""}),z&&d.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(d.expiresAt).toLocaleString()]}):null]}):d.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:d.text||"Someone commented on your post"})]}):d.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:d.text||"Someone is inspired by you!"})]}):d.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:d.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:d.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:d.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},d.id)})]})]})]})}function Ks({quota:t,nowTick:l}){if(!(t!=null&&t.blocked))return null;const i=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),r=Math.floor(i/3600),p=Math.floor(i%3600/60),c=i%60,v=x=>String(x).padStart(2,"0"),k=r>0?`${r}:${v(p)}:${v(c)}`:`${p}:${v(c)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(ss,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:k})]})}function Xs({me:t,menuOpen:l,setMenuOpen:i,onLogout:r,closeAllPanels:p}){const c=s.useRef(null),v=s.useRef(null);return At(c,v,l,()=>i(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:c,className:"icon-link",onClick:()=>{l||p(),i(!l)},title:t.username,"aria-label":"User menu","aria-expanded":l,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(Tt,{size:14,style:{opacity:.8}})]}),l&&e.jsxs("div",{ref:v,className:"menu-panel",role:"menu",children:[e.jsx(K,{to:"/profile",className:"menu-item",onClick:()=>i(!1),children:"Profile"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(K,{to:"/moderation",className:"menu-item",onClick:()=>i(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:r,children:"Log out"})]})]})}function Zs({isNeutralPage:t,isEditor:l,isMappi:i,isModdi:r,onCoinFlipClick:p}){const c=Le(),{data:v,isLoading:k}=He(),{data:x}=ws(!!v),{data:E=[]}=ks(!!v),g=zt(),_=Ns(),I=Ss(),L=Cs(),{menuOpen:h,notifOpen:y,setMenuOpen:b,setNotifOpen:d,closeAllPanels:C}=Te(),[z,j]=M.useState(0);return M.useEffect(()=>{const B=setInterval(()=>j(A=>A+1),1e3);return()=>clearInterval(B)},[]),e.jsxs("header",{className:"top-nav",children:[e.jsx(Qs,{isNeutralPage:t,isEditor:l,isModdi:r,isMappi:i,onCoinFlipClick:p}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),c.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Ps,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{isNeutralPage:t,isMappi:i,isModdi:r}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(ns,{size:18})}),v?e.jsxs("div",{className:"user-menu",children:[e.jsx(Gs,{notifications:E,unreadCount:g,notifOpen:y,setNotifOpen:d,markReadMutation:I,deleteNotificationMutation:L,closeAllPanels:C}),e.jsx(Ks,{quota:x,nowTick:z}),e.jsx(Xs,{me:v,menuOpen:h,setMenuOpen:b,onLogout:()=>_.mutate(),closeAllPanels:C})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Ge+R.auth.login},disabled:k,children:k?"Checking…":"Login with osu!"})]})]})}function en({title:t,onRefresh:l}){const{data:i}=He(),r=Le(),p=$e(),{lastSection:c}=Te(),[v,k]=M.useState(!0),[x,E]=M.useState(0),[g,_]=M.useState(!1),I=M.useRef(!1),L=M.useRef(0);M.useEffect(()=>{const b=document.querySelector(".page");if(!b)return;let d=b.scrollTop,C=!1;const z=()=>{C||(C=!0,requestAnimationFrame(()=>{const j=b.scrollTop,B=j-d;j<=12||B<-12?k(!0):B>12&&k(!1),d=j,C=!1}))};return b.addEventListener("scroll",z,{passive:!0}),()=>b.removeEventListener("scroll",z)},[]),M.useEffect(()=>{const b=document.querySelector(".page");if(!b)return;const d=120,C=70,z=u=>{var H;g||(b.scrollTop<=0?(I.current=!0,L.current=((H=u.touches[0])==null?void 0:H.clientY)??0):I.current=!1)},j=u=>{var X;if(!I.current||g)return;const H=((X=u.touches[0])==null?void 0:X.clientY)??0,U=Math.max(0,H-L.current);if(U>0){const oe=Math.min(d,U*.5);E(oe)}},B=async()=>{try{if(_(!0),l)await l();else{window.location.reload();return}}finally{setTimeout(()=>{_(!1),E(0)},400)}},A=()=>{!I.current||g||(x>=C?B():E(0),I.current=!1)};return b.addEventListener("touchstart",z,{passive:!0}),b.addEventListener("touchmove",j,{passive:!0}),b.addEventListener("touchend",A),b.addEventListener("touchcancel",A),()=>{b.removeEventListener("touchstart",z),b.removeEventListener("touchmove",j),b.removeEventListener("touchend",A),b.removeEventListener("touchcancel",A)}},[x,g,l]);const{showBack:h,onBack:y}=M.useMemo(()=>{const b=r.pathname;if(/^\/mp\/feed\/.+/.test(b))return{showBack:!0,onBack:()=>p("/mp/feed")};if(/^\/md\/feed\/.+/.test(b))return{showBack:!0,onBack:()=>p("/md/feed")};if(/^\/md\/queues\/.+/.test(b))return{showBack:!0,onBack:()=>p("/md/queues")};if(b==="/profile"||b.startsWith("/profile/")){const d=c==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?p(-1):p(d)}}}return{showBack:!1,onBack:()=>{}}},[r.pathname,p,c]);return e.jsxs("div",{className:`mobile-page-header ${v?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${v?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:h?e.jsx("button",{className:"icon-link",onClick:y,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Et,{size:18})}):e.jsx(K,{to:"/profile",className:"icon-link","aria-label":"Profile",children:i!=null&&i.avatar_url?e.jsx("img",{src:i.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"rgba(255,255,255,0.2)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:g||x>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(x,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${g?"spin":x>60?"ready":""}`})})]})}function tn({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function sn(){const t=Le(),{lastSection:l}=Te(),i=t.pathname==="/"||t.pathname==="/about",r=t.pathname==="/editor",p=t.pathname.startsWith("/mp/")||!i&&!t.pathname.startsWith("/md/")&&l==="mappi",c=t.pathname.startsWith("/md/")||!i&&!t.pathname.startsWith("/mp/")&&l==="moddi",v=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";return{isNeutralPage:i,isEditor:r,isMappi:p,isModdi:c,isQueueDetail:v}}function nn(t){const l=$e(),i=Le(),{setPreviousLocation:r}=Te(),p=s.useRef(0),c=s.useRef(0),v=s.useRef(null),k=500,x=2e3;return s.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]),g=>{g.preventDefault();const _=Date.now();if(!(_<c.current)){if(v.current&&p.current>0){const I=_-p.current;if(I<k&&I>0){clearTimeout(v.current),v.current=null,c.current=_+x,p.current=0,r(i.pathname),l("/editor");return}}v.current&&(clearTimeout(v.current),v.current=null),p.current=_,v.current=setTimeout(()=>{c.current=Date.now()+x,v.current=null,p.current=0,l(t?"/mp/feed":"/md/feed")},k)}}}function an(){const t=Le(),{notify:l}=Re(),{data:i}=He(),{lastSection:r,setLastSection:p}=Te(),{isNeutralPage:c,isEditor:v,isMappi:k,isModdi:x}=sn(),E=nn(x);M.useEffect(()=>{t.pathname.startsWith("/mp/")?p("mappi"):t.pathname.startsWith("/md/")&&p("moddi")},[t.pathname,p]);const[g,_]=M.useState(null);M.useEffect(()=>{!i||!i.is_mod||(async()=>{try{const h=await F(R.admin.debugState,{requireAuth:!1}),y=Array.isArray(h==null?void 0:h.counts)?h.counts.find(b=>String(b.status)==="ready"):null;y&&_(Number(y.c)||0)}catch{}})()},[i]),M.useEffect(()=>{i&&!localStorage.getItem("welcomed")&&(l(`Welcome, ${i.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[i,l]),M.useEffect(()=>{if(typeof window>"u"||!he()||t.pathname==="/editor")return;const y=document.querySelector(".page");y&&(y.scrollTop=0)},[t.pathname]);const{showMobileHeader:I,headerTitle:L}=M.useMemo(()=>{const h=t.pathname;if(h==="/"||h==="/about"||h==="/editor"||h==="/mp/discover")return{showMobileHeader:!1,headerTitle:""};const y=h.split("/").filter(Boolean),b=y[0]||"",d=y[1]||"";if(b==="mp"){if(d==="discover")return{showMobileHeader:!0,headerTitle:"Discover"};if(d==="feed")return{showMobileHeader:!0,headerTitle:y.length>2?"Post":"Feed"}}if(b==="md"){if(d==="feed")return{showMobileHeader:!0,headerTitle:y.length>2?"Post":"Feed"};if(d==="queues")return{showMobileHeader:!0,headerTitle:y.length>2?"Queue":"Queues"};if(d==="notifications")return{showMobileHeader:!0,headerTitle:"Notifications"}}return b==="profile"?{showMobileHeader:!0,headerTitle:"Profile"}:h==="/settings"?{showMobileHeader:!0,headerTitle:"Settings"}:h==="/moderation"?{showMobileHeader:!0,headerTitle:"Moderation"}:{showMobileHeader:!0,headerTitle:""}},[t.pathname]);return e.jsxs("div",{className:"app-shell","data-section":x?"moddi":k?"mappi":r==="moddi"?"moddi":r==="mappi"?"mappi":void 0,children:[e.jsx(Dt,{paused:t.pathname==="/editor"}),e.jsx(Zs,{isNeutralPage:c,isEditor:v,isMappi:k,isModdi:x,onCoinFlipClick:E}),e.jsxs("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:[I&&e.jsx(en,{title:L}),t.pathname==="/about"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(jt,{})}):e.jsx(jt,{})]}),t.pathname!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(tn,{readyCount:g})}),e.jsx(Os,{})]})}function rn(){const{notify:t}=Re(),[l,i]=s.useState(!1),[r,p]=s.useState(null),c=s.useRef(!1);return s.useEffect(()=>{if(!("serviceWorker"in navigator))return;const v=()=>{navigator.serviceWorker.getRegistration().then(k=>{k&&(setInterval(()=>{k.update()},5*60*1e3),k.addEventListener("updatefound",()=>{const x=k.installing;x&&x.addEventListener("statechange",()=>{x.state==="installed"&&navigator.serviceWorker.controller&&!c.current&&(p(x),i(!0),t("Update available! Reload to get the latest version.",{durationMs:15e3,variant:"info"}))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{c.current||window.location.reload()}))})};navigator.serviceWorker.controller?v():navigator.serviceWorker.ready.then(()=>{v()})},[t]),s.useEffect(()=>{if(l&&r){const v=()=>{c.current=!0,r.postMessage({type:"SKIP_WAITING"}),window.location.reload()},k=()=>{v(),document.removeEventListener("click",k),document.removeEventListener("touchstart",k)},x=setTimeout(()=>{v()},1e4);return document.addEventListener("click",k,{once:!0}),document.addEventListener("touchstart",k,{once:!0}),()=>{clearTimeout(x),document.removeEventListener("click",k),document.removeEventListener("touchstart",k)}}},[l,r]),null}function on(){const{data:t,isLoading:l}=He(),{notify:i}=Re(),r=!!t,[p,c]=s.useState(null),[v,k]=s.useState(!1),[x,E]=s.useState(!1),[g,_]=s.useState(!1);s.useEffect(()=>{const h=()=>{const d=he()||window.matchMedia("(max-width: 768px)").matches;k(d);const C=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;_(C);const z=window.matchMedia("(display-mode: standalone)").matches,j=window.navigator.standalone===!0||z;E(j)};h();const y=window.matchMedia("(max-width: 768px)"),b=()=>h();return y.addEventListener("change",b),window.addEventListener("resize",b),()=>{y.removeEventListener("change",b),window.removeEventListener("resize",b)}},[]),s.useEffect(()=>{const h=y=>{y.preventDefault(),c(y)};return window.addEventListener("beforeinstallprompt",h),()=>{window.removeEventListener("beforeinstallprompt",h)}},[]);const I=async()=>{if(g){i('Tap the share button (□↑) at the bottom, then select "Add to Home Screen"',{durationMs:8e3,variant:"info"});return}if(p){p.prompt();const{outcome:h}=await p.userChoice;h==="accepted"&&(E(!0),i("App installed successfully!",{variant:"success"})),c(null)}else i("Install prompt not available. Please use your browser's menu to install.",{variant:"info"})},L=v&&!x;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        .pwa-install-button {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
          
          .pwa-install-button {
            display: flex;
          }
        }
        
        .pwa-install-button {
          margin-top: 12px;
          padding: 14px 20px;
          background: rgba(125, 211, 252, 0.1);
          border: 1px solid rgba(125, 211, 252, 0.3);
          border-radius: 12px;
          color: #7dd3fc;
          font-size: 15px;
          font-weight: 600;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
          cursor: pointer;
          transition: all 0.2s ease;
          text-decoration: none;
          width: 100%;
        }
        
        .pwa-install-button:hover {
          background: rgba(125, 211, 252, 0.15);
          border-color: rgba(125, 211, 252, 0.4);
          transform: translateY(-1px);
        }
        
        .pwa-install-button:active {
          transform: translateY(0);
        }
        
        .pwa-install-button svg {
          width: 18px;
          height: 18px;
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!r&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),r&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions landing-actions-desktop",children:[e.jsx(K,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(K,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]}),!r&&e.jsxs("div",{className:"landing-actions landing-actions-mobile",children:[e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Ge+R.auth.login},disabled:l,children:l?"Checking…":"Login with osu!"}),L&&e.jsxs("button",{className:"pwa-install-button",onClick:I,children:[e.jsx(wt,{}),g?"Add to Home Screen":"Install App"]})]}),r&&e.jsxs("div",{className:"landing-actions landing-actions-mobile",children:[e.jsx(K,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(K,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"}),L&&e.jsxs("button",{className:"pwa-install-button",onClick:I,children:[e.jsx(wt,{}),g?"Add to Home Screen":"Install App"]})]})]})]})]})}function ln(){const{data:t}=He(),{modeFilters:l}=Te(),i=Object.entries(l).filter(([p,c])=>c).map(([p])=>p),r=i.length?i.join(","):"standard";return as({queryKey:["mappi","feed",r],queryFn:async({pageParam:p=0})=>{const c=new URLSearchParams({limit:"20",offset:String(p),modes:r}),v=`${R.feed.recent}?${c.toString()}`;return await F(v)},enabled:!!t,initialPageParam:0,getNextPageParam:(p,c)=>{var x;const v=c.reduce((E,g)=>{var _;return E+(((_=g.items)==null?void 0:_.length)||0)},0);return(((x=p.items)==null?void 0:x.length)||0)===20?v:void 0}})}function cn(){const t=Le(),l=is(),{data:i}=He(),{modeFilters:r}=Te(),{data:p,fetchNextPage:c,hasNextPage:v,isFetching:k,isFetchingNextPage:x,refetch:E}=ln(),g=s.useMemo(()=>(p==null?void 0:p.pages.flatMap(d=>d.items||[]))||[],[p]),_=s.useMemo(()=>{const d=Object.entries(r).filter(([z,j])=>j).map(([z])=>z.toLowerCase()),C=new Set(d.length?d:["standard"]);return g.filter(z=>{const j=String(z.mode||"standard").toLowerCase();return C.has(j)})},[g,r]);s.useEffect(()=>{t.pathname==="/mp/feed"&&E()},[t.pathname,E]),s.useEffect(()=>{const d=()=>{E()};return window.addEventListener("filterchange",d),()=>window.removeEventListener("filterchange",d)},[E]);const I=d=>{l.setQueryData(["mappi","feed"],C=>C&&{...C,pages:C.pages.map(z=>({...z,items:z.items.map(j=>j.id===d.id?d:j)}))})},L=d=>{l.setQueryData(["mappi","feed"],C=>C&&{...C,pages:C.pages.map(z=>({...z,items:z.items.filter(j=>j.id!==d)}))})},h=()=>{E()},y=k&&!x,b=v??!1;return e.jsxs("div",{className:"feed-container mappi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(Es,{section:"mappi",onUpload:h})]}),e.jsx(_s,{section:"mappi",onUpload:h}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[_.length===0&&!y&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),_.map(d=>e.jsx(xs,{post:d,section:"mappi",onUpdate:I,onDelete:L,me:i},d.id)),_.length>0&&b&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>c(),disabled:x,children:x?"Loading...":"Load more"})})]})})]})}const pe={};function dn(){try{const t=localStorage.getItem("feed_seen_ids");if(t){const l=JSON.parse(t);Array.isArray(l)&&(pe.seenIds=l.filter(i=>typeof i=="number"))}}catch{}return pe}function Nt(t){Object.assign(pe,t);try{const l=Array.from(new Set(pe.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(l))}catch{}}function un(){var ht,ft,xt;const{notify:t}=Re(),[l,i]=s.useState(pe.history||[]),[r,p]=s.useState(pe.index??-1),[c,v]=s.useState(pe.queue||[]),[k,x]=s.useState(!1),[E,g]=s.useState(!1),[_,I]=s.useState(pe.eligibleCount??null),[L,h]=s.useState(pe.viewedCount??0),[y,b]=s.useState(!1),[d,C]=s.useState(!0),[z,j]=s.useState(!1),[B,A]=s.useState(!1),[u,H]=s.useState(!1),[U,X]=s.useState(!1),[oe,Y]=s.useState(!1),[ie,de]=s.useState([]),[q,te]=s.useState(""),[se,f]=s.useState(null),[W,P]=s.useState(!1),[$,fe]=s.useState(null),[xe,a]=s.useState(!1),T=s.useRef(new Set(pe.seenIds||[])),le=s.useRef(new Set),ee=s.useRef(!1),re=s.useRef(pe.lastShownVideoId??null),ze=s.useRef(!1),Ce=s.useRef(0),Oe=s.useRef(0),Ye=s.useRef(0),Z=s.useRef(null),Qe=s.useRef(null),Ae=s.useRef(null),De=s.useRef(null),Fe=s.useRef(null),Me=s.useRef(null),Be=s.useRef(null),qe=s.useRef(null),N=s.useRef(0),V=s.useRef(0),Q=s.useRef(null),O=s.useRef(null),[Pe,Ft]=s.useState(0),we=s.useRef(null),o=s.useMemo(()=>r>=0?l[r]:null,[l,r]);s.useEffect(()=>{dn()},[]),s.useEffect(()=>{Nt({history:l,index:r,queue:c,seenIds:Array.from(T.current),eligibleCount:_??void 0,viewedCount:L,lastShownVideoId:re.current??void 0})},[l,r,c,_,L]);const ke=s.useCallback(()=>{try{const n=localStorage.getItem("filter_modes"),m=(n?String(n):"standard").toLowerCase().split(",").map(D=>D.trim()).filter(Boolean),w=["standard","taiko","mania","catch"],S=Array.from(new Set(m.filter(D=>w.includes(D))));return S.length?S:["standard"]}catch{return["standard"]}},[]),ot=s.useCallback(()=>{const n=new Set;return re.current!==null&&n.add(re.current),Array.from(T.current).slice(-200).forEach(w=>n.add(w)),c.forEach(w=>n.add(w.id)),Array.from(n)},[c]),Ke=s.useCallback(async(n=3)=>{var S,D,J,be;if(ee.current)return[];const m=Date.now();if(m<Ce.current){const ae=Math.ceil((Ce.current-m)/1e3);return t(`Rate limited. Please wait ${ae}s.`,{durationMs:3e3,variant:"warn"}),[]}const w=m-Ye.current;if(w<2e3){const ae=2e3-w;await new Promise(_e=>setTimeout(_e,ae))}ee.current=!0,Ye.current=Date.now();try{const ae=ot(),_e=ke().join(","),ve=[],Ne=new Set(c.map(ue=>ue.id));let Se=[...ae];const tt=Math.min(n,3);for(let ue=0;ue<tt;ue++){if(ue>0){const G=Date.now()-Oe.current,ne=1e3;G<ne&&await new Promise(me=>setTimeout(me,ne-G))}try{Oe.current=Date.now();const G=await F(R.feed.next+Ie({exclude:Se.join(","),modes:_e}),{requireAuth:!1}),ne=G&&("id"in G?G:G.video)||null;if(!ne)break;if(T.current.has(ne.id)||Ne.has(ne.id)||ne.id===re.current){Se.push(ne.id);continue}ve.push(ne),Se.push(ne.id),Ne.add(ne.id)}catch(G){if((S=G==null?void 0:G.message)!=null&&S.includes("401")||(D=G==null?void 0:G.message)!=null&&D.includes("Unauthorized")){b(!0);break}else if((J=G==null?void 0:G.message)!=null&&J.includes("429")||(be=G==null?void 0:G.message)!=null&&be.includes("rate limit")){Ce.current=Date.now()+5e3,t("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(ve.length>0&&v(ue=>{const G=new Set(ue.map(me=>me.id)),ne=ve.filter(me=>!G.has(me.id));return[...ue,...ne]}),ve.length===0&&c.length===0)try{const ue=ke().join(","),G=await F(R.feed.progress(ue),{requireAuth:!1});I(Number(G.eligible||0)),h(Number(G.viewed||0)),g(Number(G.caught_up||0)===1)}catch{}return ve}catch{return[]}finally{ee.current=!1}},[ot,ke,c,t]),ge=s.useCallback(async()=>{if(!k){x(!0);try{c.length<=2&&Ke(3).catch(()=>{});let n;if(c.length>0)n=c[0],v(m=>m.filter(w=>w.id!==n.id));else{const m=await Ke(3);m.length>0&&(n=m[0],m.length>1&&v(w=>{const S=new Set(w.map(J=>J.id)),D=m.slice(1).filter(J=>!S.has(J.id));return[...w,...D]}))}if(n)re.current=n.id,T.current.add(n.id),Nt({seenIds:Array.from(T.current)}),i(m=>{const w=[...m.slice(0,r+1),n];return p(w.length-1),w}),le.current.has(n.id)||(le.current.add(n.id),F(R.videos.view(n.id),{method:"POST"}).then(m=>{m&&i(w=>{const S=[...w],D=S.findIndex(J=>J.id===n.id);return D!==-1&&(S[D]={...S[D],views_count:m.views_count??S[D].views_count??0,viewed_by_me:!0}),S})}).catch(()=>{}));else try{const m=ke().join(","),w=await F(R.feed.progress(m),{requireAuth:!1});I(Number(w.eligible||0)),h(Number(w.viewed||0)),g(Number(w.eligible||0)>0&&Number(w.viewed||0)>=Number(w.eligible||0))}catch{}}finally{x(!1)}}},[k,c,Ke,r,ke]),Pt=s.useCallback(()=>{Z.current&&!Z.current.paused&&Z.current.pause(),j(!0),Y(!1)},[]),Xe=s.useCallback(()=>{r>0&&(p(r-1),j(!1))},[r]),Ze=s.useCallback(()=>{const n=Date.now();if(!(n-V.current<300)){if(V.current=n,d||(ze.current=!0,C(!1)),r<l.length-1){const m=l[r+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:r,nextIndex:r+1,currentVideoId:o==null?void 0:o.id,nextVideoId:m==null?void 0:m.id,nextVideoStreamUID:m==null?void 0:m.stream_uid}),m&&(re.current=m.id),p(r+1),j(!1);return}if(!E){if(Date.now()<Ce.current){const m=Math.ceil((Ce.current-Date.now())/1e3);t(`Rate limited. Please wait ${m}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),ge()}}},[r,l,d,E,ge,t,o]);s.useEffect(()=>{const n=Qe.current;if(!n)return;const m=D=>{if(y||Math.abs(D.deltaY)<Math.abs(D.deltaX))return;D.preventDefault(),D.stopPropagation();const J=Date.now();if(!(J<N.current)){if(N.current=J+1e3,!o){D.deltaY>0&&!k&&ge();return}D.deltaY>0?Ze():Xe()}},w=D=>{Q.current=D.touches[0].clientY,O.current=Date.now()},S=D=>{if(y||Q.current===null||O.current===null)return;const J=D.changedTouches[0].clientY,be=Date.now(),ae=Q.current-J,_e=be-O.current;if(Q.current=null,O.current=null,Math.abs(ae)<50||_e>300)return;const ve=Date.now();if(!(ve<N.current)){if(N.current=ve+1e3,!o){ae>0&&!k&&ge();return}ae>0?Ze():Xe()}};return n.addEventListener("wheel",m,{passive:!1,capture:!0}),n.addEventListener("touchstart",w,{passive:!0}),n.addEventListener("touchend",S,{passive:!0}),window.addEventListener("wheel",m,{passive:!1,capture:!0}),()=>{n.removeEventListener("wheel",m,{capture:!0}),n.removeEventListener("touchstart",w),n.removeEventListener("touchend",S),window.removeEventListener("wheel",m,{capture:!0})}},[Ze,Xe,o,k,ge,y]);const Wt=s.useCallback(async()=>{var n,m;if(!(!o||xe)){a(!0);try{const w=o.liked_by_me?"DELETE":"POST",S=await F(R.videos.like(o.id),{method:w});i(D=>{const J=[...D],be=J.findIndex(ae=>ae.id===o.id);return be!==-1&&(J[be]={...J[be],liked_by_me:!o.liked_by_me,likes_count:S.likes_count}),J})}catch(w){((n=w==null?void 0:w.message)!=null&&n.includes("429")||(m=w==null?void 0:w.message)!=null&&m.includes("rate limit"))&&t("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{a(!1)}}},[o,xe,t]),lt=s.useCallback(async n=>{if(o)try{await F(R.videos.flag(o.id),{method:"POST",body:JSON.stringify({reason:n})}),t("Thanks for your report.",{variant:"info"})}catch{t("Report failed",{variant:"error"})}finally{H(!1)}},[o,t]),Ht=s.useCallback(async()=>{if(!o)return;const n=!o.is_starred,m=n?"star":"unstar";try{await F(R.admin.videosAction(o.id,m),{method:"POST"}),i(w=>{const S=[...w],D=S.findIndex(J=>J.id===o.id);return D!==-1&&(S[D]={...S[D],is_starred:n}),S}),X(!1),t(n?"Post starred":"Star removed",{variant:"success"})}catch{t("Action failed",{variant:"error"})}},[o,t]),ct=s.useCallback(async()=>{if(!(!o||!confirm("Permanently delete this video?")))try{await F(R.videos.delete(o.id),{method:"DELETE"}),t("Deleted",{variant:"warn"}),H(!1),i(n=>{const m=n.filter((w,S)=>S!==r);return m.length===0?(p(-1),setTimeout(ge,0)):p(w=>Math.max(0,Math.min(w,m.length-1))),m})}catch{alert("Delete failed")}},[o,r,ge,t]),Ve=s.useCallback(async()=>{if(o!=null&&o.id)try{const n=await F(R.videos.comments(o.id),{requireAuth:!1});de(n.items||[])}catch{}},[o==null?void 0:o.id]);s.useEffect(()=>{B&&(o!=null&&o.id)&&Ve()},[B,o==null?void 0:o.id,Ve]);const dt=s.useCallback(async n=>{if(n.preventDefault(),!(!q.trim()||!(o!=null&&o.id))){P(!0);try{await F(R.videos.comments(o.id),{method:"POST",body:JSON.stringify({text:q.trim(),parent_id:se||void 0})}),te(""),f(null),Ve(),i(m=>{const w=[...m],S=w.findIndex(D=>D.id===o.id);return S!==-1&&(w[S]={...w[S],comments_count:(w[S].comments_count||0)+1}),w}),t("Comment posted!",{variant:"success"})}catch(m){t((m==null?void 0:m.message)||"Failed to post comment",{variant:"error"})}finally{P(!1)}}},[q,o,se,Ve,t]),Bt=s.useCallback(n=>{de(m=>m.filter(w=>w.id!==n)),i(m=>{const w=[...m],S=w.findIndex(D=>D.id===(o==null?void 0:o.id));return S!==-1&&(w[S]={...w[S],comments_count:Math.max(0,(w[S].comments_count||0)-1)}),w})},[o==null?void 0:o.id]),{topLevelComments:ut,repliesMap:mt}=s.useMemo(()=>{const n=ie.filter(w=>!w.parent_id),m=new Map;return ie.filter(w=>w.parent_id).forEach(w=>{const S=w.parent_id;m.has(S)||m.set(S,[]),m.get(S).push(w)}),{topLevelComments:n,repliesMap:m}},[ie]),qt=s.useCallback(()=>{if(!Z.current)return;const n=!d;C(n),Z.current.muted=n,n||(ze.current=!0),!n&&Z.current.paused&&Z.current.play().catch(()=>{})},[d]),Je=s.useCallback(async()=>{if(he()&&"wakeLock"in navigator)try{we.current&&(await we.current.release(),we.current=null);const m=await navigator.wakeLock.request("screen");we.current=m,m.addEventListener("release",()=>{we.current=null})}catch(n){console.debug("Wake lock request failed:",n)}},[]),We=s.useCallback(async()=>{if(we.current)try{await we.current.release(),we.current=null}catch{we.current=null}},[]),Ut=s.useCallback(n=>{const m=Z.current;m&&(m.removeEventListener("play",et),m.removeEventListener("pause",Ue),m.removeEventListener("ended",Ue)),Z.current=n,n?(n.muted=d,n.addEventListener("play",et),n.addEventListener("pause",Ue),n.addEventListener("ended",Ue),n.paused||Je()):We()},[d,et,Ue,Je,We]),et=s.useCallback(()=>{Je()},[Je]),Ue=s.useCallback(()=>{We()},[We]);s.useEffect(()=>{j(!1),A(!1),ze.current?C(!1):C(!0)},[o==null?void 0:o.id,o==null?void 0:o.stream_uid,r,l.length]),s.useEffect(()=>{Z.current&&(Z.current.muted=d)},[d]),s.useEffect(()=>{if(!o)return;const n=!ze.current;C(n);const m=setTimeout(()=>{Z.current&&(Z.current.muted=n)},100);return()=>clearTimeout(m)},[o==null?void 0:o.id]),s.useEffect(()=>{o&&(re.current=o.id)},[o==null?void 0:o.id]),s.useEffect(()=>{z&&Z.current&&!Z.current.paused&&Z.current.pause()},[z]),s.useEffect(()=>()=>{We()},[We]),s.useEffect(()=>{l.length===0&&ge()},[]),s.useEffect(()=>{(async()=>{try{const n=ke().join(","),m=await F(R.feed.progress(n),{requireAuth:!1}),w=Number(m.eligible||0),S=Number(m.viewed||0);I(w),h(S),g(w>0&&S>=w)}catch{}})()},[ke]),s.useEffect(()=>{const n=()=>{i([]),v([]),T.current.clear(),re.current=null,p(-1),g(!1),(async()=>{try{const m=ke().join(","),w=await F(R.feed.progress(m),{requireAuth:!1}),S=Number(w.eligible||0),D=Number(w.viewed||0);I(S),h(D),g(!1)}catch{}ge()})()};return window.addEventListener("filterchange",n),()=>window.removeEventListener("filterchange",n)},[ke,ge]),s.useEffect(()=>{(async()=>{try{const n=await F(R.auth.me,{requireAuth:!1});fe(n)}catch{}})()},[]);const[Ee,$t]=s.useState(()=>typeof window<"u"?he():!1);s.useEffect(()=>{const n=()=>{const m=document.querySelector(".top-nav");m&&Ft(m.offsetHeight),$t(he())};return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),s.useEffect(()=>{var w;if(!Ae.current||!De.current||!o||!Z.current)return;const n=()=>{var _e;const S=(_e=De.current)==null?void 0:_e.querySelector("div"),D=Z.current;if(!S||!D||!Ae.current)return;const J=Ae.current,be=he();let ae;if(o.width&&o.height?ae=o.width/o.height:D.videoWidth>0&&D.videoHeight>0?ae=D.videoWidth/D.videoHeight:ae=16/9,be){const Ne=J.offsetWidth,Se=Ne/ae;S.style.width=`${Ne}px`,S.style.height=`${Se}px`,S.style.maxWidth="100%",S.style.maxHeight="100%"}else{const Ne=J.offsetWidth-32,Se=J.offsetHeight-32,tt=16/9,ue=Ne/tt;let ne=Math.min(Se,ue),me=ne*ae;me>Ne&&(me=Ne,ne=me/ae),ne>Se&&(ne=Se,me=ne*ae),S.style.width=`${me}px`,S.style.height=`${ne}px`,S.style.maxWidth="100%",S.style.maxHeight="100%"}},m=()=>{requestAnimationFrame(n)};if(Z.current.readyState>=1)n();else{const S=()=>{var D;n(),(D=Z.current)==null||D.removeEventListener("loadedmetadata",S)};(w=Z.current)==null||w.addEventListener("loadedmetadata",S)}return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}},[o==null?void 0:o.id,o==null?void 0:o.width,o==null?void 0:o.height]),s.useEffect(()=>{if(!u)return;const n=m=>{Fe.current&&!Fe.current.contains(m.target)&&H(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[u]),s.useEffect(()=>{if(!U)return;const n=m=>{Me.current&&!Me.current.contains(m.target)&&X(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[U]),s.useEffect(()=>{if(!oe)return;const n=m=>{Be.current&&!Be.current.contains(m.target)&&qe.current&&!qe.current.contains(m.target)&&Y(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[oe]);const pt=!!($!=null&&$.is_admin||$!=null&&$.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Dt,{paused:Ee}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
        /* Mobile-specific: ensure videos take full width */
        html.is-mobile .video-area .discover-player-wrapper > div,
        html.is-mobile .video-area .discover-player-wrapper > div[style] {
          min-width: 100% !important;
          max-width: 100% !important;
        }
      `}),e.jsxs("div",{ref:Qe,className:"player-wrap",style:{height:"100dvh",width:"100vw",position:"fixed",top:Ee?"calc(0px - env(safe-area-inset-top, 0px))":0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1,margin:0,padding:0,boxSizing:"border-box"},children:[E&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:Pe+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:Ae,className:"video-area discover-video-container",style:{position:"absolute",top:Ee?0:Pe,left:0,right:0,bottom:Ee?"-10px":0,maxHeight:Ee?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${Pe}px)`,height:Ee?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${Pe}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:Ee?"none":"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:Ee?"0":"16px",maxWidth:"100vw",width:"100%"},children:y?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=Ge+R.auth.login,children:"Login with osu!"})]}):o?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:qt,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:De,className:"discover-player-wrapper",children:e.jsx(gs,{streamUID:o.stream_uid,playbackUrl:o.playback_url,aspectRatio:o.width&&o.height?o.width/o.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:d,controls:!1,onVideoRef:Ut})}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:d?1:0,zIndex:2},children:d?e.jsx(rs,{size:28,color:"#fff"}):e.jsx(os,{size:28,color:"#fff"})})]})]})}):E?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"• Click video to toggle mute/unmute"}),e.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),o&&!z&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:n=>n.stopPropagation(),children:[e.jsx(K,{to:`/profile/${(ht=o.uploader)==null?void 0:ht.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(ft=o.uploader)!=null&&ft.avatar_url?e.jsx("img",{src:o.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:o.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:Wt,disabled:xe,"aria-label":o.liked_by_me?"Unlike":"Like",title:o.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:o.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:o.liked_by_me?e.jsx(Lt,{size:28}):e.jsx(Mt,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:o.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>A(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Rt,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:o.comments_count??0})]}),o.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:qe,onClick:()=>Y(n=>!n),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(it,{size:24})}),oe&&e.jsxs("div",{ref:Be,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:o.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>Y(!1),children:[e.jsx(it,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),o.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:Pt,children:"Preview"})]})]}),pt?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>X(n=>!n),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(kt,{size:24})}),U&&e.jsxs("div",{ref:Me,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:Ht,children:o.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:ct,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>H(n=>!n),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(ls,{size:24})}),u&&e.jsxs("div",{ref:Fe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>lt("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>lt("explicit"),children:"Explicit"}),pt&&e.jsx("button",{className:"menu-item",onClick:ct,children:"Delete video"})]})]}),o&&!z&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(K,{to:`/profile/${(xt=o.uploader)==null?void 0:xt.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var S,D,J;const n=(S=o.uploader)==null?void 0:S.is_admin,m=(D=o.uploader)==null?void 0:D.is_mod,w=n?"#fff3bf":m?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:w},children:["@",(J=o.uploader)==null?void 0:J.username]}),o.is_starred&&e.jsx(It,{size:16,color:"#f59e0b",title:"Starred"}),(n||m)&&e.jsx(kt,{size:14,color:w,title:n?"admin":"mod"})]})})()})}),(o.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:o.description}),o.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[o.beatmap_artist," – ",o.beatmap_title," ",o.beatmap_mapper?`(by ${o.beatmap_mapper})`:""," ",o.beatmap_version?`[${o.beatmap_version}]`:""]})]}),B&&o&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",o.comments_count??0,")"]}),e.jsx("button",{onClick:()=>A(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(rt,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:ut.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:ut.map(n=>e.jsx(bs,{comment:n,replies:mt.get(n.id)||[],me:$,section:"mappi",onReply:m=>f(m),onDelete:Bt,replyingTo:se,replyText:q,onReplyTextChange:te,onReplySubmit:dt,posting:W,onCancelReply:()=>{f(null),te("")},repliesMap:mt},n.id))})}),$&&!se&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:dt,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:q,onChange:n=>te(n.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:n=>{const m=n.target;m.style.height="auto",m.style.height=`${Math.min(m.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:W||!q.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:W?"...":"Post"})]})})]})]}),z&&(o==null?void 0:o.beatmapset_id)&&e.jsx(Ws,{open:z,onClose:()=>j(!1),downloadUrl:`${Ge}${R.osu.downloadBeatmapset(o.beatmapset_id)}`,beatmapId:o.beatmap_id??void 0,beatmapVersion:o.beatmap_version??void 0})]})]})}function St(t){if(!t)return"standard";const l=String(t).toLowerCase().trim();return l==="osu"||l==="0"||l==="standard"?"standard":l==="taiko"||l==="1"?"taiko":l==="catch"||l==="fruits"||l==="2"?"catch":l==="mania"||l==="3"?"mania":"standard"}const mn=({open:t,onClose:l,videoId:i,initialDescription:r,initialBeatmapUrl:p,onSave:c})=>{const[v,k]=s.useState(r||""),[x,E]=s.useState(p||""),[g,_]=s.useState(null),[I,L]=s.useState(null),[h,y]=s.useState(""),[b,d]=s.useState(!1),C=s.useRef(0);s.useEffect(()=>{t&&(k(r||""),E(p||""),_(null),L(null),y(""))},[t,r,p]),s.useEffect(()=>{if(!t)return;C.current&&window.clearTimeout(C.current);const j=(x||"").trim();if(!j){y(""),_(null),L(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(j)){y(""),_(null),L(null);return}return C.current=window.setTimeout(async()=>{var A;try{let u;try{u=new URL(j)}catch{y("Invalid URL format");return}const H=u.hash.match(/#osu\/(\d+)/),U=H?H[1]:null;u.hash="";const oe={url:u.toString()};U&&(oe.beatmap_id=U);const Y=await F(R.osu.resolveBeatmap+Ie(oe),{requireAuth:!1}),ie=Array.isArray(Y==null?void 0:Y.diffs)?Y.diffs:[];if(!ie.length&&!Y.setId){y("No difficulties found"),_(null),L(null);return}if(_({setId:Number(Y.setId)||0,beatmapId:Y.beatmapId??null,title:String(Y.title||""),artist:String(Y.artist||""),mapper:String(Y.mapper||""),diffs:ie}),ie.length>0){const de=Number.isFinite(Number(Y.beatmapId))?Number(Y.beatmapId):Number((A=ie[0])==null?void 0:A.id),q=ie.find(se=>Number(se.id)===de)||ie[0],te=St(q==null?void 0:q.mode);L({beatmapId:Number(q==null?void 0:q.id)||null,version:String((q==null?void 0:q.version)||""),mode:te})}y("")}catch(u){y(`Failed to resolve: ${(u==null?void 0:u.message)||"Unknown error"}`),_(null),L(null)}},400),()=>{C.current&&window.clearTimeout(C.current)}},[x,t]);const z=async()=>{if(!b){d(!0);try{await F(R.videos.update(i),{method:"PATCH",body:JSON.stringify({description:v.slice(0,100),beatmap_url:x.trim()||void 0})});const j=!!x.trim();if(g||!j)try{await F(R.videos.update(i)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:j&&g&&g.setId>0?g.setId:null,beatmap_id:j&&(I!=null&&I.beatmapId)?I.beatmapId:null,beatmap_version:j&&(I!=null&&I.version)?I.version:null,beatmap_title:j&&(g!=null&&g.title)?g.title:null,beatmap_artist:j&&(g!=null&&g.artist)?g.artist:null,beatmap_mapper:j&&(g!=null&&g.mapper)?g.mapper:null,beatmap_url:j?x.trim():null})})}catch(A){console.warn("Failed to update beatmap metadata:",A)}c(v,x.trim()||null),l()}catch(j){alert((j==null?void 0:j.message)||"Failed to update post")}finally{d(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:j=>j.target===j.currentTarget&&l(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:l}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:l,"aria-label":"Close",children:e.jsx(rt,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:v,onChange:j=>k(j.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),g?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[g.artist," – ",g.title]}),e.jsxs("span",{className:"muted",children:["by ",g.mapper]})]}),e.jsx("select",{value:(I==null?void 0:I.beatmapId)??g.beatmapId??void 0,onChange:j=>{const B=Number(j.target.value),A=(g==null?void 0:g.diffs.find(u=>Number(u.id)===B))||null;if(A){const u=St(A.mode);L({beatmapId:B,version:A.version,mode:u})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:g.diffs.map(j=>e.jsxs("option",{value:j.id,children:[j.version," (",j.mode,")"]},j.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{_(null),L(null),E("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:x,onChange:j=>E(j.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),h&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:h})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:l,disabled:b,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:z,disabled:b,children:b?"Saving...":"Save"})]})]})]})]}):null};function Ct(){const t=cs(),l=$e(),{notify:i}=Re(),[r,p]=s.useState(null),[c,v]=s.useState(null),[k,x]=s.useState(""),[E,g]=s.useState([]),[_,I]=s.useState([]),[L,h]=s.useState([]),[y,b]=s.useState(""),[d,C]=s.useState(null),[z,j]=s.useState([]),[B,A]=s.useState(null),[u,H]=s.useState(""),[U,X]=s.useState([]),[oe,Y]=s.useState(null),[ie,de]=s.useState(!1),q=s.useMemo(()=>{const f=t.id?Number(t.id):null;return f?r?r.id===f:!1:!0},[t.id,r]);function te(f){const W=f.stream_uid||String(f.id),P=t.id?`/profile/${t.id}`:"/profile";l(`/mp/feed/${W}`,{state:{returnTo:P}})}s.useEffect(()=>{(async()=>{try{const f=await F(R.auth.me,{requireAuth:!1});p(f),f&&Array.isArray(f.inspirations)&&j(f.inspirations)}catch(f){x((f==null?void 0:f.message)||"Not logged in")}})()},[]),s.useEffect(()=>{(async()=>{try{const f=t.id?Number(t.id):null;if(f){const W=await F(R.users.get(f),{requireAuth:!1});v(W),b(W.about||""),Array.isArray(W.inspirations)&&j(W.inspirations);const P=await F(R.users.videos(f)+Ie({limit:"60"}),{requireAuth:!1});h(P.items||[]);const $=await F(R.users.likes(f)+Ie({limit:"60"}),{requireAuth:!1});I($.items||[])}else{if(!r)return;v(r),b(r.about||""),Array.isArray(r.inspirations)&&j(r.inspirations);const W=await F(R.users.myVideos+Ie({limit:"50"}),{requireAuth:!1});g(W.items||[]);const P=await F(R.users.likes(r.id)+Ie({limit:"60"}),{requireAuth:!1});I(P.items||[])}}catch{}})()},[t.id,r]),s.useEffect(()=>{de(!1)},[c==null?void 0:c.id]);async function se(f){try{const P=(await F(R.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:f})})).user||c;v(P),Array.isArray(P==null?void 0:P.inspirations)&&j(P.inspirations),t.id||p(P)}catch{}}return s.useEffect(()=>{let f;return B!==null&&u.trim().length>=2?f=setTimeout(async()=>{try{const W=await F(R.osu.usersSearch(u),{requireAuth:!1});X(Array.isArray(W.items)?W.items:[])}catch{}},250):X([]),()=>{f&&clearTimeout(f)}},[u,B]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:c?e.jsxs(e.Fragment,{children:[c.avatar_url&&e.jsx("img",{src:c.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[c.username,c.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${c.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:f=>f.currentTarget.style.opacity="1",onMouseLeave:f=>f.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(it,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",c.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!q&&z.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),z.map((f,W)=>q?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Y(f.id),onMouseLeave:()=>Y(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const P=z.filter(($,fe)=>fe!==W);j(P),se(P)},children:e.jsx("img",{src:f.avatar_url,alt:f.username})}),oe===f.id&&e.jsxs("div",{className:"insp-tooltip",children:[f.username," — click to remove"]})]},f.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Y(f.id),onMouseLeave:()=>Y(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${f.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:f.avatar_url,alt:f.username})}),oe===f.id&&e.jsx("div",{className:"insp-tooltip",children:f.username})]},f.id)),q&&z.length<3&&new Array(3-z.length).fill(0).map((f,W)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Y(-W-1),onMouseLeave:()=>Y(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{A(W),H(""),X([])},children:"+"}),oe===-W-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),B===W&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:u,onChange:P=>H(P.target.value)}),e.jsxs("div",{className:"insp-results",children:[U.length===0&&u.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),U.map(P=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(P.id)){i("Kinda based, but no.",{variant:"warn"}),A(null);return}if(z.some(fe=>fe.id===P.id)){A(null);return}const $=[...z,{id:P.id,username:P.username,avatar_url:P.avatar_url}].slice(0,3);j($),A(null),se($)},children:[e.jsx("img",{src:P.avatar_url,alt:"avatar"}),e.jsx("span",{children:P.username})]},P.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>A(null),children:"Close"})]})]},`slot-${W}`))]}),q&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:k||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),q?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:y,onChange:f=>b(f.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const f=await F(R.auth.me,{method:"PATCH",body:JSON.stringify({about:y})});v(f.user||c),p(f.user||r)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(at,{size:16})})]})}):(()=>{const f=((c==null?void 0:c.about)||"").trim()||"No bio.",W=f.length>200,P=W&&!ie?f.slice(0,200)+"...":f;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:P}),W&&e.jsx("button",{onClick:()=>de(!ie),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:ie?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(ds,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Tt,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:f=>{const W=f.currentTarget.closest(".profile-tabs-unified");W.querySelectorAll(".profile-tab").forEach($=>{$.classList.remove("active"),$.setAttribute("aria-selected","false")}),f.currentTarget.classList.add("active"),f.currentTarget.setAttribute("aria-selected","true"),W.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:f=>{const W=f.currentTarget.closest(".profile-tabs-unified");W.querySelectorAll(".profile-tab").forEach($=>{$.classList.remove("active"),$.setAttribute("aria-selected","false")}),f.currentTarget.classList.add("active"),f.currentTarget.setAttribute("aria-selected","true"),W.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(q?E:L).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(q?E:L).map(f=>(q&&c?(c.id,c.username,c.avatar_url,c.is_admin,c.is_mod):f.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>te({...f}),children:[f.poster_url?e.jsx("img",{className:"recent-thumb",src:f.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Mt,{size:12}),e.jsx("span",{children:f.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Rt,{size:12}),e.jsx("span",{children:f.comments_count??0})]})]})})]},f.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[_.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),_.map(f=>{var W,P;return e.jsxs("button",{className:"recent-cell",onClick:()=>te(f),children:[f.poster_url?e.jsx("img",{className:"recent-thumb",src:f.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((W=f.uploader)==null?void 0:W.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:f.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(P=f.uploader)==null?void 0:P.username})]})]},f.id)})]})})})]})]}),d&&e.jsx(mn,{open:!!d,onClose:()=>C(null),videoId:d.id,initialDescription:d.description,initialBeatmapUrl:d.beatmap_url,onSave:(f,W)=>{g(E.map(P=>P.id===d.id?{...P,description:f||null,beatmap_url:W}:P)),C(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function pn(){var W,P,$,fe,xe;const[t,l]=s.useState(null),[i,r]=s.useState([]),[p,c]=s.useState(""),[v,k]=s.useState([]),[x,E]=s.useState(null),[g,_]=s.useState([]),[I,L]=s.useState("all"),[h,y]=s.useState("approvals"),[b,d]=s.useState(null),[C,z]=s.useState(""),[j,B]=s.useState(!1),{notify:A}=Re(),[u,H]=s.useState(null),[U,X]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const a=await F(R.auth.me,{requireAuth:!1});if(l(a),a!=null&&a.is_admin)try{const T=await F(R.admin.settingsModeration,{requireAuth:!1});d(!!T.require_approval)}catch{}}catch{}try{const a=await F(R.admin.videosPending+Ie({limit:"50"}),{requireAuth:!1});r(a.items||[])}catch{}})()},[]);async function oe(){X(!0);try{const a=await F(R.admin.analytics,{requireAuth:!1});H(a)}finally{X(!1)}}async function Y(){try{const a=await F(R.admin.usersSearch(p),{requireAuth:!1});k(a.items||[])}catch{}}async function ie(a){E(a),_([]);try{const T=await F(R.admin.userVideos(a.id)+Ie({limit:"50"}),{requireAuth:!1});_(T.items||[])}catch{}}async function de(a,T){try{const le=await F(R.admin.user(a.id),{method:"PATCH",body:JSON.stringify({is_mod:T})}),ee=(le==null?void 0:le.user)||{...a,is_mod:T};A(T?"Granted moderation":"Revoked moderation",{variant:T?"success":"warn"}),E(ee),k(v.map(re=>re.id===a.id?ee:re))}catch{alert("Failed to update")}}const q=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),te=!!(t!=null&&t.is_admin);if(!q)return e.jsx("div",{className:"muted",children:"You do not have access."});const se=i.filter(a=>!a.flagged_only),f=i.filter(a=>!!a.flagged_only);return e.jsx("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"muted moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:he()?"nowrap":"wrap",gap:he()?"2px":"4px",overflowX:he()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":h==="approvals",className:`profile-tab ${h==="approvals"?"active":""}`,"data-tab":"approvals",onClick:a=>{const T=a.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),y("approvals")},children:"Approvals"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":h==="manage",className:`profile-tab ${h==="manage"?"active":""}`,"data-tab":"manage",onClick:a=>{const T=a.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),y("manage")},children:"Manage"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":h==="analytics",className:`profile-tab ${h==="analytics"?"active":""}`,"data-tab":"analytics",onClick:a=>{const T=a.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),y("analytics"),u||oe()},children:"Analytics"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":h==="message",className:`profile-tab ${h==="message"?"active":""}`,"data-tab":"message",onClick:a=>{const T=a.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","message"),y("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":h,children:[e.jsx("div",{className:"panel approvals",hidden:h!=="approvals",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[se.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[se.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),se.map(a=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[a.poster_url?e.jsx("img",{src:a.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:a.description||"",children:a.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",a.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[a.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof a.flags_count=="number"&&a.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",a.flags_count," reports"]}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await F(R.admin.videosReject(a.id),{method:"POST"}),r(i.filter(T=>T.id!==a.id)),A("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await F(R.admin.videosApprove(a.id),{method:"POST"}),r(i.filter(T=>T.id!==a.id)),A("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await F(R.videos.delete(a.id),{method:"DELETE"}),r(i.filter(T=>T.id!==a.id)),A("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},a.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[f.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[f.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),f.map(a=>e.jsxs("div",{className:"col moderation-video-card flagged",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[a.poster_url?e.jsx("img",{src:a.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:a.description||"",children:a.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",a.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof a.flags_count=="number"&&a.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",a.flags_count," reports"]}):null]})]})]})]}),e.jsx("div",{className:"row",children:e.jsx("button",{className:"btn secondary",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await F(R.videos.delete(a.id),{method:"DELETE"}),r(i.filter(T=>T.id!==a.id)),A("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},a.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:h!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:p,onChange:a=>c(a.target.value),onKeyDown:a=>{a.key==="Enter"&&Y()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:Y,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:v.map(a=>e.jsxs("button",{className:"btn secondary moderation-user-result",onClick:()=>ie(a),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center"},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:a.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",a.id," • osu ",a.osu_user_id]})]}),a.is_admin?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"admin"}):a.is_mod?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"mod"}):a.is_blacklisted?e.jsx("span",{style:{color:"#f87171",fontSize:12,flexShrink:0},children:"blacklisted"}):null]},a.id))})})]}),x?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flexWrap:"wrap"},children:[x.avatar_url&&e.jsx("img",{src:x.avatar_url,width:40,height:40,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:4},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:x.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",x.id," • osu ",x.osu_user_id]})]})]}),e.jsxs("div",{className:"col",style:{gap:10},children:[te&&!x.is_admin&&(x.is_mod?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>de(x,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>de(x,!0),children:"Grant moderation"})),!x.is_admin&&(x.is_blacklisted?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await F(R.admin.user(x.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),E({...x,is_blacklisted:!1}),A("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await F(R.admin.user(x.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),E({...x,is_blacklisted:!0}),A("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),x.is_admin&&e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"})]}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>L("all"),children:"All"}),e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>L("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[g.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),g.filter(a=>{if(I==="all")return!0;const T=(b?!a.approved_at:!1)&&a.status==="ready",le=!!a.needs_review;return T||le}).map(a=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[a.poster_url?e.jsx("img",{src:a.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:a.description||"",children:a.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:[a.status.toUpperCase()," • ",new Date(a.created_at*1e3).toLocaleString()]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[a.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,b&&!a.approved_at&&a.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:14},children:a.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)",fontSize:16},children:"★"})]}),e.jsxs("div",{className:"row",style:{gap:8},children:[(te||(t==null?void 0:t.is_mod))&&(!!a.needs_review||b&&!a.approved_at&&a.status==="ready")&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await F(R.admin.videosApprove(a.id),{method:"POST"}),_(g.map(T=>T.id===a.id?{...T,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:T)),A("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await F(R.videos.delete(a.id),{method:"DELETE"}),_(g.filter(T=>T.id!==a.id)),A("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]})]},a.id))]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:h!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:p,onChange:a=>c(a.target.value),onKeyDown:a=>{a.key==="Enter"&&Y()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:Y,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:v.map(a=>e.jsxs("button",{className:`btn secondary moderation-user-result ${(x==null?void 0:x.id)===a.id,""}`,onClick:()=>E(a),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center",border:(x==null?void 0:x.id)===a.id?"2px solid var(--accent)":void 0},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:a.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",a.id," • osu ",a.osu_user_id]})]}),(x==null?void 0:x.id)===a.id&&e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"selected"})]},a.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:j,onChange:a=>B(a.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",width:"100%",fontSize:16,color:"inherit",fontFamily:"inherit"},value:C,onChange:a=>z(a.target.value)}),e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const a=(C||"").trim();if(!a){alert("Enter a message");return}(async()=>{try{const T={text:a,global:j};!j&&(x!=null&&x.id)&&(T.user_id=x.id),await F(R.admin.notificationsSystem,{method:"POST",body:JSON.stringify(T)}),z(""),A("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:h!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Analytics"}),U&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!U&&!u&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(je,{label:"Users",value:u.totals.users_total}),e.jsx(je,{label:"Admins",value:u.totals.users_admin}),e.jsx(je,{label:"Mods",value:u.totals.users_mod}),e.jsx(je,{label:"Blacklisted",value:u.totals.users_blacklisted}),e.jsx(je,{label:"Videos",value:u.totals.videos_total}),e.jsx(je,{label:"Ready",value:u.totals.videos_ready}),e.jsx(je,{label:"Pending",value:u.totals.pending_count}),e.jsx(je,{label:"Purgatory",value:u.totals.purgatory_count}),e.jsx(je,{label:"Likes",value:u.totals.likes_total}),e.jsx(je,{label:"Flags",value:u.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(nt,{title:"New users (30d)",series:u.series.users,color:"#60a5fa"}),e.jsx(nt,{title:"New videos (30d)",series:u.series.videos,color:"#34d399"}),((P=(W=u.stream)==null?void 0:W.graphql)==null?void 0:P.minutes_viewed)&&u.stream.graphql.minutes_viewed.length>0&&e.jsx(nt,{title:"Minutes viewed (30d)",series:u.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",u.feed.count," items in rotation",u.feed.cursor?` • cursor ${u.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",u.stream.approximate.total_duration_sec," • ready videos: ",u.stream.approximate.videos_ready]}),u.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",u.stream.api.ok?"ok":"unavailable",(fe=($=u.stream.api)==null?void 0:$.result_info)!=null&&fe.count?` • count ${u.stream.api.result_info.count}`:"",(xe=u.stream.api)!=null&&xe.sample_status?` • sample status ${String(u.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})})}function je({label:t,value:l}){return e.jsxs("div",{className:"col moderation-stat-card",children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",style:{fontSize:"clamp(18px, 4vw, 20px)"},children:l})]})}function nt({title:t,series:l,color:i}){const[r,p]=s.useState(()=>he());s.useEffect(()=>{const u=()=>p(he());return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const c=r?Math.min(400,window.innerWidth-48):400,v=160,k=8,x=8,E=28,g=r?36:42,_=l.map(u=>u.count),I=Math.max(1,..._),L=s.useMemo(()=>{const u=I,H=Math.pow(10,Math.floor(Math.log10(u))),U=u/H;return(U<=1?1:U<=2?2:U<=5?5:10)*H},[I]),h=c-g-x,y=v-k-E,b=s.useMemo(()=>l.map((u,H)=>{const U=g+H/Math.max(1,l.length-1)*h,X=k+(1-u.count/(L||1))*y;return[U,X]}),[l,L,h,y]),d=s.useMemo(()=>b.map((u,H)=>H===0?`M ${u[0]} ${u[1]}`:`L ${u[0]} ${u[1]}`).join(" "),[b]),C=[0,.25,.5,.75,1],z=s.useMemo(()=>{if(l.length===0)return[];const u=[0,.25,.5,.75,1].map(H=>Math.min(l.length-1,Math.round(H*(l.length-1))));return Array.from(new Set(u))},[l]),j=u=>{if(!u||u.length<10)return u||"";const H=u.slice(5,7).replace(/^0/,""),U=u.slice(8,10).replace(/^0/,"");return`${H}/${U}`};function B(u){const H=Number.isInteger(u);return u>=1e6?`${(u/1e6).toFixed(1).replace(/\.0$/,"")}M`:u>=1e3?`${(u/1e3).toFixed(1).replace(/\.0$/,"")}k`:H?String(u):u<10?u.toFixed(1):u.toFixed(1).replace(/\.0$/,"")}const A=l.length?l[l.length-1].count:0;return e.jsxs("div",{className:"col moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:r?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:r?11:12},children:["latest: ",B(A)]})]}),e.jsx("div",{style:{width:"100%",overflowX:"auto"},children:e.jsxs("svg",{width:c,height:v,role:"img","aria-label":t,style:{display:"block"},children:[e.jsx("rect",{x:0,y:0,width:c,height:v,fill:"#0f1217",rx:12}),C.map((u,H)=>{const U=k+(1-u)*y,X=u*L;return e.jsxs("g",{children:[e.jsx("line",{x1:g,y1:U,x2:c-x,y2:U,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:g-6,y:U+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:B(X)})]},H)}),e.jsx("line",{x1:g,y1:k,x2:g,y2:k+y,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:g,y1:k+y,x2:g+h,y2:k+y,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),z.map((u,H)=>{var X;const U=g+u/Math.max(1,l.length-1)*h;return e.jsxs("g",{children:[e.jsx("line",{x1:U,y1:k,x2:U,y2:k+y,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:U,y:k+y+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:j((X=l[u])==null?void 0:X.day)})]},H)}),e.jsx("path",{d,fill:"none",stroke:i,strokeWidth:2}),b.length>0&&e.jsx("circle",{cx:b[b.length-1][0],cy:b[b.length-1][1],r:3,fill:i})]})})]})}function hn(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function fn(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const xn=()=>(s.useEffect(()=>()=>{Hs.clearAll()},[]),e.jsx(Bs,{}));vs();const gn=()=>e.jsx(hs,{children:e.jsxs(ce,{element:e.jsx(an,{}),children:[e.jsx(ce,{path:"/",element:e.jsx(on,{})}),e.jsx(ce,{path:"/mp/discover",element:e.jsx(un,{})}),e.jsx(ce,{path:"/mp/feed",element:e.jsx(cn,{})}),e.jsx(ce,{path:"/mp/feed/:uid",element:e.jsx(js,{})}),e.jsx(ce,{path:"/md/feed",element:e.jsx(Is,{})}),e.jsx(ce,{path:"/md/feed/:uid",element:e.jsx(Ls,{})}),e.jsx(ce,{path:"/md/queues",element:e.jsx(Ts,{})}),e.jsx(ce,{path:"/md/queues/:id",element:e.jsx(Ms,{})}),e.jsx(ce,{path:"/md/notifications",element:e.jsx(Rs,{})}),e.jsx(ce,{path:"/profile",element:e.jsx(Ct,{})}),e.jsx(ce,{path:"/profile/:id",element:e.jsx(Ct,{})}),e.jsx(ce,{path:"/moderation",element:e.jsx(pn,{})}),e.jsx(ce,{path:"/about",element:e.jsx(hn,{})}),e.jsx(ce,{path:"/settings",element:e.jsx(fn,{})}),e.jsx(ce,{path:"/editor",element:e.jsx(xn,{})})]})}),bn=()=>e.jsx(ps,{children:e.jsx(gn,{})});us(document.getElementById("root")).render(e.jsx(Us,{children:e.jsx(ms,{client:qs,children:e.jsxs(ys,{children:[e.jsx(rn,{}),e.jsx(bn,{})]})})}));
