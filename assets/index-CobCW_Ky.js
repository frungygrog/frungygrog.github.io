const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-Ci3nqc5N.js","assets/vendor-react-DqNqwuWY.js","assets/vendor-M6eCzOHC.js","assets/mappi-routes-CwvX_Q61.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-CY0ku2pr.js","assets/beatmap-preview-UJHfA_TK.js","assets/vendor-zip-ZNmJmm24.js","assets/editor-CG1yLUbS.css","assets/moddi-routes-CwYgMTn8.js","assets/editor-components-DsOGSBXt.js","assets/editor-components-Bzmrvihl.css"])))=>i.map(i=>d[i]);
var $e=Object.defineProperty;var qe=(t,i,a)=>i in t?$e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a;var be=(t,i,a)=>qe(t,typeof i!="symbol"?i+"":i,a);import{r as y,j as e,e as ae,u as ce,R as k,q as Ce,d as me,U as Ue,V as ye,W as Oe,L as H,X as Qe,Y as Ye,O as Ee,Z as Je,_ as ve,P as he,K as Ve,A as Ge,h as Ke,C as je,Q as Xe,S as Ze,G as et,c as Te,I as tt,l as _e,$ as st,a0 as we,z as at,v as it,o as nt,k as rt,x as lt,i as ot,g as ct,a1 as dt,a2 as ut,a3 as mt,a4 as pt,a5 as Q}from"./vendor-react-DqNqwuWY.js";import{y as ht}from"./vendor-M6eCzOHC.js";import{u as de,a as I,A as z,c as Le,i as le,P as ft,b as ne,d as xt,T as gt,e as bt}from"./mappi-routes-CwvX_Q61.js";import{u as ie,a as Ae,b as ze,c as oe,d as yt,e as vt,f as jt,g as wt,h as Nt,C as kt,M as St,i as Ct,P as Et,Q as Tt,j as _t,N as Lt}from"./moddi-routes-CwYgMTn8.js";import{b as At,a as zt,i as Mt,c as It,H as Rt}from"./editor-components-DsOGSBXt.js";import{s as Ft,E as Pt}from"./editor-CY0ku2pr.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-UJHfA_TK.js";import"./vendor-zip-ZNmJmm24.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))r(m);new MutationObserver(m=>{for(const l of m)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function a(m){const l={};return m.integrity&&(l.integrity=m.integrity),m.referrerPolicy&&(l.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?l.credentials="include":m.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(m){if(m.ep)return;m.ep=!0;const l=a(m);fetch(m.href,l)}})();const Dt="modulepreload",Wt=function(t){return"/"+t},Ne={},Bt=function(i,a,r){let m=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),v=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));m=Promise.allSettled(a.map(c=>{if(c=Wt(c),c in Ne)return;Ne[c]=!0;const w=c.endsWith(".css"),p=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const j=document.createElement("link");if(j.rel=w?"stylesheet":Dt,w||(j.as="script"),j.crossOrigin="",j.href=c,v&&j.setAttribute("nonce",v),document.head.appendChild(j),w)return new Promise((S,C)=>{j.addEventListener("load",S),j.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(u){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=u,window.dispatchEvent(v),!v.defaultPrevented)throw u}return m.then(u=>{for(const v of u||[])v.status==="rejected"&&l(v.reason);return i().catch(l)})},Ht=new ht({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class $t extends y.Component{constructor(a){super(a);be(this,"handleRetry",()=>{const a=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),a&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r)}isChunkLoadingError(a){if(!a)return!1;const r=a.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||a.name==="ChunkLoadError"}render(){var a;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),m=((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":m}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const Z=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function qt({i:t}){const i=t*1337,a=(C,f)=>{const x=Math.sin(i+C+f)*1e4,h=x-Math.floor(x);return Math.floor(h*(f-C+1)+C)},r=a(0,100),m=a(24,50),l=.7+a(0,100)/100*.3,u=m*l,v=a(0,4e3),c=a(-10,10),w=a(-8,8),p=a(0,100),j=p<60?1:p<80?1.5:2,S=[{size:200*j,alpha:.06,dx:-22,dy:12,color:Z[a(0,Z.length-1)]},{size:150*j,alpha:.08,dx:-9,dy:7,color:Z[a(0,Z.length-1)]},{size:120*j,alpha:.1,dx:0,dy:0,color:Z[a(0,Z.length-1)]},{size:90*j,alpha:.12,dx:12,dy:-4,color:Z[a(0,Z.length-1)]},{size:64*j,alpha:.13,dx:20,dy:-7,color:Z[a(0,Z.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${u}s`,animationDelay:`${v}ms`,"--tx":`${c}vw`,transform:`rotate(${w}deg)`},children:S.map((C,f)=>e.jsx("svg",{width:C.size,height:C.size,viewBox:"0 0 100 100",style:{left:`${50+C.dx}%`,bottom:`${C.dy}px`,transform:"translateX(-50%)","--alpha":C.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:C.color})},f))})}function Ut({paused:t=!1}){const i=y.useMemo(()=>new Array(20).fill(0).map((a,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:i.map(a=>e.jsx(qt,{i:a},a))})}function Ot(){const t=ae(),i=ce(),{lastSection:a,previousLocation:r,setPreviousLocation:m}=ie(),l=k.useRef(null),u=k.useRef(!1),v=k.useRef(0),c=k.useRef(0),w=k.useRef(null),p=k.useRef(null),j=k.useRef(!1),S=300,C=2e3,f=k.useRef(null),x=k.useRef(null),h=k.useRef(null),[o,N]=k.useState(!1),[L,g]=k.useState(12),R=k.useRef(null),E=k.useRef(null),[n,M]=k.useState(!1),[F,U]=k.useState(12),[G,W]=k.useState([]),[V,X]=k.useState(""),P=k.useRef(null),Y=k.useRef(null),[J,d]=k.useState(!1),[A,_]=k.useState(12),[q,se]=k.useState(null),re=k.useCallback(()=>{if(!x.current)return;const b=x.current.getBoundingClientRect(),B=window.innerWidth||document.documentElement.clientWidth||320,$=160;let D=b.left;D+$+8>B&&(D=Math.max(8,B-$-8)),D=Math.max(8,D),g(D)},[]),s=k.useCallback(()=>{if(!R.current)return;const b=R.current.getBoundingClientRect(),B=window.innerWidth||document.documentElement.clientWidth||320,$=220;let D=b.left;D+$+8>B&&(D=Math.max(8,B-$-8)),D=Math.max(8,D),U(D)},[]),T=k.useCallback(()=>{if(!P.current)return;const b=P.current.getBoundingClientRect(),B=window.innerWidth||document.documentElement.clientWidth||320,$=280;let D=b.left;D+$+8>B&&(D=Math.max(8,B-$-8)),D=Math.max(8,D),_(D)},[]);k.useEffect(()=>()=>{l.current&&clearTimeout(l.current),w.current&&clearTimeout(w.current),p.current&&clearTimeout(p.current)},[]),k.useEffect(()=>{if(!o)return;const b=B=>{const $=B.target;h.current&&!h.current.contains($)&&x.current&&!x.current.contains($)&&N(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[o]),k.useEffect(()=>{if(!n)return;const b=B=>{const $=B.target;E.current&&!E.current.contains($)&&R.current&&!R.current.contains($)&&M(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[n]),k.useEffect(()=>{if(!J)return;const b=B=>{const $=B.target;Y.current&&!Y.current.contains($)&&P.current&&!P.current.contains($)&&d(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[J]),k.useEffect(()=>{if(!o)return;re();const b=()=>re();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[o,re]),k.useEffect(()=>{if(!n)return;s();const b=()=>s();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[n,s]),k.useEffect(()=>{if(!J)return;T();const b=()=>T();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[J,T]);const K=t.pathname==="/"||t.pathname==="/about",O=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!K&&t.pathname.startsWith("/md/");const te=t.pathname.startsWith("/md/")||!K&&!t.pathname.startsWith("/mp/")&&a==="moddi";k.useEffect(()=>{if(!O)return;const b=$=>{const D=$.detail||{},He=Array.isArray(D.items)?D.items:[];W(He),X(String(D.selected||""))},B=$=>{const D=$.detail||{};se({title:String(D.title||""),artist:String(D.artist||""),mapper:String(D.mapper||""),version:String(D.version||""),beatmapId:Number(D.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",b),window.addEventListener("editor:info",B),()=>{window.removeEventListener("editor:difficulty:list",b),window.removeEventListener("editor:info",B)}},[O]);const Me=Ae();if(K)return null;const fe=()=>{i(r||(a==="moddi"?"/md/feed":"/mp/feed"))},Ie=()=>{N(b=>!b)},Re=()=>{var b;N(!1),(b=f.current)==null||b.click()},Fe=()=>{M(b=>!b)},Pe=b=>{M(!1),X(b),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:b}}))},De=()=>{d(b=>!b)};if(O)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:f,type:"file",accept:".osz,.zip",onChange:b=>{var $;const B=($=b.target.files)==null?void 0:$[0];B&&window.dispatchEvent(new CustomEvent("editor:file",{detail:B}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:fe,"aria-label":"Back",title:"Go back",children:e.jsx(Ce,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:x,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Ie,"aria-label":"File",title:"File menu","aria-expanded":o,children:e.jsx(Ue,{size:20})}),o&&me.createPortal(e.jsx("div",{ref:h,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${L}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:Re,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:fe,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[G.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:R,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Fe,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":n,children:e.jsx(ye,{size:20})}),n&&me.createPortal(e.jsx("div",{ref:E,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${F}px`,minWidth:220},children:G.map(b=>{const B=b.mode==="taiko"?At:b.mode==="mania"?zt:b.mode==="catch"?Mt:It;return e.jsxs("button",{className:`mode-option ${V===b.path?"selected":""}`,type:"button",onClick:()=>Pe(b.path),children:[e.jsx("img",{className:"mode-icon",src:B,width:24,height:24,alt:""}),e.jsx("span",{children:b.version||"(Untitled)"})]},b.path)})}),document.body)]}),q&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:P,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:De,"aria-label":"Map Info",title:"Map Info","aria-expanded":J,children:e.jsx(Oe,{size:20})}),J&&me.createPortal(e.jsx("div",{ref:Y,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${A}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[q.artist||"Artist"," – ",q.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",q.mapper||"Unknown"]}),q.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",q.version]}),q.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${q.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]});const xe=()=>{const b=Date.now();if(v.current>0){const B=b-v.current;if(B<S&&B>0){w.current&&(clearTimeout(w.current),w.current=null),p.current&&(clearTimeout(p.current),p.current=null),l.current&&(clearTimeout(l.current),l.current=null),c.current=b+C,v.current=0,u.current=!1,m(t.pathname),i("/editor");return}}b<c.current&&v.current===0||(w.current&&(clearTimeout(w.current),w.current=null),p.current&&(clearTimeout(p.current),p.current=null),v.current=b,p.current=setTimeout(()=>{p.current!==null&&(i(te?"/mp/feed":"/md/feed"),p.current=null)},S),w.current=setTimeout(()=>{v.current>0&&(v.current=0,c.current=Date.now()+C),w.current=null},S))},ge=()=>{u.current=!1,l.current=setTimeout(()=>{u.current=!0,i("/")},500)},ue=()=>{l.current&&(clearTimeout(l.current),l.current=null),u.current&&setTimeout(()=>{u.current=!1},100)},We=b=>{if(j.current){b.preventDefault(),b.stopPropagation(),j.current=!1;return}if(u.current){b.preventDefault(),b.stopPropagation();return}xe()},Be=b=>{if(ue(),u.current){b.preventDefault(),j.current=!0;return}b.preventDefault(),xe(),j.current=!0,setTimeout(()=>{j.current=!1},S+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(H,{to:te?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(ye,{size:20})}),te?e.jsx(H,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Qe,{size:20})}):e.jsx(H,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Ye,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:We,onTouchStart:ge,onTouchEnd:Be,onMouseDown:ge,onMouseUp:ue,onMouseLeave:ue,"aria-label":te?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:te?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:te?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(H,{to:"/md/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/md/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(Ee,{size:20}),Me>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>i("/settings"),"aria-label":"Settings",children:e.jsx(Je,{size:20})})]})]})}function Qt({isModdi:t,onClick:i}){return e.jsxs("button",{onClick:i,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:t?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:t?"osu!mappi.ng":"osu!moddi.ng"})]})}function Yt({isNeutralPage:t,isEditor:i,isModdi:a,isMappi:r,onCoinFlipClick:m}){return t?e.jsx(H,{to:"/",className:"title",children:a?"osu!moddi.ng":r?"osu!mappi.ng":"mappi!"}):i?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(H,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ve,{size:18})}),e.jsx(H,{to:a?"/md/feed":"/mp/feed",className:"title",children:"osu!editi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(H,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ve,{size:18})}),e.jsx(Qt,{isModdi:a,onClick:m})]})}function Jt({isNeutralPage:t,isMappi:i,isModdi:a}){const r=ae();return e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[t&&e.jsx(H,{to:r.pathname==="/"?"/about":"/",className:r.pathname==="/about"?"active":"",children:r.pathname==="/"?"About":"Home"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(H,{to:"/mp/feed",className:r.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(H,{to:"/mp/discover",className:r.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(H,{to:"/editor",className:r.pathname==="/editor"?"active":"",children:"Editor"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(H,{to:"/md/feed",className:r.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(H,{to:"/md/queues",className:r.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!i&&!a&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(H,{to:"/mp/feed",className:r.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(H,{to:"/mp/discover",className:r.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(H,{to:"/editor",className:r.pathname==="/editor"?"active":"",children:"Editor"})]})]})}function Vt(t,i,a,r){const m=ce(),{notify:l}=de(),[u,v]=y.useState(new Set);return{parseQueueInvite:f=>{if(!f)return null;try{const x=JSON.parse(f);if((x==null?void 0:x.type)==="queue_invite"&&(x!=null&&x.queue_id))return x}catch{}return null},handleAcceptInvite:async(f,x)=>{if(!u.has(f.id)){v(h=>new Set(h).add(f.id));try{await I(z.moddi.queueAccept(String(x)),{method:"POST"}),l("Invitation accepted!",{variant:"success"}),a.mutate(f.id),r(!1),m(`/md/queues/${x}`)}catch(h){l((h==null?void 0:h.message)||"Failed to accept invitation",{variant:"error"})}finally{v(h=>{const o=new Set(h);return o.delete(f.id),o})}}},handleDenyInvite:async(f,x)=>{if(!u.has(f.id)){v(h=>new Set(h).add(f.id));try{await I(z.moddi.queueDeny(String(x)),{method:"POST"}),l("Invitation declined",{variant:"success"}),a.mutate(f.id)}catch(h){l((h==null?void 0:h.message)||"Failed to decline invitation",{variant:"error"})}finally{v(h=>{const o=new Set(h);return o.delete(f.id),o})}}},handleMarkAllRead:async()=>{const f=t.filter(x=>x.id.startsWith("n:")||x.kind==="system"&&!x.read).map(x=>x.id);f.length>0&&i.mutate(f)},handleNotificationClick:async f=>{if(r(!1),i.mutate([f.id]),f.kind==="system"||f.id.startsWith("n:"))try{await I(z.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[f.id]})})}catch{}},handleDeleteNotification:async(f,x)=>{f.stopPropagation(),a.mutate(x)},processing:u}}function Gt({notifications:t,unreadCount:i,notifOpen:a,setNotifOpen:r,markReadMutation:m,deleteNotificationMutation:l,closeAllPanels:u}){const v=y.useRef(null),c=y.useRef(null),{parseQueueInvite:w,handleAcceptInvite:p,handleDenyInvite:j,handleMarkAllRead:S,handleNotificationClick:C,handleDeleteNotification:f,processing:x}=Vt(t,m,l,r);ze(v,c,a,()=>r(!1));const h=t.filter(o=>!(o.kind==="system"&&o.id.startsWith("b:")&&(o.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:v,className:"icon-link",onClick:()=>{a||u(),r(!a)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Ee,{size:18})}),i>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),a&&e.jsxs("div",{ref:c,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(H,{to:"/md/notifications",onClick:()=>r(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:o=>o.currentTarget.style.opacity="1",onMouseLeave:o=>o.currentTarget.style.opacity="0.7",children:"View all"}),h.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:S,children:e.jsx(he,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[h.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),h.map(o=>{const N=w(o.text),L=o.id.startsWith("b:"),g=N?"queue-invite":o.kind==="star"?"star":o.kind==="likes5"?"likes":o.kind==="comment"?"comment":o.kind==="inspiration"?"inspiration":o.kind==="reaction"?"reaction":L?"global":"system",R=o.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${g}`,role:"button",onClick:()=>!N&&C(o),children:[e.jsxs("div",{className:`notif-icon ${R?"deletable":""}`,"aria-hidden":"true",onClick:R&&!N?E=>f(E,o.id):void 0,title:R&&!N?"Remove":void 0,role:R&&!N?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:N?e.jsx(Ve,{}):g==="star"?e.jsx(Ge,{}):g==="likes"?e.jsx(Ke,{}):g==="comment"?e.jsx(je,{}):g==="inspiration"?e.jsx(je,{}):g==="reaction"?e.jsx(Xe,{}):g==="global"?e.jsx(Ze,{}):null}),R&&!N?e.jsx("span",{className:"swap-trash",children:e.jsx(et,{})}):null]}),e.jsx("div",{className:"notif-body",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[N.inviter_username," invited you to join queue: ",N.queue_name]}),x.has(o.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:E=>{E.stopPropagation(),p(o,N.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(he,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:E=>{E.stopPropagation(),j(o,N.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Te,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):o.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:L?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:o.text||""}),L&&o.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(o.expiresAt).toLocaleString()]}):null]}):o.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:o.text||"Someone commented on your post"})]}):o.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:o.text||"Someone is inspired by you!"})]}):o.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:o.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:o.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:o.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},o.id)})]})]})]})}function Kt({quota:t,nowTick:i}){if(!(t!=null&&t.blocked))return null;const a=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),r=Math.floor(a/3600),m=Math.floor(a%3600/60),l=a%60,u=c=>String(c).padStart(2,"0"),v=r>0?`${r}:${u(m)}:${u(l)}`:`${m}:${u(l)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(tt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:v})]})}function Xt({me:t,menuOpen:i,setMenuOpen:a,onLogout:r,closeAllPanels:m}){const l=y.useRef(null),u=y.useRef(null);return ze(l,u,i,()=>a(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:l,className:"icon-link",onClick:()=>{i||m(),a(!i)},title:t.username,"aria-label":"User menu","aria-expanded":i,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(_e,{size:14,style:{opacity:.8}})]}),i&&e.jsxs("div",{ref:u,className:"menu-panel",role:"menu",children:[e.jsx(H,{to:"/profile",className:"menu-item",onClick:()=>a(!1),children:"Profile"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(H,{to:"/moderation",className:"menu-item",onClick:()=>a(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:r,children:"Log out"})]})]})}function Zt({isNeutralPage:t,isEditor:i,isMappi:a,isModdi:r,onCoinFlipClick:m}){const l=ae(),{data:u,isLoading:v}=oe(),{data:c}=yt(!!u),{data:w=[]}=vt(!!u),p=Ae(),j=jt(),S=wt(),C=Nt(),{menuOpen:f,notifOpen:x,setMenuOpen:h,setNotifOpen:o,closeAllPanels:N}=ie(),[L,g]=k.useState(0);return k.useEffect(()=>{const R=setInterval(()=>g(E=>E+1),1e3);return()=>clearInterval(R)},[]),e.jsxs("header",{className:"top-nav",children:[e.jsx(Yt,{isNeutralPage:t,isEditor:i,isModdi:r,isMappi:a,onCoinFlipClick:m}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),l.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Rt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Jt,{isNeutralPage:t,isMappi:a,isModdi:r}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(st,{size:18})}),u?e.jsxs("div",{className:"user-menu",children:[e.jsx(Gt,{notifications:w,unreadCount:p,notifOpen:x,setNotifOpen:o,markReadMutation:S,deleteNotificationMutation:C,closeAllPanels:N}),e.jsx(Kt,{quota:c,nowTick:L}),e.jsx(Xt,{me:u,menuOpen:f,setMenuOpen:h,onLogout:()=>j.mutate(),closeAllPanels:N})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Le+z.auth.login},disabled:v,children:v?"Checking…":"Login with osu!"})]})]})}function es({title:t,onRefresh:i}){const{data:a}=oe(),r=ae(),m=ce(),{lastSection:l}=ie(),[u,v]=k.useState(!0),[c,w]=k.useState(0),[p,j]=k.useState(!1),S=k.useRef(!1),C=k.useRef(0);k.useEffect(()=>{const h=document.querySelector(".page");if(!h)return;let o=h.scrollTop,N=!1;const L=()=>{N||(N=!0,requestAnimationFrame(()=>{const g=h.scrollTop,R=g-o;g<=12||R<-12?v(!0):R>12&&v(!1),o=g,N=!1}))};return h.addEventListener("scroll",L,{passive:!0}),()=>h.removeEventListener("scroll",L)},[]),k.useEffect(()=>{const h=document.querySelector(".page");if(!h)return;const o=120,N=70,L=n=>{var M;p||(h.scrollTop<=0?(S.current=!0,C.current=((M=n.touches[0])==null?void 0:M.clientY)??0):S.current=!1)},g=n=>{var U;if(!S.current||p)return;const M=((U=n.touches[0])==null?void 0:U.clientY)??0,F=Math.max(0,M-C.current);if(F>0){const G=Math.min(o,F*.5);w(G)}},R=async()=>{try{if(j(!0),i)await i();else{window.location.reload();return}}finally{setTimeout(()=>{j(!1),w(0)},400)}},E=()=>{!S.current||p||(c>=N?R():w(0),S.current=!1)};return h.addEventListener("touchstart",L,{passive:!0}),h.addEventListener("touchmove",g,{passive:!0}),h.addEventListener("touchend",E),h.addEventListener("touchcancel",E),()=>{h.removeEventListener("touchstart",L),h.removeEventListener("touchmove",g),h.removeEventListener("touchend",E),h.removeEventListener("touchcancel",E)}},[c,p,i]);const{showBack:f,onBack:x}=k.useMemo(()=>{const h=r.pathname;if(/^\/mp\/feed\/.+/.test(h))return{showBack:!0,onBack:()=>m("/mp/feed")};if(/^\/md\/feed\/.+/.test(h))return{showBack:!0,onBack:()=>m("/md/feed")};if(/^\/md\/queues\/.+/.test(h))return{showBack:!0,onBack:()=>m("/md/queues")};if(h==="/profile"||h.startsWith("/profile/")){const o=l==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?m(-1):m(o)}}}return{showBack:!1,onBack:()=>{}}},[r.pathname,m,l]);return e.jsxs("div",{className:`mobile-page-header ${u?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${u?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:f?e.jsx("button",{className:"icon-link",onClick:x,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ce,{size:18})}):e.jsx(H,{to:"/profile",className:"icon-link","aria-label":"Profile",children:a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"rgba(255,255,255,0.2)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:p||c>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(c,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${p?"spin":c>60?"ready":""}`})})]})}function ts({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function ss(){const t=ae(),{lastSection:i}=ie(),a=t.pathname==="/"||t.pathname==="/about",r=t.pathname==="/editor",m=t.pathname.startsWith("/mp/")||!a&&!t.pathname.startsWith("/md/")&&i==="mappi",l=t.pathname.startsWith("/md/")||!a&&!t.pathname.startsWith("/mp/")&&i==="moddi",u=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";return{isNeutralPage:a,isEditor:r,isMappi:m,isModdi:l,isQueueDetail:u}}function as(t){const i=ce(),a=ae(),{setPreviousLocation:r}=ie(),m=y.useRef(0),l=y.useRef(0),u=y.useRef(null),v=500,c=2e3;return y.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]),p=>{p.preventDefault();const j=Date.now();if(!(j<l.current)){if(u.current&&m.current>0){const S=j-m.current;if(S<v&&S>0){clearTimeout(u.current),u.current=null,l.current=j+c,m.current=0,r(a.pathname),i("/editor");return}}u.current&&(clearTimeout(u.current),u.current=null),m.current=j,u.current=setTimeout(()=>{l.current=Date.now()+c,u.current=null,m.current=0,i(t?"/mp/feed":"/md/feed")},v)}}}function is(){const t=ae(),{notify:i}=de(),{data:a}=oe(),{lastSection:r,setLastSection:m}=ie(),{isNeutralPage:l,isEditor:u,isMappi:v,isModdi:c}=ss(),w=as(c);k.useEffect(()=>{t.pathname.startsWith("/mp/")?m("mappi"):t.pathname.startsWith("/md/")&&m("moddi")},[t.pathname,m]);const[p,j]=k.useState(null);k.useEffect(()=>{!a||!a.is_mod||(async()=>{try{const f=await I(z.admin.debugState,{requireAuth:!1}),x=Array.isArray(f==null?void 0:f.counts)?f.counts.find(h=>String(h.status)==="ready"):null;x&&j(Number(x.c)||0)}catch{}})()},[a]),k.useEffect(()=>{a&&!localStorage.getItem("welcomed")&&(i(`Welcome, ${a.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[a,i]),k.useEffect(()=>{if(typeof window>"u"||!le()||t.pathname==="/editor")return;const x=document.querySelector(".page");x&&(x.scrollTop=0)},[t.pathname]);const{showMobileHeader:S,headerTitle:C}=k.useMemo(()=>{const f=t.pathname;if(f==="/"||f==="/about"||f==="/editor"||f==="/mp/discover")return{showMobileHeader:!1,headerTitle:""};const x=f.split("/").filter(Boolean),h=x[0]||"",o=x[1]||"";if(h==="mp"){if(o==="discover")return{showMobileHeader:!0,headerTitle:"Discover"};if(o==="feed")return{showMobileHeader:!0,headerTitle:x.length>2?"Post":"Feed"}}if(h==="md"){if(o==="feed")return{showMobileHeader:!0,headerTitle:x.length>2?"Post":"Feed"};if(o==="queues")return{showMobileHeader:!0,headerTitle:x.length>2?"Queue":"Queues"};if(o==="notifications")return{showMobileHeader:!0,headerTitle:"Notifications"}}return h==="profile"?{showMobileHeader:!0,headerTitle:"Profile"}:f==="/settings"?{showMobileHeader:!0,headerTitle:"Settings"}:f==="/moderation"?{showMobileHeader:!0,headerTitle:"Moderation"}:{showMobileHeader:!0,headerTitle:""}},[t.pathname]);return e.jsxs("div",{className:"app-shell","data-section":c?"moddi":v?"mappi":r==="moddi"?"moddi":r==="mappi"?"mappi":void 0,children:[e.jsx(Ut,{paused:t.pathname==="/editor"}),e.jsx(Zt,{isNeutralPage:l,isEditor:u,isMappi:v,isModdi:c,onCoinFlipClick:w}),e.jsxs("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:[S&&e.jsx(es,{title:C}),t.pathname==="/about"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(we,{})}):e.jsx(we,{})]}),t.pathname!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(ts,{readyCount:p})}),e.jsx(Ot,{})]})}function ns(){const{data:t,isLoading:i}=oe(),a=!!t;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions landing-actions-desktop",children:[e.jsx(H,{to:"/mp/feed",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(H,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]}),!a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Le+z.auth.login},disabled:i,children:i?"Checking…":"Login with osu!"})}),a&&e.jsxs("div",{className:"landing-actions landing-actions-mobile",children:[e.jsx(H,{to:"/mp/feed",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(H,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function rs(){const{data:t}=oe(),{modeFilters:i}=ie(),a=Object.entries(i).filter(([m,l])=>l).map(([m])=>m),r=a.length?a.join(","):"standard";return at({queryKey:["mappi","feed",r],queryFn:async({pageParam:m=0})=>{const l=new URLSearchParams({limit:"20",offset:String(m),modes:r}),u=`${z.feed.recent}?${l.toString()}`;return await I(u)},enabled:!!t,initialPageParam:0,getNextPageParam:(m,l)=>{var c;const u=l.reduce((w,p)=>{var j;return w+(((j=p.items)==null?void 0:j.length)||0)},0);return(((c=m.items)==null?void 0:c.length)||0)===20?u:void 0}})}function ls(){const t=ae(),i=it(),{data:a}=oe(),{modeFilters:r}=ie(),{data:m,fetchNextPage:l,hasNextPage:u,isFetching:v,isFetchingNextPage:c,refetch:w}=rs(),p=y.useMemo(()=>(m==null?void 0:m.pages.flatMap(o=>o.items||[]))||[],[m]),j=y.useMemo(()=>{const o=Object.entries(r).filter(([L,g])=>g).map(([L])=>L.toLowerCase()),N=new Set(o.length?o:["standard"]);return p.filter(L=>{const g=String(L.mode||"standard").toLowerCase();return N.has(g)})},[p,r]);y.useEffect(()=>{t.pathname==="/mp/feed"&&w()},[t.pathname,w]),y.useEffect(()=>{const o=()=>{w()};return window.addEventListener("filterchange",o),()=>window.removeEventListener("filterchange",o)},[w]);const S=o=>{i.setQueryData(["mappi","feed"],N=>N&&{...N,pages:N.pages.map(L=>({...L,items:L.items.map(g=>g.id===o.id?o:g)}))})},C=o=>{i.setQueryData(["mappi","feed"],N=>N&&{...N,pages:N.pages.map(L=>({...L,items:L.items.filter(g=>g.id!==o)}))})},f=()=>{w()},x=v&&!c,h=u??!1;return e.jsxs("div",{className:"feed-container mappi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(kt,{section:"mappi",onUpload:f})]}),e.jsx(St,{section:"mappi",onUpload:f}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[j.length===0&&!x&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),j.map(o=>e.jsx(ft,{post:o,section:"mappi",onUpdate:S,onDelete:C,me:a},o.id)),j.length>0&&h&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>l(),disabled:c,children:c?"Loading...":"Load more"})})]})})]})}function ke(t){if(!t)return"standard";const i=String(t).toLowerCase().trim();return i==="osu"||i==="0"||i==="standard"?"standard":i==="taiko"||i==="1"?"taiko":i==="catch"||i==="fruits"||i==="2"?"catch":i==="mania"||i==="3"?"mania":"standard"}const os=({open:t,onClose:i,videoId:a,initialDescription:r,initialBeatmapUrl:m,onSave:l})=>{const[u,v]=y.useState(r||""),[c,w]=y.useState(m||""),[p,j]=y.useState(null),[S,C]=y.useState(null),[f,x]=y.useState(""),[h,o]=y.useState(!1),N=y.useRef(0);y.useEffect(()=>{t&&(v(r||""),w(m||""),j(null),C(null),x(""))},[t,r,m]),y.useEffect(()=>{if(!t)return;N.current&&window.clearTimeout(N.current);const g=(c||"").trim();if(!g){x(""),j(null),C(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(g)){x(""),j(null),C(null);return}return N.current=window.setTimeout(async()=>{var E;try{let n;try{n=new URL(g)}catch{x("Invalid URL format");return}const M=n.hash.match(/#osu\/(\d+)/),F=M?M[1]:null;n.hash="";const G={url:n.toString()};F&&(G.beatmap_id=F);const W=await I(z.osu.resolveBeatmap+ne(G),{requireAuth:!1}),V=Array.isArray(W==null?void 0:W.diffs)?W.diffs:[];if(!V.length&&!W.setId){x("No difficulties found"),j(null),C(null);return}if(j({setId:Number(W.setId)||0,beatmapId:W.beatmapId??null,title:String(W.title||""),artist:String(W.artist||""),mapper:String(W.mapper||""),diffs:V}),V.length>0){const X=Number.isFinite(Number(W.beatmapId))?Number(W.beatmapId):Number((E=V[0])==null?void 0:E.id),P=V.find(J=>Number(J.id)===X)||V[0],Y=ke(P==null?void 0:P.mode);C({beatmapId:Number(P==null?void 0:P.id)||null,version:String((P==null?void 0:P.version)||""),mode:Y})}x("")}catch(n){x(`Failed to resolve: ${(n==null?void 0:n.message)||"Unknown error"}`),j(null),C(null)}},400),()=>{N.current&&window.clearTimeout(N.current)}},[c,t]);const L=async()=>{if(!h){o(!0);try{await I(z.videos.update(a),{method:"PATCH",body:JSON.stringify({description:u.slice(0,100),beatmap_url:c.trim()||void 0})});const g=!!c.trim();if(p||!g)try{await I(z.videos.update(a)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:g&&p&&p.setId>0?p.setId:null,beatmap_id:g&&(S!=null&&S.beatmapId)?S.beatmapId:null,beatmap_version:g&&(S!=null&&S.version)?S.version:null,beatmap_title:g&&(p!=null&&p.title)?p.title:null,beatmap_artist:g&&(p!=null&&p.artist)?p.artist:null,beatmap_mapper:g&&(p!=null&&p.mapper)?p.mapper:null,beatmap_url:g?c.trim():null})})}catch(E){console.warn("Failed to update beatmap metadata:",E)}l(u,c.trim()||null),i()}catch(g){alert((g==null?void 0:g.message)||"Failed to update post")}finally{o(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:g=>g.target===g.currentTarget&&i(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:i}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:i,"aria-label":"Close",children:e.jsx(Te,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:u,onChange:g=>v(g.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),p?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[p.artist," – ",p.title]}),e.jsxs("span",{className:"muted",children:["by ",p.mapper]})]}),e.jsx("select",{value:(S==null?void 0:S.beatmapId)??p.beatmapId??void 0,onChange:g=>{const R=Number(g.target.value),E=(p==null?void 0:p.diffs.find(n=>Number(n.id)===R))||null;if(E){const n=ke(E.mode);C({beatmapId:R,version:E.version,mode:n})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:p.diffs.map(g=>e.jsxs("option",{value:g.id,children:[g.version," (",g.mode,")"]},g.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{j(null),C(null),w("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:g=>w(g.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),f&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:f})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:i,disabled:h,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:L,disabled:h,children:h?"Saving...":"Save"})]})]})]})]}):null};function Se(){const t=nt(),i=ce(),{notify:a}=de(),[r,m]=y.useState(null),[l,u]=y.useState(null),[v,c]=y.useState(""),[w,p]=y.useState([]),[j,S]=y.useState([]),[C,f]=y.useState([]),[x,h]=y.useState(""),[o,N]=y.useState(null),[L,g]=y.useState([]),[R,E]=y.useState(null),[n,M]=y.useState(""),[F,U]=y.useState([]),[G,W]=y.useState(null),[V,X]=y.useState(!1),P=y.useMemo(()=>{const d=t.id?Number(t.id):null;return d?r?r.id===d:!1:!0},[t.id,r]);function Y(d){const A=d.stream_uid||String(d.id),_=t.id?`/profile/${t.id}`:"/profile";i(`/mp/feed/${A}`,{state:{returnTo:_}})}y.useEffect(()=>{(async()=>{try{const d=await I(z.auth.me,{requireAuth:!1});m(d),d&&Array.isArray(d.inspirations)&&g(d.inspirations)}catch(d){c((d==null?void 0:d.message)||"Not logged in")}})()},[]),y.useEffect(()=>{(async()=>{try{const d=t.id?Number(t.id):null;if(d){const A=await I(z.users.get(d),{requireAuth:!1});u(A),h(A.about||""),Array.isArray(A.inspirations)&&g(A.inspirations);const _=await I(z.users.videos(d)+ne({limit:"60"}),{requireAuth:!1});f(_.items||[]);const q=await I(z.users.likes(d)+ne({limit:"60"}),{requireAuth:!1});S(q.items||[])}else{if(!r)return;u(r),h(r.about||""),Array.isArray(r.inspirations)&&g(r.inspirations);const A=await I(z.users.myVideos+ne({limit:"50"}),{requireAuth:!1});p(A.items||[]);const _=await I(z.users.likes(r.id)+ne({limit:"60"}),{requireAuth:!1});S(_.items||[])}}catch{}})()},[t.id,r]),y.useEffect(()=>{X(!1)},[l==null?void 0:l.id]);async function J(d){try{const _=(await I(z.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:d})})).user||l;u(_),Array.isArray(_==null?void 0:_.inspirations)&&g(_.inspirations),t.id||m(_)}catch{}}return y.useEffect(()=>{let d;return R!==null&&n.trim().length>=2?d=setTimeout(async()=>{try{const A=await I(z.osu.usersSearch(n),{requireAuth:!1});U(Array.isArray(A.items)?A.items:[])}catch{}},250):U([]),()=>{d&&clearTimeout(d)}},[n,R]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:l?e.jsxs(e.Fragment,{children:[l.avatar_url&&e.jsx("img",{src:l.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[l.username,l.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${l.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:d=>d.currentTarget.style.opacity="1",onMouseLeave:d=>d.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(rt,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",l.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!P&&L.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),L.map((d,A)=>P?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(d.id),onMouseLeave:()=>W(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const _=L.filter((q,se)=>se!==A);g(_),J(_)},children:e.jsx("img",{src:d.avatar_url,alt:d.username})}),G===d.id&&e.jsxs("div",{className:"insp-tooltip",children:[d.username," — click to remove"]})]},d.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(d.id),onMouseLeave:()=>W(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${d.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:d.avatar_url,alt:d.username})}),G===d.id&&e.jsx("div",{className:"insp-tooltip",children:d.username})]},d.id)),P&&L.length<3&&new Array(3-L.length).fill(0).map((d,A)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>W(-A-1),onMouseLeave:()=>W(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{E(A),M(""),U([])},children:"+"}),G===-A-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),R===A&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:n,onChange:_=>M(_.target.value)}),e.jsxs("div",{className:"insp-results",children:[F.length===0&&n.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),F.map(_=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(_.id)){a("Kinda based, but no.",{variant:"warn"}),E(null);return}if(L.some(se=>se.id===_.id)){E(null);return}const q=[...L,{id:_.id,username:_.username,avatar_url:_.avatar_url}].slice(0,3);g(q),E(null),J(q)},children:[e.jsx("img",{src:_.avatar_url,alt:"avatar"}),e.jsx("span",{children:_.username})]},_.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>E(null),children:"Close"})]})]},`slot-${A}`))]}),P&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:v||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),P?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:x,onChange:d=>h(d.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const d=await I(z.auth.me,{method:"PATCH",body:JSON.stringify({about:x})});u(d.user||l),m(d.user||r)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(he,{size:16})})]})}):(()=>{const d=((l==null?void 0:l.about)||"").trim()||"No bio.",A=d.length>200,_=A&&!V?d.slice(0,200)+"...":d;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:_}),A&&e.jsx("button",{onClick:()=>X(!V),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:V?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(lt,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(_e,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:d=>{const A=d.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(q=>{q.classList.remove("active"),q.setAttribute("aria-selected","false")}),d.currentTarget.classList.add("active"),d.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:d=>{const A=d.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(q=>{q.classList.remove("active"),q.setAttribute("aria-selected","false")}),d.currentTarget.classList.add("active"),d.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(P?w:C).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(P?w:C).map(d=>(P&&l?(l.id,l.username,l.avatar_url,l.is_admin,l.is_mod):d.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>Y({...d}),children:[d.poster_url?e.jsx("img",{className:"recent-thumb",src:d.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ot,{size:12}),e.jsx("span",{children:d.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ct,{size:12}),e.jsx("span",{children:d.comments_count??0})]})]})})]},d.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[j.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),j.map(d=>{var A,_;return e.jsxs("button",{className:"recent-cell",onClick:()=>Y(d),children:[d.poster_url?e.jsx("img",{className:"recent-thumb",src:d.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((A=d.uploader)==null?void 0:A.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:d.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(_=d.uploader)==null?void 0:_.username})]})]},d.id)})]})})})]})]}),o&&e.jsx(os,{open:!!o,onClose:()=>N(null),videoId:o.id,initialDescription:o.description,initialBeatmapUrl:o.beatmap_url,onSave:(d,A)=>{p(w.map(_=>_.id===o.id?{..._,description:d||null,beatmap_url:A}:_)),N(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function cs(){var A,_,q,se,re;const[t,i]=y.useState(null),[a,r]=y.useState([]),[m,l]=y.useState(""),[u,v]=y.useState([]),[c,w]=y.useState(null),[p,j]=y.useState([]),[S,C]=y.useState("all"),[f,x]=y.useState("approvals"),[h,o]=y.useState(null),[N,L]=y.useState(""),[g,R]=y.useState(!1),{notify:E}=de(),[n,M]=y.useState(null),[F,U]=y.useState(!1);y.useEffect(()=>{(async()=>{try{const s=await I(z.auth.me,{requireAuth:!1});if(i(s),s!=null&&s.is_admin)try{const T=await I(z.admin.settingsModeration,{requireAuth:!1});o(!!T.require_approval)}catch{}}catch{}try{const s=await I(z.admin.videosPending+ne({limit:"50"}),{requireAuth:!1});r(s.items||[])}catch{}})()},[]);async function G(){U(!0);try{const s=await I(z.admin.analytics,{requireAuth:!1});M(s)}finally{U(!1)}}async function W(){try{const s=await I(z.admin.usersSearch(m),{requireAuth:!1});v(s.items||[])}catch{}}async function V(s){w(s),j([]);try{const T=await I(z.admin.userVideos(s.id)+ne({limit:"50"}),{requireAuth:!1});j(T.items||[])}catch{}}async function X(s,T){try{const K=await I(z.admin.user(s.id),{method:"PATCH",body:JSON.stringify({is_mod:T})}),O=(K==null?void 0:K.user)||{...s,is_mod:T};E(T?"Granted moderation":"Revoked moderation",{variant:T?"success":"warn"}),w(O),v(u.map(te=>te.id===s.id?O:te))}catch{alert("Failed to update")}}const P=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),Y=!!(t!=null&&t.is_admin);if(!P)return e.jsx("div",{className:"muted",children:"You do not have access."});const J=a.filter(s=>!s.flagged_only),d=a.filter(s=>!!s.flagged_only);return e.jsx("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"muted moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:le()?"nowrap":"wrap",gap:le()?"2px":"4px",overflowX:le()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":f==="approvals",className:`profile-tab ${f==="approvals"?"active":""}`,"data-tab":"approvals",onClick:s=>{const T=s.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),x("approvals")},children:"Approvals"}),(Y||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":f==="manage",className:`profile-tab ${f==="manage"?"active":""}`,"data-tab":"manage",onClick:s=>{const T=s.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),x("manage")},children:"Manage"}),(Y||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":f==="analytics",className:`profile-tab ${f==="analytics"?"active":""}`,"data-tab":"analytics",onClick:s=>{const T=s.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),x("analytics"),n||G()},children:"Analytics"}),(Y||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":f==="message",className:`profile-tab ${f==="message"?"active":""}`,"data-tab":"message",onClick:s=>{const T=s.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(O=>{O.classList.remove("active"),O.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","message"),x("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":f,children:[e.jsx("div",{className:"panel approvals",hidden:f!=="approvals",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[J.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[J.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),J.map(s=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[s.poster_url?e.jsx("img",{src:s.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:s.description||"",children:s.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",s.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[s.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof s.flags_count=="number"&&s.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",s.flags_count," reports"]}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await I(z.admin.videosReject(s.id),{method:"POST"}),r(a.filter(T=>T.id!==s.id)),E("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await I(z.admin.videosApprove(s.id),{method:"POST"}),r(a.filter(T=>T.id!==s.id)),E("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await I(z.videos.delete(s.id),{method:"DELETE"}),r(a.filter(T=>T.id!==s.id)),E("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},s.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[d.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[d.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),d.map(s=>e.jsxs("div",{className:"col moderation-video-card flagged",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[s.poster_url?e.jsx("img",{src:s.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:s.description||"",children:s.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",s.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof s.flags_count=="number"&&s.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",s.flags_count," reports"]}):null]})]})]})]}),e.jsx("div",{className:"row",children:e.jsx("button",{className:"btn secondary",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await I(z.videos.delete(s.id),{method:"DELETE"}),r(a.filter(T=>T.id!==s.id)),E("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},s.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:f!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:m,onChange:s=>l(s.target.value),onKeyDown:s=>{s.key==="Enter"&&W()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:W,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:u.map(s=>e.jsxs("button",{className:"btn secondary moderation-user-result",onClick:()=>V(s),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center"},children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:s.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",s.id," • osu ",s.osu_user_id]})]}),s.is_admin?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"admin"}):s.is_mod?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"mod"}):s.is_blacklisted?e.jsx("span",{style:{color:"#f87171",fontSize:12,flexShrink:0},children:"blacklisted"}):null]},s.id))})})]}),c?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flexWrap:"wrap"},children:[c.avatar_url&&e.jsx("img",{src:c.avatar_url,width:40,height:40,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:4},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:c.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",c.id," • osu ",c.osu_user_id]})]})]}),e.jsxs("div",{className:"col",style:{gap:10},children:[Y&&!c.is_admin&&(c.is_mod?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>X(c,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>X(c,!0),children:"Grant moderation"})),!c.is_admin&&(c.is_blacklisted?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await I(z.admin.user(c.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),w({...c,is_blacklisted:!1}),E("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await I(z.admin.user(c.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),w({...c,is_blacklisted:!0}),E("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),c.is_admin&&e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"})]}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>C("all"),children:"All"}),e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>C("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[p.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),p.filter(s=>{if(S==="all")return!0;const T=(h?!s.approved_at:!1)&&s.status==="ready",K=!!s.needs_review;return T||K}).map(s=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[s.poster_url?e.jsx("img",{src:s.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:s.description||"",children:s.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:[s.status.toUpperCase()," • ",new Date(s.created_at*1e3).toLocaleString()]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[s.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,h&&!s.approved_at&&s.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:14},children:s.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)",fontSize:16},children:"★"})]}),e.jsxs("div",{className:"row",style:{gap:8},children:[(Y||(t==null?void 0:t.is_mod))&&(!!s.needs_review||h&&!s.approved_at&&s.status==="ready")&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await I(z.admin.videosApprove(s.id),{method:"POST"}),j(p.map(T=>T.id===s.id?{...T,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:T)),E("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(Y||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await I(z.videos.delete(s.id),{method:"DELETE"}),j(p.filter(T=>T.id!==s.id)),E("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]})]},s.id))]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:f!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:m,onChange:s=>l(s.target.value),onKeyDown:s=>{s.key==="Enter"&&W()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:W,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:u.map(s=>e.jsxs("button",{className:`btn secondary moderation-user-result ${(c==null?void 0:c.id)===s.id,""}`,onClick:()=>w(s),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center",border:(c==null?void 0:c.id)===s.id?"2px solid var(--accent)":void 0},children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:s.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",s.id," • osu ",s.osu_user_id]})]}),(c==null?void 0:c.id)===s.id&&e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"selected"})]},s.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:g,onChange:s=>R(s.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",width:"100%",fontSize:16,color:"inherit",fontFamily:"inherit"},value:N,onChange:s=>L(s.target.value)}),e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const s=(N||"").trim();if(!s){alert("Enter a message");return}(async()=>{try{const T={text:s,global:g};!g&&(c!=null&&c.id)&&(T.user_id=c.id),await I(z.admin.notificationsSystem,{method:"POST",body:JSON.stringify(T)}),L(""),E("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:f!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Analytics"}),F&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!F&&!n&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(ee,{label:"Users",value:n.totals.users_total}),e.jsx(ee,{label:"Admins",value:n.totals.users_admin}),e.jsx(ee,{label:"Mods",value:n.totals.users_mod}),e.jsx(ee,{label:"Blacklisted",value:n.totals.users_blacklisted}),e.jsx(ee,{label:"Videos",value:n.totals.videos_total}),e.jsx(ee,{label:"Ready",value:n.totals.videos_ready}),e.jsx(ee,{label:"Pending",value:n.totals.pending_count}),e.jsx(ee,{label:"Purgatory",value:n.totals.purgatory_count}),e.jsx(ee,{label:"Likes",value:n.totals.likes_total}),e.jsx(ee,{label:"Flags",value:n.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(pe,{title:"New users (30d)",series:n.series.users,color:"#60a5fa"}),e.jsx(pe,{title:"New videos (30d)",series:n.series.videos,color:"#34d399"}),((_=(A=n.stream)==null?void 0:A.graphql)==null?void 0:_.minutes_viewed)&&n.stream.graphql.minutes_viewed.length>0&&e.jsx(pe,{title:"Minutes viewed (30d)",series:n.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",n.feed.count," items in rotation",n.feed.cursor?` • cursor ${n.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",n.stream.approximate.total_duration_sec," • ready videos: ",n.stream.approximate.videos_ready]}),n.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",n.stream.api.ok?"ok":"unavailable",(se=(q=n.stream.api)==null?void 0:q.result_info)!=null&&se.count?` • count ${n.stream.api.result_info.count}`:"",(re=n.stream.api)!=null&&re.sample_status?` • sample status ${String(n.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})})}function ee({label:t,value:i}){return e.jsxs("div",{className:"col moderation-stat-card",children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",style:{fontSize:"clamp(18px, 4vw, 20px)"},children:i})]})}function pe({title:t,series:i,color:a}){const[r,m]=y.useState(()=>le());y.useEffect(()=>{const n=()=>m(le());return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const l=r?Math.min(400,window.innerWidth-48):400,u=160,v=8,c=8,w=28,p=r?36:42,j=i.map(n=>n.count),S=Math.max(1,...j),C=y.useMemo(()=>{const n=S,M=Math.pow(10,Math.floor(Math.log10(n))),F=n/M;return(F<=1?1:F<=2?2:F<=5?5:10)*M},[S]),f=l-p-c,x=u-v-w,h=y.useMemo(()=>i.map((n,M)=>{const F=p+M/Math.max(1,i.length-1)*f,U=v+(1-n.count/(C||1))*x;return[F,U]}),[i,C,f,x]),o=y.useMemo(()=>h.map((n,M)=>M===0?`M ${n[0]} ${n[1]}`:`L ${n[0]} ${n[1]}`).join(" "),[h]),N=[0,.25,.5,.75,1],L=y.useMemo(()=>{if(i.length===0)return[];const n=[0,.25,.5,.75,1].map(M=>Math.min(i.length-1,Math.round(M*(i.length-1))));return Array.from(new Set(n))},[i]),g=n=>{if(!n||n.length<10)return n||"";const M=n.slice(5,7).replace(/^0/,""),F=n.slice(8,10).replace(/^0/,"");return`${M}/${F}`};function R(n){const M=Number.isInteger(n);return n>=1e6?`${(n/1e6).toFixed(1).replace(/\.0$/,"")}M`:n>=1e3?`${(n/1e3).toFixed(1).replace(/\.0$/,"")}k`:M?String(n):n<10?n.toFixed(1):n.toFixed(1).replace(/\.0$/,"")}const E=i.length?i[i.length-1].count:0;return e.jsxs("div",{className:"col moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:r?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:r?11:12},children:["latest: ",R(E)]})]}),e.jsx("div",{style:{width:"100%",overflowX:"auto"},children:e.jsxs("svg",{width:l,height:u,role:"img","aria-label":t,style:{display:"block"},children:[e.jsx("rect",{x:0,y:0,width:l,height:u,fill:"#0f1217",rx:12}),N.map((n,M)=>{const F=v+(1-n)*x,U=n*C;return e.jsxs("g",{children:[e.jsx("line",{x1:p,y1:F,x2:l-c,y2:F,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:p-6,y:F+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:R(U)})]},M)}),e.jsx("line",{x1:p,y1:v,x2:p,y2:v+x,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:p,y1:v+x,x2:p+f,y2:v+x,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),L.map((n,M)=>{var U;const F=p+n/Math.max(1,i.length-1)*f;return e.jsxs("g",{children:[e.jsx("line",{x1:F,y1:v,x2:F,y2:v+x,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:F,y:v+x+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:g((U=i[n])==null?void 0:U.day)})]},M)}),e.jsx("path",{d:o,fill:"none",stroke:a,strokeWidth:2}),h.length>0&&e.jsx("circle",{cx:h[h.length-1][0],cy:h[h.length-1][1],r:3,fill:a})]})})]})}function ds(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function us(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const ms=()=>(y.useEffect(()=>()=>{Ft.clearAll()},[]),e.jsx(Pt,{})),ps=k.lazy(()=>Bt(()=>import("./Discover-Ci3nqc5N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));xt();const hs=()=>e.jsx(pt,{children:e.jsxs(Q,{element:e.jsx(is,{}),children:[e.jsx(Q,{path:"/",element:e.jsx(ns,{})}),e.jsx(Q,{path:"/mp/discover",element:e.jsx(y.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(ps,{})})}),e.jsx(Q,{path:"/mp/feed",element:e.jsx(ls,{})}),e.jsx(Q,{path:"/mp/feed/:uid",element:e.jsx(bt,{})}),e.jsx(Q,{path:"/md/feed",element:e.jsx(Ct,{})}),e.jsx(Q,{path:"/md/feed/:uid",element:e.jsx(Et,{})}),e.jsx(Q,{path:"/md/queues",element:e.jsx(Tt,{})}),e.jsx(Q,{path:"/md/queues/:id",element:e.jsx(_t,{})}),e.jsx(Q,{path:"/md/notifications",element:e.jsx(Lt,{})}),e.jsx(Q,{path:"/profile",element:e.jsx(Se,{})}),e.jsx(Q,{path:"/profile/:id",element:e.jsx(Se,{})}),e.jsx(Q,{path:"/moderation",element:e.jsx(cs,{})}),e.jsx(Q,{path:"/about",element:e.jsx(ds,{})}),e.jsx(Q,{path:"/settings",element:e.jsx(us,{})}),e.jsx(Q,{path:"/editor",element:e.jsx(ms,{})})]})}),fs=()=>e.jsx(mt,{children:e.jsx(hs,{})});dt(document.getElementById("root")).render(e.jsx($t,{children:e.jsx(ut,{client:Ht,children:e.jsx(gt,{children:e.jsx(fs,{})})})}));export{Ut as B,Bt as _};
