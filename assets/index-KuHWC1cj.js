const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-7oJKseK6.js","assets/vendor-react-BRzxmndo.js","assets/vendor-DxfNnw3A.js","assets/mappi-routes-TS51rId4.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-Cw6h44JF.js","assets/vendor-zip-CcyD6tR5.js","assets/beatmap-preview-4eX6p_HS.js","assets/editor-CG1yLUbS.css","assets/moddi-routes-C24cLHHk.js","assets/editor-components-Rt6oACVB.js","assets/editor-components-Bzmrvihl.css"])))=>i.map(i=>d[i]);
var ut=Object.defineProperty;var mt=(t,n,a)=>n in t?ut(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;var qe=(t,n,a)=>mt(t,typeof n!="symbol"?n+"":n,a);import{r as h,j as e,e as ke,u as Ce,R as v,q as Fe,d as Pe,U as pt,V as $e,W as ht,L as ee,X as ft,Y as gt,O as Ve,Z as xt,_ as vt,P as Le,K as bt,A as yt,h as jt,y as Be,Q as Nt,S as wt,I as kt,c as Xe,B as St,l as De,$ as _t,D as Ct,a0 as Oe,o as Tt,k as Et,E as Ze,i as Mt,g as Lt,a1 as et,v as At,a2 as zt,a3 as Pt,a4 as It,a5 as Rt,a6 as Z,a7 as je}from"./vendor-react-BRzxmndo.js";import{y as Ft}from"./vendor-DxfNnw3A.js";import{u as we,a as D,A as F,O as _e,c as Ae,i as he,d as Re,b as Ne,P as Dt,e as Wt,T as Ut,f as qt}from"./mappi-routes-TS51rId4.js";import{u as xe,a as tt,b as ve,c as st,d as $t,e as Bt,f as Ot,g as at,h as Ht,i as Qt,F as Kt,D as Jt,Q as Gt,j as Yt,M as Vt,N as Xt}from"./moddi-routes-C24cLHHk.js";import{i as it,a as nt,b as rt,c as ot,H as Zt}from"./editor-components-Rt6oACVB.js";import{s as es,E as ts,B as ss}from"./editor-Cw6h44JF.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-4eX6p_HS.js";import"./vendor-zip-CcyD6tR5.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();const as="modulepreload",is=function(t){return"/"+t},He={},ns=function(n,a,d){let s=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),j=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));s=Promise.allSettled(a.map(c=>{if(c=is(c),c in He)return;He[c]=!0;const N=c.endsWith(".css"),r=N?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${r}`))return;const m=document.createElement("link");if(m.rel=N?"stylesheet":as,N||(m.as="script"),m.crossOrigin="",m.href=c,j&&m.setAttribute("nonce",j),document.head.appendChild(m),N)return new Promise((g,y)=>{m.addEventListener("load",g),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(p){const j=new Event("vite:preloadError",{cancelable:!0});if(j.payload=p,window.dispatchEvent(j),!j.defaultPrevented)throw p}return s.then(p=>{for(const j of p||[])j.status==="rejected"&&o(j.reason);return n().catch(o)})},rs=new Ft({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class os extends h.Component{constructor(a){super(a);qe(this,"handleRetry",()=>{const a=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),a&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,d){console.error("ErrorBoundary caught an error:",a,d)}isChunkLoadingError(a){if(!a)return!1;const d=a.message.toLowerCase();return d.includes("loading chunk")||d.includes("failed to load")||d.includes("chunk load failed")||d.includes("loading css chunk")||a.name==="ChunkLoadError"}render(){var a;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const d=this.isChunkLoadingError(this.state.error),s=((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:d?"Failed to load page. This might be a network issue.":s}),d&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:d?"Reload Page":"Try Again"}),!d&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const me=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function ls({i:t}){const n=t*1337,a=(y,w)=>{const x=Math.sin(n+y+w)*1e4,S=x-Math.floor(x);return Math.floor(S*(w-y+1)+y)},d=a(0,100),s=a(24,50),o=.7+a(0,100)/100*.3,p=s*o,j=a(0,4e3),c=a(-10,10),N=a(-8,8),r=a(0,100),m=r<60?1:r<80?1.5:2,g=[{size:200*m,alpha:.06,dx:-22,dy:12,color:me[a(0,me.length-1)]},{size:150*m,alpha:.08,dx:-9,dy:7,color:me[a(0,me.length-1)]},{size:120*m,alpha:.1,dx:0,dy:0,color:me[a(0,me.length-1)]},{size:90*m,alpha:.12,dx:12,dy:-4,color:me[a(0,me.length-1)]},{size:64*m,alpha:.13,dx:20,dy:-7,color:me[a(0,me.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${d}vw`,animationDuration:`${p}s`,animationDelay:`${j}ms`,"--tx":`${c}vw`,transform:`rotate(${N}deg)`},children:g.map((y,w)=>e.jsx("svg",{width:y.size,height:y.size,viewBox:"0 0 100 100",style:{left:`${50+y.dx}%`,bottom:`${y.dy}px`,transform:"translateX(-50%)","--alpha":y.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:y.color})},w))})}function ds({paused:t=!1}){const n=h.useMemo(()=>new Array(20).fill(0).map((a,d)=>d),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:n.map(a=>e.jsx(ls,{i:a},a))})}function cs(){const t=ke(),n=Ce(),{lastSection:a,previousLocation:d,setPreviousLocation:s}=xe(),o=v.useRef(null);v.useRef(!1),v.useRef(0),v.useRef(0);const p=v.useRef(null),j=v.useRef(null);v.useRef(!1);const c=v.useRef(null),N=v.useRef(null),r=v.useRef(null),[m,g]=v.useState(!1),[y,w]=v.useState(12),x=v.useRef(null),S=v.useRef(null),[f,z]=v.useState(!1),[$,T]=v.useState(12),[H,I]=v.useState([]),[l,W]=v.useState(""),B=v.useRef(null),_=v.useRef(null),[L,E]=v.useState(!1),[k,M]=v.useState(12),[b,q]=v.useState(null),J=v.useCallback(()=>{if(!N.current)return;const C=N.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Y=160;let K=C.left;K+Y+8>V&&(K=Math.max(8,V-Y-8)),K=Math.max(8,K),w(K)},[]),u=v.useCallback(()=>{if(!x.current)return;const C=x.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Y=220;let K=C.left;K+Y+8>V&&(K=Math.max(8,V-Y-8)),K=Math.max(8,K),T(K)},[]),R=v.useCallback(()=>{if(!B.current)return;const C=B.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Y=280;let K=C.left;K+Y+8>V&&(K=Math.max(8,V-Y-8)),K=Math.max(8,K),M(K)},[]);v.useEffect(()=>()=>{o.current&&clearTimeout(o.current),p.current&&clearTimeout(p.current),j.current&&clearTimeout(j.current)},[]),v.useEffect(()=>{if(!m)return;const C=V=>{const Y=V.target;r.current&&!r.current.contains(Y)&&N.current&&!N.current.contains(Y)&&g(!1)};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[m]),v.useEffect(()=>{if(!f)return;const C=V=>{const Y=V.target;S.current&&!S.current.contains(Y)&&x.current&&!x.current.contains(Y)&&z(!1)};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[f]),v.useEffect(()=>{if(!L)return;const C=V=>{const Y=V.target;_.current&&!_.current.contains(Y)&&B.current&&!B.current.contains(Y)&&E(!1)};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[L]),v.useEffect(()=>{if(!m)return;J();const C=()=>J();return window.addEventListener("resize",C),window.addEventListener("orientationchange",C),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[m,J]),v.useEffect(()=>{if(!f)return;u();const C=()=>u();return window.addEventListener("resize",C),window.addEventListener("orientationchange",C),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[f,u]),v.useEffect(()=>{if(!L)return;R();const C=()=>R();return window.addEventListener("resize",C),window.addEventListener("orientationchange",C),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[L,R]);const A=t.pathname==="/"||t.pathname==="/about",te=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!A&&t.pathname.startsWith("/md/"),t.pathname.startsWith("/md/")||!A&&t.pathname.startsWith("/mp/"),v.useEffect(()=>{if(!te)return;const C=Y=>{const K=Y.detail||{},Ee=Array.isArray(K.items)?K.items:[];I(Ee),W(String(K.selected||""))},V=Y=>{const K=Y.detail||{};q({title:String(K.title||""),artist:String(K.artist||""),mapper:String(K.mapper||""),version:String(K.version||""),beatmapId:Number(K.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",C),window.addEventListener("editor:info",V),()=>{window.removeEventListener("editor:difficulty:list",C),window.removeEventListener("editor:info",V)}},[te]);const ie=tt(),{data:X}=ve(),re=v.useRef(null),le=v.useRef(!1),be=C=>{le.current=!1,(X!=null&&X.is_mod||X!=null&&X.is_admin)&&(C.preventDefault(),C.stopPropagation(),re.current=setTimeout(()=>{le.current=!0,n("/moderation")},500))},fe=()=>{re.current&&(clearTimeout(re.current),re.current=null),le.current&&setTimeout(()=>{le.current=!1},100)},ye=C=>{if(le.current){C.preventDefault(),C.stopPropagation();return}n("/settings")},i=C=>{if(fe(),le.current){C.preventDefault();return}n("/settings")};if(v.useEffect(()=>()=>{re.current&&clearTimeout(re.current)},[]),A)return null;const P=()=>{n(d||(a==="moddi"?"/md/feed":"/mp/feed"))},ne=()=>{g(C=>!C)},ae=()=>{var C;g(!1),(C=c.current)==null||C.click()},oe=()=>{z(C=>!C)},Te=C=>{z(!1),W(C),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:C}}))},ze=()=>{E(C=>!C)};return te?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:c,type:"file",accept:".osz,.zip",onChange:C=>{var Y;const V=(Y=C.target.files)==null?void 0:Y[0];V&&window.dispatchEvent(new CustomEvent("editor:file",{detail:V}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:P,"aria-label":"Back",title:"Go back",children:e.jsx(Fe,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:N,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ne,"aria-label":"File",title:"File menu","aria-expanded":m,children:e.jsx(pt,{size:20})}),m&&Pe.createPortal(e.jsx("div",{ref:r,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${y}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:ae,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:P,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[H.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:x,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:oe,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":f,children:e.jsx($e,{size:20})}),f&&Pe.createPortal(e.jsx("div",{ref:S,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${$}px`,minWidth:220},children:H.map(C=>{const V=C.mode==="taiko"?it:C.mode==="mania"?nt:C.mode==="catch"?rt:ot;return e.jsxs("button",{className:`mode-option ${l===C.path?"selected":""}`,type:"button",onClick:()=>Te(C.path),children:[e.jsx("img",{className:"mode-icon",src:V,width:24,height:24,alt:""}),e.jsx("span",{children:C.version||"(Untitled)"})]},C.path)})}),document.body)]}),b&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:B,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ze,"aria-label":"Map Info",title:"Map Info","aria-expanded":L,children:e.jsx(ht,{size:20})}),L&&Pe.createPortal(e.jsx("div",{ref:_,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${k}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[b.artist||"Artist"," – ",b.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",b.mapper||"Unknown"]}),b.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",b.version]}),b.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${b.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]}):e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(ee,{to:"/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/feed"||t.pathname.startsWith("/feed/")?"active":""}`,"aria-label":"Feed",children:e.jsx($e,{size:20})}),e.jsx(ee,{to:"/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(ft,{size:20})}),e.jsx(ee,{to:"/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/queues"||t.pathname.startsWith("/queues/")?"active":""}`,"aria-label":"Queues",children:e.jsx(gt,{size:20})})]}),e.jsx(ee,{to:"/",className:"mobile-bottom-nav-coin-flip","aria-label":"Home",title:"Go to home",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"m!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(ee,{to:"/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(Ve,{size:20}),ie>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:ye,onTouchStart:be,onTouchEnd:i,onMouseDown:be,onMouseUp:fe,onMouseLeave:fe,"aria-label":X!=null&&X.is_mod||X!=null&&X.is_admin?"Settings (long press for moderation)":"Settings",title:X!=null&&X.is_mod||X!=null&&X.is_admin?"Settings (long press for moderation)":"Settings",children:e.jsx(xt,{size:20})})]})]})}function us(){return e.jsx(ee,{to:"/feed",className:"title",style:{textDecoration:"none",color:"inherit"},children:"mappi"})}function ms({isEditor:t}){return ke(),t?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ee,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(vt,{size:18})}),e.jsx(ee,{to:"/feed",className:"title",children:"osu!editi.ng"})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:4},children:e.jsx(us,{})})}function ps({isNeutralPage:t}){const a=ke().pathname;return t&&a!=="/"?e.jsx("nav",{className:"nav-links","aria-label":"Primary",children:e.jsx(ee,{to:a==="/about"?"/":"/about",className:a==="/about"?"active":"",children:a==="/about"?"Home":"About"})}):e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[e.jsx(ee,{to:"/feed",className:a==="/feed"||a.startsWith("/feed/")?"active":"",children:"Feed"}),e.jsx(ee,{to:"/discover",className:a==="/discover"?"active":"",children:"Discover"}),e.jsx(ee,{to:"/queues",className:a==="/queues"||a.startsWith("/queues/")?"active":"",children:"Queues"}),e.jsx(ee,{to:"/submissions",className:a==="/submissions"?"active":"",children:"Submissions"}),e.jsx(ee,{to:"/editor",className:a==="/editor"?"active":"",children:"Editor"})]})}function hs(t,n,a,d){const s=Ce(),{notify:o}=we(),[p,j]=h.useState(new Set);return{parseQueueInvite:w=>{if(!w)return null;try{const x=JSON.parse(w);if((x==null?void 0:x.type)==="queue_invite"&&(x!=null&&x.queue_id))return x}catch{}return null},handleAcceptInvite:async(w,x)=>{if(!p.has(w.id)){j(S=>new Set(S).add(w.id));try{await D(F.moddi.queueAccept(String(x)),{method:"POST"}),o("Invitation accepted!",{variant:"success"}),a.mutate(w.id),d(!1),s(`/md/queues/${x}`)}catch(S){o((S==null?void 0:S.message)||"Failed to accept invitation",{variant:"error"})}finally{j(S=>{const f=new Set(S);return f.delete(w.id),f})}}},handleDenyInvite:async(w,x)=>{if(!p.has(w.id)){j(S=>new Set(S).add(w.id));try{await D(F.moddi.queueDeny(String(x)),{method:"POST"}),o("Invitation declined",{variant:"success"}),a.mutate(w.id)}catch(S){o((S==null?void 0:S.message)||"Failed to decline invitation",{variant:"error"})}finally{j(S=>{const f=new Set(S);return f.delete(w.id),f})}}},handleMarkAllRead:async()=>{const w=t.filter(x=>x.id.startsWith("n:")||x.kind==="system"&&!x.read).map(x=>x.id);w.length>0&&n.mutate(w)},handleNotificationClick:async w=>{d(!1),n.mutate([w.id]);const x=typeof w.targetPath=="string"&&w.targetPath.trim().length>0?w.targetPath:null;if(x&&s(x),w.kind==="system"||w.id.startsWith("n:"))try{await D(F.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[w.id]})})}catch{}},handleDeleteNotification:async(w,x)=>{w.stopPropagation(),a.mutate(x)},processing:p}}function fs({notifications:t,unreadCount:n,notifOpen:a,setNotifOpen:d,markReadMutation:s,deleteNotificationMutation:o,closeAllPanels:p}){const j=h.useRef(null),c=h.useRef(null),{parseQueueInvite:N,handleAcceptInvite:r,handleDenyInvite:m,handleMarkAllRead:g,handleNotificationClick:y,handleDeleteNotification:w,processing:x}=hs(t,s,o,d);st(j,c,a,()=>d(!1));const S=t.filter(f=>!(f.kind==="system"&&f.id.startsWith("b:")&&(f.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:j,className:"icon-link",onClick:()=>{a||p(),d(!a)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Ve,{size:18})}),n>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),a&&e.jsxs("div",{ref:c,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(ee,{to:"/notifications",onClick:()=>d(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:f=>f.currentTarget.style.opacity="1",onMouseLeave:f=>f.currentTarget.style.opacity="0.7",children:"View all"}),S.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:g,children:e.jsx(Le,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[S.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),S.map(f=>{const z=N(f.text),$=f.id.startsWith("b:"),T=z?"queue-invite":f.kind==="star"?"star":f.kind==="likes5"?"likes":f.kind==="comment"?"comment":f.kind==="inspiration"?"inspiration":f.kind==="reaction"?"reaction":$?"global":"system",H=f.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${T}`,role:"button",onClick:()=>!z&&y(f),children:[e.jsxs("div",{className:`notif-icon ${H?"deletable":""}`,"aria-hidden":"true",onClick:H&&!z?I=>w(I,f.id):void 0,title:H&&!z?"Remove":void 0,role:H&&!z?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:z?e.jsx(bt,{}):T==="star"?e.jsx(yt,{}):T==="likes"?e.jsx(jt,{}):T==="comment"?e.jsx(Be,{}):T==="inspiration"?e.jsx(Be,{}):T==="reaction"?e.jsx(Nt,{}):T==="global"?e.jsx(wt,{}):null}),H&&!z?e.jsx("span",{className:"swap-trash",children:e.jsx(kt,{})}):null]}),e.jsx("div",{className:"notif-body",children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[z.inviter_username," invited you to join queue: ",z.queue_name]}),x.has(f.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:I=>{I.stopPropagation(),r(f,z.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Le,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:I=>{I.stopPropagation(),m(f,z.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Xe,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):f.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:$?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:e.jsx(_e,{text:f.text||""})}),$&&f.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(f.expiresAt).toLocaleString()]}):null]}):f.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:e.jsx(_e,{text:f.text||"Someone commented on your post"})})]}):f.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:e.jsx(_e,{text:f.text||"Someone is inspired by you!"})})]}):f.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:e.jsx(_e,{text:f.text||"Someone raised their hand on your post!"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:f.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:f.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},f.id)})]})]})]})}function gs({quota:t,nowTick:n}){if(!(t!=null&&t.blocked))return null;const a=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),d=Math.floor(a/3600),s=Math.floor(a%3600/60),o=a%60,p=c=>String(c).padStart(2,"0"),j=d>0?`${d}:${p(s)}:${p(o)}`:`${s}:${p(o)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(St,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:j})]})}function xs({me:t,menuOpen:n,setMenuOpen:a,onLogout:d,closeAllPanels:s}){const o=h.useRef(null),p=h.useRef(null);return st(o,p,n,()=>a(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:o,className:"icon-link",onClick:()=>{n||s(),a(!n)},title:t.username,"aria-label":"User menu","aria-expanded":n,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(De,{size:14,style:{opacity:.8}})]}),n&&e.jsxs("div",{ref:p,className:"menu-panel",role:"menu",children:[e.jsx(ee,{to:"/profile",className:"menu-item",onClick:()=>a(!1),children:"Profile"}),e.jsx(ee,{to:"/settings",className:"menu-item",onClick:()=>a(!1),children:"Settings"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(ee,{to:"/moderation",className:"menu-item",onClick:()=>a(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:d,children:"Log out"})]})]})}function vs({isNeutralPage:t,isEditor:n}){const a=ke(),d=Ce(),{data:s,isLoading:o}=ve(),{data:p}=$t(!!s),{data:j=[]}=Bt(!!s),c=tt(),N=Ot(),r=at(),m=Ht(),{menuOpen:g,notifOpen:y,setMenuOpen:w,setNotifOpen:x,closeAllPanels:S,previousLocation:f,lastSection:z}=xe(),$=a.pathname==="/settings",T=a.pathname==="/moderation",H=a.pathname==="/profile"||a.pathname.startsWith("/profile/"),I=$||T||H,l=()=>{d(f||"/feed")},[W,B]=v.useState(0);return v.useEffect(()=>{const _=setInterval(()=>B(L=>L+1),1e3);return()=>clearInterval(_)},[]),e.jsxs("header",{className:"top-nav",children:[I&&e.jsx("button",{onClick:l,className:"icon-link",title:"Go back","aria-label":"Go back",style:{width:"auto",height:"auto",padding:"4px",marginRight:4},children:e.jsx(Fe,{size:18})}),e.jsx(ms,{isEditor:n}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),a.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Zt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{isNeutralPage:t}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(_t,{size:18})}),s?e.jsxs("div",{className:"user-menu",children:[e.jsx(fs,{notifications:j,unreadCount:c,notifOpen:y,setNotifOpen:x,markReadMutation:r,deleteNotificationMutation:m,closeAllPanels:S}),e.jsx(gs,{quota:p,nowTick:W}),e.jsx(xs,{me:s,menuOpen:g,setMenuOpen:w,onLogout:()=>N.mutate(),closeAllPanels:S})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Ae+F.auth.login},disabled:o,children:o?"Checking…":"Login with osu!"})]})]})}function bs({title:t,onRefresh:n}){const{data:a}=ve(),d=ke(),s=Ce(),{lastSection:o}=xe(),[p,j]=v.useState(!0),[c,N]=v.useState(0),[r,m]=v.useState(!1),g=v.useRef(!1),y=v.useRef(0),[w,x]=v.useState(!1),S=v.useRef(null),{data:f=[]}=Qt(),z=at(),{notify:$}=we();v.useEffect(()=>{const l=document.querySelector(".page");if(!l)return;let W=l.scrollTop,B=!1;const _=()=>{B||(B=!0,requestAnimationFrame(()=>{const L=l.scrollTop,E=L-W;L<=12||E<-12?j(!0):E>12&&j(!1),W=L,B=!1}))};return l.addEventListener("scroll",_,{passive:!0}),()=>l.removeEventListener("scroll",_)},[]),v.useEffect(()=>{const l=document.querySelector(".page");if(!l)return;const W=120,B=70,_=M=>{var b;r||(l.scrollTop<=0?(g.current=!0,y.current=((b=M.touches[0])==null?void 0:b.clientY)??0):g.current=!1)},L=M=>{var J;if(!g.current||r)return;const b=((J=M.touches[0])==null?void 0:J.clientY)??0,q=Math.max(0,b-y.current);if(q>0){const u=Math.min(W,q*.5);N(u)}},E=async()=>{try{if(m(!0),n)await n();else{window.location.reload();return}}finally{setTimeout(()=>{m(!1),N(0)},400)}},k=()=>{!g.current||r||(c>=B?E():N(0),g.current=!1)};return l.addEventListener("touchstart",_,{passive:!0}),l.addEventListener("touchmove",L,{passive:!0}),l.addEventListener("touchend",k),l.addEventListener("touchcancel",k),()=>{l.removeEventListener("touchstart",_),l.removeEventListener("touchmove",L),l.removeEventListener("touchend",k),l.removeEventListener("touchcancel",k)}},[c,r,n]);const{showBack:T,onBack:H}=v.useMemo(()=>{const l=d.pathname;if(/^\/mp\/feed\/.+/.test(l))return{showBack:!0,onBack:()=>s("/mp/feed")};if(/^\/md\/feed\/.+/.test(l))return{showBack:!0,onBack:()=>s("/md/feed")};if(/^\/md\/queues\/.+/.test(l))return{showBack:!0,onBack:()=>s("/md/queues")};if(l==="/profile"||l.startsWith("/profile/")){const W=o==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?s(-1):s(W)}}}return{showBack:!1,onBack:()=>{}}},[d.pathname,s,o]),I=d.pathname==="/notifications";return e.jsxs("div",{className:`mobile-page-header ${p?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${p?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:T?e.jsx("button",{className:"icon-link",onClick:H,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Fe,{size:18})}):e.jsx(ee,{to:"/profile",className:"icon-link","aria-label":"Profile",children:a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"var(--hover-overlay-strong)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:I?e.jsx("button",{className:"icon-link","aria-label":"Mark all read",title:"Mark all read",style:{padding:4},onClick:()=>{const l=f.filter(W=>!W.read&&(W.id.startsWith("n:")||W.kind==="system"&&!W.id.startsWith("b:"))).map(W=>W.id);l.length!==0&&z.mutate(l,{onSuccess:()=>{$("All notifications marked as read",{variant:"success"})}})},children:e.jsx(Le,{size:18})}):(()=>{const l=d.pathname;let W=null;return l==="/mp/feed"?W="mappi-feed":l==="/md/feed"?W="moddi-feed":l==="/md/queues"?W="moddi-queues":l.startsWith("/md/queues/")&&(W="moddi-queue-detail"),W?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:S,className:"icon-link","aria-haspopup":"dialog","aria-expanded":w,onClick:()=>x(B=>!B),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(Ct,{size:18})}),w&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(Kt,{context:W,onClose:()=>x(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:r||c>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(c,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${r?"spin":c>60?"ready":""}`})})]})}function ys({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function js(){const t=ke(),{notify:n}=we(),{data:a}=ve(),{setPreviousLocation:d}=xe(),s=t.pathname,o=s==="/"||s==="/about",p=s==="/editor";v.useEffect(()=>{s==="/settings"||s==="/moderation"||s==="/profile"||s.startsWith("/profile/")||d(s)},[s,d]);const[j,c]=v.useState(null);v.useEffect(()=>{!a||!a.is_mod||(async()=>{try{const m=await D(F.admin.debugState,{requireAuth:!1}),g=Array.isArray(m==null?void 0:m.counts)?m.counts.find(y=>String(y.status)==="ready"):null;g&&c(Number(g.c)||0)}catch{}})()},[a]),v.useEffect(()=>{a&&!localStorage.getItem("welcomed")&&(n(`Welcome, ${a.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[a,n]),v.useEffect(()=>{if(typeof window>"u"||!he()||s==="/editor")return;const g=document.querySelector(".page");g&&(g.scrollTop=0)},[s]);const{showMobileHeader:N,headerTitle:r}=v.useMemo(()=>{if(s==="/"||s==="/about"||s==="/editor"||s==="/discover"||s==="/mobile")return{showMobileHeader:!1,headerTitle:""};if(s==="/feed"||s.startsWith("/feed/"))return{showMobileHeader:!0,headerTitle:s==="/feed"?"Feed":"Post"};if(s==="/queues"||s.startsWith("/queues/"))return{showMobileHeader:!0,headerTitle:s==="/queues"?"Queues":"Queue"};if(s==="/submissions")return{showMobileHeader:!0,headerTitle:"Submissions"};if(s==="/notifications")return{showMobileHeader:!0,headerTitle:"Notifications"};if(s==="/profile"||s.startsWith("/profile/"))return{showMobileHeader:!0,headerTitle:"Profile"};if(s==="/settings")return{showMobileHeader:!0,headerTitle:"Settings"};if(s==="/moderation")return{showMobileHeader:!0,headerTitle:"Moderation"};if(s.startsWith("/mp/")||s.startsWith("/md/")){const m=s.split("/").filter(Boolean),g=m[1]||"";if(g==="feed")return{showMobileHeader:!0,headerTitle:m.length>2?"Post":"Feed"};if(g==="discover")return{showMobileHeader:!1,headerTitle:""};if(g==="queues")return{showMobileHeader:!0,headerTitle:m.length>2?"Queue":"Queues"}}return{showMobileHeader:!0,headerTitle:""}},[s]);return e.jsxs("div",{className:"app-shell",children:[e.jsx(ds,{paused:s==="/editor"}),e.jsx(vs,{isNeutralPage:o,isEditor:p}),e.jsxs("main",{className:`page ${s==="/editor"||s==="/discover"?"fullscreen":""}`,children:[N&&e.jsx(bs,{title:r}),s==="/about"?e.jsx("div",{className:"card",children:e.jsx(Oe,{})}):e.jsx(Oe,{})]}),s!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(ys,{readyCount:j})}),s!=="/mobile"&&e.jsx(cs,{})]})}const Ns="theme";function ws(){try{const t=localStorage.getItem(Ns);if(t==="light"||t==="dark")return t}catch{}return null}function lt(t){if(!(typeof document>"u")){document.documentElement.setAttribute("data-theme",t);try{const n=document.querySelector('meta[name="theme-color"]');n&&(n.content=t==="light"?"#ffffff":"#1a1a1a")}catch{}}}function ks(t="dark"){const n=ws()||t;lt(n)}function Ss(){const{data:t,isLoading:n}=ve(),a=!!t,d=Ce(),{lastSection:s}=xe(),[o,p]=v.useState(!1);return v.useEffect(()=>{if(typeof window>"u")return;const j=localStorage.getItem("hide_mobile_install_prompt")==="1",c=he()&&!Re()&&!j;p(c)},[]),v.useEffect(()=>{Re()&&d("/feed",{replace:!0})},[d]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
        }
        
        .landing-btn-secondary {
          background: var(--panel);
          color: var(--text);
          border: 1px solid var(--border);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: var(--border-strong);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsx("div",{className:"landing-actions landing-actions-desktop",children:e.jsx(ee,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})}),!a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Ae+F.auth.login},disabled:n,children:n?"Checking…":"Login with osu!"})}),a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx(ee,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})})]})]}),o&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{p(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(ee,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}function Qe(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}const _s=({open:t,onClose:n,videoId:a,initialDescription:d,initialBeatmapUrl:s,onSave:o})=>{const[p,j]=h.useState(d||""),[c,N]=h.useState(s||""),[r,m]=h.useState(null),[g,y]=h.useState(null),[w,x]=h.useState(""),[S,f]=h.useState(!1),z=h.useRef(0);h.useEffect(()=>{t&&(j(d||""),N(s||""),m(null),y(null),x(""))},[t,d,s]),h.useEffect(()=>{if(!t)return;z.current&&window.clearTimeout(z.current);const T=(c||"").trim();if(!T){x(""),m(null),y(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(T)){x(""),m(null),y(null);return}return z.current=window.setTimeout(async()=>{var I;try{let l;try{l=new URL(T)}catch{x("Invalid URL format");return}const W=l.hash.match(/#osu\/(\d+)/),B=W?W[1]:null;l.hash="";const L={url:l.toString()};B&&(L.beatmap_id=B);const E=await D(F.osu.resolveBeatmap+Ne(L),{requireAuth:!1}),k=Array.isArray(E==null?void 0:E.diffs)?E.diffs:[];if(!k.length&&!E.setId){x("No difficulties found"),m(null),y(null);return}if(m({setId:Number(E.setId)||0,beatmapId:E.beatmapId??null,title:String(E.title||""),artist:String(E.artist||""),mapper:String(E.mapper||""),diffs:k}),k.length>0){const M=Number.isFinite(Number(E.beatmapId))?Number(E.beatmapId):Number((I=k[0])==null?void 0:I.id),b=k.find(J=>Number(J.id)===M)||k[0],q=Qe(b==null?void 0:b.mode);y({beatmapId:Number(b==null?void 0:b.id)||null,version:String((b==null?void 0:b.version)||""),mode:q})}x("")}catch(l){x(`Failed to resolve: ${(l==null?void 0:l.message)||"Unknown error"}`),m(null),y(null)}},400),()=>{z.current&&window.clearTimeout(z.current)}},[c,t]);const $=async()=>{if(!S){f(!0);try{await D(F.videos.update(a),{method:"PATCH",body:JSON.stringify({description:p.slice(0,100),beatmap_url:c.trim()||void 0})});const T=!!c.trim();if(r||!T)try{await D(F.videos.update(a)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:T&&r&&r.setId>0?r.setId:null,beatmap_id:T&&(g!=null&&g.beatmapId)?g.beatmapId:null,beatmap_version:T&&(g!=null&&g.version)?g.version:null,beatmap_title:T&&(r!=null&&r.title)?r.title:null,beatmap_artist:T&&(r!=null&&r.artist)?r.artist:null,beatmap_mapper:T&&(r!=null&&r.mapper)?r.mapper:null,beatmap_url:T?c.trim():null})})}catch(I){console.warn("Failed to update beatmap metadata:",I)}o(p,c.trim()||null),n()}catch(T){alert((T==null?void 0:T.message)||"Failed to update post")}finally{f(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:T=>T.target===T.currentTarget&&n(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:n}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:n,"aria-label":"Close",children:e.jsx(Xe,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:p,onChange:T=>j(T.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),r?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[r.artist," – ",r.title]}),e.jsxs("span",{className:"muted",children:["by ",r.mapper]})]}),e.jsx("select",{value:(g==null?void 0:g.beatmapId)??r.beatmapId??void 0,onChange:T=>{const H=Number(T.target.value),I=(r==null?void 0:r.diffs.find(l=>Number(l.id)===H))||null;if(I){const l=Qe(I.mode);y({beatmapId:H,version:I.version,mode:l})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"},children:r.diffs.map(T=>e.jsxs("option",{value:T.id,children:[T.version," (",T.mode,")"]},T.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{m(null),y(null),N("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:T=>N(T.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}}),w&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:w})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:n,disabled:S,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:$,disabled:S,children:S?"Saving...":"Save"})]})]})]})]}):null};function Ke(){const t=Tt(),n=Ce(),{notify:a}=we(),[d,s]=h.useState(null),[o,p]=h.useState(null),[j,c]=h.useState(""),[N,r]=h.useState([]),[m,g]=h.useState([]),[y,w]=h.useState([]),[x,S]=h.useState(""),[f,z]=h.useState(null),[$,T]=h.useState([]),[H,I]=h.useState(null),[l,W]=h.useState(""),[B,_]=h.useState([]),[L,E]=h.useState(null),[k,M]=h.useState(!1),b=h.useMemo(()=>{const u=t.id?Number(t.id):null;return u?d?d.id===u:!1:!0},[t.id,d]);function q(u){const R=u.stream_uid||String(u.id),A=t.id?`/profile/${t.id}`:"/profile";n(`/mp/feed/${R}`,{state:{returnTo:A}})}h.useEffect(()=>{(async()=>{try{const u=await D(F.auth.me,{requireAuth:!1});s(u),u&&Array.isArray(u.inspirations)&&T(u.inspirations)}catch(u){c((u==null?void 0:u.message)||"Not logged in")}})()},[]),h.useEffect(()=>{(async()=>{try{const u=t.id?Number(t.id):null;if(u){const R=await D(F.users.get(u),{requireAuth:!1});p(R),S(R.about||""),Array.isArray(R.inspirations)&&T(R.inspirations);const A=await D(F.users.videos(u)+Ne({limit:"60"}),{requireAuth:!1});w(A.items||[]);const te=await D(F.users.likes(u)+Ne({limit:"60"}),{requireAuth:!1});g(te.items||[])}else{if(!d)return;p(d),S(d.about||""),Array.isArray(d.inspirations)&&T(d.inspirations);const R=await D(F.users.myVideos+Ne({limit:"50"}),{requireAuth:!1});r(R.items||[]);const A=await D(F.users.likes(d.id)+Ne({limit:"60"}),{requireAuth:!1});g(A.items||[])}}catch{}})()},[t.id,d]),h.useEffect(()=>{M(!1)},[o==null?void 0:o.id]);async function J(u){try{const A=(await D(F.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:u})})).user||o;p(A),Array.isArray(A==null?void 0:A.inspirations)&&T(A.inspirations),t.id||s(A)}catch{}}return h.useEffect(()=>{let u;return H!==null&&l.trim().length>=2?u=setTimeout(async()=>{try{const R=await D(F.osu.usersSearch(l),{requireAuth:!1});_(Array.isArray(R.items)?R.items:[])}catch{}},250):_([]),()=>{u&&clearTimeout(u)}},[l,H]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:o?e.jsxs(e.Fragment,{children:[o.avatar_url&&e.jsx("img",{src:o.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[o.username,o.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${o.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:u=>u.currentTarget.style.opacity="1",onMouseLeave:u=>u.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",o.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!b&&$.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),$.map((u,R)=>b?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(u.id),onMouseLeave:()=>E(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const A=$.filter((te,ie)=>ie!==R);T(A),J(A)},children:e.jsx("img",{src:u.avatar_url,alt:u.username})}),L===u.id&&e.jsxs("div",{className:"insp-tooltip",children:[u.username," — click to remove"]})]},u.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(u.id),onMouseLeave:()=>E(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${u.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:u.avatar_url,alt:u.username})}),L===u.id&&e.jsx("div",{className:"insp-tooltip",children:u.username})]},u.id)),b&&$.length<3&&new Array(3-$.length).fill(0).map((u,R)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(-R-1),onMouseLeave:()=>E(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{I(R),W(""),_([])},children:"+"}),L===-R-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),H===R&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:l,onChange:A=>W(A.target.value)}),e.jsxs("div",{className:"insp-results",children:[B.length===0&&l.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),B.map(A=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(d&&Number(d.osu_user_id)===Number(A.id)){a("Kinda based, but no.",{variant:"warn"}),I(null);return}if($.some(ie=>ie.id===A.id)){I(null);return}const te=[...$,{id:A.id,username:A.username,avatar_url:A.avatar_url}].slice(0,3);T(te),I(null),J(te)},children:[e.jsx("img",{src:A.avatar_url,alt:"avatar"}),e.jsx("span",{children:A.username})]},A.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>I(null),children:"Close"})]})]},`slot-${R}`))]}),b&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:j||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),b?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:x,onChange:u=>S(u.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const u=await D(F.auth.me,{method:"PATCH",body:JSON.stringify({about:x})});p(u.user||o),s(u.user||d)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(Le,{size:16})})]})}):(()=>{const u=((o==null?void 0:o.about)||"").trim()||"No bio.",R=u.length>200,A=R&&!k?u.slice(0,200)+"...":u;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:A}),R&&e.jsx("button",{onClick:()=>M(!k),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(Ze,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(De,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:u=>{const R=u.currentTarget.closest(".profile-tabs-unified");R.querySelectorAll(".profile-tab").forEach(te=>{te.classList.remove("active"),te.setAttribute("aria-selected","false")}),u.currentTarget.classList.add("active"),u.currentTarget.setAttribute("aria-selected","true"),R.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:u=>{const R=u.currentTarget.closest(".profile-tabs-unified");R.querySelectorAll(".profile-tab").forEach(te=>{te.classList.remove("active"),te.setAttribute("aria-selected","false")}),u.currentTarget.classList.add("active"),u.currentTarget.setAttribute("aria-selected","true"),R.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(b?N:y).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(b?N:y).map(u=>(b&&o?(o.id,o.username,o.avatar_url,o.is_admin,o.is_mod):u.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>q({...u}),children:[u.poster_url?e.jsx("img",{className:"recent-thumb",src:u.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Mt,{size:12}),e.jsx("span",{children:u.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Lt,{size:12}),e.jsx("span",{children:u.comments_count??0})]})]})})]},u.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[m.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),m.map(u=>{var R,A;return e.jsxs("button",{className:"recent-cell",onClick:()=>q(u),children:[u.poster_url?e.jsx("img",{className:"recent-thumb",src:u.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((R=u.uploader)==null?void 0:R.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:u.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(A=u.uploader)==null?void 0:A.username})]})]},u.id)})]})})})]})]}),f&&e.jsx(_s,{open:!!f,onClose:()=>z(null),videoId:f.id,initialDescription:f.description,initialBeatmapUrl:f.beatmap_url,onSave:(u,R)=>{r(N.map(A=>A.id===f.id?{...A,description:u||null,beatmap_url:R}:A)),z(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: var(--hover-overlay); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid var(--divider); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed var(--divider); background: transparent; color: var(--text); font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: var(--border-strong); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid var(--divider);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid var(--divider); border-radius: 10px; padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel-dark); color: var(--text); outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: var(--text); cursor: pointer; text-align: left; }
        .insp-result:hover { background: var(--hover-overlay); border-color: var(--divider); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--divider); background: var(--hover-overlay); color: var(--text); cursor: pointer; }
      `})]})}function Cs(){var R,A,te,ie,X,re,le,be,fe,ye;const[t,n]=h.useState(null),[a,d]=h.useState([]),[s,o]=h.useState(""),[p,j]=h.useState([]),[c,N]=h.useState(null),[r,m]=h.useState([]),[g,y]=h.useState("all"),[w,x]=h.useState("approvals"),[S,f]=h.useState(null),[z,$]=h.useState(""),[T,H]=h.useState(!1),{notify:I}=we(),[l,W]=h.useState(null),[B,_]=h.useState(!1);h.useEffect(()=>{(async()=>{try{const i=await D(F.auth.me,{requireAuth:!1});if(n(i),i!=null&&i.is_admin)try{const P=await D(F.admin.settingsModeration,{requireAuth:!1});f(!!P.require_approval)}catch{}}catch{}try{const i=await D(F.admin.videosPending+Ne({limit:"50"}),{requireAuth:!1});d(i.items||[])}catch{}})()},[]);async function L(){_(!0);try{const i=await D(F.admin.analytics,{requireAuth:!1});W(i)}finally{_(!1)}}async function E(){try{const i=await D(F.admin.usersSearch(s),{requireAuth:!1});j(i.items||[])}catch{}}async function k(i){N(i),m([]);try{const P=await D(F.admin.userVideos(i.id)+Ne({limit:"50"}),{requireAuth:!1});m(P.items||[])}catch{}}async function M(i,P){try{const ne=await D(F.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_mod:P})}),ae=(ne==null?void 0:ne.user)||{...i,is_mod:P};I(P?"Granted moderation":"Revoked moderation",{variant:P?"success":"warn"}),N(ae),j(p.map(oe=>oe.id===i.id?ae:oe))}catch{alert("Failed to update")}}const b=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),q=!!(t!=null&&t.is_admin);if(!b)return e.jsx("div",{className:"muted",style:{padding:20},children:"You do not have access."});const J=a.filter(i=>!i.flagged_only),u=a.filter(i=>!!i.flagged_only);return e.jsxs("div",{className:"moderation-container",children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:he()?"nowrap":"wrap",gap:he()?"2px":"4px",overflowX:he()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":w==="approvals",className:`profile-tab ${w==="approvals"?"active":""}`,"data-tab":"approvals",onClick:i=>{const P=i.currentTarget.closest(".profile-tabs-unified");P.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),P.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),x("approvals")},children:"Approvals"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":w==="manage",className:`profile-tab ${w==="manage"?"active":""}`,"data-tab":"manage",onClick:i=>{const P=i.currentTarget.closest(".profile-tabs-unified");P.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),P.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),x("manage")},children:"Manage"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":w==="analytics",className:`profile-tab ${w==="analytics"?"active":""}`,"data-tab":"analytics",onClick:i=>{const P=i.currentTarget.closest(".profile-tabs-unified");P.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),P.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),x("analytics"),l||L()},children:"Analytics"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":w==="message",className:`profile-tab ${w==="message"?"active":""}`,"data-tab":"message",onClick:i=>{const P=i.currentTarget.closest(".profile-tabs-unified");P.querySelectorAll(".profile-tab").forEach(ae=>{ae.classList.remove("active"),ae.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),P.querySelector(".profile-tabs-content").setAttribute("data-active","message"),x("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":w,children:[e.jsx("div",{className:"panel approvals",hidden:w!=="approvals",children:e.jsxs("div",{className:"moderation-grid",style:{paddingTop:16},children:[e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Pending approvals"}),e.jsx("div",{className:"moderation-column-count",children:J.length})]}),J.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),J.map(i=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:e.jsx(_e,{text:i.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.username}),i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await D(F.admin.videosReject(i.id),{method:"POST"}),d(a.filter(P=>P.id!==i.id)),I("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await D(F.admin.videosApprove(i.id),{method:"POST"}),d(a.filter(P=>P.id!==i.id)),I("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await D(F.videos.delete(i.id),{method:"DELETE"}),d(a.filter(P=>P.id!==i.id)),I("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))]}),e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Flagged (FYI)"}),e.jsx("div",{className:"moderation-column-count",children:u.length})]}),u.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),u.map(i=>e.jsxs("div",{className:"moderation-video-card flagged",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:e.jsx(_e,{text:i.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.username}),e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"mod-card-actions",children:e.jsx("button",{className:"btn secondary compact",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await D(F.videos.delete(i.id),{method:"DELETE"}),d(a.filter(P=>P.id!==i.id)),I("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},i.id)),u.length>0&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:w!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:s,onChange:i=>o(i.target.value),onKeyDown:i=>{i.key==="Enter"&&E()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:E,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:p.map(i=>e.jsxs("button",{className:`moderation-user-result ${(c==null?void 0:c.id)===i.id?"selected":""}`,onClick:()=>k(i),children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),i.is_admin?e.jsx("span",{className:"chip info",children:"admin"}):i.is_mod?e.jsx("span",{className:"chip success",children:"mod"}):i.is_blacklisted?e.jsx("span",{className:"chip error",children:"blacklisted"}):null]},i.id))})})]}),c?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:24},children:[e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[c.avatar_url&&e.jsx("img",{src:c.avatar_url,width:64,height:64,style:{borderRadius:"50%",flexShrink:0,border:"2px solid var(--border)"}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"title",style:{fontSize:"24px"},children:c.username}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["id ",c.id," • osu ",c.osu_user_id]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[q&&!c.is_admin&&(c.is_mod?e.jsx("button",{className:"btn secondary compact",onClick:()=>M(c,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary compact",onClick:()=>M(c,!0),children:"Grant moderation"})),!c.is_admin&&(c.is_blacklisted?e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await D(F.admin.userUpdate(c.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),N({...c,is_blacklisted:!1}),I("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await D(F.admin.userUpdate(c.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),N({...c,is_blacklisted:!0}),I("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]})]})]}),e.jsxs("div",{className:"col",style:{gap:16},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:`btn compact ${g==="all"?"primary":"secondary"}`,onClick:()=>y("all"),children:"All"}),e.jsx("button",{className:`btn compact ${g==="review"?"primary":"secondary"}`,onClick:()=>y("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[r.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),e.jsx("div",{className:"col",style:{gap:12},children:r.filter(i=>{if(g==="all")return!0;const P=(S?!i.approved_at:!1)&&i.status==="ready",ne=!!i.needs_review;return P||ne}).map(i=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.status.toUpperCase()}),e.jsxs("span",{className:"muted",children:["• ",new Date(i.created_at*1e3).toLocaleDateString()]}),i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,S&&!i.approved_at&&i.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]}),e.jsxs("div",{className:"row",style:{gap:4,marginTop:4},children:[e.jsx("span",{style:{color:"var(--accent)",fontSize:14},children:"★"}),e.jsx("span",{className:"muted",style:{fontSize:13},children:i.likes_count??0})]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[(q||(t==null?void 0:t.is_mod))&&(!!i.needs_review||S&&!i.approved_at&&i.status==="ready")&&e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await D(F.admin.videosApprove(i.id),{method:"POST"}),m(r.map(P=>P.id===i.id?{...P,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:P)),I("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(q||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await D(F.videos.delete(i.id),{method:"DELETE"}),m(r.filter(P=>P.id!==i.id)),I("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))})]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center",border:"1px dashed var(--border)",borderRadius:"12px"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:w!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:s,onChange:i=>o(i.target.value),onKeyDown:i=>{i.key==="Enter"&&E()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:E,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:p.map(i=>e.jsxs("button",{className:`moderation-user-result ${(c==null?void 0:c.id)===i.id?"selected":""}`,onClick:()=>N(i),children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),(c==null?void 0:c.id)===i.id&&e.jsx("span",{className:"chip info",children:"selected"})]},i.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:T,onChange:i=>H(i.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",fontFamily:"inherit"},value:z,onChange:i=>$(i.target.value)}),e.jsx("button",{className:"btn primary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const i=(z||"").trim();if(!i){alert("Enter a message");return}(async()=>{try{const P={text:i,global:T};!T&&(c!=null&&c.id)&&(P.user_id=c.id),await D(F.admin.notificationsSystem,{method:"POST",body:JSON.stringify(P)}),$(""),I("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:w!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Analytics"}),B&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!B&&!l&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(pe,{label:"Users",value:l.totals.users_total}),e.jsx(pe,{label:"Admins",value:l.totals.users_admin}),e.jsx(pe,{label:"Mods",value:l.totals.users_mod}),e.jsx(pe,{label:"Blacklisted",value:l.totals.users_blacklisted}),e.jsx(pe,{label:"Videos",value:l.totals.videos_total}),e.jsx(pe,{label:"Ready",value:l.totals.videos_ready}),e.jsx(pe,{label:"Pending",value:l.totals.pending_count}),e.jsx(pe,{label:"Purgatory",value:l.totals.purgatory_count}),e.jsx(pe,{label:"Likes",value:l.totals.likes_total}),e.jsx(pe,{label:"Flags",value:l.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Ie,{title:"New users (30d)",series:l.series.users,color:"#60a5fa"}),e.jsx(Ie,{title:"New videos (30d)",series:l.series.videos,color:"#34d399"}),(A=(R=l.stream)==null?void 0:R.graphql)!=null&&A.minutes_viewed?e.jsx(Ie,{title:"Minutes viewed (30d)",series:l.stream.graphql.minutes_viewed,color:"#f59e0b"}):e.jsxs("div",{className:"moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:he()?13:14},children:"Minutes viewed (30d)"}),e.jsx("div",{className:"muted",style:{fontSize:he()?11:12},children:"Data unavailable"})]}),e.jsxs("div",{className:"col",style:{padding:"24px",gap:12},children:[e.jsx("div",{className:"muted",style:{textAlign:"center",fontSize:14},children:"Minutes viewed data is not currently available."}),((ie=(te=l.stream)==null?void 0:te.graphql)==null?void 0:ie.errors)&&Array.isArray(l.stream.graphql.errors)&&l.stream.graphql.errors.length>0&&e.jsxs("div",{className:"col",style:{gap:8,padding:"12px",background:"var(--panel-dark)",borderRadius:8,border:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:600,color:"var(--danger)"},children:"Error details:"}),l.stream.graphql.errors.map((i,P)=>e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.5,fontFamily:"monospace"},children:typeof i=="string"?i:(i==null?void 0:i.message)||JSON.stringify(i)},P)),((re=(X=l.stream)==null?void 0:X.graphql)==null?void 0:re.raw)&&e.jsxs("div",{className:"col",style:{gap:4,marginTop:8,paddingTop:8,borderTop:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:11,fontWeight:600},children:"Debug info:"}),l.stream.graphql.raw.account_keys&&l.stream.graphql.raw.account_keys.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:10,fontFamily:"monospace"},children:["Available account fields: ",l.stream.graphql.raw.account_keys.join(", ")]}),l.stream.graphql.raw.response_sample&&e.jsxs("details",{style:{fontSize:10},children:[e.jsx("summary",{className:"muted",style:{cursor:"pointer",marginTop:4},children:"Response sample"}),e.jsx("pre",{style:{fontSize:9,overflow:"auto",maxHeight:"200px",marginTop:4,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:4},children:l.stream.graphql.raw.response_sample})]})]})]}),!((le=l.stream)!=null&&le.graphql)&&e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",padding:"8px",background:"var(--panel-dark)",borderRadius:8},children:"GraphQL API not configured. Set CF_GRAPHQL_API_TOKEN secret."})]})]})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",l.feed.count," items in rotation",l.feed.cursor?` • cursor ${l.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",l.stream.approximate.total_duration_sec," • ready videos: ",l.stream.approximate.videos_ready]}),l.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",l.stream.api.ok?"ok":"unavailable",(fe=(be=l.stream.api)==null?void 0:be.result_info)!=null&&fe.count?` • count ${l.stream.api.result_info.count}`:"",(ye=l.stream.api)!=null&&ye.sample_status?` • sample status ${String(l.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})}function pe({label:t,value:n}){return e.jsxs("div",{className:"moderation-stat-card",children:[e.jsx("div",{className:"mod-stat-label",children:t}),e.jsx("div",{className:"mod-stat-value",children:n})]})}function Ie({title:t,series:n,color:a}){const[d,s]=h.useState(()=>he()),o=v.useRef(null),[p,j]=h.useState(400);h.useEffect(()=>{const _=()=>{if(s(he()),o.current){const E=o.current.offsetWidth-48;j(Math.max(300,E))}};_();let L=null;return o.current&&typeof ResizeObserver<"u"&&(L=new ResizeObserver(_),L.observe(o.current)),window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_),L&&o.current&&L.unobserve(o.current)}},[]);const c=d?Math.min(400,Math.max(300,window.innerWidth-48)):Math.max(400,Math.min(1e3,p)),N=160,r=8,m=8,g=28,y=d?36:42,w=n.map(_=>_.count),x=Math.max(1,...w),S=h.useMemo(()=>{const _=x,L=Math.pow(10,Math.floor(Math.log10(_))),E=_/L;return(E<=1?1:E<=2?2:E<=5?5:10)*L},[x]),f=c-y-m,z=N-r-g,$=h.useMemo(()=>n.map((_,L)=>{const E=y+L/Math.max(1,n.length-1)*f,k=r+(1-_.count/(S||1))*z;return[E,k]}),[n,S,f,z]),T=h.useMemo(()=>$.map((_,L)=>L===0?`M ${_[0]} ${_[1]}`:`L ${_[0]} ${_[1]}`).join(" "),[$]),H=[0,.25,.5,.75,1],I=h.useMemo(()=>{if(n.length===0)return[];const _=[0,.25,.5,.75,1].map(L=>Math.min(n.length-1,Math.round(L*(n.length-1))));return Array.from(new Set(_))},[n]),l=_=>{if(!_||_.length<10)return _||"";const L=_.slice(5,7).replace(/^0/,""),E=_.slice(8,10).replace(/^0/,"");return`${L}/${E}`};function W(_){const L=Number.isInteger(_);return _>=1e6?`${(_/1e6).toFixed(1).replace(/\.0$/,"")}M`:_>=1e3?`${(_/1e3).toFixed(1).replace(/\.0$/,"")}k`:L?String(_):_<10?_.toFixed(1):_.toFixed(1).replace(/\.0$/,"")}const B=n.length?n[n.length-1].count:0;return e.jsxs("div",{className:"moderation-chart-card",ref:o,children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:d?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:d?11:12},children:["latest: ",W(B)]})]}),e.jsx("div",{style:{width:"100%"},children:e.jsxs("svg",{width:c,height:N,role:"img","aria-label":t,style:{display:"block",width:`${c}px`,height:`${N}px`,maxWidth:"100%"},children:[e.jsx("rect",{x:0,y:0,width:c,height:N,rx:12,style:{fill:"var(--panel-dark)"}}),H.map((_,L)=>{const E=r+(1-_)*z,k=_*S;return e.jsxs("g",{children:[e.jsx("line",{x1:y,y1:E,x2:c-m,y2:E,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:y-6,y:E+4,textAnchor:"end",fontSize:10,style:{fill:"var(--muted)"},children:W(k)})]},L)}),e.jsx("line",{x1:y,y1:r,x2:y,y2:r+z,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),e.jsx("line",{x1:y,y1:r+z,x2:y+f,y2:r+z,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),I.map((_,L)=>{var k;const E=y+_/Math.max(1,n.length-1)*f;return e.jsxs("g",{children:[e.jsx("line",{x1:E,y1:r,x2:E,y2:r+z,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:E,y:r+z+12,textAnchor:"middle",fontSize:10,style:{fill:"var(--muted)"},children:l((k=n[_])==null?void 0:k.day)})]},L)}),e.jsx("path",{d:T,fill:"none",stroke:a,strokeWidth:2}),$.length>0&&e.jsx("circle",{cx:$[$.length-1][0],cy:$[$.length-1][1],r:3,fill:a})]})})]})}function Ts(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Es(t){const n="=".repeat((4-t.length%4)%4),a=(t+n).replace(/-/g,"+").replace(/_/g,"/"),d=atob(a),s=new Uint8Array(d.length);for(let o=0;o<d.length;o++)s[o]=d.charCodeAt(o);return s}async function Me(){return!("serviceWorker"in navigator)||!("PushManager"in window)?null:(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function Ms(){try{const t=await fetch(`${Ae}/api/push/public_key`,{credentials:"include"});if(!t.ok)return null;const n=await t.json().catch(()=>null);return n&&typeof n.publicKey=="string"?n.publicKey:null}catch{return null}}async function Ls(t){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)||await Notification.requestPermission()!=="granted")return!1;const a=await navigator.serviceWorker.ready;let d=await a.pushManager.getSubscription();d||(d=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Es(t)}));try{await D(F.user.pushSubscribe,{method:"POST",body:JSON.stringify({...d.toJSON(),ua:navigator.userAgent})})}catch{}return!0}async function As(){const t=await Me();if(!t)return!0;try{await D(F.user.pushUnsubscribe,{method:"POST",body:JSON.stringify({endpoint:t.endpoint})})}catch{}try{await t.unsubscribe()}catch{}return!0}function zs(){const{theme:t,setTheme:n}=xe(),{data:a}=ve(),{notify:d}=we(),[s,o]=v.useState("general"),[p,j]=v.useState(!1),[c,N]=v.useState(!1),[r,m]=v.useState(!1),[g,y]=v.useState(typeof Notification<"u"?Notification.permission:"default"),w=x=>{n(x),lt(x)};return v.useEffect(()=>{j(typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),N(Re()),Me().then(x=>m(!!x)).catch(()=>m(!1)),typeof Notification<"u"&&y(Notification.permission)},[]),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("div",{className:"settings-title",children:"Settings"}),e.jsx("div",{className:"settings-description",children:"Personalize appearance and app behavior."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Settings",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Settings tabs",children:[e.jsx("button",{role:"tab","aria-selected":s==="general",className:`profile-tab ${s==="general"?"active":""}`,"data-tab":"general",onClick:x=>{const S=x.currentTarget.closest(".profile-tabs-unified"),f=S==null?void 0:S.querySelector(".profile-tabs-content");f==null||f.setAttribute("data-active","general"),o("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":s==="notifications",className:`profile-tab ${s==="notifications"?"active":""}`,"data-tab":"notifications",onClick:x=>{const S=x.currentTarget.closest(".profile-tabs-unified"),f=S==null?void 0:S.querySelector(".profile-tabs-content");f==null||f.setAttribute("data-active","notifications"),o("notifications")},children:"Notifications"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":s,children:[e.jsx("div",{className:"panel general",hidden:s!=="general",children:e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Appearance"}),e.jsx("span",{className:"settings-section-desc",children:"Customize how the app looks on this device."})]}),e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Theme"}),e.jsx("span",{className:"settings-sublabel",children:"Select your preferred color scheme"})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("div",{className:"theme-toggle-group",role:"group","aria-label":"Theme selection",children:[e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="dark"?"active":""}`,"aria-pressed":t==="dark",onClick:()=>w("dark"),children:"Dark"}),e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="light"?"active":""}`,"aria-pressed":t==="light",onClick:()=>w("light"),children:"Light"})]})})]})]})}),e.jsx("div",{className:"panel notifications",hidden:s!=="notifications",children:e.jsxs("div",{className:"col",style:{gap:24},children:[e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Push Notifications"}),e.jsx("span",{className:"settings-section-desc",children:"Manage push alerts for this device."})]}),!p&&e.jsx("div",{className:"settings-hint",children:"Push notifications are not supported on this device."}),p&&e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Push Alerts"}),e.jsx("span",{className:"settings-sublabel",children:g==="granted"&&r?"Enabled on this device":"Disabled on this device"}),!c&&e.jsx("div",{className:"settings-hint",style:{marginTop:4},children:"On iOS, install the app to your Home Screen to enable push."})]}),e.jsx("div",{className:"settings-action",children:g!=="granted"||!r?e.jsx("button",{className:"btn primary compact",onClick:async()=>{const x=await Ms();if(!x)return;await Ls(x),y(typeof Notification<"u"?Notification.permission:"default");const S=await Me();m(!!S)},title:c?void 0:"On iOS, install as PWA to enable",children:"Enable"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{await As();const x=await Me();m(!!x),y(typeof Notification<"u"?Notification.permission:"default")},children:"Disable"})})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Preferences"}),e.jsx("span",{className:"settings-section-desc",children:"Choose which activities trigger notifications."})]}),e.jsx(Ps,{})]})]})})]})]})]})}function Ps(){const{notify:t}=we(),[n,a]=v.useState(!0),[d,s]=v.useState(!1),[o,p]=v.useState({star:!0,likes5:!0,comment:!0,inspiration:!0,reaction:!0,system:!0,invites:!0});v.useEffect(()=>{(async()=>{a(!0);try{const r=await D(F.user.notifPrefs,{requireAuth:!0});r&&r.prefs&&p(m=>({...m,...r.prefs}))}finally{a(!1)}})()},[]);async function j(r){s(!0);try{await D(F.user.notifPrefs,{method:"POST",body:JSON.stringify(r)}),t("Preferences saved",{variant:"success"})}catch(m){t((m==null?void 0:m.message)||"Failed to save",{variant:"error"})}finally{s(!1)}}function c(r){const m={...o,[r]:!o[r]};p(m),j(m)}const N=({k:r,label:m,desc:g})=>e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:m}),g&&e.jsx("span",{className:"settings-sublabel",children:g})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("label",{className:"settings-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:o[r],onChange:()=>c(r),"aria-label":`Toggle ${m}`}),e.jsx("span",{className:"settings-toggle-slider"})]})})]});return n?e.jsx("div",{className:"settings-hint",children:"Loading preferences…"}):e.jsxs(e.Fragment,{children:[e.jsx(N,{k:"star",label:"Stars",desc:"When someone stars your map"}),e.jsx(N,{k:"likes5",label:"Likes milestone",desc:"When you reach 5+ likes"}),e.jsx(N,{k:"comment",label:"Comments",desc:"When someone comments on your post"}),e.jsx(N,{k:"inspiration",label:"Inspirations",desc:"When someone is inspired by you"}),e.jsx(N,{k:"reaction",label:"Reactions",desc:"When someone reacts to your comment"}),e.jsx(N,{k:"invites",label:"Queue invitations",desc:"When you are invited to a queue"}),e.jsx(N,{k:"system",label:"System messages",desc:"Important announcements"}),d&&e.jsx("div",{className:"settings-hint",style:{marginTop:8},children:"Saving…"})]})}const Is=()=>(h.useEffect(()=>()=>{es.clearAll()},[]),e.jsx(ts,{}));function Rs(){const[t,n]=v.useState({mobile:!1,standalone:!1,platform:""}),[a,d]=v.useState("ios");return v.useEffect(()=>{const s=typeof navigator<"u"&&navigator.userAgent||"",o=/iPad|iPhone|iPod/i.test(s)||/(Macintosh).*Mobile/.test(s),p=/Android/i.test(s),j=o?"ios":p?"android":"other";n({mobile:he(),standalone:!1,platform:j}),d(j==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":a==="ios",className:`profile-tab ${a==="ios"?"active":""}`,"data-tab":"ios",onClick:s=>{const o=s.currentTarget.closest(".profile-tabs-unified");o.querySelectorAll(".profile-tab").forEach(j=>{j.classList.remove("active"),j.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),o.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),d("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":a==="android",className:`profile-tab ${a==="android"?"active":""}`,"data-tab":"android",onClick:s=>{const o=s.currentTarget.closest(".profile-tabs-unified");o.querySelectorAll(".profile-tab").forEach(j=>{j.classList.remove("active"),j.setAttribute("aria-selected","false")}),s.currentTarget.classList.add("active"),s.currentTarget.setAttribute("aria-selected","true"),o.querySelector(".profile-tabs-content").setAttribute("data-active","android"),d("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":a,children:[e.jsx("div",{className:"panel",hidden:a!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:a!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const Je={standard:ot,taiko:it,mania:nt,catch:rt},Ge={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},Fs=({value:t,onChange:n})=>{const[a,d]=h.useState(!1),s=h.useRef(null);h.useEffect(()=>{if(!a)return;const p=c=>{s.current&&!s.current.contains(c.target)&&d(!1)},j=c=>{c.key==="Escape"&&d(!1)};return document.addEventListener("mousedown",p),document.addEventListener("keydown",j),()=>{document.removeEventListener("mousedown",p),document.removeEventListener("keydown",j)}},[a]);const o=p=>e.jsxs("button",{className:`mode-option${p===t?" selected":""}`,onClick:()=>{n(p),d(!1)},role:"option","aria-selected":p===t,children:[e.jsx("img",{className:"mode-icon",src:Je[p],width:24,height:24,alt:""}),e.jsx("span",{children:Ge[p]})]},p);return e.jsxs("div",{className:"mode-select",ref:s,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":a,onClick:()=>d(p=>!p),children:[e.jsx("img",{className:"mode-icon",src:Je[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:Ge[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),a&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(o)})]})};function Ye(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}function Ds({section:t,onUpload:n,onPost:a,forceExpanded:d}){const{notify:s}=we(),o=t==="mappi",[p,j]=h.useState(!1),[c,N]=h.useState(""),[r,m]=h.useState(null),[g,y]=h.useState(null),[w,x]=h.useState(!1),[S,f]=h.useState(""),z=h.useRef(0),[$,T]=h.useState(""),[H,I]=h.useState("standard"),[l,W]=h.useState(null),[B,_]=h.useState(0),[L,E]=h.useState(""),[k,M]=h.useState(""),[b,q]=h.useState(null),[J,u]=h.useState(""),[R,A]=h.useState(""),[te,ie]=h.useState(null),[X,re]=h.useState(!1),[le,be]=h.useState(null),fe=100*1024*1024,ye=h.useMemo(()=>l?`${l.name}:${l.size}:${l.lastModified}`:null,[l]),[i,P]=h.useState(""),[ne,ae]=h.useState(!1),[oe,Te]=h.useState([]),ze=h.useRef(null);h.useEffect(()=>{z.current&&window.clearTimeout(z.current);const U=(c||"").trim();if(!U){f(""),m(null),y(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(U)){f(""),m(null),y(null);return}return z.current=window.setTimeout(async()=>{var O;try{let G;try{G=new URL(U)}catch{f("Invalid URL format");return}const ue=G.hash.match(/#osu\/(\d+)/),se=ue?ue[1]:null;G.hash="";const We={url:G.toString()};se&&(We.beatmap_id=se);const ce=await D(F.osu.resolveBeatmap+Ne(We),{requireAuth:!1}),Se=Array.isArray(ce==null?void 0:ce.diffs)?ce.diffs:[];if(!Se.length&&!ce.setId){f("No difficulties found"),m(null),y(null);return}if(m({setId:Number(ce.setId)||0,beatmapId:ce.beatmapId??null,title:String(ce.title||""),artist:String(ce.artist||""),mapper:String(ce.mapper||""),diffs:Se}),Se.length>0){const dt=Number.isFinite(Number(ce.beatmapId))?Number(ce.beatmapId):Number((O=Se[0])==null?void 0:O.id),ge=Se.find(ct=>Number(ct.id)===dt)||Se[0],Ue=Ye(ge==null?void 0:ge.mode);y({beatmapId:Number(ge==null?void 0:ge.id)||null,version:String((ge==null?void 0:ge.version)||""),mode:Ue}),o&&I(Ue)}else y(null);f("")}catch(G){const ue=(G==null?void 0:G.message)||"Unknown error";f(`Failed to resolve: ${ue}`),m(null),y(null)}},400),()=>{z.current&&window.clearTimeout(z.current)}},[c,o]);async function C(){return M("info"),E("Requesting upload URL..."),await D(F.uploads.new,{method:"POST",body:JSON.stringify({description:$.slice(0,100),beatmap_url:c||void 0,size_bytes:(l==null?void 0:l.size)??void 0,mode:H,beatmapset_id:(r==null?void 0:r.setId)??void 0,beatmap_id:(g==null?void 0:g.beatmapId)??void 0,beatmap_version:(g==null?void 0:g.version)??void 0,beatmap_title:r?`${r.title}`:void 0,beatmap_artist:r?`${r.artist}`:void 0,beatmap_mapper:r?`${r.mapper}`:void 0})})}async function V(U,Q,O="form"){await new Promise((G,ue)=>{const se=new XMLHttpRequest;if(se.open("POST",U),se.upload.onprogress=de=>{de.lengthComputable&&_(Math.round(de.loaded/de.total*100))},se.onload=()=>se.status>=200&&se.status<300?G():ue(new Error(`Upload failed (${se.status}) ${se.responseText||""}`)),se.onerror=()=>ue(new Error("Network error")),O==="form"){const de=new FormData;de.append("file",Q,Q.name),se.send(de)}else se.setRequestHeader("Content-Type","application/octet-stream"),se.send(Q)})}async function Y(){if(!(!l||!o)){if(l.size>fe){u("File exceeds 100MB limit");return}if(typeof te=="number"&&te>60.5){A("Clip exceeds 60s limit");return}ye&&(re(!0),be(ye)),_(0),M("info");try{const U=await C();q(U.streamUID);let Q=U.streamUID;try{E("Uploading..."),await V(U.uploadURL,l,"form")}catch(O){M("warn"),E(`Retrying upload... (${(O==null?void 0:O.message)||O})`);const G=await C();q(G.streamUID),Q=G.streamUID,await V(G.uploadURL,l,"binary")}M("info"),E("Processing...");for(let O=0;O<60;O++){await new Promise(G=>setTimeout(G,3e3));try{if((await D(F.videos.get(Q),{requireAuth:!1})).status==="ready"){M("success"),E("Ready!"),s("Upload complete!",{variant:"success"}),W(null),T(""),N(""),m(null),y(null),I("standard"),_(0),q(null),u(""),A(""),ie(null),re(!1),be(null),n&&n();break}}catch{}}}catch(U){M("error"),E(U.message||"Error"),s(U.message||"Upload failed",{variant:"error"})}}}const K=async U=>{if(U.preventDefault(),!o){if(!i.trim()){s("Text is required",{variant:"error"});return}if(i.length>200){s("Text must be 200 characters or less",{variant:"error"});return}ae(!0);try{const Q=await D(F.moddi.posts,{method:"POST",body:JSON.stringify({text:i.trim(),beatmap_url:c.trim()||void 0,beatmapset_id:(r==null?void 0:r.setId)??void 0,beatmap_id:(g==null?void 0:g.beatmapId)??(r==null?void 0:r.beatmapId)??void 0,beatmap_version:(g==null?void 0:g.version)??void 0,tags:oe.length>0?oe.join(","):void 0})});if(Q){console.log("Post created response:",Q);const O=Q==null?void 0:Q.post;O?(!O.uid&&O.id&&(console.warn("Created post missing uid, using id as fallback:",O),O.uid=String(O.id)),a&&a(O)):a&&a(),s("Post created!",{variant:"success"}),P(""),N(""),m(null),y(null),f(""),x(!1),Te([])}}catch{s("Failed to create post",{variant:"error"})}finally{ae(!1)}}},Ee=!!d||p;return e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:o?12:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:d?"default":"pointer",padding:"8px 12px",minHeight:36},onClick:()=>{d||j(!p)},children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:o?"Upload a clip":"Create a post!"}),Ee?e.jsx(Ze,{size:16}):e.jsx(De,{size:16})]}),Ee&&e.jsx("div",{style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.4,marginBottom:12},children:"Max: 60s, 100MB. Only osu! mapping content is permitted."}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Game mode:"}),e.jsx(Fs,{value:H,onChange:I})]}),r?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[r.artist," – ",r.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",r.mapper]})]}),r.diffs.length>0&&e.jsx("select",{value:(g==null?void 0:g.beatmapId)??r.beatmapId??void 0,onChange:U=>{const Q=Number(U.target.value),O=(r==null?void 0:r.diffs.find(G=>Number(G.id)===Q))||null;if(O){const G=Ye(O.mode);y({beatmapId:Q,version:O.version,mode:G}),I(G)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"4px 8px",fontSize:12},children:r.diffs.map(U=>e.jsxs("option",{value:U.id,children:[U.version," (",U.mode,")"]},U.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>x(!0),style:{padding:"6px 12px",fontSize:13},children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{m(null),y(null),N("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:U=>N(U.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:$,onChange:U=>T(U.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:64}}),S&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:S}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("input",{type:"file",accept:"video/*",onChange:U=>{var G;const Q=((G=U.target.files)==null?void 0:G[0])||null;if(W(Q),ie(null),Q&&Q.size>fe?u("File exceeds 100MB limit"):u(""),Q)try{const ue=URL.createObjectURL(Q),se=document.createElement("video");se.preload="metadata",se.src=ue,se.onloadedmetadata=()=>{URL.revokeObjectURL(ue);const de=Number.isFinite(se.duration)?se.duration:NaN;Number.isFinite(de)&&ie(de),Number.isFinite(de)&&de>60.5?A("Clip exceeds 60s limit"):A("")},se.onerror=()=>{URL.revokeObjectURL(ue),ie(null)}}catch{ie(null)}else A("");const O=Q?`${Q.name}:${Q.size}:${Q.lastModified}`:null;O&&O!==le&&re(!1)},style:{flex:1,minWidth:0}}),e.jsx("button",{className:"btn",onClick:Y,disabled:!l||!!J||!!R||X,style:{flexShrink:0},children:"Upload"})]}),J&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:J}),R&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:R}),l&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Selected: ",l.name," • ",(l.size/1024/1024).toFixed(1)," MB",X&&le===ye?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(locked)"}):null]}),(B>0||L)&&e.jsxs("div",{className:"upload-status",children:[L&&e.jsx("div",{className:`chip ${k||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:L}),B>0&&e.jsx("div",{className:"progress",style:{marginTop:8},"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":B,children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,Math.max(0,B))}%`}})})]}),b&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Stream UID: ",b]})]})]}):e.jsx("form",{onSubmit:K,children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("textarea",{ref:ze,placeholder:"Ask for feedback! Or, say anything! Woo! (max 200 chars)",value:i,onChange:U=>P(U.target.value),maxLength:200,rows:2,style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:50}}),r?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[r.artist," – ",r.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",r.mapper]})]}),r.diffs.length>0&&e.jsx("select",{value:(g==null?void 0:g.beatmapId)??r.beatmapId??void 0,onChange:U=>{const Q=Number(U.target.value),O=(r==null?void 0:r.diffs.find(G=>Number(G.id)===Q))||null;O&&y({beatmapId:Q,version:O.version,mode:String(O.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:r.diffs.map(U=>e.jsxs("option",{value:U.id,children:[U.version," (",U.mode,")"]},U.id))})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:c,onChange:U=>N(U.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),S&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:S}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("span",{className:"muted",style:{fontSize:11},children:"Tags:"}),e.jsx("button",{type:"button",onClick:()=>{oe.includes("help")?Te(oe.filter(U=>U!=="help")):Te([...oe,"help"])},style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:oe.includes("help")?"rgba(234, 179, 8, 0.2)":"rgba(255,255,255,0.05)",border:oe.includes("help")?"1px solid rgba(234, 179, 8, 0.4)":"1px solid rgba(255,255,255,0.12)",color:oe.includes("help")?"#fbbf24":"var(--text)",fontWeight:500,lineHeight:1.2,cursor:"pointer",transition:"all 0.15s ease"},children:"Help"})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>x(!0),children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{m(null),y(null),N("")},children:"Clear"})]}),e.jsx("button",{type:"submit",className:"btn",disabled:ne||!i.trim()||i.length>200,children:ne?"Posting...":"Post"})]})]})})}),w&&r&&e.jsx(ss,{open:w,onClose:()=>x(!1),downloadUrl:F.osu.downloadBeatmapset(r.setId),beatmapId:(g==null?void 0:g.beatmapId)??r.beatmapId??void 0,beatmapVersion:g==null?void 0:g.version})]})}function Ws(){const{data:t}=ve(),{modeFilters:n}=xe(),a=Object.entries(n).filter(([s,o])=>o).map(([s])=>s),d=a.length?a.join(","):"standard";return et({queryKey:["mappi","feed",d],queryFn:async({pageParam:s=0})=>{const o=new URLSearchParams({limit:"20",offset:String(s),modes:d}),p=`${F.feed.recent}?${o.toString()}`;return await D(p)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,o)=>{var c;const p=o.reduce((N,r)=>{var m;return N+(((m=r.items)==null?void 0:m.length)||0)},0);return(((c=s.items)==null?void 0:c.length)||0)===20?p:void 0}})}function Us(){const{data:t}=ve(),{tagFilters:n}=xe();return et({queryKey:["moddi","feed",n],queryFn:async({pageParam:a=0})=>{const d=new URLSearchParams({limit:"20",offset:String(a)}),s=`${F.moddi.posts}?${d.toString()}`;return await D(s)},enabled:!!t,initialPageParam:0,getNextPageParam:(a,d)=>{var p;const s=d.reduce((j,c)=>{var N;return j+(((N=c.items)==null?void 0:N.length)||0)},0);return(((p=a.items)==null?void 0:p.length)||0)===20?s:void 0}})}function qs(){const t=ke(),n=At(),{data:a}=ve(),{modeFilters:d,tagFilters:s}=xe(),{data:o,fetchNextPage:p,hasNextPage:j,isFetching:c,isFetchingNextPage:N,refetch:r}=Ws(),{data:m,fetchNextPage:g,hasNextPage:y,isFetching:w,isFetchingNextPage:x,refetch:S}=Us(),f=h.useMemo(()=>(o==null?void 0:o.pages.flatMap(k=>k.items||[]))||[],[o]),z=h.useMemo(()=>m!=null&&m.pages?m.pages.flatMap(k=>(k.items||[]).map(b=>({...b,user_id:b.user_id??0,username:b.username||"Unknown",avatar_url:b.avatar_url||null,text:b.text??null,uid:b.uid||String(b.id||""),reactions_count:Number(b.reactions_count??0),reacted_by_me:b.reacted_by_me??!1,comments_count:Number(b.comments_count??0),_type:"moddi"}))):[],[m]),$=h.useMemo(()=>{const M=[...f.map(b=>({...b,_type:"mappi"})),...z];return M.sort((b,q)=>{const J=b.created_at||0;return(q.created_at||0)-J}),M},[f,z]),T=h.useMemo(()=>$.filter(k=>{if(k._type==="mappi"){const M=Object.entries(d).filter(([J,u])=>u).map(([J])=>J.toLowerCase());if(M.length===0)return!0;const b=new Set(M),q=String(k.mode||"standard").toLowerCase();return b.has(q)}else{const M=k.tags?typeof k.tags=="string"?k.tags.split(",").map(J=>J.trim()):[]:[],b=!M.length,q=M.includes("help");return s.untagged&&s.help?!0:s.untagged&&!s.help?b:!s.untagged&&s.help?q:!0}}),[$,d,s]);h.useEffect(()=>{t.pathname==="/feed"&&(r(),S())},[t.pathname,r,S]);const H=k=>{n.setQueryData(["mappi","feed"],M=>M&&{...M,pages:M.pages.map(b=>({...b,items:b.items.map(q=>q.id===k.id?k:q)}))})},I=k=>{n.setQueryData(["moddi","feed"],M=>M&&{...M,pages:M.pages.map(b=>({...b,items:b.items.map(q=>q.id===k.id?k:q)}))})},l=k=>{n.setQueryData(["mappi","feed"],M=>M&&{...M,pages:M.pages.map(b=>({...b,items:b.items.filter(q=>q.id!==k)}))}),n.setQueryData(["moddi","feed"],M=>M&&{...M,pages:M.pages.map(b=>({...b,items:b.items.filter(q=>q.id!==k)}))})},W=()=>{r()},B=k=>{k&&n.setQueryData(["moddi","feed"],M=>{if(!M)return M;const b={...k,user_id:k.user_id??0,username:k.username||"Unknown",avatar_url:k.avatar_url||null,text:k.text??null,uid:k.uid||String(k.id||""),reactions_count:Number(k.reactions_count??0),reacted_by_me:k.reacted_by_me??!1,comments_count:Number(k.comments_count??0)};return{...M,pages:M.pages.map((q,J)=>J===0?{...q,items:[b,...q.items||[]]}:q)}}),n.invalidateQueries({queryKey:["moddi","feed"]}),S()},_=c&&!N||w&&!x,L=j||y,E=()=>{j&&p(),y&&g()};return e.jsxs("div",{className:"feed-container unified-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Share your mapping journey - upload clips or ask for feedback!"}),e.jsx(Ds,{section:"mappi",onUpload:W,onPost:B})]}),e.jsx(Jt,{context:"unified-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[T.length===0&&!_&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to share something!"}),T.map(k=>e.jsx(Dt,{post:k,section:k._type,onUpdate:k._type==="mappi"?H:I,onDelete:l,me:a},`${k._type}-${k.id}`)),T.length>0&&L&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:E,disabled:N||x,children:N||x?"Loading...":"Load more"})})]})})]})}const $s=v.lazy(()=>ns(()=>import("./Discover-7oJKseK6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));ks("dark");Wt();"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t=encodeURIComponent(Ae);navigator.serviceWorker.register(`/sw.js?api=${t}`).then(n=>{console.log("Service Worker registered successfully:",n.scope)}).catch(n=>{console.error("Service Worker registration failed:",n)})});const Bs=()=>e.jsx(Rt,{children:e.jsxs(Z,{element:e.jsx(js,{}),children:[e.jsx(Z,{path:"/",element:e.jsx(Ss,{})}),e.jsx(Z,{path:"/feed",element:e.jsx(qs,{})}),e.jsx(Z,{path:"/feed/:uid",element:e.jsx(qt,{})}),e.jsx(Z,{path:"/discover",element:e.jsx(h.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx($s,{})})}),e.jsx(Z,{path:"/queues",element:e.jsx(Gt,{})}),e.jsx(Z,{path:"/queues/:id",element:e.jsx(Yt,{})}),e.jsx(Z,{path:"/submissions",element:e.jsx(Vt,{})}),e.jsx(Z,{path:"/mp/feed",element:e.jsx(je,{to:"/feed",replace:!0})}),e.jsx(Z,{path:"/mp/feed/:uid",element:e.jsx(je,{to:"/feed/:uid",replace:!0})}),e.jsx(Z,{path:"/mp/discover",element:e.jsx(je,{to:"/discover",replace:!0})}),e.jsx(Z,{path:"/md/feed",element:e.jsx(je,{to:"/feed",replace:!0})}),e.jsx(Z,{path:"/md/feed/:uid",element:e.jsx(je,{to:"/feed/:uid",replace:!0})}),e.jsx(Z,{path:"/md/queues",element:e.jsx(je,{to:"/queues",replace:!0})}),e.jsx(Z,{path:"/md/queues/:id",element:e.jsx(je,{to:"/queues/:id",replace:!0})}),e.jsx(Z,{path:"/md/submissions",element:e.jsx(je,{to:"/submissions",replace:!0})}),e.jsx(Z,{path:"/notifications",element:e.jsx(Xt,{})}),e.jsx(Z,{path:"/profile",element:e.jsx(Ke,{})}),e.jsx(Z,{path:"/profile/:id",element:e.jsx(Ke,{})}),e.jsx(Z,{path:"/moderation",element:e.jsx(Cs,{})}),e.jsx(Z,{path:"/about",element:e.jsx(Ts,{})}),e.jsx(Z,{path:"/settings",element:e.jsx(zs,{})}),e.jsx(Z,{path:"/mobile",element:e.jsx(Rs,{})}),e.jsx(Z,{path:"/editor",element:e.jsx(Is,{})})]})}),Os=()=>e.jsx(It,{children:e.jsx(Bs,{})});zt(document.getElementById("root")).render(e.jsx(os,{children:e.jsx(Pt,{client:rs,children:e.jsx(Ut,{children:e.jsx(Os,{})})})}));export{ds as B,ns as _};
