import{r as o,R as se,i as at,j as s,b as ct,a as lt,L as Ye,p as dt,D as ut,E as ft,G as We,I as pt,J as Xe,A as mt,c as ht}from"./vendor-react-_vsaDC62.js";import{P as gt}from"./Popup-CFfQp2Um.js";import{P as xt}from"./beatmap-preview-Da_UNwHS.js";import{C as bt}from"./Comment-Bso0enpb.js";import{u as yt,B as wt}from"./index-9S1n6eri.js";import"./vendor-DBgzFpze.js";import"./editor-lib-Cf56EpaA.js";import"./editor-components-CKFEosPJ.js";const m="https://api.osumappi.ng",x={};function _t(){var Ve,Be,He;const[v,k]=o.useState(x.history||[]),[p,E]=o.useState(x.index||-1),n=p>=0?v[p]:null,[V,ke]=o.useState(!1),[qe,Se]=o.useState(!1),[Je,Re]=o.useState(!1),[re,B]=o.useState(!1),oe=se.useRef(null),[ie,ae]=o.useState(!1),ce=se.useRef(null),[S,Ge]=o.useState(null),[le,L]=o.useState(!1),[de,H]=o.useState(!1),ue=se.useRef(null),fe=se.useRef(null),[f,pe]=o.useState(!1),[Ce,Ie]=o.useState([]),[F,Y]=o.useState(""),[me,he]=o.useState(null),[ge,Ee]=o.useState(!1),[R,C]=o.useState(!0),{notify:y}=yt(),[w,D]=o.useState(x.queue||[]),I=o.useRef(x.seenIds||new Set),_e=o.useRef(new Set),xe=o.useRef(!1),Te=o.useRef(null),[Ne,P]=o.useState(x.eligibleCount||null),[$e,U]=o.useState(x.viewedCount||0),[_,T]=o.useState(!1),j=o.useRef(x.lastShownVideoId||null);o.useEffect(()=>()=>{x.history=v,x.index=p,x.queue=w,x.seenIds=I.current,x.eligibleCount=Ne,x.viewedCount=$e,x.lastShownVideoId=j.current},[v,p,w,Ne,$e]);function N(e){var t;return(t=document.cookie.split("; ").map(r=>r.split("=")).find(([r])=>r===e))==null?void 0:t[1]}function Qe(){try{const e=Array.from(I.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function W(){try{const e=localStorage.getItem("filter_modes"),t=(e?String(e):"standard").toLowerCase().split(",").map(a=>a.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],i=Array.from(new Set(t.filter(a=>r.includes(a))));return i.length?i:["standard"]}catch{return["standard"]}}const Ke=()=>{const e=new Set;return j.current!==null&&e.add(j.current),Array.from(I.current).slice(-200).forEach(r=>e.add(r)),w.forEach(r=>e.add(r.id)),Array.from(e)},Me=async(e=5)=>{if(xe.current)return[];xe.current=!0;try{const t=Ke(),r=W().join(",");if(Te.current!==!1){const l=await fetch(`${m}/api/feed/batch?size=${e}&exclude=${encodeURIComponent(t.join(","))}&modes=${encodeURIComponent(r)}`,{credentials:"include"});if(l.status===401)return Re(!0),[];if(l.status===429)return y("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];if(l.status===404)Te.current=!1;else if(l.ok){const d=await l.json(),h=d&&Array.isArray(d.items)?d.items:[],u=new Set,M=h.filter(g=>u.has(g.id)?!1:(u.add(g.id),!0)),je=new Set(w.map(g=>g.id)),te=M.filter(g=>!I.current.has(g.id)&&!je.has(g.id)&&g.id!==j.current);if(te.length>0&&D(g=>{const ne=new Set(g.map(z=>z.id)),A=te.filter(z=>!ne.has(z.id));return[...g,...A]}),te.length===0&&w.length===0)try{const g=await fetch(`${m}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(g.ok){const ne=await g.json(),A=Number(ne.eligible||0),z=Number(ne.viewed||0);P(A),U(z),T(A>0&&z>=A)}}catch{}return te}}const i=[],a=new Set(w.map(l=>l.id));let c=[...t];for(let l=0;l<e;l++)try{const d=await fetch(`${m}/api/feed/next?exclude=${encodeURIComponent(c.join(","))}&modes=${encodeURIComponent(r)}`,{credentials:"include"});if(d.status===401){Re(!0);break}if(d.status===429){y("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(!d.ok)break;const h=await d.json(),u=h&&(h.id?h:h.video);if(!u)break;if(I.current.has(u.id)||a.has(u.id)||u.id===j.current){c.push(u.id);continue}i.push(u),c.push(u.id),a.add(u.id)}catch{break}if(i.length>0&&D(l=>{const d=new Set(l.map(u=>u.id)),h=i.filter(u=>!d.has(u.id));return[...l,...h]}),i.length===0&&w.length===0)try{const l=await fetch(`${m}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(l.ok){const d=await l.json();P(Number(d.eligible||0)),U(Number(d.viewed||0)),T(Number(d.caught_up||0)===1)}}catch{}return i}catch{return[]}finally{xe.current=!1}},X=async()=>{if(!V){ke(!0);try{w.length<=2&&Me(5).catch(()=>{});let e;if(w.length>0)e=w[0],e&&D(t=>t.filter(i=>i.id!==e.id));else{const t=await Me(3);t.length>0&&(e=t[0],t.length>1&&D(r=>{const i=new Set(r.map(c=>c.id)),a=t.slice(1).filter(c=>!i.has(c.id));return[...r,...a]}))}if(e){if(j.current=e.id,I.current.add(e.id),Qe(),k(t=>{const r=[...t.slice(0,p+1),e];return E(r.length-1),r}),!_e.current.has(e.id)){_e.current.add(e.id);const t=N("csrf")||"";try{const r=await fetch(`${m}/api/videos/${e.id}/view`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":t}});if(r.ok){const i=await r.json();i&&k(a=>{const c=[...a],l=c.findIndex(d=>d.id===e.id);return l!==-1&&(c[l]={...c[l],views_count:i.views_count??c[l].views_count??0,viewed_by_me:!0}),c})}}catch{}}}else try{const t=W().join(","),r=await fetch(`${m}/api/feed/progress?modes=${encodeURIComponent(t)}`,{credentials:"include"});if(r.ok){const i=await r.json(),a=Number(i.eligible||0),c=Number(i.viewed||0);P(a),U(c),T(a>0&&c>=a)}}catch{}}finally{ke(!1)}}},be=()=>{p>0&&(E(p-1),L(!1))},ye=()=>{if(!R&&(O.current=!0,Q.current=!0,b.current)){const e=b.current;e.muted=!1,C(!1),e.play().catch(()=>{})}if(p<v.length-1){const e=v[p+1];e&&(j.current=e.id),E(p+1),L(!1);return}_||X()},q=o.useRef(0),J=o.useRef(null),G=o.useRef(null),we=o.useRef({goNext:ye,goPrev:be,index:p,history:v,loading:V,exhausted:_});o.useEffect(()=>{we.current={goNext:ye,goPrev:be,index:p,history:v,loading:V,exhausted:_}},[ye,be,p,v,V,_]),o.useEffect(()=>{const e=Ae.current;if(!e)return;const t=a=>{if(e){const h=e.getBoundingClientRect(),u=a.clientX,M=a.clientY;if(u<h.left||u>h.right||M<h.top||M>h.bottom)return}a.preventDefault(),a.stopPropagation();const c=Date.now();if(c<q.current||(q.current=c+1e3,Math.abs(a.deltaY)<Math.abs(a.deltaX)))return;const{goNext:l,goPrev:d}=we.current;a.deltaY>0?l():d()},r=a=>{J.current=a.touches[0].clientY,G.current=Date.now()},i=a=>{if(J.current===null||G.current===null)return;const c=a.changedTouches[0].clientY,l=Date.now(),d=J.current-c,h=l-G.current;if(J.current=null,G.current=null,Math.abs(d)<50||h>300)return;const u=Date.now();if(u<q.current)return;q.current=u+1e3;const{goNext:M,goPrev:je}=we.current;d>0?M():je()};return e.addEventListener("wheel",t,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",i,{passive:!0}),window.addEventListener("wheel",t,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",t,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",i),window.removeEventListener("wheel",t,{capture:!0})}},[]);const Ze=async()=>{if(n){Se(!0);try{const e=N("csrf")||"",t=n.liked_by_me?"DELETE":"POST",r=await fetch(`${m}/api/videos/${n.id}/like`,{method:t,credentials:"include",headers:{"X-CSRF-Token":e}});if(r.status===429){y("Please slow down a bit.",{durationMs:5e3,variant:"warn"});return}if(r.ok){const i=await r.json();k(a=>{const c=[...a];return c[p]={...c[p],liked_by_me:!n.liked_by_me,likes_count:i.likes_count},c})}}finally{Se(!1)}}};async function ze(e){if(!n)return;const t=N("csrf")||"";(await fetch(`${m}/api/videos/${n.id}/flag`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({reason:e})})).ok?y("Thanks for your report.",{variant:"info"}):y("Report failed",{variant:"error"}),B(!1)}o.useEffect(()=>{if(!re)return;const e=t=>{oe.current&&!oe.current.contains(t.target)&&B(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[re]),o.useEffect(()=>{if(!ie)return;const e=t=>{ce.current&&!ce.current.contains(t.target)&&ae(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ie]),o.useEffect(()=>{if(!de)return;const e=t=>{ue.current&&!ue.current.contains(t.target)&&fe.current&&!fe.current.contains(t.target)&&H(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[de]),o.useEffect(()=>{v.length===0&&X()},[]),o.useEffect(()=>{n&&(j.current=n.id)},[n==null?void 0:n.id]),o.useEffect(()=>{(async()=>{try{const e=W().join(","),t=await fetch(`${m}/api/feed/progress?modes=${encodeURIComponent(e)}`,{credentials:"include"});if(t.ok){const r=await t.json(),i=Number(r.eligible||0),a=Number(r.viewed||0);P(i),U(a);const c=i>0&&a>=i;T(c)}}catch{}})()},[]),o.useEffect(()=>{const e=()=>{k([]),D([]),I.current.clear(),j.current=null,E(-1),T(!1),(async()=>{try{const t=W().join(","),r=await fetch(`${m}/api/feed/progress?modes=${encodeURIComponent(t)}`,{credentials:"include"});if(r.ok){const i=await r.json(),a=Number(i.eligible||0),c=Number(i.viewed||0);P(a),U(c),T(!1)}}catch{}X()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),o.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const t=JSON.parse(e);if(Array.isArray(t))for(const r of t)typeof r=="number"&&I.current.add(r)}}catch{}},[]),o.useEffect(()=>{(async()=>{try{const e=await fetch(`${m}/api/me`,{credentials:"include"});e.ok&&Ge(await e.json())}catch{}})()},[]);const O=o.useRef(!1);o.useEffect(()=>{L(!1),pe(!1),O.current?C(!1):C(!0)},[n==null?void 0:n.id]),o.useEffect(()=>{b.current&&(b.current.muted=R)},[R]),o.useEffect(()=>{if(n&&b.current){const e=setTimeout(()=>{const t=b.current;t&&(!O.current?(t.muted=!0,t.play().catch(i=>{console.debug("Autoplay prevented:",i)})):(t.muted=!1,C(!1),t.play().then(()=>{}).catch(i=>{console.debug("Unmuted play failed, falling back to muted:",i),t.muted=!0,C(!0),t.play().catch(()=>{console.debug("Autoplay prevented:",i)})})))},100);return()=>clearTimeout(e)}},[n==null?void 0:n.id]);const Q=o.useRef(!1),et=e=>{b.current=e,e&&(Q.current&&O.current?(e.muted=!1,C(!1),e.play().then(()=>{Q.current=!1}).catch(()=>{e.muted=!0,C(!0),Q.current=!1,e.play().catch(()=>{})})):e.muted=R)},Le=async()=>{if(n!=null&&n.id)try{const e=await fetch(`${m}/api/videos/${n.id}/comments`,{credentials:"include"});if(e.ok){const t=await e.json();Ie(t.items||[])}}catch{}};o.useEffect(()=>{f&&(n!=null&&n.id)&&Le()},[f,n==null?void 0:n.id]);const Fe=async e=>{if(e.preventDefault(),!(!F.trim()||!(n!=null&&n.id))){Ee(!0);try{const t=N("csrf")||"",r=await fetch(`${m}/api/videos/${n.id}/comments`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":t},body:JSON.stringify({text:F.trim(),parent_id:me||void 0})});if(r.ok)Y(""),he(null),Le(),k(i=>{const a=[...i],c=a.findIndex(l=>l.id===n.id);return c!==-1&&(a[c]={...a[c],comments_count:(a[c].comments_count||0)+1}),a}),y("Comment posted!",{variant:"success"});else{const i=await r.json().catch(()=>({}));y(i.error||"Failed to post comment",{variant:"error"})}}catch{y("Failed to post comment",{variant:"error"})}finally{Ee(!1)}}},tt=e=>{Ie(t=>t.filter(r=>r.id!==e)),k(t=>{const r=[...t],i=r.findIndex(a=>a.id===(n==null?void 0:n.id));return i!==-1&&(r[i]={...r[i],comments_count:Math.max(0,(r[i].comments_count||0)-1)}),r})},De=Ce.filter(e=>!e.parent_id),K=new Map;Ce.filter(e=>e.parent_id).forEach(e=>{const t=e.parent_id;K.has(t)||K.set(t,[]),K.get(t).push(e)});const b=o.useRef(null),Z=o.useRef(null),$=o.useRef(!1),nt=()=>{if(!b.current||$.current)return;const e=b.current,t=!R;C(t),e.muted=t,t||(O.current=!0),!t&&e.paused&&e.play().catch(r=>{console.debug("Play failed after unmute:",r)})},Pe=()=>{b.current&&($.current=!1,Z.current=window.setTimeout(()=>{$.current=!0;const e=b.current;e&&!e.paused&&e.pause()},200))},ve=()=>{if(Z.current&&(clearTimeout(Z.current),Z.current=null),$.current&&b.current){const e=b.current;e.paused&&e.play().catch(t=>console.debug("Resume failed:",t)),$.current=!1}},st=()=>{Pe()},rt=e=>{$.current&&e.preventDefault(),ve()},Ue=!!(S!=null&&S.is_admin||S!=null&&S.is_mod);async function ot(){if(!n)return;const e=N("csrf")||"",t=!n.is_starred,r=t?"star":"unstar";(await fetch(`${m}/api/admin/videos/${n.id}/${r}`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(k(a=>{const c=[...a];return c[p]={...c[p],is_starred:t},c}),ae(!1),y(t?"Post starred":"Star removed",{variant:"success"})):y("Action failed",{variant:"error"})}async function Oe(){if(!n||!confirm("Permanently delete this video?"))return;const e=N("csrf")||"";(await fetch(`${m}/api/videos/${n.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(y("Deleted",{variant:"warn"}),B(!1),k(r=>{const i=r.filter((a,c)=>c!==p);return i.length===0?(E(-1),setTimeout(X,0)):E(a=>Math.max(0,Math.min(a,i.length-1))),i})):alert("Delete failed")}at();const Ae=o.useRef(null),[ee,it]=o.useState(0);return o.useEffect(()=>{const e=()=>{const t=document.querySelector(".top-nav");t&&it(t.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.jsxs(s.Fragment,{children:[s.jsx(wt,{paused:!1}),s.jsxs("div",{ref:Ae,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[_&&s.jsx("div",{className:"chip info",style:{position:"absolute",top:ee+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),s.jsx("div",{className:"video-area",style:{position:"absolute",top:ee,left:0,right:0,bottom:f?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:Je?s.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[s.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),s.jsx("button",{className:"btn",onClick:()=>window.location.href=`${m}/api/auth/login`,children:"Login with osu!"})]}):n?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:le&&n.beatmapset_id?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:s.jsx(xt,{downloadUrl:`${m}/api/osu/beatmapsets/${n.beatmapset_id}/download?noVideo=1`,beatmapId:n.beatmap_id??void 0,beatmapVersion:n.beatmap_version??void 0,onOpenInEditor:()=>{L(!1),window.location.hash="/editor"}})}):s.jsxs("div",{style:{width:f?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:f?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:f?`calc(50vh - ${ee}px)`:`calc(100vh - ${ee}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),s.jsx("div",{style:{position:"relative",zIndex:1},children:s.jsxs("div",{onClick:nt,onMouseDown:Pe,onMouseUp:ve,onMouseLeave:ve,onTouchStart:st,onTouchEnd:rt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[s.jsx(gt,{streamUID:n.stream_uid,playbackUrl:n.playback_url,aspectRatio:n!=null&&n.width&&(n!=null&&n.height)?n.width/n.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:R,controls:!1,onVideoRef:et}),s.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:R?1:0},children:R?s.jsx(ct,{size:20,color:"#fff"}):s.jsx(lt,{size:20,color:"#fff"})})]})})]})}):_?null:s.jsx("div",{className:"muted",style:{zIndex:10},children:"No videos yet"})}),n&&!le&&s.jsxs("div",{style:{position:"absolute",right:f?12:16,top:"50%",display:"flex",flexDirection:"column",gap:f?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:f?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[s.jsx(Ye,{to:`/profile/${(Ve=n.uploader)==null?void 0:Ve.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Be=n.uploader)!=null&&Be.avatar_url?s.jsx("img",{src:n.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:n.uploader.username}):s.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:Ze,disabled:qe,"aria-label":n.liked_by_me?"Unlike":"Like",title:n.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:n.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.liked_by_me?s.jsx(dt,{size:28}):s.jsx(ut,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.likes_count??0})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:()=>pe(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(ft,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.comments_count??0})]}),n.beatmap_url&&s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{ref:fe,onClick:()=>H(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(We,{size:24})}),de&&s.jsxs("div",{ref:ue,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsxs("a",{className:"menu-item",href:n.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>H(!1),children:[s.jsx(We,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),n.beatmapset_id&&s.jsx("button",{className:"menu-item",onClick:()=>{L(!0),H(!1)},children:"Preview"})]})]}),Ue?s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{onClick:()=>ae(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(Xe,{size:24})}),ie&&s.jsxs("div",{ref:ce,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("button",{className:"menu-item",onClick:ot,children:n.is_starred?"Unstar post":"Star post"}),s.jsx("button",{className:"menu-item",onClick:Oe,children:"Delete video"})]})]}):s.jsx("button",{onClick:()=>B(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(pt,{size:24})}),re&&s.jsxs("div",{ref:oe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),s.jsx("button",{className:"menu-item",onClick:()=>ze("unrelated"),children:"Unrelated"}),s.jsx("button",{className:"menu-item",onClick:()=>ze("explicit"),children:"Explicit"}),Ue&&s.jsx("button",{className:"menu-item",onClick:Oe,children:"Delete video"})]})]}),n&&!le&&s.jsxs("div",{style:{position:"absolute",left:f?12:16,bottom:f?"55%":80,right:f?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:f?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:f?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:s.jsx(Ye,{to:`/profile/${(He=n.uploader)==null?void 0:He.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:f?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var i,a,c;const e=(i=n.uploader)==null?void 0:i.is_admin,t=(a=n.uploader)==null?void 0:a.is_mod,r=e?"#fff3bf":t?"#d7fbe8":"#fff";return s.jsxs(s.Fragment,{children:[s.jsxs("span",{style:{color:r},children:["@",(c=n.uploader)==null?void 0:c.username]}),n.is_starred&&s.jsx(mt,{size:f?14:16,color:"#f59e0b",title:"Starred"}),(e||t)&&s.jsx(Xe,{size:f?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(n.description??"").trim()&&s.jsx("div",{style:{color:"#fff",fontSize:f?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:n.description}),n.beatmap_title&&s.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:f?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[n.beatmap_artist," – ",n.beatmap_title," ",n.beatmap_mapper?`(by ${n.beatmap_mapper})`:""," ",n.beatmap_version?`[${n.beatmap_version}]`:""]})]}),f&&n&&s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),s.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[s.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",n.comments_count??0,")"]}),s.jsx("button",{onClick:()=>pe(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:s.jsx(ht,{size:24})})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:De.length===0?s.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):s.jsx("div",{className:"col",style:{gap:0},children:De.map(e=>s.jsx(bt,{comment:e,replies:K.get(e.id)||[],me:S,section:"mappi",onReply:t=>he(t),onDelete:tt,replyingTo:me,replyText:F,onReplyTextChange:Y,onReplySubmit:Fe,posting:ge,onCancelReply:()=>{he(null),Y("")}},e.id))})}),S&&!me&&s.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:s.jsxs("form",{onSubmit:Fe,style:{display:"flex",alignItems:"flex-end",gap:8},children:[s.jsx("textarea",{placeholder:"Write a comment...",value:F,onChange:e=>Y(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,120)}px`}}),s.jsx("button",{type:"submit",className:"btn compact",disabled:ge||!F.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:ge?"...":"Post"})]})})]})]})]})]})}export{_t as default};
