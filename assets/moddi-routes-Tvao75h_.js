import{s as _t,t as Ce,v as we,w as Be,r as i,e as ut,R as ne,j as e,c as Te,x as mt,l as xe,d as Pe,y as Oe,z as Tt,B as Ct,o as pt,u as Ye,q as gt,L as Ae,C as zt,D as _e,E as Ee,G as $e,k as Le,f as Ze,H as Ve,I as et,J as Se,K as Ft,M as ft,N as qt,O as It,P as tt,Q as st,A as at,h as nt,S as rt,T as it}from"./vendor-react-CcFPULbg.js";import{a as q,A as T,g as Mt,u as be,b as ht,P as xt,C as Rt,O as Ke,c as Lt}from"./mappi-routes-rmgwAihC.js";import{i as Et,a as Pt,b as At,c as Bt}from"./editor-components-COwEyuAl.js";import{B as bt}from"./editor-AMIBF98P.js";const Ot=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{standard:a.has("standard")||a.size===0,taiko:a.has("taiko"),mania:a.has("mania"),catch:a.has("catch")}}catch{return{standard:!0,taiko:!1,mania:!1,catch:!1}}},Dt=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{untagged:a.has("untagged")||a.size===0,help:a.has("help")||a.size===0}}catch{return{untagged:!0,help:!0}}},Ut=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{unchecked:a.has("unchecked")||a.size===0,accepted:a.has("accepted")||a.size===0,denied:a.has("denied")||a.size===0,finished:a.has("finished")||a.size===0,archived:a.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Wt=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{open:a.has("open")||a.size===0,closed:a.has("closed")}}catch{return{open:!0,closed:!1}}},Qt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator",a=new Set(t.toLowerCase().split(",").map(s=>s.trim()).filter(Boolean));return{modder:a.has("modder")||a.size===0,nominator:a.has("nominator")||a.size===0}}catch{return{modder:!0,nominator:!0}}},$t=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Ht=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},ze=_t(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Ot(),tagFilters:Dt(),queueStatusFilters:Ut(),queueOpenFilters:Wt(),queueTypeFilters:Qt(),lastSection:$t(),previousLocation:null,theme:Ht(),setMenuOpen:a=>t({menuOpen:a}),setMobileNavOpen:a=>t({mobileNavOpen:a}),setNotifOpen:a=>t({notifOpen:a}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:a=>{t({modeFilters:a});try{const d=Object.entries(a).filter(([f,c])=>c).map(([f])=>f),l=d.length?d:["standard"];localStorage.setItem("filter_modes",l.join(","))}catch{}},setTagFilters:a=>{t({tagFilters:a});try{const d=Object.entries(a).filter(([f,c])=>c).map(([f])=>f),l=d.length?d:["untagged","help"];localStorage.setItem("filter_moddi_tags",l.join(","))}catch{}},setQueueStatusFilters:a=>{t({queueStatusFilters:a});try{const d=Object.entries(a).filter(([f,c])=>c).map(([f])=>f),l=d.length?d:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",l.join(","))}catch{}},setQueueOpenFilters:a=>{t({queueOpenFilters:a});try{const d=Object.entries(a).filter(([f,c])=>c).map(([f])=>f),l=d.length?d:["open"];localStorage.setItem("filter_queue_open",l.join(","))}catch{}},setQueueTypeFilters:a=>{t({queueTypeFilters:a});try{const d=Object.entries(a).filter(([f,c])=>c).map(([f])=>f),l=d.length?d:["modder","nominator"];localStorage.setItem("filter_queue_type",l.join(","))}catch{}},setLastSection:a=>{t({lastSection:a});try{a?localStorage.setItem("last_section",a):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:a=>{t({previousLocation:a})},setTheme:a=>{t({theme:a});try{localStorage.setItem("theme",a)}catch{}}}));function Yt(t=!0){return Ce({queryKey:["notifications"],queryFn:async()=>{try{const a=await q(T.user.notifications);return Array.isArray(a.items)?a.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Kt(){return Ce({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await q("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function us(){const{data:t=[]}=Yt();return t.filter(a=>a.kind==="system"&&a.id.startsWith("b:")&&(a.expiresAt||0)<=Date.now()?!1:!a.read).length}function Jt(){const t=we();return Be({mutationFn:async a=>{await q(T.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:a})})},onSuccess:()=>{t.setQueryData(["notifications"],a=>(a==null?void 0:a.map(s=>({...s,read:!0})))||[])}})}function Xt(){const t=we();return Be({mutationFn:async a=>{const s=Mt();await q(T.user.deleteNotification(a),{method:"DELETE",headers:{"X-CSRF-Token":s}})},onSuccess:(a,s)=>{t.setQueryData(["notifications"],d=>(d==null?void 0:d.filter(l=>l.id!==s))||[]),t.setQueryData(["notifications","detailed"],d=>(d==null?void 0:d.filter(l=>l.id!==s))||[])}})}function Fe(){return Ce({queryKey:["user","me"],queryFn:async()=>{try{return await q(T.auth.me)}catch{return null}},staleTime:5*60*1e3})}function ms(t=!0){return Ce({queryKey:["user","quota"],queryFn:async()=>{try{return await q(T.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function ps(){const t=we();return Be({mutationFn:async()=>{await q(T.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function Gt(t,a,s,d){i.useEffect(()=>{if(!s)return;const l=f=>{const c=f.target;a.current&&!a.current.contains(c)&&t.current&&!t.current.contains(c)&&d()};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[s,d,t,a])}const Zt=({context:t,onClose:a,style:s})=>{const d=ut(),l=ne.useMemo(()=>{if(t)return t;const E=d.pathname;return E==="/mp/feed"?"mappi-feed":E==="/md/feed"?"moddi-feed":E==="/md/queues"?"moddi-queues":E.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,d.pathname]),{modeFilters:f,setModeFilters:c,tagFilters:k,setTagFilters:p,queueOpenFilters:x,setQueueOpenFilters:o,queueStatusFilters:S,setQueueStatusFilters:h,queueTypeFilters:N,setQueueTypeFilters:M}=ze(),P=E=>{const I={...k,[E]:!k[E]};!I.untagged&&!I.help&&(I.help=!0),p(I);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},C=E=>{const I={...x,[E]:!x[E]};!I.open&&!I.closed&&(I.open=!0),o(I)},b=E=>{const I={...S,[E]:!S[E]};["unchecked","accepted","denied","finished"].some(U=>I[U])||(I.unchecked=!0),h(I)},R=E=>{const I={...N,[E]:!N[E]};!I.modder&&!I.nominator&&(I.modder=!0),M(I)},L=({title:E,children:I})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:E}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:I})]}),B=({active:E,onClick:I,label:K})=>e.jsx("button",{type:"button",onClick:I,className:"chip","aria-pressed":E,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:E?"rgba(125,211,252,0.6)":"var(--border)",background:E?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:K});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{zIndex:1e4,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...s},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),a&&e.jsx("button",{className:"icon-link",onClick:a,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(Te,{size:16})})]}),l==="moddi-feed"&&e.jsxs(L,{title:"Tags",children:[e.jsx(B,{active:k.untagged,onClick:()=>P("untagged"),label:"Untagged"}),e.jsx(B,{active:k.help,onClick:()=>P("help"),label:"Help"})]}),l==="moddi-queues"&&e.jsxs(e.Fragment,{children:[e.jsxs(L,{title:"Status",children:[e.jsx(B,{active:x.open,onClick:()=>C("open"),label:"Open"}),e.jsx(B,{active:x.closed,onClick:()=>C("closed"),label:"Closed"})]}),e.jsxs(L,{title:"Type",children:[e.jsx(B,{active:N.modder,onClick:()=>R("modder"),label:"Modder"}),e.jsx(B,{active:N.nominator,onClick:()=>R("nominator"),label:"Nominator"})]})]}),l==="moddi-queue-detail"&&e.jsxs(L,{title:"Submissions",children:[e.jsx(B,{active:S.unchecked,onClick:()=>b("unchecked"),label:"Pending"}),e.jsx(B,{active:S.accepted,onClick:()=>b("accepted"),label:"Accepted"}),e.jsx(B,{active:S.denied,onClick:()=>b("denied"),label:"Denied"}),e.jsx(B,{active:S.finished,onClick:()=>b("finished"),label:"Finished"})]})]})},ot={standard:Bt,taiko:At,mania:Pt,catch:Et},lt={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},Vt=({value:t,onChange:a})=>{const[s,d]=i.useState(!1),l=i.useRef(null);i.useEffect(()=>{if(!s)return;const c=p=>{l.current&&!l.current.contains(p.target)&&d(!1)},k=p=>{p.key==="Escape"&&d(!1)};return document.addEventListener("mousedown",c),document.addEventListener("keydown",k),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("keydown",k)}},[s]);const f=c=>e.jsxs("button",{className:`mode-option${c===t?" selected":""}`,onClick:()=>{a(c),d(!1)},role:"option","aria-selected":c===t,children:[e.jsx("img",{className:"mode-icon",src:ot[c],width:24,height:24,alt:""}),e.jsx("span",{children:lt[c]})]},c);return e.jsxs("div",{className:"mode-select",ref:l,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":s,onClick:()=>d(c=>!c),children:[e.jsx("img",{className:"mode-icon",src:ot[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:lt[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(f)})]})};function dt(t){if(!t)return"standard";const a=String(t).toLowerCase().trim();return a==="osu"||a==="0"||a==="standard"?"standard":a==="taiko"||a==="1"?"taiko":a==="catch"||a==="fruits"||a==="2"?"catch":a==="mania"||a==="3"?"mania":"standard"}function yt({section:t,onUpload:a,onPost:s,forceExpanded:d}){const{notify:l}=be(),f=t==="mappi",[c,k]=i.useState(!1),[p,x]=i.useState(""),[o,S]=i.useState(null),[h,N]=i.useState(null),[M,P]=i.useState(!1),[C,b]=i.useState(""),R=i.useRef(0),[L,B]=i.useState(""),[E,I]=i.useState("standard"),[K,U]=i.useState(null),[w,O]=i.useState(0),[oe,Y]=i.useState(""),[y,_]=i.useState(""),[v,W]=i.useState(null),[se,fe]=i.useState(""),[ue,G]=i.useState(""),[me,z]=i.useState(null),[ie,ae]=i.useState(!1),[pe,V]=i.useState(null),ce=100*1024*1024,r=i.useMemo(()=>K?`${K.name}:${K.size}:${K.lastModified}`:null,[K]),[g,A]=i.useState(""),[D,ee]=i.useState(!1),[J,Z]=i.useState([]),ke=i.useRef(null);i.useEffect(()=>{R.current&&window.clearTimeout(R.current);const F=(p||"").trim();if(!F){b(""),S(null),N(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(F)){b(""),S(null),N(null);return}return R.current=window.setTimeout(async()=>{var j;try{let $;try{$=new URL(F)}catch{b("Invalid URL format");return}const te=$.hash.match(/#osu\/(\d+)/),X=te?te[1]:null;$.hash="";const Ie={url:$.toString()};X&&(Ie.beatmap_id=X);const de=await q(T.osu.resolveBeatmap+ht(Ie),{requireAuth:!1}),ye=Array.isArray(de==null?void 0:de.diffs)?de.diffs:[];if(!ye.length&&!de.setId){b("No difficulties found"),S(null),N(null);return}if(S({setId:Number(de.setId)||0,beatmapId:de.beatmapId??null,title:String(de.title||""),artist:String(de.artist||""),mapper:String(de.mapper||""),diffs:ye}),ye.length>0){const he=Number.isFinite(Number(de.beatmapId))?Number(de.beatmapId):Number((j=ye[0])==null?void 0:j.id),ge=ye.find(We=>Number(We.id)===he)||ye[0],Me=dt(ge==null?void 0:ge.mode);N({beatmapId:Number(ge==null?void 0:ge.id)||null,version:String((ge==null?void 0:ge.version)||""),mode:Me}),f&&I(Me)}else N(null);b("")}catch($){const te=($==null?void 0:$.message)||"Unknown error";b(`Failed to resolve: ${te}`),S(null),N(null)}},400),()=>{R.current&&window.clearTimeout(R.current)}},[p,f]);async function ve(){return _("info"),Y("Requesting upload URL..."),await q(T.uploads.new,{method:"POST",body:JSON.stringify({description:L.slice(0,100),beatmap_url:p||void 0,size_bytes:(K==null?void 0:K.size)??void 0,mode:E,beatmapset_id:(o==null?void 0:o.setId)??void 0,beatmap_id:(h==null?void 0:h.beatmapId)??void 0,beatmap_version:(h==null?void 0:h.version)??void 0,beatmap_title:o?`${o.title}`:void 0,beatmap_artist:o?`${o.artist}`:void 0,beatmap_mapper:o?`${o.mapper}`:void 0})})}async function je(F,Q,j="form"){await new Promise(($,te)=>{const X=new XMLHttpRequest;if(X.open("POST",F),X.upload.onprogress=le=>{le.lengthComputable&&O(Math.round(le.loaded/le.total*100))},X.onload=()=>X.status>=200&&X.status<300?$():te(new Error(`Upload failed (${X.status}) ${X.responseText||""}`)),X.onerror=()=>te(new Error("Network error")),j==="form"){const le=new FormData;le.append("file",Q,Q.name),X.send(le)}else X.setRequestHeader("Content-Type","application/octet-stream"),X.send(Q)})}async function Ue(){if(!(!K||!f)){if(K.size>ce){fe("File exceeds 100MB limit");return}if(typeof me=="number"&&me>60.5){G("Clip exceeds 60s limit");return}r&&(ae(!0),V(r)),O(0),_("info");try{const F=await ve();W(F.streamUID);let Q=F.streamUID;try{Y("Uploading..."),await je(F.uploadURL,K,"form")}catch(j){_("warn"),Y(`Retrying upload... (${(j==null?void 0:j.message)||j})`);const $=await ve();W($.streamUID),Q=$.streamUID,await je($.uploadURL,K,"binary")}_("info"),Y("Processing...");for(let j=0;j<60;j++){await new Promise($=>setTimeout($,3e3));try{if((await q(T.videos.get(Q),{requireAuth:!1})).status==="ready"){_("success"),Y("Ready!"),l("Upload complete!",{variant:"success"}),U(null),B(""),x(""),S(null),N(null),I("standard"),O(0),W(null),fe(""),G(""),z(null),ae(!1),V(null),a&&a();break}}catch{}}}catch(F){_("error"),Y(F.message||"Error"),l(F.message||"Upload failed",{variant:"error"})}}}const qe=async F=>{if(F.preventDefault(),!f){if(!g.trim()){l("Text is required",{variant:"error"});return}if(g.length>200){l("Text must be 200 characters or less",{variant:"error"});return}ee(!0);try{const Q=await q(T.moddi.posts,{method:"POST",body:JSON.stringify({text:g.trim(),beatmap_url:p.trim()||void 0,beatmapset_id:(o==null?void 0:o.setId)??void 0,beatmap_id:(h==null?void 0:h.beatmapId)??(o==null?void 0:o.beatmapId)??void 0,beatmap_version:(h==null?void 0:h.version)??void 0,tags:J.length>0?J.join(","):void 0})});if(Q){console.log("Post created response:",Q);const j=Q==null?void 0:Q.post;j?(!j.uid&&j.id&&(console.warn("Created post missing uid, using id as fallback:",j),j.uid=String(j.id)),s&&s(j)):s&&s(),l("Post created!",{variant:"success"}),A(""),x(""),S(null),N(null),b(""),P(!1),Z([])}}catch{l("Failed to create post",{variant:"error"})}finally{ee(!1)}}},Ne=!!d||c;return e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,marginBottom:f?12:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:d?"default":"pointer",padding:"8px 12px",minHeight:36},onClick:()=>{d||k(!c)},children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:f?"Upload a clip":"Create a post!"}),Ne?e.jsx(mt,{size:16}):e.jsx(xe,{size:16})]}),Ne&&e.jsx("div",{style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.4,marginBottom:12},children:"Max: 60s, 100MB. Only osu! mapping content is permitted."}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Game mode:"}),e.jsx(Vt,{value:E,onChange:I})]}),o?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[o.artist," – ",o.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",o.mapper]})]}),o.diffs.length>0&&e.jsx("select",{value:(h==null?void 0:h.beatmapId)??o.beatmapId??void 0,onChange:F=>{const Q=Number(F.target.value),j=(o==null?void 0:o.diffs.find($=>Number($.id)===Q))||null;if(j){const $=dt(j.mode);N({beatmapId:Q,version:j.version,mode:$}),I($)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"4px 8px",fontSize:12},children:o.diffs.map(F=>e.jsxs("option",{value:F.id,children:[F.version," (",F.mode,")"]},F.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>P(!0),style:{padding:"6px 12px",fontSize:13},children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{S(null),N(null),x("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:p,onChange:F=>x(F.target.value),style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:L,onChange:F=>B(F.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:64}}),C&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:C}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("input",{type:"file",accept:"video/*",onChange:F=>{var $;const Q=(($=F.target.files)==null?void 0:$[0])||null;if(U(Q),z(null),Q&&Q.size>ce?fe("File exceeds 100MB limit"):fe(""),Q)try{const te=URL.createObjectURL(Q),X=document.createElement("video");X.preload="metadata",X.src=te,X.onloadedmetadata=()=>{URL.revokeObjectURL(te);const le=Number.isFinite(X.duration)?X.duration:NaN;Number.isFinite(le)&&z(le),Number.isFinite(le)&&le>60.5?G("Clip exceeds 60s limit"):G("")},X.onerror=()=>{URL.revokeObjectURL(te),z(null)}}catch{z(null)}else G("");const j=Q?`${Q.name}:${Q.size}:${Q.lastModified}`:null;j&&j!==pe&&ae(!1)},style:{flex:1,minWidth:0}}),e.jsx("button",{className:"btn",onClick:Ue,disabled:!K||!!se||!!ue||ie,style:{flexShrink:0},children:"Upload"})]}),se&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:se}),ue&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:ue}),K&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Selected: ",K.name," • ",(K.size/1024/1024).toFixed(1)," MB",ie&&pe===r?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(locked)"}):null]}),(w>0||oe)&&e.jsxs("div",{className:"upload-status",children:[oe&&e.jsx("div",{className:`chip ${y||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:oe}),w>0&&e.jsx("div",{className:"progress",style:{marginTop:8},"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":w,children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,Math.max(0,w))}%`}})})]}),v&&e.jsxs("div",{className:"muted",style:{fontSize:11},children:["Stream UID: ",v]})]})]}):e.jsx("form",{onSubmit:qe,children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("textarea",{ref:ke,placeholder:"Ask for feedback! Or, say anything! Woo! (max 200 chars)",value:g,onChange:F=>A(F.target.value),maxLength:200,rows:2,style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",minHeight:50}}),o?e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[e.jsxs("strong",{style:{marginRight:4},children:[o.artist," – ",o.title]}),e.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",o.mapper]})]}),o.diffs.length>0&&e.jsx("select",{value:(h==null?void 0:h.beatmapId)??o.beatmapId??void 0,onChange:F=>{const Q=Number(F.target.value),j=(o==null?void 0:o.diffs.find($=>Number($.id)===Q))||null;j&&N({beatmapId:Q,version:j.version,mode:String(j.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:o.diffs.map(F=>e.jsxs("option",{value:F.id,children:[F.version," (",F.mode,")"]},F.id))})]}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:p,onChange:F=>x(F.target.value),style:{background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),C&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:C}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("span",{className:"muted",style:{fontSize:11},children:"Tags:"}),e.jsx("button",{type:"button",onClick:()=>{J.includes("help")?Z(J.filter(F=>F!=="help")):Z([...J,"help"])},style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:J.includes("help")?"rgba(234, 179, 8, 0.2)":"rgba(255,255,255,0.05)",border:J.includes("help")?"1px solid rgba(234, 179, 8, 0.4)":"1px solid rgba(255,255,255,0.12)",color:J.includes("help")?"#fbbf24":"var(--text)",fontWeight:500,lineHeight:1.2,cursor:"pointer",transition:"all 0.15s ease"},children:"Help"})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>P(!0),children:"Preview"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{S(null),N(null),x("")},children:"Clear"})]}),e.jsx("button",{type:"submit",className:"btn",disabled:D||!g.trim()||g.length>200,children:D?"Posting...":"Post"})]})]})})}),M&&o&&e.jsx(bt,{open:M,onClose:()=>P(!1),downloadUrl:T.osu.downloadBeatmapset(o.setId),beatmapId:(h==null?void 0:h.beatmapId)??o.beatmapId??void 0,beatmapVersion:h==null?void 0:h.version})]})}function De({open:t,onClose:a,children:s}){const d=i.useRef(null),l=i.useRef(null),f=i.useRef(!1),c=o=>{var S;l.current=((S=o.touches[0])==null?void 0:S.clientY)??null,f.current=!1},k=o=>{var M,P;if(l.current==null)return;const S=((M=o.touches[0])==null?void 0:M.clientY)??null;if(S==null)return;const h=S-l.current;(((P=d.current)==null?void 0:P.scrollTop)??0)<=0&&h>60?f.current=!0:f.current=!1},p=()=>{f.current&&a(),l.current=null,f.current=!1};if(!t)return null;const x=e.jsx("div",{className:"mobile-upload-overlay",onClick:a,children:e.jsx("div",{ref:d,className:"mobile-upload-sheet",onClick:o=>o.stopPropagation(),onTouchStart:c,onTouchMove:k,onTouchEnd:p,children:s})});return Pe.createPortal(x,document.body)}function es({section:t,onUpload:a,onPost:s}){const[d,l]=ne.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":t==="mappi"?"Upload clip":"New post",title:t==="mappi"?"Upload clip":"New post",onClick:()=>l(!0),children:e.jsx(Oe,{size:22})}),e.jsx(De,{open:d,onClose:()=>l(!1),children:e.jsx("div",{style:{paddingTop:6},children:e.jsx(yt,{section:t,forceExpanded:!0,onUpload:()=>{a==null||a(),l(!1)},onPost:f=>{s==null||s(f),l(!1)}})})})]})}function ts(){const[t,a]=ne.useState(!1);return ne.useEffect(()=>{var l;const s=window.matchMedia("(max-width: 768px)"),d=()=>a(s.matches);return d(),(l=s.addEventListener)==null||l.call(s,"change",d),()=>{var f;return(f=s.removeEventListener)==null?void 0:f.call(s,"change",d)}},[]),t}const Je=({context:t})=>{const a=ts(),[s,d]=ne.useState(!1),l=ne.useRef(null),f=12,c=18,o=84+56+12;return ne.useEffect(()=>{const S=h=>{if(!s)return;const N=h.target;if(l.current&&l.current.contains(N))return;const M=document.getElementById("desktop-filters-panel");M&&M.contains(N)||d(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[s]),a?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:l,className:"desktop-fab",onClick:()=>d(S=>!S),"aria-haspopup":"dialog","aria-expanded":s,title:"Filters","aria-label":"Filters",children:e.jsx(Tt,{size:22})}),s&&e.jsx("div",{id:"desktop-filters-panel",style:{position:"fixed",right:c,bottom:o,zIndex:1e4},children:e.jsx(Zt,{context:t,onClose:()=>d(!1),style:{maxHeight:`calc(100vh - ${o+f}px)`,maxWidth:`calc(100vw - ${c+f}px)`,overflow:"auto"}})})]})};function ss(){const{data:t}=Fe(),{tagFilters:a}=ze();return Ct({queryKey:["moddi","feed",a],queryFn:async({pageParam:s=0})=>{const d=new URLSearchParams({limit:"20",offset:String(s)}),l=`${T.moddi.posts}?${d.toString()}`;return await q(l)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,d)=>{var c;const l=d.reduce((k,p)=>{var x;return k+(((x=p.items)==null?void 0:x.length)||0)},0);return(((c=s.items)==null?void 0:c.length)||0)===20?l:void 0}})}function gs(){const t=ut(),a=we(),{data:s}=Fe(),{tagFilters:d}=ze(),{data:l,fetchNextPage:f,hasNextPage:c,isFetching:k,isFetchingNextPage:p,refetch:x}=ss(),o=i.useMemo(()=>l!=null&&l.pages?l.pages.flatMap(b=>(b.items||[]).map(L=>({...L,user_id:L.user_id??0,username:L.username||"Unknown",avatar_url:L.avatar_url||null,text:L.text??null,uid:L.uid||String(L.id||""),reactions_count:Number(L.reactions_count??0),reacted_by_me:L.reacted_by_me??!1,comments_count:Number(L.comments_count??0)}))):[],[l]),S=i.useMemo(()=>o.filter(b=>{const R=b.tags?typeof b.tags=="string"?b.tags.split(",").map(E=>E.trim()):[]:[],L=!b.tags||R.length===0,B=R.includes("help");return d.untagged&&d.help?!0:d.untagged&&!d.help?L:!d.untagged&&d.help?B:!1}),[o,d]);i.useEffect(()=>{t.pathname==="/md/feed"&&x()},[t.pathname,x]),i.useEffect(()=>{const b=()=>{x()};return window.addEventListener("moddifilterchange",b),()=>window.removeEventListener("moddifilterchange",b)},[x]);const h=b=>{a.setQueryData(["moddi","feed"],R=>R&&{...R,pages:R.pages.map(L=>({...L,items:L.items.map(B=>B.id===b.id?b:B)}))})},N=b=>{a.setQueryData(["moddi","feed"],R=>R&&{...R,pages:R.pages.map(L=>({...L,items:L.items.filter(B=>B.id!==b)}))})},M=b=>{b&&a.setQueryData(["moddi","feed"],R=>{if(!R)return R;const L={...b,user_id:b.user_id??0,username:b.username||"Unknown",avatar_url:b.avatar_url||null,text:b.text??null,uid:b.uid||String(b.id||""),reactions_count:Number(b.reactions_count??0),reacted_by_me:b.reacted_by_me??!1,comments_count:Number(b.comments_count??0)};return{...R,pages:R.pages.map((B,E)=>E===0?{...B,items:[L,...B.items||[]]}:B)}}),a.invalidateQueries({queryKey:["moddi","feed"]}),x()},P=k&&!p,C=c??!1;return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Say anything! If you want help, tag it accordingly and others can raise their hand."}),e.jsx(yt,{section:"moddi",onPost:M})]}),e.jsx(es,{section:"moddi",onPost:M}),e.jsx(Je,{context:"moddi-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[S.length===0&&!P&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to post!"}),S.map(b=>e.jsx(xt,{post:b,section:"moddi",onUpdate:h,onDelete:N,me:s},b.id)),S.length>0&&C&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>f(),disabled:p,children:p?"Loading...":"Load more"})})]})})]})}function fs(){const{uid:t}=pt(),a=Ye(),[s,d]=i.useState(null),[l,f]=i.useState([]),[c,k]=i.useState(!0),[p,x]=i.useState(null),[o,S]=i.useState(""),[h,N]=i.useState(null),[M,P]=i.useState(!1),{notify:C}=be();i.useEffect(()=>{q(T.auth.me,{requireAuth:!1}).then(w=>x(w)).catch(()=>{})},[]);const b=async()=>{if(!t||t==="null"||t==="undefined"){C("Invalid post identifier",{variant:"error"}),a("/md/feed");return}k(!0);try{const w=await q(T.moddi.post(t),{requireAuth:!1}),O={...w,user_id:w.user_id??0,username:w.username||"Unknown",avatar_url:w.avatar_url||null,uid:w.uid||String(w.id)||t,text:w.text??null,beatmap_url:w.beatmap_url??null,beatmapset_id:w.beatmapset_id??null,beatmap_id:w.beatmap_id??null,beatmap_version:w.beatmap_version??null,tags:w.tags??null,reactions_count:Number(w.reactions_count??0),reacted_by_me:w.reacted_by_me??!1,comments_count:Number(w.comments_count??0)};d(O)}catch{C("Failed to load post",{variant:"error"}),a("/md/feed")}finally{k(!1)}},R=async()=>{if(s!=null&&s.id)try{const w=await q(T.moddi.postComments(s.id),{requireAuth:!1});f(w.items||[])}catch{}};i.useEffect(()=>{b()},[t]),i.useEffect(()=>{s!=null&&s.id&&R()},[s==null?void 0:s.id]);const L=w=>{d(w)},B=()=>{a("/md/feed")},E=async w=>{if(w.preventDefault(),!(!o.trim()||!(s!=null&&s.id))){P(!0);try{await q(T.moddi.postComments(s.id),{method:"POST",body:JSON.stringify({text:o.trim(),parent_id:h||void 0})}),S(""),N(null),R(),b(),C("Comment posted!",{variant:"success"})}catch(O){C((O==null?void 0:O.message)||"Failed to post comment",{variant:"error"})}finally{P(!1)}}},I=w=>{f(O=>O.filter(oe=>oe.id!==w))};if(c)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!s)return e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const K=l.filter(w=>!w.parent_id),U=new Map;return l.filter(w=>w.parent_id).forEach(w=>{const O=w.parent_id;U.has(O)||U.set(O,[]),U.get(O).push(w)}),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"post-detail-header",style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>a("/md/feed"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(gt,{size:20})}),e.jsx("span",{className:"hide-on-mobile",style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsx(xt,{post:s,section:"moddi",onUpdate:L,onDelete:B,me:p})}),p&&!h&&e.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid var(--border-subtle)",borderRadius:6},children:e.jsxs("form",{onSubmit:E,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:o,onChange:w=>S(w.target.value),rows:1,style:{flex:1,background:"var(--panel-dark)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:w=>{const O=w.target;O.style.height="auto",O.style.height=`${Math.min(O.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:M||!o.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:M?"...":"Post"})]})}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:K.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:K.map(w=>e.jsx(Rt,{comment:w,replies:U.get(w.id)||[],me:p,section:"moddi",onReply:O=>N(O),onDelete:I,replyingTo:h,replyText:o,onReplyTextChange:S,onReplySubmit:E,posting:M,onCancelReply:()=>{N(null),S("")},repliesMap:U},w.id))})})]})}function as({queue:t}){const a=t.type||"modder";return e.jsx(Ae,{to:`/md/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:s=>s.currentTarget.style.background="rgba(255,255,255,0.02)",onMouseLeave:s=>s.currentTarget.style.background="rgba(255,255,255,0.01)",children:[e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:a==="nominator"?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.1)",color:a==="nominator"?"#a78bfa":"var(--muted)",border:a==="nominator"?"1px solid rgba(139, 92, 246, 0.3)":"1px solid rgba(255, 255, 255, 0.1)"},children:a==="nominator"?"Nominator":"Modder"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(zt,{size:18}):e.jsx(_e,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name}),(t.is_open??1)===1?e.jsx(Ee,{size:18,style:{color:"#10b981"}}):e.jsx($e,{size:18,style:{color:"#ef4444"}})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(Ke,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const s=t.member_count||0;return s===0?null:s===1&&t.first_member_username?` and ${t.first_member_username}`:s>1?` & ${s} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function Xe(){return Ce({queryKey:["moddi","queues"],queryFn:async()=>{const t=await q(T.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function vt(){const t=we();return Be({mutationFn:async a=>{var s;return await q(T.moddi.queues,{method:"POST",body:JSON.stringify({name:a.name.trim(),description:((s=a.description)==null?void 0:s.trim())||null,is_group:a.is_group??!1,type:a.type||"modder"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function ns(){const[t,a]=ne.useState(!1),[s,d]=ne.useState(""),[l,f]=ne.useState(""),{data:c=[]}=Xe(),{data:k}=Fe(),{notify:p}=be(),x=vt(),o=ne.useMemo(()=>k?c.some(h=>h.owner_id===k.id):!1,[k,c]),S=h=>{if(h&&h.preventDefault(),o){p("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!s.trim()){p("Queue name is required",{variant:"error"});return}x.mutate({name:s.trim(),description:l.trim()||null,is_group:!1},{onSuccess:()=>{p("Queue created!",{variant:"success"}),a(!1),d(""),f("")},onError:N=>{p((N==null?void 0:N.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>a(!0),children:e.jsx(Oe,{size:22})}),e.jsx(De,{open:t,onClose:()=>a(!1),children:e.jsxs("form",{onSubmit:S,className:"col",style:{gap:12},children:[o?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:s,onChange:h=>d(h.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:l,onChange:h=>f(h.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>a(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:x.isPending||o,children:x.isPending?"Creating...":"Create"})]})]})})]})}function hs(){const{data:t=[],isLoading:a}=Xe(),{data:s}=Fe(),{queueOpenFilters:d,queueTypeFilters:l}=ze(),f=vt(),{notify:c}=be(),[k,p]=i.useState(!1),[x,o]=i.useState(""),[S,h]=i.useState(""),N=i.useMemo(()=>s?t.some(C=>C.owner_id===s.id):!1,[s,t]),M=async C=>{if(C.preventDefault(),N){c("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!x.trim()){c("Queue name is required",{variant:"error"});return}f.mutate({name:x.trim(),description:S.trim()||null,is_group:!1},{onSuccess:()=>{c("Queue created!",{variant:"success"}),p(!1),o(""),h("")},onError:b=>{c((b==null?void 0:b.message)||"Failed to create queue",{variant:"error"})}})},P=ne.useMemo(()=>t.filter(C=>{const b=(C.is_open??1)===1;if(!(d.open&&d.closed||d.open&&!d.closed&&b||!d.open&&d.closed&&!b))return!1;const L=C.type||"modder";return L==="modder"&&l.modder||L==="nominator"&&l.nominator}),[t,d,l]);return e.jsxs("div",{className:"feed-container queues-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx(ns,{}),e.jsx(Je,{context:"moddi-queues"}),e.jsx("div",{className:"feed-header",children:e.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:0},children:N?e.jsx("div",{style:{padding:"12px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"8px 12px",minHeight:36},onClick:()=>p(!k),children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:"Create a queue!"}),k?e.jsx(mt,{size:16}):e.jsx(xe,{size:16})]}),k&&e.jsx("form",{onSubmit:M,style:{padding:"12px",borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:x,onChange:C=>o(C.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:S,onChange:C=>h(C.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:C=>{C.stopPropagation(),p(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:f.isPending||N,onClick:C=>C.stopPropagation(),children:f.isPending?"Creating...":"Create"})]})]})})]})})}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsx("div",{className:"col",style:{gap:0},children:a?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):P.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):P.map(C=>e.jsx(as,{queue:C},C.id))})})]})}function rs({beatmapMeta:t,beatmapVersion:a}){const s=i.useRef(null),d=i.useRef(null),[l,f]=i.useState(!1),[c,k]=i.useState(!1),[p,x]=i.useState(0);i.useEffect(()=>{if(s.current&&d.current){const h=s.current.offsetWidth,N=d.current.scrollWidth;x(N),k(N>h)}},[t,a]);const o=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",a?` [${a}]`:""]}):a?`[${a}]`:"Beatmap",S=p>0?Math.max(3,p/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:s,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&f(!0),onMouseLeave:()=>f(!1),children:[e.jsx("span",{ref:d,style:{display:"inline-block",animation:l&&c?`beatmap-marquee ${S}s linear infinite`:"none"},children:o}),l&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:o})]})]})}function He({submission:t,canManage:a,onUpdate:s,onDelete:d,isGroup:l=!1,allowSelfActions:f=!1}){const[c,k]=i.useState(!1),[p,x]=i.useState(!1),[o,S]=i.useState(null),[h,N]=i.useState(t.beatmapset_id),[M,P]=i.useState(t.beatmap_id),[C,b]=i.useState(!1),[R,L]=i.useState(!1),[B,E]=i.useState(null),[I,K]=i.useState(!1),[U,w]=i.useState(t.acknowledgments||[]),[O,oe]=i.useState(t.acknowledged_by_me||!1),Y=i.useRef(null),y=i.useRef(null),_=i.useRef(null),v=i.useRef(null),W=i.useRef(null),{notify:se}=be();i.useEffect(()=>{w(t.acknowledgments||[]),oe(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),i.useEffect(()=>{if(t.beatmap_url)try{const r=new URL(t.beatmap_url),g=r.pathname.match(/\/beatmapsets\/(\d+)/);if(g&&!t.beatmapset_id){const D=Number(g[1]);isNaN(D)||N(D)}const A=r.hash.match(/#osu\/(\d+)/);if(A&&!t.beatmap_id){const D=Number(A[1]);isNaN(D)||P(D)}}catch(r){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,r)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),i.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:h,extracted_beatmap_id:M,beatmap_version:t.beatmap_version})},[t.id,h,M]),i.useEffect(()=>{if(!t.beatmap_url||o&&h)return;let r=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let g;try{g=new URL(t.beatmap_url)}catch(Z){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,Z);return}const A=g.hash.match(/#osu\/(\d+)/),D=A?A[1]:null;g.hash="";const J={url:g.toString()};if(D?J.beatmap_id=D:t.beatmap_id&&(J.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",J),!r){const Z=await q(T.osu.resolveBeatmap+ht(J),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",Z),Z.setId&&!h&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",Z.setId),N(Number(Z.setId))),(Z.title||Z.artist)&&S({title:Z.title||null,artist:Z.artist||null,mapper:Z.mapper||null})}}catch(g){console.error("[QueueSubmission] Error fetching beatmap metadata:",g)}})(),()=>{r=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,o,h]),i.useEffect(()=>{if(!C){E(null),W.current&&(window.removeEventListener("resize",W.current),window.removeEventListener("scroll",W.current,!0),W.current=null);return}let r=null;const g=()=>{let A=null;const D=v.current;if(D){const ee=D.querySelector(".queue-submission-beatmap-btn-desktop button"),J=D.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),Z=D.querySelector(".queue-submission-beatmap-btn-mobile button");ee&&window.getComputedStyle(ee.parentElement).display!=="none"?A=ee:J&&window.getComputedStyle(J.parentElement).display!=="none"?A=J:Z&&window.getComputedStyle(Z.parentElement).display!=="none"&&(A=Z)}if(!A&&_.current&&(A=_.current),A){const ee=A.getBoundingClientRect();E({top:ee.bottom+8,right:window.innerWidth-ee.right})}else E(null)};return W.current=g,r=requestAnimationFrame(()=>{g(),window.addEventListener("resize",g),window.addEventListener("scroll",g,!0)}),()=>{r!==null&&cancelAnimationFrame(r),W.current&&(window.removeEventListener("resize",W.current),window.removeEventListener("scroll",W.current,!0),W.current=null)}},[C]),i.useEffect(()=>{if(!p)return;const r=g=>{const A=g.target;Y.current&&!Y.current.contains(A)&&!A.closest("[data-status-dropdown]")&&x(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[p]),i.useEffect(()=>{if(!C)return;const r=g=>{const A=g.target;if(y.current&&y.current.contains(A))return;const D=v.current;if(D){if(_.current&&_.current.contains(A))return;const ee=D.querySelector(".queue-submission-beatmap-btn-desktop button"),J=D.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),Z=D.querySelector(".queue-submission-beatmap-btn-mobile button");if(ee&&ee.contains(A)||J&&J.contains(A)||Z&&Z.contains(A))return}b(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[C]);const fe=async r=>{if(!c){k(!0);try{await q(T.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:r})});const g={...t,status:r,updated_at:Math.floor(Date.now()/1e3)};s&&s(g),se("Status updated",{variant:"success"})}catch{se("Failed to update status",{variant:"error"})}finally{k(!1),x(!1)}}},ue=async()=>{if(!c){k(!0);try{const r=!!t.is_archived;await q(T.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!r})});const g={...t,is_archived:r?0:1,updated_at:Math.floor(Date.now()/1e3)};s&&s(g),se(r?"Unarchived":"Archived",{variant:"success"})}catch{se("Failed to update archive status",{variant:"error"})}finally{k(!1)}}},G=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){k(!0);try{await q(T.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),se("Submission deleted",{variant:"success"}),d&&d(t.id)}catch{se("Failed to delete submission",{variant:"error"})}finally{k(!1)}}},me=async()=>{if(!I){K(!0);try{if(O){if(await q(T.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),oe(!1),se("Unacknowledged",{variant:"info"}),s){const r={...t,acknowledged_by_me:!1};s(r)}}else if(await q(T.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),oe(!0),se("Acknowledged",{variant:"success"}),s){const r={...t,acknowledged_by_me:!0};s(r)}}catch{se("Failed to update acknowledgment",{variant:"error"})}finally{K(!1)}}},z={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},ie={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},ae=h||t.beatmapset_id,pe=ae?`https://assets.ppy.sh/beatmaps/${ae}/covers/card.jpg`:null;i.useEffect(()=>{pe?console.log("[QueueSubmission] Background image URL:",pe,"for beatmapset_id:",ae):console.log("[QueueSubmission] No background image URL - beatmapset_id:",ae,"submission.beatmapset_id:",t.beatmapset_id)},[pe,ae,t.beatmapset_id]);const V=!!t.is_archived,ce=a||f?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),b(g=>!g)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Le,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(xe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),b(g=>!g)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Le,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(xe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),U&&U.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[U.slice(0,5).map((r,g)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:U.length-g,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:U.length-g,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),U.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${U.length-5} more`,children:["+",U.length-5]})]}),a&&e.jsx("button",{className:"icon-link",onClick:me,disabled:I||c,title:O?"Unacknowledge":"Acknowledge",style:{color:O?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:O?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!I&&!c&&(r.currentTarget.style.background=O?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=O?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ze,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ue,disabled:c,title:V?"Unarchive":"Archive",style:{color:V?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:V?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=V?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=V?"rgba(99, 102, 241, 0.1)":"transparent"},children:V?e.jsx(Ve,{size:16}):e.jsx(et,{size:16})}),e.jsx("button",{className:"icon-link",onClick:G,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(Se,{size:16})}),a&&e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:Y,onClick:()=>x(!p),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:z[t.status]+"15",border:`1.5px solid ${z[t.status]}50`,color:z[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=z[t.status]+"25",r.currentTarget.style.borderColor=z[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=z[t.status]+"15",r.currentTarget.style.borderColor=z[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:ie[t.status]}),e.jsx(xe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:p?"rotate(180deg)":"rotate(0deg)"}})]}),p&&Pe.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const r=document.querySelector(".queue-submission-status-btn-desktop button"),g=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),A=document.querySelector(".queue-submission-status-btn-mobile button");let D=null;if(r&&window.getComputedStyle(r.parentElement).display!=="none"?D=r:A&&window.getComputedStyle(A.parentElement).display!=="none"?D=A:g&&window.getComputedStyle(g.parentElement).display!=="none"?D=g:Y.current&&(D=Y.current),D){const ee=D.getBoundingClientRect();return{top:ee.bottom+6,right:window.innerWidth-ee.right}}return{top:0,right:0}})()},onClick:r=>r.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(r=>e.jsx("button",{onClick:()=>fe(r),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:r===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:r===t.status?z[r]+"15":"transparent",color:r===t.status?z[r]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:g=>{r!==t.status&&(g.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:g=>{r!==t.status&&(g.currentTarget.style.background="transparent")},children:ie[r]},r))}),document.body)]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:v,className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:V?.6:1},children:[pe&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:pe,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.35,zIndex:0,pointerEvents:"none"},onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.75) 100%)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:_,className:"chip-btn link",onClick:r=>{r.preventDefault(),r.stopPropagation(),b(g=>!g)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(Le,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(xe,{size:12,style:{marginLeft:4,opacity:.7}})]})}),a&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[U&&U.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[U.slice(0,5).map((r,g)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:U.length-g,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:U.length-g,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),U.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${U.length-5} more`,children:["+",U.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:me,disabled:I||c,title:O?"Unacknowledge":"Acknowledge",style:{color:O?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:O?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!I&&!c&&(r.currentTarget.style.background=O?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=O?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Ze,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ue,disabled:c,title:V?"Unarchive":"Archive",style:{color:V?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:V?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=V?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=V?"rgba(99, 102, 241, 0.1)":"transparent"},children:V?e.jsx(Ve,{size:16}):e.jsx(et,{size:16})}),e.jsx("button",{className:"icon-link",onClick:G,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(Se,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:Y,onClick:()=>x(!p),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:z[t.status]+"15",border:`1.5px solid ${z[t.status]}50`,color:z[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=z[t.status]+"25",r.currentTarget.style.borderColor=z[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=z[t.status]+"15",r.currentTarget.style.borderColor=z[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:ie[t.status]}),e.jsx(xe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:p?"rotate(180deg)":"rotate(0deg)"}})]})})]}),a&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>x(!p),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:z[t.status]+"15",border:`1.5px solid ${z[t.status]}50`,color:z[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=z[t.status]+"25",r.currentTarget.style.borderColor=z[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=z[t.status]+"15",r.currentTarget.style.borderColor=z[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:ie[t.status]}),e.jsx(xe,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:p?"rotate(180deg)":"rotate(0deg)"}})]})}),!a&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:z[t.status]+"15",border:`1.5px solid ${z[t.status]}50`,color:z[t.status],whiteSpace:"nowrap"},children:ie[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx(rs,{beatmapMeta:o,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:e.jsx(Ke,{text:t.message})}),ce]})]}),C&&B&&t.beatmap_url&&Pe.createPortal(e.jsxs("div",{ref:y,style:{position:"fixed",top:B.top,right:B.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>b(!1),children:[e.jsx(Le,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ae&&e.jsx("button",{className:"menu-item",onClick:()=>{L(!0),b(!1)},children:"Preview"})]}),document.body),R&&ae&&e.jsx(bt,{open:R,onClose:()=>L(!1),downloadUrl:`${Lt}${T.osu.downloadBeatmapset(ae)}`,beatmapId:M??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}function is({queueId:t,onSubmitted:a}){const[s,d]=ne.useState(!1),[l,f]=ne.useState(t),[c,k]=ne.useState(""),[p,x]=ne.useState(""),[o,S]=ne.useState(!1),{notify:h}=be(),{data:N=[]}=Xe();ne.useEffect(()=>{f(t)},[t]);const M=async()=>{if(!l){h("Please select a queue",{variant:"error"});return}if(!c.trim()){h("Beatmap URL is required",{variant:"error"});return}S(!0);try{await q(T.moddi.queueSubmit(l),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:p.trim()||null})}),h("Submission created!",{variant:"success"}),k(""),x(""),d(!1),a==null||a()}catch(P){h((P==null?void 0:P.message)||"Failed to create submission",{variant:"error"})}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>d(!0),children:e.jsx(Oe,{size:22})}),e.jsx(De,{open:s,onClose:()=>d(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:l??"",onChange:P=>f(P.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),N.map(P=>e.jsx("option",{value:String(P.id),children:P.name},P.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:P=>k(P.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:p,onChange:P=>x(P.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),p.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[p.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:o,onClick:M,children:o?"Submitting...":"Submit"})]})]})})]})}const ct=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(It,{components:{p:({children:a})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:a}),ul:({children:a})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:a}),ol:({children:a})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:a}),li:({children:a})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:a}),strong:({children:a})=>e.jsx("strong",{style:{fontWeight:600},children:a}),em:({children:a})=>e.jsx("em",{children:a}),code:({children:a})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:a}),h1:({children:a})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:a}),h2:({children:a})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:a}),h3:({children:a})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:a})},children:t})});function xs(){const{id:t}=pt(),a=Ye(),[s,d]=i.useState(null),[l,f]=i.useState([]),[c,k]=i.useState([]),[p,x]=i.useState(!0),[o,S]=i.useState(null),[h,N]=i.useState(!1),[M,P]=i.useState(!1),[C,b]=i.useState(""),[R,L]=i.useState(""),[B,E]=i.useState(null),[I,K]=i.useState(!1),[U,w]=i.useState(""),[O,oe]=i.useState(""),[Y,y]=i.useState(""),[_,v]=i.useState("modder"),[W,se]=i.useState(!1),[fe,ue]=i.useState(!1),[G,me]=i.useState("general"),[z,ie]=i.useState(!1),[ae,pe]=i.useState(!1),[V,ce]=i.useState(null),[r,g]=i.useState(""),[A,D]=i.useState([]),[ee,J]=i.useState(!1),Z=i.useRef(null),ke=i.useRef(null),ve=i.useRef(null),[je,Ue]=i.useState([]),[qe,Ne]=i.useState(!1),[F,Q]=i.useState(null),{notify:j}=be(),{queueStatusFilters:$}=ze(),te=async()=>{var n,m;if(t){x(!0);try{const u=await q(T.moddi.queue(t),{requireAuth:!1});d(u.queue||null),f(u.members||[]),k(u.submissions||[])}catch(u){(n=u==null?void 0:u.message)!=null&&n.includes("403")||(m=u==null?void 0:u.message)!=null&&m.includes("Forbidden")?(j("You do not have access to this queue",{variant:"error"}),a("/md/queues")):j("Failed to load queue",{variant:"error"})}finally{x(!1)}}};i.useEffect(()=>{te(),q(T.auth.me,{requireAuth:!1}).then(n=>S(n)).catch(()=>{})},[t]);const X=o&&s&&(s.owner_id===o.id||l.some(n=>n.user_id===o.id&&n.joined_at)||o.is_mod||o.is_admin);o&&l.some(n=>n.user_id===o.id&&n.joined_at);const le=o&&s&&(s.owner_id===o.id||l.some(n=>n.user_id===o.id&&n.joined_at)),Ie=async n=>{if(n.preventDefault(),!s||s.is_open===0){j("Queue is closed for submissions",{variant:"error"});return}if(!C.trim()){j("Beatmap URL is required",{variant:"error"});return}P(!0);try{await q(T.moddi.queueSubmit(t),{method:"POST",body:JSON.stringify({beatmap_url:C.trim(),message:R.trim()||null})}),j("Submission created!",{variant:"success"}),N(!1),b(""),L(""),te()}catch(m){j((m==null?void 0:m.message)||"Failed to create submission",{variant:"error"})}finally{P(!1)}},de=n=>{k(m=>m.map(u=>u.id===n.id?n:u)),n.acknowledged_by_me!==void 0&&te()},ye=()=>{s&&(w(s.name),oe(s.description||""),y(s.rules||""),v(s.type||"modder"),K(!0),me("general"))},he=()=>{K(!1),w(""),oe(""),y(""),v("modder")},ge=async()=>{if(!(!s||!le)){ue(!0);try{const n=s.is_open!==1;await q(T.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:n})}),j(`Queue ${n?"opened":"closed"}`,{variant:"success"}),te()}catch(n){j((n==null?void 0:n.message)||"Failed to update status",{variant:"error"})}finally{ue(!1)}}},Me=async n=>{if(n.preventDefault(),!s||!U.trim()){j("Queue name is required",{variant:"error"});return}ie(!0);try{const m=l.filter(H=>H.user_id!==s.owner_id&&H.role!=="owner").length>0,u={name:U.trim(),description:O.trim()||null,rules:Y.trim()||null,is_group:m};(o!=null&&o.is_mod||o!=null&&o.is_admin)&&(u.type=_),await q(T.moddi.queue(t),{method:"PATCH",body:JSON.stringify(u)}),j("Queue updated!",{variant:"success"}),he(),te()}catch(m){j((m==null?void 0:m.message)||"Failed to update queue",{variant:"error"})}finally{ie(!1)}};i.useEffect(()=>{if(!r.trim()){D([]),J(!1);return}const n=setTimeout(async()=>{try{const u=(await q(T.moddi.usersSearch(r),{requireAuth:!1})).items||[];D(u),J(u.length>0)}catch(m){console.error("Search failed:",m),D([]),J(!1)}},300);return()=>clearTimeout(n)},[r]);const We=async n=>{if(!ae){pe(!0);try{await q(T.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:n})}),j("Invite sent!",{variant:"success"}),g(""),D([]),J(!1),te()}catch(m){j((m==null?void 0:m.message)||"Failed to invite member",{variant:"error"})}finally{pe(!1)}}},Qe=async()=>{if(!(!t||!X))try{const n=await q(T.moddi.queueBlockedUsers(t));Ue(n.blocked||[])}catch(n){console.error("Failed to load blocked users:",n)}},jt=async n=>{if(!(!t||qe)&&confirm("Block this user from submitting to this queue?")){Ne(!0);try{await q(T.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:n})}),j("User blocked",{variant:"success"}),Qe(),g(""),D([]),J(!1)}catch(m){j((m==null?void 0:m.message)||"Failed to block user",{variant:"error"})}finally{Ne(!1)}}},Ge=async n=>{if(!(!t||F===n)){Q(n);try{await q(T.moddi.queueUnblockUser(t,n),{method:"DELETE"}),j("User unblocked",{variant:"success"}),Qe()}catch(m){j((m==null?void 0:m.message)||"Failed to unblock user",{variant:"error"})}finally{Q(null)}}};i.useEffect(()=>{G==="members"&&X&&t&&Qe()},[G,X,t]);const St=async()=>{if(s&&confirm(`Are you sure you want to delete "${s.name}"? This action cannot be undone.`)){se(!0);try{await q(T.moddi.queue(t),{method:"DELETE"}),j("Queue deleted",{variant:"success"}),a("/md/queues")}catch(n){j((n==null?void 0:n.message)||"Failed to delete queue",{variant:"error"})}finally{se(!1)}}},wt=async n=>{if(!o||!s||o.id!==s.owner_id){j("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){ce(n);try{await q(T.moddi.queueMember(t,n),{method:"DELETE"}),j("Member removed",{variant:"success"});const u=l.filter(H=>H.user_id!==n).some(H=>H.user_id!==(s==null?void 0:s.owner_id)&&H.role!=="owner");if(s&&s.is_group===1&&!u)try{await q(T.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}te()}catch(m){j((m==null?void 0:m.message)||"Failed to remove member",{variant:"error"})}finally{ce(null)}}},kt=async()=>{if(o&&confirm("Leave this queue? You will need to be invited again to rejoin.")){ce(o.id);try{await q(T.moddi.queueMember(t,o.id),{method:"DELETE"}),j("Left queue",{variant:"success"});const m=l.filter(u=>u.user_id!==o.id).some(u=>u.user_id!==(s==null?void 0:s.owner_id)&&u.role!=="owner");if(s&&s.is_group===1&&!m)try{await q(T.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}a("/md/queues")}catch(n){j((n==null?void 0:n.message)||"Failed to leave queue",{variant:"error"})}finally{ce(null)}}},Nt=async n=>{if(confirm("Cancel this invitation?")){ce(n);try{await q(T.moddi.queueMember(t,n),{method:"DELETE"}),j("Invitation canceled",{variant:"success"}),te()}catch(m){j((m==null?void 0:m.message)||"Failed to cancel invitation",{variant:"error"})}finally{ce(null)}}};return i.useEffect(()=>{if(!I)return;const n=m=>{const u=m.target;u.closest(".manage-overlay")||u.closest(".manage-overlay-backdrop")||!u.closest(".manage-popup")&&ve.current&&!ve.current.contains(u)&&he()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[I]),i.useEffect(()=>{if(!ee)return;const n=m=>{const u=m.target;Z.current&&!Z.current.contains(u)&&ke.current&&!ke.current.contains(u)&&J(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[ee]),p?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):s?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t&&e.jsx(is,{queueId:t,onSubmitted:()=>te()}),e.jsx(Je,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>a("/md/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(gt,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:s.name}),le&&e.jsxs("button",{onClick:ge,disabled:fe,className:`queue-status-badge ${s.is_open===1?"status-open":"status-closed"}`,title:s.is_open===1?"Close queue":"Open queue","aria-label":s.is_open===1?"Close queue":"Open queue",children:[s.is_open===1?e.jsx(Ee,{size:14}):e.jsx($e,{size:14}),e.jsx("span",{children:s.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[X&&e.jsx("button",{ref:ve,className:"icon-link",onClick:ye,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(Ft,{size:18})}),l.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:l.filter(n=>n.joined_at!==null).sort((n,m)=>{const u=n.role==="owner"||n.user_id===(s==null?void 0:s.owner_id),H=m.role==="owner"||m.user_id===(s==null?void 0:s.owner_id);return u&&!H?-1:!u&&H?1:(m.joined_at||0)-(n.joined_at||0)}).map(n=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>E(n.user_id),onMouseLeave:()=>E(null),children:[e.jsx(Ae,{to:`/profile/${n.user_id}`,className:"queue-member-avatar",title:n.username,children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:n.username.charAt(0).toUpperCase()})}),B===n.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[n.username," ",n.role!=="member"?`(${n.role})`:""]})]},n.user_id))})]})]}),s.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:e.jsx(Ke,{text:s.description})}),s.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(ct,{content:s.rules})]}),s.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{className:"queue-submit-desktop-only",style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:12,opacity:s.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:s.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>s.is_open===1&&N(!h),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",s.is_open===0&&"(Closed)"]}),s.is_open===1&&(h?e.jsx(Te,{size:16}):e.jsx(Oe,{size:16}))]}),h&&e.jsx("form",{onSubmit:Ie,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:C,onChange:n=>b(n.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:R,onChange:n=>L(n.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),R.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[R.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:n=>{n.stopPropagation(),N(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:M,onClick:n=>n.stopPropagation(),children:M?"Submitting...":"Submit"})]})]})})]}),e.jsxs("div",{className:"profile-tabs-unified",style:{marginTop:24},children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Submission sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"active",onClick:n=>{const m=n.currentTarget.closest(".profile-tabs-unified");m.querySelectorAll(".profile-tab").forEach(H=>{H.classList.remove("active"),H.setAttribute("aria-selected","false")}),n.currentTarget.classList.add("active"),n.currentTarget.setAttribute("aria-selected","true"),m.querySelector(".profile-tabs-content").setAttribute("data-active","active")},children:"Active"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"archived",onClick:n=>{const m=n.currentTarget.closest(".profile-tabs-unified");m.querySelectorAll(".profile-tab").forEach(H=>{H.classList.remove("active"),H.setAttribute("aria-selected","false")}),n.currentTarget.classList.add("active"),n.currentTarget.setAttribute("aria-selected","true"),m.querySelector(".profile-tabs-content").setAttribute("data-active","archived")},children:"Archived"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"active",children:[e.jsx("div",{className:"panel active",children:e.jsx("div",{className:"col",style:{gap:0},children:c.filter(n=>!!!n.is_archived&&$[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):c.filter(n=>!!!n.is_archived&&$[n.status]).map(n=>e.jsx(He,{submission:n,canManage:!!X,isGroup:(s==null?void 0:s.is_group)===1,onUpdate:de,onDelete:m=>{k(u=>u.filter(H=>H.id!==m))}},n.id))})}),e.jsx("div",{className:"panel archived",children:e.jsx("div",{className:"col",style:{gap:0},children:c.filter(n=>!!n.is_archived&&$[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):c.filter(n=>!!n.is_archived&&$[n.status]).map(n=>e.jsx(He,{submission:n,canManage:!!X,isGroup:(s==null?void 0:s.is_group)===1,onUpdate:de,onDelete:m=>{k(u=>u.filter(H=>H.id!==m))}},n.id))})})]})]}),I&&Pe.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:he}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:he,"aria-label":"Close",children:e.jsx(Te,{size:18})}),e.jsxs("div",{className:"settings-header",style:{padding:"20px 16px 12px"},children:[e.jsx("div",{className:"settings-title",children:"Manage Queue"}),e.jsx("div",{className:"settings-description",children:"Configure queue settings, rules, and members."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Manage Queue",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Manage Queue tabs",children:[e.jsx("button",{role:"tab","aria-selected":G==="general",className:`profile-tab ${G==="general"?"active":""}`,"data-tab":"general",onClick:n=>{const m=n.currentTarget.closest(".profile-tabs-unified"),u=m==null?void 0:m.querySelector(".profile-tabs-content");u==null||u.setAttribute("data-active","general"),me("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":G==="rules",className:`profile-tab ${G==="rules"?"active":""}`,"data-tab":"rules",onClick:n=>{const m=n.currentTarget.closest(".profile-tabs-unified"),u=m==null?void 0:m.querySelector(".profile-tabs-content");u==null||u.setAttribute("data-active","rules"),me("rules")},children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":G==="members",className:`profile-tab ${G==="members"?"active":""}`,"data-tab":"members",onClick:n=>{const m=n.currentTarget.closest(".profile-tabs-unified"),u=m==null?void 0:m.querySelector(".profile-tabs-content");u==null||u.setAttribute("data-active","members"),me("members")},children:"Members"})]}),e.jsx("div",{className:"profile-tabs-content","data-active":G,children:e.jsxs("form",{onSubmit:Me,className:"col",style:{gap:0},children:[e.jsx("div",{className:"panel general",hidden:G!=="general",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:U,onChange:n=>w(n.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:O,onChange:n=>oe(n.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),((o==null?void 0:o.is_mod)||(o==null?void 0:o.is_admin))&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsxs("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Queue Type ",s.owner_id!==(o==null?void 0:o.id)&&e.jsx("span",{style:{fontSize:12,color:"var(--muted)",fontWeight:400},children:"(Mod/Admin only)"})]}),e.jsxs("select",{value:_,onChange:n=>v(n.target.value),style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14},children:[e.jsx("option",{value:"modder",children:"Modder"}),e.jsx("option",{value:"nominator",children:"Nominator"})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:St,disabled:W||z,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(Se,{size:14,style:{marginRight:6}}),W?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:z||W,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:z||W,style:{fontSize:13,padding:"8px 16px"},children:z?"Updating...":"Save Changes"})]})]})]})}),e.jsx("div",{className:"panel rules",hidden:G!=="rules",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:Y,onChange:n=>y(n.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),Y&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(ct,{content:Y})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:z||W,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:z||W,style:{fontSize:13,padding:"8px 16px"},children:z?"Updating...":"Save Changes"})]})]})}),e.jsx("div",{className:"panel members",hidden:G!=="members",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:Z,type:"text",placeholder:"Search username or ID",value:r,onChange:n=>g(n.target.value),onKeyDown:n=>{n.key==="Enter"&&n.preventDefault()},onFocus:()=>{A.length>0&&J(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),ee&&A.length>0&&e.jsx("div",{ref:ke,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:A.map(n=>{const m=l.some(re=>re.user_id===n.id&&re.joined_at),u=l.some(re=>re.user_id===n.id&&re.invited_at&&!re.joined_at),H=je.some(re=>re.user_id===n.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:n.username}),m&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),u&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",n.id," • osu ",n.osu_user_id]})]})]}),X&&!m&&!u&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:re=>{re.stopPropagation(),ae||We(n.id)},disabled:ae,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ft,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re=>{re.stopPropagation(),H?Ge(n.id):jt(n.id)},disabled:qe||F===n.id,title:H?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:H?"var(--accent)":"var(--danger)"},children:H?e.jsx(Ee,{size:16}):e.jsx($e,{size:16})})]})]},n.id)})})})]})]}),l.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const n=l.filter(u=>u.joined_at!==null).sort((u,H)=>{const re=u.role==="owner"||u.user_id===(s==null?void 0:s.owner_id),Re=H.role==="owner"||H.user_id===(s==null?void 0:s.owner_id);return re&&!Re?-1:!re&&Re?1:(H.joined_at||0)-(u.joined_at||0)}),m=l.filter(u=>u.invited_at!==null&&u.joined_at===null);return e.jsxs(e.Fragment,{children:[n.map(u=>{const H=o&&s&&o.id===s.owner_id,re=u.user_id===(o==null?void 0:o.id),Re=u.user_id===(s==null?void 0:s.owner_id)||u.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.role})]})]}),H&&!Re&&e.jsx("button",{className:"icon-link",onClick:()=>wt(u.user_id),disabled:V===u.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(Se,{size:16})}),!H&&re&&e.jsx("button",{className:"icon-link",onClick:kt,disabled:V===u.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(qt,{size:16})})]},u.user_id)}),m.length>0&&e.jsx(e.Fragment,{children:m.map(u=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[u.avatar_url&&e.jsx("img",{src:u.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:u.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:u.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Nt(u.user_id),disabled:V===u.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(Te,{size:16})})]},u.user_id))})]})})()})]}),X&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),je.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:je.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:n.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:n.username}),n.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",n.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Ge(n.user_id),disabled:F===n.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(Ee,{size:16})})]},n.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:z||W,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:z||W,style:{fontSize:13,padding:"8px 16px"},children:z?"Updating...":"Save Changes"})]})]})})]})})]})]})]}),document.body),e.jsx("style",{children:`
        /* Hide inline submit form on mobile – mobile uses floating FAB instead */
        html.is-mobile .queue-submit-desktop-only {
          display: none;
        }

        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function bs(){const{data:t=[],isLoading:a}=Kt(),s=Jt(),d=Xt(),{notify:l}=be(),f=Ye(),c=we(),[k,p]=i.useState(new Set),{data:x}=Fe(),[o,S]=i.useState(!1),[h,N]=i.useState(!1),[M,P]=i.useState(!1),C=i.useRef(null),b=i.useRef(null),R=!!(x!=null&&x.is_admin||x!=null&&x.is_mod);Gt(C,b,o,()=>S(!1));const L=async y=>{s.mutate(y,{onSuccess:()=>{}})},B=async y=>{y.startsWith("n:")&&d.mutate(y)},E=async()=>{const y=t.filter(_=>!_.read&&(_.id.startsWith("n:")||_.kind==="system"&&!_.id.startsWith("b:"))).map(_=>_.id);y.length>0&&(await L(y),l("All notifications marked as read",{variant:"success"}))},I=y=>{if(!y)return null;try{const _=JSON.parse(y);if((_==null?void 0:_.type)==="queue_invite"&&(_!=null&&_.queue_id))return _}catch{}return null},K=async(y,_)=>{if(!k.has(y.id)){p(v=>new Set(v).add(y.id));try{await q(T.moddi.queueAccept(String(_)),{method:"POST"}),l("Invitation accepted!",{variant:"success"}),B(y.id),f(`/md/queues/${_}`)}catch(v){l((v==null?void 0:v.message)||"Failed to accept invitation",{variant:"error"})}finally{p(v=>{const W=new Set(v);return W.delete(y.id),W})}}},U=async(y,_)=>{if(!k.has(y.id)){p(v=>new Set(v).add(y.id));try{await q(T.moddi.queueDeny(String(_)),{method:"POST"}),l("Invitation declined",{variant:"success"}),B(y.id)}catch(v){l((v==null?void 0:v.message)||"Failed to decline invitation",{variant:"error"})}finally{p(v=>{const W=new Set(v);return W.delete(y.id),W})}}},w=y=>I(y.text)?e.jsx(ft,{size:20,color:"#a78bfa"}):y.kind==="star"?e.jsx(at,{size:20,color:"#f59e0b"}):y.kind==="likes5"?e.jsx(nt,{size:20,color:"#f472b6"}):y.kind==="comment"?e.jsx(_e,{size:20,color:"#60a5fa"}):y.kind==="inspiration"?e.jsx(_e,{size:20,color:"#7dd3fc"}):y.kind==="reaction"?e.jsx(rt,{size:20,color:"#10b981"}):y.id.startsWith("b:")?e.jsx(it,{size:20,color:"#a78bfa"}):null,O=y=>I(y.text)?"Queue Invitation":y.kind==="star"?"Star":y.kind==="likes5"?"Likes":y.kind==="comment"?"Comment":y.kind==="inspiration"?"Inspiration":y.kind==="reaction"?"Reaction":y.id.startsWith("b:")?"Global":"System",oe=t.filter(y=>!y.read&&!(y.id.startsWith("b:")&&y.expiresAt&&y.expiresAt<=Date.now())).length,Y=async y=>{if(!(!(x!=null&&x.id)||M)){P(!0);try{const _={kind:y};y==="system"&&(_.text="Test system notification"),await q(T.admin.notificationsTest,{method:"POST",body:JSON.stringify(_)}),l("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(_){l((_==null?void 0:_.message)||"Failed to send test notification",{variant:"error"})}finally{P(!1),S(!1),N(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[R&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:C,className:"btn secondary",onClick:()=>S(!o),disabled:M,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(xe,{size:14,style:{transition:"transform 0.2s ease",transform:o?"rotate(180deg)":"rotate(0deg)"}})]}),o&&e.jsxs("div",{ref:b,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>Y("star"),disabled:M,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>Y("likes5"),disabled:M,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>Y("comment"),disabled:M,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>Y("inspiration"),disabled:M,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>Y("reaction"),disabled:M,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>Y("system"),disabled:M,children:"Test System"})]})]}),oe>0&&e.jsxs("button",{className:"btn secondary",onClick:E,children:[e.jsx(st,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),R&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>N(!0),children:e.jsx(tt,{size:22})}),e.jsx(De,{open:h,onClose:()=>N(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>Y("star"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(at,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>Y("likes5"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(nt,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>Y("comment"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(_e,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>Y("inspiration"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(_e,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>Y("reaction"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(rt,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>Y("system"),disabled:M,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(it,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:a?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(y=>!(y.id.startsWith("b:")&&y.expiresAt&&y.expiresAt<=Date.now())).map(y=>{const _=({notif:v})=>{const[W,se]=i.useState(0),[fe,ue]=i.useState(!1),G=i.useRef(null),me=i.useRef(null),z=i.useRef(null),ie=i.useRef(null),ae=g=>{v.id.startsWith("n:")&&(G.current=g.touches[0].clientX,ie.current=g.touches[0].clientY,me.current=Date.now(),ue(!1))},pe=g=>{if(G.current===null||ie.current===null||!v.id.startsWith("n:"))return;const A=g.touches[0].clientX,D=g.touches[0].clientY,ee=A-G.current,J=Math.abs(D-ie.current);Math.abs(ee)>J&&(ue(!0),se(Math.max(-80,Math.min(0,ee))))},V=()=>{if(G.current===null)return;W<=-60&&B(v.id),se(0),ue(!1),G.current=null,ie.current=null,me.current=null},ce=v.id.startsWith("n:"),r=typeof v.targetPath=="string"&&v.targetPath.trim().length>0?v.targetPath.trim():null;return e.jsxs("div",{ref:z,style:{position:"relative",background:v.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:r?"pointer":"default",opacity:v.read?.7:1,transform:`translateX(${W}px)`,transition:fe?"none":"transform 0.2s ease",touchAction:ce?"pan-x pan-y":"pan-y"},onTouchStart:ae,onTouchMove:pe,onTouchEnd:V,onTouchCancel:V,onClick:()=>{if(!(Math.abs(W)>10)){if(!v.read&&v.id.startsWith("n:")&&L([v.id]),r){f(r);return}v.videoId&&(window.location.hash="/mp/feed")}},children:[ce&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(W)/80,pointerEvents:"none",zIndex:0},children:e.jsx(Se,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:w(v)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:O(v)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(v.createdAt).toLocaleDateString()}),v.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:g=>{g.stopPropagation(),B(v.id)},style:{padding:4},children:e.jsx(Se,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const g=I(v.text);return g?`${g.inviter_username} invited you to join queue: ${g.queue_name}`:v.text||(v.kind==="star"?"One of your posts was starred!":v.kind==="likes5"?"One of your posts reached 5 likes!":v.kind==="comment"?"Someone commented on your post":v.kind==="inspiration"?"Someone is inspired by you!":v.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const g=I(v.text);return g&&!k.has(v.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:A=>{A.stopPropagation(),K(v,g.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(st,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:A=>{A.stopPropagation(),U(v,g.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Te,{size:14,style:{marginRight:4}}),"Decline"]})]}):g&&k.has(v.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),v.read&&v.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(v.readAt).toLocaleString()]})]})]})]},v.id)};return e.jsx(_,{notif:y},y.id)})})})]})}function ys(){const[t,a]=i.useState([]),[s,d]=i.useState(!0),{notify:l}=be();i.useEffect(()=>{f()},[]);const f=async()=>{try{d(!0);const p=await q(T.moddi.mySubmissions);a(p.items)}catch(p){console.error(p),l("Failed to load submissions",{variant:"error"})}finally{d(!1)}},c=p=>{a(x=>x.map(o=>o.id===p.id?{...o,...p}:o))},k=p=>{a(x=>x.filter(o=>o.id!==p))};return e.jsxs("div",{className:"col",style:{width:"100%",maxWidth:1e3,margin:"0 auto",padding:"24px 16px"},children:[e.jsx("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:24},children:e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"title",children:"My Submissions"}),e.jsx("div",{className:"muted",children:"Track your modding queue submissions"})]})}),s?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):t.length===0?e.jsxs("div",{className:"panel",style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx(Ae,{to:"/md/queues",className:"btn",style:{marginTop:16,display:"inline-block"},children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:16},children:t.map(p=>e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",padding:"0 4px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(Ae,{to:`/md/queues/${p.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:x=>x.currentTarget.style.textDecoration="underline",onMouseLeave:x=>x.currentTarget.style.textDecoration="none",children:p.queue_name}),p.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(p.created_at*1e3).toLocaleDateString()})]}),e.jsx(He,{submission:p,canManage:!1,allowSelfActions:!0,onUpdate:c,onDelete:k})]},p.id))})]})}export{yt as C,Je as D,Zt as F,es as M,bs as N,fs as P,hs as Q,us as a,Fe as b,Gt as c,ms as d,Yt as e,ps as f,Jt as g,Xt as h,Kt as i,gs as j,xs as k,ys as l,ze as u};
