const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-ChoxNW6l.js","assets/index-TJif1grx.js","assets/vendor-react-_vsaDC62.js","assets/vendor-DBgzFpze.js","assets/editor-components-CKFEosPJ.js","assets/editor-components-Bzmrvihl.css","assets/index-Do5egyzH.css"])))=>i.map(i=>d[i]);
import{u as it,a as b,A as m,B as ot,_ as Be,b as at}from"./index-TJif1grx.js";import{r as i,R as ee,i as lt,j as r,b as ct,a as dt,L as He,p as ut,D as ft,E as mt,G as Ve,I as pt,J as qe,A as ht,c as gt}from"./vendor-react-_vsaDC62.js";import{P as xt}from"./Popup-ChoxNW6l.js";import{P as bt}from"./beatmap-preview-iFLBdsja.js";import{C as yt}from"./Comment-B-hS2-8x.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";import"./editor-lib-BGkr3wNG.js";const h={};function Ct(){var Ae,Fe,Oe;const[y,_]=i.useState(h.history||[]),[c,N]=i.useState(h.index||-1),n=c>=0?y[c]:null,[F,ve]=i.useState(!1),[Ue,we]=i.useState(!1),[Ye,We]=i.useState(!1),[te,O]=i.useState(!1),ne=ee.useRef(null),[re,se]=i.useState(!1),ie=ee.useRef(null),[k,$e]=i.useState(null),[oe,M]=i.useState(!1),[ae,B]=i.useState(!1),le=ee.useRef(null),ce=ee.useRef(null),[u,de]=i.useState(!1),[je,Se]=i.useState([]),[D,H]=i.useState(""),[ue,fe]=i.useState(null),[me,_e]=i.useState(!1),[E,R]=i.useState(!0),{notify:S}=it(),[w,V]=i.useState(h.queue||[]),T=i.useRef(h.seenIds||new Set),ke=i.useRef(new Set),pe=i.useRef(!1),[Ee,q]=i.useState(h.eligibleCount||null),[Re,U]=i.useState(h.viewedCount||0),[z,P]=i.useState(!1),C=i.useRef(h.lastShownVideoId||null);i.useEffect(()=>()=>{h.history=y,h.index=c,h.queue=w,h.seenIds=T.current,h.eligibleCount=Ee,h.viewedCount=Re,h.lastShownVideoId=C.current},[y,c,w,Ee,Re]);function Je(){try{const e=Array.from(T.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function Y(){try{const e=localStorage.getItem("filter_modes"),t=(e?String(e):"standard").toLowerCase().split(",").map(a=>a.trim()).filter(Boolean),s=["standard","taiko","mania","catch"],o=Array.from(new Set(t.filter(a=>s.includes(a))));return o.length?o:["standard"]}catch{return["standard"]}}const Xe=()=>{const e=new Set;return C.current!==null&&e.add(C.current),Array.from(T.current).slice(-200).forEach(s=>e.add(s)),w.forEach(s=>e.add(s.id)),Array.from(e)},Ce=async(e=5)=>{var t,s,o,a;if(pe.current)return[];pe.current=!0;try{const l=Xe(),I=Y().join(","),v=[],g=new Set(w.map(f=>f.id));let x=[...l];for(let f=0;f<e;f++)try{const d=await b(m.feed.next+at({exclude:x.join(","),modes:I}),{requireAuth:!1}),j=d&&("id"in d?d:d.video)||null;if(!j)break;if(T.current.has(j.id)||g.has(j.id)||j.id===C.current){x.push(j.id);continue}v.push(j),x.push(j.id),g.add(j.id)}catch(d){if((t=d==null?void 0:d.message)!=null&&t.includes("401")||(s=d==null?void 0:d.message)!=null&&s.includes("Unauthorized")){We(!0);break}else if((o=d==null?void 0:d.message)!=null&&o.includes("429")||(a=d==null?void 0:d.message)!=null&&a.includes("rate limit")){S("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}}if(v.length>0&&V(f=>{const d=new Set(f.map(ye=>ye.id)),j=v.filter(ye=>!d.has(ye.id));return[...f,...j]}),v.length===0&&w.length===0)try{const f=await b(m.feed.progress(I),{requireAuth:!1});q(Number(f.eligible||0)),U(Number(f.viewed||0)),P(Number(f.caught_up||0)===1)}catch{}return v}catch{return[]}finally{pe.current=!1}},W=async()=>{if(!F){ve(!0);try{w.length<=2&&Ce(5).catch(()=>{});let e;if(w.length>0)e=w[0],V(t=>t.filter(s=>s.id!==e.id));else{const t=await Ce(3);t.length>0&&(e=t[0],t.length>1&&V(s=>{const o=new Set(s.map(l=>l.id)),a=t.slice(1).filter(l=>!o.has(l.id));return[...s,...a]}))}if(e)C.current=e.id,T.current.add(e.id),Je(),_(t=>{const s=[...t.slice(0,c+1),e];return N(s.length-1),s}),ke.current.has(e.id)||(ke.current.add(e.id),b(m.videos.view(e.id),{method:"POST"}).then(t=>{t&&_(s=>{const o=[...s],a=o.findIndex(l=>l.id===e.id);return a!==-1&&(o[a]={...o[a],views_count:t.views_count??o[a].views_count??0,viewed_by_me:!0}),o})}).catch(()=>{}));else try{const t=Y().join(","),s=await b(m.feed.progress(t),{requireAuth:!1});q(Number(s.eligible||0)),U(Number(s.viewed||0)),P(Number(s.eligible||0)>0&&Number(s.viewed||0)>=Number(s.eligible||0))}catch{}}finally{ve(!1)}}},he=()=>{c>0&&(N(c-1),M(!1))},ge=()=>{if(!E&&(A.current=!0,Q.current=!0,p.current)){const e=p.current;e.muted=!1,R(!1),e.play().catch(()=>{})}if(c<y.length-1){const e=y[c+1];e&&(C.current=e.id),N(c+1),M(!1);return}z||W()},$=i.useRef(0),J=i.useRef(null),X=i.useRef(null),xe=i.useRef({goNext:ge,goPrev:he,index:c,history:y,loading:F,exhausted:z});i.useEffect(()=>{xe.current={goNext:ge,goPrev:he,index:c,history:y,loading:F,exhausted:z}},[ge,he,c,y,F,z]),i.useEffect(()=>{const e=Pe.current;if(!e)return;const t=a=>{if(e){const g=e.getBoundingClientRect(),x=a.clientX,f=a.clientY;if(x<g.left||x>g.right||f<g.top||f>g.bottom)return}a.preventDefault(),a.stopPropagation();const l=Date.now();if(l<$.current||($.current=l+1e3,Math.abs(a.deltaY)<Math.abs(a.deltaX)))return;const{goNext:I,goPrev:v}=xe.current;a.deltaY>0?I():v()},s=a=>{J.current=a.touches[0].clientY,X.current=Date.now()},o=a=>{if(J.current===null||X.current===null)return;const l=a.changedTouches[0].clientY,I=Date.now(),v=J.current-l,g=I-X.current;if(J.current=null,X.current=null,Math.abs(v)<50||g>300)return;const x=Date.now();if(x<$.current)return;$.current=x+1e3;const{goNext:f,goPrev:d}=xe.current;v>0?f():d()};return e.addEventListener("wheel",t,{passive:!1,capture:!0}),e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchend",o,{passive:!0}),window.addEventListener("wheel",t,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",t,{capture:!0}),e.removeEventListener("touchstart",s),e.removeEventListener("touchend",o),window.removeEventListener("wheel",t,{capture:!0})}},[]);const Qe=async()=>{var e,t;if(n){we(!0);try{const s=n.liked_by_me?"DELETE":"POST",o=await b(m.videos.like(n.id),{method:s});_(a=>{const l=[...a];return l[c]={...l[c],liked_by_me:!n.liked_by_me,likes_count:o.likes_count},l})}catch(s){((e=s==null?void 0:s.message)!=null&&e.includes("429")||(t=s==null?void 0:s.message)!=null&&t.includes("rate limit"))&&S("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{we(!1)}}};async function Ie(e){if(n)try{await b(m.videos.flag(n.id),{method:"POST",body:JSON.stringify({reason:e})}),S("Thanks for your report.",{variant:"info"})}catch{S("Report failed",{variant:"error"})}finally{O(!1)}}i.useEffect(()=>{if(!te)return;const e=t=>{ne.current&&!ne.current.contains(t.target)&&O(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[te]),i.useEffect(()=>{if(!re)return;const e=t=>{ie.current&&!ie.current.contains(t.target)&&se(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[re]),i.useEffect(()=>{if(!ae)return;const e=t=>{le.current&&!le.current.contains(t.target)&&ce.current&&!ce.current.contains(t.target)&&B(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ae]),i.useEffect(()=>{y.length===0&&W()},[]),i.useEffect(()=>{n&&(C.current=n.id)},[n==null?void 0:n.id]),i.useEffect(()=>{(async()=>{try{const e=Y().join(","),t=await b(m.feed.progress(e),{requireAuth:!1}),s=Number(t.eligible||0),o=Number(t.viewed||0);q(s),U(o);const a=s>0&&o>=s;P(a)}catch{}})()},[]),i.useEffect(()=>{const e=()=>{_([]),V([]),T.current.clear(),C.current=null,N(-1),P(!1),(async()=>{try{const t=Y().join(","),s=await b(m.feed.progress(t),{requireAuth:!1}),o=Number(s.eligible||0),a=Number(s.viewed||0);q(o),U(a),P(!1)}catch{}W()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),i.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const t=JSON.parse(e);if(Array.isArray(t))for(const s of t)typeof s=="number"&&T.current.add(s)}}catch{}},[]),i.useEffect(()=>{(async()=>{try{const e=await b(m.auth.me,{requireAuth:!1});$e(e)}catch{}})()},[]);const A=i.useRef(!1),Ge=async e=>{if(e)try{const t=e.playback_url||(e.stream_uid?`https://videodelivery.net/${e.stream_uid}/manifest/video.m3u8`:null);if(!t)return;fetch(t,{priority:"low"}).then(async s=>{if(s.ok)try{const o=await s.text(),l=new TextEncoder().encode(o).buffer,{setCached:I}=await Be(async()=>{const{setCached:g}=await import("./Popup-ChoxNW6l.js").then(x=>x.v);return{setCached:g}},__vite__mapDeps([0,1,2,3,4,5,6]));await I(t,l,!0,e.stream_uid);const{memoryCache:v}=await Be(async()=>{const{memoryCache:g}=await import("./Popup-ChoxNW6l.js").then(x=>x.h);return{memoryCache:g}},__vite__mapDeps([0,1,2,3,4,5,6]));v.set(t,l)}catch{}}).catch(()=>{})}catch{}};i.useEffect(()=>{M(!1),de(!1),A.current?R(!1):R(!0)},[n==null?void 0:n.id]),i.useEffect(()=>{p.current&&(p.current.muted=E)},[E]),i.useEffect(()=>{if(!n)return;const e=w.length>0?w[0]:c<y.length-1?y[c+1]:null;if(e&&e.id!==n.id&&Ge(e),p.current){const t=p.current,s=!A.current;t.muted=s,R(s),t.play().catch(o=>{o.name!=="AbortError"&&o.name!=="NotAllowedError"&&!s&&t===p.current&&(t.muted=!0,R(!0),t.play().catch(()=>{}))})}},[n==null?void 0:n.id,w,c,y]);const Q=i.useRef(!1),Ke=e=>{p.current=e,e&&(Q.current&&A.current?(e.muted=!1,R(!1),e.play().then(()=>{Q.current=!1}).catch(()=>{e.muted=!0,R(!0),Q.current=!1,e.play().catch(()=>{})})):e.muted=E)},Te=async()=>{if(n!=null&&n.id)try{const e=await b(m.videos.comments(n.id),{requireAuth:!1});Se(e.items||[])}catch{}};i.useEffect(()=>{u&&(n!=null&&n.id)&&Te()},[u,n==null?void 0:n.id]);const Ne=async e=>{if(e.preventDefault(),!(!D.trim()||!(n!=null&&n.id))){_e(!0);try{await b(m.videos.comments(n.id),{method:"POST",body:JSON.stringify({text:D.trim(),parent_id:ue||void 0})}),H(""),fe(null),Te(),_(t=>{const s=[...t],o=s.findIndex(a=>a.id===n.id);return o!==-1&&(s[o]={...s[o],comments_count:(s[o].comments_count||0)+1}),s}),S("Comment posted!",{variant:"success"})}catch(t){S((t==null?void 0:t.message)||"Failed to post comment",{variant:"error"})}finally{_e(!1)}}},Ze=e=>{Se(t=>t.filter(s=>s.id!==e)),_(t=>{const s=[...t],o=s.findIndex(a=>a.id===(n==null?void 0:n.id));return o!==-1&&(s[o]={...s[o],comments_count:Math.max(0,(s[o].comments_count||0)-1)}),s})},ze=je.filter(e=>!e.parent_id),G=new Map;je.filter(e=>e.parent_id).forEach(e=>{const t=e.parent_id;G.has(t)||G.set(t,[]),G.get(t).push(e)});const p=i.useRef(null),K=i.useRef(null),L=i.useRef(!1),et=()=>{if(!p.current||L.current)return;const e=p.current,t=!E;R(t),e.muted=t,t||(A.current=!0),!t&&e.paused&&e.play().catch(s=>{console.debug("Play failed after unmute:",s)})},Le=()=>{p.current&&(L.current=!1,K.current=window.setTimeout(()=>{L.current=!0;const e=p.current;e&&!e.paused&&e.pause()},200))},be=()=>{if(K.current&&(clearTimeout(K.current),K.current=null),L.current&&p.current){const e=p.current;e.paused&&e.play().catch(t=>console.debug("Resume failed:",t)),L.current=!1}},tt=()=>{Le()},nt=e=>{L.current&&e.preventDefault(),be()},Me=!!(k!=null&&k.is_admin||k!=null&&k.is_mod);async function rt(){if(!n)return;const e=!n.is_starred,t=e?"star":"unstar";try{await b(m.admin.videosAction(n.id,t),{method:"POST"}),_(s=>{const o=[...s];return o[c]={...o[c],is_starred:e},o}),se(!1),S(e?"Post starred":"Star removed",{variant:"success"})}catch{S("Action failed",{variant:"error"})}}async function De(){if(n&&confirm("Permanently delete this video?"))try{await b(m.videos.delete(n.id),{method:"DELETE"}),S("Deleted",{variant:"warn"}),O(!1),_(e=>{const t=e.filter((s,o)=>o!==c);return t.length===0?(N(-1),setTimeout(W,0)):N(s=>Math.max(0,Math.min(s,t.length-1))),t})}catch{alert("Delete failed")}}lt();const Pe=i.useRef(null),[Z,st]=i.useState(0);return i.useEffect(()=>{const e=()=>{const t=document.querySelector(".top-nav");t&&st(t.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),r.jsxs(r.Fragment,{children:[r.jsx(ot,{paused:!1}),r.jsxs("div",{ref:Pe,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[z&&r.jsx("div",{className:"chip info",style:{position:"absolute",top:Z+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),r.jsx("div",{className:"video-area",style:{position:"absolute",top:Z,left:0,right:0,bottom:u?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:Ye?r.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[r.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),r.jsx("button",{className:"btn",onClick:()=>window.location.href=m.auth.login,children:"Login with osu!"})]}):n?r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:oe&&n.beatmapset_id?r.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:r.jsx(bt,{downloadUrl:n.beatmapset_id?m.osu.downloadBeatmapset(n.beatmapset_id):"",beatmapId:n.beatmap_id??void 0,beatmapVersion:n.beatmap_version??void 0,onOpenInEditor:()=>{M(!1),window.location.hash="/editor"}})}):r.jsxs("div",{style:{width:u?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:u?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:u?`calc(50vh - ${Z}px)`:`calc(100vh - ${Z}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),r.jsx("div",{style:{position:"relative",zIndex:1},children:r.jsxs("div",{onClick:et,onMouseDown:Le,onMouseUp:be,onMouseLeave:be,onTouchStart:tt,onTouchEnd:nt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[r.jsx(xt,{streamUID:n.stream_uid,playbackUrl:n.playback_url,aspectRatio:n!=null&&n.width&&(n!=null&&n.height)?n.width/n.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:E,controls:!1,onVideoRef:Ke}),r.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:E?1:0},children:E?r.jsx(ct,{size:20,color:"#fff"}):r.jsx(dt,{size:20,color:"#fff"})})]})})]})}):z?null:r.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[r.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),r.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[r.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),r.jsx("div",{children:"• Click video to toggle mute/unmute"}),r.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),n&&!oe&&r.jsxs("div",{style:{position:"absolute",right:u?12:16,top:"50%",display:"flex",flexDirection:"column",gap:u?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:u?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[r.jsx(He,{to:`/profile/${(Ae=n.uploader)==null?void 0:Ae.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Fe=n.uploader)!=null&&Fe.avatar_url?r.jsx("img",{src:n.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:n.uploader.username}):r.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:Qe,disabled:Ue,"aria-label":n.liked_by_me?"Unlike":"Like",title:n.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:n.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.liked_by_me?r.jsx(ut,{size:28}):r.jsx(ft,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.likes_count??0})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:()=>de(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(mt,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.comments_count??0})]}),n.beatmap_url&&r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{ref:ce,onClick:()=>B(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(Ve,{size:24})}),ae&&r.jsxs("div",{ref:le,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsxs("a",{className:"menu-item",href:n.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>B(!1),children:[r.jsx(Ve,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),n.beatmapset_id&&r.jsx("button",{className:"menu-item",onClick:()=>{M(!0),B(!1)},children:"Preview"})]})]}),Me?r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>se(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(qe,{size:24})}),re&&r.jsxs("div",{ref:ie,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("button",{className:"menu-item",onClick:rt,children:n.is_starred?"Unstar post":"Star post"}),r.jsx("button",{className:"menu-item",onClick:De,children:"Delete video"})]})]}):r.jsx("button",{onClick:()=>O(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(pt,{size:24})}),te&&r.jsxs("div",{ref:ne,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),r.jsx("button",{className:"menu-item",onClick:()=>Ie("unrelated"),children:"Unrelated"}),r.jsx("button",{className:"menu-item",onClick:()=>Ie("explicit"),children:"Explicit"}),Me&&r.jsx("button",{className:"menu-item",onClick:De,children:"Delete video"})]})]}),n&&!oe&&r.jsxs("div",{style:{position:"absolute",left:u?12:16,bottom:u?"55%":80,right:u?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:u?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:u?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:r.jsx(He,{to:`/profile/${(Oe=n.uploader)==null?void 0:Oe.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:u?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var o,a,l;const e=(o=n.uploader)==null?void 0:o.is_admin,t=(a=n.uploader)==null?void 0:a.is_mod,s=e?"#fff3bf":t?"#d7fbe8":"#fff";return r.jsxs(r.Fragment,{children:[r.jsxs("span",{style:{color:s},children:["@",(l=n.uploader)==null?void 0:l.username]}),n.is_starred&&r.jsx(ht,{size:u?14:16,color:"#f59e0b",title:"Starred"}),(e||t)&&r.jsx(qe,{size:u?12:14,color:s,title:e?"admin":"mod"})]})})()})}),(n.description??"").trim()&&r.jsx("div",{style:{color:"#fff",fontSize:u?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:n.description}),n.beatmap_title&&r.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:u?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[n.beatmap_artist," – ",n.beatmap_title," ",n.beatmap_mapper?`(by ${n.beatmap_mapper})`:""," ",n.beatmap_version?`[${n.beatmap_version}]`:""]})]}),u&&n&&r.jsxs(r.Fragment,{children:[r.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),r.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[r.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",n.comments_count??0,")"]}),r.jsx("button",{onClick:()=>de(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:r.jsx(gt,{size:24})})]}),r.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:ze.length===0?r.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):r.jsx("div",{className:"col",style:{gap:0},children:ze.map(e=>r.jsx(yt,{comment:e,replies:G.get(e.id)||[],me:k,section:"mappi",onReply:t=>fe(t),onDelete:Ze,replyingTo:ue,replyText:D,onReplyTextChange:H,onReplySubmit:Ne,posting:me,onCancelReply:()=>{fe(null),H("")}},e.id))})}),k&&!ue&&r.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:r.jsxs("form",{onSubmit:Ne,style:{display:"flex",alignItems:"flex-end",gap:8},children:[r.jsx("textarea",{placeholder:"Write a comment...",value:D,onChange:e=>H(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,120)}px`}}),r.jsx("button",{type:"submit",className:"btn compact",disabled:me||!D.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:me?"...":"Post"})]})})]})]})]})]})}export{Ct as default};
