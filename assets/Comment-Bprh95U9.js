import{r as p,j as e,W as E,F,B as I,X as _}from"./vendor-react-C7NF2CWg.js";import{a as D}from"./Popup-CoSBxWSJ.js";import{u as N,A as S,a as B}from"./index-CV8g-6Hr.js";function L({comment:t,replies:r,me:i,onReply:x,onDelete:h,replyingTo:f,replyText:n,onReplyTextChange:a,onReplySubmit:b,posting:l,onCancelReply:c,section:m,repliesMap:o}){const[j,u]=p.useState(!1),v=p.useRef(null),{notify:y}=N(),[d,z]=p.useState(!1),k=t.parent_id!==null,C=i&&(i.id===t.user_id||i.is_admin||i.is_mod),w=async()=>{if(confirm("Delete this comment?"))try{const s=m==="mappi"?S.videos.comments(t.post_id)+`/${t.id}`:S.moddi.postComments(t.post_id)+`/${t.id}`;await B(s,{method:"DELETE"}),h(t.id),y("Comment deleted",{variant:"success"})}catch{y("Failed to delete comment",{variant:"error"})}finally{u(!1)}};return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease"},onMouseEnter:s=>s.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:s=>s.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:13,fontWeight:500},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(t.created_at*1e3).toLocaleDateString()})]}),e.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:t.text}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:e.jsxs("button",{onClick:()=>x(t.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[e.jsx(E,{size:14}),"Reply"]})}),f===t.id&&i&&e.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("form",{onSubmit:b,style:{display:"flex",alignItems:"flex-end",gap:6},children:[e.jsx("textarea",{placeholder:`Reply to ${t.username}...`,value:n||"",onChange:s=>a==null?void 0:a(s.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:s=>{const g=s.target;g.style.height="auto",g.style.height=`${Math.min(g.scrollHeight,100)}px`},autoFocus:!0}),e.jsx("button",{type:"submit",className:"btn compact",disabled:l||!(n!=null&&n.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:l?"...":"Reply"}),c&&e.jsx("button",{type:"button",onClick:c,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid rgba(255,255,255,0.12)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),C&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:v,className:"icon-link",onClick:()=>u(!j),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:e.jsx(F,{size:16})}),e.jsx(D,{open:j,onClose:()=>u(!1),buttonRef:v,children:e.jsx("button",{className:"menu-item",onClick:w,style:{color:"var(--danger)"},children:"Delete"})})]})]}),r.length>0&&e.jsxs("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid rgba(255,255,255,0.06)"},children:[k&&e.jsxs("button",{onClick:()=>z(!d),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:11,padding:"4px 0",marginBottom:4},children:[d?e.jsx(I,{size:12}):e.jsx(_,{size:12}),d?"Hide":"Show"," ",r.length," ",r.length===1?"reply":"replies"]}),(!k||d)&&e.jsx(e.Fragment,{children:r.map(s=>e.jsx(L,{comment:s,replies:(o==null?void 0:o.get(s.id))||[],me:i,onReply:x,onDelete:h,replyingTo:f,replyText:n,onReplyTextChange:a,onReplySubmit:b,posting:l,onCancelReply:c,section:m,repliesMap:o},s.id))})]})]})}export{L as C};
