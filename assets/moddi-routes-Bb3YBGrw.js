import{r as o,j as e,d as jt,u as fe,e as he,f as we,g as ye,h as ue,i as Oe,k as Qe,l as $e,m as ge,n as ve,R as ne,o as Se,p as wt,q as St,s as tt,L as je,t as kt,v as Tt,w as st,x as me,c as Ie,y as nt,z as Ue,A as _t,B as Nt,M as Ct,C as He,D as Ye,E as Xe,G as Je,H as Ge,I as Ke,J as qt}from"./vendor-react-CMWRFQha.js";import{B as zt}from"./editor-DeW7s35J.js";function at(){if(typeof window>"u")return!1;try{const t=navigator.userAgentData;if(t&&typeof t.mobile=="boolean"&&t.mobile||window.matchMedia&&(window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(hover: none)").matches))return!0;const s=navigator.userAgent||"";if(/Android|iPhone|iPad|iPod|Mobile|Silk|Kindle|Opera Mini|IEMobile|WPDesktop/i.test(s))return!0}catch{}return!1}function ts(){var u;if(typeof window>"u"||typeof document>"u")return()=>{};const t=()=>{const i=at();document.documentElement.classList.toggle("is-mobile",i),document.documentElement.setAttribute("data-mobile",i?"true":"false")};t();const s=["(pointer: coarse)","(hover: none)","(orientation: landscape)","(orientation: portrait)"],n=[];try{for(const i of s)if(window.matchMedia){const l=window.matchMedia(i);(u=l.addEventListener)==null||u.call(l,"change",t),n.push(l)}}catch{}return window.addEventListener("resize",t),()=>{try{n.forEach(i=>{var l;return(l=i.removeEventListener)==null?void 0:l.call(i,"change",t)}),window.removeEventListener("resize",t)}catch{}}}function ss(){if(typeof window>"u")return!1;try{const t=navigator.standalone===!0,s=window.matchMedia&&window.matchMedia("(display-mode: standalone)"),n=!!(s&&s.matches),u=window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)"),i=window.matchMedia&&window.matchMedia("(display-mode: fullscreen)");return t||n||!!(u&&u.matches)||!!(i&&i.matches)}catch{return!1}}const rt=o.createContext(null);function ns({children:t}){const[s,n]=o.useState([]),u=o.useRef(1),i=o.useRef(new Map),l=d=>{const v=i.current.get(d);v&&(clearTimeout(v),i.current.delete(d))},c=(d,v)=>{l(d);const h=window.setTimeout(()=>x(d),v);i.current.set(d,h)},x=o.useCallback(d=>{l(d),n(v=>v.filter(h=>h.id!==d))},[]),b=o.useCallback((d,v)=>{const h=typeof v=="number"?v:(v==null?void 0:v.durationMs)??5e3,z=typeof v=="number"?"info":(v==null?void 0:v.variant)??"info",N=at();let _=null;return n(N?T=>{const k=T[0];if(k&&k.message===d&&k.variant===z){const w={...k,count:k.count+1,duration:h};return _=w.id,[w]}T.forEach(w=>l(w.id));const E=u.current++,j={id:E,message:d,duration:h,variant:z,count:1};return _=E,[j]}:T=>{const k=T.findIndex(w=>w.message===d&&w.variant===z);if(k!==-1){const w=[...T],P={...w[k],count:w[k].count+1};return w[k]=P,_=P.id,w}const E=u.current++,j={id:E,message:d,duration:h,variant:z,count:1};return _=E,[...T,j]}),_!=null&&c(_,h),_??-1},[]),S=o.useMemo(()=>({notify:b,close:x}),[b,x]);return e.jsxs(rt.Provider,{value:S,children:[t,e.jsx("div",{className:"toasts",children:s.map(d=>e.jsxs("div",{className:`toast ${d.variant}`,children:[e.jsxs("div",{className:"toast-text",children:[d.message,d.count>1&&e.jsxs("span",{style:{marginLeft:6,opacity:.8},children:["×",d.count]})]}),e.jsx("button",{className:"toast-close",onClick:()=>x(d.id),"aria-label":"Close",children:"×"})]},d.id))})]})}function de(){const t=o.useContext(rt);if(!t)throw new Error("useToasts must be used within ToastProvider");return t}const It=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",s=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{standard:!0,taiko:!0,mania:!0,catch:!0}}catch{return{standard:!0,taiko:!0,mania:!0,catch:!0}}},Ft=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help,showcase,request",s=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{untagged:s.has("untagged")||s.size===0,help:s.has("help")||s.size===0,showcase:s.has("showcase")||s.size===0,request:s.has("request")||s.size===0}}catch{return{untagged:!0,help:!0,showcase:!0,request:!0}}},Rt=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",s=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{unchecked:s.has("unchecked")||s.size===0,accepted:s.has("accepted")||s.size===0,denied:s.has("denied")||s.size===0,finished:s.has("finished")||s.size===0,archived:s.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},Mt=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",s=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{open:s.has("open")||s.size===0,closed:s.has("closed")}}catch{return{open:!0,closed:!1}}},Lt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator,timing,audio",s=new Set(t.toLowerCase().split(",").map(n=>n.trim()).filter(Boolean));return{modder:s.has("modder")||s.size===0,nominator:s.has("nominator")||s.size===0,timing:s.has("timing")||s.size===0,audio:s.has("audio")||s.size===0}}catch{return{modder:!0,nominator:!0,timing:!0,audio:!0}}},Et=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},At=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Re=jt(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:It(),tagFilters:Ft(),queueStatusFilters:Rt(),queueOpenFilters:Mt(),queueTypeFilters:Lt(),lastSection:Et(),previousLocation:null,theme:At(),setMenuOpen:s=>t({menuOpen:s}),setMobileNavOpen:s=>t({mobileNavOpen:s}),setNotifOpen:s=>t({notifOpen:s}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:s=>{t({modeFilters:s});try{const u=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),i=u.length?u:["standard"];localStorage.setItem("filter_modes",i.join(","))}catch{}},setTagFilters:s=>{t({tagFilters:s});try{const u=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),i=u.length?u:["untagged","help","showcase","request"];localStorage.setItem("filter_moddi_tags",i.join(","))}catch{}},setQueueStatusFilters:s=>{t({queueStatusFilters:s});try{const u=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),i=u.length?u:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",i.join(","))}catch{}},setQueueOpenFilters:s=>{t({queueOpenFilters:s});try{const u=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),i=u.length?u:["open"];localStorage.setItem("filter_queue_open",i.join(","))}catch{}},setQueueTypeFilters:s=>{t({queueTypeFilters:s});try{const u=Object.entries(s).filter(([l,c])=>c).map(([l])=>l),i=u.length?u:["modder","nominator","timing","audio"];localStorage.setItem("filter_queue_type",i.join(","))}catch{}},setLastSection:s=>{t({lastSection:s});try{s?localStorage.setItem("last_section",s):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:s=>{t({previousLocation:s})},setTheme:s=>{t({theme:s});try{localStorage.setItem("theme",s)}catch{}}})),it="https://api.osumappi.ng";function ot(){var t;try{return((t=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s==="csrf"))==null?void 0:t[1])||""}catch{return""}}async function F(t,s={}){const{requireAuth:n=!0,skipCsrf:u=!1,...i}=s,l={...i.headers};if(i.body&&!l["Content-Type"]&&(l["Content-Type"]="application/json"),n&&!u){const x=ot();x&&(l["X-CSRF-Token"]=x)}const c=await fetch(`${it}${t}`,{...i,credentials:"include",headers:l});if(!c.ok){const x=await c.json().catch(()=>({error:`HTTP ${c.status}`}));throw new Error(x.error||`HTTP ${c.status}: ${c.statusText}`)}return c.json()}function Pt(t){const s=new URLSearchParams;for(const[u,i]of Object.entries(t))i!=null&&s.append(u,String(i));const n=s.toString();return n?`?${n}`:""}const R={auth:{login:"/api/auth/login",logout:"/api/auth/logout",me:"/api/me"},user:{quota:"/api/me/upload_quota",notifications:"/api/me/notifications",markNotificationsRead:"/api/me/notifications/mark_read",deleteNotification:t=>`/api/me/notifications/${encodeURIComponent(t)}`,pushSubscribe:"/api/me/push/subscribe",pushUnsubscribe:"/api/me/push/unsubscribe",pushList:"/api/me/push/subscriptions",pushTest:"/api/me/push/test",notifPrefs:"/api/me/notification_prefs"},feed:{next:"/api/feed/next",batch:"/api/feed/batch",progress:t=>`/api/feed/progress${t?`?modes=${encodeURIComponent(t)}`:""}`,recent:"/api/videos/recent"},videos:{like:t=>`/api/videos/${t}/like`,view:t=>`/api/videos/${t}/view`,update:t=>`/api/videos/${t}`,delete:t=>`/api/videos/${t}`,flag:t=>`/api/videos/${t}/flag`,comments:t=>`/api/videos/${t}/comments`,get:t=>`/api/videos/${t}`},uploads:{new:"/api/uploads/new"},moddi:{mySubmissions:"/api/moddi/me/submissions",posts:"/api/moddiposts",post:t=>`/api/moddiposts/${t}`,postReact:t=>`/api/moddiposts/${t}/react`,postComments:t=>`/api/moddiposts/${t}/comments`,queues:"/api/moddi/queues",queue:t=>`/api/moddi/queues/${t}`,queueSubmit:t=>`/api/moddi/queues/${t}/submit`,queueAccept:t=>`/api/moddi/queues/${t}/accept`,queueDeny:t=>`/api/moddi/queues/${t}/deny`,queueInvite:t=>`/api/moddi/queues/${t}/invite`,queueMember:(t,s)=>`/api/moddi/queues/${t}/members/${s}`,queueSubmission:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueSubmissionDelete:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueBlockUser:t=>`/api/moddi/queues/${t}/block`,queueUnblockUser:(t,s)=>`/api/moddi/queues/${t}/block/${s}`,queueBlockedUsers:t=>`/api/moddi/queues/${t}/blocked`,queueSubmissionAcknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueSubmissionUnacknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,usersSearch:t=>`/api/moddi/users/search?q=${encodeURIComponent(t)}`},osu:{resolveBeatmap:"/api/osu/beatmap/resolve",downloadBeatmapset:t=>`/api/osu/beatmapsets/${t}/download?noVideo=1`,usersSearch:t=>`/api/osu/users/search?q=${encodeURIComponent(t)}`},users:{get:t=>`/api/users/${t}`,videos:t=>`/api/users/${t}/videos`,likes:t=>`/api/users/${t}/likes`,myVideos:"/api/me/videos"},admin:{clearViews:"/api/admin/me/clear_views",debugState:"/api/debug/state",settingsModeration:"/api/admin/settings/moderation",videosPending:"/api/admin/videos/pending",videosApprove:t=>`/api/admin/videos/${t}/approve`,videosReject:t=>`/api/admin/videos/${t}/reject`,videosAction:(t,s)=>`/api/admin/videos/${t}/${s}`,analytics:"/api/admin/analytics",usersSearch:t=>`/api/admin/users/search?q=${encodeURIComponent(t)}`,userVideos:t=>`/api/admin/users/${t}/videos`,userUpdate:t=>`/api/admin/users/${t}`,notificationsSystem:"/api/admin/notifications/system",notificationsTest:"/api/admin/notifications/test"}};function Bt(t=!0){return fe({queryKey:["notifications"],queryFn:async()=>{try{const s=await F(R.user.notifications);return Array.isArray(s.items)?s.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Dt(){return fe({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await F("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function as(){const{data:t=[]}=Bt();return t.filter(s=>s.kind==="system"&&s.id.startsWith("b:")&&(s.expiresAt||0)<=Date.now()?!1:!s.read).length}function Wt(){const t=he();return we({mutationFn:async s=>{await F(R.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:s})})},onSuccess:()=>{t.setQueryData(["notifications"],s=>(s==null?void 0:s.map(n=>({...n,read:!0})))||[])}})}function Ot(){const t=he();return we({mutationFn:async s=>{const n=ot();await F(R.user.deleteNotification(s),{method:"DELETE",headers:{"X-CSRF-Token":n}})},onSuccess:(s,n)=>{t.setQueryData(["notifications"],u=>(u==null?void 0:u.filter(i=>i.id!==n))||[]),t.setQueryData(["notifications","detailed"],u=>(u==null?void 0:u.filter(i=>i.id!==n))||[])}})}function ke(){return fe({queryKey:["user","me"],queryFn:async()=>{try{return await F(R.auth.me)}catch{return null}},staleTime:5*60*1e3})}function rs(t=!0){return fe({queryKey:["user","quota"],queryFn:async()=>{try{return await F(R.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function is(){const t=he();return we({mutationFn:async()=>{await F(R.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function Qt(t,s,n,u){o.useEffect(()=>{if(!n)return;const i=l=>{const c=l.target;s.current&&!s.current.contains(c)&&t.current&&!t.current.contains(c)&&u()};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[n,u,t,s])}const Ve=/(\d{2}:\d{2}:\d{3})(?:\s+\(([\d,]+)\))?/g;function Ze(t,s){return s?`osu://edit/${t}-(${s})`:`osu://edit/${t}`}function Me({text:t,className:s,style:n}){Ve.lastIndex=0;const u=[];let i=0,l;for(;(l=Ve.exec(t))!==null;){l.index>i&&u.push(t.substring(i,l.index));const c=l[1],x=l[2],b=l[0];u.push(e.jsx("a",{href:Ze(c,x),onClick:S=>{S.preventDefault(),window.location.href=Ze(c,x)},style:{color:"var(--primary)",textDecoration:"none",cursor:"pointer"},onMouseEnter:S=>{S.currentTarget.style.textDecoration="underline"},onMouseLeave:S=>{S.currentTarget.style.textDecoration="none"},title:"Open in osu! editor",children:b},l.index)),i=l.index+l[0].length}return i<t.length&&u.push(t.substring(i)),u.length===0?e.jsx("span",{className:s,style:n,children:t}):e.jsx("span",{className:s,style:n,children:u})}function $t({beatmapMeta:t,beatmapVersion:s}){const n=o.useRef(null),u=o.useRef(null),[i,l]=o.useState(!1),[c,x]=o.useState(!1),[b,S]=o.useState(0);o.useEffect(()=>{if(n.current&&u.current){const h=n.current.offsetWidth,z=u.current.scrollWidth;S(z),x(z>h)}},[t,s]);const d=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",s?` [${s}]`:""]}):s?`[${s}]`:"Beatmap",v=b>0?Math.max(3,b/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:n,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&l(!0),onMouseLeave:()=>l(!1),children:[e.jsx("span",{ref:u,style:{display:"inline-block",animation:i&&c?`beatmap-marquee ${v}s linear infinite`:"none"},children:d}),i&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:d})]})]})}function Fe({submission:t,canManage:s,onUpdate:n,onDelete:u,isGroup:i=!1,allowSelfActions:l=!1}){const[c,x]=o.useState(!1),[b,S]=o.useState(!1),[d,v]=o.useState(null),[h,z]=o.useState(t.beatmapset_id),[N,_]=o.useState(t.beatmap_id),[T,k]=o.useState(!1),[E,j]=o.useState(!1),[w,P]=o.useState(null),[J,q]=o.useState(!1),[L,Y]=o.useState(t.acknowledgments||[]),[U,G]=o.useState(t.acknowledged_by_me||!1),O=o.useRef(null),y=o.useRef(null),C=o.useRef(null),f=o.useRef(null),D=o.useRef(null),{notify:W}=de();o.useEffect(()=>{Y(t.acknowledgments||[]),G(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),o.useEffect(()=>{if(t.beatmap_url)try{const r=new URL(t.beatmap_url),g=r.pathname.match(/\/beatmapsets\/(\d+)/);if(g&&!t.beatmapset_id){const A=Number(g[1]);isNaN(A)||z(A)}const I=r.hash.match(/#osu\/(\d+)/);if(I&&!t.beatmap_id){const A=Number(I[1]);isNaN(A)||_(A)}}catch(r){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,r)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),o.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:h,extracted_beatmap_id:N,beatmap_version:t.beatmap_version})},[t.id,h,N]),o.useEffect(()=>{if(!t.beatmap_url||d&&h)return;let r=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let g;try{g=new URL(t.beatmap_url)}catch(H){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,H);return}const I=g.hash.match(/#osu\/(\d+)/),A=I?I[1]:null;g.hash="";const Z={url:g.toString()};if(A?Z.beatmap_id=A:t.beatmap_id&&(Z.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",Z),!r){const H=await F(R.osu.resolveBeatmap+Pt(Z),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",H),H.setId&&!h&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",H.setId),z(Number(H.setId))),(H.title||H.artist)&&v({title:H.title||null,artist:H.artist||null,mapper:H.mapper||null})}}catch(g){console.error("[QueueSubmission] Error fetching beatmap metadata:",g)}})(),()=>{r=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,d,h]),o.useEffect(()=>{if(!T){P(null),D.current&&(window.removeEventListener("resize",D.current),window.removeEventListener("scroll",D.current,!0),D.current=null);return}let r=null;const g=()=>{let I=null;const A=f.current;if(A){const X=A.querySelector(".queue-submission-beatmap-btn-desktop button"),Z=A.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),H=A.querySelector(".queue-submission-beatmap-btn-mobile button");X&&window.getComputedStyle(X.parentElement).display!=="none"?I=X:Z&&window.getComputedStyle(Z.parentElement).display!=="none"?I=Z:H&&window.getComputedStyle(H.parentElement).display!=="none"&&(I=H)}if(!I&&C.current&&(I=C.current),I){const X=I.getBoundingClientRect();P({top:X.bottom+8,right:window.innerWidth-X.right})}else P(null)};return D.current=g,r=requestAnimationFrame(()=>{g(),window.addEventListener("resize",g),window.addEventListener("scroll",g,!0)}),()=>{r!==null&&cancelAnimationFrame(r),D.current&&(window.removeEventListener("resize",D.current),window.removeEventListener("scroll",D.current,!0),D.current=null)}},[T]),o.useEffect(()=>{if(!b)return;const r=g=>{const I=g.target;O.current&&!O.current.contains(I)&&!I.closest("[data-status-dropdown]")&&S(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[b]),o.useEffect(()=>{if(!T)return;const r=g=>{const I=g.target;if(y.current&&y.current.contains(I))return;const A=f.current;if(A){if(C.current&&C.current.contains(I))return;const X=A.querySelector(".queue-submission-beatmap-btn-desktop button"),Z=A.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),H=A.querySelector(".queue-submission-beatmap-btn-mobile button");if(X&&X.contains(I)||Z&&Z.contains(I)||H&&H.contains(I))return}k(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[T]);const pe=async r=>{if(!c){x(!0);try{await F(R.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:r})});const g={...t,status:r,updated_at:Math.floor(Date.now()/1e3)};n&&n(g),W("Status updated",{variant:"success"})}catch{W("Failed to update status",{variant:"error"})}finally{x(!1),S(!1)}}},ae=async()=>{if(!c){x(!0);try{const r=!!t.is_archived;await F(R.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!r})});const g={...t,is_archived:r?0:1,updated_at:Math.floor(Date.now()/1e3)};n&&n(g),W(r?"Unarchived":"Archived",{variant:"success"})}catch{W("Failed to update archive status",{variant:"error"})}finally{x(!1)}}},te=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){x(!0);try{await F(R.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),W("Submission deleted",{variant:"success"}),u&&u(t.id)}catch{W("Failed to delete submission",{variant:"error"})}finally{x(!1)}}},re=async()=>{if(!J){q(!0);try{if(U){if(await F(R.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),G(!1),W("Unacknowledged",{variant:"info"}),n){const r={...t,acknowledged_by_me:!1};n(r)}}else if(await F(R.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),G(!0),W("Acknowledged",{variant:"success"}),n){const r={...t,acknowledged_by_me:!0};n(r)}}catch{W("Failed to update acknowledgment",{variant:"error"})}finally{q(!1)}}},M={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},V={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},ee=h||t.beatmapset_id,se=ee?`https://assets.ppy.sh/beatmaps/${ee}/covers/card.jpg`:null;o.useEffect(()=>{se?console.log("[QueueSubmission] Background image URL:",se,"for beatmapset_id:",ee):console.log("[QueueSubmission] No background image URL - beatmapset_id:",ee,"submission.beatmapset_id:",t.beatmapset_id)},[se,ee,t.beatmapset_id]);const Q=!!t.is_archived,oe=s||l?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),k(g=>!g)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ye,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ue,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),k(g=>!g)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ye,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ue,{size:12,style:{marginLeft:4,opacity:.7}})]})}),L&&L.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[L.slice(0,5).map((r,g)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:L.length-g,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:L.length-g,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),L.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${L.length-5} more`,children:["+",L.length-5]})]}),s&&e.jsx("button",{className:"icon-link",onClick:re,disabled:J||c,title:U?"Unacknowledge":"Acknowledge",style:{color:U?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:U?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!J&&!c&&(r.currentTarget.style.background=U?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=U?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Oe,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ae,disabled:c,title:Q?"Unarchive":"Archive",style:{color:Q?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:Q?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.1)":"transparent"},children:Q?e.jsx(Qe,{size:16}):e.jsx($e,{size:16})}),e.jsx("button",{className:"icon-link",onClick:te,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(ge,{size:16})}),s&&e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:O,onClick:()=>S(!b),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:M[t.status]+"15",border:`1.5px solid ${M[t.status]}50`,color:M[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=M[t.status]+"25",r.currentTarget.style.borderColor=M[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=M[t.status]+"15",r.currentTarget.style.borderColor=M[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:V[t.status]}),e.jsx(ue,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:b?"rotate(180deg)":"rotate(0deg)"}})]}),b&&ve.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const r=document.querySelector(".queue-submission-status-btn-desktop button"),g=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),I=document.querySelector(".queue-submission-status-btn-mobile button");let A=null;if(r&&window.getComputedStyle(r.parentElement).display!=="none"?A=r:I&&window.getComputedStyle(I.parentElement).display!=="none"?A=I:g&&window.getComputedStyle(g.parentElement).display!=="none"?A=g:O.current&&(A=O.current),A){const X=A.getBoundingClientRect();return{top:X.bottom+6,right:window.innerWidth-X.right}}return{top:0,right:0}})()},onClick:r=>r.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(r=>e.jsx("button",{onClick:()=>pe(r),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:r===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:r===t.status?M[r]+"15":"transparent",color:r===t.status?M[r]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:g=>{r!==t.status&&(g.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:g=>{r!==t.status&&(g.currentTarget.style.background="transparent")},children:V[r]},r))}),document.body)]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:f,className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:Q?.6:1},children:[se&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:se,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.25,zIndex:0,pointerEvents:"none",filter:"blur(2px) saturate(0.6)"},onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%)",backdropFilter:"blur(4px)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:C,className:"chip-btn link",onClick:r=>{r.preventDefault(),r.stopPropagation(),k(g=>!g)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(255,255,255,0.1)",r.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255,255,255,0.05)",r.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ye,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ue,{size:12,style:{marginLeft:4,opacity:.7}})]})}),s&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[L&&L.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[L.slice(0,5).map((r,g)=>r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,title:r.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:L.length-g,position:"relative",cursor:"pointer"}},r.user_id):e.jsx("div",{title:r.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:g>0?-8:0,zIndex:L.length-g,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:r.username.charAt(0).toUpperCase()},r.user_id)),L.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${L.length-5} more`,children:["+",L.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:re,disabled:J||c,title:U?"Unacknowledge":"Acknowledge",style:{color:U?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:U?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:r=>{!J&&!c&&(r.currentTarget.style.background=U?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=U?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(Oe,{size:16})}),e.jsx("button",{className:"icon-link",onClick:ae,disabled:c,title:Q?"Unarchive":"Archive",style:{color:Q?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:Q?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:r=>{r.currentTarget.style.background=Q?"rgba(99, 102, 241, 0.1)":"transparent"},children:Q?e.jsx(Qe,{size:16}):e.jsx($e,{size:16})}),e.jsx("button",{className:"icon-link",onClick:te,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:r=>{c||(r.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:e.jsx(ge,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:O,onClick:()=>S(!b),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:M[t.status]+"15",border:`1.5px solid ${M[t.status]}50`,color:M[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=M[t.status]+"25",r.currentTarget.style.borderColor=M[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=M[t.status]+"15",r.currentTarget.style.borderColor=M[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:V[t.status]}),e.jsx(ue,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:b?"rotate(180deg)":"rotate(0deg)"}})]})})]}),s&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>S(!b),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:M[t.status]+"15",border:`1.5px solid ${M[t.status]}50`,color:M[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:r=>{c||(r.currentTarget.style.background=M[t.status]+"25",r.currentTarget.style.borderColor=M[t.status]+"70",r.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:r=>{r.currentTarget.style.background=M[t.status]+"15",r.currentTarget.style.borderColor=M[t.status]+"50",r.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:V[t.status]}),e.jsx(ue,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:b?"rotate(180deg)":"rotate(0deg)"}})]})}),!s&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:M[t.status]+"15",border:`1.5px solid ${M[t.status]}50`,color:M[t.status],whiteSpace:"nowrap"},children:V[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx($t,{beatmapMeta:d,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:e.jsx(Me,{text:t.message})}),oe]})]}),T&&w&&t.beatmap_url&&ve.createPortal(e.jsxs("div",{ref:y,style:{position:"fixed",top:w.top,right:w.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>k(!1),children:[e.jsx(ye,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ee&&e.jsx("button",{className:"menu-item",onClick:()=>{j(!0),k(!1)},children:"Preview"})]}),document.body),E&&ee&&e.jsx(zt,{open:E,onClose:()=>j(!1),downloadUrl:`${it}${R.osu.downloadBeatmapset(ee)}`,beatmapId:N??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}const et=["modding","timing","audio"],qe=["nominator","subdivision"];function Te(){return fe({queryKey:["moddi","queues"],queryFn:async()=>{const t=await F(R.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function lt(){const t=he();return we({mutationFn:async s=>{var n;return await F(R.moddi.queues,{method:"POST",body:JSON.stringify({name:s.name.trim(),description:((n=s.description)==null?void 0:n.trim())||null,is_group:s.is_group??!1,type:s.type||"modder",tags:s.tags||"modding"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function Le({open:t,onClose:s,children:n}){const u=o.useRef(null),i=o.useRef(null),l=o.useRef(!1),c=d=>{var v;i.current=((v=d.touches[0])==null?void 0:v.clientY)??null,l.current=!1},x=d=>{var N,_;if(i.current==null)return;const v=((N=d.touches[0])==null?void 0:N.clientY)??null;if(v==null)return;const h=v-i.current;(((_=u.current)==null?void 0:_.scrollTop)??0)<=0&&h>60?l.current=!0:l.current=!1},b=()=>{l.current&&s(),i.current=null,l.current=!1};if(!t)return null;const S=e.jsx("div",{className:"mobile-upload-overlay",onClick:s,children:e.jsx("div",{ref:u,className:"mobile-upload-sheet",onClick:d=>d.stopPropagation(),onTouchStart:c,onTouchMove:x,onTouchEnd:b,children:n})});return ve.createPortal(S,document.body)}function Ut({queueId:t,onSubmitted:s}){const[n,u]=ne.useState(!1),[i,l]=ne.useState(t),[c,x]=ne.useState(""),[b,S]=ne.useState(""),[d,v]=ne.useState(!1),{notify:h}=de(),{data:z=[]}=Te();ne.useEffect(()=>{l(t)},[t]);const N=async()=>{if(!i){h("Please select a queue",{variant:"error"});return}if(!c.trim()){h("Beatmap URL is required",{variant:"error"});return}v(!0);try{await F(R.moddi.queueSubmit(i),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:b.trim()||null})}),h("Submission created!",{variant:"success"}),x(""),S(""),u(!1),s==null||s()}catch(_){h((_==null?void 0:_.message)||"Failed to create submission",{variant:"error"})}finally{v(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>u(!0),children:e.jsx(Se,{size:22})}),e.jsx(Le,{open:n,onClose:()=>u(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:i??"",onChange:_=>l(_.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),z.map(_=>e.jsx("option",{value:String(_.id),children:_.name},_.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:_=>x(_.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:b,onChange:_=>S(_.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),b.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[b.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:d,onClick:N,children:d?"Submitting...":"Submit"})]})]})})]})}const dt=({context:t})=>{const s=wt(),{tagFilters:n,setTagFilters:u,queueTypeFilters:i,setQueueTypeFilters:l,queueStatusFilters:c,setQueueStatusFilters:x}=Re(),b=ne.useMemo(()=>{if(t)return t;const T=s.pathname;return T==="/feed"?"unified-feed":T==="/mp/feed"?"mappi-feed":T==="/md/feed"?"moddi-feed":T==="/queues"||T==="/md/queues"?"moddi-queues":T.startsWith("/queues/")||T.startsWith("/md/queues/")?"moddi-queue-detail":"unified-feed"},[t,s.pathname]),S=T=>{const k={...n,[T]:!n[T]};!k.untagged&&!k.help&&!k.showcase&&!k.request&&(k.untagged=!0),u(k);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},d=T=>{const k={...i,[T]:!i[T]};!k.modder&&!k.nominator&&!k.timing&&!k.audio&&(k.modder=!0),l(k)},v=T=>{const k={...c,[T]:!c[T]};["unchecked","accepted","denied","finished"].some(j=>k[j])||(k.unchecked=!0),x(k)},h=({active:T,onClick:k,label:E})=>e.jsx("button",{type:"button",onClick:k,className:"desktop-filter-chip","aria-pressed":T,"data-active":T,children:E}),z=b==="unified-feed"||b==="moddi-feed",N=b==="moddi-queues",_=b==="moddi-queue-detail";return e.jsxs("div",{className:"desktop-filter-bar",children:[z&&e.jsxs(e.Fragment,{children:[e.jsx(h,{active:n.untagged,onClick:()=>S("untagged"),label:"untagged"}),e.jsx(h,{active:n.help,onClick:()=>S("help"),label:"help"}),e.jsx(h,{active:n.showcase,onClick:()=>S("showcase"),label:"showcase"}),e.jsx(h,{active:n.request,onClick:()=>S("request"),label:"request"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx(h,{active:i.modder,onClick:()=>d("modder"),label:"modding"}),e.jsx(h,{active:i.nominator,onClick:()=>d("nominator"),label:"bn/subdivision"}),e.jsx(h,{active:i.timing,onClick:()=>d("timing"),label:"timing"}),e.jsx(h,{active:i.audio,onClick:()=>d("audio"),label:"audio"})]}),_&&e.jsxs(e.Fragment,{children:[e.jsx(h,{active:c.unchecked,onClick:()=>v("unchecked"),label:"pending"}),e.jsx(h,{active:c.accepted,onClick:()=>v("accepted"),label:"accepted"}),e.jsx(h,{active:c.denied,onClick:()=>v("denied"),label:"denied"}),e.jsx(h,{active:c.finished,onClick:()=>v("finished"),label:"finished"})]})]})};function ct({tabs:t,activeTab:s,onChange:n,rightAction:u}){return e.jsxs("div",{className:"tab-header",style:{display:"flex",background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",position:"relative"},children:[t.map((i,l)=>{const c=i.id===s,x=l===t.length-1;return e.jsxs("button",{onClick:()=>n(i.id),style:{flex:1,padding:"14px 16px",background:"transparent",border:"none",borderRight:!x||u?"1px solid rgba(255,255,255,0.08)":"none",color:c?"var(--text)":"var(--muted)",fontWeight:c?600:400,fontSize:14,fontFamily:"inherit",cursor:"pointer",transition:"all 0.15s ease",position:"relative"},onMouseEnter:b=>{c||(b.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="transparent"},children:[i.label,c&&e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:"var(--accent, #667eea)",borderRadius:"2px 2px 0 0"}})]},i.id)}),u&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:u})]})}function Ht({isOpen:t,onClose:s,onSubmitted:n,queueId:u,isQueueOpen:i,anchorRef:l,rules:c}){const{notify:x}=de(),[b,S]=o.useState(""),[d,v]=o.useState(""),[h,z]=o.useState(!1),[N,_]=o.useState(!1),T=o.useRef(null);o.useEffect(()=>{if(!t)return;const E=j=>{const w=j.target;if(T.current&&!T.current.contains(w)&&(l!=null&&l.current)&&!l.current.contains(w)){const P=document.getElementById("rules-modal-overlay");if(P&&P.contains(w))return;s()}};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[t,s,l]);const k=async E=>{if(E.preventDefault(),!i){x("Queue is closed for submissions",{variant:"error"});return}if(!b.trim()){x("Beatmap URL is required",{variant:"error"});return}z(!0);try{await F(R.moddi.queueSubmit(u),{method:"POST",body:JSON.stringify({beatmap_url:b.trim(),message:d.trim()||null})}),x("Submission created!",{variant:"success"}),s(),S(""),v(""),n()}catch(j){x((j==null?void 0:j.message)||"Failed to create submission",{variant:"error"})}finally{z(!1)}};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:T,className:"submit-beatmap-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:i?e.jsx("form",{onSubmit:k,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:b,onChange:E=>S(E.target.value),required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:d,onChange:E=>v(E.target.value.slice(0,100)),maxLength:100,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),d.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right"},children:[d.length,"/100"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:4},children:[c?e.jsx("button",{type:"button",onClick:()=>_(!0),style:{background:"transparent",border:"none",padding:0,color:"var(--text)",fontSize:13,textDecoration:"underline",cursor:"pointer",opacity:.8},children:"Rules"}):e.jsx("div",{}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h||!b.trim(),style:{background:b.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:b.trim()?"pointer":"not-allowed"},children:h?"Submitting...":"Submit"})]})]})]})}):e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"This queue is currently closed for submissions."})})}),N&&c&&e.jsx("div",{id:"rules-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>_(!1),children:e.jsxs("div",{style:{width:"100%",maxWidth:"500px",maxHeight:"80vh",background:"var(--panel)",border:"1px solid var(--divider)",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--divider)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600},children:"Queue Rules"}),e.jsx("button",{onClick:()=>_(!1),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:24,lineHeight:1,padding:0},children:"×"})]}),e.jsx("div",{style:{padding:20,overflowY:"auto",fontSize:15,lineHeight:1.6,whiteSpace:"pre-wrap"},children:c})]})})]}):null}const Yt=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(Ct,{components:{p:({children:s})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:s}),ul:({children:s})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),ol:({children:s})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),li:({children:s})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:s}),strong:({children:s})=>e.jsx("strong",{style:{fontWeight:600},children:s}),em:({children:s})=>e.jsx("em",{children:s}),code:({children:s})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:s}),h1:({children:s})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:s}),h2:({children:s})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:s}),h3:({children:s})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:s})},children:t})});function os(){var We;const{id:t}=St(),s=tt(),[n,u]=o.useState(null),[i,l]=o.useState([]),[c,x]=o.useState([]),[b,S]=o.useState(!0),[d,v]=o.useState(null),[h,z]=o.useState(!1),N=o.useRef(null),[_,T]=o.useState(null),[k,E]=o.useState(!1),[j,w]=o.useState(""),[P,J]=o.useState(""),[q,L]=o.useState(""),[Y,U]=o.useState("modder"),[G,O]=o.useState(!1),[y,C]=o.useState(!1),[f,D]=o.useState("general"),[W,pe]=o.useState(!1),[ae,te]=o.useState(!1),[re,M]=o.useState(null),[V,ee]=o.useState(""),[se,Q]=o.useState([]),[oe,r]=o.useState(!1),g=o.useRef(null),I=o.useRef(null),A=o.useRef(null),[X,Z]=o.useState([]),[H,Ee]=o.useState(!1),[_e,Ae]=o.useState(null),[Ne,ut]=o.useState("active"),{notify:$}=de(),{queueStatusFilters:be}=Re(),ie=async()=>{var a,m;if(t){S(!0);try{const p=await F(R.moddi.queue(t),{requireAuth:!1});u(p.queue||null),l(p.members||[]),x(p.submissions||[])}catch(p){(a=p==null?void 0:p.message)!=null&&a.includes("403")||(m=p==null?void 0:p.message)!=null&&m.includes("Forbidden")?($("You do not have access to this queue",{variant:"error"}),s("/queues")):$("Failed to load queue",{variant:"error"})}finally{S(!1)}}};o.useEffect(()=>{ie(),F(R.auth.me,{requireAuth:!1}).then(a=>v(a)).catch(()=>{})},[t]);const le=d&&n&&(n.owner_id===d.id||i.some(a=>a.user_id===d.id&&a.joined_at)||d.is_mod||d.is_admin);d&&i.some(a=>a.user_id===d.id&&a.joined_at);const Pe=d&&n&&(n.owner_id===d.id||i.some(a=>a.user_id===d.id&&a.joined_at)),Be=a=>{x(m=>m.map(p=>p.id===a.id?a:p)),a.acknowledged_by_me!==void 0&&ie()},pt=()=>{n&&(w(n.name),J(n.description||""),L(n.rules||""),U(n.type||"modder"),E(!0),D("general"))},ce=()=>{E(!1),w(""),J(""),L(""),U("modder")},mt=async()=>{if(!(!n||!Pe)){C(!0);try{const a=n.is_open!==1;await F(R.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:a})}),$(`Queue ${a?"opened":"closed"} `,{variant:"success"}),ie()}catch(a){$((a==null?void 0:a.message)||"Failed to update status",{variant:"error"})}finally{C(!1)}}},gt=async a=>{if(a.preventDefault(),!n||!j.trim()){$("Queue name is required",{variant:"error"});return}pe(!0);try{const m=i.filter(B=>B.user_id!==n.owner_id&&B.role!=="owner").length>0,p={name:j.trim(),description:P.trim()||null,rules:q.trim()||null,is_group:m};(d!=null&&d.is_mod||d!=null&&d.is_admin)&&(p.type=Y),await F(R.moddi.queue(t),{method:"PATCH",body:JSON.stringify(p)}),$("Queue updated!",{variant:"success"}),ce(),ie()}catch(m){$((m==null?void 0:m.message)||"Failed to update queue",{variant:"error"})}finally{pe(!1)}};o.useEffect(()=>{if(!V.trim()){Q([]),r(!1);return}const a=setTimeout(async()=>{try{const p=(await F(R.moddi.usersSearch(V),{requireAuth:!1})).items||[];Q(p),r(p.length>0)}catch(m){console.error("Search failed:",m),Q([]),r(!1)}},300);return()=>clearTimeout(a)},[V]);const ft=async a=>{if(!ae){te(!0);try{await F(R.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:a})}),$("Invite sent!",{variant:"success"}),ee(""),Q([]),r(!1),ie()}catch(m){$((m==null?void 0:m.message)||"Failed to invite member",{variant:"error"})}finally{te(!1)}}},Ce=async()=>{if(!(!t||!le))try{const a=await F(R.moddi.queueBlockedUsers(t));Z(a.blocked||[])}catch(a){console.error("Failed to load blocked users:",a)}},ht=async a=>{if(!(!t||H)&&confirm("Block this user from submitting to this queue?")){Ee(!0);try{await F(R.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:a})}),$("User blocked",{variant:"success"}),Ce(),ee(""),Q([]),r(!1)}catch(m){$((m==null?void 0:m.message)||"Failed to block user",{variant:"error"})}finally{Ee(!1)}}},De=async a=>{if(!(!t||_e===a)){Ae(a);try{await F(R.moddi.queueUnblockUser(t,a),{method:"DELETE"}),$("User unblocked",{variant:"success"}),Ce()}catch(m){$((m==null?void 0:m.message)||"Failed to unblock user",{variant:"error"})}finally{Ae(null)}}};o.useEffect(()=>{f==="members"&&le&&t&&Ce()},[f,le,t]);const bt=async()=>{if(n&&confirm(`Are you sure you want to delete "${n.name}" ? This action cannot be undone.`)){O(!0);try{await F(R.moddi.queue(t),{method:"DELETE"}),$("Queue deleted",{variant:"success"}),s("/queues")}catch(a){$((a==null?void 0:a.message)||"Failed to delete queue",{variant:"error"})}finally{O(!1)}}},xt=async a=>{if(!d||!n||d.id!==n.owner_id){$("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){M(a);try{await F(R.moddi.queueMember(t,a),{method:"DELETE"}),$("Member removed",{variant:"success"});const p=i.filter(B=>B.user_id!==a).some(B=>B.user_id!==(n==null?void 0:n.owner_id)&&B.role!=="owner");if(n&&n.is_group===1&&!p)try{await F(R.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}ie()}catch(m){$((m==null?void 0:m.message)||"Failed to remove member",{variant:"error"})}finally{M(null)}}},yt=async()=>{if(d&&confirm("Leave this queue? You will need to be invited again to rejoin.")){M(d.id);try{await F(R.moddi.queueMember(t,d.id),{method:"DELETE"}),$("Left queue",{variant:"success"});const m=i.filter(p=>p.user_id!==d.id).some(p=>p.user_id!==(n==null?void 0:n.owner_id)&&p.role!=="owner");if(n&&n.is_group===1&&!m)try{await F(R.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}s("/queues")}catch(a){$((a==null?void 0:a.message)||"Failed to leave queue",{variant:"error"})}finally{M(null)}}},vt=async a=>{if(confirm("Cancel this invitation?")){M(a);try{await F(R.moddi.queueMember(t,a),{method:"DELETE"}),$("Invitation canceled",{variant:"success"}),ie()}catch(m){$((m==null?void 0:m.message)||"Failed to cancel invitation",{variant:"error"})}finally{M(null)}}};return o.useEffect(()=>{if(!k)return;const a=m=>{const p=m.target;p.closest(".manage-overlay")||p.closest(".manage-overlay-backdrop")||!p.closest(".manage-popup")&&A.current&&!A.current.contains(p)&&ce()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[k]),o.useEffect(()=>{if(!oe)return;const a=m=>{const p=m.target;g.current&&!g.current.contains(p)&&I.current&&!I.current.contains(p)&&r(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[oe]),b?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):n?e.jsxs("div",{className:"feed-container queue-detail-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0,minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t&&e.jsx(Ut,{queueId:t,onSubmitted:()=>ie()}),e.jsx(dt,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"queue-detail-header",style:{background:"var(--panel)",borderBottom:"1px solid var(--divider)",position:"relative"},children:[e.jsxs("div",{style:{height:100,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",width:"100%",position:"relative"},children:[e.jsx(je,{to:"/queues",style:{position:"absolute",top:12,left:12,width:36,height:36,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",color:"#fff",zIndex:10},title:"Back to queues",children:e.jsx(kt,{size:18})}),le&&e.jsxs("button",{ref:A,className:"btn secondary",onClick:pt,style:{position:"absolute",top:12,right:12,padding:"6px 12px",fontSize:13,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.2)",color:"#fff",zIndex:10},title:"Manage Queue",children:[e.jsx(Tt,{size:14,style:{marginRight:6}}),"Manage"]}),e.jsxs("div",{style:{position:"absolute",bottom:12,right:16,display:"flex",gap:8,alignItems:"center",zIndex:10},children:[(()=>{const a=(n.tags||n.type||"modding").split(",")[0].trim().toLowerCase(),m=a==="modder"?"modding":a==="subdivisions"?"subdivision":a;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(8px)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)"},children:m})})(),Pe?e.jsx("button",{onClick:mt,disabled:y,className:`queue - status - badge ${n.is_open===1?"status-open":"status-closed"} `,title:n.is_open===1?"Close queue":"Open queue","aria-label":n.is_open===1?"Close queue":"Open queue",style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:n.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:n.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",cursor:"pointer",display:"flex",alignItems:"center"},children:n.is_open===1?"Open":"Closed"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:4,background:n.is_open===1?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)",backdropFilter:"blur(8px)",color:"#fff",border:n.is_open===1?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(239, 68, 68, 0.2)",display:"inline-flex",alignItems:"center"},children:n.is_open===1?"Open":"Closed"})]})]}),e.jsxs("div",{style:{padding:"0 16px 16px",position:"relative"},children:[e.jsx("div",{style:{marginTop:-32,marginBottom:12,display:"flex",alignItems:"flex-end",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.filter(a=>a.joined_at!==null).sort((a,m)=>{const p=a.role==="owner"||a.user_id===(n==null?void 0:n.owner_id),B=m.role==="owner"||m.user_id===(n==null?void 0:n.owner_id);return p&&!B?-1:!p&&B?1:(m.joined_at||0)-(a.joined_at||0)}).slice(0,5).map((a,m)=>e.jsxs("div",{style:{position:"relative",marginLeft:m>0?-12:0,zIndex:10-m},onMouseEnter:()=>T(a.user_id),onMouseLeave:()=>T(null),children:[e.jsx(je,{to:`/ profile / ${a.user_id} `,style:{display:"block",width:m===0?64:40,height:m===0?64:40,borderRadius:"50%",overflow:"hidden",border:"3px solid var(--panel)",background:"var(--bg)"},title:a.username,children:a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:a.username,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:m===0?24:14,fontWeight:600,color:"var(--muted)"},children:a.username.charAt(0).toUpperCase()})}),_===a.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[a.username," ",a.role!=="member"?`(${a.role})`:""]})]},a.user_id)),i.filter(a=>a.joined_at!==null).length>5&&e.jsxs("div",{style:{width:40,height:40,borderRadius:"50%",border:"3px solid var(--panel)",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,color:"var(--muted)",marginLeft:-12,zIndex:0},children:["+",i.filter(a=>a.joined_at!==null).length-5]})]})}),e.jsxs("div",{className:"col",style:{gap:2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.is_group?e.jsx(st,{size:18,style:{color:"var(--muted)"}}):e.jsx(me,{size:18,style:{color:"var(--muted)"}}),e.jsx("h1",{style:{fontSize:20,fontWeight:700,margin:0},children:n.name})]}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["by ",n.owner_username||((We=i.find(a=>a.user_id===n.owner_id))==null?void 0:We.username)||"Unknown"," • ",new Date(n.created_at*1e3).toLocaleDateString()]}),n.description&&e.jsx("div",{style:{fontSize:14,lineHeight:1.5,marginTop:8},children:e.jsx(Me,{text:n.description})})]})]}),e.jsx(ct,{tabs:[{id:"active",label:"Active"},{id:"archived",label:"Archived"}],activeTab:Ne,onChange:a=>ut(a),rightAction:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:N,onClick:()=>z(!h),style:{width:48,height:"100%",minHeight:48,background:h?"rgba(255,255,255,0.05)":"transparent",border:"none",color:n.is_open===1?"var(--text)":"var(--muted)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s",opacity:n.is_open===0?.5:1},onMouseEnter:a=>{h||(a.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:a=>{h||(a.currentTarget.style.backgroundColor="transparent")},title:n.is_open===1?"Submit a beatmap":"Queue is closed",children:e.jsx(Se,{size:18})}),t&&e.jsx(Ht,{isOpen:h,onClose:()=>z(!1),onSubmitted:()=>ie(),queueId:t,isQueueOpen:n.is_open===1,anchorRef:N,rules:n.rules})]})})]}),n.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[Ne==="active"&&e.jsx(e.Fragment,{children:c.filter(a=>!!!a.is_archived&&be[a.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):c.filter(a=>!!!a.is_archived&&be[a.status]).map(a=>e.jsx(Fe,{submission:a,canManage:!!le,isGroup:(n==null?void 0:n.is_group)===1,onUpdate:Be,onDelete:m=>{x(p=>p.filter(B=>B.id!==m))}},a.id))}),Ne==="archived"&&e.jsx(e.Fragment,{children:c.filter(a=>!!a.is_archived&&be[a.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):c.filter(a=>!!a.is_archived&&be[a.status]).map(a=>e.jsx(Fe,{submission:a,canManage:!!le,isGroup:(n==null?void 0:n.is_group)===1,onUpdate:Be,onDelete:m=>{x(p=>p.filter(B=>B.id!==m))}},a.id))})]})}),k&&ve.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:ce}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:ce,"aria-label":"Close",children:e.jsx(Ie,{size:18})}),e.jsxs("div",{className:"settings-header",style:{padding:"20px 16px 12px"},children:[e.jsx("div",{className:"settings-title",children:"Manage Queue"}),e.jsx("div",{className:"settings-description",children:"Configure queue settings, rules, and members."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Manage Queue",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Manage Queue tabs",children:[e.jsx("button",{role:"tab","aria-selected":f==="general",className:`profile - tab ${f==="general"?"active":""} `,"data-tab":"general",onClick:a=>{const m=a.currentTarget.closest(".profile-tabs-unified"),p=m==null?void 0:m.querySelector(".profile-tabs-content");p==null||p.setAttribute("data-active","general"),D("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":f==="rules",className:`profile - tab ${f==="rules"?"active":""} `,"data-tab":"rules",onClick:a=>{const m=a.currentTarget.closest(".profile-tabs-unified"),p=m==null?void 0:m.querySelector(".profile-tabs-content");p==null||p.setAttribute("data-active","rules"),D("rules")},children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":f==="members",className:`profile - tab ${f==="members"?"active":""} `,"data-tab":"members",onClick:a=>{const m=a.currentTarget.closest(".profile-tabs-unified"),p=m==null?void 0:m.querySelector(".profile-tabs-content");p==null||p.setAttribute("data-active","members"),D("members")},children:"Members"})]}),e.jsx("div",{className:"profile-tabs-content","data-active":f,children:e.jsxs("form",{onSubmit:gt,className:"col",style:{gap:0},children:[e.jsx("div",{className:"panel general",hidden:f!=="general",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:j,onChange:a=>w(a.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:P,onChange:a=>J(a.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),((d==null?void 0:d.is_mod)||(d==null?void 0:d.is_admin))&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsxs("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Queue Type ",n.owner_id!==(d==null?void 0:d.id)&&e.jsx("span",{style:{fontSize:12,color:"var(--muted)",fontWeight:400},children:"(Mod/Admin only)"})]}),e.jsxs("select",{value:Y,onChange:a=>U(a.target.value),style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14},children:[e.jsx("option",{value:"modder",children:"Modder"}),e.jsx("option",{value:"nominator",children:"Nominator"})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:bt,disabled:G||W,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(ge,{size:14,style:{marginRight:6}}),G?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:ce,disabled:W||G,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:W||G,style:{fontSize:13,padding:"8px 16px"},children:W?"Updating...":"Save Changes"})]})]})]})}),e.jsx("div",{className:"panel rules",hidden:f!=="rules",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:q,onChange:a=>L(a.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),q&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(Yt,{content:q})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:ce,disabled:W||G,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:W||G,style:{fontSize:13,padding:"8px 16px"},children:W?"Updating...":"Save Changes"})]})]})}),e.jsx("div",{className:"panel members",hidden:f!=="members",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:g,type:"text",placeholder:"Search username or ID",value:V,onChange:a=>ee(a.target.value),onKeyDown:a=>{a.key==="Enter"&&a.preventDefault()},onFocus:()=>{se.length>0&&r(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),oe&&se.length>0&&e.jsx("div",{ref:I,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:se.map(a=>{const m=i.some(K=>K.user_id===a.id&&K.joined_at),p=i.some(K=>K.user_id===a.id&&K.invited_at&&!K.joined_at),B=X.some(K=>K.user_id===a.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:a.username}),m&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),p&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",a.id," • osu ",a.osu_user_id]})]})]}),le&&!m&&!p&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:K=>{K.stopPropagation(),ae||ft(a.id)},disabled:ae,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(nt,{size:16})}),e.jsx("button",{className:"icon-link",onClick:K=>{K.stopPropagation(),B?De(a.id):ht(a.id)},disabled:H||_e===a.id,title:B?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:B?"var(--accent)":"var(--danger)"},children:B?e.jsx(Ue,{size:16}):e.jsx(_t,{size:16})})]})]},a.id)})})})]})]}),i.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const a=i.filter(p=>p.joined_at!==null).sort((p,B)=>{const K=p.role==="owner"||p.user_id===(n==null?void 0:n.owner_id),xe=B.role==="owner"||B.user_id===(n==null?void 0:n.owner_id);return K&&!xe?-1:!K&&xe?1:(B.joined_at||0)-(p.joined_at||0)}),m=i.filter(p=>p.invited_at!==null&&p.joined_at===null);return e.jsxs(e.Fragment,{children:[a.map(p=>{const B=d&&n&&d.id===n.owner_id,K=p.user_id===(d==null?void 0:d.id),xe=p.user_id===(n==null?void 0:n.owner_id)||p.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[p.avatar_url&&e.jsx("img",{src:p.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:p.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:p.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:p.role})]})]}),B&&!xe&&e.jsx("button",{className:"icon-link",onClick:()=>xt(p.user_id),disabled:re===p.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(ge,{size:16})}),!B&&K&&e.jsx("button",{className:"icon-link",onClick:yt,disabled:re===p.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(Nt,{size:16})})]},p.user_id)}),m.length>0&&e.jsx(e.Fragment,{children:m.map(p=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[p.avatar_url&&e.jsx("img",{src:p.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:p.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:p.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>vt(p.user_id),disabled:re===p.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(Ie,{size:16})})]},p.user_id))})]})})()})]}),le&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),X.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:X.map(a=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[a.avatar_url&&e.jsx("img",{src:a.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:a.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:a.username}),a.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",a.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>De(a.user_id),disabled:_e===a.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(Ue,{size:16})})]},a.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:ce,disabled:W||G,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:W||G,style:{fontSize:13,padding:"8px 16px"},children:W?"Updating...":"Save Changes"})]})]})})]})})]})]})]}),document.body),e.jsx("style",{children:`
/* Hide inline submit form on mobile – mobile uses floating FAB instead */
html.is - mobile.queue - submit - desktop - only {
  display: none;
}

        .queue - member - avatar {
  width: 32px;
  height: 32px;
  border - radius: 9999px;
  padding: 0;
  border: 1px solid rgba(255, 255, 255, 0.08);
  overflow: hidden;
  cursor: pointer;
  background: transparent;
  display: inline - flex;
  align - items: center;
  justify - content: center;
  text - decoration: none;
  transition: border - color 0.2s;
}
        .queue - member - avatar:hover {
  border - color: rgba(167, 139, 250, 0.4);
}
        .queue - member - avatar img {
  width: 100 %;
  height: 100 %;
  object - fit: cover;
  display: block;
}
        .queue - member - tooltip {
  position: absolute;
  bottom: calc(100 % + 8px);
  left: 50 %;
  transform: translateX(-50 %);
  background: rgba(18, 20, 24, 0.95);
  color: var(--text, #e5e7eb);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border - radius: 6px;
  padding: 6px 10px;
  font - size: 14px;
  white - space: nowrap;
  z - index: 10000;
  pointer - events: none;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
}
        .queue - member - tooltip::after {
  content: '';
  position: absolute;
  top: 100 %;
  left: 50 %;
  transform: translateX(-50 %);
  width: 0;
  height: 0;
  border - left: 5px solid transparent;
  border - right: 5px solid transparent;
  border - top: 5px solid rgba(18, 20, 24, 0.95);
}
        .queue - status - badge {
  display: inline - flex;
  align - items: center;
  gap: 6px;
  padding: 6px 12px;
  border - radius: 12px;
  font - size: 12px;
  font - weight: 600;
  font - family: 'Torus Pro', Torus, ui - sans - serif, system - ui, sans - serif;
  border: 1px solid;
  cursor: pointer;
  transition: all 0.2s;
  white - space: nowrap;
}
        .queue - status - badge:disabled {
  cursor: not - allowed;
  opacity: 0.6;
}
        .queue - status - badge.status - open {
  background: rgba(52, 211, 153, 0.15);
  border - color: rgba(52, 211, 153, 0.4);
  color: #34d399;
}
        .queue - status - badge.status - open: hover: not(: disabled) {
  background: rgba(52, 211, 153, 0.25);
  border - color: rgba(52, 211, 153, 0.5);
}
        .queue - status - badge.status - closed {
  background: rgba(245, 158, 11, 0.15);
  border - color: rgba(245, 158, 11, 0.4);
  color: #f59e0b;
}
        .queue - status - badge.status - closed: hover: not(: disabled) {
  background: rgba(245, 158, 11, 0.25);
  border - color: rgba(245, 158, 11, 0.5);
}
`})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function ls(){const{data:t=[],isLoading:s}=Dt(),n=Wt(),u=Ot(),{notify:i}=de(),l=tt(),c=he(),[x,b]=o.useState(new Set),{data:S}=ke(),[d,v]=o.useState(!1),[h,z]=o.useState(!1),[N,_]=o.useState(!1),T=o.useRef(null),k=o.useRef(null),E=!!(S!=null&&S.is_admin||S!=null&&S.is_mod);Qt(T,k,d,()=>v(!1));const j=async y=>{n.mutate(y,{onSuccess:()=>{}})},w=async y=>{y.startsWith("n:")&&u.mutate(y)},P=async()=>{const y=t.filter(C=>!C.read&&(C.id.startsWith("n:")||C.kind==="system"&&!C.id.startsWith("b:"))).map(C=>C.id);y.length>0&&(await j(y),i("All notifications marked as read",{variant:"success"}))},J=y=>{if(!y)return null;try{const C=JSON.parse(y);if((C==null?void 0:C.type)==="queue_invite"&&(C!=null&&C.queue_id))return C}catch{}return null},q=async(y,C)=>{if(!x.has(y.id)){b(f=>new Set(f).add(y.id));try{await F(R.moddi.queueAccept(String(C)),{method:"POST"}),i("Invitation accepted!",{variant:"success"}),w(y.id),l(`/queues/${C}`)}catch(f){i((f==null?void 0:f.message)||"Failed to accept invitation",{variant:"error"})}finally{b(f=>{const D=new Set(f);return D.delete(y.id),D})}}},L=async(y,C)=>{if(!x.has(y.id)){b(f=>new Set(f).add(y.id));try{await F(R.moddi.queueDeny(String(C)),{method:"POST"}),i("Invitation declined",{variant:"success"}),w(y.id)}catch(f){i((f==null?void 0:f.message)||"Failed to decline invitation",{variant:"error"})}finally{b(f=>{const D=new Set(f);return D.delete(y.id),D})}}},Y=y=>J(y.text)?e.jsx(nt,{size:20,color:"#a78bfa"}):y.kind==="star"?e.jsx(Xe,{size:20,color:"#f59e0b"}):y.kind==="likes5"?e.jsx(Je,{size:20,color:"#f472b6"}):y.kind==="comment"?e.jsx(me,{size:20,color:"#60a5fa"}):y.kind==="inspiration"?e.jsx(me,{size:20,color:"#7dd3fc"}):y.kind==="reaction"?e.jsx(Ge,{size:20,color:"#10b981"}):y.id.startsWith("b:")?e.jsx(Ke,{size:20,color:"#a78bfa"}):null,U=y=>J(y.text)?"Queue Invitation":y.kind==="star"?"Star":y.kind==="likes5"?"Likes":y.kind==="comment"?"Comment":y.kind==="inspiration"?"Inspiration":y.kind==="reaction"?"Reaction":y.id.startsWith("b:")?"Global":"System",G=t.filter(y=>!y.read&&!(y.id.startsWith("b:")&&y.expiresAt&&y.expiresAt<=Date.now())).length,O=async y=>{if(!(!(S!=null&&S.id)||N)){_(!0);try{const C={kind:y};y==="system"&&(C.text="Test system notification"),await F(R.admin.notificationsTest,{method:"POST",body:JSON.stringify(C)}),i("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(C){i((C==null?void 0:C.message)||"Failed to send test notification",{variant:"error"})}finally{_(!1),v(!1),z(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[E&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:T,className:"btn secondary",onClick:()=>v(!d),disabled:N,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(He,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(ue,{size:14,style:{transition:"transform 0.2s ease",transform:d?"rotate(180deg)":"rotate(0deg)"}})]}),d&&e.jsxs("div",{ref:k,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("star"),disabled:N,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("likes5"),disabled:N,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("comment"),disabled:N,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("inspiration"),disabled:N,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("reaction"),disabled:N,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>O("system"),disabled:N,children:"Test System"})]})]}),G>0&&e.jsxs("button",{className:"btn secondary",onClick:P,children:[e.jsx(Ye,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>z(!0),children:e.jsx(He,{size:22})}),e.jsx(Le,{open:h,onClose:()=>z(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>O("star"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Xe,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("likes5"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Je,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("comment"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(me,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("inspiration"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(me,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("reaction"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ge,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>O("system"),disabled:N,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ke,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(y=>!(y.id.startsWith("b:")&&y.expiresAt&&y.expiresAt<=Date.now())).map(y=>{const C=({notif:f})=>{const[D,W]=o.useState(0),[pe,ae]=o.useState(!1),te=o.useRef(null),re=o.useRef(null),M=o.useRef(null),V=o.useRef(null),ee=g=>{f.id.startsWith("n:")&&(te.current=g.touches[0].clientX,V.current=g.touches[0].clientY,re.current=Date.now(),ae(!1))},se=g=>{if(te.current===null||V.current===null||!f.id.startsWith("n:"))return;const I=g.touches[0].clientX,A=g.touches[0].clientY,X=I-te.current,Z=Math.abs(A-V.current);Math.abs(X)>Z&&(ae(!0),W(Math.max(-80,Math.min(0,X))))},Q=()=>{if(te.current===null)return;D<=-60&&w(f.id),W(0),ae(!1),te.current=null,V.current=null,re.current=null},oe=f.id.startsWith("n:"),r=typeof f.targetPath=="string"&&f.targetPath.trim().length>0?f.targetPath.trim():null;return e.jsxs("div",{ref:M,style:{position:"relative",background:f.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:r?"pointer":"default",opacity:f.read?.7:1,transform:`translateX(${D}px)`,transition:pe?"none":"transform 0.2s ease",touchAction:oe?"pan-x pan-y":"pan-y"},onTouchStart:ee,onTouchMove:se,onTouchEnd:Q,onTouchCancel:Q,onClick:()=>{if(!(Math.abs(D)>10)){if(!f.read&&f.id.startsWith("n:")&&j([f.id]),r){l(r);return}f.videoId&&(window.location.hash="/feed")}},children:[oe&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(D)/80,pointerEvents:"none",zIndex:0},children:e.jsx(ge,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:Y(f)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:U(f)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(f.createdAt).toLocaleDateString()}),f.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:g=>{g.stopPropagation(),w(f.id)},style:{padding:4},children:e.jsx(ge,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const g=J(f.text);return g?`${g.inviter_username} invited you to join queue: ${g.queue_name}`:f.text||(f.kind==="star"?"One of your posts was starred!":f.kind==="likes5"?"One of your posts reached 5 likes!":f.kind==="comment"?"Someone commented on your post":f.kind==="inspiration"?"Someone is inspired by you!":f.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const g=J(f.text);return g&&!x.has(f.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:I=>{I.stopPropagation(),q(f,g.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Ye,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:I=>{I.stopPropagation(),L(f,g.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Ie,{size:14,style:{marginRight:4}}),"Decline"]})]}):g&&x.has(f.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),f.read&&f.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(f.readAt).toLocaleString()]})]})]})]},f.id)};return e.jsx(C,{notif:y},y.id)})})})]})}const ze={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"},subdivisions:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},Xt=["nominator","subdivision","subdivisions"];function Jt({queue:t}){const n=(t.tags||t.type||"modding").split(",").map(l=>l.trim().toLowerCase()).filter(Boolean).map(l=>l==="modder"?"modding":l==="subdivisions"?"subdivision":l),u=n.find(l=>Xt.includes(l)),i=u?[u==="subdivisions"?"subdivision":u]:n.filter(l=>ze[l]);return e.jsx(je,{to:`/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:l=>l.currentTarget.style.background="rgba(255,255,255,0.04)",onMouseLeave:l=>l.currentTarget.style.background="var(--panel)",children:[e.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:4,flexWrap:"wrap",justifyContent:"flex-end",maxWidth:"50%"},children:[i.map(l=>{const c=ze[l]||ze.modding;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:c.bg,color:c.color,border:c.border},children:l},l)}),(t.is_open??1)===1?e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(16, 185, 129, 0.12)",color:"#10b981",border:"1px solid rgba(16, 185, 129, 0.2)"},children:"Open"}):e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:"rgba(239, 68, 68, 0.12)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)"},children:"Closed"})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(st,{size:18}):e.jsx(me,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(Me,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const l=t.member_count||0;return l===0?null:l===1&&t.first_member_username?` and ${t.first_member_username}`:l>1?` & ${l} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function Gt({isOpen:t,onClose:s,anchorRef:n}){const{notify:u}=de(),{data:i}=ke(),{data:l=[]}=Te(),c=lt(),[x,b]=o.useState(""),[S,d]=o.useState(""),[v,h]=o.useState(["modding"]),z=o.useRef(null),N=i?l.some(j=>j.owner_id===i.id):!1,_=(i==null?void 0:i.is_admin)||(i==null?void 0:i.is_mod);o.useEffect(()=>{if(!t)return;const j=w=>{const P=w.target;z.current&&!z.current.contains(P)&&(n!=null&&n.current)&&!n.current.contains(P)&&s()};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[t,s,n]);const T=j=>{if(qe.includes(j)){v.includes(j)?h(["modding"]):h([j]);return}const w=v.filter(P=>et.includes(P));if(w.includes(j)){const P=w.filter(J=>J!==j);if(P.length===0)return;h(P)}else h([...w,j])},k=async j=>{if(j.preventDefault(),N){u("You can only create one queue",{variant:"error"});return}if(!x.trim()){u("Queue name is required",{variant:"error"});return}c.mutate({name:x.trim(),description:S.trim()||null,is_group:!1,tags:v.join(",")},{onSuccess:()=>{u("Queue created!",{variant:"success"}),s(),b(""),d(""),h(["modding"])},onError:w=>{u((w==null?void 0:w.message)||"Failed to create queue",{variant:"error"})}})};if(!t)return null;const E=v.some(j=>qe.includes(j));return e.jsx("div",{ref:z,className:"create-queue-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:N?e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsx("form",{onSubmit:k,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:x,onChange:j=>b(j.target.value),maxLength:100,required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("textarea",{placeholder:"Description (optional)",value:S,onChange:j=>d(j.target.value),maxLength:500,rows:2,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",outline:"none"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:et.map(j=>{const w=v.includes(j),P=E;return e.jsx("button",{type:"button",onClick:()=>T(j),disabled:P,style:{background:w?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:w?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:w?"#667eea":P?"var(--muted)":"var(--text)",cursor:P?"not-allowed":"pointer",transition:"all 0.15s",fontWeight:w?500:400,opacity:P?.5:1,textTransform:"capitalize"},children:j},j)})}),_&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:10,color:"var(--muted)",marginTop:10,marginBottom:6,fontWeight:500},children:"Admin Only"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:qe.map(j=>{const w=v.includes(j);return e.jsx("button",{type:"button",onClick:()=>T(j),style:{background:w?"rgba(139, 92, 246, 0.2)":"rgba(255,255,255,0.05)",border:w?"1px solid #a78bfa":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:w?"#a78bfa":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:w?500:400,textTransform:"capitalize"},children:j},j)})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:4},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c.isPending||!x.trim(),style:{background:x.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:x.trim()?"pointer":"not-allowed"},children:c.isPending?"Creating...":"Create"})]})]})})})}function Kt(){const[t,s]=ne.useState(!1),[n,u]=ne.useState(""),[i,l]=ne.useState(""),{data:c=[]}=Te(),{data:x}=ke(),{notify:b}=de(),S=lt(),d=ne.useMemo(()=>x?c.some(h=>h.owner_id===x.id):!1,[x,c]),v=h=>{if(h&&h.preventDefault(),d){b("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!n.trim()){b("Queue name is required",{variant:"error"});return}S.mutate({name:n.trim(),description:i.trim()||null,is_group:!1},{onSuccess:()=>{b("Queue created!",{variant:"success"}),s(!1),u(""),l("")},onError:z=>{b((z==null?void 0:z.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>s(!0),children:e.jsx(Se,{size:22})}),e.jsx(Le,{open:t,onClose:()=>s(!1),children:e.jsxs("form",{onSubmit:v,className:"col",style:{gap:12},children:[d?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:n,onChange:h=>u(h.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:i,onChange:h=>l(h.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:S.isPending||d,children:S.isPending?"Creating...":"Create"})]})]})})]})}const Vt=[{id:"queues",label:"Queues"},{id:"submissions",label:"Submissions"}];function ds(){const[t,s]=qt(),n=t.get("tab")||"queues",[u,i]=o.useState(n),{data:l=[],isLoading:c}=Te(),{data:x}=ke(),{queueTypeFilters:b}=Re(),{notify:S}=de(),[d,v]=o.useState(!1),h=o.useRef(null),[z,N]=o.useState([]),[_,T]=o.useState(!1);o.useEffect(()=>{u==="submissions"&&k()},[u]);const k=async()=>{try{T(!0);const q=await F(R.moddi.mySubmissions);N(q.items)}catch(q){console.error(q),S("Failed to load submissions",{variant:"error"})}finally{T(!1)}},E=q=>{i(q),s(q==="queues"?{}:{tab:q})},j=o.useMemo(()=>l.filter(L=>{const Y=L.type||"modder";return Y==="modder"&&b.modder||(Y==="nominator"||Y==="subdivision")&&b.nominator||Y==="timing"&&b.timing||Y==="audio"&&b.audio}).sort((L,Y)=>{const U=(L.is_open??1)===1,G=(Y.is_open??1)===1;return U&&!G?-1:!U&&G?1:0}),[l,b]),w=q=>{N(L=>L.map(Y=>Y.id===q.id?{...Y,...q}:Y))},P=q=>{N(L=>L.filter(Y=>Y.id!==q))},J=e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:h,onClick:()=>v(!d),style:{width:48,height:"100%",minHeight:48,background:d?"rgba(255,255,255,0.05)":"transparent",border:"none",color:"var(--text)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},onMouseEnter:q=>{d||(q.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:q=>{d||(q.currentTarget.style.backgroundColor="transparent")},title:"Create queue",children:e.jsx(Se,{size:18})}),e.jsx(Gt,{isOpen:d,onClose:()=>v(!1),anchorRef:h})]});return e.jsxs("div",{className:"feed-container unified-queues",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0},children:[e.jsx(ct,{tabs:Vt,activeTab:u,onChange:E,rightAction:J}),u==="queues"&&e.jsxs(e.Fragment,{children:[e.jsx(Kt,{}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsx("div",{className:"col",style:{gap:0},children:c?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):j.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):j.map(q=>e.jsx(Jt,{queue:q},q.id))})}),e.jsx(dt,{context:"moddi-queues"})]}),u==="submissions"&&e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:_?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):z.length===0?e.jsxs("div",{style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx("button",{className:"btn",style:{marginTop:16},onClick:()=>E("queues"),children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:0},children:z.map(q=>e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(je,{to:`/queues/${q.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:L=>L.currentTarget.style.textDecoration="underline",onMouseLeave:L=>L.currentTarget.style.textDecoration="none",children:q.queue_name}),q.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(q.created_at*1e3).toLocaleDateString()})]}),e.jsx(Fe,{submission:q,canManage:!1,allowSelfActions:!0,onUpdate:w,onDelete:P})]},q.id))})})]})}export{R as A,dt as D,ls as N,Me as O,os as Q,ct as T,ds as U,as as a,ke as b,de as c,F as d,Qt as e,rs as f,Bt as g,is as h,Wt as i,Ot as j,it as k,Dt as l,at as m,ss as n,Pt as o,ts as p,ns as q,Re as u};
