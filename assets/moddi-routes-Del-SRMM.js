import{r as d,j as e,d as kt,u as he,e as be,f as Se,g as it,R as V,c as fe,h as ve,i as ce,k as He,l as Ye,m as Ge,n as me,o as we,p as ke,q as Tt,s as Nt,t as rt,v as _t,w as je,x as Ee,y as Ct,L as Ae,z as ot,A as qt,M as zt,B as Xe,C as Je,D as Ke,E as Ve,G as ge,H as Ze,I as et,J as Ft,K as Mt}from"./vendor-react-Ch4-g7iQ.js";import{B as It}from"./editor-BfsBTTZa.js";function lt(){if(typeof window>"u")return!1;try{const t=navigator.userAgentData;if(t&&typeof t.mobile=="boolean"&&t.mobile||window.matchMedia&&(window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(hover: none)").matches))return!0;const s=navigator.userAgent||"";if(/Android|iPhone|iPad|iPod|Mobile|Silk|Kindle|Opera Mini|IEMobile|WPDesktop/i.test(s))return!0}catch{}return!1}function os(){var u;if(typeof window>"u"||typeof document>"u")return()=>{};const t=()=>{const r=lt();document.documentElement.classList.toggle("is-mobile",r),document.documentElement.setAttribute("data-mobile",r?"true":"false")};t();const s=["(pointer: coarse)","(hover: none)","(orientation: landscape)","(orientation: portrait)"],a=[];try{for(const r of s)if(window.matchMedia){const o=window.matchMedia(r);(u=o.addEventListener)==null||u.call(o,"change",t),a.push(o)}}catch{}return window.addEventListener("resize",t),()=>{try{a.forEach(r=>{var o;return(o=r.removeEventListener)==null?void 0:o.call(r,"change",t)}),window.removeEventListener("resize",t)}catch{}}}function ls(){if(typeof window>"u")return!1;try{const t=navigator.standalone===!0,s=window.matchMedia&&window.matchMedia("(display-mode: standalone)"),a=!!(s&&s.matches),u=window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)"),r=window.matchMedia&&window.matchMedia("(display-mode: fullscreen)");return t||a||!!(u&&u.matches)||!!(r&&r.matches)}catch{return!1}}const dt=d.createContext(null);function ds({children:t}){const[s,a]=d.useState([]),u=d.useRef(1),r=d.useRef(new Map),o=l=>{const b=r.current.get(l);b&&(clearTimeout(b),r.current.delete(l))},c=(l,b)=>{o(l);const h=window.setTimeout(()=>y(l),b);r.current.set(l,h)},y=d.useCallback(l=>{o(l),a(b=>b.filter(h=>h.id!==l))},[]),w=d.useCallback((l,b)=>{const h=typeof b=="number"?b:(b==null?void 0:b.durationMs)??5e3,_=typeof b=="number"?"info":(b==null?void 0:b.variant)??"info",C=lt();let q=null;return a(C?k=>{const S=k[0];if(S&&S.message===l&&S.variant===_){const g={...S,count:S.count+1,duration:h};return q=g.id,[g]}k.forEach(g=>o(g.id));const O=u.current++,v={id:O,message:l,duration:h,variant:_,count:1};return q=O,[v]}:k=>{const S=k.findIndex(g=>g.message===l&&g.variant===_);if(S!==-1){const g=[...k],N={...g[S],count:g[S].count+1};return g[S]=N,q=N.id,g}const O=u.current++,v={id:O,message:l,duration:h,variant:_,count:1};return q=O,[...k,v]}),q!=null&&c(q,h),q??-1},[]),T=d.useMemo(()=>({notify:w,close:y}),[w,y]);return e.jsxs(dt.Provider,{value:T,children:[t,e.jsx("div",{className:"toasts",children:s.map(l=>e.jsxs("div",{className:`toast ${l.variant}`,children:[e.jsxs("div",{className:"toast-text",children:[l.message,l.count>1&&e.jsxs("span",{style:{marginLeft:6,opacity:.8},children:["×",l.count]})]}),e.jsx("button",{className:"toast-close",onClick:()=>y(l.id),"aria-label":"Close",children:"×"})]},l.id))})]})}function ue(){const t=d.useContext(dt);if(!t)throw new Error("useToasts must be used within ToastProvider");return t}const Rt=()=>{try{const t=localStorage.getItem("filter_modes")||"standard",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{standard:!0,taiko:!0,mania:!0,catch:!0}}catch{return{standard:!0,taiko:!0,mania:!0,catch:!0}}},Et=()=>{try{const t=localStorage.getItem("filter_moddi_tags")||"untagged,help,showcase,request",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{untagged:s.has("untagged")||s.size===0,help:s.has("help")||s.size===0,showcase:s.has("showcase")||s.size===0,request:s.has("request")||s.size===0}}catch{return{untagged:!0,help:!0,showcase:!0,request:!0}}},Lt=()=>{try{const t=localStorage.getItem("filter_queue_status")||"unchecked,accepted,denied,finished",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{unchecked:s.has("unchecked")||s.size===0,accepted:s.has("accepted")||s.size===0,denied:s.has("denied")||s.size===0,finished:s.has("finished")||s.size===0,archived:s.has("archived")}}catch{return{unchecked:!0,accepted:!0,denied:!0,finished:!0,archived:!1}}},At=()=>{try{const t=localStorage.getItem("filter_queue_open")||"open",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{open:s.has("open")||s.size===0,closed:s.has("closed")}}catch{return{open:!0,closed:!1}}},Pt=()=>{try{const t=localStorage.getItem("filter_queue_type")||"modder,nominator,timing,audio",s=new Set(t.toLowerCase().split(",").map(a=>a.trim()).filter(Boolean));return{modder:s.has("modder")||s.size===0,nominator:s.has("nominator")||s.size===0,timing:s.has("timing")||s.size===0,audio:s.has("audio")||s.size===0}}catch{return{modder:!0,nominator:!0,timing:!0,audio:!0}}},Bt=()=>{try{const t=localStorage.getItem("last_section");return t==="mappi"||t==="moddi"?t:null}catch{return null}},Ot=()=>{try{return localStorage.getItem("theme")==="light"?"light":"dark"}catch{return"dark"}},Te=kt(t=>({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1,modeFilters:Rt(),tagFilters:Et(),queueStatusFilters:Lt(),queueOpenFilters:At(),queueTypeFilters:Pt(),lastSection:Bt(),previousLocation:null,theme:Ot(),setMenuOpen:s=>t({menuOpen:s}),setMobileNavOpen:s=>t({mobileNavOpen:s}),setNotifOpen:s=>t({notifOpen:s}),closeAllPanels:()=>t({menuOpen:!1,mobileNavOpen:!1,notifOpen:!1}),setModeFilters:s=>{t({modeFilters:s});try{const u=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),r=u.length?u:["standard"];localStorage.setItem("filter_modes",r.join(","))}catch{}},setTagFilters:s=>{t({tagFilters:s});try{const u=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),r=u.length?u:["untagged","help","showcase","request"];localStorage.setItem("filter_moddi_tags",r.join(","))}catch{}},setQueueStatusFilters:s=>{t({queueStatusFilters:s});try{const u=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),r=u.length?u:["unchecked","accepted","denied","finished"];localStorage.setItem("filter_queue_status",r.join(","))}catch{}},setQueueOpenFilters:s=>{t({queueOpenFilters:s});try{const u=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),r=u.length?u:["open"];localStorage.setItem("filter_queue_open",r.join(","))}catch{}},setQueueTypeFilters:s=>{t({queueTypeFilters:s});try{const u=Object.entries(s).filter(([o,c])=>c).map(([o])=>o),r=u.length?u:["modder","nominator","timing","audio"];localStorage.setItem("filter_queue_type",r.join(","))}catch{}},setLastSection:s=>{t({lastSection:s});try{s?localStorage.setItem("last_section",s):localStorage.removeItem("last_section")}catch{}},setPreviousLocation:s=>{t({previousLocation:s})},setTheme:s=>{t({theme:s});try{localStorage.setItem("theme",s)}catch{}}})),ct="https://api.osumappi.ng";function ut(){var t;try{return((t=document.cookie.split("; ").map(s=>s.split("=")).find(([s])=>s==="csrf"))==null?void 0:t[1])||""}catch{return""}}async function R(t,s={}){const{requireAuth:a=!0,skipCsrf:u=!1,...r}=s,o={...r.headers};if(r.body&&!o["Content-Type"]&&(o["Content-Type"]="application/json"),a&&!u){const y=ut();y&&(o["X-CSRF-Token"]=y)}const c=await fetch(`${ct}${t}`,{...r,credentials:"include",headers:o});if(!c.ok){const y=await c.json().catch(()=>({error:`HTTP ${c.status}`}));throw new Error(y.error||`HTTP ${c.status}: ${c.statusText}`)}return c.json()}function Dt(t){const s=new URLSearchParams;for(const[u,r]of Object.entries(t))r!=null&&s.append(u,String(r));const a=s.toString();return a?`?${a}`:""}const E={auth:{login:"/api/auth/login",logout:"/api/auth/logout",me:"/api/me"},user:{quota:"/api/me/upload_quota",notifications:"/api/me/notifications",markNotificationsRead:"/api/me/notifications/mark_read",deleteNotification:t=>`/api/me/notifications/${encodeURIComponent(t)}`,pushSubscribe:"/api/me/push/subscribe",pushUnsubscribe:"/api/me/push/unsubscribe",pushList:"/api/me/push/subscriptions",pushTest:"/api/me/push/test",notifPrefs:"/api/me/notification_prefs"},feed:{next:"/api/feed/next",batch:"/api/feed/batch",progress:t=>`/api/feed/progress${t?`?modes=${encodeURIComponent(t)}`:""}`,recent:"/api/videos/recent"},videos:{like:t=>`/api/videos/${t}/like`,view:t=>`/api/videos/${t}/view`,update:t=>`/api/videos/${t}`,delete:t=>`/api/videos/${t}`,flag:t=>`/api/videos/${t}/flag`,comments:t=>`/api/videos/${t}/comments`,get:t=>`/api/videos/${t}`},uploads:{new:"/api/uploads/new"},moddi:{mySubmissions:"/api/moddi/me/submissions",posts:"/api/moddiposts",post:t=>`/api/moddiposts/${t}`,postReact:t=>`/api/moddiposts/${t}/react`,postComments:t=>`/api/moddiposts/${t}/comments`,queues:"/api/moddi/queues",queue:t=>`/api/moddi/queues/${t}`,queueSubmit:t=>`/api/moddi/queues/${t}/submit`,queueAccept:t=>`/api/moddi/queues/${t}/accept`,queueDeny:t=>`/api/moddi/queues/${t}/deny`,queueInvite:t=>`/api/moddi/queues/${t}/invite`,queueMember:(t,s)=>`/api/moddi/queues/${t}/members/${s}`,queueSubmission:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueSubmissionDelete:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}`,queueBlockUser:t=>`/api/moddi/queues/${t}/block`,queueUnblockUser:(t,s)=>`/api/moddi/queues/${t}/block/${s}`,queueBlockedUsers:t=>`/api/moddi/queues/${t}/blocked`,queueSubmissionAcknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,queueSubmissionUnacknowledge:(t,s)=>`/api/moddi/queues/${t}/submissions/${s}/acknowledge`,usersSearch:t=>`/api/moddi/users/search?q=${encodeURIComponent(t)}`},osu:{resolveBeatmap:"/api/osu/beatmap/resolve",downloadBeatmapset:t=>`/api/osu/beatmapsets/${t}/download?noVideo=1`,usersSearch:t=>`/api/osu/users/search?q=${encodeURIComponent(t)}`},users:{get:t=>`/api/users/${t}`,videos:t=>`/api/users/${t}/videos`,likes:t=>`/api/users/${t}/likes`,myVideos:"/api/me/videos"},admin:{clearViews:"/api/admin/me/clear_views",debugState:"/api/debug/state",settingsModeration:"/api/admin/settings/moderation",videosPending:"/api/admin/videos/pending",videosApprove:t=>`/api/admin/videos/${t}/approve`,videosReject:t=>`/api/admin/videos/${t}/reject`,videosAction:(t,s)=>`/api/admin/videos/${t}/${s}`,analytics:"/api/admin/analytics",usersSearch:t=>`/api/admin/users/search?q=${encodeURIComponent(t)}`,userVideos:t=>`/api/admin/users/${t}/videos`,userUpdate:t=>`/api/admin/users/${t}`,notificationsSystem:"/api/admin/notifications/system",notificationsTest:"/api/admin/notifications/test"}};function Wt(t=!0){return he({queryKey:["notifications"],queryFn:async()=>{try{const s=await R(E.user.notifications);return Array.isArray(s.items)?s.items:[]}catch{return[]}},enabled:t,refetchInterval:45*1e3})}function Qt(){return he({queryKey:["notifications","detailed"],queryFn:async()=>{try{const t=await R("/api/me/notifications/detailed");return Array.isArray(t.items)?t.items:[]}catch{return[]}},refetchInterval:30*1e3})}function cs(){const{data:t=[]}=Wt();return t.filter(s=>s.kind==="system"&&s.id.startsWith("b:")&&(s.expiresAt||0)<=Date.now()?!1:!s.read).length}function $t(){const t=be();return Se({mutationFn:async s=>{await R(E.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:s})})},onSuccess:()=>{t.setQueryData(["notifications"],s=>(s==null?void 0:s.map(a=>({...a,read:!0})))||[])}})}function Ut(){const t=be();return Se({mutationFn:async s=>{const a=ut();await R(E.user.deleteNotification(s),{method:"DELETE",headers:{"X-CSRF-Token":a}})},onSuccess:(s,a)=>{t.setQueryData(["notifications"],u=>(u==null?void 0:u.filter(r=>r.id!==a))||[]),t.setQueryData(["notifications","detailed"],u=>(u==null?void 0:u.filter(r=>r.id!==a))||[])}})}function Ne(){return he({queryKey:["user","me"],queryFn:async()=>{try{return await R(E.auth.me)}catch{return null}},staleTime:5*60*1e3})}function us(t=!0){return he({queryKey:["user","quota"],queryFn:async()=>{try{return await R(E.user.quota)}catch{return null}},enabled:t,refetchInterval:30*1e3})}function ms(){const t=be();return Se({mutationFn:async()=>{await R(E.auth.logout,{method:"POST"})},onSuccess:()=>{t.setQueryData(["user","me"],null),t.clear(),window.location.href="/"}})}function Ht(t,s,a,u){d.useEffect(()=>{if(!a)return;const r=o=>{const c=o.target;s.current&&!s.current.contains(c)&&t.current&&!t.current.contains(c)&&u()};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[a,u,t,s])}const tt=/(\d{2}:\d{2}:\d{3})(?:\s+\(([\d,]+)\))?/g;function st(t,s){return s?`osu://edit/${t}-(${s})`:`osu://edit/${t}`}function Pe({text:t,className:s,style:a}){tt.lastIndex=0;const u=[];let r=0,o;for(;(o=tt.exec(t))!==null;){o.index>r&&u.push(t.substring(r,o.index));const c=o[1],y=o[2],w=o[0];u.push(e.jsx("a",{href:st(c,y),onClick:T=>{T.preventDefault(),window.location.href=st(c,y)},style:{color:"var(--primary)",textDecoration:"none",cursor:"pointer"},onMouseEnter:T=>{T.currentTarget.style.textDecoration="underline"},onMouseLeave:T=>{T.currentTarget.style.textDecoration="none"},title:"Open in osu! editor",children:w},o.index)),r=o.index+o[0].length}return r<t.length&&u.push(t.substring(r)),u.length===0?e.jsx("span",{className:s,style:a,children:t}):e.jsx("span",{className:s,style:a,children:u})}const Yt=({context:t,onClose:s,style:a})=>{const u=it(),r=V.useMemo(()=>{if(t)return t;const g=u.pathname;return g==="/feed"||g==="/mp/feed"?"mappi-feed":g==="/md/feed"?"moddi-feed":g==="/queues"||g==="/md/queues"?"moddi-queues":g.startsWith("/queues/")||g.startsWith("/md/queues/")?"moddi-queue-detail":"mappi-feed"},[t,u.pathname]),{modeFilters:o,setModeFilters:c,tagFilters:y,setTagFilters:w,queueOpenFilters:T,setQueueOpenFilters:l,queueStatusFilters:b,setQueueStatusFilters:h,queueTypeFilters:_,setQueueTypeFilters:C}=Te(),q=g=>{const N={...y,[g]:!y[g]};!N.untagged&&!N.help&&(N.help=!0),w(N);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},k=g=>{const N={...b,[g]:!b[g]};["unchecked","accepted","denied","finished"].some(M=>N[M])||(N.unchecked=!0),h(N)},S=g=>{const N={..._,[g]:!_[g]};!N.modder&&!N.nominator&&!N.timing&&!N.audio&&(N.modder=!0),C(N)},O=({title:g,children:N})=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",letterSpacing:.5,opacity:.8,marginBottom:6},children:g}),e.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:N})]}),v=({active:g,onClick:N,label:$})=>e.jsx("button",{type:"button",onClick:N,className:"chip","aria-pressed":g,style:{padding:"6px 10px",borderRadius:999,border:"1px solid",borderColor:g?"rgba(125,211,252,0.6)":"var(--border)",background:g?"rgba(125,211,252,0.18)":"transparent",color:"var(--text)",fontSize:13,lineHeight:1},children:$});return e.jsxs("div",{role:"dialog","aria-label":"Filters",style:{zIndex:1e4,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:10,padding:12,width:260,boxShadow:"0 10px 30px rgba(0,0,0,0.45)",...a},children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:600},children:"Filters"}),s&&e.jsx("button",{className:"icon-link",onClick:s,"aria-label":"Close filters",title:"Close",style:{padding:4},children:e.jsx(fe,{size:16})})]}),r==="moddi-feed"&&e.jsxs(O,{title:"Tags",children:[e.jsx(v,{active:y.untagged,onClick:()=>q("untagged"),label:"Untagged"}),e.jsx(v,{active:y.help,onClick:()=>q("help"),label:"Help"})]}),r==="moddi-queues"&&e.jsxs(O,{title:"Type",children:[e.jsx(v,{active:_.modder,onClick:()=>S("modder"),label:"Modding"}),e.jsx(v,{active:_.nominator,onClick:()=>S("nominator"),label:"BN/Subdivision"}),e.jsx(v,{active:_.timing,onClick:()=>S("timing"),label:"Timing"}),e.jsx(v,{active:_.audio,onClick:()=>S("audio"),label:"Audio"})]}),r==="moddi-queue-detail"&&e.jsxs(O,{title:"Submissions",children:[e.jsx(v,{active:b.unchecked,onClick:()=>k("unchecked"),label:"Pending"}),e.jsx(v,{active:b.accepted,onClick:()=>k("accepted"),label:"Accepted"}),e.jsx(v,{active:b.denied,onClick:()=>k("denied"),label:"Denied"}),e.jsx(v,{active:b.finished,onClick:()=>k("finished"),label:"Finished"})]})]})};function Gt({beatmapMeta:t,beatmapVersion:s}){const a=d.useRef(null),u=d.useRef(null),[r,o]=d.useState(!1),[c,y]=d.useState(!1),[w,T]=d.useState(0);d.useEffect(()=>{if(a.current&&u.current){const h=a.current.offsetWidth,_=u.current.scrollWidth;T(_),y(_>h)}},[t,s]);const l=t?e.jsxs(e.Fragment,{children:[t.artist," – ",t.title,t.mapper?` (by ${t.mapper})`:"",s?` [${s}]`:""]}):s?`[${s}]`:"Beatmap",b=w>0?Math.max(3,w/50):3;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),e.jsxs("div",{ref:a,className:"muted one-line",style:{fontSize:13,fontWeight:600,color:"var(--text)",flex:"1 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:c?"pointer":"default"},onMouseEnter:()=>c&&o(!0),onMouseLeave:()=>o(!1),children:[e.jsx("span",{ref:u,style:{display:"inline-block",animation:r&&c?`beatmap-marquee ${b}s linear infinite`:"none"},children:l}),r&&c&&e.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:l})]})]})}function Le({submission:t,canManage:s,onUpdate:a,onDelete:u,isGroup:r=!1,allowSelfActions:o=!1}){const[c,y]=d.useState(!1),[w,T]=d.useState(!1),[l,b]=d.useState(null),[h,_]=d.useState(t.beatmapset_id),[C,q]=d.useState(t.beatmap_id),[k,S]=d.useState(!1),[O,v]=d.useState(!1),[g,N]=d.useState(null),[$,M]=d.useState(!1),[L,U]=d.useState(t.acknowledgments||[]),[G,se]=d.useState(t.acknowledged_by_me||!1),W=d.useRef(null),x=d.useRef(null),z=d.useRef(null),j=d.useRef(null),B=d.useRef(null),{notify:Z}=ue();d.useEffect(()=>{U(t.acknowledgments||[]),se(t.acknowledged_by_me||!1)},[t.acknowledgments,t.acknowledged_by_me]),d.useEffect(()=>{if(t.beatmap_url)try{const i=new URL(t.beatmap_url),f=i.pathname.match(/\/beatmapsets\/(\d+)/);if(f&&!t.beatmapset_id){const A=Number(f[1]);isNaN(A)||_(A)}const I=i.hash.match(/#osu\/(\d+)/);if(I&&!t.beatmap_id){const A=Number(I[1]);isNaN(A)||q(A)}}catch(i){console.error("[QueueSubmission] Error parsing beatmap URL:",t.beatmap_url,i)}},[t.beatmap_url,t.beatmapset_id,t.beatmap_id,t.id]),d.useEffect(()=>{console.log("[QueueSubmission] Submission data:",{id:t.id,beatmap_url:t.beatmap_url,beatmapset_id:t.beatmapset_id,beatmap_id:t.beatmap_id,extracted_beatmapset_id:h,extracted_beatmap_id:C,beatmap_version:t.beatmap_version})},[t.id,h,C]),d.useEffect(()=>{if(!t.beatmap_url||l&&h)return;let i=!1;return(async()=>{try{console.log("[QueueSubmission] Fetching beatmap metadata...",{beatmap_url:t.beatmap_url,existing_beatmapset_id:t.beatmapset_id,existing_beatmap_id:t.beatmap_id});let f;try{f=new URL(t.beatmap_url)}catch(Q){console.error("[QueueSubmission] Invalid beatmap URL:",t.beatmap_url,Q);return}const I=f.hash.match(/#osu\/(\d+)/),A=I?I[1]:null;f.hash="";const Y={url:f.toString()};if(A?Y.beatmap_id=A:t.beatmap_id&&(Y.beatmap_id=String(t.beatmap_id)),console.log("[QueueSubmission] Resolving beatmap with params:",Y),!i){const Q=await R(E.osu.resolveBeatmap+Dt(Y),{requireAuth:!1});console.log("[QueueSubmission] Beatmap resolve response:",Q),Q.setId&&!h&&(console.log("[QueueSubmission] Setting beatmapset_id from API:",Q.setId),_(Number(Q.setId))),(Q.title||Q.artist)&&b({title:Q.title||null,artist:Q.artist||null,mapper:Q.mapper||null})}}catch(f){console.error("[QueueSubmission] Error fetching beatmap metadata:",f)}})(),()=>{i=!0}},[t.beatmap_url,t.beatmap_id,t.beatmapset_id,l,h]),d.useEffect(()=>{if(!k){N(null),B.current&&(window.removeEventListener("resize",B.current),window.removeEventListener("scroll",B.current,!0),B.current=null);return}let i=null;const f=()=>{let I=null;const A=j.current;if(A){const J=A.querySelector(".queue-submission-beatmap-btn-desktop button"),Y=A.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),Q=A.querySelector(".queue-submission-beatmap-btn-mobile button");J&&window.getComputedStyle(J.parentElement).display!=="none"?I=J:Y&&window.getComputedStyle(Y.parentElement).display!=="none"?I=Y:Q&&window.getComputedStyle(Q.parentElement).display!=="none"&&(I=Q)}if(!I&&z.current&&(I=z.current),I){const J=I.getBoundingClientRect();N({top:J.bottom+8,right:window.innerWidth-J.right})}else N(null)};return B.current=f,i=requestAnimationFrame(()=>{f(),window.addEventListener("resize",f),window.addEventListener("scroll",f,!0)}),()=>{i!==null&&cancelAnimationFrame(i),B.current&&(window.removeEventListener("resize",B.current),window.removeEventListener("scroll",B.current,!0),B.current=null)}},[k]),d.useEffect(()=>{if(!w)return;const i=f=>{const I=f.target;W.current&&!W.current.contains(I)&&!I.closest("[data-status-dropdown]")&&T(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[w]),d.useEffect(()=>{if(!k)return;const i=f=>{const I=f.target;if(x.current&&x.current.contains(I))return;const A=j.current;if(A){if(z.current&&z.current.contains(I))return;const J=A.querySelector(".queue-submission-beatmap-btn-desktop button"),Y=A.querySelector(".queue-submission-beatmap-btn-desktop-actions button"),Q=A.querySelector(".queue-submission-beatmap-btn-mobile button");if(J&&J.contains(I)||Y&&Y.contains(I)||Q&&Q.contains(I))return}S(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[k]);const pe=async i=>{if(!c){y(!0);try{await R(E.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({status:i})});const f={...t,status:i,updated_at:Math.floor(Date.now()/1e3)};a&&a(f),Z("Status updated",{variant:"success"})}catch{Z("Failed to update status",{variant:"error"})}finally{y(!1),T(!1)}}},re=async()=>{if(!c){y(!0);try{const i=!!t.is_archived;await R(E.moddi.queueSubmission(String(t.queue_id),t.id),{method:"PATCH",body:JSON.stringify({is_archived:!i})});const f={...t,is_archived:i?0:1,updated_at:Math.floor(Date.now()/1e3)};a&&a(f),Z(i?"Unarchived":"Archived",{variant:"success"})}catch{Z("Failed to update archive status",{variant:"error"})}finally{y(!1)}}},H=async()=>{if(confirm("Are you sure you want to delete this submission? This action cannot be undone.")&&!c){y(!0);try{await R(E.moddi.queueSubmissionDelete(String(t.queue_id),t.id),{method:"DELETE"}),Z("Submission deleted",{variant:"success"}),u&&u(t.id)}catch{Z("Failed to delete submission",{variant:"error"})}finally{y(!1)}}},ne=async()=>{if(!$){M(!0);try{if(G){if(await R(E.moddi.queueSubmissionUnacknowledge(String(t.queue_id),t.id),{method:"DELETE"}),se(!1),Z("Unacknowledged",{variant:"info"}),a){const i={...t,acknowledged_by_me:!1};a(i)}}else if(await R(E.moddi.queueSubmissionAcknowledge(String(t.queue_id),t.id),{method:"POST"}),se(!0),Z("Acknowledged",{variant:"success"}),a){const i={...t,acknowledged_by_me:!0};a(i)}}catch{Z("Failed to update acknowledgment",{variant:"error"})}finally{M(!1)}}},F={unchecked:"#f59e0b",accepted:"#10b981",denied:"#ef4444",finished:"#6366f1"},te={unchecked:"Pending",accepted:"Accepted",denied:"Denied",finished:"Finished"},ee=h||t.beatmapset_id,ie=ee?`https://assets.ppy.sh/beatmaps/${ee}/covers/card.jpg`:null;d.useEffect(()=>{ie?console.log("[QueueSubmission] Background image URL:",ie,"for beatmapset_id:",ee):console.log("[QueueSubmission] No background image URL - beatmapset_id:",ee,"submission.beatmapset_id:",t.beatmapset_id)},[ie,ee,t.beatmapset_id]);const X=!!t.is_archived,ae=s||o?e.jsxs("div",{className:"queue-submission-actions",style:{display:"flex",alignItems:"center",gap:8},children:[t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-desktop-actions",children:e.jsxs("button",{onClick:i=>{i.preventDefault(),i.stopPropagation(),S(f=>!f)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255,255,255,0.1)",i.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255,255,255,0.05)",i.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ce,{size:12,style:{marginLeft:4,opacity:.7}})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn-mobile",style:{display:"none"},children:e.jsxs("button",{onClick:i=>{i.preventDefault(),i.stopPropagation(),S(f=>!f)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255,255,255,0.1)",i.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255,255,255,0.05)",i.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ce,{size:12,style:{marginLeft:4,opacity:.7}})]})}),L&&L.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[L.slice(0,5).map((i,f)=>i.avatar_url?e.jsx("img",{src:i.avatar_url,alt:i.username,title:i.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:f>0?-8:0,zIndex:L.length-f,position:"relative",cursor:"pointer"}},i.user_id):e.jsx("div",{title:i.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:f>0?-8:0,zIndex:L.length-f,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:i.username.charAt(0).toUpperCase()},i.user_id)),L.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${L.length-5} more`,children:["+",L.length-5]})]}),s&&e.jsx("button",{className:"icon-link",onClick:ne,disabled:$||c,title:G?"Unacknowledge":"Acknowledge",style:{color:G?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:G?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:i=>{!$&&!c&&(i.currentTarget.style.background=G?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:i=>{i.currentTarget.style.background=G?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(He,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re,disabled:c,title:X?"Unarchive":"Archive",style:{color:X?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:X?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:i=>{c||(i.currentTarget.style.background=X?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:i=>{i.currentTarget.style.background=X?"rgba(99, 102, 241, 0.1)":"transparent"},children:X?e.jsx(Ye,{size:16}):e.jsx(Ge,{size:16})}),e.jsx("button",{className:"icon-link",onClick:H,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:i=>{c||(i.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:i=>{i.currentTarget.style.background="transparent"},children:e.jsx(me,{size:16})}),s&&e.jsxs("div",{className:"queue-submission-status-btn-wrapper",style:{position:"relative"},children:[e.jsxs("button",{ref:W,onClick:()=>T(!w),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:F[t.status]+"15",border:`1.5px solid ${F[t.status]}50`,color:F[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:i=>{c||(i.currentTarget.style.background=F[t.status]+"25",i.currentTarget.style.borderColor=F[t.status]+"70",i.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:i=>{i.currentTarget.style.background=F[t.status]+"15",i.currentTarget.style.borderColor=F[t.status]+"50",i.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:te[t.status]}),e.jsx(ce,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:w?"rotate(180deg)":"rotate(0deg)"}})]}),w&&we.createPortal(e.jsx("div",{"data-status-dropdown":!0,style:{position:"fixed",background:"var(--panel)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:10,padding:6,zIndex:1e4,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,0.4)",...(()=>{const i=document.querySelector(".queue-submission-status-btn-desktop button"),f=document.querySelector(".queue-submission-actions .queue-submission-status-btn-wrapper button"),I=document.querySelector(".queue-submission-status-btn-mobile button");let A=null;if(i&&window.getComputedStyle(i.parentElement).display!=="none"?A=i:I&&window.getComputedStyle(I.parentElement).display!=="none"?A=I:f&&window.getComputedStyle(f.parentElement).display!=="none"?A=f:W.current&&(A=W.current),A){const J=A.getBoundingClientRect();return{top:J.bottom+6,right:window.innerWidth-J.right}}return{top:0,right:0}})()},onClick:i=>i.stopPropagation(),children:["unchecked","accepted","denied","finished"].map(i=>e.jsx("button",{onClick:()=>pe(i),style:{display:"block",width:"100%",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:i===t.status?600:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",textAlign:"left",background:i===t.status?F[i]+"15":"transparent",color:i===t.status?F[i]:"var(--text)",border:"none",cursor:"pointer",transition:"all 0.15s ease",marginBottom:2},onMouseEnter:f=>{i!==t.status&&(f.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:f=>{i!==t.status&&(f.currentTarget.style.background="transparent")},children:te[i]},i))}),document.body)]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:j,className:"queue-submission-card",style:{position:"relative",borderRadius:16,overflow:"hidden",border:"1px solid var(--border-subtle)",background:"var(--panel-dark)",opacity:X?.6:1},children:[ie&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ie,alt:"",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.25,zIndex:0,pointerEvents:"none",filter:"blur(2px) saturate(0.6)"},onError:i=>{i.currentTarget.style.display="none"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%)",backdropFilter:"blur(4px)",zIndex:0}})]}),e.jsxs("div",{className:"queue-submission-inner",children:[e.jsxs("div",{className:"row queue-submission-header",style:{alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsx("div",{className:"queue-submission-main",style:{flex:1,minWidth:0},children:e.jsxs("div",{className:"queue-submission-meta-row",children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:24,height:24,style:{borderRadius:"50%"},alt:t.username}),e.jsx("span",{style:{fontSize:13},children:t.username}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(t.created_at*1e3).toLocaleDateString()})]})}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-beatmap-btn queue-submission-beatmap-btn-desktop",children:e.jsxs("button",{ref:z,className:"chip-btn link",onClick:i=>{i.preventDefault(),i.stopPropagation(),S(f=>!f)},title:"Beatmap options","aria-label":"Beatmap options",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",background:"var(--hover-overlay)",border:"1px solid var(--border)",borderRadius:6,color:"var(--text)",fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255,255,255,0.1)",i.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255,255,255,0.05)",i.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),e.jsx(ce,{size:12,style:{marginLeft:4,opacity:.7}})]})}),s&&e.jsxs("div",{className:"queue-submission-actions-desktop",style:{display:"flex",alignItems:"center",gap:8},children:[L&&L.length>0&&e.jsxs("div",{className:"queue-submission-acks",style:{display:"flex",alignItems:"center",marginRight:4},children:[L.slice(0,5).map((i,f)=>i.avatar_url?e.jsx("img",{src:i.avatar_url,alt:i.username,title:i.username,width:24,height:24,style:{borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:f>0?-8:0,zIndex:L.length-f,position:"relative",cursor:"pointer"}},i.user_id):e.jsx("div",{title:i.username,style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:f>0?-8:0,zIndex:L.length-f,position:"relative",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",cursor:"pointer"},children:i.username.charAt(0).toUpperCase()},i.user_id)),L.length>5&&e.jsxs("div",{style:{width:24,height:24,borderRadius:"50%",border:"2px solid var(--panel)",marginLeft:-8,background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:600,color:"var(--text)",zIndex:0,position:"relative"},title:`+${L.length-5} more`,children:["+",L.length-5]})]}),e.jsx("button",{className:"icon-link",onClick:ne,disabled:$||c,title:G?"Unacknowledge":"Acknowledge",style:{color:G?"#10b981":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:G?"rgba(16, 185, 129, 0.1)":"transparent"},onMouseEnter:i=>{!$&&!c&&(i.currentTarget.style.background=G?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:i=>{i.currentTarget.style.background=G?"rgba(16, 185, 129, 0.1)":"transparent"},children:e.jsx(He,{size:16})}),e.jsx("button",{className:"icon-link",onClick:re,disabled:c,title:X?"Unarchive":"Archive",style:{color:X?"#6366f1":"var(--muted)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:X?"rgba(99, 102, 241, 0.1)":"transparent"},onMouseEnter:i=>{c||(i.currentTarget.style.background=X?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)")},onMouseLeave:i=>{i.currentTarget.style.background=X?"rgba(99, 102, 241, 0.1)":"transparent"},children:X?e.jsx(Ye,{size:16}):e.jsx(Ge,{size:16})}),e.jsx("button",{className:"icon-link",onClick:H,disabled:c,title:"Delete submission",style:{color:"var(--danger)",width:"auto",height:"auto",padding:"6px",borderRadius:6,transition:"all 0.2s ease",background:"transparent"},onMouseEnter:i=>{c||(i.currentTarget.style.background="rgba(239, 68, 68, 0.1)")},onMouseLeave:i=>{i.currentTarget.style.background="transparent"},children:e.jsx(me,{size:16})}),e.jsx("div",{className:"queue-submission-status-btn-wrapper queue-submission-status-btn-desktop",style:{position:"relative"},children:e.jsxs("button",{ref:W,onClick:()=>T(!w),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:F[t.status]+"15",border:`1.5px solid ${F[t.status]}50`,color:F[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:i=>{c||(i.currentTarget.style.background=F[t.status]+"25",i.currentTarget.style.borderColor=F[t.status]+"70",i.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:i=>{i.currentTarget.style.background=F[t.status]+"15",i.currentTarget.style.borderColor=F[t.status]+"50",i.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:te[t.status]}),e.jsx(ce,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:w?"rotate(180deg)":"rotate(0deg)"}})]})})]}),s&&e.jsx("div",{className:"queue-submission-status-btn-mobile",style:{display:"none",position:"relative"},children:e.jsxs("button",{onClick:()=>T(!w),disabled:c,style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:F[t.status]+"15",border:`1.5px solid ${F[t.status]}50`,color:F[t.status],whiteSpace:"nowrap",cursor:c?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:c?.6:1},onMouseEnter:i=>{c||(i.currentTarget.style.background=F[t.status]+"25",i.currentTarget.style.borderColor=F[t.status]+"70",i.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:i=>{i.currentTarget.style.background=F[t.status]+"15",i.currentTarget.style.borderColor=F[t.status]+"50",i.currentTarget.style.transform="translateY(0)"},children:[e.jsx("span",{children:te[t.status]}),e.jsx(ce,{size:14,style:{marginLeft:2,transition:"transform 0.2s ease",transform:w?"rotate(180deg)":"rotate(0deg)"}})]})}),!s&&e.jsx("span",{className:"queue-submission-status-badge-header",style:{display:"inline-flex",alignItems:"center",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",background:F[t.status]+"15",border:`1.5px solid ${F[t.status]}50`,color:F[t.status],whiteSpace:"nowrap"},children:te[t.status]})]}),t.beatmap_url&&e.jsx("div",{className:"queue-submission-title-row",children:e.jsx(Gt,{beatmapMeta:l,beatmapVersion:t.beatmap_version})}),t.message&&e.jsx("div",{className:"queue-submission-message",children:e.jsx(Pe,{text:t.message})}),ae]})]}),k&&g&&t.beatmap_url&&we.createPortal(e.jsxs("div",{ref:x,style:{position:"fixed",top:g.top,right:g.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e4,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},onClick:i=>i.stopPropagation(),children:[e.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>S(!1),children:[e.jsx(ve,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),ee&&e.jsx("button",{className:"menu-item",onClick:()=>{v(!0),S(!1)},children:"Preview"})]}),document.body),O&&ee&&e.jsx(It,{open:O,onClose:()=>v(!1),downloadUrl:`${ct}${E.osu.downloadBeatmapset(ee)}`,beatmapId:C??t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})]})}const at=["modding","timing","audio"],Ie=["nominator","subdivision"];function _e(){return he({queryKey:["moddi","queues"],queryFn:async()=>{const t=await R(E.moddi.queues);return Array.isArray(t.items)?t.items:[]}})}function mt(){const t=be();return Se({mutationFn:async s=>{var a;return await R(E.moddi.queues,{method:"POST",body:JSON.stringify({name:s.name.trim(),description:((a=s.description)==null?void 0:a.trim())||null,is_group:s.is_group??!1,type:s.type||"modder",tags:s.tags||"modding"})})},onSuccess:()=>{t.invalidateQueries({queryKey:["moddi","queues"]})}})}function Be({open:t,onClose:s,children:a}){const u=d.useRef(null),r=d.useRef(null),o=d.useRef(!1),c=l=>{var b;r.current=((b=l.touches[0])==null?void 0:b.clientY)??null,o.current=!1},y=l=>{var C,q;if(r.current==null)return;const b=((C=l.touches[0])==null?void 0:C.clientY)??null;if(b==null)return;const h=b-r.current;(((q=u.current)==null?void 0:q.scrollTop)??0)<=0&&h>60?o.current=!0:o.current=!1},w=()=>{o.current&&s(),r.current=null,o.current=!1};if(!t)return null;const T=e.jsx("div",{className:"mobile-upload-overlay",onClick:s,children:e.jsx("div",{ref:u,className:"mobile-upload-sheet",onClick:l=>l.stopPropagation(),onTouchStart:c,onTouchMove:y,onTouchEnd:w,children:a})});return we.createPortal(T,document.body)}function Xt({queueId:t,onSubmitted:s}){const[a,u]=V.useState(!1),[r,o]=V.useState(t),[c,y]=V.useState(""),[w,T]=V.useState(""),[l,b]=V.useState(!1),{notify:h}=ue(),{data:_=[]}=_e();V.useEffect(()=>{o(t)},[t]);const C=async()=>{if(!r){h("Please select a queue",{variant:"error"});return}if(!c.trim()){h("Beatmap URL is required",{variant:"error"});return}b(!0);try{await R(E.moddi.queueSubmit(r),{method:"POST",body:JSON.stringify({beatmap_url:c.trim(),message:w.trim()||null})}),h("Submission created!",{variant:"success"}),y(""),T(""),u(!1),s==null||s()}catch(q){h((q==null?void 0:q.message)||"Failed to create submission",{variant:"error"})}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Submit to queue",title:"Submit to queue",onClick:()=>u(!0),children:e.jsx(ke,{size:22})}),e.jsx(Be,{open:a,onClose:()=>u(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[!t&&e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12,minWidth:80},children:"Queue:"}),e.jsxs("select",{value:r??"",onChange:q=>o(q.target.value||void 0),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:"6px 10px",fontSize:13},children:[e.jsx("option",{value:"",disabled:!0,children:"Select queue"}),_.map(q=>e.jsx("option",{value:String(q.id),children:q.name},q.id))]})]}),e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:q=>y(q.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:w,onChange:q=>T(q.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),w.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[w.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn",disabled:l,onClick:C,children:l?"Submitting...":"Submit"})]})]})})]})}function Jt(){const[t,s]=V.useState(!1);return V.useEffect(()=>{var r;const a=window.matchMedia("(max-width: 768px)"),u=()=>s(a.matches);return u(),(r=a.addEventListener)==null||r.call(a,"change",u),()=>{var o;return(o=a.removeEventListener)==null?void 0:o.call(a,"change",u)}},[]),t}const Kt=({context:t})=>{const s=Jt(),[a,u]=V.useState(!1),r=V.useRef(null),o=12,c=18,l=84+56+12;return V.useEffect(()=>{const b=h=>{if(!a)return;const _=h.target;if(r.current&&r.current.contains(_))return;const C=document.getElementById("desktop-filters-panel");C&&C.contains(_)||u(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[a]),s?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:r,className:"desktop-fab",onClick:()=>u(b=>!b),"aria-haspopup":"dialog","aria-expanded":a,title:"Filters","aria-label":"Filters",children:e.jsx(Tt,{size:22})}),a&&e.jsx("div",{id:"desktop-filters-panel",style:{position:"fixed",right:c,bottom:l,zIndex:1e4},children:e.jsx(Yt,{context:t,onClose:()=>u(!1),style:{maxHeight:`calc(100vh - ${l+o}px)`,maxWidth:`calc(100vw - ${c+o}px)`,overflow:"auto"}})})]})},nt=({content:t})=>e.jsx("div",{style:{fontSize:13,lineHeight:1.6,color:"var(--text)"},children:e.jsx(zt,{components:{p:({children:s})=>e.jsx("p",{style:{margin:"0 0 8px 0"},children:s}),ul:({children:s})=>e.jsx("ul",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),ol:({children:s})=>e.jsx("ol",{style:{margin:"0 0 8px 0",paddingLeft:20},children:s}),li:({children:s})=>e.jsx("li",{style:{margin:"0 0 4px 0"},children:s}),strong:({children:s})=>e.jsx("strong",{style:{fontWeight:600},children:s}),em:({children:s})=>e.jsx("em",{children:s}),code:({children:s})=>e.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:4,fontSize:12},children:s}),h1:({children:s})=>e.jsx("h1",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0"},children:s}),h2:({children:s})=>e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:"0 0 8px 0"},children:s}),h3:({children:s})=>e.jsx("h3",{style:{fontSize:14,fontWeight:600,margin:"0 0 8px 0"},children:s})},children:t})});function ps(){const{id:t}=Nt(),s=rt(),[a,u]=d.useState(null),[r,o]=d.useState([]),[c,y]=d.useState([]),[w,T]=d.useState(!0),[l,b]=d.useState(null),[h,_]=d.useState(!1),[C,q]=d.useState(!1),[k,S]=d.useState(""),[O,v]=d.useState(""),[g,N]=d.useState(null),[$,M]=d.useState(!1),[L,U]=d.useState(""),[G,se]=d.useState(""),[W,x]=d.useState(""),[z,j]=d.useState("modder"),[B,Z]=d.useState(!1),[pe,re]=d.useState(!1),[H,ne]=d.useState("general"),[F,te]=d.useState(!1),[ee,ie]=d.useState(!1),[X,ae]=d.useState(null),[i,f]=d.useState(""),[I,A]=d.useState([]),[J,Y]=d.useState(!1),Q=d.useRef(null),Ce=d.useRef(null),qe=d.useRef(null),[ze,pt]=d.useState([]),[Oe,De]=d.useState(!1),[Fe,We]=d.useState(null),{notify:D}=ue(),{queueStatusFilters:xe}=Te(),oe=async()=>{var n,p;if(t){T(!0);try{const m=await R(E.moddi.queue(t),{requireAuth:!1});u(m.queue||null),o(m.members||[]),y(m.submissions||[])}catch(m){(n=m==null?void 0:m.message)!=null&&n.includes("403")||(p=m==null?void 0:m.message)!=null&&p.includes("Forbidden")?(D("You do not have access to this queue",{variant:"error"}),s("/queues")):D("Failed to load queue",{variant:"error"})}finally{T(!1)}}};d.useEffect(()=>{oe(),R(E.auth.me,{requireAuth:!1}).then(n=>b(n)).catch(()=>{})},[t]);const le=l&&a&&(a.owner_id===l.id||r.some(n=>n.user_id===l.id&&n.joined_at)||l.is_mod||l.is_admin);l&&r.some(n=>n.user_id===l.id&&n.joined_at);const Qe=l&&a&&(a.owner_id===l.id||r.some(n=>n.user_id===l.id&&n.joined_at)),gt=async n=>{if(n.preventDefault(),!a||a.is_open===0){D("Queue is closed for submissions",{variant:"error"});return}if(!k.trim()){D("Beatmap URL is required",{variant:"error"});return}q(!0);try{await R(E.moddi.queueSubmit(t),{method:"POST",body:JSON.stringify({beatmap_url:k.trim(),message:O.trim()||null})}),D("Submission created!",{variant:"success"}),_(!1),S(""),v(""),oe()}catch(p){D((p==null?void 0:p.message)||"Failed to create submission",{variant:"error"})}finally{q(!1)}},$e=n=>{y(p=>p.map(m=>m.id===n.id?n:m)),n.acknowledged_by_me!==void 0&&oe()},ft=()=>{a&&(U(a.name),se(a.description||""),x(a.rules||""),j(a.type||"modder"),M(!0),ne("general"))},de=()=>{M(!1),U(""),se(""),x(""),j("modder")},ht=async()=>{if(!(!a||!Qe)){re(!0);try{const n=a.is_open!==1;await R(E.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_open:n})}),D(`Queue ${n?"opened":"closed"}`,{variant:"success"}),oe()}catch(n){D((n==null?void 0:n.message)||"Failed to update status",{variant:"error"})}finally{re(!1)}}},bt=async n=>{if(n.preventDefault(),!a||!L.trim()){D("Queue name is required",{variant:"error"});return}te(!0);try{const p=r.filter(P=>P.user_id!==a.owner_id&&P.role!=="owner").length>0,m={name:L.trim(),description:G.trim()||null,rules:W.trim()||null,is_group:p};(l!=null&&l.is_mod||l!=null&&l.is_admin)&&(m.type=z),await R(E.moddi.queue(t),{method:"PATCH",body:JSON.stringify(m)}),D("Queue updated!",{variant:"success"}),de(),oe()}catch(p){D((p==null?void 0:p.message)||"Failed to update queue",{variant:"error"})}finally{te(!1)}};d.useEffect(()=>{if(!i.trim()){A([]),Y(!1);return}const n=setTimeout(async()=>{try{const m=(await R(E.moddi.usersSearch(i),{requireAuth:!1})).items||[];A(m),Y(m.length>0)}catch(p){console.error("Search failed:",p),A([]),Y(!1)}},300);return()=>clearTimeout(n)},[i]);const xt=async n=>{if(!ee){ie(!0);try{await R(E.moddi.queueInvite(t),{method:"POST",body:JSON.stringify({user_id:n})}),D("Invite sent!",{variant:"success"}),f(""),A([]),Y(!1),oe()}catch(p){D((p==null?void 0:p.message)||"Failed to invite member",{variant:"error"})}finally{ie(!1)}}},Me=async()=>{if(!(!t||!le))try{const n=await R(E.moddi.queueBlockedUsers(t));pt(n.blocked||[])}catch(n){console.error("Failed to load blocked users:",n)}},yt=async n=>{if(!(!t||Oe)&&confirm("Block this user from submitting to this queue?")){De(!0);try{await R(E.moddi.queueBlockUser(t),{method:"POST",body:JSON.stringify({user_id:n})}),D("User blocked",{variant:"success"}),Me(),f(""),A([]),Y(!1)}catch(p){D((p==null?void 0:p.message)||"Failed to block user",{variant:"error"})}finally{De(!1)}}},Ue=async n=>{if(!(!t||Fe===n)){We(n);try{await R(E.moddi.queueUnblockUser(t,n),{method:"DELETE"}),D("User unblocked",{variant:"success"}),Me()}catch(p){D((p==null?void 0:p.message)||"Failed to unblock user",{variant:"error"})}finally{We(null)}}};d.useEffect(()=>{H==="members"&&le&&t&&Me()},[H,le,t]);const vt=async()=>{if(a&&confirm(`Are you sure you want to delete "${a.name}"? This action cannot be undone.`)){Z(!0);try{await R(E.moddi.queue(t),{method:"DELETE"}),D("Queue deleted",{variant:"success"}),s("/queues")}catch(n){D((n==null?void 0:n.message)||"Failed to delete queue",{variant:"error"})}finally{Z(!1)}}},jt=async n=>{if(!l||!a||l.id!==a.owner_id){D("Only the queue owner can remove members",{variant:"error"});return}if(confirm("Remove this member from the queue?")){ae(n);try{await R(E.moddi.queueMember(t,n),{method:"DELETE"}),D("Member removed",{variant:"success"});const m=r.filter(P=>P.user_id!==n).some(P=>P.user_id!==(a==null?void 0:a.owner_id)&&P.role!=="owner");if(a&&a.is_group===1&&!m)try{await R(E.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after removing last member")}oe()}catch(p){D((p==null?void 0:p.message)||"Failed to remove member",{variant:"error"})}finally{ae(null)}}},wt=async()=>{if(l&&confirm("Leave this queue? You will need to be invited again to rejoin.")){ae(l.id);try{await R(E.moddi.queueMember(t,l.id),{method:"DELETE"}),D("Left queue",{variant:"success"});const p=r.filter(m=>m.user_id!==l.id).some(m=>m.user_id!==(a==null?void 0:a.owner_id)&&m.role!=="owner");if(a&&a.is_group===1&&!p)try{await R(E.moddi.queue(t),{method:"PATCH",body:JSON.stringify({is_group:!1})})}catch{console.warn("Failed to convert queue back to individual after leaving")}s("/queues")}catch(n){D((n==null?void 0:n.message)||"Failed to leave queue",{variant:"error"})}finally{ae(null)}}},St=async n=>{if(confirm("Cancel this invitation?")){ae(n);try{await R(E.moddi.queueMember(t,n),{method:"DELETE"}),D("Invitation canceled",{variant:"success"}),oe()}catch(p){D((p==null?void 0:p.message)||"Failed to cancel invitation",{variant:"error"})}finally{ae(null)}}};return d.useEffect(()=>{if(!$)return;const n=p=>{const m=p.target;m.closest(".manage-overlay")||m.closest(".manage-overlay-backdrop")||!m.closest(".manage-popup")&&qe.current&&!qe.current.contains(m)&&de()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[$]),d.useEffect(()=>{if(!J)return;const n=p=>{const m=p.target;Q.current&&!Q.current.contains(m)&&Ce.current&&!Ce.current.contains(m)&&Y(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[J]),w?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):a?e.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t&&e.jsx(Xt,{queueId:t,onSubmitted:()=>oe()}),e.jsx(Kt,{context:"moddi-queue-detail"}),e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingTop:16},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flex:1,minWidth:0},children:[e.jsx("button",{className:"icon-link hide-on-mobile",onClick:()=>s("/queues"),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:e.jsx(_t,{size:20})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flex:1,minWidth:0},children:[e.jsx("div",{className:"title",style:{flex:1,minWidth:0},children:a.name}),Qe&&e.jsxs("button",{onClick:ht,disabled:pe,className:`queue-status-badge ${a.is_open===1?"status-open":"status-closed"}`,title:a.is_open===1?"Close queue":"Open queue","aria-label":a.is_open===1?"Close queue":"Open queue",children:[a.is_open===1?e.jsx(je,{size:14}):e.jsx(Ee,{size:14}),e.jsx("span",{children:a.is_open===1?"Open":"Closed"})]})]})]}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[le&&e.jsx("button",{ref:qe,className:"icon-link",onClick:ft,style:{width:"auto",height:"auto",padding:"4px"},title:"Manage Queue","aria-label":"Manage Queue",children:e.jsx(Ct,{size:18})}),r.length>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:r.filter(n=>n.joined_at!==null).sort((n,p)=>{const m=n.role==="owner"||n.user_id===(a==null?void 0:a.owner_id),P=p.role==="owner"||p.user_id===(a==null?void 0:a.owner_id);return m&&!P?-1:!m&&P?1:(p.joined_at||0)-(n.joined_at||0)}).map(n=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>N(n.user_id),onMouseLeave:()=>N(null),children:[e.jsx(Ae,{to:`/profile/${n.user_id}`,className:"queue-member-avatar",title:n.username,children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username}):e.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"var(--muted)"},children:n.username.charAt(0).toUpperCase()})}),g===n.user_id&&e.jsxs("div",{className:"queue-member-tooltip",children:[n.username," ",n.role!=="member"?`(${n.role})`:""]})]},n.user_id))})]})]}),a.description&&e.jsx("div",{className:"muted",style:{marginBottom:16,fontSize:14,padding:"0 4px"},children:e.jsx(Pe,{text:a.description})}),a.rules&&e.jsxs("div",{style:{marginBottom:16,padding:12,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:10},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Rules"}),e.jsx(nt,{content:a.rules})]}),a.is_open===0&&e.jsx("div",{style:{marginBottom:12,padding:10,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:10,textAlign:"center",fontSize:14,color:"#f59e0b"},children:"This queue is currently closed for submissions"}),e.jsxs("div",{className:"queue-submit-desktop-only",style:{background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:10,marginBottom:12,opacity:a.is_open===0?.6:1},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",cursor:a.is_open===1?"pointer":"not-allowed",padding:"8px 12px",minHeight:36},onClick:()=>a.is_open===1&&_(!h),children:[e.jsxs("span",{style:{fontWeight:600,fontSize:16,lineHeight:1},children:["Submit a beatmap ",a.is_open===0&&"(Closed)"]}),a.is_open===1&&(h?e.jsx(fe,{size:16}):e.jsx(ke,{size:16}))]}),h&&e.jsx("form",{onSubmit:gt,style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"url",placeholder:"Beatmap URL e.g. https://osu.ppy.sh/beatmapsets/...",value:k,onChange:n=>S(n.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),e.jsx("input",{type:"text",placeholder:"Message (optional, max 100 chars)",value:O,onChange:n=>v(n.target.value.slice(0,100)),maxLength:100,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),O.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:12,textAlign:"right",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[O.length,"/100"]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:n=>{n.stopPropagation(),_(!1)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:C,onClick:n=>n.stopPropagation(),children:C?"Submitting...":"Submit"})]})]})})]}),e.jsxs("div",{className:"profile-tabs-unified",style:{marginTop:24},children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Submission sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"active",onClick:n=>{const p=n.currentTarget.closest(".profile-tabs-unified");p.querySelectorAll(".profile-tab").forEach(P=>{P.classList.remove("active"),P.setAttribute("aria-selected","false")}),n.currentTarget.classList.add("active"),n.currentTarget.setAttribute("aria-selected","true"),p.querySelector(".profile-tabs-content").setAttribute("data-active","active")},children:"Active"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"archived",onClick:n=>{const p=n.currentTarget.closest(".profile-tabs-unified");p.querySelectorAll(".profile-tab").forEach(P=>{P.classList.remove("active"),P.setAttribute("aria-selected","false")}),n.currentTarget.classList.add("active"),n.currentTarget.setAttribute("aria-selected","true"),p.querySelector(".profile-tabs-content").setAttribute("data-active","archived")},children:"Archived"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"active",children:[e.jsx("div",{className:"panel active",children:e.jsx("div",{className:"col",style:{gap:0},children:c.filter(n=>!!!n.is_archived&&xe[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No active submissions."}):c.filter(n=>!!!n.is_archived&&xe[n.status]).map(n=>e.jsx(Le,{submission:n,canManage:!!le,isGroup:(a==null?void 0:a.is_group)===1,onUpdate:$e,onDelete:p=>{y(m=>m.filter(P=>P.id!==p))}},n.id))})}),e.jsx("div",{className:"panel archived",children:e.jsx("div",{className:"col",style:{gap:0},children:c.filter(n=>!!n.is_archived&&xe[n.status]).length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No archived submissions."}):c.filter(n=>!!n.is_archived&&xe[n.status]).map(n=>e.jsx(Le,{submission:n,canManage:!!le,isGroup:(a==null?void 0:a.is_group)===1,onUpdate:$e,onDelete:p=>{y(m=>m.filter(P=>P.id!==p))}},n.id))})})]})]}),$&&we.createPortal(e.jsxs("div",{className:"overlay manage-overlay",children:[e.jsx("div",{className:"overlay-backdrop manage-overlay-backdrop",onClick:de}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:500},children:[e.jsx("button",{className:"overlay-close",onClick:de,"aria-label":"Close",children:e.jsx(fe,{size:18})}),e.jsxs("div",{className:"settings-header",style:{padding:"20px 16px 12px"},children:[e.jsx("div",{className:"settings-title",children:"Manage Queue"}),e.jsx("div",{className:"settings-description",children:"Configure queue settings, rules, and members."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Manage Queue",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Manage Queue tabs",children:[e.jsx("button",{role:"tab","aria-selected":H==="general",className:`profile-tab ${H==="general"?"active":""}`,"data-tab":"general",onClick:n=>{const p=n.currentTarget.closest(".profile-tabs-unified"),m=p==null?void 0:p.querySelector(".profile-tabs-content");m==null||m.setAttribute("data-active","general"),ne("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":H==="rules",className:`profile-tab ${H==="rules"?"active":""}`,"data-tab":"rules",onClick:n=>{const p=n.currentTarget.closest(".profile-tabs-unified"),m=p==null?void 0:p.querySelector(".profile-tabs-content");m==null||m.setAttribute("data-active","rules"),ne("rules")},children:"Rules"}),e.jsx("button",{role:"tab","aria-selected":H==="members",className:`profile-tab ${H==="members"?"active":""}`,"data-tab":"members",onClick:n=>{const p=n.currentTarget.closest(".profile-tabs-unified"),m=p==null?void 0:p.querySelector(".profile-tabs-content");m==null||m.setAttribute("data-active","members"),ne("members")},children:"Members"})]}),e.jsx("div",{className:"profile-tabs-content","data-active":H,children:e.jsxs("form",{onSubmit:bt,className:"col",style:{gap:0},children:[e.jsx("div",{className:"panel general",hidden:H!=="general",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Queue Name"}),e.jsx("input",{type:"text",value:L,onChange:n=>U(n.target.value),required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}})]}),e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Description (optional)"}),e.jsx("textarea",{placeholder:"Description",value:G,onChange:n=>se(n.target.value),rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14,resize:"vertical"}})]}),((l==null?void 0:l.is_mod)||(l==null?void 0:l.is_admin))&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsxs("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Queue Type ",a.owner_id!==(l==null?void 0:l.id)&&e.jsx("span",{style:{fontSize:12,color:"var(--muted)",fontWeight:400},children:"(Mod/Admin only)"})]}),e.jsxs("select",{value:z,onChange:n=>j(n.target.value),style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14},children:[e.jsx("option",{value:"modder",children:"Modder"}),e.jsx("option",{value:"nominator",children:"Nominator"})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs("button",{type:"button",className:"btn secondary",onClick:vt,disabled:B||F,style:{background:"rgba(248, 113, 113, 0.1)",borderColor:"rgba(248, 113, 113, 0.3)",color:"var(--danger)",fontSize:13,padding:"8px 12px"},children:[e.jsx(me,{size:14,style:{marginRight:6}}),B?"Deleting...":"Delete Queue"]}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:de,disabled:F||B,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:F||B,style:{fontSize:13,padding:"8px 16px"},children:F?"Updating...":"Save Changes"})]})]})]})}),e.jsx("div",{className:"panel rules",hidden:H!=="rules",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Rules (optional, markdown supported)"}),e.jsx("textarea",{placeholder:"Rules in markdown format...",value:W,onChange:n=>x(n.target.value),rows:8,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:13,resize:"vertical"}}),W&&e.jsxs("div",{style:{padding:10,background:"var(--panel-dark)",border:"1px solid var(--divider)",borderRadius:8,fontSize:12},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:6,opacity:.8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Preview:"}),e.jsx(nt,{content:W})]})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:de,disabled:F||B,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:F||B,style:{fontSize:13,padding:"8px 16px"},children:F?"Updating...":"Save Changes"})]})]})}),e.jsx("div",{className:"panel members",hidden:H!=="members",children:e.jsxs("div",{className:"col",style:{gap:10,padding:"16px"},children:[e.jsxs("div",{className:"col",style:{gap:6,position:"relative"},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invite Members"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:Q,type:"text",placeholder:"Search username or ID",value:i,onChange:n=>f(n.target.value),onKeyDown:n=>{n.key==="Enter"&&n.preventDefault()},onFocus:()=>{I.length>0&&Y(!0)},style:{width:"100%",background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:10,color:"var(--text)",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontSize:14}}),J&&I.length>0&&e.jsx("div",{ref:Ce,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--divider)",borderRadius:8,maxHeight:300,overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:e.jsx("div",{className:"col",style:{gap:0},children:I.map(n=>{const p=r.some(K=>K.user_id===n.id&&K.joined_at),m=r.some(K=>K.user_id===n.id&&K.invited_at&&!K.joined_at),P=ze.some(K=>K.user_id===n.id);return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"8px 12px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8,minWidth:0},children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:20,height:20,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:8,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:[e.jsx("span",{children:n.username}),p&&e.jsx("span",{style:{color:"var(--muted)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Already a member"}),m&&e.jsx("span",{style:{color:"var(--accent)",fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]}),e.jsxs("div",{className:"muted",style:{fontSize:11,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["id ",n.id," • osu ",n.osu_user_id]})]})]}),le&&!p&&!m&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{className:"icon-link",onClick:K=>{K.stopPropagation(),ee||xt(n.id)},disabled:ee,title:"Invite user",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ot,{size:16})}),e.jsx("button",{className:"icon-link",onClick:K=>{K.stopPropagation(),P?Ue(n.id):yt(n.id)},disabled:Oe||Fe===n.id,title:P?"Unblock user":"Block user",style:{width:"auto",height:"auto",padding:"4px",color:P?"var(--accent)":"var(--danger)"},children:P?e.jsx(je,{size:16}):e.jsx(Ee,{size:16})})]})]},n.id)})})})]})]}),r.length>0&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Members"}),e.jsx("div",{className:"col",style:{gap:4},children:(()=>{const n=r.filter(m=>m.joined_at!==null).sort((m,P)=>{const K=m.role==="owner"||m.user_id===(a==null?void 0:a.owner_id),ye=P.role==="owner"||P.user_id===(a==null?void 0:a.owner_id);return K&&!ye?-1:!K&&ye?1:(P.joined_at||0)-(m.joined_at||0)}),p=r.filter(m=>m.invited_at!==null&&m.joined_at===null);return e.jsxs(e.Fragment,{children:[n.map(m=>{const P=l&&a&&l.id===a.owner_id,K=m.user_id===(l==null?void 0:l.id),ye=m.user_id===(a==null?void 0:a.owner_id)||m.role==="owner";return e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[m.avatar_url&&e.jsx("img",{src:m.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:m.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:m.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:m.role})]})]}),P&&!ye&&e.jsx("button",{className:"icon-link",onClick:()=>jt(m.user_id),disabled:X===m.user_id,title:"Remove member",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(me,{size:16})}),!P&&K&&e.jsx("button",{className:"icon-link",onClick:wt,disabled:X===m.user_id,title:"Leave queue",style:{width:"auto",height:"auto",padding:"4px",color:"var(--muted)"},children:e.jsx(qt,{size:16})})]},m.user_id)}),p.length>0&&e.jsx(e.Fragment,{children:p.map(m=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",opacity:.7},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[m.avatar_url&&e.jsx("img",{src:m.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:m.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:m.username}),e.jsx("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Invited"})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>St(m.user_id),disabled:X===m.user_id,title:"Cancel invitation",style:{width:"auto",height:"auto",padding:"4px",color:"var(--danger)"},children:e.jsx(fe,{size:16})})]},m.user_id))})]})})()})]}),le&&e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("label",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"Blocked Users"}),ze.length===0?e.jsx("div",{className:"muted",style:{fontSize:12,padding:"8px 0",fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:"No blocked users"}):e.jsx("div",{className:"col",style:{gap:4},children:ze.map(n=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flex:1,minWidth:0},children:[n.avatar_url&&e.jsx("img",{src:n.avatar_url,width:32,height:32,style:{borderRadius:"50%"},alt:n.username}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:500,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:n.username}),n.blocked_by_username&&e.jsxs("div",{className:"muted",style:{fontSize:12,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif"},children:["Blocked by ",n.blocked_by_username]})]})]}),e.jsx("button",{className:"icon-link",onClick:()=>Ue(n.user_id),disabled:Fe===n.user_id,title:"Unblock user",style:{width:"auto",height:"auto",padding:"4px",color:"var(--accent)"},children:e.jsx(je,{size:16})})]},n.user_id))})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end",marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:de,disabled:F||B,style:{fontSize:13,padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:F||B,style:{fontSize:13,padding:"8px 16px"},children:F?"Updating...":"Save Changes"})]})]})})]})})]})]})]}),document.body),e.jsx("style",{children:`
        /* Hide inline submit form on mobile – mobile uses floating FAB instead */
        html.is-mobile .queue-submit-desktop-only {
          display: none;
        }

        .queue-member-avatar {
          width: 32px;
          height: 32px;
          border-radius: 9999px;
          padding: 0;
          border: 1px solid rgba(255,255,255,0.08);
          overflow: hidden;
          cursor: pointer;
          background: transparent;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          transition: border-color 0.2s;
        }
        .queue-member-avatar:hover {
          border-color: rgba(167, 139, 250, 0.4);
        }
        .queue-member-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .queue-member-tooltip {
          position: absolute;
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .queue-member-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid rgba(18, 20, 24, 0.95);
        }
        .queue-status-badge {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
          border: 1px solid;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }
        .queue-status-badge:disabled {
          cursor: not-allowed;
          opacity: 0.6;
        }
        .queue-status-badge.status-open {
          background: rgba(52, 211, 153, 0.15);
          border-color: rgba(52, 211, 153, 0.4);
          color: #34d399;
        }
        .queue-status-badge.status-open:hover:not(:disabled) {
          background: rgba(52, 211, 153, 0.25);
          border-color: rgba(52, 211, 153, 0.5);
        }
        .queue-status-badge.status-closed {
          background: rgba(245, 158, 11, 0.15);
          border-color: rgba(245, 158, 11, 0.4);
          color: #f59e0b;
        }
        .queue-status-badge.status-closed:hover:not(:disabled) {
          background: rgba(245, 158, 11, 0.25);
          border-color: rgba(245, 158, 11, 0.5);
        }
      `})]}):e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Queue not found"})}function gs(){const{data:t=[],isLoading:s}=Qt(),a=$t(),u=Ut(),{notify:r}=ue(),o=rt(),c=be(),[y,w]=d.useState(new Set),{data:T}=Ne(),[l,b]=d.useState(!1),[h,_]=d.useState(!1),[C,q]=d.useState(!1),k=d.useRef(null),S=d.useRef(null),O=!!(T!=null&&T.is_admin||T!=null&&T.is_mod);Ht(k,S,l,()=>b(!1));const v=async x=>{a.mutate(x,{onSuccess:()=>{}})},g=async x=>{x.startsWith("n:")&&u.mutate(x)},N=async()=>{const x=t.filter(z=>!z.read&&(z.id.startsWith("n:")||z.kind==="system"&&!z.id.startsWith("b:"))).map(z=>z.id);x.length>0&&(await v(x),r("All notifications marked as read",{variant:"success"}))},$=x=>{if(!x)return null;try{const z=JSON.parse(x);if((z==null?void 0:z.type)==="queue_invite"&&(z!=null&&z.queue_id))return z}catch{}return null},M=async(x,z)=>{if(!y.has(x.id)){w(j=>new Set(j).add(x.id));try{await R(E.moddi.queueAccept(String(z)),{method:"POST"}),r("Invitation accepted!",{variant:"success"}),g(x.id),o(`/queues/${z}`)}catch(j){r((j==null?void 0:j.message)||"Failed to accept invitation",{variant:"error"})}finally{w(j=>{const B=new Set(j);return B.delete(x.id),B})}}},L=async(x,z)=>{if(!y.has(x.id)){w(j=>new Set(j).add(x.id));try{await R(E.moddi.queueDeny(String(z)),{method:"POST"}),r("Invitation declined",{variant:"success"}),g(x.id)}catch(j){r((j==null?void 0:j.message)||"Failed to decline invitation",{variant:"error"})}finally{w(j=>{const B=new Set(j);return B.delete(x.id),B})}}},U=x=>$(x.text)?e.jsx(ot,{size:20,color:"#a78bfa"}):x.kind==="star"?e.jsx(Ke,{size:20,color:"#f59e0b"}):x.kind==="likes5"?e.jsx(Ve,{size:20,color:"#f472b6"}):x.kind==="comment"?e.jsx(ge,{size:20,color:"#60a5fa"}):x.kind==="inspiration"?e.jsx(ge,{size:20,color:"#7dd3fc"}):x.kind==="reaction"?e.jsx(Ze,{size:20,color:"#10b981"}):x.id.startsWith("b:")?e.jsx(et,{size:20,color:"#a78bfa"}):null,G=x=>$(x.text)?"Queue Invitation":x.kind==="star"?"Star":x.kind==="likes5"?"Likes":x.kind==="comment"?"Comment":x.kind==="inspiration"?"Inspiration":x.kind==="reaction"?"Reaction":x.id.startsWith("b:")?"Global":"System",se=t.filter(x=>!x.read&&!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).length,W=async x=>{if(!(!(T!=null&&T.id)||C)){q(!0);try{const z={kind:x};x==="system"&&(z.text="Test system notification"),await R(E.admin.notificationsTest,{method:"POST",body:JSON.stringify(z)}),r("Test notification sent",{variant:"success"}),c.invalidateQueries({queryKey:["notifications","detailed"]}),c.invalidateQueries({queryKey:["notifications"]})}catch(z){r((z==null?void 0:z.message)||"Failed to send test notification",{variant:"error"})}finally{q(!1),b(!1),_(!1)}}};return e.jsxs("div",{className:"feed-container moddi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsx("div",{className:"feed-header",children:e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"title",children:"Notifications"}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[O&&e.jsxs("div",{style:{position:"relative"},className:"hide-on-mobile",children:[e.jsxs("button",{ref:k,className:"btn secondary",onClick:()=>b(!l),disabled:C,style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Xe,{size:14}),e.jsx("span",{children:"Test"}),e.jsx(ce,{size:14,style:{transition:"transform 0.2s ease",transform:l?"rotate(180deg)":"rotate(0deg)"}})]}),l&&e.jsxs("div",{ref:S,className:"menu-panel",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:8,minWidth:180,zIndex:1e3},children:[e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("star"),disabled:C,children:"Test Star"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("likes5"),disabled:C,children:"Test Likes"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("comment"),disabled:C,children:"Test Comment"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("inspiration"),disabled:C,children:"Test Inspiration"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("reaction"),disabled:C,children:"Test Reaction"}),e.jsx("button",{className:"menu-item",type:"button",onClick:()=>W("system"),disabled:C,children:"Test System"})]})]}),se>0&&e.jsxs("button",{className:"btn secondary",onClick:N,children:[e.jsx(Je,{size:16,style:{marginRight:6}}),"Mark all read"]})]})]})}),O&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Test notification",title:"Test notification",onClick:()=>_(!0),children:e.jsx(Xe,{size:22})}),e.jsx(Be,{open:h,onClose:()=>_(!1),children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{marginBottom:4},children:"Send Test Notification"}),e.jsx("div",{className:"muted",style:{fontSize:13,marginBottom:8},children:"Send a test notification to yourself to preview how it appears."}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsxs("button",{className:"btn secondary",onClick:()=>W("star"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ke,{size:18,color:"#f59e0b"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Star"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts was starred!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("likes5"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ve,{size:18,color:"#f472b6"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Likes"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"One of your posts reached 5 likes!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("comment"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(ge,{size:18,color:"#60a5fa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Comment"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone commented on your post"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("inspiration"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(ge,{size:18,color:"#7dd3fc"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Inspiration"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone is inspired by you!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("reaction"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Ze,{size:18,color:"#10b981"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"Reaction"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Someone raised their hand on your post!"})]})]}),e.jsxs("button",{className:"btn secondary",onClick:()=>W("system"),disabled:C,style:{width:"100%",justifyContent:"flex-start",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(et,{size:18,color:"#a78bfa"}),e.jsxs("div",{className:"col",style:{gap:2,alignItems:"flex-start",flex:1},children:[e.jsx("span",{style:{fontWeight:500},children:"System"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Test system notification"})]})]})]})]})})]}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:s?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):t.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No notifications yet."}):e.jsx("div",{className:"col",style:{gap:0},children:t.filter(x=>!(x.id.startsWith("b:")&&x.expiresAt&&x.expiresAt<=Date.now())).map(x=>{const z=({notif:j})=>{const[B,Z]=d.useState(0),[pe,re]=d.useState(!1),H=d.useRef(null),ne=d.useRef(null),F=d.useRef(null),te=d.useRef(null),ee=f=>{j.id.startsWith("n:")&&(H.current=f.touches[0].clientX,te.current=f.touches[0].clientY,ne.current=Date.now(),re(!1))},ie=f=>{if(H.current===null||te.current===null||!j.id.startsWith("n:"))return;const I=f.touches[0].clientX,A=f.touches[0].clientY,J=I-H.current,Y=Math.abs(A-te.current);Math.abs(J)>Y&&(re(!0),Z(Math.max(-80,Math.min(0,J))))},X=()=>{if(H.current===null)return;B<=-60&&g(j.id),Z(0),re(!1),H.current=null,te.current=null,ne.current=null},ae=j.id.startsWith("n:"),i=typeof j.targetPath=="string"&&j.targetPath.trim().length>0?j.targetPath.trim():null;return e.jsxs("div",{ref:F,style:{position:"relative",background:j.read?"var(--panel-dark)":"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",padding:16,cursor:i?"pointer":"default",opacity:j.read?.7:1,transform:`translateX(${B}px)`,transition:pe?"none":"transform 0.2s ease",touchAction:ae?"pan-x pan-y":"pan-y"},onTouchStart:ee,onTouchMove:ie,onTouchEnd:X,onTouchCancel:X,onClick:()=>{if(!(Math.abs(B)>10)){if(!j.read&&j.id.startsWith("n:")&&v([j.id]),i){o(i);return}j.videoId&&(window.location.hash="/feed")}},children:[ae&&e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:80,background:"#f87171",display:"flex",alignItems:"center",justifyContent:"center",opacity:Math.abs(B)/80,pointerEvents:"none",zIndex:0},children:e.jsx(me,{size:20,color:"#fff"})}),e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,position:"relative",zIndex:1},children:[e.jsx("div",{style:{width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:U(j)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsx("strong",{style:{fontSize:14},children:G(j)}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(j.createdAt).toLocaleDateString()}),j.id.startsWith("n:")&&e.jsx("button",{className:"icon-link hide-on-mobile",onClick:f=>{f.stopPropagation(),g(j.id)},style:{padding:4},children:e.jsx(me,{size:14})})]})]}),e.jsx("div",{style:{fontSize:14,wordBreak:"break-word"},children:(()=>{const f=$(j.text);return f?`${f.inviter_username} invited you to join queue: ${f.queue_name}`:j.text||(j.kind==="star"?"One of your posts was starred!":j.kind==="likes5"?"One of your posts reached 5 likes!":j.kind==="comment"?"Someone commented on your post":j.kind==="inspiration"?"Someone is inspired by you!":j.kind==="reaction"?"Someone raised their hand on your post!":"")})()}),(()=>{const f=$(j.text);return f&&!y.has(j.id)?e.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[e.jsxs("button",{className:"btn",onClick:I=>{I.stopPropagation(),M(j,f.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(Je,{size:14,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:I=>{I.stopPropagation(),L(j,f.queue_id)},style:{fontSize:13,padding:"6px 12px"},children:[e.jsx(fe,{size:14,style:{marginRight:4}}),"Decline"]})]}):f&&y.has(j.id)?e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8},children:"Processing..."}):null})(),j.read&&j.readAt&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["Read ",new Date(j.readAt).toLocaleString()]})]})]})]},j.id)};return e.jsx(z,{notif:x},x.id)})})})]})}function Vt({tabs:t,activeTab:s,onChange:a,rightAction:u}){return e.jsxs("div",{className:"tab-header",style:{display:"flex",background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",position:"relative"},children:[t.map((r,o)=>{const c=r.id===s,y=o===t.length-1;return e.jsxs("button",{onClick:()=>a(r.id),style:{flex:1,padding:"14px 16px",background:"transparent",border:"none",borderRight:!y||u?"1px solid rgba(255,255,255,0.08)":"none",color:c?"var(--text)":"var(--muted)",fontWeight:c?600:400,fontSize:14,fontFamily:"inherit",cursor:"pointer",transition:"all 0.15s ease",position:"relative"},onMouseEnter:w=>{c||(w.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:w=>{w.currentTarget.style.backgroundColor="transparent"},children:[r.label,c&&e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:"var(--accent, #667eea)",borderRadius:"2px 2px 0 0"}})]},r.id)}),u&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:u})]})}const Re={modding:{bg:"rgba(255, 255, 255, 0.1)",color:"var(--muted)",border:"1px solid rgba(255, 255, 255, 0.1)"},timing:{bg:"rgba(239, 68, 68, 0.12)",color:"#e57373",border:"1px solid rgba(239, 68, 68, 0.2)"},audio:{bg:"rgba(34, 197, 94, 0.12)",color:"#81c784",border:"1px solid rgba(34, 197, 94, 0.2)"},nominator:{bg:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",border:"1px solid rgba(139, 92, 246, 0.3)"},subdivision:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"},subdivisions:{bg:"rgba(250, 204, 21, 0.12)",color:"#e6d98a",border:"1px solid rgba(250, 204, 21, 0.2)"}},Zt=["nominator","subdivision","subdivisions"];function es({queue:t}){const a=(t.tags||t.type||"modding").split(",").map(o=>o.trim().toLowerCase()).filter(Boolean).map(o=>o==="modder"?"modding":o==="subdivisions"?"subdivision":o),u=a.find(o=>Zt.includes(o)),r=u?[u==="subdivisions"?"subdivision":u]:a.filter(o=>Re[o]);return e.jsx(Ae,{to:`/queues/${t.id}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)",transition:"background-color 0.15s ease",cursor:"pointer",position:"relative"},onMouseEnter:o=>o.currentTarget.style.background="rgba(255,255,255,0.04)",onMouseLeave:o=>o.currentTarget.style.background="var(--panel)",children:[e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:4,flexWrap:"wrap",justifyContent:"flex-end",maxWidth:"50%"},children:r.map(o=>{const c=Re[o]||Re.modding;return e.jsx("span",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",borderRadius:4,background:c.bg,color:c.color,border:c.border},children:o},o)})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,marginBottom:8},children:[t.is_group?e.jsx(Ft,{size:18}):e.jsx(ge,{size:18}),e.jsx("strong",{style:{fontSize:16},children:t.name}),(t.is_open??1)===1?e.jsx(je,{size:18,style:{color:"#10b981"}}):e.jsx(Ee,{size:18,style:{color:"#ef4444"}})]}),t.description&&e.jsx("div",{className:"muted",style:{fontSize:14,marginBottom:8},children:e.jsx(Pe,{text:t.description})}),e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,fontSize:12},children:[t.owner_avatar_url&&e.jsx("img",{src:t.owner_avatar_url,width:20,height:20,style:{borderRadius:"50%"}}),e.jsxs("span",{className:"muted",children:["by ",t.owner_username,(()=>{const o=t.member_count||0;return o===0?null:o===1&&t.first_member_username?` and ${t.first_member_username}`:o>1?` & ${o} others`:null})()]}),e.jsx("span",{className:"muted",children:"•"}),e.jsx("span",{className:"muted",children:new Date(t.created_at*1e3).toLocaleDateString()})]})]})})}function ts({isOpen:t,onClose:s,anchorRef:a}){const{notify:u}=ue(),{data:r}=Ne(),{data:o=[]}=_e(),c=mt(),[y,w]=d.useState(""),[T,l]=d.useState(""),[b,h]=d.useState(["modding"]),_=d.useRef(null),C=r?o.some(v=>v.owner_id===r.id):!1,q=(r==null?void 0:r.is_admin)||(r==null?void 0:r.is_mod);d.useEffect(()=>{if(!t)return;const v=g=>{const N=g.target;_.current&&!_.current.contains(N)&&(a!=null&&a.current)&&!a.current.contains(N)&&s()};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[t,s,a]);const k=v=>{if(Ie.includes(v)){b.includes(v)?h(["modding"]):h([v]);return}const g=b.filter(N=>at.includes(N));if(g.includes(v)){const N=g.filter($=>$!==v);if(N.length===0)return;h(N)}else h([...g,v])},S=async v=>{if(v.preventDefault(),C){u("You can only create one queue",{variant:"error"});return}if(!y.trim()){u("Queue name is required",{variant:"error"});return}c.mutate({name:y.trim(),description:T.trim()||null,is_group:!1,tags:b.join(",")},{onSuccess:()=>{u("Queue created!",{variant:"success"}),s(),w(""),l(""),h(["modding"])},onError:g=>{u((g==null?void 0:g.message)||"Failed to create queue",{variant:"error"})}})};if(!t)return null;const O=b.some(v=>Ie.includes(v));return e.jsx("div",{ref:_,className:"create-queue-dropdown",style:{position:"absolute",top:"100%",right:0,width:"320px",background:"var(--panel)",borderLeft:"1px solid rgba(255,255,255,0.08)",borderRight:"1px solid rgba(255,255,255,0.08)",borderBottom:"1px solid rgba(255,255,255,0.08)",zIndex:100},children:C?e.jsx("div",{style:{padding:"16px"},children:e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."})}):e.jsx("form",{onSubmit:S,style:{padding:"16px"},children:e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:y,onChange:v=>w(v.target.value),maxLength:100,required:!0,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,outline:"none"}}),e.jsx("textarea",{placeholder:"Description (optional)",value:T,onChange:v=>l(v.target.value),maxLength:500,rows:2,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"10px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",outline:"none"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Queue Type"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:at.map(v=>{const g=b.includes(v),N=O;return e.jsx("button",{type:"button",onClick:()=>k(v),disabled:N,style:{background:g?"rgba(102, 126, 234, 0.2)":"rgba(255,255,255,0.05)",border:g?"1px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:g?"#667eea":N?"var(--muted)":"var(--text)",cursor:N?"not-allowed":"pointer",transition:"all 0.15s",fontWeight:g?500:400,opacity:N?.5:1,textTransform:"capitalize"},children:v},v)})}),q&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:10,color:"var(--muted)",marginTop:10,marginBottom:6,fontWeight:500},children:"Admin Only"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:Ie.map(v=>{const g=b.includes(v);return e.jsx("button",{type:"button",onClick:()=>k(v),style:{background:g?"rgba(139, 92, 246, 0.2)":"rgba(255,255,255,0.05)",border:g?"1px solid #a78bfa":"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"4px 10px",fontSize:12,color:g?"#a78bfa":"var(--text)",cursor:"pointer",transition:"all 0.15s",fontWeight:g?500:400,textTransform:"capitalize"},children:v},v)})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:4},children:[e.jsx("button",{type:"button",onClick:s,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",borderRadius:0,padding:"8px 16px",color:"var(--muted)",fontSize:13,cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c.isPending||!y.trim(),style:{background:y.trim()?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:0,padding:"8px 16px",color:"#fff",fontWeight:600,fontSize:13,cursor:y.trim()?"pointer":"not-allowed"},children:c.isPending?"Creating...":"Create"})]})]})})})}function ss(){const[t,s]=V.useState(!1),[a,u]=V.useState(""),[r,o]=V.useState(""),{data:c=[]}=_e(),{data:y}=Ne(),{notify:w}=ue(),T=mt(),l=V.useMemo(()=>y?c.some(h=>h.owner_id===y.id):!1,[y,c]),b=h=>{if(h&&h.preventDefault(),l){w("You can only create one queue. You can join other queues as a member.",{variant:"error"});return}if(!a.trim()){w("Queue name is required",{variant:"error"});return}T.mutate({name:a.trim(),description:r.trim()||null,is_group:!1},{onSuccess:()=>{w("Queue created!",{variant:"success"}),s(!1),u(""),o("")},onError:_=>{w((_==null?void 0:_.message)||"Failed to create queue",{variant:"error"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-fab","aria-label":"Create queue",title:"Create queue",onClick:()=>s(!0),children:e.jsx(ke,{size:22})}),e.jsx(Be,{open:t,onClose:()=>s(!1),children:e.jsxs("form",{onSubmit:b,className:"col",style:{gap:12},children:[l?e.jsx("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:"You already own a queue. You can join other queues as a member, but you can only create one queue."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Queue name",value:a,onChange:h=>u(h.target.value),maxLength:100,required:!0,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14}}),e.jsx("textarea",{placeholder:"Description (optional)",value:r,onChange:h=>o(h.target.value),maxLength:500,rows:3,style:{background:"var(--bg)",border:"1px solid var(--border)",borderRadius:8,padding:12,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical"}})]}),e.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn",disabled:T.isPending||l,children:T.isPending?"Creating...":"Create"})]})]})})]})}const as=({context:t})=>{const s=it(),{tagFilters:a,setTagFilters:u,queueTypeFilters:r,setQueueTypeFilters:o,queueStatusFilters:c,setQueueStatusFilters:y}=Te(),w=V.useMemo(()=>{if(t)return t;const k=s.pathname;return k==="/feed"?"unified-feed":k==="/mp/feed"?"mappi-feed":k==="/md/feed"?"moddi-feed":k==="/queues"||k==="/md/queues"?"moddi-queues":k.startsWith("/queues/")||k.startsWith("/md/queues/")?"moddi-queue-detail":"unified-feed"},[t,s.pathname]),T=k=>{const S={...a,[k]:!a[k]};!S.untagged&&!S.help&&!S.showcase&&!S.request&&(S.untagged=!0),u(S);try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}},l=k=>{const S={...r,[k]:!r[k]};!S.modder&&!S.nominator&&!S.timing&&!S.audio&&(S.modder=!0),o(S)},b=k=>{const S={...c,[k]:!c[k]};["unchecked","accepted","denied","finished"].some(v=>S[v])||(S.unchecked=!0),y(S)},h=({active:k,onClick:S,label:O})=>e.jsx("button",{type:"button",onClick:S,className:"desktop-filter-chip","aria-pressed":k,"data-active":k,children:O}),_=w==="unified-feed"||w==="moddi-feed",C=w==="moddi-queues",q=w==="moddi-queue-detail";return e.jsxs("div",{className:"desktop-filter-bar",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(h,{active:a.untagged,onClick:()=>T("untagged"),label:"untagged"}),e.jsx(h,{active:a.help,onClick:()=>T("help"),label:"help"}),e.jsx(h,{active:a.showcase,onClick:()=>T("showcase"),label:"showcase"}),e.jsx(h,{active:a.request,onClick:()=>T("request"),label:"request"})]}),C&&e.jsxs(e.Fragment,{children:[e.jsx(h,{active:r.modder,onClick:()=>l("modder"),label:"modding"}),e.jsx(h,{active:r.nominator,onClick:()=>l("nominator"),label:"bn/subdivision"}),e.jsx(h,{active:r.timing,onClick:()=>l("timing"),label:"timing"}),e.jsx(h,{active:r.audio,onClick:()=>l("audio"),label:"audio"})]}),q&&e.jsxs(e.Fragment,{children:[e.jsx(h,{active:c.unchecked,onClick:()=>b("unchecked"),label:"pending"}),e.jsx(h,{active:c.accepted,onClick:()=>b("accepted"),label:"accepted"}),e.jsx(h,{active:c.denied,onClick:()=>b("denied"),label:"denied"}),e.jsx(h,{active:c.finished,onClick:()=>b("finished"),label:"finished"})]})]})},ns=[{id:"queues",label:"Queues"},{id:"submissions",label:"Submissions"}];function fs(){const[t,s]=Mt(),a=t.get("tab")||"queues",[u,r]=d.useState(a),{data:o=[],isLoading:c}=_e(),{data:y}=Ne(),{queueTypeFilters:w}=Te(),{notify:T}=ue(),[l,b]=d.useState(!1),h=d.useRef(null),[_,C]=d.useState([]),[q,k]=d.useState(!1);d.useEffect(()=>{u==="submissions"&&S()},[u]);const S=async()=>{try{k(!0);const M=await R(E.moddi.mySubmissions);C(M.items)}catch(M){console.error(M),T("Failed to load submissions",{variant:"error"})}finally{k(!1)}},O=M=>{r(M),s(M==="queues"?{}:{tab:M})},v=d.useMemo(()=>o.filter(L=>{const U=L.type||"modder";return U==="modder"&&w.modder||(U==="nominator"||U==="subdivision")&&w.nominator||U==="timing"&&w.timing||U==="audio"&&w.audio}).sort((L,U)=>{const G=(L.is_open??1)===1,se=(U.is_open??1)===1;return G&&!se?-1:!G&&se?1:0}),[o,w]),g=M=>{C(L=>L.map(U=>U.id===M.id?{...U,...M}:U))},N=M=>{C(L=>L.filter(U=>U.id!==M))},$=e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:h,onClick:()=>b(!l),style:{width:48,height:"100%",minHeight:48,background:l?"rgba(255,255,255,0.05)":"transparent",border:"none",color:"var(--text)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},onMouseEnter:M=>{l||(M.currentTarget.style.backgroundColor="rgba(255,255,255,0.02)")},onMouseLeave:M=>{l||(M.currentTarget.style.backgroundColor="transparent")},title:"Create queue",children:e.jsx(ke,{size:18})}),e.jsx(ts,{isOpen:l,onClose:()=>b(!1),anchorRef:h})]});return e.jsxs("div",{className:"feed-container unified-queues",style:{width:"100%",maxWidth:"600px",margin:"0 auto",marginTop:0},children:[e.jsx(Vt,{tabs:ns,activeTab:u,onChange:O,rightAction:$}),u==="queues"&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"60px"},children:e.jsx("div",{className:"col",style:{gap:0},children:c?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."}):v.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No queues match the selected filter."}):v.map(M=>e.jsx(es,{queue:M},M.id))})}),e.jsx(as,{context:"moddi-queues"})]}),u==="submissions"&&e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:q?e.jsx("div",{className:"muted",style:{padding:32,textAlign:"center"},children:"Loading..."}):_.length===0?e.jsxs("div",{style:{padding:32,textAlign:"center"},children:[e.jsx("div",{className:"muted",children:"You haven't submitted to any queues yet."}),e.jsx("button",{className:"btn",style:{marginTop:16},onClick:()=>O("queues"),children:"Browse Queues"})]}):e.jsx("div",{className:"col",style:{gap:0},children:_.map(M=>e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"var(--panel)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",style:{fontSize:13},children:"Submitted to"}),e.jsx(Ae,{to:`/queues/${M.queue_id}`,style:{fontWeight:600,color:"var(--text)",textDecoration:"none",fontSize:14},onMouseEnter:L=>L.currentTarget.style.textDecoration="underline",onMouseLeave:L=>L.currentTarget.style.textDecoration="none",children:M.queue_name}),M.queue_type==="nominator"&&e.jsx("span",{style:{fontSize:10,background:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",padding:"2px 6px",borderRadius:4,fontWeight:600,border:"1px solid rgba(139, 92, 246, 0.3)"},children:"NOMINATOR"})]}),e.jsx("span",{className:"muted",style:{fontSize:12},children:new Date(M.created_at*1e3).toLocaleDateString()})]}),e.jsx(Le,{submission:M,canManage:!1,allowSelfActions:!0,onUpdate:g,onDelete:N})]},M.id))})})]})}export{E as A,as as D,Yt as F,gs as N,Pe as O,ps as Q,Vt as T,fs as U,cs as a,Ne as b,ue as c,R as d,Ht as e,us as f,Wt as g,ms as h,$t as i,Ut as j,ct as k,Qt as l,lt as m,ls as n,Dt as o,os as p,ds as q,Te as u};
