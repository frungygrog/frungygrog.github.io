import{r as t,j as s,Z as W}from"./vendor-react-_vsaDC62.js";import{H as m}from"./vendor-DBgzFpze.js";const F=({playbackUrl:d,streamUID:l,aspectRatio:r,preferNative:a=!1,autoplay:c=!1,loop:L=!1,muted:x=!1,controls:b=!0,onVideoRef:f,onClick:M})=>{const[o,h]=t.useState(1.7777777777777777),E=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches;t.useEffect(()=>{if(!E)return;const e=()=>h(window.innerWidth/Math.max(1,window.innerHeight));return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[E]);const v=t.useRef(null),[P,R]=t.useState(null),S=t.useMemo(()=>{const e=1.3333333333333333,i=16/9,p=typeof r=="number"&&isFinite(r)&&r>0?r:null;if(p)return Math.min(i,Math.max(e,p));const y=E?o:16/9;return Math.min(i,Math.max(e,y))},[E,o,r]),j=`${P??S} / 1`,u=t.useMemo(()=>a?d||(l?`https://videodelivery.net/${l}/manifest/video.m3u8`:null):null,[a,d,l]);t.useEffect(()=>{R(null)},[u]),t.useEffect(()=>{if(!a||!v.current)return;const e=v.current;let i=!1;const p=()=>{if(!i)if(e.videoWidth>0&&e.videoHeight>0){const y=e.videoWidth/e.videoHeight,n=4/3,w=16/9,g=Math.min(w,Math.max(n,y));R(g),i=!0}else R(S),i=!0};return e.addEventListener("loadedmetadata",p),e.readyState>=1&&p(),()=>{e.removeEventListener("loadedmetadata",p)}},[a,S,u]),t.useEffect(()=>{if(!a||!u)return;let e=null,i=null;const y=setTimeout(()=>{const n=v.current;n&&(n.canPlayType("application/vnd.apple.mpegurl")?(n.src=u,i=()=>{console.warn("Native HLS playback failed")},n.addEventListener("error",i),c&&n.play().catch(w=>{console.debug("Autoplay prevented:",w)})):m.isSupported()?(e=new m({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90}),e.loadSource(u),e.attachMedia(n),e.on(m.Events.MANIFEST_PARSED,()=>{c&&n.play().catch(w=>{console.debug("Autoplay prevented:",w)})}),e.on(m.Events.ERROR,(w,g)=>{if(g.fatal)switch(g.type){case m.ErrorTypes.NETWORK_ERROR:console.warn("HLS network error, trying to recover..."),e==null||e.startLoad();break;case m.ErrorTypes.MEDIA_ERROR:console.warn("HLS media error, trying to recover..."),e==null||e.recoverMediaError();break;default:console.error("HLS fatal error:",g),e==null||e.destroy(),e=null;break}})):console.error("HLS is not supported in this browser"))},0);return()=>{clearTimeout(y);const n=v.current;e&&(e.destroy(),e=null),n&&(i&&n.removeEventListener("error",i),n.src="")}},[a,u,c]),t.useEffect(()=>{f&&f(v.current)},[f,a,u]);const k="100%",H=E?{width:"100%",maxWidth:k,maxHeight:"100%",aspectRatio:j,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"}:{width:"auto",maxWidth:k,maxHeight:"100%",height:"var(--player-height)",aspectRatio:j,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box"};if(a&&u)return s.jsx("div",{style:H,children:s.jsx("video",{ref:v,autoPlay:c,loop:L,muted:x,controls:b,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:M?"pointer":"default"},children:"Your browser does not support the video tag."},u)});if(l){const e=`https://iframe.videodelivery.net/${l}`;return s.jsx(s.Fragment,{children:s.jsx("div",{style:H,children:s.jsx("iframe",{src:e,title:"Clip",allow:"autoplay; encrypted-media; picture-in-picture; fullscreen",allowFullScreen:!0,style:{flex:1,width:"100%",height:"100%",border:0}},l)})})}return d?s.jsx("div",{style:H,children:s.jsx("video",{controls:!0,style:{width:"100%",height:"100%"},poster:void 0,children:s.jsx("source",{src:d,type:"application/x-mpegURL"})})}):s.jsx("div",{children:"No video"})},O=({open:d,onClose:l,buttonRef:r,children:a,align:c="right",minWidth:L=160})=>{const[x,b]=t.useState(null),f=t.useRef(null);if(t.useEffect(()=>{if(!d||!r.current){b(null);return}const o=()=>{if(!r.current)return;const h=r.current.getBoundingClientRect();b({top:h.bottom+8,[c]:window.innerWidth-h[c==="right"?"right":"left"]})};return o(),window.addEventListener("resize",o),window.addEventListener("scroll",o,!0),()=>{window.removeEventListener("resize",o),window.removeEventListener("scroll",o,!0)}},[d,r,c]),t.useEffect(()=>{if(!d)return;const o=h=>{f.current&&!f.current.contains(h.target)&&r.current&&!r.current.contains(h.target)&&l()};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[d,l,r]),!d||!x)return null;const M=s.jsx("div",{ref:f,style:{position:"fixed",top:x.top,[c]:x[c],background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:L,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:a});return W.createPortal(M,document.body)};export{F as P,O as a};
