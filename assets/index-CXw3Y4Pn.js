var Pt=Object.defineProperty;var Wt=(t,o,a)=>o in t?Pt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a;var mt=(t,o,a)=>Wt(t,typeof o!="symbol"?o+"":o,a);import{r as s,j as e,e as _e,u as We,R as M,q as jt,d as Ge,T as Ht,U as pt,V as Bt,L as K,W as qt,X as $t,Y as wt,Z as Ut,_ as ht,O as Xe,K as Ot,A as Nt,h as kt,C as ft,P as Qt,Q as Yt,G as Vt,c as et,I as Jt,l as St,$ as Gt,a0 as xt,z as Kt,v as Xt,b as Zt,a as es,i as Ct,g as Et,k as Ze,a1 as ts,a2 as gt,o as ss,x as is,a3 as ns,a4 as as,a5 as rs,a6 as os,a7 as ce}from"./vendor-react-V9Mw-rcO.js";import{y as ls}from"./vendor-g_lea8l6.js";import{u as He,a as D,A as I,c as Oe,P as cs,b as Ee,d as ds,C as us,T as ms,e as ps}from"./mappi-routes-DBXozM_t.js";import{u as Te,a as _t,b as Fe,c as hs,d as fs,e as xs,f as gs,g as bs,C as ys,M as vs,h as js,P as ws,Q as Ns,i as ks,N as Ss}from"./moddi-routes-Dfl2eoxp.js";import{b as Cs,a as Es,i as _s,c as Ts,H as Ms}from"./editor-components-ZRaFjEC_.js";import{B as Is,s as Ls,E as zs}from"./editor-TkUYr02O.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-xKTA8wUT.js";import"./vendor-zip-B5HPL19-.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const d of h)if(d.type==="childList")for(const b of d.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function a(h){const d={};return h.integrity&&(d.integrity=h.integrity),h.referrerPolicy&&(d.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?d.credentials="include":h.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(h){if(h.ep)return;h.ep=!0;const d=a(h);fetch(h.href,d)}})();const Rs=new ls({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class As extends s.Component{constructor(a){super(a);mt(this,"handleRetry",()=>{const a=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),a&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,l){console.error("ErrorBoundary caught an error:",a,l)}isChunkLoadingError(a){if(!a)return!1;const l=a.message.toLowerCase();return l.includes("loading chunk")||l.includes("failed to load")||l.includes("chunk load failed")||l.includes("loading css chunk")||a.name==="ChunkLoadError"}render(){var a;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const l=this.isChunkLoadingError(this.state.error),h=((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:l?"Failed to load page. This might be a network issue.":h}),l&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:l?"Reload Page":"Try Again"}),!l&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const ye=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Fs({i:t}){const o=t*1337,a=(A,x)=>{const v=Math.sin(o+A+x)*1e4,g=v-Math.floor(v);return Math.floor(g*(x-A+1)+A)},l=a(0,100),h=a(24,50),d=.7+a(0,100)/100*.3,b=h*d,S=a(0,4e3),y=a(-10,10),_=a(-8,8),f=a(0,100),E=f<60?1:f<80?1.5:2,L=[{size:200*E,alpha:.06,dx:-22,dy:12,color:ye[a(0,ye.length-1)]},{size:150*E,alpha:.08,dx:-9,dy:7,color:ye[a(0,ye.length-1)]},{size:120*E,alpha:.1,dx:0,dy:0,color:ye[a(0,ye.length-1)]},{size:90*E,alpha:.12,dx:12,dy:-4,color:ye[a(0,ye.length-1)]},{size:64*E,alpha:.13,dx:20,dy:-7,color:ye[a(0,ye.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${l}vw`,animationDuration:`${b}s`,animationDelay:`${S}ms`,"--tx":`${y}vw`,transform:`rotate(${_}deg)`},children:L.map((A,x)=>e.jsx("svg",{width:A.size,height:A.size,viewBox:"0 0 100 100",style:{left:`${50+A.dx}%`,bottom:`${A.dy}px`,transform:"translateX(-50%)","--alpha":A.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:A.color})},x))})}function Tt({paused:t=!1}){const o=s.useMemo(()=>new Array(20).fill(0).map((a,l)=>l),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:o.map(a=>e.jsx(Fs,{i:a},a))})}function Ds(){const t=_e(),o=We(),{lastSection:a,previousLocation:l,setPreviousLocation:h}=Te(),d=M.useRef(null),b=M.useRef(!1),S=M.useRef(0),y=M.useRef(0),_=M.useRef(null),f=M.useRef(null),E=M.useRef(!1),L=300,A=2e3,x=M.useRef(null),v=M.useRef(null),g=M.useRef(null),[c,C]=M.useState(!1),[F,w]=M.useState(12),B=M.useRef(null),z=M.useRef(null),[u,H]=M.useState(!1),[$,X]=M.useState(12),[oe,Q]=M.useState([]),[ae,de]=M.useState(""),q=M.useRef(null),te=M.useRef(null),[se,m]=M.useState(!1),[W,P]=M.useState(12),[U,he]=M.useState(null),fe=M.useCallback(()=>{if(!v.current)return;const N=v.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Y=160;let O=N.left;O+Y+8>V&&(O=Math.max(8,V-Y-8)),O=Math.max(8,O),w(O)},[]),i=M.useCallback(()=>{if(!B.current)return;const N=B.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Y=220;let O=N.left;O+Y+8>V&&(O=Math.max(8,V-Y-8)),O=Math.max(8,O),X(O)},[]),T=M.useCallback(()=>{if(!q.current)return;const N=q.current.getBoundingClientRect(),V=window.innerWidth||document.documentElement.clientWidth||320,Y=280;let O=N.left;O+Y+8>V&&(O=Math.max(8,V-Y-8)),O=Math.max(8,O),P(O)},[]);M.useEffect(()=>()=>{d.current&&clearTimeout(d.current),_.current&&clearTimeout(_.current),f.current&&clearTimeout(f.current)},[]),M.useEffect(()=>{if(!c)return;const N=V=>{const Y=V.target;g.current&&!g.current.contains(Y)&&v.current&&!v.current.contains(Y)&&C(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[c]),M.useEffect(()=>{if(!u)return;const N=V=>{const Y=V.target;z.current&&!z.current.contains(Y)&&B.current&&!B.current.contains(Y)&&H(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[u]),M.useEffect(()=>{if(!se)return;const N=V=>{const Y=V.target;te.current&&!te.current.contains(Y)&&q.current&&!q.current.contains(Y)&&m(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[se]),M.useEffect(()=>{if(!c)return;fe();const N=()=>fe();return window.addEventListener("resize",N),window.addEventListener("orientationchange",N),()=>{window.removeEventListener("resize",N),window.removeEventListener("orientationchange",N)}},[c,fe]),M.useEffect(()=>{if(!u)return;i();const N=()=>i();return window.addEventListener("resize",N),window.addEventListener("orientationchange",N),()=>{window.removeEventListener("resize",N),window.removeEventListener("orientationchange",N)}},[u,i]),M.useEffect(()=>{if(!se)return;T();const N=()=>T();return window.addEventListener("resize",N),window.addEventListener("orientationchange",N),()=>{window.removeEventListener("resize",N),window.removeEventListener("orientationchange",N)}},[se,T]);const le=t.pathname==="/"||t.pathname==="/about",Z=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!le&&t.pathname.startsWith("/md/");const re=t.pathname.startsWith("/md/")||!le&&!t.pathname.startsWith("/mp/")&&a==="moddi";M.useEffect(()=>{if(!Z)return;const N=Y=>{const O=Y.detail||{},Ae=Array.isArray(O.items)?O.items:[];Q(Ae),de(String(O.selected||""))},V=Y=>{const O=Y.detail||{};he({title:String(O.title||""),artist:String(O.artist||""),mapper:String(O.mapper||""),version:String(O.version||""),beatmapId:Number(O.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",N),window.addEventListener("editor:info",V),()=>{window.removeEventListener("editor:difficulty:list",N),window.removeEventListener("editor:info",V)}},[Z]);const Ie=_t();if(le)return null;const ke=()=>{o(l||(a==="moddi"?"/md/feed":"/mp/feed"))},Be=()=>{C(N=>!N)},qe=()=>{var N;C(!1),(N=x.current)==null||N.click()},ee=()=>{H(N=>!N)},$e=N=>{H(!1),de(N),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:N}}))},Le=()=>{m(N=>!N)};if(Z)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:x,type:"file",accept:".osz,.zip",onChange:N=>{var Y;const V=(Y=N.target.files)==null?void 0:Y[0];V&&window.dispatchEvent(new CustomEvent("editor:file",{detail:V}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ke,"aria-label":"Back",title:"Go back",children:e.jsx(jt,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:v,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Be,"aria-label":"File",title:"File menu","aria-expanded":c,children:e.jsx(Ht,{size:20})}),c&&Ge.createPortal(e.jsx("div",{ref:g,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${F}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:qe,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:ke,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[oe.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:B,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ee,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":u,children:e.jsx(pt,{size:20})}),u&&Ge.createPortal(e.jsx("div",{ref:z,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${$}px`,minWidth:220},children:oe.map(N=>{const V=N.mode==="taiko"?Cs:N.mode==="mania"?Es:N.mode==="catch"?_s:Ts;return e.jsxs("button",{className:`mode-option ${ae===N.path?"selected":""}`,type:"button",onClick:()=>$e(N.path),children:[e.jsx("img",{className:"mode-icon",src:V,width:24,height:24,alt:""}),e.jsx("span",{children:N.version||"(Untitled)"})]},N.path)})}),document.body)]}),U&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:q,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Le,"aria-label":"Map Info",title:"Map Info","aria-expanded":se,children:e.jsx(Bt,{size:20})}),se&&Ge.createPortal(e.jsx("div",{ref:te,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${W}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[U.artist||"Artist"," – ",U.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",U.mapper||"Unknown"]}),U.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",U.version]}),U.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${U.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]});const ze=()=>{const N=Date.now();if(S.current>0){const V=N-S.current;if(V<L&&V>0){_.current&&(clearTimeout(_.current),_.current=null),f.current&&(clearTimeout(f.current),f.current=null),d.current&&(clearTimeout(d.current),d.current=null),y.current=N+A,S.current=0,b.current=!1,h(t.pathname),o("/editor");return}}N<y.current&&S.current===0||(_.current&&(clearTimeout(_.current),_.current=null),f.current&&(clearTimeout(f.current),f.current=null),S.current=N,f.current=setTimeout(()=>{f.current!==null&&(o(re?"/mp/feed":"/md/feed"),f.current=null)},L),_.current=setTimeout(()=>{S.current>0&&(S.current=0,y.current=Date.now()+A),_.current=null},L))},Re=()=>{b.current=!1,d.current=setTimeout(()=>{b.current=!0,o("/")},500)},Me=()=>{d.current&&(clearTimeout(d.current),d.current=null),b.current&&setTimeout(()=>{b.current=!1},100)},De=N=>{if(E.current){N.preventDefault(),N.stopPropagation(),E.current=!1;return}if(b.current){N.preventDefault(),N.stopPropagation();return}ze()},Pe=N=>{if(Me(),b.current){N.preventDefault(),E.current=!0;return}N.preventDefault(),ze(),E.current=!0,setTimeout(()=>{E.current=!1},L+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(K,{to:re?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(pt,{size:20})}),re?e.jsx(K,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(qt,{size:20})}):e.jsx(K,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx($t,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:De,onTouchStart:Re,onTouchEnd:Pe,onMouseDown:Re,onMouseUp:Me,onMouseLeave:Me,"aria-label":re?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:re?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:re?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(K,{to:"/md/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/md/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative"},children:[e.jsx(wt,{size:20}),Ie>0&&e.jsx("span",{style:{position:"absolute",top:8,right:8,width:8,height:8,background:"#f87171",borderRadius:9999}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>o("/settings"),"aria-label":"Settings",children:e.jsx(Ut,{size:20})})]})]})}function Ps({isModdi:t,onClick:o}){return e.jsxs("button",{onClick:o,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:t?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:t?"osu!mappi.ng":"osu!moddi.ng"})]})}function Ws({isNeutralPage:t,isEditor:o,isModdi:a,isMappi:l,onCoinFlipClick:h}){return t?e.jsx(K,{to:"/",className:"title",children:a?"osu!moddi.ng":l?"osu!mappi.ng":"mappi!"}):o?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(K,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ht,{size:18})}),e.jsx(K,{to:a?"/md/feed":"/mp/feed",className:"title",children:"osu!editi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(K,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ht,{size:18})}),e.jsx(Ps,{isModdi:a,onClick:h})]})}function Hs({isNeutralPage:t,isMappi:o,isModdi:a}){const l=_e();return e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[t&&e.jsx(K,{to:l.pathname==="/"?"/about":"/",className:l.pathname==="/about"?"active":"",children:l.pathname==="/"?"About":"Home"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(K,{to:"/mp/feed",className:l.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(K,{to:"/mp/discover",className:l.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(K,{to:"/editor",className:l.pathname==="/editor"?"active":"",children:"Editor"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(K,{to:"/md/feed",className:l.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(K,{to:"/md/queues",className:l.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!o&&!a&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(K,{to:"/mp/feed",className:l.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(K,{to:"/mp/discover",className:l.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(K,{to:"/editor",className:l.pathname==="/editor"?"active":"",children:"Editor"})]})]})}function Mt(t,o,a,l){s.useEffect(()=>{if(!a)return;const h=d=>{const b=d.target;o.current&&!o.current.contains(b)&&t.current&&!t.current.contains(b)&&l()};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[a,l,t,o])}function Bs(t,o,a,l){const h=We(),{notify:d}=He(),[b,S]=s.useState(new Set);return{parseQueueInvite:x=>{if(!x)return null;try{const v=JSON.parse(x);if((v==null?void 0:v.type)==="queue_invite"&&(v!=null&&v.queue_id))return v}catch{}return null},handleAcceptInvite:async(x,v)=>{if(!b.has(x.id)){S(g=>new Set(g).add(x.id));try{await D(I.moddi.queueAccept(String(v)),{method:"POST"}),d("Invitation accepted!",{variant:"success"}),a.mutate(x.id),l(!1),h(`/md/queues/${v}`)}catch(g){d((g==null?void 0:g.message)||"Failed to accept invitation",{variant:"error"})}finally{S(g=>{const c=new Set(g);return c.delete(x.id),c})}}},handleDenyInvite:async(x,v)=>{if(!b.has(x.id)){S(g=>new Set(g).add(x.id));try{await D(I.moddi.queueDeny(String(v)),{method:"POST"}),d("Invitation declined",{variant:"success"}),a.mutate(x.id)}catch(g){d((g==null?void 0:g.message)||"Failed to decline invitation",{variant:"error"})}finally{S(g=>{const c=new Set(g);return c.delete(x.id),c})}}},handleMarkAllRead:async()=>{const x=t.filter(v=>v.id.startsWith("n:")||v.kind==="system"&&!v.read).map(v=>v.id);x.length>0&&o.mutate(x)},handleNotificationClick:async x=>{if(l(!1),o.mutate([x.id]),x.kind==="system"||x.id.startsWith("n:"))try{await D(I.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[x.id]})})}catch{}},handleDeleteNotification:async(x,v)=>{x.stopPropagation(),a.mutate(v)},processing:b}}function qs({notifications:t,unreadCount:o,notifOpen:a,setNotifOpen:l,markReadMutation:h,deleteNotificationMutation:d,closeAllPanels:b}){const S=s.useRef(null),y=s.useRef(null),{parseQueueInvite:_,handleAcceptInvite:f,handleDenyInvite:E,handleMarkAllRead:L,handleNotificationClick:A,handleDeleteNotification:x,processing:v}=Bs(t,h,d,l);Mt(S,y,a,()=>l(!1));const g=t.filter(c=>!(c.kind==="system"&&c.id.startsWith("b:")&&(c.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:S,className:"icon-link",onClick:()=>{a||b(),l(!a)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(wt,{size:18})}),o>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),a&&e.jsxs("div",{ref:y,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(K,{to:"/md/notifications",onClick:()=>l(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:c=>c.currentTarget.style.opacity="1",onMouseLeave:c=>c.currentTarget.style.opacity="0.7",children:"View all"}),g.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:L,children:e.jsx(Xe,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[g.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),g.map(c=>{const C=_(c.text),F=c.id.startsWith("b:"),w=C?"queue-invite":c.kind==="star"?"star":c.kind==="likes5"?"likes":c.kind==="comment"?"comment":c.kind==="inspiration"?"inspiration":c.kind==="reaction"?"reaction":F?"global":"system",B=c.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${w}`,role:"button",onClick:()=>!C&&A(c),children:[e.jsxs("div",{className:`notif-icon ${B?"deletable":""}`,"aria-hidden":"true",onClick:B&&!C?z=>x(z,c.id):void 0,title:B&&!C?"Remove":void 0,role:B&&!C?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:C?e.jsx(Ot,{}):w==="star"?e.jsx(Nt,{}):w==="likes"?e.jsx(kt,{}):w==="comment"?e.jsx(ft,{}):w==="inspiration"?e.jsx(ft,{}):w==="reaction"?e.jsx(Qt,{}):w==="global"?e.jsx(Yt,{}):null}),B&&!C?e.jsx("span",{className:"swap-trash",children:e.jsx(Vt,{})}):null]}),e.jsx("div",{className:"notif-body",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[C.inviter_username," invited you to join queue: ",C.queue_name]}),v.has(c.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:z=>{z.stopPropagation(),f(c,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Xe,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:z=>{z.stopPropagation(),E(c,C.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(et,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):c.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:F?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:c.text||""}),F&&c.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(c.expiresAt).toLocaleString()]}):null]}):c.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:c.text||"Someone commented on your post"})]}):c.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:c.text||"Someone is inspired by you!"})]}):c.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:c.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:c.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:c.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},c.id)})]})]})]})}function $s({quota:t,nowTick:o}){if(!(t!=null&&t.blocked))return null;const a=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),l=Math.floor(a/3600),h=Math.floor(a%3600/60),d=a%60,b=y=>String(y).padStart(2,"0"),S=l>0?`${l}:${b(h)}:${b(d)}`:`${h}:${b(d)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(Jt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:S})]})}function Us({me:t,menuOpen:o,setMenuOpen:a,onLogout:l,closeAllPanels:h}){const d=s.useRef(null),b=s.useRef(null);return Mt(d,b,o,()=>a(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:d,className:"icon-link",onClick:()=>{o||h(),a(!o)},title:t.username,"aria-label":"User menu","aria-expanded":o,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(St,{size:14,style:{opacity:.8}})]}),o&&e.jsxs("div",{ref:b,className:"menu-panel",role:"menu",children:[e.jsx(K,{to:"/profile",className:"menu-item",onClick:()=>a(!1),children:"Profile"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(K,{to:"/moderation",className:"menu-item",onClick:()=>a(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:l,children:"Log out"})]})]})}function Os({isNeutralPage:t,isEditor:o,isMappi:a,isModdi:l,onCoinFlipClick:h}){const d=_e(),{data:b,isLoading:S}=Fe(),{data:y}=hs(!!b),{data:_=[]}=fs(!!b),f=_t(),E=xs(),L=gs(),A=bs(),{menuOpen:x,notifOpen:v,setMenuOpen:g,setNotifOpen:c,closeAllPanels:C}=Te(),[F,w]=M.useState(0);return M.useEffect(()=>{const B=setInterval(()=>w(z=>z+1),1e3);return()=>clearInterval(B)},[]),e.jsxs("header",{className:"top-nav",children:[e.jsx(Ws,{isNeutralPage:t,isEditor:o,isModdi:l,isMappi:a,onCoinFlipClick:h}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),d.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Ms,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Hs,{isNeutralPage:t,isMappi:a,isModdi:l}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Gt,{size:18})}),b?e.jsxs("div",{className:"user-menu",children:[e.jsx(qs,{notifications:_,unreadCount:f,notifOpen:v,setNotifOpen:c,markReadMutation:L,deleteNotificationMutation:A,closeAllPanels:C}),e.jsx($s,{quota:y,nowTick:F}),e.jsx(Us,{me:b,menuOpen:x,setMenuOpen:g,onLogout:()=>E.mutate(),closeAllPanels:C})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Oe+I.auth.login},disabled:S,children:S?"Checking…":"Login with osu!"})]})]})}function Qs({title:t,onRefresh:o}){const{data:a}=Fe(),l=_e(),h=We(),{lastSection:d}=Te(),[b,S]=M.useState(!0),[y,_]=M.useState(0),[f,E]=M.useState(!1),L=M.useRef(!1),A=M.useRef(0);M.useEffect(()=>{const g=document.querySelector(".page");if(!g)return;let c=g.scrollTop,C=!1;const F=()=>{C||(C=!0,requestAnimationFrame(()=>{const w=g.scrollTop,B=w-c;w<=12||B<-12?S(!0):B>12&&S(!1),c=w,C=!1}))};return g.addEventListener("scroll",F,{passive:!0}),()=>g.removeEventListener("scroll",F)},[]),M.useEffect(()=>{const g=document.querySelector(".page");if(!g)return;const c=120,C=70,F=u=>{var H;f||(g.scrollTop<=0?(L.current=!0,A.current=((H=u.touches[0])==null?void 0:H.clientY)??0):L.current=!1)},w=u=>{var X;if(!L.current||f)return;const H=((X=u.touches[0])==null?void 0:X.clientY)??0,$=Math.max(0,H-A.current);if($>0){const oe=Math.min(c,$*.5);_(oe)}},B=async()=>{try{if(E(!0),o)await o();else{window.location.reload();return}}finally{setTimeout(()=>{E(!1),_(0)},400)}},z=()=>{!L.current||f||(y>=C?B():_(0),L.current=!1)};return g.addEventListener("touchstart",F,{passive:!0}),g.addEventListener("touchmove",w,{passive:!0}),g.addEventListener("touchend",z),g.addEventListener("touchcancel",z),()=>{g.removeEventListener("touchstart",F),g.removeEventListener("touchmove",w),g.removeEventListener("touchend",z),g.removeEventListener("touchcancel",z)}},[y,f,o]);const{showBack:x,onBack:v}=M.useMemo(()=>{const g=l.pathname;if(/^\/mp\/feed\/.+/.test(g))return{showBack:!0,onBack:()=>h("/mp/feed")};if(/^\/md\/feed\/.+/.test(g))return{showBack:!0,onBack:()=>h("/md/feed")};if(/^\/md\/queues\/.+/.test(g))return{showBack:!0,onBack:()=>h("/md/queues")};if(g==="/profile"||g.startsWith("/profile/")){const c=d==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?h(-1):h(c)}}}return{showBack:!1,onBack:()=>{}}},[l.pathname,h,d]);return e.jsxs("div",{className:`mobile-page-header ${b?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${b?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:x?e.jsx("button",{className:"icon-link",onClick:v,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(jt,{size:18})}):e.jsx(K,{to:"/profile",className:"icon-link","aria-label":"Profile",children:a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"rgba(255,255,255,0.2)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:f||y>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(y,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${f?"spin":y>60?"ready":""}`})})]})}function Ys({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function Vs(){const t=_e(),{lastSection:o}=Te(),a=t.pathname==="/"||t.pathname==="/about",l=t.pathname==="/editor",h=t.pathname.startsWith("/mp/")||!a&&!t.pathname.startsWith("/md/")&&o==="mappi",d=t.pathname.startsWith("/md/")||!a&&!t.pathname.startsWith("/mp/")&&o==="moddi",b=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";return{isNeutralPage:a,isEditor:l,isMappi:h,isModdi:d,isQueueDetail:b}}function Js(t){const o=We(),a=_e(),{setPreviousLocation:l}=Te(),h=s.useRef(0),d=s.useRef(0),b=s.useRef(null),S=500,y=2e3;return s.useEffect(()=>()=>{b.current&&clearTimeout(b.current)},[]),f=>{f.preventDefault();const E=Date.now();if(!(E<d.current)){if(b.current&&h.current>0){const L=E-h.current;if(L<S&&L>0){clearTimeout(b.current),b.current=null,d.current=E+y,h.current=0,l(a.pathname),o("/editor");return}}b.current&&(clearTimeout(b.current),b.current=null),h.current=E,b.current=setTimeout(()=>{d.current=Date.now()+y,b.current=null,h.current=0,o(t?"/mp/feed":"/md/feed")},S)}}}function Gs(){const t=_e(),{notify:o}=He(),{data:a}=Fe(),{lastSection:l,setLastSection:h}=Te(),{isNeutralPage:d,isEditor:b,isMappi:S,isModdi:y}=Vs(),_=Js(y);M.useEffect(()=>{t.pathname.startsWith("/mp/")?h("mappi"):t.pathname.startsWith("/md/")&&h("moddi")},[t.pathname,h]);const[f,E]=M.useState(null);M.useEffect(()=>{!a||!a.is_mod||(async()=>{try{const x=await D(I.admin.debugState,{requireAuth:!1}),v=Array.isArray(x==null?void 0:x.counts)?x.counts.find(g=>String(g.status)==="ready"):null;v&&E(Number(v.c)||0)}catch{}})()},[a]),M.useEffect(()=>{a&&!localStorage.getItem("welcomed")&&(o(`Welcome, ${a.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[a,o]),M.useEffect(()=>{if(typeof window>"u"||!(window.matchMedia&&window.matchMedia("(max-width: 480px)").matches)||t.pathname==="/editor")return;const v=document.querySelector(".page");v&&(v.scrollTop=0)},[t.pathname]);const{showMobileHeader:L,headerTitle:A}=M.useMemo(()=>{const x=t.pathname;if(x==="/"||x==="/about"||x==="/editor"||x==="/mp/discover")return{showMobileHeader:!1,headerTitle:""};const v=x.split("/").filter(Boolean),g=v[0]||"",c=v[1]||"";if(g==="mp"){if(c==="discover")return{showMobileHeader:!0,headerTitle:"Discover"};if(c==="feed")return{showMobileHeader:!0,headerTitle:v.length>2?"Post":"Feed"}}if(g==="md"){if(c==="feed")return{showMobileHeader:!0,headerTitle:v.length>2?"Post":"Feed"};if(c==="queues")return{showMobileHeader:!0,headerTitle:v.length>2?"Queue":"Queues"};if(c==="notifications")return{showMobileHeader:!0,headerTitle:"Notifications"}}return g==="profile"?{showMobileHeader:!0,headerTitle:"Profile"}:x==="/settings"?{showMobileHeader:!0,headerTitle:"Settings"}:x==="/moderation"?{showMobileHeader:!0,headerTitle:"Moderation"}:{showMobileHeader:!0,headerTitle:""}},[t.pathname]);return e.jsxs("div",{className:"app-shell","data-section":y?"moddi":S?"mappi":l==="moddi"?"moddi":l==="mappi"?"mappi":void 0,children:[e.jsx(Tt,{paused:t.pathname==="/editor"}),e.jsx(Os,{isNeutralPage:d,isEditor:b,isMappi:S,isModdi:y,onCoinFlipClick:_}),e.jsxs("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:[L&&e.jsx(Qs,{title:A}),t.pathname==="/about"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(xt,{})}):e.jsx(xt,{})]}),t.pathname!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(Ys,{readyCount:f})}),e.jsx(Ds,{})]})}function Ks(){const{data:t,isLoading:o}=Fe(),a=!!t;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),a&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions landing-actions-desktop",children:[e.jsx(K,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(K,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]}),!a&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Oe+I.auth.login},disabled:o,children:o?"Checking…":"Login with osu!"})}),a&&e.jsxs("div",{className:"landing-actions landing-actions-mobile",children:[e.jsx(K,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(K,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function Xs(){const{data:t}=Fe(),{modeFilters:o}=Te(),a=Object.entries(o).filter(([h,d])=>d).map(([h])=>h),l=a.length?a.join(","):"standard";return Kt({queryKey:["mappi","feed",l],queryFn:async({pageParam:h=0})=>{const d=new URLSearchParams({limit:"20",offset:String(h),modes:l}),b=`${I.feed.recent}?${d.toString()}`;return await D(b)},enabled:!!t,initialPageParam:0,getNextPageParam:(h,d)=>{var y;const b=d.reduce((_,f)=>{var E;return _+(((E=f.items)==null?void 0:E.length)||0)},0);return(((y=h.items)==null?void 0:y.length)||0)===20?b:void 0}})}function Zs(){const t=_e(),o=Xt(),{data:a}=Fe(),{modeFilters:l}=Te(),{data:h,fetchNextPage:d,hasNextPage:b,isFetching:S,isFetchingNextPage:y,refetch:_}=Xs(),f=s.useMemo(()=>(h==null?void 0:h.pages.flatMap(c=>c.items||[]))||[],[h]),E=s.useMemo(()=>{const c=Object.entries(l).filter(([F,w])=>w).map(([F])=>F.toLowerCase()),C=new Set(c.length?c:["standard"]);return f.filter(F=>{const w=String(F.mode||"standard").toLowerCase();return C.has(w)})},[f,l]);s.useEffect(()=>{t.pathname==="/mp/feed"&&_()},[t.pathname,_]),s.useEffect(()=>{const c=()=>{_()};return window.addEventListener("filterchange",c),()=>window.removeEventListener("filterchange",c)},[_]);const L=c=>{o.setQueryData(["mappi","feed"],C=>C&&{...C,pages:C.pages.map(F=>({...F,items:F.items.map(w=>w.id===c.id?c:w)}))})},A=c=>{o.setQueryData(["mappi","feed"],C=>C&&{...C,pages:C.pages.map(F=>({...F,items:F.items.filter(w=>w.id!==c)}))})},x=()=>{_()},v=S&&!y,g=b??!1;return e.jsxs("div",{className:"feed-container mappi-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(ys,{section:"mappi",onUpload:x})]}),e.jsx(vs,{section:"mappi",onUpload:x}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[E.length===0&&!v&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),E.map(c=>e.jsx(cs,{post:c,section:"mappi",onUpdate:L,onDelete:A,me:a},c.id)),E.length>0&&g&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>d(),disabled:y,children:y?"Loading...":"Load more"})})]})})]})}const pe={};function ei(){try{const t=localStorage.getItem("feed_seen_ids");if(t){const o=JSON.parse(t);Array.isArray(o)&&(pe.seenIds=o.filter(a=>typeof a=="number"))}}catch{}return pe}function bt(t){Object.assign(pe,t);try{const o=Array.from(new Set(pe.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(o))}catch{}}function ti(){var ct,dt,ut;const{notify:t}=He(),[o,a]=s.useState(pe.history||[]),[l,h]=s.useState(pe.index??-1),[d,b]=s.useState(pe.queue||[]),[S,y]=s.useState(!1),[_,f]=s.useState(!1),[E,L]=s.useState(pe.eligibleCount??null),[A,x]=s.useState(pe.viewedCount??0),[v,g]=s.useState(!1),[c,C]=s.useState(!0),[F,w]=s.useState(!1),[B,z]=s.useState(!1),[u,H]=s.useState(!1),[$,X]=s.useState(!1),[oe,Q]=s.useState(!1),[ae,de]=s.useState([]),[q,te]=s.useState(""),[se,m]=s.useState(null),[W,P]=s.useState(!1),[U,he]=s.useState(null),[fe,i]=s.useState(!1),T=s.useRef(new Set(pe.seenIds||[])),le=s.useRef(new Set),Z=s.useRef(!1),re=s.useRef(pe.lastShownVideoId??null),Ie=s.useRef(!1),ke=s.useRef(0),Be=s.useRef(0),qe=s.useRef(0),ee=s.useRef(null),$e=s.useRef(null),Le=s.useRef(null),ze=s.useRef(null),Re=s.useRef(null),Me=s.useRef(null),De=s.useRef(null),Pe=s.useRef(null),N=s.useRef(0),V=s.useRef(0),Y=s.useRef(null),O=s.useRef(null),[Ae,It]=s.useState(0),r=s.useMemo(()=>l>=0?o[l]:null,[o,l]);s.useEffect(()=>{ei()},[]),s.useEffect(()=>{bt({history:o,index:l,queue:d,seenIds:Array.from(T.current),eligibleCount:E??void 0,viewedCount:A,lastShownVideoId:re.current??void 0})},[o,l,d,E,A]);const je=s.useCallback(()=>{try{const n=localStorage.getItem("filter_modes"),p=(n?String(n):"standard").toLowerCase().split(",").map(R=>R.trim()).filter(Boolean),j=["standard","taiko","mania","catch"],k=Array.from(new Set(p.filter(R=>j.includes(R))));return k.length?k:["standard"]}catch{return["standard"]}},[]),tt=s.useCallback(()=>{const n=new Set;return re.current!==null&&n.add(re.current),Array.from(T.current).slice(-200).forEach(j=>n.add(j)),d.forEach(j=>n.add(j.id)),Array.from(n)},[d]),Qe=s.useCallback(async(n=3)=>{var k,R,J,ge;if(Z.current)return[];const p=Date.now();if(p<ke.current){const ne=Math.ceil((ke.current-p)/1e3);return t(`Rate limited. Please wait ${ne}s.`,{durationMs:3e3,variant:"warn"}),[]}const j=p-qe.current;if(j<2e3){const ne=2e3-j;await new Promise(Ce=>setTimeout(Ce,ne))}Z.current=!0,qe.current=Date.now();try{const ne=tt(),Ce=je().join(","),be=[],we=new Set(d.map(ue=>ue.id));let Ne=[...ne];const Je=Math.min(n,3);for(let ue=0;ue<Je;ue++){if(ue>0){const G=Date.now()-Be.current,ie=1e3;G<ie&&await new Promise(me=>setTimeout(me,ie-G))}try{Be.current=Date.now();const G=await D(I.feed.next+Ee({exclude:Ne.join(","),modes:Ce}),{requireAuth:!1}),ie=G&&("id"in G?G:G.video)||null;if(!ie)break;if(T.current.has(ie.id)||we.has(ie.id)||ie.id===re.current){Ne.push(ie.id);continue}be.push(ie),Ne.push(ie.id),we.add(ie.id)}catch(G){if((k=G==null?void 0:G.message)!=null&&k.includes("401")||(R=G==null?void 0:G.message)!=null&&R.includes("Unauthorized")){g(!0);break}else if((J=G==null?void 0:G.message)!=null&&J.includes("429")||(ge=G==null?void 0:G.message)!=null&&ge.includes("rate limit")){ke.current=Date.now()+5e3,t("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(be.length>0&&b(ue=>{const G=new Set(ue.map(me=>me.id)),ie=be.filter(me=>!G.has(me.id));return[...ue,...ie]}),be.length===0&&d.length===0)try{const ue=je().join(","),G=await D(I.feed.progress(ue),{requireAuth:!1});L(Number(G.eligible||0)),x(Number(G.viewed||0)),f(Number(G.caught_up||0)===1)}catch{}return be}catch{return[]}finally{Z.current=!1}},[tt,je,d,t]),xe=s.useCallback(async()=>{if(!S){y(!0);try{d.length<=2&&Qe(3).catch(()=>{});let n;if(d.length>0)n=d[0],b(p=>p.filter(j=>j.id!==n.id));else{const p=await Qe(3);p.length>0&&(n=p[0],p.length>1&&b(j=>{const k=new Set(j.map(J=>J.id)),R=p.slice(1).filter(J=>!k.has(J.id));return[...j,...R]}))}if(n)re.current=n.id,T.current.add(n.id),bt({seenIds:Array.from(T.current)}),a(p=>{const j=[...p.slice(0,l+1),n];return h(j.length-1),j}),le.current.has(n.id)||(le.current.add(n.id),D(I.videos.view(n.id),{method:"POST"}).then(p=>{p&&a(j=>{const k=[...j],R=k.findIndex(J=>J.id===n.id);return R!==-1&&(k[R]={...k[R],views_count:p.views_count??k[R].views_count??0,viewed_by_me:!0}),k})}).catch(()=>{}));else try{const p=je().join(","),j=await D(I.feed.progress(p),{requireAuth:!1});L(Number(j.eligible||0)),x(Number(j.viewed||0)),f(Number(j.eligible||0)>0&&Number(j.viewed||0)>=Number(j.eligible||0))}catch{}}finally{y(!1)}}},[S,d,Qe,l,je]),Lt=s.useCallback(()=>{ee.current&&!ee.current.paused&&ee.current.pause(),w(!0),Q(!1)},[]),Ye=s.useCallback(()=>{l>0&&(h(l-1),w(!1))},[l]),Ve=s.useCallback(()=>{const n=Date.now();if(!(n-V.current<300)){if(V.current=n,c||(Ie.current=!0,C(!1)),l<o.length-1){const p=o[l+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:l,nextIndex:l+1,currentVideoId:r==null?void 0:r.id,nextVideoId:p==null?void 0:p.id,nextVideoStreamUID:p==null?void 0:p.stream_uid}),p&&(re.current=p.id),h(l+1),w(!1);return}if(!_){if(Date.now()<ke.current){const p=Math.ceil((ke.current-Date.now())/1e3);t(`Rate limited. Please wait ${p}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),xe()}}},[l,o,c,_,xe,t,r]);s.useEffect(()=>{const n=$e.current;if(!n)return;const p=R=>{if(v||Math.abs(R.deltaY)<Math.abs(R.deltaX))return;R.preventDefault(),R.stopPropagation();const J=Date.now();if(!(J<N.current)){if(N.current=J+1e3,!r){R.deltaY>0&&!S&&xe();return}R.deltaY>0?Ve():Ye()}},j=R=>{Y.current=R.touches[0].clientY,O.current=Date.now()},k=R=>{if(v||Y.current===null||O.current===null)return;const J=R.changedTouches[0].clientY,ge=Date.now(),ne=Y.current-J,Ce=ge-O.current;if(Y.current=null,O.current=null,Math.abs(ne)<50||Ce>300)return;const be=Date.now();if(!(be<N.current)){if(N.current=be+1e3,!r){ne>0&&!S&&xe();return}ne>0?Ve():Ye()}};return n.addEventListener("wheel",p,{passive:!1,capture:!0}),n.addEventListener("touchstart",j,{passive:!0}),n.addEventListener("touchend",k,{passive:!0}),window.addEventListener("wheel",p,{passive:!1,capture:!0}),()=>{n.removeEventListener("wheel",p,{capture:!0}),n.removeEventListener("touchstart",j),n.removeEventListener("touchend",k),window.removeEventListener("wheel",p,{capture:!0})}},[Ve,Ye,r,S,xe,v]);const zt=s.useCallback(async()=>{var n,p;if(!(!r||fe)){i(!0);try{const j=r.liked_by_me?"DELETE":"POST",k=await D(I.videos.like(r.id),{method:j});a(R=>{const J=[...R],ge=J.findIndex(ne=>ne.id===r.id);return ge!==-1&&(J[ge]={...J[ge],liked_by_me:!r.liked_by_me,likes_count:k.likes_count}),J})}catch(j){((n=j==null?void 0:j.message)!=null&&n.includes("429")||(p=j==null?void 0:j.message)!=null&&p.includes("rate limit"))&&t("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{i(!1)}}},[r,fe,t]),st=s.useCallback(async n=>{if(r)try{await D(I.videos.flag(r.id),{method:"POST",body:JSON.stringify({reason:n})}),t("Thanks for your report.",{variant:"info"})}catch{t("Report failed",{variant:"error"})}finally{H(!1)}},[r,t]),Rt=s.useCallback(async()=>{if(!r)return;const n=!r.is_starred,p=n?"star":"unstar";try{await D(I.admin.videosAction(r.id,p),{method:"POST"}),a(j=>{const k=[...j],R=k.findIndex(J=>J.id===r.id);return R!==-1&&(k[R]={...k[R],is_starred:n}),k}),X(!1),t(n?"Post starred":"Star removed",{variant:"success"})}catch{t("Action failed",{variant:"error"})}},[r,t]),it=s.useCallback(async()=>{if(!(!r||!confirm("Permanently delete this video?")))try{await D(I.videos.delete(r.id),{method:"DELETE"}),t("Deleted",{variant:"warn"}),H(!1),a(n=>{const p=n.filter((j,k)=>k!==l);return p.length===0?(h(-1),setTimeout(xe,0)):h(j=>Math.max(0,Math.min(j,p.length-1))),p})}catch{alert("Delete failed")}},[r,l,xe,t]),Ue=s.useCallback(async()=>{if(r!=null&&r.id)try{const n=await D(I.videos.comments(r.id),{requireAuth:!1});de(n.items||[])}catch{}},[r==null?void 0:r.id]);s.useEffect(()=>{B&&(r!=null&&r.id)&&Ue()},[B,r==null?void 0:r.id,Ue]);const nt=s.useCallback(async n=>{if(n.preventDefault(),!(!q.trim()||!(r!=null&&r.id))){P(!0);try{await D(I.videos.comments(r.id),{method:"POST",body:JSON.stringify({text:q.trim(),parent_id:se||void 0})}),te(""),m(null),Ue(),a(p=>{const j=[...p],k=j.findIndex(R=>R.id===r.id);return k!==-1&&(j[k]={...j[k],comments_count:(j[k].comments_count||0)+1}),j}),t("Comment posted!",{variant:"success"})}catch(p){t((p==null?void 0:p.message)||"Failed to post comment",{variant:"error"})}finally{P(!1)}}},[q,r,se,Ue,t]),At=s.useCallback(n=>{de(p=>p.filter(j=>j.id!==n)),a(p=>{const j=[...p],k=j.findIndex(R=>R.id===(r==null?void 0:r.id));return k!==-1&&(j[k]={...j[k],comments_count:Math.max(0,(j[k].comments_count||0)-1)}),j})},[r==null?void 0:r.id]),{topLevelComments:at,repliesMap:rt}=s.useMemo(()=>{const n=ae.filter(j=>!j.parent_id),p=new Map;return ae.filter(j=>j.parent_id).forEach(j=>{const k=j.parent_id;p.has(k)||p.set(k,[]),p.get(k).push(j)}),{topLevelComments:n,repliesMap:p}},[ae]),Ft=s.useCallback(()=>{if(!ee.current)return;const n=!c;C(n),ee.current.muted=n,n||(Ie.current=!0),!n&&ee.current.paused&&ee.current.play().catch(()=>{})},[c]),Dt=s.useCallback(n=>{ee.current=n,n&&(n.muted=c)},[c]);s.useEffect(()=>{w(!1),z(!1),Ie.current?C(!1):C(!0)},[r==null?void 0:r.id,r==null?void 0:r.stream_uid,l,o.length]),s.useEffect(()=>{ee.current&&(ee.current.muted=c)},[c]),s.useEffect(()=>{if(!r)return;const n=!Ie.current;C(n);const p=setTimeout(()=>{ee.current&&(ee.current.muted=n)},100);return()=>clearTimeout(p)},[r==null?void 0:r.id]),s.useEffect(()=>{r&&(re.current=r.id)},[r==null?void 0:r.id]),s.useEffect(()=>{F&&ee.current&&!ee.current.paused&&ee.current.pause()},[F]),s.useEffect(()=>{o.length===0&&xe()},[]),s.useEffect(()=>{(async()=>{try{const n=je().join(","),p=await D(I.feed.progress(n),{requireAuth:!1}),j=Number(p.eligible||0),k=Number(p.viewed||0);L(j),x(k),f(j>0&&k>=j)}catch{}})()},[je]),s.useEffect(()=>{const n=()=>{a([]),b([]),T.current.clear(),re.current=null,h(-1),f(!1),(async()=>{try{const p=je().join(","),j=await D(I.feed.progress(p),{requireAuth:!1}),k=Number(j.eligible||0),R=Number(j.viewed||0);L(k),x(R),f(!1)}catch{}xe()})()};return window.addEventListener("filterchange",n),()=>window.removeEventListener("filterchange",n)},[je,xe]),s.useEffect(()=>{(async()=>{try{const n=await D(I.auth.me,{requireAuth:!1});he(n)}catch{}})()},[]);const[Se,ot]=s.useState(()=>typeof window<"u"?window.matchMedia("(max-width: 480px)").matches:!1);s.useEffect(()=>{const n=()=>{const k=document.querySelector(".top-nav");k&&It(k.offsetHeight),ot(window.matchMedia("(max-width: 480px)").matches)};n();const p=window.matchMedia("(max-width: 480px)"),j=()=>ot(p.matches);return p.addEventListener("change",j),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),p.removeEventListener("change",j)}},[]),s.useEffect(()=>{var j;if(!Le.current||!ze.current||!r||!ee.current)return;const n=()=>{var Ce;const k=(Ce=ze.current)==null?void 0:Ce.querySelector("div"),R=ee.current;if(!k||!R||!Le.current)return;const J=Le.current,ge=window.matchMedia("(max-width: 480px)").matches;let ne;if(r.width&&r.height?ne=r.width/r.height:R.videoWidth>0&&R.videoHeight>0?ne=R.videoWidth/R.videoHeight:ne=16/9,ge){const we=J.offsetWidth,Ne=we/ne;k.style.width=`${we}px`,k.style.height=`${Ne}px`,k.style.maxWidth="100%",k.style.maxHeight="100%"}else{const we=J.offsetWidth-32,Ne=J.offsetHeight-32,Je=16/9,ue=we/Je;let ie=Math.min(Ne,ue),me=ie*ne;me>we&&(me=we,ie=me/ne),ie>Ne&&(ie=Ne,me=ie*ne),k.style.width=`${me}px`,k.style.height=`${ie}px`,k.style.maxWidth="100%",k.style.maxHeight="100%"}},p=()=>{requestAnimationFrame(n)};if(ee.current.readyState>=1)n();else{const k=()=>{var R;n(),(R=ee.current)==null||R.removeEventListener("loadedmetadata",k)};(j=ee.current)==null||j.addEventListener("loadedmetadata",k)}return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[r==null?void 0:r.id,r==null?void 0:r.width,r==null?void 0:r.height]),s.useEffect(()=>{if(!u)return;const n=p=>{Re.current&&!Re.current.contains(p.target)&&H(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[u]),s.useEffect(()=>{if(!$)return;const n=p=>{Me.current&&!Me.current.contains(p.target)&&X(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[$]),s.useEffect(()=>{if(!oe)return;const n=p=>{De.current&&!De.current.contains(p.target)&&Pe.current&&!Pe.current.contains(p.target)&&Q(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[oe]);const lt=!!(U!=null&&U.is_admin||U!=null&&U.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Tt,{paused:Se}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
        /* Mobile-specific: ensure videos take full width */
        @media (max-width: 480px) {
          .video-area .discover-player-wrapper > div {
            min-width: 100% !important;
            max-width: 100% !important;
          }
          .video-area .discover-player-wrapper > div[style] {
            min-width: 100% !important;
            max-width: 100% !important;
          }
        }
      `}),e.jsxs("div",{ref:$e,className:"player-wrap",style:{height:"100dvh",width:"100vw",position:"fixed",top:Se?"calc(0px - env(safe-area-inset-top, 0px))":0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1,margin:0,padding:0,boxSizing:"border-box"},children:[_&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:Ae+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:Le,className:"video-area discover-video-container",style:{position:"absolute",top:Se?0:Ae,left:0,right:0,bottom:Se?"-10px":0,maxHeight:Se?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${Ae}px)`,height:Se?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${Ae}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:Se?"none":"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:Se?"0":"16px",maxWidth:"100vw",width:"100%"},children:v?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=Oe+I.auth.login,children:"Login with osu!"})]}):r?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:Ft,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:ze,className:"discover-player-wrapper",children:e.jsx(ds,{streamUID:r.stream_uid,playbackUrl:r.playback_url,aspectRatio:r.width&&r.height?r.width/r.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:c,controls:!1,onVideoRef:Dt})}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:c?1:0,zIndex:2},children:c?e.jsx(Zt,{size:28,color:"#fff"}):e.jsx(es,{size:28,color:"#fff"})})]})]})}):_?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"• Click video to toggle mute/unmute"}),e.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),r&&!F&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:n=>n.stopPropagation(),children:[e.jsx(K,{to:`/profile/${(ct=r.uploader)==null?void 0:ct.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(dt=r.uploader)!=null&&dt.avatar_url?e.jsx("img",{src:r.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:r.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:zt,disabled:fe,"aria-label":r.liked_by_me?"Unlike":"Like",title:r.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:r.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:r.liked_by_me?e.jsx(kt,{size:28}):e.jsx(Ct,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:r.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>z(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Et,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:r.comments_count??0})]}),r.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:Pe,onClick:()=>Q(n=>!n),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Ze,{size:24})}),oe&&e.jsxs("div",{ref:De,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:r.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>Q(!1),children:[e.jsx(Ze,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),r.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:Lt,children:"Preview"})]})]}),lt?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>X(n=>!n),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(gt,{size:24})}),$&&e.jsxs("div",{ref:Me,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:Rt,children:r.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:it,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>H(n=>!n),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(ts,{size:24})}),u&&e.jsxs("div",{ref:Re,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>st("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>st("explicit"),children:"Explicit"}),lt&&e.jsx("button",{className:"menu-item",onClick:it,children:"Delete video"})]})]}),r&&!F&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(K,{to:`/profile/${(ut=r.uploader)==null?void 0:ut.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var k,R,J;const n=(k=r.uploader)==null?void 0:k.is_admin,p=(R=r.uploader)==null?void 0:R.is_mod,j=n?"#fff3bf":p?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:j},children:["@",(J=r.uploader)==null?void 0:J.username]}),r.is_starred&&e.jsx(Nt,{size:16,color:"#f59e0b",title:"Starred"}),(n||p)&&e.jsx(gt,{size:14,color:j,title:n?"admin":"mod"})]})})()})}),(r.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:r.description}),r.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[r.beatmap_artist," – ",r.beatmap_title," ",r.beatmap_mapper?`(by ${r.beatmap_mapper})`:""," ",r.beatmap_version?`[${r.beatmap_version}]`:""]})]}),B&&r&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",r.comments_count??0,")"]}),e.jsx("button",{onClick:()=>z(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(et,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:at.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:at.map(n=>e.jsx(us,{comment:n,replies:rt.get(n.id)||[],me:U,section:"mappi",onReply:p=>m(p),onDelete:At,replyingTo:se,replyText:q,onReplyTextChange:te,onReplySubmit:nt,posting:W,onCancelReply:()=>{m(null),te("")},repliesMap:rt},n.id))})}),U&&!se&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:nt,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:q,onChange:n=>te(n.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:n=>{const p=n.target;p.style.height="auto",p.style.height=`${Math.min(p.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:W||!q.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:W?"...":"Post"})]})})]})]}),F&&(r==null?void 0:r.beatmapset_id)&&e.jsx(Is,{open:F,onClose:()=>w(!1),downloadUrl:`${Oe}${I.osu.downloadBeatmapset(r.beatmapset_id)}`,beatmapId:r.beatmap_id??void 0,beatmapVersion:r.beatmap_version??void 0})]})]})}function yt(t){if(!t)return"standard";const o=String(t).toLowerCase().trim();return o==="osu"||o==="0"||o==="standard"?"standard":o==="taiko"||o==="1"?"taiko":o==="catch"||o==="fruits"||o==="2"?"catch":o==="mania"||o==="3"?"mania":"standard"}const si=({open:t,onClose:o,videoId:a,initialDescription:l,initialBeatmapUrl:h,onSave:d})=>{const[b,S]=s.useState(l||""),[y,_]=s.useState(h||""),[f,E]=s.useState(null),[L,A]=s.useState(null),[x,v]=s.useState(""),[g,c]=s.useState(!1),C=s.useRef(0);s.useEffect(()=>{t&&(S(l||""),_(h||""),E(null),A(null),v(""))},[t,l,h]),s.useEffect(()=>{if(!t)return;C.current&&window.clearTimeout(C.current);const w=(y||"").trim();if(!w){v(""),E(null),A(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(w)){v(""),E(null),A(null);return}return C.current=window.setTimeout(async()=>{var z;try{let u;try{u=new URL(w)}catch{v("Invalid URL format");return}const H=u.hash.match(/#osu\/(\d+)/),$=H?H[1]:null;u.hash="";const oe={url:u.toString()};$&&(oe.beatmap_id=$);const Q=await D(I.osu.resolveBeatmap+Ee(oe),{requireAuth:!1}),ae=Array.isArray(Q==null?void 0:Q.diffs)?Q.diffs:[];if(!ae.length&&!Q.setId){v("No difficulties found"),E(null),A(null);return}if(E({setId:Number(Q.setId)||0,beatmapId:Q.beatmapId??null,title:String(Q.title||""),artist:String(Q.artist||""),mapper:String(Q.mapper||""),diffs:ae}),ae.length>0){const de=Number.isFinite(Number(Q.beatmapId))?Number(Q.beatmapId):Number((z=ae[0])==null?void 0:z.id),q=ae.find(se=>Number(se.id)===de)||ae[0],te=yt(q==null?void 0:q.mode);A({beatmapId:Number(q==null?void 0:q.id)||null,version:String((q==null?void 0:q.version)||""),mode:te})}v("")}catch(u){v(`Failed to resolve: ${(u==null?void 0:u.message)||"Unknown error"}`),E(null),A(null)}},400),()=>{C.current&&window.clearTimeout(C.current)}},[y,t]);const F=async()=>{if(!g){c(!0);try{await D(I.videos.update(a),{method:"PATCH",body:JSON.stringify({description:b.slice(0,100),beatmap_url:y.trim()||void 0})});const w=!!y.trim();if(f||!w)try{await D(I.videos.update(a)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:w&&f&&f.setId>0?f.setId:null,beatmap_id:w&&(L!=null&&L.beatmapId)?L.beatmapId:null,beatmap_version:w&&(L!=null&&L.version)?L.version:null,beatmap_title:w&&(f!=null&&f.title)?f.title:null,beatmap_artist:w&&(f!=null&&f.artist)?f.artist:null,beatmap_mapper:w&&(f!=null&&f.mapper)?f.mapper:null,beatmap_url:w?y.trim():null})})}catch(z){console.warn("Failed to update beatmap metadata:",z)}d(b,y.trim()||null),o()}catch(w){alert((w==null?void 0:w.message)||"Failed to update post")}finally{c(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:w=>w.target===w.currentTarget&&o(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:o}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:o,"aria-label":"Close",children:e.jsx(et,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:b,onChange:w=>S(w.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),f?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[f.artist," – ",f.title]}),e.jsxs("span",{className:"muted",children:["by ",f.mapper]})]}),e.jsx("select",{value:(L==null?void 0:L.beatmapId)??f.beatmapId??void 0,onChange:w=>{const B=Number(w.target.value),z=(f==null?void 0:f.diffs.find(u=>Number(u.id)===B))||null;if(z){const u=yt(z.mode);A({beatmapId:B,version:z.version,mode:u})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:f.diffs.map(w=>e.jsxs("option",{value:w.id,children:[w.version," (",w.mode,")"]},w.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{E(null),A(null),_("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:y,onChange:w=>_(w.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),x&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:x})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:o,disabled:g,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:F,disabled:g,children:g?"Saving...":"Save"})]})]})]})]}):null};function vt(){const t=ss(),o=We(),{notify:a}=He(),[l,h]=s.useState(null),[d,b]=s.useState(null),[S,y]=s.useState(""),[_,f]=s.useState([]),[E,L]=s.useState([]),[A,x]=s.useState([]),[v,g]=s.useState(""),[c,C]=s.useState(null),[F,w]=s.useState([]),[B,z]=s.useState(null),[u,H]=s.useState(""),[$,X]=s.useState([]),[oe,Q]=s.useState(null),[ae,de]=s.useState(!1),q=s.useMemo(()=>{const m=t.id?Number(t.id):null;return m?l?l.id===m:!1:!0},[t.id,l]);function te(m){const W=m.stream_uid||String(m.id),P=t.id?`/profile/${t.id}`:"/profile";o(`/mp/feed/${W}`,{state:{returnTo:P}})}s.useEffect(()=>{(async()=>{try{const m=await D(I.auth.me,{requireAuth:!1});h(m),m&&Array.isArray(m.inspirations)&&w(m.inspirations)}catch(m){y((m==null?void 0:m.message)||"Not logged in")}})()},[]),s.useEffect(()=>{(async()=>{try{const m=t.id?Number(t.id):null;if(m){const W=await D(I.users.get(m),{requireAuth:!1});b(W),g(W.about||""),Array.isArray(W.inspirations)&&w(W.inspirations);const P=await D(I.users.videos(m)+Ee({limit:"60"}),{requireAuth:!1});x(P.items||[]);const U=await D(I.users.likes(m)+Ee({limit:"60"}),{requireAuth:!1});L(U.items||[])}else{if(!l)return;b(l),g(l.about||""),Array.isArray(l.inspirations)&&w(l.inspirations);const W=await D(I.users.myVideos+Ee({limit:"50"}),{requireAuth:!1});f(W.items||[]);const P=await D(I.users.likes(l.id)+Ee({limit:"60"}),{requireAuth:!1});L(P.items||[])}}catch{}})()},[t.id,l]),s.useEffect(()=>{de(!1)},[d==null?void 0:d.id]);async function se(m){try{const P=(await D(I.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:m})})).user||d;b(P),Array.isArray(P==null?void 0:P.inspirations)&&w(P.inspirations),t.id||h(P)}catch{}}return s.useEffect(()=>{let m;return B!==null&&u.trim().length>=2?m=setTimeout(async()=>{try{const W=await D(I.osu.usersSearch(u),{requireAuth:!1});X(Array.isArray(W.items)?W.items:[])}catch{}},250):X([]),()=>{m&&clearTimeout(m)}},[u,B]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:d?e.jsxs(e.Fragment,{children:[d.avatar_url&&e.jsx("img",{src:d.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[d.username,d.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${d.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:m=>m.currentTarget.style.opacity="1",onMouseLeave:m=>m.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Ze,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",d.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!q&&F.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),F.map((m,W)=>q?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Q(m.id),onMouseLeave:()=>Q(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const P=F.filter((U,he)=>he!==W);w(P),se(P)},children:e.jsx("img",{src:m.avatar_url,alt:m.username})}),oe===m.id&&e.jsxs("div",{className:"insp-tooltip",children:[m.username," — click to remove"]})]},m.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Q(m.id),onMouseLeave:()=>Q(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${m.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:m.avatar_url,alt:m.username})}),oe===m.id&&e.jsx("div",{className:"insp-tooltip",children:m.username})]},m.id)),q&&F.length<3&&new Array(3-F.length).fill(0).map((m,W)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>Q(-W-1),onMouseLeave:()=>Q(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{z(W),H(""),X([])},children:"+"}),oe===-W-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),B===W&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:u,onChange:P=>H(P.target.value)}),e.jsxs("div",{className:"insp-results",children:[$.length===0&&u.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),$.map(P=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(l&&Number(l.osu_user_id)===Number(P.id)){a("Kinda based, but no.",{variant:"warn"}),z(null);return}if(F.some(he=>he.id===P.id)){z(null);return}const U=[...F,{id:P.id,username:P.username,avatar_url:P.avatar_url}].slice(0,3);w(U),z(null),se(U)},children:[e.jsx("img",{src:P.avatar_url,alt:"avatar"}),e.jsx("span",{children:P.username})]},P.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>z(null),children:"Close"})]})]},`slot-${W}`))]}),q&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:S||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),q?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:v,onChange:m=>g(m.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const m=await D(I.auth.me,{method:"PATCH",body:JSON.stringify({about:v})});b(m.user||d),h(m.user||l)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(Xe,{size:16})})]})}):(()=>{const m=((d==null?void 0:d.about)||"").trim()||"No bio.",W=m.length>200,P=W&&!ae?m.slice(0,200)+"...":m;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:P}),W&&e.jsx("button",{onClick:()=>de(!ae),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:ae?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(is,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(St,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:m=>{const W=m.currentTarget.closest(".profile-tabs-unified");W.querySelectorAll(".profile-tab").forEach(U=>{U.classList.remove("active"),U.setAttribute("aria-selected","false")}),m.currentTarget.classList.add("active"),m.currentTarget.setAttribute("aria-selected","true"),W.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:m=>{const W=m.currentTarget.closest(".profile-tabs-unified");W.querySelectorAll(".profile-tab").forEach(U=>{U.classList.remove("active"),U.setAttribute("aria-selected","false")}),m.currentTarget.classList.add("active"),m.currentTarget.setAttribute("aria-selected","true"),W.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(q?_:A).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(q?_:A).map(m=>(q&&d?(d.id,d.username,d.avatar_url,d.is_admin,d.is_mod):m.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>te({...m}),children:[m.poster_url?e.jsx("img",{className:"recent-thumb",src:m.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ct,{size:12}),e.jsx("span",{children:m.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:12}),e.jsx("span",{children:m.comments_count??0})]})]})})]},m.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[E.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),E.map(m=>{var W,P;return e.jsxs("button",{className:"recent-cell",onClick:()=>te(m),children:[m.poster_url?e.jsx("img",{className:"recent-thumb",src:m.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((W=m.uploader)==null?void 0:W.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:m.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(P=m.uploader)==null?void 0:P.username})]})]},m.id)})]})})})]})]}),c&&e.jsx(si,{open:!!c,onClose:()=>C(null),videoId:c.id,initialDescription:c.description,initialBeatmapUrl:c.beatmap_url,onSave:(m,W)=>{f(_.map(P=>P.id===c.id?{...P,description:m||null,beatmap_url:W}:P)),C(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function ii(){var W,P,U,he,fe;const[t,o]=s.useState(null),[a,l]=s.useState([]),[h,d]=s.useState(""),[b,S]=s.useState([]),[y,_]=s.useState(null),[f,E]=s.useState([]),[L,A]=s.useState("all"),[x,v]=s.useState("approvals"),[g,c]=s.useState(null),[C,F]=s.useState(""),[w,B]=s.useState(!1),{notify:z}=He(),[u,H]=s.useState(null),[$,X]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const i=await D(I.auth.me,{requireAuth:!1});if(o(i),i!=null&&i.is_admin)try{const T=await D(I.admin.settingsModeration,{requireAuth:!1});c(!!T.require_approval)}catch{}}catch{}try{const i=await D(I.admin.videosPending+Ee({limit:"50"}),{requireAuth:!1});l(i.items||[])}catch{}})()},[]);async function oe(){X(!0);try{const i=await D(I.admin.analytics,{requireAuth:!1});H(i)}finally{X(!1)}}async function Q(){try{const i=await D(I.admin.usersSearch(h),{requireAuth:!1});S(i.items||[])}catch{}}async function ae(i){_(i),E([]);try{const T=await D(I.admin.userVideos(i.id)+Ee({limit:"50"}),{requireAuth:!1});E(T.items||[])}catch{}}async function de(i,T){try{const le=await D(I.admin.user(i.id),{method:"PATCH",body:JSON.stringify({is_mod:T})}),Z=(le==null?void 0:le.user)||{...i,is_mod:T};z(T?"Granted moderation":"Revoked moderation",{variant:T?"success":"warn"}),_(Z),S(b.map(re=>re.id===i.id?Z:re))}catch{alert("Failed to update")}}const q=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),te=!!(t!=null&&t.is_admin);if(!q)return e.jsx("div",{className:"muted",children:"You do not have access."});const se=a.filter(i=>!i.flagged_only),m=a.filter(i=>!!i.flagged_only);return e.jsx("div",{className:"feed-container moderation-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"muted moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[e.jsx("button",{role:"tab","aria-selected":x==="approvals",className:`profile-tab ${x==="approvals"?"active":""}`,"data-tab":"approvals",onClick:i=>{const T=i.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),v("approvals")},children:"Approvals"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":x==="manage",className:`profile-tab ${x==="manage"?"active":""}`,"data-tab":"manage",onClick:i=>{const T=i.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),v("manage")},children:"Manage"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":x==="analytics",className:`profile-tab ${x==="analytics"?"active":""}`,"data-tab":"analytics",onClick:i=>{const T=i.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),v("analytics"),u||oe()},children:"Analytics"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":x==="message",className:`profile-tab ${x==="message"?"active":""}`,"data-tab":"message",onClick:i=>{const T=i.currentTarget.closest(".profile-tabs-unified");T.querySelectorAll(".profile-tab").forEach(Z=>{Z.classList.remove("active"),Z.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),T.querySelector(".profile-tabs-content").setAttribute("data-active","message"),v("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":x,children:[e.jsx("div",{className:"panel approvals",hidden:x!=="approvals",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[se.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[se.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),se.map(i=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[i.poster_url?e.jsx("img",{src:i.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",i.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await D(I.admin.videosReject(i.id),{method:"POST"}),l(a.filter(T=>T.id!==i.id)),z("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{try{await D(I.admin.videosApprove(i.id),{method:"POST"}),l(a.filter(T=>T.id!==i.id)),z("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{flex:1,minWidth:"calc(33.333% - 6px)"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await D(I.videos.delete(i.id),{method:"DELETE"}),l(a.filter(T=>T.id!==i.id)),z("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[m.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"60vh"},children:[m.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),m.map(i=>e.jsxs("div",{className:"col moderation-video-card flagged",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[i.poster_url?e.jsx("img",{src:i.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:["uploader: ",i.username]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]})]}),e.jsx("div",{className:"row",children:e.jsx("button",{className:"btn secondary",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await D(I.videos.delete(i.id),{method:"DELETE"}),l(a.filter(T=>T.id!==i.id)),z("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},i.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:x!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:h,onChange:i=>d(i.target.value),onKeyDown:i=>{i.key==="Enter"&&Q()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:Q,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:b.map(i=>e.jsxs("button",{className:"btn secondary moderation-user-result",onClick:()=>ae(i),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center"},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),i.is_admin?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"admin"}):i.is_mod?e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"mod"}):i.is_blacklisted?e.jsx("span",{style:{color:"#f87171",fontSize:12,flexShrink:0},children:"blacklisted"}):null]},i.id))})})]}),y?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:12,flexWrap:"wrap"},children:[y.avatar_url&&e.jsx("img",{src:y.avatar_url,width:40,height:40,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:4},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:y.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",y.id," • osu ",y.osu_user_id]})]})]}),e.jsxs("div",{className:"col",style:{gap:10},children:[te&&!y.is_admin&&(y.is_mod?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>de(y,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>de(y,!0),children:"Grant moderation"})),!y.is_admin&&(y.is_blacklisted?e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await D(I.admin.user(y.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),_({...y,is_blacklisted:!1}),z("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:async()=>{try{await D(I.admin.user(y.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),_({...y,is_blacklisted:!0}),z("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),y.is_admin&&e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"})]}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>A("all"),children:"All"}),e.jsx("button",{className:"btn secondary compact",style:{minHeight:"36px",padding:"8px 16px"},onClick:()=>A("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[f.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),f.filter(i=>{if(L==="all")return!0;const T=(g?!i.approved_at:!1)&&i.status==="ready",le=!!i.needs_review;return T||le}).map(i=>e.jsxs("div",{className:"col moderation-video-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:12},children:[i.poster_url?e.jsx("img",{src:i.poster_url,width:80,height:45,style:{objectFit:"cover",borderRadius:8,flexShrink:0}}):e.jsx("div",{style:{width:80,height:45,borderRadius:8,background:"#0f1217",flexShrink:0}}),e.jsxs("div",{className:"col",style:{minWidth:0,flex:1,gap:6},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.4,wordBreak:"break-word"},title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.4},children:[e.jsxs("div",{children:[i.status.toUpperCase()," • ",new Date(i.created_at*1e3).toLocaleString()]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:[i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,g&&!i.approved_at&&i.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]})]})]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:14},children:i.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)",fontSize:16},children:"★"})]}),e.jsxs("div",{className:"row",style:{gap:8},children:[(te||(t==null?void 0:t.is_mod))&&(!!i.needs_review||g&&!i.approved_at&&i.status==="ready")&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await D(I.admin.videosApprove(i.id),{method:"POST"}),E(f.map(T=>T.id===i.id?{...T,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:T)),z("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(te||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await D(I.videos.delete(i.id),{method:"DELETE"}),E(f.filter(T=>T.id!==i.id)),z("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]})]},i.id))]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:x!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:h,onChange:i=>d(i.target.value),onKeyDown:i=>{i.key==="Enter"&&Q()},className:"moderation-input",style:{width:"100%",fontSize:16,color:"inherit"}}),e.jsx("button",{className:"btn secondary",onClick:Q,style:{width:"100%",minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:12},children:b.map(i=>e.jsxs("button",{className:`btn secondary moderation-user-result ${(y==null?void 0:y.id)===i.id,""}`,onClick:()=>_(i),style:{justifyContent:"flex-start",textAlign:"left",alignItems:"center",border:(y==null?void 0:y.id)===i.id?"2px solid var(--accent)":void 0},children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:24,height:24,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),(y==null?void 0:y.id)===i.id&&e.jsx("span",{style:{color:"var(--accent)",fontSize:12,flexShrink:0},children:"selected"})]},i.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:i=>B(i.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",width:"100%",fontSize:16,color:"inherit",fontFamily:"inherit"},value:C,onChange:i=>F(i.target.value)}),e.jsx("button",{className:"btn secondary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const i=(C||"").trim();if(!i){alert("Enter a message");return}(async()=>{try{const T={text:i,global:w};!w&&(y!=null&&y.id)&&(T.user_id=y.id),await D(I.admin.notificationsSystem,{method:"POST",body:JSON.stringify(T)}),F(""),z("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:x!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Analytics"}),$&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!$&&!u&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(ve,{label:"Users",value:u.totals.users_total}),e.jsx(ve,{label:"Admins",value:u.totals.users_admin}),e.jsx(ve,{label:"Mods",value:u.totals.users_mod}),e.jsx(ve,{label:"Blacklisted",value:u.totals.users_blacklisted}),e.jsx(ve,{label:"Videos",value:u.totals.videos_total}),e.jsx(ve,{label:"Ready",value:u.totals.videos_ready}),e.jsx(ve,{label:"Pending",value:u.totals.pending_count}),e.jsx(ve,{label:"Purgatory",value:u.totals.purgatory_count}),e.jsx(ve,{label:"Likes",value:u.totals.likes_total}),e.jsx(ve,{label:"Flags",value:u.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Ke,{title:"New users (30d)",series:u.series.users,color:"#60a5fa"}),e.jsx(Ke,{title:"New videos (30d)",series:u.series.videos,color:"#34d399"}),((P=(W=u.stream)==null?void 0:W.graphql)==null?void 0:P.minutes_viewed)&&u.stream.graphql.minutes_viewed.length>0&&e.jsx(Ke,{title:"Minutes viewed (30d)",series:u.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"clamp(16px, 4vw, 18px)"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",u.feed.count," items in rotation",u.feed.cursor?` • cursor ${u.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",u.stream.approximate.total_duration_sec," • ready videos: ",u.stream.approximate.videos_ready]}),u.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",u.stream.api.ok?"ok":"unavailable",(he=(U=u.stream.api)==null?void 0:U.result_info)!=null&&he.count?` • count ${u.stream.api.result_info.count}`:"",(fe=u.stream.api)!=null&&fe.sample_status?` • sample status ${String(u.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})})}function ve({label:t,value:o}){return e.jsxs("div",{className:"col moderation-stat-card",children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",style:{fontSize:"clamp(18px, 4vw, 20px)"},children:o})]})}function Ke({title:t,series:o,color:a}){const[l,h]=s.useState(!1);s.useEffect(()=>{const u=()=>{h(window.matchMedia("(max-width: 480px)").matches)};u();const H=window.matchMedia("(max-width: 480px)");return H.addEventListener("change",u),()=>H.removeEventListener("change",u)},[]);const d=l?Math.min(400,window.innerWidth-48):400,b=160,S=8,y=8,_=28,f=l?36:42,E=o.map(u=>u.count),L=Math.max(1,...E),A=s.useMemo(()=>{const u=L,H=Math.pow(10,Math.floor(Math.log10(u))),$=u/H;return($<=1?1:$<=2?2:$<=5?5:10)*H},[L]),x=d-f-y,v=b-S-_,g=s.useMemo(()=>o.map((u,H)=>{const $=f+H/Math.max(1,o.length-1)*x,X=S+(1-u.count/(A||1))*v;return[$,X]}),[o,A,x,v]),c=s.useMemo(()=>g.map((u,H)=>H===0?`M ${u[0]} ${u[1]}`:`L ${u[0]} ${u[1]}`).join(" "),[g]),C=[0,.25,.5,.75,1],F=s.useMemo(()=>{if(o.length===0)return[];const u=[0,.25,.5,.75,1].map(H=>Math.min(o.length-1,Math.round(H*(o.length-1))));return Array.from(new Set(u))},[o]),w=u=>{if(!u||u.length<10)return u||"";const H=u.slice(5,7).replace(/^0/,""),$=u.slice(8,10).replace(/^0/,"");return`${H}/${$}`};function B(u){const H=Number.isInteger(u);return u>=1e6?`${(u/1e6).toFixed(1).replace(/\.0$/,"")}M`:u>=1e3?`${(u/1e3).toFixed(1).replace(/\.0$/,"")}k`:H?String(u):u<10?u.toFixed(1):u.toFixed(1).replace(/\.0$/,"")}const z=o.length?o[o.length-1].count:0;return e.jsxs("div",{className:"col moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:l?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:l?11:12},children:["latest: ",B(z)]})]}),e.jsx("div",{style:{width:"100%",overflowX:"auto"},children:e.jsxs("svg",{width:d,height:b,role:"img","aria-label":t,style:{display:"block"},children:[e.jsx("rect",{x:0,y:0,width:d,height:b,fill:"#0f1217",rx:12}),C.map((u,H)=>{const $=S+(1-u)*v,X=u*A;return e.jsxs("g",{children:[e.jsx("line",{x1:f,y1:$,x2:d-y,y2:$,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:f-6,y:$+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:B(X)})]},H)}),e.jsx("line",{x1:f,y1:S,x2:f,y2:S+v,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:f,y1:S+v,x2:f+x,y2:S+v,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),F.map((u,H)=>{var X;const $=f+u/Math.max(1,o.length-1)*x;return e.jsxs("g",{children:[e.jsx("line",{x1:$,y1:S,x2:$,y2:S+v,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:$,y:S+v+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:w((X=o[u])==null?void 0:X.day)})]},H)}),e.jsx("path",{d:c,fill:"none",stroke:a,strokeWidth:2}),g.length>0&&e.jsx("circle",{cx:g[g.length-1][0],cy:g[g.length-1][1],r:3,fill:a})]})})]})}function ni(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function ai(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const ri=()=>(s.useEffect(()=>()=>{Ls.clearAll()},[]),e.jsx(zs,{})),oi=()=>e.jsx(os,{children:e.jsxs(ce,{element:e.jsx(Gs,{}),children:[e.jsx(ce,{path:"/",element:e.jsx(Ks,{})}),e.jsx(ce,{path:"/mp/discover",element:e.jsx(ti,{})}),e.jsx(ce,{path:"/mp/feed",element:e.jsx(Zs,{})}),e.jsx(ce,{path:"/mp/feed/:uid",element:e.jsx(ps,{})}),e.jsx(ce,{path:"/md/feed",element:e.jsx(js,{})}),e.jsx(ce,{path:"/md/feed/:uid",element:e.jsx(ws,{})}),e.jsx(ce,{path:"/md/queues",element:e.jsx(Ns,{})}),e.jsx(ce,{path:"/md/queues/:id",element:e.jsx(ks,{})}),e.jsx(ce,{path:"/md/notifications",element:e.jsx(Ss,{})}),e.jsx(ce,{path:"/profile",element:e.jsx(vt,{})}),e.jsx(ce,{path:"/profile/:id",element:e.jsx(vt,{})}),e.jsx(ce,{path:"/moderation",element:e.jsx(ii,{})}),e.jsx(ce,{path:"/about",element:e.jsx(ni,{})}),e.jsx(ce,{path:"/settings",element:e.jsx(ai,{})}),e.jsx(ce,{path:"/editor",element:e.jsx(ri,{})})]})}),li=()=>e.jsx(rs,{children:e.jsx(oi,{})});ns(document.getElementById("root")).render(e.jsx(As,{children:e.jsx(as,{client:Rs,children:e.jsx(ms,{children:e.jsx(li,{})})})}));
