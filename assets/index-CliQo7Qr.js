const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/About-DgGXV8RR.js","assets/vendor-react-O-yBVenC.js","assets/vendor-CDuzPMMG.js","assets/moddi-routes-BAHBGzbB.js","assets/mappi-routes-BuYlJIUY.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-lib-DWtn2wJw.js","assets/beatmap-preview-C79RZ3qw.js","assets/vendor-zip-ChfUW0Uy.js","assets/editor-lib-CGytSYYz.css","assets/editor-components-n6sMInZP.js","assets/editor-components-Bzmrvihl.css","assets/Moderation-DgVwM8bp.js","assets/Settings-B-E92wyK.js"])))=>i.map(i=>d[i]);
var At=Object.defineProperty;var Pt=(t,m,c)=>m in t?At(t,m,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[m]=c;var ht=(t,m,c)=>Pt(t,typeof m!="symbol"?m+"":m,c);import{r as a,j as e,e as Ze,u as et,R as ne,L as M,T as Je,U as Ft,V as Dt,B as Xe,W as wt,X as Ot,Y as $t,Z as qt,O as ft,K as Wt,A as Nt,h as kt,P as Ut,Q as Bt,E as Ht,c as tt,H as Vt,l as St,_ as Fe,y as Qt,v as Yt,b as Jt,a as Xt,i as _t,g as Ct,k as Ke,$ as Kt,a0 as xt,o as Gt,x as Zt,a1 as es,a2 as ts,a3 as ss,a4 as ns,a5 as H}from"./vendor-react-O-yBVenC.js";import{y as as}from"./vendor-CDuzPMMG.js";import{u as st,a as A,A as I,c as Ge,P as is,b as Ce,d as rs,C as os,T as ls}from"./mappi-routes-BuYlJIUY.js";import{H as cs,c as ds,b as us,a as ms,i as ps}from"./editor-components-n6sMInZP.js";import{u as He,a as nt,b as hs,c as fs,d as xs,e as gs,f as bs,g as ys,C as vs,M as js}from"./moddi-routes-BAHBGzbB.js";import{B as ws,E as Ns}from"./editor-lib-DWtn2wJw.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-C79RZ3qw.js";import"./vendor-zip-ChfUW0Uy.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))r(f);new MutationObserver(f=>{for(const d of f)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function c(f){const d={};return f.integrity&&(d.integrity=f.integrity),f.referrerPolicy&&(d.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?d.credentials="include":f.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(f){if(f.ep)return;f.ep=!0;const d=c(f);fetch(f.href,d)}})();const ks="modulepreload",Ss=function(t){return"/"+t},gt={},ee=function(m,c,r){let f=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),E=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));f=Promise.allSettled(c.map(_=>{if(_=Ss(_),_ in gt)return;gt[_]=!0;const R=_.endsWith(".css"),b=R?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${b}`))return;const w=document.createElement("link");if(w.rel=R?"stylesheet":ks,R||(w.as="script"),w.crossOrigin="",w.href=_,E&&w.setAttribute("nonce",E),document.head.appendChild(w),R)return new Promise((L,C)=>{w.addEventListener("load",L),w.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${_}`)))})}))}function d(v){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=v,window.dispatchEvent(E),!E.defaultPrevented)throw v}return f.then(v=>{for(const E of v||[])E.status==="rejected"&&d(E.reason);return m().catch(d)})},_s=new as({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Cs extends a.Component{constructor(c){super(c);ht(this,"handleRetry",()=>{const c=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),c&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(c){return{hasError:!0,error:c}}componentDidCatch(c,r){console.error("ErrorBoundary caught an error:",c,r)}isChunkLoadingError(c){if(!c)return!1;const r=c.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||c.name==="ChunkLoadError"}render(){var c;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),f=((c=this.state.error)==null?void 0:c.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":f}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const ge=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Es({i:t}){const m=t*1337,c=(C,V)=>{const q=Math.sin(m+C+V)*1e4,X=q-Math.floor(q);return Math.floor(X*(V-C+1)+C)},r=c(0,100),f=c(24,50),d=.7+c(0,100)/100*.3,v=f*d,E=c(0,4e3),_=c(-10,10),R=c(-8,8),b=c(0,100),w=b<60?1:b<80?1.5:2,L=[{size:200*w,alpha:.06,dx:-22,dy:12,color:ge[c(0,ge.length-1)]},{size:150*w,alpha:.08,dx:-9,dy:7,color:ge[c(0,ge.length-1)]},{size:120*w,alpha:.1,dx:0,dy:0,color:ge[c(0,ge.length-1)]},{size:90*w,alpha:.12,dx:12,dy:-4,color:ge[c(0,ge.length-1)]},{size:64*w,alpha:.13,dx:20,dy:-7,color:ge[c(0,ge.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${v}s`,animationDelay:`${E}ms`,"--tx":`${_}vw`,transform:`rotate(${R}deg)`},children:L.map((C,V)=>e.jsx("svg",{width:C.size,height:C.size,viewBox:"0 0 100 100",style:{left:`${50+C.dx}%`,bottom:`${C.dy}px`,transform:"translateX(-50%)","--alpha":C.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:C.color})},V))})}function Et({paused:t=!1}){const m=a.useMemo(()=>new Array(20).fill(0).map((c,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:m.map(c=>e.jsx(Es,{i:c},c))})}function Is(){const t=Ze(),m=et(),{lastSection:c}=He(),r=t.pathname==="/"||t.pathname==="/about"||t.pathname==="/md/notifications",f=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!r&&t.pathname.startsWith("/md/");const d=t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"||!r&&!t.pathname.startsWith("/mp/")&&c==="moddi";if(f||r)return null;const v=()=>{m(d?"/mp/feed":"/md/feed")},E=ne.useRef(null),_=ne.useRef(!1),R=()=>{_.current=!1,E.current=setTimeout(()=>{_.current=!0,m("/")},500)},b=()=>{E.current&&(clearTimeout(E.current),E.current=null),_.current&&setTimeout(()=>{_.current=!1},100)},w=C=>{if(_.current){C.preventDefault(),C.stopPropagation();return}v()},L=C=>{b(),_.current&&C.preventDefault()};return ne.useEffect(()=>()=>{E.current&&clearTimeout(E.current)},[]),e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(M,{to:d?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(Je,{size:20})}),d?e.jsx(M,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Ft,{size:20})}):e.jsx(M,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(Dt,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:w,onTouchStart:R,onTouchEnd:L,onMouseDown:R,onMouseUp:b,onMouseLeave:b,"aria-label":d?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:d?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:d?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsx(M,{to:"/profile",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/profile")?"active":""}`,"aria-label":"Profile",children:e.jsx(Xe,{size:20})}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>m("/settings"),"aria-label":"Settings",children:e.jsx(wt,{size:20})})]})]})}function _e(t){t._preloading||(t._preloading=!0,t().then(()=>{t._preloaded=!0}).catch(()=>{delete t._preloading}))}function Rs(t){t.forEach(_e)}function Ts(t){const m=()=>{Rs(t)};"requestIdleCallback"in window?requestIdleCallback(m,{timeout:2e3}):setTimeout(m,1e3)}function Ls(){const t=Ze(),m=et(),{notify:c}=st(),{data:r,isLoading:f}=nt(),{data:d}=hs(!!r),{data:v=[]}=fs(!!r),E=xs(),_=gs(),R=bs(),b=ys(),[w,L]=a.useState(new Set),C=a.useRef(null),V=a.useRef(null),q=a.useRef(null),X=a.useRef(null),N=a.useRef(null),P=a.useRef(null),z=a.useRef(null),x=a.useRef(null),{menuOpen:K,mobileNavOpen:W,notifOpen:O,filtersOpen:te,modeFilters:ie,tagFilters:de,queueStatusFilters:re,lastSection:F,setMenuOpen:Q,setMobileNavOpen:G,setNotifOpen:T,setFiltersOpen:Z,closeAllPanels:ae,setModeFilters:l,setTagFilters:k,setQueueStatusFilters:j,setLastSection:U}=He(),oe=t.pathname==="/"||t.pathname==="/about"||t.pathname==="/md/notifications",Ee=t.pathname==="/editor",be=t.pathname.startsWith("/mp/")||!oe&&!t.pathname.startsWith("/md/")&&F==="mappi",Y=t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"||!oe&&!t.pathname.startsWith("/mp/")&&F==="moddi",Oe=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";ne.useEffect(()=>{t.pathname.startsWith("/mp/")?U("mappi"):t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"&&U("moddi")},[t.pathname,U]);const[$e,he]=ne.useState(0);ne.useEffect(()=>{const i=setInterval(()=>he(p=>p+1),1e3);return()=>clearInterval(i)},[]);const[je,we]=ne.useState(null);ne.useEffect(()=>{!r||!r.is_mod||(async()=>{try{const i=await A(I.admin.debugState,{requireAuth:!1}),p=Array.isArray(i==null?void 0:i.counts)?i.counts.find(h=>String(h.status)==="ready"):null;p&&we(Number(p.c)||0)}catch{}})()},[r]);const[Ne,Ie]=ne.useState(!1),B=async()=>{Ie(!0);try{const i=await A(I.admin.clearViews,{method:"POST"});c(`Cleared ${Number((i==null?void 0:i.deleted)||0)} views from your history.`,{variant:"success"});try{localStorage.removeItem("feed_seen_ids")}catch{}try{window.dispatchEvent(new Event("filterchange"))}catch{}}catch{c("Failed to clear view history",{variant:"error"})}finally{Ie(!1)}},qe=i=>{if(!i)return null;try{const p=JSON.parse(i);if((p==null?void 0:p.type)==="queue_invite"&&(p!=null&&p.queue_id))return p}catch{}return null},ke=async(i,p)=>{if(!w.has(i.id)){L(h=>new Set(h).add(i.id));try{await A(I.moddi.queueAccept(String(p)),{method:"POST"}),c("Invitation accepted!",{variant:"success"}),b.mutate(i.id),T(!1),m(`/md/queues/${p}`)}catch(h){c((h==null?void 0:h.message)||"Failed to accept invitation",{variant:"error"})}finally{L(h=>{const S=new Set(h);return S.delete(i.id),S})}}},Re=async(i,p)=>{if(!w.has(i.id)){L(h=>new Set(h).add(i.id));try{await A(I.moddi.queueDeny(String(p)),{method:"POST"}),c("Invitation declined",{variant:"success"}),b.mutate(i.id)}catch(h){c((h==null?void 0:h.message)||"Failed to decline invitation",{variant:"error"})}finally{L(h=>{const S=new Set(h);return S.delete(i.id),S})}}},Te=async()=>{const i=v.filter(p=>p.id.startsWith("n:")||p.kind==="system"&&!p.read).map(p=>p.id);i.length>0&&R.mutate(i)},Le=async i=>{if(T(!1),R.mutate([i.id]),i.kind==="system"||i.id.startsWith("n:"))try{await A(I.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[i.id]})})}catch{}},Me=async(i,p)=>{i.stopPropagation(),b.mutate(p)},ze=()=>{const p=Object.entries(ie).filter(([h,S])=>S).map(([h])=>h);p.length,p.length===0&&l({standard:!0,taiko:!1,mania:!1,catch:!1});try{window.dispatchEvent(new Event("filterchange"))}catch{}Z(!1)},Se=()=>{const p=Object.entries(de).filter(([h,S])=>S).map(([h])=>h);p.length,p.length===0&&k({untagged:!0,help:!0});try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}Z(!1)};return ne.useEffect(()=>{r&&!localStorage.getItem("welcomed")&&(c(`Welcome, ${r.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[r,c]),ne.useEffect(()=>{if(!O)return;const i=p=>{const h=p.target;V.current&&!V.current.contains(h)&&C.current&&!C.current.contains(h)&&T(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[O,T]),ne.useEffect(()=>{if(!K)return;const i=p=>{const h=p.target;X.current&&!X.current.contains(h)&&q.current&&!q.current.contains(h)&&Q(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[K,Q]),ne.useEffect(()=>{if(!W)return;const i=p=>{const h=p.target;P.current&&!P.current.contains(h)&&N.current&&!N.current.contains(h)&&G(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[W,G]),ne.useEffect(()=>{if(!te)return;const i=p=>{const h=p.target;x.current&&!x.current.contains(h)&&z.current&&!z.current.contains(h)&&Z(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[te,Z]),e.jsxs("div",{className:"app-shell","data-section":Y?"moddi":be?"mappi":F==="moddi"?"moddi":F==="mappi"?"mappi":void 0,children:[e.jsx(Et,{paused:t.pathname==="/editor"}),e.jsxs("header",{className:"top-nav",children:[t.pathname!=="/editor"&&e.jsxs("div",{className:"mobile-nav",children:[e.jsx("button",{ref:N,className:"icon-link hamburger",onClick:()=>{W||ae(),G(i=>!i)},"aria-label":"Menu","aria-expanded":W,children:e.jsx(Ot,{size:18})}),W&&e.jsxs("div",{ref:P,className:"menu-panel",role:"menu",children:[oe&&e.jsx(M,{to:t.pathname==="/"?"/about":"/",className:`menu-item ${t.pathname==="/about"?"active":""}`,onClick:()=>G(!1),onMouseEnter:()=>t.pathname==="/"&&_e(()=>ee(()=>import("./About-DgGXV8RR.js"),__vite__mapDeps([0,1,2]))),children:t.pathname==="/"?"About":"Home"}),be&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/mp/feed",className:`menu-item ${t.pathname==="/mp/feed"?"active":""}`,onClick:()=>G(!1),children:"Feed"}),e.jsx(M,{to:"/mp/discover",className:`menu-item ${t.pathname==="/mp/discover"?"active":""}`,onClick:()=>G(!1),children:"Discover"})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/md/feed",className:`menu-item ${t.pathname==="/md/feed"?"active":""}`,onClick:()=>G(!1),children:"Feed"}),e.jsx(M,{to:"/md/queues",className:`menu-item ${t.pathname.startsWith("/md/queues")?"active":""}`,onClick:()=>G(!1),onMouseEnter:()=>_e(()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(i=>i.Q),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),children:"Queues"})]}),!be&&!Y&&!oe&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/mp/feed",className:`menu-item ${t.pathname==="/mp/feed"?"active":""}`,onClick:()=>G(!1),children:"Feed"}),e.jsx(M,{to:"/mp/discover",className:`menu-item ${t.pathname==="/mp/discover"?"active":""}`,onClick:()=>G(!1),children:"Discover"})]})]})]}),oe?e.jsx(M,{to:"/",className:"title",children:Y?"osu!moddi.ng":be?"osu!mappi.ng":"mappi!"}):Ee?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(M,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Je,{size:18})}),e.jsx(M,{to:Y?"/md/feed":"/mp/feed",className:"title",children:Y?"osu!moddi.ng":"osu!mappi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(M,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Je,{size:18})}),e.jsxs(M,{to:Y?"/mp/feed":"/md/feed",className:"title coin-flip-title",children:[e.jsx("span",{className:"coin-flip-front",children:Y?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:Y?"osu!mappi.ng":"osu!moddi.ng"})]})]}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),t.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(cs,{})}):e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[oe&&e.jsx(M,{to:t.pathname==="/"?"/about":"/",className:t.pathname==="/about"?"active":"",onMouseEnter:()=>t.pathname==="/"&&_e(()=>ee(()=>import("./About-DgGXV8RR.js"),__vite__mapDeps([0,1,2]))),children:t.pathname==="/"?"About":"Home"}),be&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/mp/feed",className:t.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(M,{to:"/mp/discover",className:t.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(M,{to:"/editor",className:t.pathname==="/editor"?"active":"",children:"Editor"})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/md/feed",className:t.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(M,{to:"/md/queues",className:t.pathname.startsWith("/md/queues")?"active":"",onMouseEnter:()=>_e(()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(i=>i.Q),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),children:"Queues"})]}),!be&&!Y&&!oe&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/mp/feed",className:t.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(M,{to:"/mp/discover",className:t.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(M,{to:"/editor",className:t.pathname==="/editor"?"active":"",children:"Editor"})]})]}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx($t,{size:18})}),r?e.jsxs("div",{className:"user-menu",children:[e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:C,className:"icon-link",onClick:()=>{O||ae(),T(i=>!i)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(qt,{size:18})}),E>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),O&&e.jsxs("div",{ref:V,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(M,{to:"/md/notifications",onClick:()=>T(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:i=>i.currentTarget.style.opacity="1",onMouseLeave:i=>i.currentTarget.style.opacity="0.7",children:"View all"}),v.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:Te,children:e.jsx(ft,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[v.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),v.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).map(i=>{const p=qe(i.text),h=i.id.startsWith("b:"),S=p?"queue-invite":i.kind==="star"?"star":i.kind==="likes5"?"likes":i.kind==="comment"?"comment":i.kind==="inspiration"?"inspiration":i.kind==="reaction"?"reaction":h?"global":"system",J=i.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${S}`,role:"button",onClick:()=>!p&&Le(i),children:[e.jsxs("div",{className:`notif-icon ${J?"deletable":""}`,"aria-hidden":"true",onClick:J&&!p?s=>Me(s,i.id):void 0,title:J&&!p?"Remove":void 0,role:J&&!p?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:p?e.jsx(Wt,{}):S==="star"?e.jsx(Nt,{}):S==="likes"?e.jsx(kt,{}):S==="comment"?e.jsx(Xe,{}):S==="inspiration"?e.jsx(Xe,{}):S==="reaction"?e.jsx(Ut,{}):S==="global"?e.jsx(Bt,{}):null}),J&&!p?e.jsx("span",{className:"swap-trash",children:e.jsx(Ht,{})}):null]}),e.jsx("div",{className:"notif-body",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[p.inviter_username," invited you to join queue: ",p.queue_name]}),w.has(i.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:s=>{s.stopPropagation(),ke(i,p.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(ft,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:s=>{s.stopPropagation(),Re(i,p.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(tt,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):i.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:h?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:i.text||""}),h&&i.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(i.expiresAt).toLocaleString()]}):null]}):i.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone commented on your post"})]}):i.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone is inspired by you!"})]}):i.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:i.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:i.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},i.id)})]})]})]}),d!=null&&d.blocked?e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(Vt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:(()=>{const i=Math.max(0,Math.floor((((d==null?void 0:d.reset_at)??0)*1e3-Date.now())/1e3)),p=Math.floor(i/3600),h=Math.floor(i%3600/60),S=i%60,J=s=>String(s).padStart(2,"0");return p>0?`${p}:${J(h)}:${J(S)}`:`${h}:${J(S)}`})()})]}):null,e.jsxs("button",{ref:q,className:"icon-link",onClick:()=>{K||ae(),Q(i=>!i)},title:r.username,"aria-label":"User menu","aria-expanded":K,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:r.username}),e.jsx(St,{size:14,style:{opacity:.8}})]}),K&&e.jsxs("div",{ref:X,className:"menu-panel",role:"menu",children:[e.jsx(M,{to:"/profile",className:"menu-item",onClick:()=>Q(!1),children:"Profile"}),r!=null&&r.is_admin||r!=null&&r.is_mod?e.jsx(M,{to:"/moderation",className:"menu-item",onClick:()=>Q(!1),onMouseEnter:()=>_e(()=>ee(()=>import("./Moderation-DgVwM8bp.js"),__vite__mapDeps([12,1,2,4,5,6,7,8,9]))),children:"Moderation"}):null,e.jsx("button",{className:"menu-item",type:"button",onClick:()=>_.mutate(),children:"Log out"})]})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Ge+I.auth.login},disabled:f,children:f?"Checking…":"Login with osu!"})]})]}),e.jsx("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:t.pathname==="/editor"?e.jsx(Fe,{}):t.pathname==="/mp/discover"?e.jsx(Fe,{}):t.pathname==="/"?e.jsx(Fe,{}):t.pathname==="/about"||t.pathname==="/moderation"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(Fe,{})}):e.jsx(Fe,{})}),t.pathname!=="/editor"&&e.jsxs(e.Fragment,{children:[r&&r.is_mod&&je!==null&&e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[je," videos ready"]})}),e.jsxs("div",{className:"site-controls","aria-hidden":!1,children:[e.jsx("button",{ref:z,className:"settings-btn",onClick:()=>{te||ae(),Z(i=>!i)},"aria-expanded":te,"aria-label":"Filter settings",title:"Filter settings",children:e.jsx(wt,{size:18})}),te&&e.jsx("div",{ref:x,className:"settings-panel",role:"dialog","aria-modal":"false",children:Oe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:8},children:[["unchecked","Pending","#f59e0b"],["accepted","Accepted","#10b981"],["denied","Denied","#ef4444"],["finished","Finished","#6366f1"],["archived","Archived","#6b7280"]].map(([i,p,h])=>{const S=re[i];return e.jsx("button",{className:`mode-cell ${S?"selected":""}`,"aria-pressed":S,onClick:()=>{j({...re,[i]:!S})},style:{padding:"10px 14px",borderRadius:8,fontSize:13,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontWeight:S?600:500,background:S?h+"15":"transparent",border:`1.5px solid ${S?h+"50":"rgba(255,255,255,0.08)"}`,color:S?h:"var(--text)",transition:"all 0.2s ease",cursor:"pointer",textAlign:"left",width:"100%"},onMouseEnter:J=>{S?(J.currentTarget.style.background=h+"25",J.currentTarget.style.borderColor=h+"70"):(J.currentTarget.style.background="rgba(255,255,255,0.05)",J.currentTarget.style.borderColor="rgba(255,255,255,0.12)")},onMouseLeave:J=>{J.currentTarget.style.background=S?h+"15":"transparent",J.currentTarget.style.borderColor=S?h+"50":"rgba(255,255,255,0.08)"},children:p},i)})}),e.jsx("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn secondary compact",onClick:()=>Z(!1),children:"Close"})})]}):Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:6},children:[["untagged","Untagged"],["help","Help"]].map(([i,p])=>{const h=de[i];return e.jsx("button",{className:`mode-cell ${h?"selected":""}`,"aria-pressed":h,onClick:()=>{k({...de,[i]:!h})},children:e.jsx("span",{children:p})},i)})}),r&&(r.is_admin||r.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:Ne,onClick:B,children:Ne?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>Z(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:Se,children:"Apply"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Game modes"}),e.jsx("div",{className:"col",style:{gap:6},children:[["standard","Standard",ds],["taiko","Taiko",us],["mania","Mania",ms],["catch","Catch",ps]].map(([i,p,h])=>{const S=ie[i];return e.jsxs("button",{className:`mode-cell ${S?"selected":""}`,"aria-pressed":S,onClick:()=>{l({...ie,[i]:!S})},children:[e.jsx("img",{className:"mode-icon",src:h,width:24,height:24,alt:""}),e.jsx("span",{children:p})]},i)})}),r&&(r.is_admin||r.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:Ne,onClick:B,children:Ne?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>Z(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:ze,children:"Apply"})]})]})})]})]}),e.jsx(Is,{})]})}function ve(t,m=2){return a.lazy(async()=>{let c=null;for(let f=0;f<m;f++)try{return await t()}catch(d){c=d,console.warn(`Failed to load chunk (attempt ${f+1}/${m}):`,d),f<m-1&&await new Promise(v=>setTimeout(v,500*Math.pow(2,f)))}const r=(c==null?void 0:c.message)||"Unknown error";throw new Error(`Failed to load component after ${m} attempts: ${r}`)})}function Ms(){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions",children:[e.jsx(M,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(M,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function zs(){const{data:t}=nt(),{modeFilters:m}=He(),c=Object.entries(m).filter(([f,d])=>d).map(([f])=>f),r=c.length?c.join(","):"standard";return Qt({queryKey:["mappi","feed",r],queryFn:async({pageParam:f=0})=>{const d=new URLSearchParams({limit:"20",offset:String(f),modes:r}),v=`${I.feed.recent}?${d.toString()}`;return await A(v)},enabled:!!t,initialPageParam:0,getNextPageParam:(f,d)=>{var _;const v=d.reduce((R,b)=>{var w;return R+(((w=b.items)==null?void 0:w.length)||0)},0);return(((_=f.items)==null?void 0:_.length)||0)===20?v:void 0}})}function De(){const t=Ze(),m=Yt(),{data:c}=nt(),{modeFilters:r}=He(),{data:f,fetchNextPage:d,hasNextPage:v,isFetching:E,isFetchingNextPage:_,refetch:R}=zs(),b=a.useMemo(()=>(f==null?void 0:f.pages.flatMap(N=>N.items||[]))||[],[f]),w=a.useMemo(()=>{const N=Object.entries(r).filter(([z,x])=>x).map(([z])=>z.toLowerCase()),P=new Set(N.length?N:["standard"]);return b.filter(z=>{const x=String(z.mode||"standard").toLowerCase();return P.has(x)})},[b,r]);a.useEffect(()=>{t.pathname==="/mp/feed"&&R()},[t.pathname,R]),a.useEffect(()=>{const N=()=>{R()};return window.addEventListener("filterchange",N),()=>window.removeEventListener("filterchange",N)},[R]);const L=N=>{m.setQueryData(["mappi","feed"],P=>P&&{...P,pages:P.pages.map(z=>({...z,items:z.items.map(x=>x.id===N.id?N:x)}))})},C=N=>{m.setQueryData(["mappi","feed"],P=>P&&{...P,pages:P.pages.map(z=>({...z,items:z.items.filter(x=>x.id!==N)}))})},V=()=>{R()},q=E&&!_,X=v??!1;return e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(vs,{section:"mappi",onUpload:V})]}),e.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[w.length===0&&!q&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),w.map(N=>e.jsx(is,{post:N,section:"mappi",onUpdate:L,onDelete:C,me:c},N.id)),w.length>0&&X&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>d(),disabled:_,children:_?"Loading...":"Load more"})})]})})]})}const pe={};function As(){try{const t=localStorage.getItem("feed_seen_ids");if(t){const m=JSON.parse(t);Array.isArray(m)&&(pe.seenIds=m.filter(c=>typeof c=="number"))}}catch{}return pe}function bt(t){Object.assign(pe,t);try{const m=Array.from(new Set(pe.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(m))}catch{}}function yt(){var ut,mt,pt;const{notify:t}=st(),[m,c]=a.useState(pe.history||[]),[r,f]=a.useState(pe.index??-1),[d,v]=a.useState(pe.queue||[]),[E,_]=a.useState(!1),[R,b]=a.useState(!1),[w,L]=a.useState(pe.eligibleCount??null),[C,V]=a.useState(pe.viewedCount??0),[q,X]=a.useState(!1),[N,P]=a.useState(!0),[z,x]=a.useState(!1),[K,W]=a.useState(!1),[O,te]=a.useState(!1),[ie,de]=a.useState(!1),[re,F]=a.useState(!1),[Q,G]=a.useState([]),[T,Z]=a.useState(""),[ae,l]=a.useState(null),[k,j]=a.useState(!1),[U,oe]=a.useState(null),[Ee,be]=a.useState(!1),Y=a.useRef(new Set(pe.seenIds||[])),Oe=a.useRef(new Set),$e=a.useRef(!1),he=a.useRef(pe.lastShownVideoId??null),je=a.useRef(!1),we=a.useRef(0),Ne=a.useRef(0),Ie=a.useRef(0),B=a.useRef(null),qe=a.useRef(null),ke=a.useRef(null),Re=a.useRef(null),Te=a.useRef(null),Le=a.useRef(null),Me=a.useRef(null),ze=a.useRef(null),Se=a.useRef(0),i=a.useRef(0),p=a.useRef(null),h=a.useRef(null),[S,J]=a.useState(0),s=a.useMemo(()=>r>=0?m[r]:null,[m,r]);a.useEffect(()=>{As()},[]),a.useEffect(()=>{bt({history:m,index:r,queue:d,seenIds:Array.from(Y.current),eligibleCount:w??void 0,viewedCount:C,lastShownVideoId:he.current??void 0})},[m,r,d,w,C]);const ye=a.useCallback(()=>{try{const n=localStorage.getItem("filter_modes"),o=(n?String(n):"standard").toLowerCase().split(",").map(y=>y.trim()).filter(Boolean),u=["standard","taiko","mania","catch"],g=Array.from(new Set(o.filter(y=>u.includes(y))));return g.length?g:["standard"]}catch{return["standard"]}},[]),at=a.useCallback(()=>{const n=new Set;return he.current!==null&&n.add(he.current),Array.from(Y.current).slice(-200).forEach(u=>n.add(u)),d.forEach(u=>n.add(u.id)),Array.from(n)},[d]),Ve=a.useCallback(async(n=3)=>{var g,y,$,ue;if($e.current)return[];const o=Date.now();if(o<we.current){const le=Math.ceil((we.current-o)/1e3);return t(`Rate limited. Please wait ${le}s.`,{durationMs:3e3,variant:"warn"}),[]}const u=o-Ie.current;if(u<2e3){const le=2e3-u;await new Promise(me=>setTimeout(me,le))}$e.current=!0,Ie.current=Date.now();try{const le=at(),me=ye().join(","),xe=[],Ue=new Set(d.map(se=>se.id));let Be=[...le];const Ae=Math.min(n,3);for(let se=0;se<Ae;se++){if(se>0){const D=Date.now()-Ne.current,ce=1e3;D<ce&&await new Promise(Pe=>setTimeout(Pe,ce-D))}try{Ne.current=Date.now();const D=await A(I.feed.next+Ce({exclude:Be.join(","),modes:me}),{requireAuth:!1}),ce=D&&("id"in D?D:D.video)||null;if(!ce)break;if(Y.current.has(ce.id)||Ue.has(ce.id)||ce.id===he.current){Be.push(ce.id);continue}xe.push(ce),Be.push(ce.id),Ue.add(ce.id)}catch(D){if((g=D==null?void 0:D.message)!=null&&g.includes("401")||(y=D==null?void 0:D.message)!=null&&y.includes("Unauthorized")){X(!0);break}else if(($=D==null?void 0:D.message)!=null&&$.includes("429")||(ue=D==null?void 0:D.message)!=null&&ue.includes("rate limit")){we.current=Date.now()+5e3,t("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(xe.length>0&&v(se=>{const D=new Set(se.map(Pe=>Pe.id)),ce=xe.filter(Pe=>!D.has(Pe.id));return[...se,...ce]}),xe.length===0&&d.length===0)try{const se=ye().join(","),D=await A(I.feed.progress(se),{requireAuth:!1});L(Number(D.eligible||0)),V(Number(D.viewed||0)),b(Number(D.caught_up||0)===1)}catch{}return xe}catch{return[]}finally{$e.current=!1}},[at,ye,d,t]),fe=a.useCallback(async()=>{if(!E){_(!0);try{d.length<=2&&Ve(3).catch(()=>{});let n;if(d.length>0)n=d[0],v(o=>o.filter(u=>u.id!==n.id));else{const o=await Ve(3);o.length>0&&(n=o[0],o.length>1&&v(u=>{const g=new Set(u.map($=>$.id)),y=o.slice(1).filter($=>!g.has($.id));return[...u,...y]}))}if(n)he.current=n.id,Y.current.add(n.id),bt({seenIds:Array.from(Y.current)}),c(o=>{const u=[...o.slice(0,r+1),n];return f(u.length-1),u}),Oe.current.has(n.id)||(Oe.current.add(n.id),A(I.videos.view(n.id),{method:"POST"}).then(o=>{o&&c(u=>{const g=[...u],y=g.findIndex($=>$.id===n.id);return y!==-1&&(g[y]={...g[y],views_count:o.views_count??g[y].views_count??0,viewed_by_me:!0}),g})}).catch(()=>{}));else try{const o=ye().join(","),u=await A(I.feed.progress(o),{requireAuth:!1});L(Number(u.eligible||0)),V(Number(u.viewed||0)),b(Number(u.eligible||0)>0&&Number(u.viewed||0)>=Number(u.eligible||0))}catch{}}finally{_(!1)}}},[E,d,Ve,r,ye]),It=a.useCallback(()=>{B.current&&!B.current.paused&&B.current.pause(),x(!0),F(!1)},[]),Qe=a.useCallback(()=>{r>0&&(f(r-1),x(!1))},[r]),Ye=a.useCallback(()=>{const n=Date.now();if(!(n-i.current<300)){if(i.current=n,N||(je.current=!0,P(!1)),r<m.length-1){const o=m[r+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:r,nextIndex:r+1,currentVideoId:s==null?void 0:s.id,nextVideoId:o==null?void 0:o.id,nextVideoStreamUID:o==null?void 0:o.stream_uid}),o&&(he.current=o.id),f(r+1),x(!1);return}if(!R){if(Date.now()<we.current){const o=Math.ceil((we.current-Date.now())/1e3);t(`Rate limited. Please wait ${o}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),fe()}}},[r,m,N,R,fe,t,s]);a.useEffect(()=>{const n=qe.current;if(!n)return;const o=y=>{if(q||Math.abs(y.deltaY)<Math.abs(y.deltaX))return;y.preventDefault(),y.stopPropagation();const $=Date.now();if(!($<Se.current)){if(Se.current=$+1e3,!s){y.deltaY>0&&!E&&fe();return}y.deltaY>0?Ye():Qe()}},u=y=>{p.current=y.touches[0].clientY,h.current=Date.now()},g=y=>{if(q||p.current===null||h.current===null)return;const $=y.changedTouches[0].clientY,ue=Date.now(),le=p.current-$,me=ue-h.current;if(p.current=null,h.current=null,Math.abs(le)<50||me>300)return;const xe=Date.now();if(!(xe<Se.current)){if(Se.current=xe+1e3,!s){le>0&&!E&&fe();return}le>0?Ye():Qe()}};return n.addEventListener("wheel",o,{passive:!1,capture:!0}),n.addEventListener("touchstart",u,{passive:!0}),n.addEventListener("touchend",g,{passive:!0}),window.addEventListener("wheel",o,{passive:!1,capture:!0}),()=>{n.removeEventListener("wheel",o,{capture:!0}),n.removeEventListener("touchstart",u),n.removeEventListener("touchend",g),window.removeEventListener("wheel",o,{capture:!0})}},[Ye,Qe,s,E,fe,q]);const Rt=a.useCallback(async()=>{var n,o;if(!(!s||Ee)){be(!0);try{const u=s.liked_by_me?"DELETE":"POST",g=await A(I.videos.like(s.id),{method:u});c(y=>{const $=[...y],ue=$.findIndex(le=>le.id===s.id);return ue!==-1&&($[ue]={...$[ue],liked_by_me:!s.liked_by_me,likes_count:g.likes_count}),$})}catch(u){((n=u==null?void 0:u.message)!=null&&n.includes("429")||(o=u==null?void 0:u.message)!=null&&o.includes("rate limit"))&&t("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{be(!1)}}},[s,Ee,t]),it=a.useCallback(async n=>{if(s)try{await A(I.videos.flag(s.id),{method:"POST",body:JSON.stringify({reason:n})}),t("Thanks for your report.",{variant:"info"})}catch{t("Report failed",{variant:"error"})}finally{te(!1)}},[s,t]),Tt=a.useCallback(async()=>{if(!s)return;const n=!s.is_starred,o=n?"star":"unstar";try{await A(I.admin.videosAction(s.id,o),{method:"POST"}),c(u=>{const g=[...u],y=g.findIndex($=>$.id===s.id);return y!==-1&&(g[y]={...g[y],is_starred:n}),g}),de(!1),t(n?"Post starred":"Star removed",{variant:"success"})}catch{t("Action failed",{variant:"error"})}},[s,t]),rt=a.useCallback(async()=>{if(!(!s||!confirm("Permanently delete this video?")))try{await A(I.videos.delete(s.id),{method:"DELETE"}),t("Deleted",{variant:"warn"}),te(!1),c(n=>{const o=n.filter((u,g)=>g!==r);return o.length===0?(f(-1),setTimeout(fe,0)):f(u=>Math.max(0,Math.min(u,o.length-1))),o})}catch{alert("Delete failed")}},[s,r,fe,t]),We=a.useCallback(async()=>{if(s!=null&&s.id)try{const n=await A(I.videos.comments(s.id),{requireAuth:!1});G(n.items||[])}catch{}},[s==null?void 0:s.id]);a.useEffect(()=>{K&&(s!=null&&s.id)&&We()},[K,s==null?void 0:s.id,We]);const ot=a.useCallback(async n=>{if(n.preventDefault(),!(!T.trim()||!(s!=null&&s.id))){j(!0);try{await A(I.videos.comments(s.id),{method:"POST",body:JSON.stringify({text:T.trim(),parent_id:ae||void 0})}),Z(""),l(null),We(),c(o=>{const u=[...o],g=u.findIndex(y=>y.id===s.id);return g!==-1&&(u[g]={...u[g],comments_count:(u[g].comments_count||0)+1}),u}),t("Comment posted!",{variant:"success"})}catch(o){t((o==null?void 0:o.message)||"Failed to post comment",{variant:"error"})}finally{j(!1)}}},[T,s,ae,We,t]),Lt=a.useCallback(n=>{G(o=>o.filter(u=>u.id!==n)),c(o=>{const u=[...o],g=u.findIndex(y=>y.id===(s==null?void 0:s.id));return g!==-1&&(u[g]={...u[g],comments_count:Math.max(0,(u[g].comments_count||0)-1)}),u})},[s==null?void 0:s.id]),{topLevelComments:lt,repliesMap:ct}=a.useMemo(()=>{const n=Q.filter(u=>!u.parent_id),o=new Map;return Q.filter(u=>u.parent_id).forEach(u=>{const g=u.parent_id;o.has(g)||o.set(g,[]),o.get(g).push(u)}),{topLevelComments:n,repliesMap:o}},[Q]),Mt=a.useCallback(()=>{if(!B.current)return;const n=!N;P(n),B.current.muted=n,n||(je.current=!0),!n&&B.current.paused&&B.current.play().catch(()=>{})},[N]),zt=a.useCallback(n=>{B.current=n,n&&(n.muted=N)},[N]);a.useEffect(()=>{x(!1),W(!1),je.current?P(!1):P(!0)},[s==null?void 0:s.id,s==null?void 0:s.stream_uid,r,m.length]),a.useEffect(()=>{B.current&&(B.current.muted=N)},[N]),a.useEffect(()=>{if(!s)return;const n=!je.current;P(n);const o=setTimeout(()=>{B.current&&(B.current.muted=n)},100);return()=>clearTimeout(o)},[s==null?void 0:s.id]),a.useEffect(()=>{s&&(he.current=s.id)},[s==null?void 0:s.id]),a.useEffect(()=>{z&&B.current&&!B.current.paused&&B.current.pause()},[z]),a.useEffect(()=>{m.length===0&&fe()},[]),a.useEffect(()=>{(async()=>{try{const n=ye().join(","),o=await A(I.feed.progress(n),{requireAuth:!1}),u=Number(o.eligible||0),g=Number(o.viewed||0);L(u),V(g),b(u>0&&g>=u)}catch{}})()},[ye]),a.useEffect(()=>{const n=()=>{c([]),v([]),Y.current.clear(),he.current=null,f(-1),b(!1),(async()=>{try{const o=ye().join(","),u=await A(I.feed.progress(o),{requireAuth:!1}),g=Number(u.eligible||0),y=Number(u.viewed||0);L(g),V(y),b(!1)}catch{}fe()})()};return window.addEventListener("filterchange",n),()=>window.removeEventListener("filterchange",n)},[ye,fe]),a.useEffect(()=>{(async()=>{try{const n=await A(I.auth.me,{requireAuth:!1});oe(n)}catch{}})()},[]),a.useEffect(()=>{const n=()=>{const o=document.querySelector(".top-nav");o&&J(o.offsetHeight)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),a.useEffect(()=>{var u;if(!ke.current||!Re.current||!s||!B.current)return;const n=()=>{var D;const g=(D=Re.current)==null?void 0:D.querySelector("div"),y=B.current;if(!g||!y||!ke.current)return;const $=ke.current,ue=$.offsetWidth-32,le=$.offsetHeight-32;let me;s.width&&s.height?me=s.width/s.height:y.videoWidth>0&&y.videoHeight>0?me=y.videoWidth/y.videoHeight:me=16/9;const xe=16/9,Ue=ue/xe;let Ae=Math.min(le,Ue),se=Ae*me;se>ue&&(se=ue,Ae=se/me),g.style.width=`${se}px`,g.style.height=`${Ae}px`,g.style.maxWidth="100%",g.style.maxHeight="100%"},o=()=>{requestAnimationFrame(n)};if(B.current.readyState>=1)n();else{const g=()=>{var y;n(),(y=B.current)==null||y.removeEventListener("loadedmetadata",g)};(u=B.current)==null||u.addEventListener("loadedmetadata",g)}return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[s==null?void 0:s.id,s==null?void 0:s.width,s==null?void 0:s.height]),a.useEffect(()=>{if(!O)return;const n=o=>{Te.current&&!Te.current.contains(o.target)&&te(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[O]),a.useEffect(()=>{if(!ie)return;const n=o=>{Le.current&&!Le.current.contains(o.target)&&de(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[ie]),a.useEffect(()=>{if(!re)return;const n=o=>{Me.current&&!Me.current.contains(o.target)&&ze.current&&!ze.current.contains(o.target)&&F(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[re]);const dt=!!(U!=null&&U.is_admin||U!=null&&U.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Et,{paused:!1}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
      `}),e.jsxs("div",{ref:qe,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[R&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:S+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:ke,className:"video-area discover-video-container",style:{position:"absolute",top:S,left:0,right:0,bottom:0,maxHeight:`calc(100dvh - ${S}px)`,height:`calc(100dvh - ${S}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:"16px",maxWidth:"100vw",width:"100%"},children:q?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=Ge+I.auth.login,children:"Login with osu!"})]}):s?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:Mt,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:Re,className:"discover-player-wrapper",children:e.jsx(rs,{streamUID:s.stream_uid,playbackUrl:s.playback_url,aspectRatio:s.width&&s.height?s.width/s.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:N,controls:!1,onVideoRef:zt})}),e.jsx("div",{style:{position:"absolute",top:16,right:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:N?1:0,zIndex:2},children:N?e.jsx(Jt,{size:28,color:"#fff"}):e.jsx(Xt,{size:28,color:"#fff"})})]})]})}):R?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"• Click video to toggle mute/unmute"}),e.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),s&&!z&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:n=>n.stopPropagation(),children:[e.jsx(M,{to:`/profile/${(ut=s.uploader)==null?void 0:ut.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(mt=s.uploader)!=null&&mt.avatar_url?e.jsx("img",{src:s.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:s.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:Rt,disabled:Ee,"aria-label":s.liked_by_me?"Unlike":"Like",title:s.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:s.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:s.liked_by_me?e.jsx(kt,{size:28}):e.jsx(_t,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:s.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>W(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Ct,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:s.comments_count??0})]}),s.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:ze,onClick:()=>F(n=>!n),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Ke,{size:24})}),re&&e.jsxs("div",{ref:Me,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:s.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>F(!1),children:[e.jsx(Ke,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),s.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:It,children:"Preview"})]})]}),dt?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>de(n=>!n),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(xt,{size:24})}),ie&&e.jsxs("div",{ref:Le,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:Tt,children:s.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:rt,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>te(n=>!n),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.1)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:e.jsx(Kt,{size:24})}),O&&e.jsxs("div",{ref:Te,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>it("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>it("explicit"),children:"Explicit"}),dt&&e.jsx("button",{className:"menu-item",onClick:rt,children:"Delete video"})]})]}),s&&!z&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(M,{to:`/profile/${(pt=s.uploader)==null?void 0:pt.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var g,y,$;const n=(g=s.uploader)==null?void 0:g.is_admin,o=(y=s.uploader)==null?void 0:y.is_mod,u=n?"#fff3bf":o?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:u},children:["@",($=s.uploader)==null?void 0:$.username]}),s.is_starred&&e.jsx(Nt,{size:16,color:"#f59e0b",title:"Starred"}),(n||o)&&e.jsx(xt,{size:14,color:u,title:n?"admin":"mod"})]})})()})}),(s.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:s.description}),s.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[s.beatmap_artist," – ",s.beatmap_title," ",s.beatmap_mapper?`(by ${s.beatmap_mapper})`:""," ",s.beatmap_version?`[${s.beatmap_version}]`:""]})]}),K&&s&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",s.comments_count??0,")"]}),e.jsx("button",{onClick:()=>W(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(tt,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:lt.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:lt.map(n=>e.jsx(os,{comment:n,replies:ct.get(n.id)||[],me:U,section:"mappi",onReply:o=>l(o),onDelete:Lt,replyingTo:ae,replyText:T,onReplyTextChange:Z,onReplySubmit:ot,posting:k,onCancelReply:()=>{l(null),Z("")},repliesMap:ct},n.id))})}),U&&!ae&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:ot,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:T,onChange:n=>Z(n.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:n=>{const o=n.target;o.style.height="auto",o.style.height=`${Math.min(o.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:k||!T.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:k?"...":"Post"})]})})]})]}),z&&(s==null?void 0:s.beatmapset_id)&&e.jsx(ws,{open:z,onClose:()=>x(!1),downloadUrl:`${Ge}${I.osu.downloadBeatmapset(s.beatmapset_id)}`,beatmapId:s.beatmap_id??void 0,beatmapVersion:s.beatmap_version??void 0})]})]})}function vt(t){if(!t)return"standard";const m=String(t).toLowerCase().trim();return m==="osu"||m==="0"||m==="standard"?"standard":m==="taiko"||m==="1"?"taiko":m==="catch"||m==="fruits"||m==="2"?"catch":m==="mania"||m==="3"?"mania":"standard"}const Ps=({open:t,onClose:m,videoId:c,initialDescription:r,initialBeatmapUrl:f,onSave:d})=>{const[v,E]=a.useState(r||""),[_,R]=a.useState(f||""),[b,w]=a.useState(null),[L,C]=a.useState(null),[V,q]=a.useState(""),[X,N]=a.useState(!1),P=a.useRef(0);a.useEffect(()=>{t&&(E(r||""),R(f||""),w(null),C(null),q(""))},[t,r,f]),a.useEffect(()=>{if(!t)return;P.current&&window.clearTimeout(P.current);const x=(_||"").trim();if(!x){q(""),w(null),C(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(x)){q(""),w(null),C(null);return}return P.current=window.setTimeout(async()=>{var W;try{let O;try{O=new URL(x)}catch{q("Invalid URL format");return}const te=O.hash.match(/#osu\/(\d+)/),ie=te?te[1]:null;O.hash="";const re={url:O.toString()};ie&&(re.beatmap_id=ie);const F=await A(I.osu.resolveBeatmap+Ce(re),{requireAuth:!1}),Q=Array.isArray(F==null?void 0:F.diffs)?F.diffs:[];if(!Q.length&&!F.setId){q("No difficulties found"),w(null),C(null);return}if(w({setId:Number(F.setId)||0,beatmapId:F.beatmapId??null,title:String(F.title||""),artist:String(F.artist||""),mapper:String(F.mapper||""),diffs:Q}),Q.length>0){const G=Number.isFinite(Number(F.beatmapId))?Number(F.beatmapId):Number((W=Q[0])==null?void 0:W.id),T=Q.find(ae=>Number(ae.id)===G)||Q[0],Z=vt(T==null?void 0:T.mode);C({beatmapId:Number(T==null?void 0:T.id)||null,version:String((T==null?void 0:T.version)||""),mode:Z})}q("")}catch(O){q(`Failed to resolve: ${(O==null?void 0:O.message)||"Unknown error"}`),w(null),C(null)}},400),()=>{P.current&&window.clearTimeout(P.current)}},[_,t]);const z=async()=>{if(!X){N(!0);try{await A(I.videos.update(c),{method:"PATCH",body:JSON.stringify({description:v.slice(0,100),beatmap_url:_.trim()||void 0})});const x=!!_.trim();if(b||!x)try{await A(I.videos.update(c)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:x&&b&&b.setId>0?b.setId:null,beatmap_id:x&&(L!=null&&L.beatmapId)?L.beatmapId:null,beatmap_version:x&&(L!=null&&L.version)?L.version:null,beatmap_title:x&&(b!=null&&b.title)?b.title:null,beatmap_artist:x&&(b!=null&&b.artist)?b.artist:null,beatmap_mapper:x&&(b!=null&&b.mapper)?b.mapper:null,beatmap_url:x?_.trim():null})})}catch(W){console.warn("Failed to update beatmap metadata:",W)}d(v,_.trim()||null),m()}catch(x){alert((x==null?void 0:x.message)||"Failed to update post")}finally{N(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:x=>x.target===x.currentTarget&&m(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:m}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:m,"aria-label":"Close",children:e.jsx(tt,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:v,onChange:x=>E(x.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),b?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[b.artist," – ",b.title]}),e.jsxs("span",{className:"muted",children:["by ",b.mapper]})]}),e.jsx("select",{value:(L==null?void 0:L.beatmapId)??b.beatmapId??void 0,onChange:x=>{const K=Number(x.target.value),W=(b==null?void 0:b.diffs.find(O=>Number(O.id)===K))||null;if(W){const O=vt(W.mode);C({beatmapId:K,version:W.version,mode:O})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:b.diffs.map(x=>e.jsxs("option",{value:x.id,children:[x.version," (",x.mode,")"]},x.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{w(null),C(null),R("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:_,onChange:x=>R(x.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),V&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:V})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:m,disabled:X,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:z,disabled:X,children:X?"Saving...":"Save"})]})]})]})]}):null};function jt(){const t=Gt(),m=et(),{notify:c}=st(),[r,f]=a.useState(null),[d,v]=a.useState(null),[E,_]=a.useState(""),[R,b]=a.useState([]),[w,L]=a.useState([]),[C,V]=a.useState([]),[q,X]=a.useState(""),[N,P]=a.useState(null),[z,x]=a.useState([]),[K,W]=a.useState(null),[O,te]=a.useState(""),[ie,de]=a.useState([]),[re,F]=a.useState(null),[Q,G]=a.useState(!1),T=a.useMemo(()=>{const l=t.id?Number(t.id):null;return l?r?r.id===l:!1:!0},[t.id,r]);function Z(l){const k=l.stream_uid||String(l.id),j=t.id?`/profile/${t.id}`:"/profile";m(`/mp/feed/${k}`,{state:{returnTo:j}})}a.useEffect(()=>{(async()=>{try{const l=await A(I.auth.me,{requireAuth:!1});f(l),l&&Array.isArray(l.inspirations)&&x(l.inspirations)}catch(l){_((l==null?void 0:l.message)||"Not logged in")}})()},[]),a.useEffect(()=>{(async()=>{try{const l=t.id?Number(t.id):null;if(l){const k=await A(I.users.get(l),{requireAuth:!1});v(k),X(k.about||""),Array.isArray(k.inspirations)&&x(k.inspirations);const j=await A(I.users.videos(l)+Ce({limit:"60"}),{requireAuth:!1});V(j.items||[]);const U=await A(I.users.likes(l)+Ce({limit:"60"}),{requireAuth:!1});L(U.items||[])}else{if(!r)return;v(r),X(r.about||""),Array.isArray(r.inspirations)&&x(r.inspirations);const k=await A(I.users.myVideos+Ce({limit:"50"}),{requireAuth:!1});b(k.items||[]);const j=await A(I.users.likes(r.id)+Ce({limit:"60"}),{requireAuth:!1});L(j.items||[])}}catch{}})()},[t.id,r]),a.useEffect(()=>{G(!1)},[d==null?void 0:d.id]);async function ae(l){try{const j=(await A(I.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:l})})).user||d;v(j),Array.isArray(j==null?void 0:j.inspirations)&&x(j.inspirations),t.id||f(j)}catch{}}return a.useEffect(()=>{let l;return K!==null&&O.trim().length>=2?l=setTimeout(async()=>{try{const k=await A(I.osu.usersSearch(O),{requireAuth:!1});de(Array.isArray(k.items)?k.items:[])}catch{}},250):de([]),()=>{l&&clearTimeout(l)}},[O,K]),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:d?e.jsxs(e.Fragment,{children:[d.avatar_url&&e.jsx("img",{src:d.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[d.username,d.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${d.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:l=>l.currentTarget.style.opacity="1",onMouseLeave:l=>l.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Ke,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",d.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!T&&z.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),z.map((l,k)=>T?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>F(l.id),onMouseLeave:()=>F(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const j=z.filter((U,oe)=>oe!==k);x(j),ae(j)},children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),re===l.id&&e.jsxs("div",{className:"insp-tooltip",children:[l.username," — click to remove"]})]},l.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>F(l.id),onMouseLeave:()=>F(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${l.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:l.avatar_url,alt:l.username})}),re===l.id&&e.jsx("div",{className:"insp-tooltip",children:l.username})]},l.id)),T&&z.length<3&&new Array(3-z.length).fill(0).map((l,k)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>F(-k-1),onMouseLeave:()=>F(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{W(k),te(""),de([])},children:"+"}),re===-k-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),K===k&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:O,onChange:j=>te(j.target.value)}),e.jsxs("div",{className:"insp-results",children:[ie.length===0&&O.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),ie.map(j=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(j.id)){c("Kinda based, but no.",{variant:"warn"}),W(null);return}if(z.some(oe=>oe.id===j.id)){W(null);return}const U=[...z,{id:j.id,username:j.username,avatar_url:j.avatar_url}].slice(0,3);x(U),W(null),ae(U)},children:[e.jsx("img",{src:j.avatar_url,alt:"avatar"}),e.jsx("span",{children:j.username})]},j.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>W(null),children:"Close"})]})]},`slot-${k}`))]}),T&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:E||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),T?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:q,onChange:l=>X(l.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn compact",onClick:async()=>{try{const l=await A(I.auth.me,{method:"PATCH",body:JSON.stringify({about:q})});v(l.user||d),f(l.user||r)}catch{}},children:"Save"})})]}):(()=>{const l=((d==null?void 0:d.about)||"").trim()||"No bio.",k=l.length>200,j=k&&!Q?l.slice(0,200)+"...":l;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:j}),k&&e.jsx("button",{onClick:()=>G(!Q),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:Q?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(Zt,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(St,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:l=>{const k=l.currentTarget.closest(".profile-tabs-unified");k.querySelectorAll(".profile-tab").forEach(U=>{U.classList.remove("active"),U.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),k.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:l=>{const k=l.currentTarget.closest(".profile-tabs-unified");k.querySelectorAll(".profile-tab").forEach(U=>{U.classList.remove("active"),U.setAttribute("aria-selected","false")}),l.currentTarget.classList.add("active"),l.currentTarget.setAttribute("aria-selected","true"),k.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(T?R:C).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(T?R:C).map(l=>(T&&d?(d.id,d.username,d.avatar_url,d.is_admin,d.is_mod):l.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>Z({...l}),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(_t,{size:12}),e.jsx("span",{children:l.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ct,{size:12}),e.jsx("span",{children:l.comments_count??0})]})]})})]},l.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[w.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),w.map(l=>{var k,j;return e.jsxs("button",{className:"recent-cell",onClick:()=>Z(l),children:[l.poster_url?e.jsx("img",{className:"recent-thumb",src:l.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((k=l.uploader)==null?void 0:k.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:l.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(j=l.uploader)==null?void 0:j.username})]})]},l.id)})]})})})]})]}),N&&e.jsx(Ps,{open:!!N,onClose:()=>P(null),videoId:N.id,initialDescription:N.description,initialBeatmapUrl:N.beatmap_url,onSave:(l,k)=>{b(R.map(j=>j.id===N.id?{...j,description:l||null,beatmap_url:k}:j)),P(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function Fs(){return e.jsx(Ns,{})}const Ds=ve(()=>ee(()=>import("./mappi-routes-BuYlJIUY.js").then(t=>t.e),__vite__mapDeps([4,1,2,5,6,7,8,9]))),Os=ve(()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.P),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),$s=ve(()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.Q),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),qs=ve(()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.h),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),Ws=ve(()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.N),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),Us=ve(()=>ee(()=>import("./Moderation-DgVwM8bp.js"),__vite__mapDeps([12,1,2,4,5,6,7,8,9]))),Bs=ve(()=>ee(()=>import("./About-DgGXV8RR.js"),__vite__mapDeps([0,1,2]))),Hs=ve(()=>ee(()=>import("./Settings-B-E92wyK.js"),__vite__mapDeps([13,1,2]))),Vs=()=>e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"50vh",color:"var(--muted)"},children:"Loading..."}),Qs=()=>(a.useEffect(()=>{Ts([()=>ee(()=>import("./mappi-routes-BuYlJIUY.js").then(t=>t.e),__vite__mapDeps([4,1,2,5,6,7,8,9])),()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.P),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11])),()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.Q),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11])),()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.h),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11])),()=>ee(()=>import("./moddi-routes-BAHBGzbB.js").then(t=>t.N),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))])},[]),e.jsx(a.Suspense,{fallback:e.jsx(Vs,{}),children:e.jsx(ns,{children:e.jsxs(H,{element:e.jsx(Ls,{}),children:[e.jsx(H,{path:"/",element:e.jsx(Ms,{})}),e.jsx(H,{path:"/mp/discover",element:e.jsx(yt,{})}),e.jsx(H,{path:"/mp/feed",element:e.jsx(De,{})}),e.jsx(H,{path:"/mp/feed/:uid",element:e.jsx(Ds,{})}),e.jsx(H,{path:"/md/feed",element:e.jsx(js,{})}),e.jsx(H,{path:"/md/feed/:uid",element:e.jsx(Os,{})}),e.jsx(H,{path:"/md/queues",element:e.jsx($s,{})}),e.jsx(H,{path:"/md/queues/:id",element:e.jsx(qs,{})}),e.jsx(H,{path:"/md/notifications",element:e.jsx(Ws,{})}),e.jsx(H,{path:"/profile",element:e.jsx(jt,{})}),e.jsx(H,{path:"/profile/:id",element:e.jsx(jt,{})}),e.jsx(H,{path:"/moderation",element:e.jsx(Us,{})}),e.jsx(H,{path:"/about",element:e.jsx(Bs,{})}),e.jsx(H,{path:"/settings",element:e.jsx(Hs,{})}),e.jsx(H,{path:"/editor",element:e.jsx(Fs,{})}),e.jsx(H,{path:"/feed",element:e.jsx(yt,{})}),e.jsx(H,{path:"/upload",element:e.jsx(De,{})}),e.jsx(H,{path:"/posts",element:e.jsx(De,{})}),e.jsx(H,{path:"/recents",element:e.jsx(De,{})}),e.jsx(H,{path:"/recent",element:e.jsx(De,{})})]})})})),Ys=()=>e.jsx(ss,{children:e.jsx(Qs,{})});es(document.getElementById("root")).render(e.jsx(ne.StrictMode,{children:e.jsx(Cs,{children:e.jsx(ts,{client:_s,children:e.jsx(ls,{children:e.jsx(Ys,{})})})})}));
