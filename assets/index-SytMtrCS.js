var zt=Object.defineProperty;var At=(t,d,u)=>d in t?zt(t,d,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[d]=u;var ft=(t,d,u)=>At(t,typeof d!="symbol"?d+"":d,u);import{r as s,j as e,e as tt,u as st,R as Z,q as Dt,T as Pt,L as V,U as Ke,V as Wt,W as $t,B as Xe,X as Nt,Y as Ot,Z as qt,_ as Ut,O as xt,K as Bt,A as kt,h as St,P as Ht,Q as Vt,E as Qt,c as at,H as Yt,l as Ct,$ as gt,y as Jt,v as Gt,b as Kt,a as Xt,i as _t,g as Tt,k as Ze,a0 as Zt,a1 as bt,o as es,x as ts,a2 as ss,a3 as as,a4 as ns,a5 as is,a6 as ae}from"./vendor-react-DjZENDOm.js";import{y as rs}from"./vendor-CUqVEcin.js";import{u as He,a as T,A as C,c as et,P as os,b as Me,d as ls,C as cs,T as ds,e as us}from"./mappi-routes-z0WjMLkJ.js";import{H as ms,c as ps,b as hs,a as fs,i as xs}from"./editor-components-DLfFEG70.js";import{u as Ve,a as nt,b as gs,c as bs,d as ys,e as vs,f as js,g as ws,C as Ns,M as ks,P as Ss,Q as Cs,h as _s,N as Ts}from"./moddi-routes-Kg1xLC3R.js";import{B as Es,E as Rs}from"./editor-lib-BBJkCEPX.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-ndd4mMNi.js";import"./vendor-zip-CJUvx9qt.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))r(j);new MutationObserver(j=>{for(const m of j)if(m.type==="childList")for(const D of m.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&r(D)}).observe(document,{childList:!0,subtree:!0});function u(j){const m={};return j.integrity&&(m.integrity=j.integrity),j.referrerPolicy&&(m.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?m.credentials="include":j.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function r(j){if(j.ep)return;j.ep=!0;const m=u(j);fetch(j.href,m)}})();const Ms=new rs({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class Is extends s.Component{constructor(u){super(u);ft(this,"handleRetry",()=>{const u=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),u&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,r){console.error("ErrorBoundary caught an error:",u,r)}isChunkLoadingError(u){if(!u)return!1;const r=u.message.toLowerCase();return r.includes("loading chunk")||r.includes("failed to load")||r.includes("chunk load failed")||r.includes("loading css chunk")||u.name==="ChunkLoadError"}render(){var u;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=this.isChunkLoadingError(this.state.error),j=((u=this.state.error)==null?void 0:u.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:r?"Failed to load page. This might be a network issue.":j}),r&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:r?"Reload Page":"Try Again"}),!r&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const we=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function Ls({i:t}){const d=t*1337,u=(E,z)=>{const U=Math.sin(d+E+z)*1e4,H=U-Math.floor(U);return Math.floor(H*(z-E+1)+E)},r=u(0,100),j=u(24,50),m=.7+u(0,100)/100*.3,D=j*m,Y=u(0,4e3),k=u(-10,10),F=u(-8,8),g=u(0,100),R=g<60?1:g<80?1.5:2,P=[{size:200*R,alpha:.06,dx:-22,dy:12,color:we[u(0,we.length-1)]},{size:150*R,alpha:.08,dx:-9,dy:7,color:we[u(0,we.length-1)]},{size:120*R,alpha:.1,dx:0,dy:0,color:we[u(0,we.length-1)]},{size:90*R,alpha:.12,dx:12,dy:-4,color:we[u(0,we.length-1)]},{size:64*R,alpha:.13,dx:20,dy:-7,color:we[u(0,we.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${r}vw`,animationDuration:`${D}s`,animationDelay:`${Y}ms`,"--tx":`${k}vw`,transform:`rotate(${F}deg)`},children:P.map((E,z)=>e.jsx("svg",{width:E.size,height:E.size,viewBox:"0 0 100 100",style:{left:`${50+E.dx}%`,bottom:`${E.dy}px`,transform:"translateX(-50%)","--alpha":E.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:E.color})},z))})}function Et({paused:t=!1}){const d=s.useMemo(()=>new Array(20).fill(0).map((u,r)=>r),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:d.map(u=>e.jsx(Ls,{i:u},u))})}function Fs(){const t=tt(),d=st(),{lastSection:u,previousLocation:r,setPreviousLocation:j}=Ve(),m=Z.useRef(null),D=Z.useRef(!1),Y=Z.useRef(0),k=Z.useRef(0),F=Z.useRef(null),g=Z.useRef(null),R=Z.useRef(!1),P=300,E=2e3,z=Z.useRef(null),U=Z.useRef(null),H=Z.useRef(null),[S,$]=Z.useState(!1);Z.useEffect(()=>()=>{m.current&&clearTimeout(m.current),F.current&&clearTimeout(F.current),g.current&&clearTimeout(g.current)},[]),Z.useEffect(()=>{if(!S)return;const M=I=>{const B=I.target;H.current&&!H.current.contains(B)&&U.current&&!U.current.contains(B)&&$(!1)};return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[S]);const W=t.pathname==="/"||t.pathname==="/about"||t.pathname==="/md/notifications",b=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!W&&t.pathname.startsWith("/md/");const y=t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"||!W&&!t.pathname.startsWith("/mp/")&&u==="moddi";if(W)return null;const w=()=>{d(r||(u==="moddi"?"/md/feed":"/mp/feed"))},h=()=>{$(M=>!M)},J=()=>{var M;$(!1),(M=z.current)==null||M.click()};if(b)return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:z,type:"file",accept:".osz,.zip",onChange:M=>{var B;const I=(B=M.target.files)==null?void 0:B[0];I&&window.dispatchEvent(new CustomEvent("editor:file",{detail:I}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:w,"aria-label":"Back",title:"Go back",children:e.jsx(Dt,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:U,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:h,"aria-label":"File",title:"File menu","aria-expanded":S,children:e.jsx(Pt,{size:20})}),S&&e.jsx("div",{ref:H,className:"menu-panel",role:"menu",style:{position:"absolute",bottom:"calc(100% + 8px)",left:0,zIndex:100},children:e.jsx("button",{className:"menu-item",type:"button",onClick:J,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})})]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:w,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsx("div",{className:"mobile-bottom-nav-right"})]})]});const ie=()=>{const M=Date.now();if(Y.current>0){const I=M-Y.current;if(I<P&&I>0){F.current&&(clearTimeout(F.current),F.current=null),g.current&&(clearTimeout(g.current),g.current=null),m.current&&(clearTimeout(m.current),m.current=null),k.current=M+E,Y.current=0,D.current=!1,j(t.pathname),d("/editor");return}}M<k.current&&Y.current===0||(F.current&&(clearTimeout(F.current),F.current=null),g.current&&(clearTimeout(g.current),g.current=null),Y.current=M,g.current=setTimeout(()=>{g.current!==null&&(d(y?"/mp/feed":"/md/feed"),g.current=null)},P),F.current=setTimeout(()=>{Y.current>0&&(Y.current=0,k.current=Date.now()+E),F.current=null},P))},le=()=>{D.current=!1,m.current=setTimeout(()=>{D.current=!0,d("/")},500)},re=()=>{m.current&&(clearTimeout(m.current),m.current=null),D.current&&setTimeout(()=>{D.current=!1},100)},q=M=>{if(R.current){M.preventDefault(),M.stopPropagation(),R.current=!1;return}if(D.current){M.preventDefault(),M.stopPropagation();return}ie()},ee=M=>{if(re(),D.current){M.preventDefault(),R.current=!0;return}M.preventDefault(),ie(),R.current=!0,setTimeout(()=>{R.current=!1},P+100)};return e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(V,{to:y?"/md/feed":"/mp/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/feed"||t.pathname==="/md/feed"?"active":""}`,"aria-label":"Feed",children:e.jsx(Ke,{size:20})}),y?e.jsx(V,{to:"/md/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/md/queues")?"active":""}`,"aria-label":"Queues",children:e.jsx(Wt,{size:20})}):e.jsx(V,{to:"/mp/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/mp/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx($t,{size:20})})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:q,onTouchStart:le,onTouchEnd:ee,onMouseDown:le,onMouseUp:re,onMouseLeave:re,"aria-label":y?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",title:y?"Switch to Mappi (long press for home)":"Switch to Moddi (long press for home)",children:e.jsx("span",{className:"mobile-coin-flip-text",children:y?"md!":"mp!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsx(V,{to:"/profile",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname.startsWith("/profile")?"active":""}`,"aria-label":"Profile",children:e.jsx(Xe,{size:20})}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:()=>d("/settings"),"aria-label":"Settings",children:e.jsx(Nt,{size:20})})]})]})}function zs(){const t=tt(),d=st(),{notify:u}=He(),{data:r,isLoading:j}=nt(),{data:m}=gs(!!r),{data:D=[]}=bs(!!r),Y=ys(),k=vs(),F=js(),g=ws(),[R,P]=s.useState(new Set),E=s.useRef(null),z=s.useRef(null),U=s.useRef(null),H=s.useRef(null),S=s.useRef(null),$=s.useRef(null),W=s.useRef(null),b=s.useRef(null),{menuOpen:y,mobileNavOpen:w,notifOpen:h,filtersOpen:J,modeFilters:ie,tagFilters:le,queueStatusFilters:re,lastSection:q,setMenuOpen:ee,setMobileNavOpen:M,setNotifOpen:I,setFiltersOpen:B,closeAllPanels:ce,setModeFilters:c,setTagFilters:A,setQueueStatusFilters:L,setLastSection:G,setPreviousLocation:be}=Ve(),o=s.useRef(0),Q=s.useRef(0),N=s.useRef(null),de=500,ke=2e3;Z.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]);const ye=i=>{i.preventDefault();const f=Date.now();if(!(f<Q.current)){if(N.current&&o.current>0){const x=f-o.current;if(x<de&&x>0){clearTimeout(N.current),N.current=null,Q.current=f+ke,o.current=0,be(t.pathname),d("/editor");return}}N.current&&(clearTimeout(N.current),N.current=null),o.current=f,N.current=setTimeout(()=>{Q.current=Date.now()+ke,N.current=null,o.current=0,d(ue?"/mp/feed":"/md/feed")},de)}},me=t.pathname==="/"||t.pathname==="/about"||t.pathname==="/md/notifications",Ie=t.pathname==="/editor",Se=t.pathname.startsWith("/mp/")||!me&&!t.pathname.startsWith("/md/")&&q==="mappi",ue=t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"||!me&&!t.pathname.startsWith("/mp/")&&q==="moddi",te=t.pathname.startsWith("/md/queues/")&&t.pathname!=="/md/queues";Z.useEffect(()=>{t.pathname.startsWith("/mp/")?G("mappi"):t.pathname.startsWith("/md/")&&t.pathname!=="/md/notifications"&&G("moddi")},[t.pathname,G]);const[Qe,Le]=Z.useState(0);Z.useEffect(()=>{const i=setInterval(()=>Le(f=>f+1),1e3);return()=>clearInterval(i)},[]);const[Fe,Oe]=Z.useState(null);Z.useEffect(()=>{!r||!r.is_mod||(async()=>{try{const i=await T(C.admin.debugState,{requireAuth:!1}),f=Array.isArray(i==null?void 0:i.counts)?i.counts.find(x=>String(x.status)==="ready"):null;f&&Oe(Number(f.c)||0)}catch{}})()},[r]);const[Te,ze]=Z.useState(!1),Ae=async()=>{ze(!0);try{const i=await T(C.admin.clearViews,{method:"POST"});u(`Cleared ${Number((i==null?void 0:i.deleted)||0)} views from your history.`,{variant:"success"});try{localStorage.removeItem("feed_seen_ids")}catch{}try{window.dispatchEvent(new Event("filterchange"))}catch{}}catch{u("Failed to clear view history",{variant:"error"})}finally{ze(!1)}},De=i=>{if(!i)return null;try{const f=JSON.parse(i);if((f==null?void 0:f.type)==="queue_invite"&&(f!=null&&f.queue_id))return f}catch{}return null},Ue=async(i,f)=>{if(!R.has(i.id)){P(x=>new Set(x).add(i.id));try{await T(C.moddi.queueAccept(String(f)),{method:"POST"}),u("Invitation accepted!",{variant:"success"}),g.mutate(i.id),I(!1),d(`/md/queues/${f}`)}catch(x){u((x==null?void 0:x.message)||"Failed to accept invitation",{variant:"error"})}finally{P(x=>{const O=new Set(x);return O.delete(i.id),O})}}},Pe=async(i,f)=>{if(!R.has(i.id)){P(x=>new Set(x).add(i.id));try{await T(C.moddi.queueDeny(String(f)),{method:"POST"}),u("Invitation declined",{variant:"success"}),g.mutate(i.id)}catch(x){u((x==null?void 0:x.message)||"Failed to decline invitation",{variant:"error"})}finally{P(x=>{const O=new Set(x);return O.delete(i.id),O})}}},We=async()=>{const i=D.filter(f=>f.id.startsWith("n:")||f.kind==="system"&&!f.read).map(f=>f.id);i.length>0&&F.mutate(i)},$e=async i=>{if(I(!1),F.mutate([i.id]),i.kind==="system"||i.id.startsWith("n:"))try{await T(C.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[i.id]})})}catch{}},Ye=async(i,f)=>{i.stopPropagation(),g.mutate(f)},n=()=>{const f=Object.entries(ie).filter(([x,O])=>O).map(([x])=>x);f.length,f.length===0&&c({standard:!0,taiko:!1,mania:!1,catch:!1});try{window.dispatchEvent(new Event("filterchange"))}catch{}B(!1)},he=()=>{const f=Object.entries(le).filter(([x,O])=>O).map(([x])=>x);f.length,f.length===0&&A({untagged:!0,help:!0});try{window.dispatchEvent(new Event("moddifilterchange"))}catch{}B(!1)};return Z.useEffect(()=>{r&&!localStorage.getItem("welcomed")&&(u(`Welcome, ${r.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[r,u]),Z.useEffect(()=>{if(!h)return;const i=f=>{const x=f.target;z.current&&!z.current.contains(x)&&E.current&&!E.current.contains(x)&&I(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[h,I]),Z.useEffect(()=>{if(!y)return;const i=f=>{const x=f.target;H.current&&!H.current.contains(x)&&U.current&&!U.current.contains(x)&&ee(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[y,ee]),Z.useEffect(()=>{if(!w)return;const i=f=>{const x=f.target;$.current&&!$.current.contains(x)&&S.current&&!S.current.contains(x)&&M(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[w,M]),Z.useEffect(()=>{if(!J)return;const i=f=>{const x=f.target;b.current&&!b.current.contains(x)&&W.current&&!W.current.contains(x)&&B(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[J,B]),e.jsxs("div",{className:"app-shell","data-section":ue?"moddi":Se?"mappi":q==="moddi"?"moddi":q==="mappi"?"mappi":void 0,children:[e.jsx(Et,{paused:t.pathname==="/editor"}),e.jsxs("header",{className:"top-nav",children:[t.pathname!=="/editor"&&e.jsxs("div",{className:"mobile-nav",children:[e.jsx("button",{ref:S,className:"icon-link hamburger",onClick:()=>{w||ce(),M(i=>!i)},"aria-label":"Menu","aria-expanded":w,children:e.jsx(Ot,{size:18})}),w&&e.jsxs("div",{ref:$,className:"menu-panel",role:"menu",children:[me&&e.jsx(V,{to:t.pathname==="/"?"/about":"/",className:`menu-item ${t.pathname==="/about"?"active":""}`,onClick:()=>M(!1),children:t.pathname==="/"?"About":"Home"}),Se&&e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/mp/feed",className:`menu-item ${t.pathname==="/mp/feed"?"active":""}`,onClick:()=>M(!1),children:"Feed"}),e.jsx(V,{to:"/mp/discover",className:`menu-item ${t.pathname==="/mp/discover"?"active":""}`,onClick:()=>M(!1),children:"Discover"})]}),ue&&e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/md/feed",className:`menu-item ${t.pathname==="/md/feed"?"active":""}`,onClick:()=>M(!1),children:"Feed"}),e.jsx(V,{to:"/md/queues",className:`menu-item ${t.pathname.startsWith("/md/queues")?"active":""}`,onClick:()=>M(!1),children:"Queues"})]}),!Se&&!ue&&!me&&e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/mp/feed",className:`menu-item ${t.pathname==="/mp/feed"?"active":""}`,onClick:()=>M(!1),children:"Feed"}),e.jsx(V,{to:"/mp/discover",className:`menu-item ${t.pathname==="/mp/discover"?"active":""}`,onClick:()=>M(!1),children:"Discover"})]})]})]}),me?e.jsx(V,{to:"/",className:"title",children:ue?"osu!moddi.ng":Se?"osu!mappi.ng":"mappi!"}):Ie?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(V,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Ke,{size:18})}),e.jsx(V,{to:ue?"/md/feed":"/mp/feed",className:"title",children:ue?"osu!moddi.ng":"osu!mappi.ng"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(V,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(Ke,{size:18})}),e.jsxs("button",{onClick:ye,className:"title coin-flip-title",style:{background:"transparent",border:"none",padding:0,cursor:"pointer",color:"inherit",font:"inherit"},title:"Switch section (double-click for editor)","aria-label":"Switch section (double-click for editor)",children:[e.jsx("span",{className:"coin-flip-front",children:ue?"osu!moddi.ng":"osu!mappi.ng"}),e.jsx("span",{className:"coin-flip-back",children:ue?"osu!mappi.ng":"osu!moddi.ng"})]})]}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),t.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(ms,{})}):e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[me&&e.jsx(V,{to:t.pathname==="/"?"/about":"/",className:t.pathname==="/about"?"active":"",children:t.pathname==="/"?"About":"Home"}),Se&&e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/mp/feed",className:t.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(V,{to:"/mp/discover",className:t.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(V,{to:"/editor",className:t.pathname==="/editor"?"active":"",children:"Editor"})]}),ue&&e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/md/feed",className:t.pathname==="/md/feed"?"active":"",children:"Feed"}),e.jsx(V,{to:"/md/queues",className:t.pathname.startsWith("/md/queues")?"active":"",children:"Queues"})]}),!Se&&!ue&&!me&&e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/mp/feed",className:t.pathname==="/mp/feed"?"active":"",children:"Feed"}),e.jsx(V,{to:"/mp/discover",className:t.pathname==="/mp/discover"?"active":"",children:"Discover"}),e.jsx(V,{to:"/editor",className:t.pathname==="/editor"?"active":"",children:"Editor"})]})]}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(qt,{size:18})}),r?e.jsxs("div",{className:"user-menu",children:[e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:E,className:"icon-link",onClick:()=>{h||ce(),I(i=>!i)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Ut,{size:18})}),Y>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),h&&e.jsxs("div",{ref:z,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(V,{to:"/md/notifications",onClick:()=>I(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:i=>i.currentTarget.style.opacity="1",onMouseLeave:i=>i.currentTarget.style.opacity="0.7",children:"View all"}),D.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:We,children:e.jsx(xt,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[D.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),D.filter(i=>!(i.kind==="system"&&i.id.startsWith("b:")&&(i.expiresAt||0)<=Date.now())).map(i=>{const f=De(i.text),x=i.id.startsWith("b:"),O=f?"queue-invite":i.kind==="star"?"star":i.kind==="likes5"?"likes":i.kind==="comment"?"comment":i.kind==="inspiration"?"inspiration":i.kind==="reaction"?"reaction":x?"global":"system",se=i.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${O}`,role:"button",onClick:()=>!f&&$e(i),children:[e.jsxs("div",{className:`notif-icon ${se?"deletable":""}`,"aria-hidden":"true",onClick:se&&!f?fe=>Ye(fe,i.id):void 0,title:se&&!f?"Remove":void 0,role:se&&!f?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:f?e.jsx(Bt,{}):O==="star"?e.jsx(kt,{}):O==="likes"?e.jsx(St,{}):O==="comment"?e.jsx(Xe,{}):O==="inspiration"?e.jsx(Xe,{}):O==="reaction"?e.jsx(Ht,{}):O==="global"?e.jsx(Vt,{}):null}),se&&!f?e.jsx("span",{className:"swap-trash",children:e.jsx(Qt,{})}):null]}),e.jsx("div",{className:"notif-body",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[f.inviter_username," invited you to join queue: ",f.queue_name]}),R.has(i.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:fe=>{fe.stopPropagation(),Ue(i,f.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(xt,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:fe=>{fe.stopPropagation(),Pe(i,f.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(at,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):i.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:x?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:i.text||""}),x&&i.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(i.expiresAt).toLocaleString()]}):null]}):i.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone commented on your post"})]}):i.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone is inspired by you!"})]}):i.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:i.text||"Someone raised their hand on your post!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:i.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:i.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},i.id)})]})]})]}),m!=null&&m.blocked?e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(Yt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:(()=>{const i=Math.max(0,Math.floor((((m==null?void 0:m.reset_at)??0)*1e3-Date.now())/1e3)),f=Math.floor(i/3600),x=Math.floor(i%3600/60),O=i%60,se=fe=>String(fe).padStart(2,"0");return f>0?`${f}:${se(x)}:${se(O)}`:`${x}:${se(O)}`})()})]}):null,e.jsxs("button",{ref:U,className:"icon-link",onClick:()=>{y||ce(),ee(i=>!i)},title:r.username,"aria-label":"User menu","aria-expanded":y,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:r.username}),e.jsx(Ct,{size:14,style:{opacity:.8}})]}),y&&e.jsxs("div",{ref:H,className:"menu-panel",role:"menu",children:[e.jsx(V,{to:"/profile",className:"menu-item",onClick:()=>ee(!1),children:"Profile"}),r!=null&&r.is_admin||r!=null&&r.is_mod?e.jsx(V,{to:"/moderation",className:"menu-item",onClick:()=>ee(!1),children:"Moderation"}):null,e.jsx("button",{className:"menu-item",type:"button",onClick:()=>k.mutate(),children:"Log out"})]})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=et+C.auth.login},disabled:j,children:j?"Checking…":"Login with osu!"})]})]}),e.jsx("main",{className:`page ${t.pathname==="/editor"||t.pathname==="/mp/discover"?"fullscreen":""}`,children:t.pathname==="/about"||t.pathname==="/moderation"||t.pathname==="/settings"?e.jsx("div",{className:"card",children:e.jsx(gt,{})}):e.jsx(gt,{})}),t.pathname!=="/editor"&&e.jsxs(e.Fragment,{children:[r&&r.is_mod&&Fe!==null&&e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[Fe," videos ready"]})}),e.jsxs("div",{className:"site-controls","aria-hidden":!1,children:[e.jsx("button",{ref:W,className:"settings-btn",onClick:()=>{J||ce(),B(i=>!i)},"aria-expanded":J,"aria-label":"Filter settings",title:"Filter settings",children:e.jsx(Nt,{size:18})}),J&&e.jsx("div",{ref:b,className:"settings-panel",role:"dialog","aria-modal":"false",children:te?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:8},children:[["unchecked","Pending","#f59e0b"],["accepted","Accepted","#10b981"],["denied","Denied","#ef4444"],["finished","Finished","#6366f1"],["archived","Archived","#6b7280"]].map(([i,f,x])=>{const O=re[i];return e.jsx("button",{className:`mode-cell ${O?"selected":""}`,"aria-pressed":O,onClick:()=>{L({...re,[i]:!O})},style:{padding:"10px 14px",borderRadius:8,fontSize:13,fontFamily:"'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif",fontWeight:O?600:500,background:O?x+"15":"transparent",border:`1.5px solid ${O?x+"50":"rgba(255,255,255,0.08)"}`,color:O?x:"var(--text)",transition:"all 0.2s ease",cursor:"pointer",textAlign:"left",width:"100%"},onMouseEnter:se=>{O?(se.currentTarget.style.background=x+"25",se.currentTarget.style.borderColor=x+"70"):(se.currentTarget.style.background="rgba(255,255,255,0.05)",se.currentTarget.style.borderColor="rgba(255,255,255,0.12)")},onMouseLeave:se=>{se.currentTarget.style.background=O?x+"15":"transparent",se.currentTarget.style.borderColor=O?x+"50":"rgba(255,255,255,0.08)"},children:f},i)})}),e.jsx("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn secondary compact",onClick:()=>B(!1),children:"Close"})})]}):ue?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Sort by:"}),e.jsx("div",{className:"col",style:{gap:6},children:[["untagged","Untagged"],["help","Help"]].map(([i,f])=>{const x=le[i];return e.jsx("button",{className:`mode-cell ${x?"selected":""}`,"aria-pressed":x,onClick:()=>{A({...le,[i]:!x})},children:e.jsx("span",{children:f})},i)})}),r&&(r.is_admin||r.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:Te,onClick:Ae,children:Te?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>B(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:he,children:"Apply"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:6},children:"Game modes"}),e.jsx("div",{className:"col",style:{gap:6},children:[["standard","Standard",ps],["taiko","Taiko",hs],["mania","Mania",fs],["catch","Catch",xs]].map(([i,f,x])=>{const O=ie[i];return e.jsxs("button",{className:`mode-cell ${O?"selected":""}`,"aria-pressed":O,onClick:()=>{c({...ie,[i]:!O})},children:[e.jsx("img",{className:"mode-icon",src:x,width:24,height:24,alt:""}),e.jsx("span",{children:f})]},i)})}),r&&(r.is_admin||r.is_mod)&&e.jsxs("div",{className:"col",style:{gap:6,marginTop:10},children:[e.jsx("div",{className:"title",style:{fontSize:14,marginBottom:2},children:"Moderator Tools"}),e.jsx("button",{className:"btn secondary compact",disabled:Te,onClick:Ae,children:Te?"Clearing…":"Clear view history"})]}),e.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn secondary compact",onClick:()=>B(!1),children:"Close"}),e.jsx("button",{className:"btn compact",onClick:n,children:"Apply"})]})]})})]})]}),e.jsx(Fs,{})]})}function As(){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 0 0 1px rgba(255,255,255,0.02) inset;
        }
        
        .landing-btn-secondary {
          background: #1f2430;
          color: var(--text);
          border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: rgba(255, 255, 255, 0.18);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle",children:"Navigate to.."}),e.jsxs("div",{className:"landing-actions",children:[e.jsx(V,{to:"/mp/discover",className:"landing-btn landing-btn-secondary",children:"mappi.ng"}),e.jsx(V,{to:"/md/feed",className:"landing-btn landing-btn-secondary",children:"moddi.ng"})]})]})]})]})}function Ds(){const{data:t}=nt(),{modeFilters:d}=Ve(),u=Object.entries(d).filter(([j,m])=>m).map(([j])=>j),r=u.length?u.join(","):"standard";return Jt({queryKey:["mappi","feed",r],queryFn:async({pageParam:j=0})=>{const m=new URLSearchParams({limit:"20",offset:String(j),modes:r}),D=`${C.feed.recent}?${m.toString()}`;return await T(D)},enabled:!!t,initialPageParam:0,getNextPageParam:(j,m)=>{var k;const D=m.reduce((F,g)=>{var R;return F+(((R=g.items)==null?void 0:R.length)||0)},0);return(((k=j.items)==null?void 0:k.length)||0)===20?D:void 0}})}function qe(){const t=tt(),d=Gt(),{data:u}=nt(),{modeFilters:r}=Ve(),{data:j,fetchNextPage:m,hasNextPage:D,isFetching:Y,isFetchingNextPage:k,refetch:F}=Ds(),g=s.useMemo(()=>(j==null?void 0:j.pages.flatMap(S=>S.items||[]))||[],[j]),R=s.useMemo(()=>{const S=Object.entries(r).filter(([W,b])=>b).map(([W])=>W.toLowerCase()),$=new Set(S.length?S:["standard"]);return g.filter(W=>{const b=String(W.mode||"standard").toLowerCase();return $.has(b)})},[g,r]);s.useEffect(()=>{t.pathname==="/mp/feed"&&F()},[t.pathname,F]),s.useEffect(()=>{const S=()=>{F()};return window.addEventListener("filterchange",S),()=>window.removeEventListener("filterchange",S)},[F]);const P=S=>{d.setQueryData(["mappi","feed"],$=>$&&{...$,pages:$.pages.map(W=>({...W,items:W.items.map(b=>b.id===S.id?S:b)}))})},E=S=>{d.setQueryData(["mappi","feed"],$=>$&&{...$,pages:$.pages.map(W=>({...W,items:W.items.filter(b=>b.id!==S)}))})},z=()=>{F()},U=Y&&!k,H=D??!1;return e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Clips auto-delete after 60 days. Starred posts are preserved."}),e.jsx(Ns,{section:"mappi",onUpload:z})]}),e.jsx("div",{style:{marginTop:12,borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[R.length===0&&!U&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No videos match the selected filter."}),R.map(S=>e.jsx(os,{post:S,section:"mappi",onUpdate:P,onDelete:E,me:u},S.id)),R.length>0&&H&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:()=>m(),disabled:k,children:k?"Loading...":"Load more"})})]})})]})}const ge={};function Ps(){try{const t=localStorage.getItem("feed_seen_ids");if(t){const d=JSON.parse(t);Array.isArray(d)&&(ge.seenIds=d.filter(u=>typeof u=="number"))}}catch{}return ge}function yt(t){Object.assign(ge,t);try{const d=Array.from(new Set(ge.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(d))}catch{}}function vt(){var mt,pt,ht;const{notify:t}=He(),[d,u]=s.useState(ge.history||[]),[r,j]=s.useState(ge.index??-1),[m,D]=s.useState(ge.queue||[]),[Y,k]=s.useState(!1),[F,g]=s.useState(!1),[R,P]=s.useState(ge.eligibleCount??null),[E,z]=s.useState(ge.viewedCount??0),[U,H]=s.useState(!1),[S,$]=s.useState(!0),[W,b]=s.useState(!1),[y,w]=s.useState(!1),[h,J]=s.useState(!1),[ie,le]=s.useState(!1),[re,q]=s.useState(!1),[ee,M]=s.useState([]),[I,B]=s.useState(""),[ce,c]=s.useState(null),[A,L]=s.useState(!1),[G,be]=s.useState(null),[o,Q]=s.useState(!1),N=s.useRef(new Set(ge.seenIds||[])),de=s.useRef(new Set),ke=s.useRef(!1),ye=s.useRef(ge.lastShownVideoId??null),me=s.useRef(!1),Ie=s.useRef(0),Se=s.useRef(0),ue=s.useRef(0),te=s.useRef(null),Qe=s.useRef(null),Le=s.useRef(null),Fe=s.useRef(null),Oe=s.useRef(null),Te=s.useRef(null),ze=s.useRef(null),Ae=s.useRef(null),De=s.useRef(0),Ue=s.useRef(0),Pe=s.useRef(null),We=s.useRef(null),[$e,Ye]=s.useState(0),n=s.useMemo(()=>r>=0?d[r]:null,[d,r]);s.useEffect(()=>{Ps()},[]),s.useEffect(()=>{yt({history:d,index:r,queue:m,seenIds:Array.from(N.current),eligibleCount:R??void 0,viewedCount:E,lastShownVideoId:ye.current??void 0})},[d,r,m,R,E]);const he=s.useCallback(()=>{try{const a=localStorage.getItem("filter_modes"),l=(a?String(a):"standard").toLowerCase().split(",").map(_=>_.trim()).filter(Boolean),p=["standard","taiko","mania","catch"],v=Array.from(new Set(l.filter(_=>p.includes(_))));return v.length?v:["standard"]}catch{return["standard"]}},[]),i=s.useCallback(()=>{const a=new Set;return ye.current!==null&&a.add(ye.current),Array.from(N.current).slice(-200).forEach(p=>a.add(p)),m.forEach(p=>a.add(p.id)),Array.from(a)},[m]),f=s.useCallback(async(a=3)=>{var v,_,K,ve;if(ke.current)return[];const l=Date.now();if(l<Ie.current){const oe=Math.ceil((Ie.current-l)/1e3);return t(`Rate limited. Please wait ${oe}s.`,{durationMs:3e3,variant:"warn"}),[]}const p=l-ue.current;if(p<2e3){const oe=2e3-p;await new Promise(Re=>setTimeout(Re,oe))}ke.current=!0,ue.current=Date.now();try{const oe=i(),Re=he().join(","),je=[],Ce=new Set(m.map(pe=>pe.id));let _e=[...oe];const Je=Math.min(a,3);for(let pe=0;pe<Je;pe++){if(pe>0){const X=Date.now()-Se.current,ne=1e3;X<ne&&await new Promise(xe=>setTimeout(xe,ne-X))}try{Se.current=Date.now();const X=await T(C.feed.next+Me({exclude:_e.join(","),modes:Re}),{requireAuth:!1}),ne=X&&("id"in X?X:X.video)||null;if(!ne)break;if(N.current.has(ne.id)||Ce.has(ne.id)||ne.id===ye.current){_e.push(ne.id);continue}je.push(ne),_e.push(ne.id),Ce.add(ne.id)}catch(X){if((v=X==null?void 0:X.message)!=null&&v.includes("401")||(_=X==null?void 0:X.message)!=null&&_.includes("Unauthorized")){H(!0);break}else if((K=X==null?void 0:X.message)!=null&&K.includes("429")||(ve=X==null?void 0:X.message)!=null&&ve.includes("rate limit")){Ie.current=Date.now()+5e3,t("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(je.length>0&&D(pe=>{const X=new Set(pe.map(xe=>xe.id)),ne=je.filter(xe=>!X.has(xe.id));return[...pe,...ne]}),je.length===0&&m.length===0)try{const pe=he().join(","),X=await T(C.feed.progress(pe),{requireAuth:!1});P(Number(X.eligible||0)),z(Number(X.viewed||0)),g(Number(X.caught_up||0)===1)}catch{}return je}catch{return[]}finally{ke.current=!1}},[i,he,m,t]),x=s.useCallback(async()=>{if(!Y){k(!0);try{m.length<=2&&f(3).catch(()=>{});let a;if(m.length>0)a=m[0],D(l=>l.filter(p=>p.id!==a.id));else{const l=await f(3);l.length>0&&(a=l[0],l.length>1&&D(p=>{const v=new Set(p.map(K=>K.id)),_=l.slice(1).filter(K=>!v.has(K.id));return[...p,..._]}))}if(a)ye.current=a.id,N.current.add(a.id),yt({seenIds:Array.from(N.current)}),u(l=>{const p=[...l.slice(0,r+1),a];return j(p.length-1),p}),de.current.has(a.id)||(de.current.add(a.id),T(C.videos.view(a.id),{method:"POST"}).then(l=>{l&&u(p=>{const v=[...p],_=v.findIndex(K=>K.id===a.id);return _!==-1&&(v[_]={...v[_],views_count:l.views_count??v[_].views_count??0,viewed_by_me:!0}),v})}).catch(()=>{}));else try{const l=he().join(","),p=await T(C.feed.progress(l),{requireAuth:!1});P(Number(p.eligible||0)),z(Number(p.viewed||0)),g(Number(p.eligible||0)>0&&Number(p.viewed||0)>=Number(p.eligible||0))}catch{}}finally{k(!1)}}},[Y,m,f,r,he]),O=s.useCallback(()=>{te.current&&!te.current.paused&&te.current.pause(),b(!0),q(!1)},[]),se=s.useCallback(()=>{r>0&&(j(r-1),b(!1))},[r]),fe=s.useCallback(()=>{const a=Date.now();if(!(a-Ue.current<300)){if(Ue.current=a,S||(me.current=!0,$(!1)),r<d.length-1){const l=d[r+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:r,nextIndex:r+1,currentVideoId:n==null?void 0:n.id,nextVideoId:l==null?void 0:l.id,nextVideoStreamUID:l==null?void 0:l.stream_uid}),l&&(ye.current=l.id),j(r+1),b(!1);return}if(!F){if(Date.now()<Ie.current){const l=Math.ceil((Ie.current-Date.now())/1e3);t(`Rate limited. Please wait ${l}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),x()}}},[r,d,S,F,x,t,n]);s.useEffect(()=>{const a=Qe.current;if(!a)return;const l=_=>{if(U||Math.abs(_.deltaY)<Math.abs(_.deltaX))return;_.preventDefault(),_.stopPropagation();const K=Date.now();if(!(K<De.current)){if(De.current=K+1e3,!n){_.deltaY>0&&!Y&&x();return}_.deltaY>0?fe():se()}},p=_=>{Pe.current=_.touches[0].clientY,We.current=Date.now()},v=_=>{if(U||Pe.current===null||We.current===null)return;const K=_.changedTouches[0].clientY,ve=Date.now(),oe=Pe.current-K,Re=ve-We.current;if(Pe.current=null,We.current=null,Math.abs(oe)<50||Re>300)return;const je=Date.now();if(!(je<De.current)){if(De.current=je+1e3,!n){oe>0&&!Y&&x();return}oe>0?fe():se()}};return a.addEventListener("wheel",l,{passive:!1,capture:!0}),a.addEventListener("touchstart",p,{passive:!0}),a.addEventListener("touchend",v,{passive:!0}),window.addEventListener("wheel",l,{passive:!1,capture:!0}),()=>{a.removeEventListener("wheel",l,{capture:!0}),a.removeEventListener("touchstart",p),a.removeEventListener("touchend",v),window.removeEventListener("wheel",l,{capture:!0})}},[fe,se,n,Y,x,U]);const Rt=s.useCallback(async()=>{var a,l;if(!(!n||o)){Q(!0);try{const p=n.liked_by_me?"DELETE":"POST",v=await T(C.videos.like(n.id),{method:p});u(_=>{const K=[..._],ve=K.findIndex(oe=>oe.id===n.id);return ve!==-1&&(K[ve]={...K[ve],liked_by_me:!n.liked_by_me,likes_count:v.likes_count}),K})}catch(p){((a=p==null?void 0:p.message)!=null&&a.includes("429")||(l=p==null?void 0:p.message)!=null&&l.includes("rate limit"))&&t("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{Q(!1)}}},[n,o,t]),it=s.useCallback(async a=>{if(n)try{await T(C.videos.flag(n.id),{method:"POST",body:JSON.stringify({reason:a})}),t("Thanks for your report.",{variant:"info"})}catch{t("Report failed",{variant:"error"})}finally{J(!1)}},[n,t]),Mt=s.useCallback(async()=>{if(!n)return;const a=!n.is_starred,l=a?"star":"unstar";try{await T(C.admin.videosAction(n.id,l),{method:"POST"}),u(p=>{const v=[...p],_=v.findIndex(K=>K.id===n.id);return _!==-1&&(v[_]={...v[_],is_starred:a}),v}),le(!1),t(a?"Post starred":"Star removed",{variant:"success"})}catch{t("Action failed",{variant:"error"})}},[n,t]),rt=s.useCallback(async()=>{if(!(!n||!confirm("Permanently delete this video?")))try{await T(C.videos.delete(n.id),{method:"DELETE"}),t("Deleted",{variant:"warn"}),J(!1),u(a=>{const l=a.filter((p,v)=>v!==r);return l.length===0?(j(-1),setTimeout(x,0)):j(p=>Math.max(0,Math.min(p,l.length-1))),l})}catch{alert("Delete failed")}},[n,r,x,t]),Be=s.useCallback(async()=>{if(n!=null&&n.id)try{const a=await T(C.videos.comments(n.id),{requireAuth:!1});M(a.items||[])}catch{}},[n==null?void 0:n.id]);s.useEffect(()=>{y&&(n!=null&&n.id)&&Be()},[y,n==null?void 0:n.id,Be]);const ot=s.useCallback(async a=>{if(a.preventDefault(),!(!I.trim()||!(n!=null&&n.id))){L(!0);try{await T(C.videos.comments(n.id),{method:"POST",body:JSON.stringify({text:I.trim(),parent_id:ce||void 0})}),B(""),c(null),Be(),u(l=>{const p=[...l],v=p.findIndex(_=>_.id===n.id);return v!==-1&&(p[v]={...p[v],comments_count:(p[v].comments_count||0)+1}),p}),t("Comment posted!",{variant:"success"})}catch(l){t((l==null?void 0:l.message)||"Failed to post comment",{variant:"error"})}finally{L(!1)}}},[I,n,ce,Be,t]),It=s.useCallback(a=>{M(l=>l.filter(p=>p.id!==a)),u(l=>{const p=[...l],v=p.findIndex(_=>_.id===(n==null?void 0:n.id));return v!==-1&&(p[v]={...p[v],comments_count:Math.max(0,(p[v].comments_count||0)-1)}),p})},[n==null?void 0:n.id]),{topLevelComments:lt,repliesMap:ct}=s.useMemo(()=>{const a=ee.filter(p=>!p.parent_id),l=new Map;return ee.filter(p=>p.parent_id).forEach(p=>{const v=p.parent_id;l.has(v)||l.set(v,[]),l.get(v).push(p)}),{topLevelComments:a,repliesMap:l}},[ee]),Lt=s.useCallback(()=>{if(!te.current)return;const a=!S;$(a),te.current.muted=a,a||(me.current=!0),!a&&te.current.paused&&te.current.play().catch(()=>{})},[S]),Ft=s.useCallback(a=>{te.current=a,a&&(a.muted=S)},[S]);s.useEffect(()=>{b(!1),w(!1),me.current?$(!1):$(!0)},[n==null?void 0:n.id,n==null?void 0:n.stream_uid,r,d.length]),s.useEffect(()=>{te.current&&(te.current.muted=S)},[S]),s.useEffect(()=>{if(!n)return;const a=!me.current;$(a);const l=setTimeout(()=>{te.current&&(te.current.muted=a)},100);return()=>clearTimeout(l)},[n==null?void 0:n.id]),s.useEffect(()=>{n&&(ye.current=n.id)},[n==null?void 0:n.id]),s.useEffect(()=>{W&&te.current&&!te.current.paused&&te.current.pause()},[W]),s.useEffect(()=>{d.length===0&&x()},[]),s.useEffect(()=>{(async()=>{try{const a=he().join(","),l=await T(C.feed.progress(a),{requireAuth:!1}),p=Number(l.eligible||0),v=Number(l.viewed||0);P(p),z(v),g(p>0&&v>=p)}catch{}})()},[he]),s.useEffect(()=>{const a=()=>{u([]),D([]),N.current.clear(),ye.current=null,j(-1),g(!1),(async()=>{try{const l=he().join(","),p=await T(C.feed.progress(l),{requireAuth:!1}),v=Number(p.eligible||0),_=Number(p.viewed||0);P(v),z(_),g(!1)}catch{}x()})()};return window.addEventListener("filterchange",a),()=>window.removeEventListener("filterchange",a)},[he,x]),s.useEffect(()=>{(async()=>{try{const a=await T(C.auth.me,{requireAuth:!1});be(a)}catch{}})()},[]);const[Ee,dt]=s.useState(()=>typeof window<"u"?window.matchMedia("(max-width: 480px)").matches:!1);s.useEffect(()=>{const a=()=>{const v=document.querySelector(".top-nav");v&&Ye(v.offsetHeight),dt(window.matchMedia("(max-width: 480px)").matches)};a();const l=window.matchMedia("(max-width: 480px)"),p=()=>dt(l.matches);return l.addEventListener("change",p),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),l.removeEventListener("change",p)}},[]),s.useEffect(()=>{var p;if(!Le.current||!Fe.current||!n||!te.current)return;const a=()=>{var Re;const v=(Re=Fe.current)==null?void 0:Re.querySelector("div"),_=te.current;if(!v||!_||!Le.current)return;const K=Le.current,ve=window.matchMedia("(max-width: 480px)").matches;let oe;if(n.width&&n.height?oe=n.width/n.height:_.videoWidth>0&&_.videoHeight>0?oe=_.videoWidth/_.videoHeight:oe=16/9,ve){const Ce=K.offsetWidth,_e=Ce/oe;v.style.width=`${Ce}px`,v.style.height=`${_e}px`,v.style.maxWidth="100%",v.style.maxHeight="100%"}else{const Ce=K.offsetWidth-32,_e=K.offsetHeight-32,Je=16/9,pe=Ce/Je;let ne=Math.min(_e,pe),xe=ne*oe;xe>Ce&&(xe=Ce,ne=xe/oe),ne>_e&&(ne=_e,xe=ne*oe),v.style.width=`${xe}px`,v.style.height=`${ne}px`,v.style.maxWidth="100%",v.style.maxHeight="100%"}},l=()=>{requestAnimationFrame(a)};if(te.current.readyState>=1)a();else{const v=()=>{var _;a(),(_=te.current)==null||_.removeEventListener("loadedmetadata",v)};(p=te.current)==null||p.addEventListener("loadedmetadata",v)}return window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l)}},[n==null?void 0:n.id,n==null?void 0:n.width,n==null?void 0:n.height]),s.useEffect(()=>{if(!h)return;const a=l=>{Oe.current&&!Oe.current.contains(l.target)&&J(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[h]),s.useEffect(()=>{if(!ie)return;const a=l=>{Te.current&&!Te.current.contains(l.target)&&le(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[ie]),s.useEffect(()=>{if(!re)return;const a=l=>{ze.current&&!ze.current.contains(l.target)&&Ae.current&&!Ae.current.contains(l.target)&&q(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[re]);const ut=!!(G!=null&&G.is_admin||G!=null&&G.is_mod);return e.jsxs(e.Fragment,{children:[e.jsx(Et,{paused:Ee}),e.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
        /* Mobile-specific: ensure videos take full width */
        @media (max-width: 480px) {
          .video-area .discover-player-wrapper > div {
            min-width: 100% !important;
            max-width: 100% !important;
          }
          .video-area .discover-player-wrapper > div[style] {
            min-width: 100% !important;
            max-width: 100% !important;
          }
        }
      `}),e.jsxs("div",{ref:Qe,className:"player-wrap",style:{height:"100dvh",width:"100vw",position:"fixed",top:Ee?"calc(0px - env(safe-area-inset-top, 0px))":0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1,margin:0,padding:0,boxSizing:"border-box"},children:[F&&e.jsx("div",{className:"chip info",style:{position:"absolute",top:$e+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),e.jsx("div",{ref:Le,className:"video-area discover-video-container",style:{position:"absolute",top:Ee?0:$e,left:0,right:0,bottom:Ee?"-10px":0,maxHeight:Ee?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${$e}px)`,height:Ee?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${$e}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:Ee?"none":"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:Ee?"0":"16px",maxWidth:"100vw",width:"100%"},children:U?e.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),e.jsx("button",{className:"btn",onClick:()=>window.location.href=et+C.auth.login,children:"Login with osu!"})]}):n?e.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),e.jsxs("div",{onClick:Lt,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("div",{ref:Fe,className:"discover-player-wrapper",children:e.jsx(ls,{streamUID:n.stream_uid,playbackUrl:n.playback_url,aspectRatio:n.width&&n.height?n.width/n.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:S,controls:!1,onVideoRef:Ft})}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:S?1:0,zIndex:2},children:S?e.jsx(Kt,{size:28,color:"#fff"}):e.jsx(Xt,{size:28,color:"#fff"})})]})]})}):F?null:e.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[e.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),e.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[e.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),e.jsx("div",{children:"• Click video to toggle mute/unmute"}),e.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),n&&!W&&e.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:a=>a.stopPropagation(),children:[e.jsx(V,{to:`/profile/${(mt=n.uploader)==null?void 0:mt.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(pt=n.uploader)!=null&&pt.avatar_url?e.jsx("img",{src:n.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:n.uploader.username}):e.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:Rt,disabled:o,"aria-label":n.liked_by_me?"Unlike":"Like",title:n.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:n.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:a=>a.currentTarget.style.transform="scale(1.1)",onMouseLeave:a=>a.currentTarget.style.transform="scale(1)",children:n.liked_by_me?e.jsx(St,{size:28}):e.jsx(_t,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.likes_count??0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[e.jsx("button",{onClick:()=>w(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:a=>a.currentTarget.style.transform="scale(1.1)",onMouseLeave:a=>a.currentTarget.style.transform="scale(1)",children:e.jsx(Tt,{size:28})}),e.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:n.comments_count??0})]}),n.beatmap_url&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:Ae,onClick:()=>q(a=>!a),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:a=>a.currentTarget.style.transform="scale(1.1)",onMouseLeave:a=>a.currentTarget.style.transform="scale(1)",children:e.jsx(Ze,{size:24})}),re&&e.jsxs("div",{ref:ze,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsxs("a",{className:"menu-item",href:n.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>q(!1),children:[e.jsx(Ze,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),n.beatmapset_id&&e.jsx("button",{className:"menu-item",onClick:O,children:"Preview"})]})]}),ut?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>le(a=>!a),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:a=>a.currentTarget.style.transform="scale(1.1)",onMouseLeave:a=>a.currentTarget.style.transform="scale(1)",children:e.jsx(bt,{size:24})}),ie&&e.jsxs("div",{ref:Te,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("button",{className:"menu-item",onClick:Mt,children:n.is_starred?"Unstar post":"Star post"}),e.jsx("button",{className:"menu-item",onClick:rt,children:"Delete video"})]})]}):e.jsx("button",{onClick:()=>J(a=>!a),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:a=>a.currentTarget.style.transform="scale(1.1)",onMouseLeave:a=>a.currentTarget.style.transform="scale(1)",children:e.jsx(Zt,{size:24})}),h&&e.jsxs("div",{ref:Oe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),e.jsx("button",{className:"menu-item",onClick:()=>it("unrelated"),children:"Unrelated"}),e.jsx("button",{className:"menu-item",onClick:()=>it("explicit"),children:"Explicit"}),ut&&e.jsx("button",{className:"menu-item",onClick:rt,children:"Delete video"})]})]}),n&&!W&&e.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:a=>a.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:e.jsx(V,{to:`/profile/${(ht=n.uploader)==null?void 0:ht.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var v,_,K;const a=(v=n.uploader)==null?void 0:v.is_admin,l=(_=n.uploader)==null?void 0:_.is_mod,p=a?"#fff3bf":l?"#d7fbe8":"#fff";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:p},children:["@",(K=n.uploader)==null?void 0:K.username]}),n.is_starred&&e.jsx(kt,{size:16,color:"#f59e0b",title:"Starred"}),(a||l)&&e.jsx(bt,{size:14,color:p,title:a?"admin":"mod"})]})})()})}),(n.description??"").trim()&&e.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:n.description}),n.beatmap_title&&e.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[n.beatmap_artist," – ",n.beatmap_title," ",n.beatmap_mapper?`(by ${n.beatmap_mapper})`:""," ",n.beatmap_version?`[${n.beatmap_version}]`:""]})]}),y&&n&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",n.comments_count??0,")"]}),e.jsx("button",{onClick:()=>w(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:e.jsx(at,{size:24})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:lt.length===0?e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"col",style:{gap:0},children:lt.map(a=>e.jsx(cs,{comment:a,replies:ct.get(a.id)||[],me:G,section:"mappi",onReply:l=>c(l),onDelete:It,replyingTo:ce,replyText:I,onReplyTextChange:B,onReplySubmit:ot,posting:A,onCancelReply:()=>{c(null),B("")},repliesMap:ct},a.id))})}),G&&!ce&&e.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:e.jsxs("form",{onSubmit:ot,style:{display:"flex",alignItems:"flex-end",gap:8},children:[e.jsx("textarea",{placeholder:"Write a comment...",value:I,onChange:a=>B(a.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:a=>{const l=a.target;l.style.height="auto",l.style.height=`${Math.min(l.scrollHeight,120)}px`}}),e.jsx("button",{type:"submit",className:"btn compact",disabled:A||!I.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:A?"...":"Post"})]})})]})]}),W&&(n==null?void 0:n.beatmapset_id)&&e.jsx(Es,{open:W,onClose:()=>b(!1),downloadUrl:`${et}${C.osu.downloadBeatmapset(n.beatmapset_id)}`,beatmapId:n.beatmap_id??void 0,beatmapVersion:n.beatmap_version??void 0})]})]})}function jt(t){if(!t)return"standard";const d=String(t).toLowerCase().trim();return d==="osu"||d==="0"||d==="standard"?"standard":d==="taiko"||d==="1"?"taiko":d==="catch"||d==="fruits"||d==="2"?"catch":d==="mania"||d==="3"?"mania":"standard"}const Ws=({open:t,onClose:d,videoId:u,initialDescription:r,initialBeatmapUrl:j,onSave:m})=>{const[D,Y]=s.useState(r||""),[k,F]=s.useState(j||""),[g,R]=s.useState(null),[P,E]=s.useState(null),[z,U]=s.useState(""),[H,S]=s.useState(!1),$=s.useRef(0);s.useEffect(()=>{t&&(Y(r||""),F(j||""),R(null),E(null),U(""))},[t,r,j]),s.useEffect(()=>{if(!t)return;$.current&&window.clearTimeout($.current);const b=(k||"").trim();if(!b){U(""),R(null),E(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(b)){U(""),R(null),E(null);return}return $.current=window.setTimeout(async()=>{var w;try{let h;try{h=new URL(b)}catch{U("Invalid URL format");return}const J=h.hash.match(/#osu\/(\d+)/),ie=J?J[1]:null;h.hash="";const re={url:h.toString()};ie&&(re.beatmap_id=ie);const q=await T(C.osu.resolveBeatmap+Me(re),{requireAuth:!1}),ee=Array.isArray(q==null?void 0:q.diffs)?q.diffs:[];if(!ee.length&&!q.setId){U("No difficulties found"),R(null),E(null);return}if(R({setId:Number(q.setId)||0,beatmapId:q.beatmapId??null,title:String(q.title||""),artist:String(q.artist||""),mapper:String(q.mapper||""),diffs:ee}),ee.length>0){const M=Number.isFinite(Number(q.beatmapId))?Number(q.beatmapId):Number((w=ee[0])==null?void 0:w.id),I=ee.find(ce=>Number(ce.id)===M)||ee[0],B=jt(I==null?void 0:I.mode);E({beatmapId:Number(I==null?void 0:I.id)||null,version:String((I==null?void 0:I.version)||""),mode:B})}U("")}catch(h){U(`Failed to resolve: ${(h==null?void 0:h.message)||"Unknown error"}`),R(null),E(null)}},400),()=>{$.current&&window.clearTimeout($.current)}},[k,t]);const W=async()=>{if(!H){S(!0);try{await T(C.videos.update(u),{method:"PATCH",body:JSON.stringify({description:D.slice(0,100),beatmap_url:k.trim()||void 0})});const b=!!k.trim();if(g||!b)try{await T(C.videos.update(u)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:b&&g&&g.setId>0?g.setId:null,beatmap_id:b&&(P!=null&&P.beatmapId)?P.beatmapId:null,beatmap_version:b&&(P!=null&&P.version)?P.version:null,beatmap_title:b&&(g!=null&&g.title)?g.title:null,beatmap_artist:b&&(g!=null&&g.artist)?g.artist:null,beatmap_mapper:b&&(g!=null&&g.mapper)?g.mapper:null,beatmap_url:b?k.trim():null})})}catch(w){console.warn("Failed to update beatmap metadata:",w)}m(D,k.trim()||null),d()}catch(b){alert((b==null?void 0:b.message)||"Failed to update post")}finally{S(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:b=>b.target===b.currentTarget&&d(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:d}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:d,"aria-label":"Close",children:e.jsx(at,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:D,onChange:b=>Y(b.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),g?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[g.artist," – ",g.title]}),e.jsxs("span",{className:"muted",children:["by ",g.mapper]})]}),e.jsx("select",{value:(P==null?void 0:P.beatmapId)??g.beatmapId??void 0,onChange:b=>{const y=Number(b.target.value),w=(g==null?void 0:g.diffs.find(h=>Number(h.id)===y))||null;if(w){const h=jt(w.mode);E({beatmapId:y,version:w.version,mode:h})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"},children:g.diffs.map(b=>e.jsxs("option",{value:b.id,children:[b.version," (",b.mode,")"]},b.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{R(null),E(null),F("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:k,onChange:b=>F(b.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px"}}),z&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:z})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:d,disabled:H,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:W,disabled:H,children:H?"Saving...":"Save"})]})]})]})]}):null};function wt(){const t=es(),d=st(),{notify:u}=He(),[r,j]=s.useState(null),[m,D]=s.useState(null),[Y,k]=s.useState(""),[F,g]=s.useState([]),[R,P]=s.useState([]),[E,z]=s.useState([]),[U,H]=s.useState(""),[S,$]=s.useState(null),[W,b]=s.useState([]),[y,w]=s.useState(null),[h,J]=s.useState(""),[ie,le]=s.useState([]),[re,q]=s.useState(null),[ee,M]=s.useState(!1),I=s.useMemo(()=>{const c=t.id?Number(t.id):null;return c?r?r.id===c:!1:!0},[t.id,r]);function B(c){const A=c.stream_uid||String(c.id),L=t.id?`/profile/${t.id}`:"/profile";d(`/mp/feed/${A}`,{state:{returnTo:L}})}s.useEffect(()=>{(async()=>{try{const c=await T(C.auth.me,{requireAuth:!1});j(c),c&&Array.isArray(c.inspirations)&&b(c.inspirations)}catch(c){k((c==null?void 0:c.message)||"Not logged in")}})()},[]),s.useEffect(()=>{(async()=>{try{const c=t.id?Number(t.id):null;if(c){const A=await T(C.users.get(c),{requireAuth:!1});D(A),H(A.about||""),Array.isArray(A.inspirations)&&b(A.inspirations);const L=await T(C.users.videos(c)+Me({limit:"60"}),{requireAuth:!1});z(L.items||[]);const G=await T(C.users.likes(c)+Me({limit:"60"}),{requireAuth:!1});P(G.items||[])}else{if(!r)return;D(r),H(r.about||""),Array.isArray(r.inspirations)&&b(r.inspirations);const A=await T(C.users.myVideos+Me({limit:"50"}),{requireAuth:!1});g(A.items||[]);const L=await T(C.users.likes(r.id)+Me({limit:"60"}),{requireAuth:!1});P(L.items||[])}}catch{}})()},[t.id,r]),s.useEffect(()=>{M(!1)},[m==null?void 0:m.id]);async function ce(c){try{const L=(await T(C.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:c})})).user||m;D(L),Array.isArray(L==null?void 0:L.inspirations)&&b(L.inspirations),t.id||j(L)}catch{}}return s.useEffect(()=>{let c;return y!==null&&h.trim().length>=2?c=setTimeout(async()=>{try{const A=await T(C.osu.usersSearch(h),{requireAuth:!1});le(Array.isArray(A.items)?A.items:[])}catch{}},250):le([]),()=>{c&&clearTimeout(c)}},[h,y]),e.jsxs("div",{className:"feed-container",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:m?e.jsxs(e.Fragment,{children:[m.avatar_url&&e.jsx("img",{src:m.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[m.username,m.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${m.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:c=>c.currentTarget.style.opacity="1",onMouseLeave:c=>c.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(Ze,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",m.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!I&&W.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),W.map((c,A)=>I?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>q(c.id),onMouseLeave:()=>q(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const L=W.filter((G,be)=>be!==A);b(L),ce(L)},children:e.jsx("img",{src:c.avatar_url,alt:c.username})}),re===c.id&&e.jsxs("div",{className:"insp-tooltip",children:[c.username," — click to remove"]})]},c.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>q(c.id),onMouseLeave:()=>q(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${c.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:c.avatar_url,alt:c.username})}),re===c.id&&e.jsx("div",{className:"insp-tooltip",children:c.username})]},c.id)),I&&W.length<3&&new Array(3-W.length).fill(0).map((c,A)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>q(-A-1),onMouseLeave:()=>q(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{w(A),J(""),le([])},children:"+"}),re===-A-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),y===A&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:h,onChange:L=>J(L.target.value)}),e.jsxs("div",{className:"insp-results",children:[ie.length===0&&h.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),ie.map(L=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(r&&Number(r.osu_user_id)===Number(L.id)){u("Kinda based, but no.",{variant:"warn"}),w(null);return}if(W.some(be=>be.id===L.id)){w(null);return}const G=[...W,{id:L.id,username:L.username,avatar_url:L.avatar_url}].slice(0,3);b(G),w(null),ce(G)},children:[e.jsx("img",{src:L.avatar_url,alt:"avatar"}),e.jsx("span",{children:L.username})]},L.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>w(null),children:"Close"})]})]},`slot-${A}`))]}),I&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:Y||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),I?e.jsxs("div",{className:"col",style:{gap:6},children:[e.jsx("textarea",{value:U,onChange:c=>H(c.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)"}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{className:"btn compact",onClick:async()=>{try{const c=await T(C.auth.me,{method:"PATCH",body:JSON.stringify({about:U})});D(c.user||m),j(c.user||r)}catch{}},children:"Save"})})]}):(()=>{const c=((m==null?void 0:m.about)||"").trim()||"No bio.",A=c.length>200,L=A&&!ee?c.slice(0,200)+"...":c;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:L}),A&&e.jsx("button",{onClick:()=>M(!ee),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:ee?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(ts,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Ct,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:c=>{const A=c.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(G=>{G.classList.remove("active"),G.setAttribute("aria-selected","false")}),c.currentTarget.classList.add("active"),c.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:c=>{const A=c.currentTarget.closest(".profile-tabs-unified");A.querySelectorAll(".profile-tab").forEach(G=>{G.classList.remove("active"),G.setAttribute("aria-selected","false")}),c.currentTarget.classList.add("active"),c.currentTarget.setAttribute("aria-selected","true"),A.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(I?F:E).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(I?F:E).map(c=>(I&&m?(m.id,m.username,m.avatar_url,m.is_admin,m.is_mod):c.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>B({...c}),children:[c.poster_url?e.jsx("img",{className:"recent-thumb",src:c.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(_t,{size:12}),e.jsx("span",{children:c.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Tt,{size:12}),e.jsx("span",{children:c.comments_count??0})]})]})})]},c.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[R.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),R.map(c=>{var A,L;return e.jsxs("button",{className:"recent-cell",onClick:()=>B(c),children:[c.poster_url?e.jsx("img",{className:"recent-thumb",src:c.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((A=c.uploader)==null?void 0:A.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:c.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(L=c.uploader)==null?void 0:L.username})]})]},c.id)})]})})})]})]}),S&&e.jsx(Ws,{open:!!S,onClose:()=>$(null),videoId:S.id,initialDescription:S.description,initialBeatmapUrl:S.beatmap_url,onSave:(c,A)=>{g(F.map(L=>L.id===S.id?{...L,description:c||null,beatmap_url:A}:L)),$(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.06); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid rgba(255,255,255,0.08); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed rgba(255,255,255,0.25); background: transparent; color: #e5e7eb; font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: rgba(255,255,255,0.5); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; box-shadow: 0 12px 30px rgba(0,0,0,0.4); padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: var(--panel-dark); color: #fff; outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: #e5e7eb; cursor: pointer; text-align: left; }
        .insp-result:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: #e5e7eb; cursor: pointer; }
      `})]})}function $s(){var c,A,L,G,be;const[t,d]=s.useState(null),[u,r]=s.useState([]),[j,m]=s.useState(""),[D,Y]=s.useState([]),[k,F]=s.useState(null),[g,R]=s.useState([]),[P,E]=s.useState("all"),[z,U]=s.useState("approvals"),[H,S]=s.useState(null),[$,W]=s.useState(""),[b,y]=s.useState(!1),{notify:w}=He(),[h,J]=s.useState(null),[ie,le]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const o=await T(C.auth.me,{requireAuth:!1});if(d(o),o!=null&&o.is_admin)try{const Q=await T(C.admin.settingsModeration,{requireAuth:!1});S(!!Q.require_approval)}catch{}}catch{}try{const o=await T(C.admin.videosPending+Me({limit:"50"}),{requireAuth:!1});r(o.items||[])}catch{}})()},[]);async function re(){le(!0);try{const o=await T(C.admin.analytics,{requireAuth:!1});J(o)}finally{le(!1)}}async function q(){try{const o=await T(C.admin.usersSearch(j),{requireAuth:!1});Y(o.items||[])}catch{}}async function ee(o){F(o),R([]);try{const Q=await T(C.admin.userVideos(o.id)+Me({limit:"50"}),{requireAuth:!1});R(Q.items||[])}catch{}}async function M(o,Q){try{const N=await T(C.admin.user(o.id),{method:"PATCH",body:JSON.stringify({is_mod:Q})}),de=(N==null?void 0:N.user)||{...o,is_mod:Q};w(Q?"Granted moderation":"Revoked moderation",{variant:Q?"success":"warn"}),F(de),Y(D.map(ke=>ke.id===o.id?de:ke))}catch{alert("Failed to update")}}const I=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),B=!!(t!=null&&t.is_admin),ce=H===null?null:!H;return e.jsxs("div",{className:"col",style:{width:"100%"},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[e.jsx("div",{className:"title",children:"Moderation"}),B&&ce!==null&&e.jsxs("div",{className:"row",style:{alignItems:"center",gap:6},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:"Auto-approve"}),e.jsx("button",{className:`btn ${ce?"":"secondary"}`,style:{padding:"6px 10px"},onClick:async()=>{if(H===null)return;const o=!H;try{await T(C.admin.settingsModeration,{method:"POST",body:JSON.stringify({require_approval:o})}),S(o),w(o?"Auto-approve disabled":"Auto-approve enabled",{variant:o?"warn":"success"})}catch{alert("Failed to update setting")}},children:ce?"On":"Off"})]})]}),I&&e.jsxs("div",{className:"tabs",role:"tablist","aria-label":"Moderation tabs",children:[e.jsx("button",{role:"tab","aria-selected":z==="approvals",className:`tab ${z==="approvals"?"active":""}`,onClick:()=>U("approvals"),children:"Approvals"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":z==="manage",className:`tab ${z==="manage"?"active":""}`,onClick:()=>U("manage"),children:"Manage"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":z==="analytics",className:`tab ${z==="analytics"?"active":""}`,onClick:()=>{U("analytics"),h||re()},children:"Analytics"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":z==="message",className:`tab ${z==="message"?"active":""}`,onClick:()=>U("message"),children:"Message"})]})]}),e.jsx("hr",{className:"subtle-divider"}),!I&&e.jsx("div",{className:"muted",children:"You do not have access."}),z==="approvals"&&I&&(()=>{const o=u.filter(N=>!N.flagged_only),Q=u.filter(N=>!!N.flagged_only);return e.jsxs("div",{className:"row wrap",style:{marginTop:12,gap:16,alignItems:"flex-start"},children:[e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Pending approvals"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[o.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",children:[o.length===0&&e.jsx("div",{className:"muted",children:"Nothing pending."}),o.map(N=>e.jsxs("div",{className:"row wrap",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[N.poster_url?e.jsx("img",{src:N.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:N.description||"",children:N.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:["uploader: ",N.username,N.needs_review?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{marginLeft:6,color:"#60a5fa"},children:"(pending)"}),typeof N.flags_count=="number"&&N.flags_count>0?e.jsxs("span",{className:"muted",style:{marginLeft:6},children:["• ",N.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"row wrap",children:[e.jsx("button",{className:"btn secondary",onClick:async()=>{try{await T(C.admin.videosReject(N.id),{method:"POST"}),r(u.filter(de=>de.id!==N.id)),w("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn",style:{marginLeft:8},onClick:async()=>{try{await T(C.admin.videosApprove(N.id),{method:"POST"}),r(u.filter(de=>de.id!==N.id)),w("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await T(C.videos.delete(N.id),{method:"DELETE"}),r(u.filter(de=>de.id!==N.id)),w("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},N.id))]})]}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Flagged (FYI)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[Q.length," item(s)"]})]}),e.jsxs("div",{className:"scroll-panel sm",children:[Q.length===0&&e.jsx("div",{className:"muted",children:"No flagged items."}),Q.map(N=>e.jsxs("div",{className:"row wrap",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[N.poster_url?e.jsx("img",{src:N.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:N.description||"",children:N.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:["uploader: ",N.username,e.jsx("span",{style:{marginLeft:6,color:"#9ca3af"},children:"(flagged)"}),typeof N.flags_count=="number"&&N.flags_count>0?e.jsxs("span",{className:"muted",style:{marginLeft:6},children:["• ",N.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"row wrap",children:e.jsx("button",{className:"btn secondary",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await T(C.videos.delete(N.id),{method:"DELETE"}),r(u.filter(de=>de.id!==N.id)),w("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},N.id))]}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:6},children:"Flagged items don’t require approval; use Delete only if necessary."})]})]})})(),z==="manage"&&(B||(t==null?void 0:t.is_mod))&&e.jsx("div",{className:"col",style:{marginTop:16},children:e.jsxs("div",{className:"mod-manage-grid",children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"User management"}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:j,onChange:o=>m(o.target.value),onKeyDown:o=>{o.key==="Enter"&&q()}}),e.jsx("button",{className:"btn",onClick:q,style:{padding:"6px 10px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:8},children:e.jsx("div",{className:"col",style:{gap:6},children:D.map(o=>e.jsxs("button",{className:"btn secondary",onClick:()=>ee(o),style:{justifyContent:"flex-start"},children:[o.avatar_url&&e.jsx("img",{src:o.avatar_url,width:18,height:18,style:{borderRadius:"50%",marginRight:8}}),e.jsx("span",{className:"one-line",style:{marginRight:8},children:o.username}),e.jsxs("span",{className:"muted",children:["(id ",o.id,", osu ",o.osu_user_id,")"]}),o.is_admin?e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"admin"}):o.is_mod?e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"mod"}):o.is_blacklisted?e.jsx("span",{style:{marginLeft:"auto",color:"#f87171"},children:"blacklisted"}):null]},o.id))})})]}),e.jsx("div",{className:"v-divider","aria-hidden":"true"}),e.jsx("div",{className:"col",style:{minWidth:0},children:k?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row wrap",style:{alignItems:"center"},children:[k.avatar_url&&e.jsx("img",{src:k.avatar_url,width:28,height:28,style:{borderRadius:"50%",marginRight:8}}),e.jsx("div",{className:"title",style:{marginRight:8,fontSize:18},children:k.username}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["id ",k.id," • osu ",k.osu_user_id]}),e.jsx("div",{style:{marginLeft:"auto"}}),B?k.is_admin?e.jsx("span",{}):k.is_mod?e.jsx("button",{className:"btn secondary",style:{padding:"6px 10px"},onClick:()=>M(k,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn",style:{padding:"6px 10px"},onClick:()=>M(k,!0),children:"Grant moderation"}):null,!k.is_admin&&(k.is_blacklisted?e.jsx("button",{className:"btn",style:{marginLeft:8,padding:"6px 10px"},onClick:async()=>{try{await T(C.admin.user(k.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),F({...k,is_blacklisted:!1}),w("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary",style:{marginLeft:8,padding:"6px 10px"},onClick:async()=>{try{await T(C.admin.user(k.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),F({...k,is_blacklisted:!0}),w("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]}),k.is_admin?e.jsx("div",{className:"caption",style:{marginTop:4},children:"Admins always retain access"}):null,e.jsxs("div",{className:"col",style:{marginTop:12},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center"},children:[e.jsx("div",{className:"title",children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",style:{fontSize:12},children:"Show"}),e.jsx("button",{className:`btn ${P==="all"?"":"secondary"}`,onClick:()=>E("all"),children:"All"}),e.jsx("button",{className:`btn ${P==="review"?"":"secondary"}`,onClick:()=>E("review"),children:"Needs review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{marginTop:8},children:[g.length===0&&e.jsx("div",{className:"muted",children:"No uploads."}),g.filter(o=>{if(P==="all")return!0;const Q=(H?!o.approved_at:!1)&&o.status==="ready",N=!!o.needs_review;return Q||N}).map(o=>e.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 10px"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",minWidth:0,gap:10},children:[o.poster_url?e.jsx("img",{src:o.poster_url,width:64,height:36,style:{objectFit:"cover",borderRadius:6}}):e.jsx("div",{style:{width:64,height:36,borderRadius:6,background:"#0f1217"}}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"one-line",title:o.description||"",children:o.description||"No description."}),e.jsxs("div",{className:"muted one-line",children:[o.status.toUpperCase()," • ",new Date(o.created_at*1e3).toLocaleString(),o.needs_review?e.jsx("span",{style:{marginLeft:6,color:"#f59e0b"},children:"(purgatory)"}):null,H&&!o.approved_at&&o.status==="ready"?e.jsx("span",{style:{marginLeft:6,color:"#60a5fa"},children:"(pending)"}):null]})]})]}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("span",{className:"muted",children:o.likes_count??0}),e.jsx("span",{style:{color:"var(--accent)"},children:"★"}),(B||(t==null?void 0:t.is_mod))&&(!!o.needs_review||H&&!o.approved_at&&o.status==="ready")&&e.jsx("button",{className:"btn",onClick:async()=>{try{await T(C.admin.videosApprove(o.id),{method:"POST"}),R(g.map(Q=>Q.id===o.id?{...Q,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:Q)),w("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await T(C.videos.delete(o.id),{method:"DELETE"}),R(g.filter(Q=>Q.id!==o.id)),w("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},o.id))]})]})]}):e.jsx("div",{className:"muted",children:"Select a user to view details and uploads."})})]})}),!1,z==="message"&&(B||(t==null?void 0:t.is_mod))&&e.jsx("div",{className:"col",style:{marginTop:16},children:e.jsxs("div",{className:"mod-manage-grid",children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"Send a system message"}),e.jsxs("div",{className:"row wrap",style:{gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:j,onChange:o=>m(o.target.value),onKeyDown:o=>{o.key==="Enter"&&q()}}),e.jsx("button",{className:"btn",onClick:q,style:{padding:"6px 10px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:8},children:e.jsx("div",{className:"col",style:{gap:6},children:D.map(o=>e.jsxs("button",{className:"btn secondary",onClick:()=>F(o),style:{justifyContent:"flex-start"},children:[o.avatar_url&&e.jsx("img",{src:o.avatar_url,width:18,height:18,style:{borderRadius:"50%",marginRight:8}}),e.jsx("span",{className:"one-line",style:{marginRight:8},children:o.username}),e.jsxs("span",{className:"muted",children:["(id ",o.id,", osu ",o.osu_user_id,")"]}),(k==null?void 0:k.id)===o.id&&e.jsx("span",{style:{marginLeft:"auto",color:"var(--accent)"},children:"selected"})]},o.id))})})]}),e.jsx("div",{className:"v-divider","aria-hidden":"true"}),e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{marginBottom:6},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:o=>y(o.currentTarget.checked)}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",style:{height:120,resize:"vertical"},value:$,onChange:o=>W(o.target.value)}),e.jsx("div",{className:"row wrap",style:{justifyContent:"flex-end",gap:8},children:e.jsx("button",{className:"btn",onClick:()=>{const o=($||"").trim();if(!o){alert("Enter a message");return}(async()=>{try{const Q={text:o,global:b};!b&&(k!=null&&k.id)&&(Q.user_id=k.id),await T(C.admin.notificationsSystem,{method:"POST",body:JSON.stringify(Q)}),W(""),w("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"})}),e.jsx("div",{className:"caption",style:{marginTop:6},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),z==="analytics"&&(B||(t==null?void 0:t.is_mod))&&e.jsxs("div",{className:"col",style:{marginTop:16,gap:12},children:[e.jsx("div",{className:"title",children:"Analytics"}),ie&&e.jsx("div",{className:"muted",children:"Loading…"}),!ie&&!h&&e.jsx("div",{className:"muted",children:"No data."}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",style:{flexWrap:"wrap",gap:10},children:[e.jsx(Ne,{label:"Users",value:h.totals.users_total}),e.jsx(Ne,{label:"Admins",value:h.totals.users_admin}),e.jsx(Ne,{label:"Mods",value:h.totals.users_mod}),e.jsx(Ne,{label:"Blacklisted",value:h.totals.users_blacklisted}),e.jsx(Ne,{label:"Videos",value:h.totals.videos_total}),e.jsx(Ne,{label:"Ready",value:h.totals.videos_ready}),e.jsx(Ne,{label:"Pending",value:h.totals.pending_count}),e.jsx(Ne,{label:"Purgatory",value:h.totals.purgatory_count}),e.jsx(Ne,{label:"Likes",value:h.totals.likes_total}),e.jsx(Ne,{label:"Flags",value:h.totals.flags_total})]}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap",gap:20,marginTop:8},children:[e.jsx(Ge,{title:"New users (30d)",series:h.series.users,color:"#60a5fa"}),e.jsx(Ge,{title:"New videos (30d)",series:h.series.videos,color:"#34d399"}),((A=(c=h.stream)==null?void 0:c.graphql)==null?void 0:A.minutes_viewed)&&h.stream.graphql.minutes_viewed.length>0&&e.jsx(Ge,{title:"Minutes viewed (30d)",series:h.stream.graphql.minutes_viewed,color:"#f59e0b"})]}),e.jsxs("div",{className:"col",style:{gap:6,marginTop:8},children:[e.jsx("div",{className:"title",children:"Feed & Stream"}),e.jsxs("div",{className:"muted",children:["Feed: ",h.feed.count," items in rotation",h.feed.cursor?` • cursor ${h.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",children:["Approx. ready seconds: ",h.stream.approximate.total_duration_sec," • ready videos: ",h.stream.approximate.videos_ready]}),h.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12},children:["Stream API: ",h.stream.api.ok?"ok":"unavailable",(G=(L=h.stream.api)==null?void 0:L.result_info)!=null&&G.count?` • count ${h.stream.api.result_info.count}`:"",(be=h.stream.api)!=null&&be.sample_status?` • sample status ${String(h.stream.api.sample_status)}`:""]})]})]})]})]})}function Ne({label:t,value:d}){return e.jsxs("div",{className:"col",style:{padding:"8px 10px",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,minWidth:120},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t}),e.jsx("div",{className:"title",children:d})]})}function Ge({title:t,series:d,color:u}){const F=d.map(y=>y.count),g=Math.max(1,...F),R=s.useMemo(()=>{const y=g,w=Math.pow(10,Math.floor(Math.log10(y))),h=y/w;return(h<=1?1:h<=2?2:h<=5?5:10)*w},[g]),P=350,E=124,z=s.useMemo(()=>d.map((y,w)=>{const h=42+w/Math.max(1,d.length-1)*P,J=8+(1-y.count/(R||1))*E;return[h,J]}),[d,R,P,E]),U=s.useMemo(()=>z.map((y,w)=>w===0?`M ${y[0]} ${y[1]}`:`L ${y[0]} ${y[1]}`).join(" "),[z]),H=[0,.25,.5,.75,1],S=s.useMemo(()=>{if(d.length===0)return[];const y=[0,.25,.5,.75,1].map(w=>Math.min(d.length-1,Math.round(w*(d.length-1))));return Array.from(new Set(y))},[d]),$=y=>{if(!y||y.length<10)return y||"";const w=y.slice(5,7).replace(/^0/,""),h=y.slice(8,10).replace(/^0/,"");return`${w}/${h}`};function W(y){const w=Number.isInteger(y);return y>=1e6?`${(y/1e6).toFixed(1).replace(/\.0$/,"")}M`:y>=1e3?`${(y/1e3).toFixed(1).replace(/\.0$/,"")}k`:w?String(y):y<10?y.toFixed(1):y.toFixed(1).replace(/\.0$/,"")}const b=d.length?d[d.length-1].count:0;return e.jsxs("div",{className:"col",style:{border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:10},children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{className:"muted",children:t}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:["latest: ",W(b)]})]}),e.jsxs("svg",{width:400,height:160,role:"img","aria-label":t,children:[e.jsx("rect",{x:0,y:0,width:400,height:160,fill:"#0f1217",rx:8}),H.map((y,w)=>{const h=8+(1-y)*E,J=y*R;return e.jsxs("g",{children:[e.jsx("line",{x1:42,y1:h,x2:392,y2:h,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:36,y:h+4,textAnchor:"end",fontSize:10,fill:"rgba(255,255,255,0.6)",children:W(J)})]},w)}),e.jsx("line",{x1:42,y1:8,x2:42,y2:8+E,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),e.jsx("line",{x1:42,y1:8+E,x2:42+P,y2:8+E,stroke:"rgba(255,255,255,0.25)",strokeWidth:1}),S.map((y,w)=>{var J;const h=42+y/Math.max(1,d.length-1)*P;return e.jsxs("g",{children:[e.jsx("line",{x1:h,y1:8,x2:h,y2:8+E,stroke:"rgba(255,255,255,0.08)",strokeWidth:1}),e.jsx("text",{x:h,y:8+E+12,textAnchor:"middle",fontSize:10,fill:"rgba(255,255,255,0.6)",children:$((J=d[y])==null?void 0:J.day)})]},w)}),e.jsx("path",{d:U,fill:"none",stroke:u,strokeWidth:2}),z.length>0&&e.jsx("circle",{cx:z[z.length-1][0],cy:z[z.length-1][1],r:3,fill:u})]})]})}function Os(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function qs(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",style:{fontSize:"2em"},children:"Settings"}),e.jsx("div",{className:"section-panel",children:e.jsx("div",{className:"muted",children:"Settings page coming soon..."})})]})}const Us=()=>e.jsx(Rs,{}),Bs=()=>e.jsx(is,{children:e.jsxs(ae,{element:e.jsx(zs,{}),children:[e.jsx(ae,{path:"/",element:e.jsx(As,{})}),e.jsx(ae,{path:"/mp/discover",element:e.jsx(vt,{})}),e.jsx(ae,{path:"/mp/feed",element:e.jsx(qe,{})}),e.jsx(ae,{path:"/mp/feed/:uid",element:e.jsx(us,{})}),e.jsx(ae,{path:"/md/feed",element:e.jsx(ks,{})}),e.jsx(ae,{path:"/md/feed/:uid",element:e.jsx(Ss,{})}),e.jsx(ae,{path:"/md/queues",element:e.jsx(Cs,{})}),e.jsx(ae,{path:"/md/queues/:id",element:e.jsx(_s,{})}),e.jsx(ae,{path:"/md/notifications",element:e.jsx(Ts,{})}),e.jsx(ae,{path:"/profile",element:e.jsx(wt,{})}),e.jsx(ae,{path:"/profile/:id",element:e.jsx(wt,{})}),e.jsx(ae,{path:"/moderation",element:e.jsx($s,{})}),e.jsx(ae,{path:"/about",element:e.jsx(Os,{})}),e.jsx(ae,{path:"/settings",element:e.jsx(qs,{})}),e.jsx(ae,{path:"/editor",element:e.jsx(Us,{})}),e.jsx(ae,{path:"/feed",element:e.jsx(vt,{})}),e.jsx(ae,{path:"/upload",element:e.jsx(qe,{})}),e.jsx(ae,{path:"/posts",element:e.jsx(qe,{})}),e.jsx(ae,{path:"/recents",element:e.jsx(qe,{})}),e.jsx(ae,{path:"/recent",element:e.jsx(qe,{})})]})}),Hs=()=>e.jsx(ns,{children:e.jsx(Bs,{})});ss(document.getElementById("root")).render(e.jsx(Is,{children:e.jsx(as,{client:Ms,children:e.jsx(ds,{children:e.jsx(Hs,{})})})}));
