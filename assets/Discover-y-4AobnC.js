const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editor-BdlnYnWr.js","assets/vendor-react-CcFPULbg.js","assets/vendor-JPAzRx9E.js","assets/vendor-zip-B-J1xrE3.js","assets/beatmap-preview-DIA57Ie2.js","assets/editor-CG1yLUbS.css"])))=>i.map(i=>d[i]);
import{B as lt,_ as ct}from"./index-CNy2oIIM.js";import{r as i,j as r,b as dt,a as ut,L as Ve,h as ft,i as pt,g as mt,k as Je,a7 as ht,a8 as Xe,A as gt,c as xt,R as bt}from"./vendor-react-CcFPULbg.js";import{u as yt,a as x,A as h,b as vt,i as Ce,c as Qe,h as wt,C as jt}from"./mappi-routes-DG7AcUwo.js";import"./vendor-JPAzRx9E.js";import"./moddi-routes-BwSSVKxH.js";import"./editor-components-COwEyuAl.js";import"./editor-BdlnYnWr.js";import"./vendor-zip-B-J1xrE3.js";import"./beatmap-preview-DIA57Ie2.js";import"./vendor-hls-B_fsdCYC.js";const St=bt.lazy(()=>ct(()=>import("./editor-BdlnYnWr.js").then(d=>d.d),__vite__mapDeps([0,1,2,3,4,5]))),j={};function kt(){try{const d=localStorage.getItem("feed_seen_ids");if(d){const g=JSON.parse(d);Array.isArray(g)&&(j.seenIds=g.filter(S=>typeof S=="number"))}}catch{}return j}function Ge(d){Object.assign(j,d);try{const g=Array.from(new Set(j.seenIds||[])).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(g))}catch{}}function Nt(){var $e,Ye,Ue;const{notify:d}=yt(),[g,S]=i.useState(j.history||[]),[p,D]=i.useState(j.index??-1),[y,B]=i.useState(j.queue||[]),[F,Ee]=i.useState(!1),[$,P]=i.useState(!1),[_e,Y]=i.useState(j.eligibleCount??null),[Ie,U]=i.useState(j.viewedCount??0),[V,Ke]=i.useState(!1),[v,W]=i.useState(!0),[N,O]=i.useState(!1),[se,ae]=i.useState(!1),[oe,J]=i.useState(!1),[le,ce]=i.useState(!1),[de,X]=i.useState(!1),[ue,Re]=i.useState([]),[A,Q]=i.useState(""),[G,fe]=i.useState(null),[pe,ze]=i.useState(!1),[z,Ze]=i.useState(null),[me,Me]=i.useState(!1),H=i.useRef(new Set(j.seenIds||[])),Le=i.useRef(new Set),he=i.useRef(!1),M=i.useRef(j.lastShownVideoId??null),K=i.useRef(!1),q=i.useRef(0),Te=i.useRef(0),De=i.useRef(0),u=i.useRef(null),Ne=i.useRef(null),Z=i.useRef(null),ge=i.useRef(null),xe=i.useRef(null),be=i.useRef(null),ye=i.useRef(null),ve=i.useRef(null),ee=i.useRef(0),Ae=i.useRef(0),te=i.useRef(null),ne=i.useRef(null),[re,et]=i.useState(0),t=i.useMemo(()=>p>=0?g[p]:null,[g,p]);i.useEffect(()=>{kt()},[]),i.useEffect(()=>{Ge({history:g,index:p,queue:y,seenIds:Array.from(H.current),eligibleCount:_e??void 0,viewedCount:Ie,lastShownVideoId:M.current??void 0})},[g,p,y,_e,Ie]);const _=i.useCallback(()=>{try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),s=["standard","taiko","mania","catch"],a=Array.from(new Set(n.filter(o=>s.includes(o))));return a.length?a:["standard"]}catch{return["standard"]}},[]),He=i.useCallback(()=>{const e=new Set;return M.current!==null&&e.add(M.current),Array.from(H.current).slice(-200).forEach(s=>e.add(s)),y.forEach(s=>e.add(s.id)),Array.from(e)},[y]),we=i.useCallback(async(e=3)=>{var a,o,l,C;if(he.current)return[];const n=Date.now();if(n<q.current){const m=Math.ceil((q.current-n)/1e3);return d(`Rate limited. Please wait ${m}s.`,{durationMs:3e3,variant:"warn"}),[]}const s=n-De.current;if(s<2e3){const m=2e3-s;await new Promise(T=>setTimeout(T,m))}he.current=!0,De.current=Date.now();try{const m=He(),T=_().join(","),E=[],I=new Set(y.map(b=>b.id));let R=[...m];const ke=Math.min(e,3);for(let b=0;b<ke;b++){if(b>0){const c=Date.now()-Te.current,f=1e3;c<f&&await new Promise(w=>setTimeout(w,f-c))}try{Te.current=Date.now();const c=await x(h.feed.next+vt({exclude:R.join(","),modes:T}),{requireAuth:!1}),f=c&&("id"in c?c:c.video)||null;if(!f)break;if(H.current.has(f.id)||I.has(f.id)||f.id===M.current){R.push(f.id);continue}E.push(f),R.push(f.id),I.add(f.id)}catch(c){if((a=c==null?void 0:c.message)!=null&&a.includes("401")||(o=c==null?void 0:c.message)!=null&&o.includes("Unauthorized")){Ke(!0);break}else if((l=c==null?void 0:c.message)!=null&&l.includes("429")||(C=c==null?void 0:c.message)!=null&&C.includes("rate limit")){q.current=Date.now()+5e3,d("Rate limited. Please wait a moment.",{durationMs:5e3,variant:"warn"});break}}}if(E.length>0&&B(b=>{const c=new Set(b.map(w=>w.id)),f=E.filter(w=>!c.has(w.id));return[...b,...f]}),E.length===0&&y.length===0)try{const b=_().join(","),c=await x(h.feed.progress(b),{requireAuth:!1});Y(Number(c.eligible||0)),U(Number(c.viewed||0)),P(Number(c.caught_up||0)===1)}catch{}return E}catch{return[]}finally{he.current=!1}},[He,_,y,d]),k=i.useCallback(async()=>{if(!F){Ee(!0);try{y.length<=2&&we(3).catch(()=>{});let e;if(y.length>0)e=y[0],B(n=>n.filter(s=>s.id!==e.id));else{const n=await we(3);n.length>0&&(e=n[0],n.length>1&&B(s=>{const a=new Set(s.map(l=>l.id)),o=n.slice(1).filter(l=>!a.has(l.id));return[...s,...o]}))}if(e)M.current=e.id,H.current.add(e.id),Ge({seenIds:Array.from(H.current)}),S(n=>{const s=[...n.slice(0,p+1),e];return D(s.length-1),s}),Le.current.has(e.id)||(Le.current.add(e.id),x(h.videos.view(e.id),{method:"POST"}).then(n=>{n&&S(s=>{const a=[...s],o=a.findIndex(l=>l.id===e.id);return o!==-1&&(a[o]={...a[o],views_count:n.views_count??a[o].views_count??0,viewed_by_me:!0}),a})}).catch(()=>{}));else try{const n=_().join(","),s=await x(h.feed.progress(n),{requireAuth:!1});Y(Number(s.eligible||0)),U(Number(s.viewed||0)),P(Number(s.eligible||0)>0&&Number(s.viewed||0)>=Number(s.eligible||0))}catch{}}finally{Ee(!1)}}},[F,y,we,p,_]),tt=i.useCallback(()=>{u.current&&!u.current.paused&&u.current.pause(),O(!0),X(!1)},[]),je=i.useCallback(()=>{p>0&&(D(p-1),O(!1))},[p]),Se=i.useCallback(()=>{const e=Date.now();if(!(e-Ae.current<300)){if(Ae.current=e,v||(K.current=!0,W(!1)),p<g.length-1){const n=g[p+1];console.log("[Discover] Navigating to next video in history:",{currentIndex:p,nextIndex:p+1,currentVideoId:t==null?void 0:t.id,nextVideoId:n==null?void 0:n.id,nextVideoStreamUID:n==null?void 0:n.stream_uid}),n&&(M.current=n.id),D(p+1),O(!1);return}if(!$){if(Date.now()<q.current){const n=Math.ceil((q.current-Date.now())/1e3);d(`Rate limited. Please wait ${n}s.`,{durationMs:3e3,variant:"warn"});return}console.log("[Discover] Fetching next video (queue empty)"),k()}}},[p,g,v,$,k,d,t]);i.useEffect(()=>{const e=Ne.current;if(!e)return;const n=o=>{if(V||Math.abs(o.deltaY)<Math.abs(o.deltaX))return;o.preventDefault(),o.stopPropagation();const l=Date.now();if(!(l<ee.current)){if(ee.current=l+1e3,!t){o.deltaY>0&&!F&&k();return}o.deltaY>0?Se():je()}},s=o=>{te.current=o.touches[0].clientY,ne.current=Date.now()},a=o=>{if(V||te.current===null||ne.current===null)return;const l=o.changedTouches[0].clientY,C=Date.now(),m=te.current-l,T=C-ne.current;if(te.current=null,ne.current=null,Math.abs(m)<50||T>300)return;const E=Date.now();if(!(E<ee.current)){if(ee.current=E+1e3,!t){m>0&&!F&&k();return}m>0?Se():je()}};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",s),e.removeEventListener("touchend",a),window.removeEventListener("wheel",n,{capture:!0})}},[Se,je,t,F,k,V]);const nt=i.useCallback(async()=>{var e,n;if(!(!t||me)){Me(!0);try{const s=t.liked_by_me?"DELETE":"POST",a=await x(h.videos.like(t.id),{method:s});S(o=>{const l=[...o],C=l.findIndex(m=>m.id===t.id);return C!==-1&&(l[C]={...l[C],liked_by_me:!t.liked_by_me,likes_count:a.likes_count}),l})}catch(s){((e=s==null?void 0:s.message)!=null&&e.includes("429")||(n=s==null?void 0:s.message)!=null&&n.includes("rate limit"))&&d("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{Me(!1)}}},[t,me,d]),Fe=i.useCallback(async e=>{if(t)try{await x(h.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),d("Thanks for your report.",{variant:"info"})}catch{d("Report failed",{variant:"error"})}finally{J(!1)}},[t,d]),rt=i.useCallback(async()=>{if(!t)return;const e=!t.is_starred,n=e?"star":"unstar";try{await x(h.admin.videosAction(t.id,n),{method:"POST"}),S(s=>{const a=[...s],o=a.findIndex(l=>l.id===t.id);return o!==-1&&(a[o]={...a[o],is_starred:e}),a}),ce(!1),d(e?"Post starred":"Star removed",{variant:"success"})}catch{d("Action failed",{variant:"error"})}},[t,d]),Pe=i.useCallback(async()=>{if(!(!t||!confirm("Permanently delete this video?")))try{await x(h.videos.delete(t.id),{method:"DELETE"}),d("Deleted",{variant:"warn"}),J(!1),S(e=>{const n=e.filter((s,a)=>a!==p);return n.length===0?(D(-1),setTimeout(k,0)):D(s=>Math.max(0,Math.min(s,n.length-1))),n})}catch{alert("Delete failed")}},[t,p,k,d]),ie=i.useCallback(async()=>{if(t!=null&&t.id)try{const e=await x(h.videos.comments(t.id),{requireAuth:!1});Re(e.items||[])}catch{}},[t==null?void 0:t.id]);i.useEffect(()=>{se&&(t!=null&&t.id)&&ie()},[se,t==null?void 0:t.id,ie]);const We=i.useCallback(async e=>{if(e.preventDefault(),!(!A.trim()||!(t!=null&&t.id))){ze(!0);try{await x(h.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:A.trim(),parent_id:G||void 0})}),Q(""),fe(null),ie(),S(n=>{const s=[...n],a=s.findIndex(o=>o.id===t.id);return a!==-1&&(s[a]={...s[a],comments_count:(s[a].comments_count||0)+1}),s}),d("Comment posted!",{variant:"success"})}catch(n){d((n==null?void 0:n.message)||"Failed to post comment",{variant:"error"})}finally{ze(!1)}}},[A,t,G,ie,d]),it=i.useCallback(e=>{Re(n=>n.filter(s=>s.id!==e)),S(n=>{const s=[...n],a=s.findIndex(o=>o.id===(t==null?void 0:t.id));return a!==-1&&(s[a]={...s[a],comments_count:Math.max(0,(s[a].comments_count||0)-1)}),s})},[t==null?void 0:t.id]),{topLevelComments:Oe,repliesMap:qe}=i.useMemo(()=>{const e=ue.filter(s=>!s.parent_id),n=new Map;return ue.filter(s=>s.parent_id).forEach(s=>{const a=s.parent_id;n.has(a)||n.set(a,[]),n.get(a).push(s)}),{topLevelComments:e,repliesMap:n}},[ue]),st=i.useCallback(()=>{if(!u.current)return;const e=!v;W(e),u.current.muted=e,e||(K.current=!0),!e&&u.current.paused&&u.current.play().catch(()=>{})},[v]),at=i.useCallback(e=>{u.current=e,e&&(e.muted=v)},[v]);i.useEffect(()=>{O(!1),ae(!1),K.current?W(!1):W(!0)},[t==null?void 0:t.id,t==null?void 0:t.stream_uid,p,g.length]),i.useEffect(()=>{u.current&&(u.current.muted=v)},[v]),i.useEffect(()=>{if(!t)return;const e=!K.current;W(e);const n=setTimeout(()=>{u.current&&(u.current.muted=e)},100);return()=>clearTimeout(n)},[t==null?void 0:t.id]),i.useEffect(()=>{t&&(M.current=t.id)},[t==null?void 0:t.id]),i.useEffect(()=>{N&&u.current&&!u.current.paused&&u.current.pause()},[N]),i.useEffect(()=>{g.length===0&&k()},[]),i.useEffect(()=>{(async()=>{try{const e=_().join(","),n=await x(h.feed.progress(e),{requireAuth:!1}),s=Number(n.eligible||0),a=Number(n.viewed||0);Y(s),U(a),P(s>0&&a>=s)}catch{}})()},[_]),i.useEffect(()=>{const e=()=>{S([]),B([]),H.current.clear(),M.current=null,D(-1),P(!1),(async()=>{try{const n=_().join(","),s=await x(h.feed.progress(n),{requireAuth:!1}),a=Number(s.eligible||0),o=Number(s.viewed||0);Y(a),U(o),P(!1)}catch{}k()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[_,k]),i.useEffect(()=>{(async()=>{try{const e=await x(h.auth.me,{requireAuth:!1});Ze(e)}catch{}})()},[]);const[L,ot]=i.useState(()=>typeof window<"u"?Ce():!1);i.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&et(n.offsetHeight),ot(Ce())};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),i.useEffect(()=>{var s;if(!Z.current||!ge.current||!t||!u.current)return;const e=()=>{var T;const a=(T=ge.current)==null?void 0:T.querySelector("div"),o=u.current;if(!a||!o||!Z.current)return;const l=Z.current,C=Ce();let m;if(t.width&&t.height?m=t.width/t.height:o.videoWidth>0&&o.videoHeight>0?m=o.videoWidth/o.videoHeight:m=16/9,C){const I=l.offsetWidth,R=I/m;a.style.width=`${I}px`,a.style.height=`${R}px`,a.style.maxWidth="100%",a.style.maxHeight="100%"}else{const I=l.offsetWidth-32,R=l.offsetHeight-32,ke=16/9,b=I/ke;let f=Math.min(R,b),w=f*m;w>I&&(w=I,f=w/m),f>R&&(f=R,w=f*m),a.style.width=`${w}px`,a.style.height=`${f}px`,a.style.maxWidth="100%",a.style.maxHeight="100%"}},n=()=>{requestAnimationFrame(e)};if(u.current.readyState>=1)e();else{const a=()=>{var o;e(),(o=u.current)==null||o.removeEventListener("loadedmetadata",a)};(s=u.current)==null||s.addEventListener("loadedmetadata",a)}return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[t==null?void 0:t.id,t==null?void 0:t.width,t==null?void 0:t.height]),i.useEffect(()=>{if(!oe)return;const e=n=>{xe.current&&!xe.current.contains(n.target)&&J(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[oe]),i.useEffect(()=>{if(!le)return;const e=n=>{be.current&&!be.current.contains(n.target)&&ce(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[le]),i.useEffect(()=>{if(!de)return;const e=n=>{ye.current&&!ye.current.contains(n.target)&&ve.current&&!ve.current.contains(n.target)&&X(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[de]);const Be=!!(z!=null&&z.is_admin||z!=null&&z.is_mod);return r.jsxs(r.Fragment,{children:[r.jsx(lt,{paused:L}),r.jsx("style",{children:`
        .video-area .discover-player-wrapper {
          position: relative !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          max-height: 100% !important;
          min-height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          box-sizing: border-box !important;
        }
        .video-area .discover-player-wrapper > div {
          position: relative !important;
          /* Dimensions will be set by JavaScript to ensure proper fit */
          box-sizing: border-box !important;
          /* Center the video within container */
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
          align-self: center !important;
        }
        .video-area .discover-player-wrapper > div[style] {
          /* JavaScript will set width and height, but ensure max constraints */
          max-width: 100% !important;
          max-height: 100% !important;
          box-sizing: border-box !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
          min-height: 0 !important;
        }
        /* Ensure wrapper constrains width to prevent overflow */
        .video-area .discover-player-wrapper {
          max-width: 100% !important;
          width: 100% !important;
          overflow: hidden !important;
          /* Use flexbox to center and constrain */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .video-area .discover-player-wrapper video {
          /* Ensure video content is fully visible - no cropping */
          width: 100% !important;
          height: 100% !important;
          object-fit: contain !important;
          max-width: 100% !important;
          max-height: 100% !important;
        }
        /* Mobile-specific: ensure videos take full width */
        html.is-mobile .video-area .discover-player-wrapper > div,
        html.is-mobile .video-area .discover-player-wrapper > div[style] {
          min-width: 100% !important;
          max-width: 100% !important;
        }
      `}),r.jsxs("div",{ref:Ne,className:"player-wrap",style:{height:"100dvh",width:"100vw",position:"fixed",top:L?"calc(0px - env(safe-area-inset-top, 0px))":0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1,margin:0,padding:0,boxSizing:"border-box"},children:[$&&r.jsx("div",{className:"chip info",style:{position:"absolute",top:re+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),r.jsx("div",{ref:Z,className:"video-area discover-video-container",style:{position:"absolute",top:L?0:re,left:0,right:0,bottom:L?"-10px":0,maxHeight:L?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${re}px)`,height:L?"calc(100dvh + env(safe-area-inset-top, 0px) + 2px)":`calc(100dvh - ${re}px)`,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:L?"none":"bottom 0.3s ease-out, max-height 0.3s ease-out, height 0.3s ease-out",overflow:"hidden",boxSizing:"border-box",padding:L?"0":"16px",maxWidth:"100vw",width:"100%"},children:V?r.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[r.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),r.jsx("button",{className:"btn",onClick:()=>window.location.href=Qe+h.auth.login,children:"Login with osu!"})]}):t?r.jsx("div",{style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:r.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:[r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),r.jsxs("div",{onClick:st,style:{position:"relative",width:"100%",height:"100%",cursor:"pointer",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"100%",maxHeight:"100%"},children:[r.jsx("div",{ref:ge,className:"discover-player-wrapper",children:r.jsx(wt,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t.width&&t.height?t.width/t.height:null,preferNative:!0,autoplay:!0,loop:!0,muted:v,controls:!1,onVideoRef:at})}),r.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:v?1:0,zIndex:2},children:v?r.jsx(dt,{size:28,color:"#fff"}):r.jsx(ut,{size:28,color:"#fff"})})]})]})}):$?null:r.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px",pointerEvents:"none"},children:[r.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),r.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[r.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),r.jsx("div",{children:"• Click video to toggle mute/unmute"}),r.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!N&&r.jsxs("div",{style:{position:"absolute",right:16,top:"50%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transform:"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[r.jsx(Ve,{to:`/profile/${($e=t.uploader)==null?void 0:$e.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(Ye=t.uploader)!=null&&Ye.avatar_url?r.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):r.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:nt,disabled:me,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?r.jsx(ft,{size:28}):r.jsx(pt,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[r.jsx("button",{onClick:()=>ae(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(mt,{size:28})}),r.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{ref:ve,onClick:()=>X(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(Je,{size:24})}),de&&r.jsxs("div",{ref:ye,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>X(!1),children:[r.jsx(Je,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&r.jsx("button",{className:"menu-item",onClick:tt,children:"Preview"})]})]}),Be?r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>ce(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(Xe,{size:24})}),le&&r.jsxs("div",{ref:be,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("button",{className:"menu-item",onClick:rt,children:t.is_starred?"Unstar post":"Star post"}),r.jsx("button",{className:"menu-item",onClick:Pe,children:"Delete video"})]})]}):r.jsx("button",{onClick:()=>J(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:r.jsx(ht,{size:24})}),oe&&r.jsxs("div",{ref:xe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[r.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),r.jsx("button",{className:"menu-item",onClick:()=>Fe("unrelated"),children:"Unrelated"}),r.jsx("button",{className:"menu-item",onClick:()=>Fe("explicit"),children:"Explicit"}),Be&&r.jsx("button",{className:"menu-item",onClick:Pe,children:"Delete video"})]})]}),t&&!N&&r.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12,transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:r.jsx(Ve,{to:`/profile/${(Ue=t.uploader)==null?void 0:Ue.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var a,o,l;const e=(a=t.uploader)==null?void 0:a.is_admin,n=(o=t.uploader)==null?void 0:o.is_mod,s=e?"#fff3bf":n?"#d7fbe8":"#fff";return r.jsxs(r.Fragment,{children:[r.jsxs("span",{style:{color:s},children:["@",(l=t.uploader)==null?void 0:l.username]}),t.is_starred&&r.jsx(gt,{size:16,color:"#f59e0b",title:"Starred"}),(e||n)&&r.jsx(Xe,{size:14,color:s,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&r.jsx("div",{style:{color:"#fff",fontSize:"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&r.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),se&&t&&r.jsxs(r.Fragment,{children:[r.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `}),r.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[r.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),r.jsx("button",{onClick:()=>ae(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:r.jsx(xt,{size:24})})]}),r.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Oe.length===0?r.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):r.jsx("div",{className:"col",style:{gap:0},children:Oe.map(e=>r.jsx(jt,{comment:e,replies:qe.get(e.id)||[],me:z,section:"mappi",onReply:n=>fe(n),onDelete:it,replyingTo:G,replyText:A,onReplyTextChange:Q,onReplySubmit:We,posting:pe,onCancelReply:()=>{fe(null),Q("")},repliesMap:qe},e.id))})}),z&&!G&&r.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:r.jsxs("form",{onSubmit:We,style:{display:"flex",alignItems:"flex-end",gap:8},children:[r.jsx("textarea",{placeholder:"Write a comment...",value:A,onChange:e=>Q(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),r.jsx("button",{type:"submit",className:"btn compact",disabled:pe||!A.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:pe?"...":"Post"})]})})]})]}),N&&(t==null?void 0:t.beatmapset_id)&&r.jsx(i.Suspense,{fallback:null,children:r.jsx(St,{open:N,onClose:()=>O(!1),downloadUrl:`${Qe}${h.osu.downloadBeatmapset(t.beatmapset_id)}`,beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0})})]})]})}export{Nt as default};
