import{r as i,R as Q,i as Ze,j as n,L as Oe,p as et,D as tt,E as nt,b as st,a as rt,G as ot,I as Ae,J as it,K as Be,A as at,c as lt}from"./vendor-react-BxoNMQk4.js";import{P as ct}from"./Popup-m1E6SEMC.js";import{P as dt}from"./beatmap-preview-VbVg5pQh.js";import{C as ut}from"./Comment-C7c5cnu7.js";import{u as ft,B as pt}from"./index-Cy0KN0p8.js";import"./vendor-CmWQUY7N.js";import"./editor-lib-KdB-N32W.js";import"./editor-components-xbbWPDXL.js";const u="https://api.osumappi.ng",y={};function jt(){var Fe,De,Pe;const[C,R]=i.useState(y.history||[]),[f,z]=i.useState(y.index||-1),t=f>=0?C[f]:null,[B,xe]=i.useState(!1),[He,be]=i.useState(!1),[Ye,ye]=i.useState(!1),[Z,H]=i.useState(!1),ee=Q.useRef(null),[te,ne]=i.useState(!1),se=Q.useRef(null),[E,Ve]=i.useState(null),[re,O]=i.useState(!1),[oe,Y]=i.useState(!1),ie=Q.useRef(null),ae=Q.useRef(null),[V,le]=i.useState(!1),[ve,we]=i.useState([]),[A,W]=i.useState(""),[ce,de]=i.useState(null),[ue,je]=i.useState(!1),[I,ke]=i.useState(!0),{notify:v}=ft(),[b,L]=i.useState(y.queue||[]),w=i.useRef(y.seenIds||new Set),Se=i.useRef(new Set),fe=i.useRef(!1),Ce=i.useRef(null),[Re,M]=i.useState(y.eligibleCount||null),[Ee,F]=i.useState(y.viewedCount||0),[D,T]=i.useState(!1);i.useEffect(()=>()=>{y.history=C,y.index=f,y.queue=b,y.seenIds=w.current,y.eligibleCount=Re,y.viewedCount=Ee},[C,f,b,Re,Ee]);function P(e){var s;return(s=document.cookie.split("; ").map(r=>r.split("=")).find(([r])=>r===e))==null?void 0:s[1]}function We(){try{const e=Array.from(w.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function _(){try{const e=localStorage.getItem("filter_modes"),s=(e?String(e):"standard").toLowerCase().split(",").map(o=>o.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],a=Array.from(new Set(s.filter(o=>r.includes(o))));return a.length?a:["standard"]}catch{return["standard"]}}const Ie=async(e=3)=>{if(fe.current)return[];fe.current=!0;try{const s=async()=>{const d=[];for(let S=0;S<e;S++)try{const h=Array.from(w.current).slice(-200),c=_().join(","),g=await fetch(`${u}/api/feed/next?exclude=${encodeURIComponent(h.join(","))}&modes=${encodeURIComponent(c)}`,{credentials:"include"});if(g.status===401){ye(!0);break}if(g.status===429){v("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(!g.ok)break;const x=await g.json(),U=x&&(x.id?x:x.video);if(!U)break;d.push(U)}catch{break}return d};if(Ce.current===!1){const d=await s(),S=new Set(b.map(c=>c.id)),h=d.filter(c=>!w.current.has(c.id)&&!S.has(c.id));if(h.length>0&&L(c=>[...c,...h]),h.length===0&&b.length===0)try{const c=_().join(","),g=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(c)}`,{credentials:"include"});if(g.ok){const x=await g.json();M(Number(x.eligible||0)),F(Number(x.viewed||0)),T(!!x.caught_up)}}catch{}return h}const r=Array.from(w.current).slice(-200),a=_().join(","),o=await fetch(`${u}/api/feed/batch?size=${e}&exclude=${encodeURIComponent(r.join(","))}&modes=${encodeURIComponent(a)}`,{credentials:"include"});if(o.status===401)return ye(!0),[];if(o.status===429)return v("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];if(o.status===404){Ce.current=!1;const d=await s(),S=new Set(b.map(c=>c.id)),h=d.filter(c=>!w.current.has(c.id)&&!S.has(c.id));if(h.length>0&&L(c=>[...c,...h]),h.length===0&&b.length===0)try{const c=_().join(","),g=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(c)}`,{credentials:"include"});if(g.ok){const x=await g.json(),U=Number(x.eligible||0),Ue=Number(x.viewed||0);M(U),F(Ue);const Qe=U>0&&Ue>=U;T(Qe)}}catch{}return h}const l=await o.json(),p=l&&Array.isArray(l.items)?l.items:[],m=new Set,j=p.filter(d=>m.has(d.id)?!1:(m.add(d.id),!0)),$=new Set(b.map(d=>d.id)),k=j.filter(d=>!w.current.has(d.id)&&!$.has(d.id));if(k.length>0&&L(d=>[...d,...k]),k.length===0&&b.length===0)try{const d=_().join(","),S=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(d)}`,{credentials:"include"});if(S.ok){const h=await S.json(),c=Number(h.eligible||0),g=Number(h.viewed||0);M(c),F(g);const x=c>0&&g>=c;T(x)}}catch{}return k}catch{return[]}finally{fe.current=!1}},X=async()=>{if(!B){xe(!0);try{let e=[];b.length===0&&(e=await Ie(3));let s;if(b.length>0?(s=b[0],L(r=>r.slice(1))):e.length>0&&(s=e[0],e.length>1&&L(r=>[...r,...e.slice(1)])),s){if(w.current.add(s.id),We(),R(r=>{const a=[...r.slice(0,f+1),s];return z(a.length-1),a}),!Se.current.has(s.id)){Se.current.add(s.id);const r=P("csrf")||"";try{const a=await fetch(`${u}/api/videos/${s.id}/view`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":r}});if(a.ok){const o=await a.json();o&&R(l=>{const p=[...l],m=p.findIndex(j=>j.id===s.id);return m!==-1&&(p[m]={...p[m],views_count:o.views_count??p[m].views_count??0,viewed_by_me:!0}),p})}}catch{}}}else try{const r=_().join(","),a=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(r)}`,{credentials:"include"});if(a.ok){const o=await a.json(),l=Number(o.eligible||0),p=Number(o.viewed||0);M(l),F(p);const m=l>0&&p>=l;T(m)}}catch{}b.length<=1&&Ie(3)}finally{xe(!1)}}},pe=()=>{f>0&&(z(f-1),O(!1))},me=()=>{if(f<C.length-1){z(f+1),O(!1);return}D||X()},q=i.useRef(0),J=i.useRef(null),G=i.useRef(null),he=i.useRef({goNext:me,goPrev:pe,index:f,history:C,loading:B,exhausted:D});i.useEffect(()=>{he.current={goNext:me,goPrev:pe,index:f,history:C,loading:B,exhausted:D}},[me,pe,f,C,B,D]),i.useEffect(()=>{const e=Me.current;if(!e)return;const s=o=>{if(e){const j=e.getBoundingClientRect(),$=o.clientX,k=o.clientY;if($<j.left||$>j.right||k<j.top||k>j.bottom)return}o.preventDefault(),o.stopPropagation();const l=Date.now();if(l<q.current||(q.current=l+1e3,Math.abs(o.deltaY)<Math.abs(o.deltaX)))return;const{goNext:p,goPrev:m}=he.current;o.deltaY>0?p():m()},r=o=>{J.current=o.touches[0].clientY,G.current=Date.now()},a=o=>{if(J.current===null||G.current===null)return;const l=o.changedTouches[0].clientY,p=Date.now(),m=J.current-l,j=p-G.current;if(J.current=null,G.current=null,Math.abs(m)<50||j>300)return;const $=Date.now();if($<q.current)return;q.current=$+1e3;const{goNext:k,goPrev:d}=he.current;m>0?k():d()};return e.addEventListener("wheel",s,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),window.addEventListener("wheel",s,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",s,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a),window.removeEventListener("wheel",s,{capture:!0})}},[]);const Xe=async()=>{if(t){be(!0);try{const e=P("csrf")||"",s=t.liked_by_me?"DELETE":"POST",r=await fetch(`${u}/api/videos/${t.id}/like`,{method:s,credentials:"include",headers:{"X-CSRF-Token":e}});if(r.status===429){v("Please slow down a bit.",{durationMs:5e3,variant:"warn"});return}if(r.ok){const a=await r.json();R(o=>{const l=[...o];return l[f]={...l[f],liked_by_me:!t.liked_by_me,likes_count:a.likes_count},l})}}finally{be(!1)}}};async function _e(e){if(!t)return;const s=P("csrf")||"";(await fetch(`${u}/api/videos/${t.id}/flag`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":s},body:JSON.stringify({reason:e})})).ok?v("Thanks for your report.",{variant:"info"}):v("Report failed",{variant:"error"}),H(!1)}i.useEffect(()=>{if(!Z)return;const e=s=>{ee.current&&!ee.current.contains(s.target)&&H(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Z]),i.useEffect(()=>{if(!te)return;const e=s=>{se.current&&!se.current.contains(s.target)&&ne(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[te]),i.useEffect(()=>{if(!oe)return;const e=s=>{ie.current&&!ie.current.contains(s.target)&&ae.current&&!ae.current.contains(s.target)&&Y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[oe]),i.useEffect(()=>{C.length===0&&X()},[]),i.useEffect(()=>{(async()=>{try{const e=_().join(","),s=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(e)}`,{credentials:"include"});if(s.ok){const r=await s.json(),a=Number(r.eligible||0),o=Number(r.viewed||0);M(a),F(o);const l=a>0&&o>=a;T(l)}}catch{}})()},[]),i.useEffect(()=>{const e=()=>{R([]),L([]),w.current.clear(),z(-1),T(!1),(async()=>{try{const s=_().join(","),r=await fetch(`${u}/api/feed/progress?modes=${encodeURIComponent(s)}`,{credentials:"include"});if(r.ok){const a=await r.json(),o=Number(a.eligible||0),l=Number(a.viewed||0);M(o),F(l),T(!1)}}catch{}X()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),i.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const s=JSON.parse(e);if(Array.isArray(s))for(const r of s)typeof r=="number"&&w.current.add(r)}}catch{}},[]),i.useEffect(()=>{(async()=>{try{const e=await fetch(`${u}/api/me`,{credentials:"include"});e.ok&&Ve(await e.json())}catch{}})()},[]),i.useEffect(()=>{O(!1),le(!1),ke(!0)},[t==null?void 0:t.id]),i.useEffect(()=>{N.current&&(N.current.muted=I)},[I]);const Te=async()=>{if(t!=null&&t.id)try{const e=await fetch(`${u}/api/videos/${t.id}/comments`,{credentials:"include"});if(e.ok){const s=await e.json();we(s.items||[])}}catch{}};i.useEffect(()=>{V&&(t!=null&&t.id)&&Te()},[V,t==null?void 0:t.id]);const Ne=async e=>{if(e.preventDefault(),!(!A.trim()||!(t!=null&&t.id))){je(!0);try{const s=P("csrf")||"",r=await fetch(`${u}/api/videos/${t.id}/comments`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":s},body:JSON.stringify({text:A.trim(),parent_id:ce||void 0})});if(r.ok)W(""),de(null),Te(),R(a=>{const o=[...a],l=o.findIndex(p=>p.id===t.id);return l!==-1&&(o[l]={...o[l],comments_count:(o[l].comments_count||0)+1}),o}),v("Comment posted!",{variant:"success"});else{const a=await r.json().catch(()=>({}));v(a.error||"Failed to post comment",{variant:"error"})}}catch{v("Failed to post comment",{variant:"error"})}finally{je(!1)}}},qe=e=>{we(s=>s.filter(r=>r.id!==e)),R(s=>{const r=[...s],a=r.findIndex(o=>o.id===(t==null?void 0:t.id));return a!==-1&&(r[a]={...r[a],comments_count:Math.max(0,(r[a].comments_count||0)-1)}),r})},$e=ve.filter(e=>!e.parent_id),K=new Map;ve.filter(e=>e.parent_id).forEach(e=>{const s=e.parent_id;K.has(s)||K.set(s,[]),K.get(s).push(e)});const N=i.useRef(null);i.useEffect(()=>{if(t&&N.current){const e=setTimeout(()=>{var s;(s=N.current)==null||s.play().catch(r=>{console.debug("Autoplay prevented:",r)})},100);return()=>clearTimeout(e)}},[t==null?void 0:t.id]);const Je=()=>{if(!N.current)return;const e=N.current;e.paused?e.play().catch(s=>console.debug("Play failed:",s)):e.pause()},ze=!!(E!=null&&E.is_admin||E!=null&&E.is_mod);async function Ge(){if(!t)return;const e=P("csrf")||"",s=!t.is_starred,r=s?"star":"unstar";(await fetch(`${u}/api/admin/videos/${t.id}/${r}`,{method:"POST",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(R(o=>{const l=[...o];return l[f]={...l[f],is_starred:s},l}),ne(!1),v(s?"Post starred":"Star removed",{variant:"success"})):v("Action failed",{variant:"error"})}async function Le(){if(!t||!confirm("Permanently delete this video?"))return;const e=P("csrf")||"";(await fetch(`${u}/api/videos/${t.id}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":e}})).ok?(v("Deleted",{variant:"warn"}),H(!1),R(r=>{const a=r.filter((o,l)=>l!==f);return a.length===0?(z(-1),setTimeout(X,0)):z(o=>Math.max(0,Math.min(o,a.length-1))),a})):alert("Delete failed")}Ze();const Me=i.useRef(null),[ge,Ke]=i.useState(0);return i.useEffect(()=>{const e=()=>{const s=document.querySelector(".top-nav");s&&Ke(s.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),n.jsxs(n.Fragment,{children:[n.jsx(pt,{paused:!1}),n.jsxs("div",{ref:Me,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"#000",zIndex:1},children:[D&&n.jsx("div",{className:"chip info",style:{position:"absolute",top:ge+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),n.jsx("div",{className:"video-area",style:{position:"absolute",top:ge,left:0,right:0,bottom:V?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",transition:"bottom 0.3s ease-out"},children:Ye?n.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[n.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),n.jsx("button",{className:"btn",onClick:()=>window.location.href=`${u}/api/auth/login`,children:"Login with osu!"})]}):t?n.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:re&&t.beatmapset_id?n.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:n.jsx(dt,{downloadUrl:`${u}/api/osu/beatmapsets/${t.beatmapset_id}/download?noVideo=1`,beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{O(!1),window.location.hash="/editor"}})}):n.jsxs("div",{style:{width:"75vw",maxWidth:"75vw",height:"100%",maxHeight:`calc(100vh - ${ge}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative"},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),n.jsx("div",{style:{position:"relative",zIndex:1},children:n.jsx(ct,{streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t!=null&&t.width&&(t!=null&&t.height)?t.width/t.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:I,controls:!1,onVideoRef:e=>{N.current=e,e&&(e.muted=I)},onClick:Je})})]})}):D?null:n.jsx("div",{className:"muted",style:{zIndex:10},children:"No videos yet"})}),t&&!re&&n.jsxs("div",{style:{position:"absolute",right:16,bottom:"20%",display:"flex",flexDirection:"column",gap:20,alignItems:"center",zIndex:15,pointerEvents:"auto"},onClick:e=>e.stopPropagation(),children:[n.jsx(Oe,{to:`/profile/${(Fe=t.uploader)==null?void 0:Fe.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(De=t.uploader)!=null&&De.avatar_url?n.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):n.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("button",{onClick:Xe,disabled:He,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?n.jsx(et,{size:28}):n.jsx(tt,{size:28})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("button",{onClick:()=>le(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(nt,{size:28})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:n.jsx("button",{onClick:()=>ke(!I),"aria-label":I?"Unmute":"Mute",title:I?"Unmute":"Mute",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:I?n.jsx(st,{size:28}):n.jsx(rt,{size:28})})}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[n.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:n.jsx(ot,{size:24})}),n.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.views_count??0})]}),t.beatmap_url&&n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{ref:ae,onClick:()=>Y(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(Ae,{size:24})}),oe&&n.jsxs("div",{ref:ie,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>Y(!1),children:[n.jsx(Ae,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&n.jsx("button",{className:"menu-item",onClick:()=>{O(!0),Y(!1)},children:"Preview"})]})]}),ze?n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{onClick:()=>ne(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(Be,{size:24})}),te&&n.jsxs("div",{ref:se,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsx("button",{className:"menu-item",onClick:Ge,children:t.is_starred?"Unstar post":"Star post"}),n.jsx("button",{className:"menu-item",onClick:Le,children:"Delete video"})]})]}):n.jsx("button",{onClick:()=>H(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:n.jsx(it,{size:24})}),Z&&n.jsxs("div",{ref:ee,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[n.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),n.jsx("button",{className:"menu-item",onClick:()=>_e("unrelated"),children:"Unrelated"}),n.jsx("button",{className:"menu-item",onClick:()=>_e("explicit"),children:"Explicit"}),ze&&n.jsx("button",{className:"menu-item",onClick:Le,children:"Delete video"})]})]}),t&&!re&&n.jsxs("div",{style:{position:"absolute",left:16,bottom:80,right:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:12},onClick:e=>e.stopPropagation(),children:[n.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:n.jsx(Oe,{to:`/profile/${(Pe=t.uploader)==null?void 0:Pe.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:16,display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:(()=>{var a,o,l;const e=(a=t.uploader)==null?void 0:a.is_admin,s=(o=t.uploader)==null?void 0:o.is_mod,r=e?"#fff3bf":s?"#d7fbe8":"#fff";return n.jsxs(n.Fragment,{children:[n.jsxs("span",{style:{color:r},children:["@",(l=t.uploader)==null?void 0:l.username]}),t.is_starred&&n.jsx(at,{size:16,color:"#f59e0b",title:"Starred"}),(e||s)&&n.jsx(Be,{size:14,color:r,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&n.jsx("div",{style:{color:"#fff",fontSize:14,lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto"},children:t.description}),t.beatmap_title&&n.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:13,textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),V&&t&&n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),n.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[n.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),n.jsx("button",{onClick:()=>le(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:n.jsx(lt,{size:24})})]}),n.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:$e.length===0?n.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):n.jsx("div",{className:"col",style:{gap:0},children:$e.map(e=>n.jsx(ut,{comment:e,replies:K.get(e.id)||[],me:E,section:"mappi",onReply:s=>de(s),onDelete:qe,replyingTo:ce,replyText:A,onReplyTextChange:W,onReplySubmit:Ne,posting:ue,onCancelReply:()=>{de(null),W("")}},e.id))})}),E&&!ce&&n.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:n.jsxs("form",{onSubmit:Ne,style:{display:"flex",alignItems:"flex-end",gap:8},children:[n.jsx("textarea",{placeholder:"Write a comment...",value:A,onChange:e=>W(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const s=e.target;s.style.height="auto",s.style.height=`${Math.min(s.scrollHeight,120)}px`}}),n.jsx("button",{type:"submit",className:"btn compact",disabled:ue||!A.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:ue?"...":"Post"})]})})]})]})]})]})}export{jt as default};
