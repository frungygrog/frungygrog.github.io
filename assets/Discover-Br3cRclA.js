const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-D64SysYh.js","assets/index-DJK_lnyq.js","assets/vendor-react-_vsaDC62.js","assets/vendor-DBgzFpze.js","assets/editor-components-CKFEosPJ.js","assets/editor-components-Bzmrvihl.css","assets/index-Do5egyzH.css"])))=>i.map(i=>d[i]);
import{u as vt,a as D,A as S,_ as pe,B as Et,b as nt}from"./index-DJK_lnyq.js";import{r as a,R as he,i as St,j as o,b as It,a as jt,L as rt,p as _t,D as Dt,E as Ot,G as ot,I as At,J as st,A as kt,c as Rt}from"./vendor-react-_vsaDC62.js";import{P as Tt}from"./Popup-D64SysYh.js";import{P as Lt}from"./beatmap-preview-iFLBdsja.js";import{C as $t}from"./Comment-CGQuJqdw.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";import"./editor-lib-BGkr3wNG.js";const O={};function Bt(){var Ze,et,tt;const[I,N]=a.useState(O.history||[]),[u,U]=a.useState(O.index||-1),t=u>=0?I[u]:null,[te,$e]=a.useState(!1),[at,Ce]=a.useState(!1),[it,Ne]=a.useState(!1),[ge,ne]=a.useState(!1),xe=he.useRef(null),[ye,be]=a.useState(!1),we=he.useRef(null),[F,ct]=a.useState(null),[ve,G]=a.useState(!1),[Ee,re]=a.useState(!1),Se=he.useRef(null),Ie=he.useRef(null),[g,je]=a.useState(!1),[Fe,Pe]=a.useState([]),[J,oe]=a.useState(""),[_e,De]=a.useState(null),[Oe,Ve]=a.useState(!1),[P,V]=a.useState(!0),{notify:L}=vt(),[A,K]=a.useState(O.queue||[]),M=a.useRef(O.seenIds||new Set),Me=a.useRef(new Set),Ae=a.useRef(!1),ze=a.useRef(null),[Ue,X]=a.useState(O.eligibleCount||null),[Be,Q]=a.useState(O.viewedCount||0),[B,W]=a.useState(!1),R=a.useRef(O.lastShownVideoId||null),$=a.useRef(0);a.useEffect(()=>()=>{O.history=I,O.index=u,O.queue=A,O.seenIds=M.current,O.eligibleCount=Ue,O.viewedCount=Be,O.lastShownVideoId=R.current},[I,u,A,Ue,Be]);function lt(){try{const e=Array.from(M.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function se(){try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(i=>i.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],s=Array.from(new Set(n.filter(i=>r.includes(i))));return s.length?s:["standard"]}catch{return["standard"]}}const dt=()=>{const e=new Set;return R.current!==null&&e.add(R.current),Array.from(M.current).slice(-200).forEach(r=>e.add(r)),A.forEach(r=>e.add(r.id)),Array.from(e)},We=async(e=5)=>{var n,r,s,i,l,m,E,f,j,w;if(Ae.current)return[];Ae.current=!0;try{const p=dt(),_=se().join(",");if(ze.current!==!1)try{const c=await D(S.feed.batch+nt({size:String(e),exclude:p.join(","),modes:_}),{requireAuth:!1}),d=c&&Array.isArray(c.items)?c.items:[],b=new Set,T=d.filter(x=>b.has(x.id)?!1:(b.add(x.id),!0)),H=new Set(A.map(x=>x.id)),C=T.filter(x=>!M.current.has(x.id)&&!H.has(x.id)&&x.id!==R.current);if(C.length>0&&K(x=>{const z=new Set(x.map(ee=>ee.id)),Y=C.filter(ee=>!z.has(ee.id));return[...x,...Y]}),C.length===0&&A.length===0)try{const x=await D(S.feed.progress(_),{requireAuth:!1}),z=Number(x.eligible||0),Y=Number(x.viewed||0);X(z),Q(Y),W(z>0&&Y>=z)}catch{}return C}catch(c){if((n=c==null?void 0:c.message)!=null&&n.includes("401")||(r=c==null?void 0:c.message)!=null&&r.includes("Unauthorized"))return Ne(!0),[];if((s=c==null?void 0:c.message)!=null&&s.includes("429")||(i=c==null?void 0:c.message)!=null&&i.includes("rate limit"))return L("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];((l=c==null?void 0:c.message)!=null&&l.includes("404")||(m=c==null?void 0:c.message)!=null&&m.includes("Not Found"))&&(ze.current=!1)}const k=[],h=new Set(A.map(c=>c.id));let y=[...p];for(let c=0;c<e;c++)try{const d=await D(S.feed.next+nt({exclude:y.join(","),modes:_}),{requireAuth:!1}),b=d&&("id"in d?d:d.video)||null;if(!b)break;if(M.current.has(b.id)||h.has(b.id)||b.id===R.current){y.push(b.id);continue}k.push(b),y.push(b.id),h.add(b.id)}catch(d){(E=d==null?void 0:d.message)!=null&&E.includes("401")||(f=d==null?void 0:d.message)!=null&&f.includes("Unauthorized")?Ne(!0):((j=d==null?void 0:d.message)!=null&&j.includes("429")||(w=d==null?void 0:d.message)!=null&&w.includes("rate limit"))&&L("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(k.length>0&&K(c=>{const d=new Set(c.map(T=>T.id)),b=k.filter(T=>!d.has(T.id));return[...c,...b]}),k.length===0&&A.length===0)try{const c=await D(S.feed.progress(_),{requireAuth:!1});X(Number(c.eligible||0)),Q(Number(c.viewed||0)),W(Number(c.caught_up||0)===1)}catch{}return k}catch{return[]}finally{Ae.current=!1}},ae=async()=>{if(!te){$e(!0);try{A.length<=2&&We(5).catch(()=>{});let e;if(A.length>0)e=A[0],e&&K(n=>n.filter(s=>s.id!==e.id));else{const n=await We(3);n.length>0&&(e=n[0],n.length>1&&K(r=>{const s=new Set(r.map(l=>l.id)),i=n.slice(1).filter(l=>!s.has(l.id));return[...r,...i]}))}if(e){if(R.current=e.id,M.current.add(e.id),lt(),$.current+=1,N(n=>{const r=[...n.slice(0,u+1),e];return U(r.length-1),r}),!Me.current.has(e.id)){Me.current.add(e.id);try{const n=await D(S.videos.view(e.id),{method:"POST"});n&&N(r=>{const s=[...r],i=s.findIndex(l=>l.id===e.id);return i!==-1&&(s[i]={...s[i],views_count:n.views_count??s[i].views_count??0,viewed_by_me:!0}),s})}catch{}}}else try{const n=se().join(","),r=await D(S.feed.progress(n),{requireAuth:!1}),s=Number(r.eligible||0),i=Number(r.viewed||0);X(s),Q(i),W(s>0&&i>=s)}catch{}}finally{$e(!1)}}},ke=()=>{const e=performance.now();if(console.log(`[NAVIGATION] goPrev() called at ${e.toFixed(2)}ms`),console.log(`[NAVIGATION] Current state: index=${u}, history.length=${I.length}, currentVideo.id=${(t==null?void 0:t.id)||"null"}`),u>0){const n=u-1,r=I[n];if(console.log(`[NAVIGATION] Navigating back to index ${n}, video.id=${(r==null?void 0:r.id)||"null"}, stream_uid=${(r==null?void 0:r.stream_uid)||"null"}`),r){const l=R.current;R.current=r.id,console.log(`[NAVIGATION] Updated lastShownVideoId from ${l} to ${r.id}`)}const s=$.current;$.current+=1,console.log(`[NAVIGATION] Incremented navigationKey from ${s} to ${$.current} to force Player remount`),U(n),G(!1);const i=performance.now()-e;console.log(`[NAVIGATION] goPrev() completed in ${i.toFixed(2)}ms, new index=${n}`)}else console.warn(`[NAVIGATION] goPrev() called but index=${u} <= 0, cannot go back`)},Re=()=>{if(!P&&(Z.current=!0,de.current=!0,v.current)){const e=v.current;e.muted=!1,V(!1),e.play().catch(()=>{})}if(u<I.length-1){const e=I[u+1];e&&(R.current=e.id),$.current+=1,U(u+1),G(!1);return}B||ae()},ie=a.useRef(0),ce=a.useRef(null),le=a.useRef(null),Te=a.useRef({goNext:Re,goPrev:ke,index:u,history:I,loading:te,exhausted:B});a.useEffect(()=>{Te.current={goNext:Re,goPrev:ke,index:u,history:I,loading:te,exhausted:B}},[Re,ke,u,I,te,B]),a.useEffect(()=>{const e=Qe.current;if(!e)return;const n=i=>{if(e){const f=e.getBoundingClientRect(),j=i.clientX,w=i.clientY;if(j<f.left||j>f.right||w<f.top||w>f.bottom)return}i.preventDefault(),i.stopPropagation();const l=Date.now();if(l<ie.current||(ie.current=l+1e3,Math.abs(i.deltaY)<Math.abs(i.deltaX)))return;const{goNext:m,goPrev:E}=Te.current;i.deltaY>0?m():E()},r=i=>{ce.current=i.touches[0].clientY,le.current=Date.now()},s=i=>{if(ce.current===null||le.current===null)return;const l=i.changedTouches[0].clientY,m=Date.now(),E=ce.current-l,f=m-le.current;if(ce.current=null,le.current=null,Math.abs(E)<50||f>300)return;const j=Date.now();if(j<ie.current)return;ie.current=j+1e3;const{goNext:w,goPrev:p}=Te.current;E>0?w():p()};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",s,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",s),window.removeEventListener("wheel",n,{capture:!0})}},[]);const ut=async()=>{var e,n;if(t){Ce(!0);try{const r=t.liked_by_me?"DELETE":"POST",s=await D(S.videos.like(t.id),{method:r});N(i=>{const l=[...i];return l[u]={...l[u],liked_by_me:!t.liked_by_me,likes_count:s.likes_count},l})}catch(r){((e=r==null?void 0:r.message)!=null&&e.includes("429")||(n=r==null?void 0:r.message)!=null&&n.includes("rate limit"))&&L("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{Ce(!1)}}};async function qe(e){if(t)try{await D(S.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),L("Thanks for your report.",{variant:"info"})}catch{L("Report failed",{variant:"error"})}finally{ne(!1)}}a.useEffect(()=>{if(!ge)return;const e=n=>{xe.current&&!xe.current.contains(n.target)&&ne(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ge]),a.useEffect(()=>{if(!ye)return;const e=n=>{we.current&&!we.current.contains(n.target)&&be(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ye]),a.useEffect(()=>{if(!Ee)return;const e=n=>{Se.current&&!Se.current.contains(n.target)&&Ie.current&&!Ie.current.contains(n.target)&&re(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[Ee]),a.useEffect(()=>{I.length===0&&ae()},[]),a.useEffect(()=>{t&&(R.current=t.id)},[t==null?void 0:t.id]),a.useEffect(()=>{(async()=>{try{const e=se().join(","),n=await D(S.feed.progress(e),{requireAuth:!1}),r=Number(n.eligible||0),s=Number(n.viewed||0);X(r),Q(s);const i=r>0&&s>=r;W(i)}catch{}})()},[]),a.useEffect(()=>{const e=()=>{N([]),K([]),M.current.clear(),R.current=null,$.current=0,U(-1),W(!1),(async()=>{try{const n=se().join(","),r=await D(S.feed.progress(n),{requireAuth:!1}),s=Number(r.eligible||0),i=Number(r.viewed||0);X(s),Q(i),W(!1)}catch{}ae()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),a.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const n=JSON.parse(e);if(Array.isArray(n))for(const r of n)typeof r=="number"&&M.current.add(r)}}catch{}},[]),a.useEffect(()=>{(async()=>{try{const e=await D(S.auth.me,{requireAuth:!1});ct(e)}catch{}})()},[]);const Z=a.useRef(!1),ft=async e=>{if(!e)return;const n=performance.now();console.log(`[PRELOAD] Starting preload for next video ${e.id} (${e.stream_uid}) at ${n.toFixed(2)}ms`);try{const r=e.playback_url||(e.stream_uid?`https://videodelivery.net/${e.stream_uid}/manifest/video.m3u8`:null);if(!r)return;(async()=>{const i=performance.now();console.log(`[PRELOAD] Fetching manifest: ${r} at ${i.toFixed(2)}ms`);try{const l=await fetch(r,{priority:"high"}),m=performance.now()-i;if(console.log(`[PRELOAD] Manifest fetched in ${m.toFixed(2)}ms, status: ${l.status}`),l.ok){const E=await l.text(),j=new TextEncoder().encode(E).buffer,{setCached:w}=await pe(async()=>{const{setCached:h}=await import("./Popup-D64SysYh.js").then(y=>y.v);return{setCached:h}},__vite__mapDeps([0,1,2,3,4,5,6]));await w(r,j,!0,e.stream_uid);const p=E.split(`
`),_=[];let k=r.substring(0,r.lastIndexOf("/")+1);for(let h=0;h<p.length&&_.length<3;h++){const y=p[h].trim();if(y&&!y.startsWith("#")&&(y.endsWith(".ts")||y.endsWith(".m4s"))){const c=y.startsWith("http")?y:k+y;_.push(c)}}for(let h=0;h<_.slice(0,2).length;h++){const y=_[h],c=performance.now();console.log(`[PRELOAD] Preloading segment ${h+1}: ${y} at ${c.toFixed(2)}ms`),fetch(y,{priority:"high"}).then(async d=>{const b=performance.now()-c;if(console.log(`[PRELOAD] Segment ${h+1} fetched in ${b.toFixed(2)}ms, status: ${d.status}`),d.ok)try{const T=performance.now(),H=await d.arrayBuffer(),C=performance.now()-T;console.log(`[PRELOAD] Segment ${h+1} buffer read in ${C.toFixed(2)}ms, size: ${H.byteLength} bytes`);const x=performance.now(),{setCached:z}=await pe(async()=>{const{setCached:ee}=await import("./Popup-D64SysYh.js").then(wt=>wt.v);return{setCached:ee}},__vite__mapDeps([0,1,2,3,4,5,6]));await z(y,H,!1,e.stream_uid);const Y=performance.now()-x;console.log(`[PRELOAD] Segment ${h+1} cached in ${Y.toFixed(2)}ms`)}catch(T){console.error(`[PRELOAD] Error caching segment ${h+1}:`,T)}}).catch(d=>{const b=performance.now()-c;console.error(`[PRELOAD] Segment ${h+1} preload failed after ${b.toFixed(2)}ms:`,d)})}}}catch{}})()}catch{}};a.useEffect(()=>{G(!1),je(!1),Z.current?V(!1):V(!0)},[t==null?void 0:t.id]),a.useEffect(()=>{v.current&&(v.current.muted=P)},[P]),a.useEffect(()=>{var l;if(!t){console.log("[VIDEO LOAD] No video available, skipping load");return}const e=performance.now(),n=u<I.length-1,r=n?"BACKWARD":"FORWARD";console.log(`[VIDEO LOAD] Starting load for video ${t.id} (${t.stream_uid}) at ${e.toFixed(2)}ms`),console.log(`[VIDEO LOAD] Navigation direction: ${r}, index=${u}, history.length=${I.length}`),console.log(`[VIDEO LOAD] Video details: id=${t.id}, stream_uid=${t.stream_uid}, playback_url=${t.playback_url||"null"}`);const s=t.playback_url||(t.stream_uid?`https://videodelivery.net/${t.stream_uid}/manifest/video.m3u8`:null);if(s){const m=performance.now();console.log(`[VIDEO LOAD] Prefetching manifest: ${s} at ${m.toFixed(2)}ms`),console.log(`[VIDEO LOAD] This is a ${n?"PREVIOUSLY SEEN":"NEW"} video - cache should ${n?"be available":"be populated"}`),fetch(s,{priority:"high"}).then(async E=>{const f=performance.now()-m;if(console.log(`[VIDEO LOAD] Manifest fetch completed in ${f.toFixed(2)}ms, status: ${E.status}`),E.ok)try{const j=performance.now(),w=await E.text(),p=performance.now()-j;console.log(`[VIDEO LOAD] Manifest text read in ${p.toFixed(2)}ms, size: ${w.length} bytes`);const _=performance.now(),h=new TextEncoder().encode(w).buffer,{setCached:y}=await pe(async()=>{const{setCached:C}=await import("./Popup-D64SysYh.js").then(x=>x.v);return{setCached:C}},__vite__mapDeps([0,1,2,3,4,5,6]));await y(s,h,!0,t.stream_uid);const c=performance.now()-_;console.log(`[VIDEO LOAD] Manifest cached in IndexedDB in ${c.toFixed(2)}ms`);const d=performance.now(),{memoryCache:b}=await pe(async()=>{const{memoryCache:C}=await import("./Popup-D64SysYh.js").then(x=>x.h);return{memoryCache:C}},__vite__mapDeps([0,1,2,3,4,5,6]));b.set(s,h);const T=performance.now()-d;console.log(`[VIDEO LOAD] Manifest added to memory cache in ${T.toFixed(2)}ms`);const H=performance.now()-m;console.log(`[VIDEO LOAD] Total manifest prefetch time: ${H.toFixed(2)}ms`)}catch(j){console.error("[VIDEO LOAD] Error caching manifest:",j)}}).catch(E=>{const f=performance.now()-m;console.error(`[VIDEO LOAD] Manifest prefetch failed after ${f.toFixed(2)}ms:`,E)})}if(n)console.log("[VIDEO LOAD] Skipping preload for backward navigation (video should be cached)");else{const m=A.length>0?A[0]:u<I.length-1?I[u+1]:null;m&&m.id!==t.id&&(console.log(`[VIDEO LOAD] Preloading next video ${m.id} for forward navigation`),ft(m))}if(v.current){const m=performance.now();console.log(`[VIDEO LOAD] Attempting to play video at ${m.toFixed(2)}ms (${(m-e).toFixed(2)}ms after load start)`),console.log(`[VIDEO LOAD] Video element ready: ${v.current?"YES":"NO"}, readyState=${((l=v.current)==null?void 0:l.readyState)||"N/A"}`),(()=>{const f=v.current;if(f&&f===v.current)if(!Z.current){f.muted=!0;const w=performance.now();f.play().then(()=>{const p=performance.now()-w;console.log(`[VIDEO LOAD] Video play() succeeded in ${p.toFixed(2)}ms (muted)`)}).catch(p=>{const _=performance.now()-w;p.name!=="AbortError"&&p.name!=="NotAllowedError"&&console.warn(`[VIDEO LOAD] Video play() failed after ${_.toFixed(2)}ms:`,p)})}else{f.muted=!1,V(!1);const w=performance.now();f.play().then(()=>{const p=performance.now()-w;console.log(`[VIDEO LOAD] Video play() succeeded in ${p.toFixed(2)}ms (unmuted)`)}).catch(p=>{const _=performance.now()-w;p.name==="AbortError"||p.name==="NotAllowedError"||(console.warn(`[VIDEO LOAD] Unmuted play failed after ${_.toFixed(2)}ms, falling back to muted:`,p),f===v.current&&(f.muted=!0,V(!0),f.play().catch(k=>{k.name!=="AbortError"&&k.name!=="NotAllowedError"&&console.warn("[VIDEO LOAD] Fallback muted play failed:",k)})))})}})()}else console.warn(`[VIDEO LOAD] Video element not available for video ${t.id} - Player may not be mounted yet`),console.warn("[VIDEO LOAD] This might indicate a remount issue when navigating back");const i=performance.now()-e;console.log(`[VIDEO LOAD] Total video load setup completed in ${i.toFixed(2)}ms for video ${t.id}`)},[t==null?void 0:t.id,A,u,I]);const de=a.useRef(!1),mt=e=>{v.current=e,e&&(de.current&&Z.current?(e.muted=!1,V(!1),e.play().then(()=>{de.current=!1}).catch(()=>{e.muted=!0,V(!0),de.current=!1,e.play().catch(()=>{})})):e.muted=P)},He=async()=>{if(t!=null&&t.id)try{const e=await D(S.videos.comments(t.id),{requireAuth:!1});Pe(e.items||[])}catch{}};a.useEffect(()=>{g&&(t!=null&&t.id)&&He()},[g,t==null?void 0:t.id]);const Ye=async e=>{if(e.preventDefault(),!(!J.trim()||!(t!=null&&t.id))){Ve(!0);try{await D(S.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:J.trim(),parent_id:_e||void 0})}),oe(""),De(null),He(),N(n=>{const r=[...n],s=r.findIndex(i=>i.id===t.id);return s!==-1&&(r[s]={...r[s],comments_count:(r[s].comments_count||0)+1}),r}),L("Comment posted!",{variant:"success"})}catch(n){L((n==null?void 0:n.message)||"Failed to post comment",{variant:"error"})}finally{Ve(!1)}}},pt=e=>{Pe(n=>n.filter(r=>r.id!==e)),N(n=>{const r=[...n],s=r.findIndex(i=>i.id===(t==null?void 0:t.id));return s!==-1&&(r[s]={...r[s],comments_count:Math.max(0,(r[s].comments_count||0)-1)}),r})},Ge=Fe.filter(e=>!e.parent_id),ue=new Map;Fe.filter(e=>e.parent_id).forEach(e=>{const n=e.parent_id;ue.has(n)||ue.set(n,[]),ue.get(n).push(e)});const v=a.useRef(null),fe=a.useRef(null),q=a.useRef(!1),ht=()=>{if(!v.current||q.current)return;const e=v.current,n=!P;V(n),e.muted=n,n||(Z.current=!0),!n&&e.paused&&e.play().catch(r=>{console.debug("Play failed after unmute:",r)})},Je=()=>{v.current&&(q.current=!1,fe.current=window.setTimeout(()=>{q.current=!0;const e=v.current;e&&!e.paused&&e.pause()},200))},Le=()=>{if(fe.current&&(clearTimeout(fe.current),fe.current=null),q.current&&v.current){const e=v.current;e.paused&&e.play().catch(n=>console.debug("Resume failed:",n)),q.current=!1}},gt=()=>{Je()},xt=e=>{q.current&&e.preventDefault(),Le()},Ke=!!(F!=null&&F.is_admin||F!=null&&F.is_mod);async function yt(){if(!t)return;const e=!t.is_starred,n=e?"star":"unstar";try{await D(S.admin.videosAction(t.id,n),{method:"POST"}),N(r=>{const s=[...r];return s[u]={...s[u],is_starred:e},s}),be(!1),L(e?"Post starred":"Star removed",{variant:"success"})}catch{L("Action failed",{variant:"error"})}}async function Xe(){if(t&&confirm("Permanently delete this video?"))try{await D(S.videos.delete(t.id),{method:"DELETE"}),L("Deleted",{variant:"warn"}),ne(!1),N(e=>{const n=e.filter((r,s)=>s!==u);return n.length===0?($.current=0,U(-1),setTimeout(ae,0)):($.current+=1,U(r=>Math.max(0,Math.min(r,n.length-1)))),n})}catch{alert("Delete failed")}}St();const Qe=a.useRef(null),[me,bt]=a.useState(0);return a.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&bt(n.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),o.jsxs(o.Fragment,{children:[o.jsx(Et,{paused:!1}),o.jsxs("div",{ref:Qe,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[B&&o.jsx("div",{className:"chip info",style:{position:"absolute",top:me+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),o.jsx("div",{className:"video-area",style:{position:"absolute",top:me,left:0,right:0,bottom:g?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:it?o.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[o.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),o.jsx("button",{className:"btn",onClick:()=>window.location.href=S.auth.login,children:"Login with osu!"})]}):t?o.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:ve&&t.beatmapset_id?o.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:o.jsx(Lt,{downloadUrl:t.beatmapset_id?S.osu.downloadBeatmapset(t.beatmapset_id):"",beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{G(!1),window.location.hash="/editor"}})}):o.jsxs("div",{style:{width:g?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:g?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:g?`calc(50vh - ${me}px)`:`calc(100vh - ${me}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[o.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),o.jsx("div",{style:{position:"relative",zIndex:1},children:o.jsxs("div",{onClick:ht,onMouseDown:Je,onMouseUp:Le,onMouseLeave:Le,onTouchStart:gt,onTouchEnd:xt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[o.jsx(Tt,{videoKey:$.current,streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t!=null&&t.width&&(t!=null&&t.height)?t.width/t.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:P,controls:!1,onVideoRef:mt},`${t.id}-${$.current}`),o.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:P?1:0},children:P?o.jsx(It,{size:20,color:"#fff"}):o.jsx(jt,{size:20,color:"#fff"})})]})})]})}):B?null:o.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[o.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),o.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[o.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),o.jsx("div",{children:"• Click video to toggle mute/unmute"}),o.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!ve&&o.jsxs("div",{style:{position:"absolute",right:g?12:16,top:"50%",display:"flex",flexDirection:"column",gap:g?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:g?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[o.jsx(rt,{to:`/profile/${(Ze=t.uploader)==null?void 0:Ze.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(et=t.uploader)!=null&&et.avatar_url?o.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):o.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[o.jsx("button",{onClick:ut,disabled:at,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?o.jsx(_t,{size:28}):o.jsx(Dt,{size:28})}),o.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[o.jsx("button",{onClick:()=>je(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:o.jsx(Ot,{size:28})}),o.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{ref:Ie,onClick:()=>re(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:o.jsx(ot,{size:24})}),Ee&&o.jsxs("div",{ref:Se,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[o.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>re(!1),children:[o.jsx(ot,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&o.jsx("button",{className:"menu-item",onClick:()=>{G(!0),re(!1)},children:"Preview"})]})]}),Ke?o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>be(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:o.jsx(st,{size:24})}),ye&&o.jsxs("div",{ref:we,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[o.jsx("button",{className:"menu-item",onClick:yt,children:t.is_starred?"Unstar post":"Star post"}),o.jsx("button",{className:"menu-item",onClick:Xe,children:"Delete video"})]})]}):o.jsx("button",{onClick:()=>ne(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:o.jsx(At,{size:24})}),ge&&o.jsxs("div",{ref:xe,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[o.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),o.jsx("button",{className:"menu-item",onClick:()=>qe("unrelated"),children:"Unrelated"}),o.jsx("button",{className:"menu-item",onClick:()=>qe("explicit"),children:"Explicit"}),Ke&&o.jsx("button",{className:"menu-item",onClick:Xe,children:"Delete video"})]})]}),t&&!ve&&o.jsxs("div",{style:{position:"absolute",left:g?12:16,bottom:g?"55%":80,right:g?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:g?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:g?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[o.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:o.jsx(rt,{to:`/profile/${(tt=t.uploader)==null?void 0:tt.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:g?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var s,i,l;const e=(s=t.uploader)==null?void 0:s.is_admin,n=(i=t.uploader)==null?void 0:i.is_mod,r=e?"#fff3bf":n?"#d7fbe8":"#fff";return o.jsxs(o.Fragment,{children:[o.jsxs("span",{style:{color:r},children:["@",(l=t.uploader)==null?void 0:l.username]}),t.is_starred&&o.jsx(kt,{size:g?14:16,color:"#f59e0b",title:"Starred"}),(e||n)&&o.jsx(st,{size:g?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&o.jsx("div",{style:{color:"#fff",fontSize:g?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&o.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:g?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),g&&t&&o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),o.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[o.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),o.jsx("button",{onClick:()=>je(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:o.jsx(Rt,{size:24})})]}),o.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Ge.length===0?o.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):o.jsx("div",{className:"col",style:{gap:0},children:Ge.map(e=>o.jsx($t,{comment:e,replies:ue.get(e.id)||[],me:F,section:"mappi",onReply:n=>De(n),onDelete:pt,replyingTo:_e,replyText:J,onReplyTextChange:oe,onReplySubmit:Ye,posting:Oe,onCancelReply:()=>{De(null),oe("")}},e.id))})}),F&&!_e&&o.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:o.jsxs("form",{onSubmit:Ye,style:{display:"flex",alignItems:"flex-end",gap:8},children:[o.jsx("textarea",{placeholder:"Write a comment...",value:J,onChange:e=>oe(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),o.jsx("button",{type:"submit",className:"btn compact",disabled:Oe||!J.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:Oe?"...":"Post"})]})})]})]})]})]})}export{Bt as default};
