const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Discover-C3fI28uN.js","assets/vendor-react-CJJ8g4j9.js","assets/vendor-9gT45Spz.js","assets/mappi-routes-CIxomdoT.js","assets/vendor-hls-B_fsdCYC.js","assets/editor-2rGn0xn5.js","assets/vendor-zip-BMVqRzO9.js","assets/beatmap-preview-BPnr1eYJ.js","assets/editor-CG1yLUbS.css","assets/moddi-routes-CMmlZjIR.js","assets/editor-components-D4aeOjRG.js","assets/editor-components-Bzmrvihl.css"])))=>i.map(i=>d[i]);
var ot=Object.defineProperty;var lt=(t,n,s)=>n in t?ot(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var Fe=(t,n,s)=>lt(t,typeof n!="symbol"?n+"":n,s);import{r as f,j as e,e as ye,u as ke,R as j,q as Ie,d as Le,U as dt,V as We,W as ct,L as Y,X as ut,Y as mt,O as Je,Z as pt,_ as ht,P as _e,K as ft,A as gt,h as xt,y as De,Q as bt,S as vt,I as yt,c as Te,B as jt,l as Ge,$ as Nt,D as wt,a0 as qe,o as kt,k as St,E as _t,i as Tt,g as Ct,a1 as Ue,a2 as Et,a3 as Ve,v as Mt,a4 as Lt,a5 as At,a6 as Pt,a7 as It,a8 as V,a9 as ge}from"./vendor-react-CJJ8g4j9.js";import{y as zt}from"./vendor-9gT45Spz.js";import{u as be,a as $,A as q,O as we,c as Ce,i as ce,d as Pe,b as xe,P as Rt,e as Ft,T as Wt,f as Dt}from"./mappi-routes-CIxomdoT.js";import{u as pe,a as Ye,b as ue,c as Xe,d as qt,e as Ut,f as $t,g as Ze,h as Bt,i as Ot,F as Ht,D as Qt,Q as Kt,j as Jt,M as Gt,N as Vt}from"./moddi-routes-CMmlZjIR.js";import{i as et,a as tt,b as st,c as at,H as Yt}from"./editor-components-D4aeOjRG.js";import{s as Xt,E as Zt,B as es}from"./editor-2rGn0xn5.js";import"./vendor-hls-B_fsdCYC.js";import"./beatmap-preview-BPnr1eYJ.js";import"./vendor-zip-BMVqRzO9.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();const ts="modulepreload",ss=function(t){return"/"+t},$e={},as=function(n,s,o){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),y=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=ss(c),c in $e)return;$e[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const l=document.createElement("link");if(l.rel=h?"stylesheet":ts,h||(l.as="script"),l.crossOrigin="",l.href=c,y&&l.setAttribute("nonce",y),document.head.appendChild(l),h)return new Promise((w,E)=>{l.addEventListener("load",w),l.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return a.then(p=>{for(const y of p||[])y.status==="rejected"&&r(y.reason);return n().catch(r)})},is=new zt({defaultOptions:{queries:{staleTime:30*1e3,gcTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});class ns extends f.Component{constructor(s){super(s);Fe(this,"handleRetry",()=>{const s=this.isChunkLoadingError(this.state.error);this.setState({hasError:!1,error:null}),s&&window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,o){console.error("ErrorBoundary caught an error:",s,o)}isChunkLoadingError(s){if(!s)return!1;const o=s.message.toLowerCase();return o.includes("loading chunk")||o.includes("failed to load")||o.includes("chunk load failed")||o.includes("loading css chunk")||s.name==="ChunkLoadError"}render(){var s;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const o=this.isChunkLoadingError(this.state.error),a=((s=this.state.error)==null?void 0:s.message)||"An unexpected error occurred";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"24px",textAlign:"center"},children:[e.jsx("h2",{style:{marginBottom:"16px",color:"var(--danger)"},children:"Something went wrong"}),e.jsx("p",{style:{marginBottom:"8px",color:"var(--muted)"},children:o?"Failed to load page. This might be a network issue.":a}),o&&e.jsx("p",{style:{marginBottom:"24px",fontSize:"14px",color:"var(--muted)",opacity:.8},children:"Try checking your internet connection or reloading the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsx("button",{className:"btn secondary",onClick:this.handleRetry,children:o?"Reload Page":"Try Again"}),!o&&e.jsx("button",{className:"btn secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})}return this.props.children}}const le=["#7dd3fc","#a78bfa","#34d399","#f472b6","#f59e0b"];function rs({i:t}){const n=t*1337,s=(E,S)=>{const b=Math.sin(n+E+S)*1e4,k=b-Math.floor(b);return Math.floor(k*(S-E+1)+E)},o=s(0,100),a=s(24,50),r=.7+s(0,100)/100*.3,p=a*r,y=s(0,4e3),c=s(-10,10),h=s(-8,8),u=s(0,100),l=u<60?1:u<80?1.5:2,w=[{size:200*l,alpha:.06,dx:-22,dy:12,color:le[s(0,le.length-1)]},{size:150*l,alpha:.08,dx:-9,dy:7,color:le[s(0,le.length-1)]},{size:120*l,alpha:.1,dx:0,dy:0,color:le[s(0,le.length-1)]},{size:90*l,alpha:.12,dx:12,dy:-4,color:le[s(0,le.length-1)]},{size:64*l,alpha:.13,dx:20,dy:-7,color:le[s(0,le.length-1)]}];return e.jsx("div",{className:"cluster",style:{left:`${o}vw`,animationDuration:`${p}s`,animationDelay:`${y}ms`,"--tx":`${c}vw`,transform:`rotate(${h}deg)`},children:w.map((E,S)=>e.jsx("svg",{width:E.size,height:E.size,viewBox:"0 0 100 100",style:{left:`${50+E.dx}%`,bottom:`${E.dy}px`,transform:"translateX(-50%)","--alpha":E.alpha},children:e.jsx("polygon",{points:"50,0 100,100 0,100",fill:E.color})},S))})}function os({paused:t=!1}){const n=f.useMemo(()=>new Array(20).fill(0).map((s,o)=>o),[]);return e.jsx("div",{className:`triangles ${t?"paused":""}`,children:n.map(s=>e.jsx(rs,{i:s},s))})}function ls(){const t=ye(),n=ke(),{lastSection:s,previousLocation:o,setPreviousLocation:a}=pe(),r=j.useRef(null);j.useRef(!1),j.useRef(0),j.useRef(0);const p=j.useRef(null),y=j.useRef(null);j.useRef(!1);const c=j.useRef(null),h=j.useRef(null),u=j.useRef(null),[l,w]=j.useState(!1),[E,S]=j.useState(12),b=j.useRef(null),k=j.useRef(null),[g,R]=j.useState(!1),[O,x]=j.useState(12),[Q,W]=j.useState([]),[d,U]=j.useState(""),H=j.useRef(null),T=j.useRef(null),[A,M]=j.useState(!1),[N,P]=j.useState(12),[v,B]=j.useState(null),K=j.useCallback(()=>{if(!h.current)return;const _=h.current.getBoundingClientRect(),C=window.innerWidth||document.documentElement.clientWidth||320,L=160;let z=_.left;z+L+8>C&&(z=Math.max(8,C-L-8)),z=Math.max(8,z),S(z)},[]),m=j.useCallback(()=>{if(!b.current)return;const _=b.current.getBoundingClientRect(),C=window.innerWidth||document.documentElement.clientWidth||320,L=220;let z=_.left;z+L+8>C&&(z=Math.max(8,C-L-8)),z=Math.max(8,z),x(z)},[]),D=j.useCallback(()=>{if(!H.current)return;const _=H.current.getBoundingClientRect(),C=window.innerWidth||document.documentElement.clientWidth||320,L=280;let z=_.left;z+L+8>C&&(z=Math.max(8,C-L-8)),z=Math.max(8,z),P(z)},[]);j.useEffect(()=>()=>{r.current&&clearTimeout(r.current),p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]),j.useEffect(()=>{if(!l)return;const _=C=>{const L=C.target;u.current&&!u.current.contains(L)&&h.current&&!h.current.contains(L)&&w(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[l]),j.useEffect(()=>{if(!g)return;const _=C=>{const L=C.target;k.current&&!k.current.contains(L)&&b.current&&!b.current.contains(L)&&R(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[g]),j.useEffect(()=>{if(!A)return;const _=C=>{const L=C.target;T.current&&!T.current.contains(L)&&H.current&&!H.current.contains(L)&&M(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[A]),j.useEffect(()=>{if(!l)return;K();const _=()=>K();return window.addEventListener("resize",_),window.addEventListener("orientationchange",_),()=>{window.removeEventListener("resize",_),window.removeEventListener("orientationchange",_)}},[l,K]),j.useEffect(()=>{if(!g)return;m();const _=()=>m();return window.addEventListener("resize",_),window.addEventListener("orientationchange",_),()=>{window.removeEventListener("resize",_),window.removeEventListener("orientationchange",_)}},[g,m]),j.useEffect(()=>{if(!A)return;D();const _=()=>D();return window.addEventListener("resize",_),window.addEventListener("orientationchange",_),()=>{window.removeEventListener("resize",_),window.removeEventListener("orientationchange",_)}},[A,D]);const F=t.pathname==="/"||t.pathname==="/about",X=t.pathname==="/editor";t.pathname.startsWith("/mp/")||!F&&t.pathname.startsWith("/md/"),t.pathname.startsWith("/md/")||!F&&t.pathname.startsWith("/mp/"),j.useEffect(()=>{if(!X)return;const _=L=>{const z=L.detail||{},J=Array.isArray(z.items)?z.items:[];W(J),U(String(z.selected||""))},C=L=>{const z=L.detail||{};B({title:String(z.title||""),artist:String(z.artist||""),mapper:String(z.mapper||""),version:String(z.version||""),beatmapId:Number(z.beatmapId)||null})};return window.addEventListener("editor:difficulty:list",_),window.addEventListener("editor:info",C),()=>{window.removeEventListener("editor:difficulty:list",_),window.removeEventListener("editor:info",C)}},[X]);const re=Ye(),{data:G}=ue(),se=j.useRef(null),te=j.useRef(!1),he=_=>{te.current=!1,(G!=null&&G.is_mod||G!=null&&G.is_admin)&&(_.preventDefault(),_.stopPropagation(),se.current=setTimeout(()=>{te.current=!0,n("/moderation")},500))},fe=()=>{se.current&&(clearTimeout(se.current),se.current=null),te.current&&setTimeout(()=>{te.current=!1},100)},je=_=>{if(te.current){_.preventDefault(),_.stopPropagation();return}n("/settings")},i=_=>{if(fe(),te.current){_.preventDefault();return}n("/settings")};if(j.useEffect(()=>()=>{se.current&&clearTimeout(se.current)},[]),F)return null;const I=()=>{n(o||(s==="moddi"?"/md/feed":"/mp/feed"))},ae=()=>{w(_=>!_)},ee=()=>{var _;w(!1),(_=c.current)==null||_.click()},ve=()=>{R(_=>!_)},Ee=_=>{R(!1),U(_),window.dispatchEvent(new CustomEvent("editor:difficulty:select",{detail:{path:_}}))},Me=()=>{M(_=>!_)};return X?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:c,type:"file",accept:".osz,.zip",onChange:_=>{var L;const C=(L=_.target.files)==null?void 0:L[0];C&&window.dispatchEvent(new CustomEvent("editor:file",{detail:C}))},style:{display:"none"}}),e.jsxs("nav",{className:"mobile-bottom-nav mobile-bottom-nav-editor",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx("button",{className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:I,"aria-label":"Back",title:"Go back",children:e.jsx(Ie,{size:20})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:h,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ae,"aria-label":"File",title:"File menu","aria-expanded":l,children:e.jsx(dt,{size:20})}),l&&Le.createPortal(e.jsx("div",{ref:u,className:"menu-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${E}px`},children:e.jsx("button",{className:"menu-item",type:"button",onClick:ee,style:{fontFamily:"Torus Pro, Torus, ui-sans-serif, system-ui, sans-serif"},children:"Open .osz"})}),document.body)]})]}),e.jsx("button",{className:"mobile-bottom-nav-coin-flip",onClick:I,"aria-label":"Go back",title:"Go back to previous page",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"ed!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[Q.length>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:b,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:ve,"aria-label":"Select Difficulty",title:"Select Difficulty","aria-expanded":g,children:e.jsx(We,{size:20})}),g&&Le.createPortal(e.jsx("div",{ref:k,className:"settings-panel mobile-bottom-nav-menu",role:"menu",style:{"--mobile-menu-left":`${O}px`,minWidth:220},children:Q.map(_=>{const C=_.mode==="taiko"?et:_.mode==="mania"?tt:_.mode==="catch"?st:at;return e.jsxs("button",{className:`mode-option ${d===_.path?"selected":""}`,type:"button",onClick:()=>Ee(_.path),children:[e.jsx("img",{className:"mode-icon",src:C,width:24,height:24,alt:""}),e.jsx("span",{children:_.version||"(Untitled)"})]},_.path)})}),document.body)]}),v&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:H,className:"mobile-bottom-nav-item mobile-bottom-nav-icon-only",onClick:Me,"aria-label":"Map Info",title:"Map Info","aria-expanded":A,children:e.jsx(ct,{size:20})}),A&&Le.createPortal(e.jsx("div",{ref:T,className:"menu-panel mobile-bottom-nav-menu",role:"dialog",style:{"--mobile-menu-left":`${N}px`,minWidth:280,maxWidth:"min(380px, calc(100vw - 24px))"},children:e.jsxs("div",{style:{padding:"4px 0"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:"var(--text)",marginBottom:8},children:[v.artist||"Artist"," – ",v.title||"Title"]}),e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Mapped by: ",v.mapper||"Unknown"]}),v.version&&e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["Difficulty: ",v.version]}),v.beatmapId&&e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:e.jsx("a",{href:`https://osu.ppy.sh/beatmaps/${v.beatmapId}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none"},children:"View on osu.ppy.sh →"})})]})}),document.body)]})]})]})]}):e.jsxs("nav",{className:"mobile-bottom-nav",children:[e.jsxs("div",{className:"mobile-bottom-nav-left",children:[e.jsx(Y,{to:"/feed",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/feed"||t.pathname.startsWith("/feed/")?"active":""}`,"aria-label":"Feed",children:e.jsx(We,{size:20})}),e.jsx(Y,{to:"/discover",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/discover"?"active":""}`,"aria-label":"Discover",children:e.jsx(ut,{size:20})}),e.jsx(Y,{to:"/queues",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/queues"||t.pathname.startsWith("/queues/")?"active":""}`,"aria-label":"Queues",children:e.jsx(mt,{size:20})})]}),e.jsx(Y,{to:"/",className:"mobile-bottom-nav-coin-flip","aria-label":"Home",title:"Go to home",children:e.jsx("span",{className:"mobile-coin-flip-text",children:"m!"})}),e.jsxs("div",{className:"mobile-bottom-nav-right",children:[e.jsxs(Y,{to:"/notifications",className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/notifications"?"active":""}`,"aria-label":"Notifications",style:{position:"relative",overflow:"visible"},children:[e.jsx(Je,{size:20}),re>0&&e.jsx("div",{style:{position:"absolute",top:4,right:4,width:10,height:10,background:"#f87171",borderRadius:9999,zIndex:10,pointerEvents:"none",border:"2px solid var(--panel)",boxSizing:"border-box"}})]}),e.jsx("button",{className:`mobile-bottom-nav-item mobile-bottom-nav-icon-only ${t.pathname==="/settings"?"active":""}`,onClick:je,onTouchStart:he,onTouchEnd:i,onMouseDown:he,onMouseUp:fe,onMouseLeave:fe,"aria-label":G!=null&&G.is_mod||G!=null&&G.is_admin?"Settings (long press for moderation)":"Settings",title:G!=null&&G.is_mod||G!=null&&G.is_admin?"Settings (long press for moderation)":"Settings",children:e.jsx(pt,{size:20})})]})]})}function ds(){return e.jsx(Y,{to:"/feed",className:"title",style:{textDecoration:"none",color:"inherit"},children:"mappi"})}function cs({isEditor:t}){return ye(),t?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Y,{to:"/",className:"icon-link",title:"Home","aria-label":"Home",style:{width:"auto",height:"auto",padding:"4px"},children:e.jsx(ht,{size:18})}),e.jsx(Y,{to:"/feed",className:"title",children:"osu!editi.ng"})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:4},children:e.jsx(ds,{})})}function us({isNeutralPage:t}){const s=ye().pathname;return t&&s!=="/"?e.jsx("nav",{className:"nav-links","aria-label":"Primary",children:e.jsx(Y,{to:s==="/about"?"/":"/about",className:s==="/about"?"active":"",children:s==="/about"?"Home":"About"})}):e.jsxs("nav",{className:"nav-links","aria-label":"Primary",children:[e.jsx(Y,{to:"/feed",className:s==="/feed"||s.startsWith("/feed/")?"active":"",children:"Feed"}),e.jsx(Y,{to:"/discover",className:s==="/discover"?"active":"",children:"Discover"}),e.jsx(Y,{to:"/queues",className:s==="/queues"||s.startsWith("/queues/")?"active":"",children:"Queues"}),e.jsx(Y,{to:"/submissions",className:s==="/submissions"?"active":"",children:"Submissions"}),e.jsx(Y,{to:"/editor",className:s==="/editor"?"active":"",children:"Editor"})]})}function ms(t,n,s,o){const a=ke(),{notify:r}=be(),[p,y]=f.useState(new Set);return{parseQueueInvite:S=>{if(!S)return null;try{const b=JSON.parse(S);if((b==null?void 0:b.type)==="queue_invite"&&(b!=null&&b.queue_id))return b}catch{}return null},handleAcceptInvite:async(S,b)=>{if(!p.has(S.id)){y(k=>new Set(k).add(S.id));try{await $(q.moddi.queueAccept(String(b)),{method:"POST"}),r("Invitation accepted!",{variant:"success"}),s.mutate(S.id),o(!1),a(`/md/queues/${b}`)}catch(k){r((k==null?void 0:k.message)||"Failed to accept invitation",{variant:"error"})}finally{y(k=>{const g=new Set(k);return g.delete(S.id),g})}}},handleDenyInvite:async(S,b)=>{if(!p.has(S.id)){y(k=>new Set(k).add(S.id));try{await $(q.moddi.queueDeny(String(b)),{method:"POST"}),r("Invitation declined",{variant:"success"}),s.mutate(S.id)}catch(k){r((k==null?void 0:k.message)||"Failed to decline invitation",{variant:"error"})}finally{y(k=>{const g=new Set(k);return g.delete(S.id),g})}}},handleMarkAllRead:async()=>{const S=t.filter(b=>b.id.startsWith("n:")||b.kind==="system"&&!b.read).map(b=>b.id);S.length>0&&n.mutate(S)},handleNotificationClick:async S=>{o(!1),n.mutate([S.id]);const b=typeof S.targetPath=="string"&&S.targetPath.trim().length>0?S.targetPath:null;if(b&&a(b),S.kind==="system"||S.id.startsWith("n:"))try{await $(q.user.markNotificationsRead,{method:"POST",body:JSON.stringify({ids:[S.id]})})}catch{}},handleDeleteNotification:async(S,b)=>{S.stopPropagation(),s.mutate(b)},processing:p}}function ps({notifications:t,unreadCount:n,notifOpen:s,setNotifOpen:o,markReadMutation:a,deleteNotificationMutation:r,closeAllPanels:p}){const y=f.useRef(null),c=f.useRef(null),{parseQueueInvite:h,handleAcceptInvite:u,handleDenyInvite:l,handleMarkAllRead:w,handleNotificationClick:E,handleDeleteNotification:S,processing:b}=ms(t,a,r,o);Xe(y,c,s,()=>o(!1));const k=t.filter(g=>!(g.kind==="system"&&g.id.startsWith("b:")&&(g.expiresAt||0)<=Date.now()));return e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:3},children:[e.jsx("button",{ref:y,className:"icon-link",onClick:()=>{s||p(),o(!s)},"aria-label":"Notifications",title:"Notifications",children:e.jsx(Je,{size:18})}),n>0&&e.jsx("span",{style:{position:"absolute",top:2,right:2,width:8,height:8,background:"#f87171",borderRadius:9999}}),s&&e.jsxs("div",{ref:c,className:"menu-panel notif-panel",role:"menu",children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",marginBottom:6},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:"Notifications"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(Y,{to:"/notifications",onClick:()=>o(!1),style:{fontSize:12,color:"var(--text)",textDecoration:"none",opacity:.7,transition:"opacity 0.15s ease"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.7",children:"View all"}),k.length>0&&e.jsx("button",{className:"icon-link",title:"Mark all read","aria-label":"Mark all read",onClick:w,children:e.jsx(_e,{size:16})})]})]}),e.jsxs("div",{className:"notif-list",children:[k.length===0&&e.jsx("div",{className:"muted",style:{fontSize:12,padding:"6px 2px"},children:"No notifications.. :("}),k.map(g=>{const R=h(g.text),O=g.id.startsWith("b:"),x=R?"queue-invite":g.kind==="star"?"star":g.kind==="likes5"?"likes":g.kind==="comment"?"comment":g.kind==="inspiration"?"inspiration":g.kind==="reaction"?"reaction":O?"global":"system",Q=g.id.startsWith("n:");return e.jsxs("div",{className:`notif-item ${x}`,role:"button",onClick:()=>!R&&E(g),children:[e.jsxs("div",{className:`notif-icon ${Q?"deletable":""}`,"aria-hidden":"true",onClick:Q&&!R?W=>S(W,g.id):void 0,title:Q&&!R?"Remove":void 0,role:Q&&!R?"button":void 0,children:[e.jsx("span",{className:"swap-main",children:R?e.jsx(ft,{}):x==="star"?e.jsx(gt,{}):x==="likes"?e.jsx(xt,{}):x==="comment"?e.jsx(De,{}):x==="inspiration"?e.jsx(De,{}):x==="reaction"?e.jsx(bt,{}):x==="global"?e.jsx(vt,{}):null}),Q&&!R?e.jsx("span",{className:"swap-trash",children:e.jsx(yt,{})}):null]}),e.jsx("div",{className:"notif-body",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Queue Invitation"}),e.jsxs("div",{className:"notif-desc",children:[R.inviter_username," invited you to join queue: ",R.queue_name]}),b.has(g.id)?e.jsx("div",{className:"muted",style:{fontSize:11,marginTop:6},children:"Processing..."}):e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs("button",{className:"btn",onClick:W=>{W.stopPropagation(),u(g,R.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(_e,{size:12,style:{marginRight:4}}),"Accept"]}),e.jsxs("button",{className:"btn secondary",onClick:W=>{W.stopPropagation(),l(g,R.queue_id)},style:{fontSize:11,padding:"4px 8px",flex:1},children:[e.jsx(Te,{size:12,style:{marginRight:4}}),"Decline"]})]})]}):g.kind==="system"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:O?"Global":"System"}),e.jsx("div",{className:"notif-desc",children:e.jsx(we,{text:g.text||""})}),O&&g.expiresAt?e.jsxs("div",{className:"notif-exp",children:["Expires at: ",new Date(g.expiresAt).toLocaleString()]}):null]}):g.kind==="comment"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Comment"}),e.jsx("div",{className:"notif-desc",children:e.jsx(we,{text:g.text||"Someone commented on your post"})})]}):g.kind==="inspiration"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Inspiration"}),e.jsx("div",{className:"notif-desc",children:e.jsx(we,{text:g.text||"Someone is inspired by you!"})})]}):g.kind==="reaction"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:"Reaction"}),e.jsx("div",{className:"notif-desc",children:e.jsx(we,{text:g.text||"Someone raised their hand on your post!"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notif-title",children:g.kind==="star"?"Star":"Likes"}),e.jsx("div",{className:"notif-desc",children:g.kind==="star"?"One of your posts was starred!":"One of your posts reached 5 likes!"})]})})]},g.id)})]})]})]})}function hs({quota:t,nowTick:n}){if(!(t!=null&&t.blocked))return null;const s=Math.max(0,Math.floor((((t==null?void 0:t.reset_at)??0)*1e3-Date.now())/1e3)),o=Math.floor(s/3600),a=Math.floor(s%3600/60),r=s%60,p=c=>String(c).padStart(2,"0"),y=o>0?`${o}:${p(a)}:${p(r)}`:`${a}:${p(r)}`;return e.jsxs("div",{title:"Upload limit reached","aria-label":"Upload limit reached",style:{display:"inline-flex",alignItems:"center",gap:4,marginRight:8},children:[e.jsx(jt,{}),e.jsx("span",{className:"muted",style:{fontSize:12},children:y})]})}function fs({me:t,menuOpen:n,setMenuOpen:s,onLogout:o,closeAllPanels:a}){const r=f.useRef(null),p=f.useRef(null);return Xe(r,p,n,()=>s(!1)),e.jsxs(e.Fragment,{children:[e.jsxs("button",{ref:r,className:"icon-link",onClick:()=>{n||a(),s(!n)},title:t.username,"aria-label":"User menu","aria-expanded":n,style:{width:"auto",height:40,padding:"0 8px",display:"inline-flex",alignItems:"center",gap:6},children:[t.avatar_url&&e.jsx("img",{src:t.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}),e.jsx("span",{className:"muted",style:{display:"inline-block",verticalAlign:"middle"},children:t.username}),e.jsx(Ge,{size:14,style:{opacity:.8}})]}),n&&e.jsxs("div",{ref:p,className:"menu-panel",role:"menu",children:[e.jsx(Y,{to:"/profile",className:"menu-item",onClick:()=>s(!1),children:"Profile"}),e.jsx(Y,{to:"/settings",className:"menu-item",onClick:()=>s(!1),children:"Settings"}),((t==null?void 0:t.is_admin)||(t==null?void 0:t.is_mod))&&e.jsx(Y,{to:"/moderation",className:"menu-item",onClick:()=>s(!1),children:"Moderation"}),e.jsx("button",{className:"menu-item",type:"button",onClick:o,children:"Log out"})]})]})}function gs({isNeutralPage:t,isEditor:n}){const s=ye(),o=ke(),{data:a,isLoading:r}=ue(),{data:p}=qt(!!a),{data:y=[]}=Ut(!!a),c=Ye(),h=$t(),u=Ze(),l=Bt(),{menuOpen:w,notifOpen:E,setMenuOpen:S,setNotifOpen:b,closeAllPanels:k,previousLocation:g,lastSection:R}=pe(),O=s.pathname==="/settings",x=s.pathname==="/moderation",Q=s.pathname==="/profile"||s.pathname.startsWith("/profile/"),W=O||x||Q,d=()=>{o(g||"/feed")},[U,H]=j.useState(0);return j.useEffect(()=>{const T=setInterval(()=>H(A=>A+1),1e3);return()=>clearInterval(T)},[]),e.jsxs("header",{className:"top-nav",children:[W&&e.jsx("button",{onClick:d,className:"icon-link",title:"Go back","aria-label":"Go back",style:{width:"auto",height:"auto",padding:"4px",marginRight:4},children:e.jsx(Ie,{size:18})}),e.jsx(cs,{isEditor:n}),e.jsx("span",{className:"nav-divider","aria-hidden":"true"}),s.pathname==="/editor"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:e.jsx(Yt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(us,{isNeutralPage:t}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsx("a",{className:"icon-link",href:"https://discord.gg/3FZKUuumE2",target:"_blank",rel:"noreferrer",title:"Join Discord (opens in new tab)","aria-label":"Join Discord",style:{marginRight:3,transform:"translateY(2px)"},children:e.jsx(Nt,{size:18})}),a?e.jsxs("div",{className:"user-menu",children:[e.jsx(ps,{notifications:y,unreadCount:c,notifOpen:E,setNotifOpen:b,markReadMutation:u,deleteNotificationMutation:l,closeAllPanels:k}),e.jsx(hs,{quota:p,nowTick:U}),e.jsx(fs,{me:a,menuOpen:w,setMenuOpen:S,onLogout:()=>h.mutate(),closeAllPanels:k})]}):e.jsx("button",{className:"btn secondary",onClick:()=>{window.location.href=Ce+q.auth.login},disabled:r,children:r?"Checking…":"Login with osu!"})]})]})}function xs({title:t,onRefresh:n}){const{data:s}=ue(),o=ye(),a=ke(),{lastSection:r}=pe(),[p,y]=j.useState(!0),[c,h]=j.useState(0),[u,l]=j.useState(!1),w=j.useRef(!1),E=j.useRef(0),[S,b]=j.useState(!1),k=j.useRef(null),{data:g=[]}=Ot(),R=Ze(),{notify:O}=be();j.useEffect(()=>{const d=document.querySelector(".page");if(!d)return;let U=d.scrollTop,H=!1;const T=()=>{H||(H=!0,requestAnimationFrame(()=>{const A=d.scrollTop,M=A-U;A<=12||M<-12?y(!0):M>12&&y(!1),U=A,H=!1}))};return d.addEventListener("scroll",T,{passive:!0}),()=>d.removeEventListener("scroll",T)},[]),j.useEffect(()=>{const d=document.querySelector(".page");if(!d)return;const U=120,H=70,T=P=>{var v;u||(d.scrollTop<=0?(w.current=!0,E.current=((v=P.touches[0])==null?void 0:v.clientY)??0):w.current=!1)},A=P=>{var K;if(!w.current||u)return;const v=((K=P.touches[0])==null?void 0:K.clientY)??0,B=Math.max(0,v-E.current);if(B>0){const m=Math.min(U,B*.5);h(m)}},M=async()=>{try{if(l(!0),n)await n();else{window.location.reload();return}}finally{setTimeout(()=>{l(!1),h(0)},400)}},N=()=>{!w.current||u||(c>=H?M():h(0),w.current=!1)};return d.addEventListener("touchstart",T,{passive:!0}),d.addEventListener("touchmove",A,{passive:!0}),d.addEventListener("touchend",N),d.addEventListener("touchcancel",N),()=>{d.removeEventListener("touchstart",T),d.removeEventListener("touchmove",A),d.removeEventListener("touchend",N),d.removeEventListener("touchcancel",N)}},[c,u,n]);const{showBack:x,onBack:Q}=j.useMemo(()=>{const d=o.pathname;if(/^\/mp\/feed\/.+/.test(d))return{showBack:!0,onBack:()=>a("/mp/feed")};if(/^\/md\/feed\/.+/.test(d))return{showBack:!0,onBack:()=>a("/md/feed")};if(/^\/md\/queues\/.+/.test(d))return{showBack:!0,onBack:()=>a("/md/queues")};if(d==="/profile"||d.startsWith("/profile/")){const U=r==="moddi"?"/md/feed":"/mp/feed";return{showBack:!0,onBack:()=>{window.history.length>2?a(-1):a(U)}}}return{showBack:!1,onBack:()=>{}}},[o.pathname,a,r]),W=o.pathname==="/notifications";return e.jsxs("div",{className:`mobile-page-header ${p?"":"collapsed"}`,children:[e.jsxs("div",{className:`mobile-page-header-inner ${p?"show":"hide"}`,children:[e.jsx("div",{className:"mobile-page-header-left",children:x?e.jsx("button",{className:"icon-link",onClick:Q,"aria-label":"Back",title:"Back",style:{padding:4},children:e.jsx(Ie,{size:18})}):e.jsx(Y,{to:"/profile",className:"icon-link","aria-label":"Profile",children:s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,width:22,height:22,style:{borderRadius:"50%"}}):e.jsx("span",{style:{display:"inline-block",width:22,height:22,borderRadius:"50%",background:"var(--hover-overlay-strong)"}})})}),t?e.jsx("div",{className:"mobile-page-header-title",children:t}):null,e.jsx("div",{className:"mobile-page-header-right",children:W?e.jsx("button",{className:"icon-link","aria-label":"Mark all read",title:"Mark all read",style:{padding:4},onClick:()=>{const d=g.filter(U=>!U.read&&(U.id.startsWith("n:")||U.kind==="system"&&!U.id.startsWith("b:"))).map(U=>U.id);d.length!==0&&R.mutate(d,{onSuccess:()=>{O("All notifications marked as read",{variant:"success"})}})},children:e.jsx(_e,{size:18})}):(()=>{const d=o.pathname;let U=null;return d==="/mp/feed"?U="mappi-feed":d==="/md/feed"?U="moddi-feed":d==="/md/queues"?U="moddi-queues":d.startsWith("/md/queues/")&&(U="moddi-queue-detail"),U?e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{ref:k,className:"icon-link","aria-haspopup":"dialog","aria-expanded":S,onClick:()=>b(H=>!H),"aria-label":"Filters",title:"Filters",style:{padding:4},children:e.jsx(wt,{size:18})}),S&&e.jsx("div",{style:{position:"absolute",right:0,top:32},children:e.jsx(Ht,{context:U,onClose:()=>b(!1)})})]}):null})()})]}),e.jsx("div",{className:"mobile-ptr-indicator","aria-hidden":"true",style:{opacity:u||c>4?1:0,transform:`translate(-50%, calc(-100% + ${Math.min(c,70)}px))`},children:e.jsx("div",{className:`mobile-ptr-spinner ${u?"spin":c>60?"ready":""}`})})]})}function bs({readyCount:t}){return t===null?null:e.jsx("div",{className:"site-badge","aria-hidden":!1,children:e.jsxs("div",{className:"label",children:[t," videos ready"]})})}function vs(){const t=ye(),{notify:n}=be(),{data:s}=ue(),{setPreviousLocation:o}=pe(),a=t.pathname,r=a==="/"||a==="/about",p=a==="/editor";j.useEffect(()=>{a==="/settings"||a==="/moderation"||a==="/profile"||a.startsWith("/profile/")||o(a)},[a,o]);const[y,c]=j.useState(null);j.useEffect(()=>{!s||!s.is_mod||(async()=>{try{const l=await $(q.admin.debugState,{requireAuth:!1}),w=Array.isArray(l==null?void 0:l.counts)?l.counts.find(E=>String(E.status)==="ready"):null;w&&c(Number(w.c)||0)}catch{}})()},[s]),j.useEffect(()=>{s&&!localStorage.getItem("welcomed")&&(n(`Welcome, ${s.username}!`,{durationMs:1e4,variant:"success"}),localStorage.setItem("welcomed","1"))},[s,n]),j.useEffect(()=>{if(typeof window>"u"||!ce()||a==="/editor")return;const w=document.querySelector(".page");w&&(w.scrollTop=0)},[a]);const{showMobileHeader:h,headerTitle:u}=j.useMemo(()=>{if(a==="/"||a==="/about"||a==="/editor"||a==="/discover"||a==="/mobile")return{showMobileHeader:!1,headerTitle:""};if(a==="/feed"||a.startsWith("/feed/"))return{showMobileHeader:!0,headerTitle:a==="/feed"?"Feed":"Post"};if(a==="/queues"||a.startsWith("/queues/"))return{showMobileHeader:!0,headerTitle:a==="/queues"?"Queues":"Queue"};if(a==="/submissions")return{showMobileHeader:!0,headerTitle:"Submissions"};if(a==="/notifications")return{showMobileHeader:!0,headerTitle:"Notifications"};if(a==="/profile"||a.startsWith("/profile/"))return{showMobileHeader:!0,headerTitle:"Profile"};if(a==="/settings")return{showMobileHeader:!0,headerTitle:"Settings"};if(a==="/moderation")return{showMobileHeader:!0,headerTitle:"Moderation"};if(a.startsWith("/mp/")||a.startsWith("/md/")){const l=a.split("/").filter(Boolean),w=l[1]||"";if(w==="feed")return{showMobileHeader:!0,headerTitle:l.length>2?"Post":"Feed"};if(w==="discover")return{showMobileHeader:!1,headerTitle:""};if(w==="queues")return{showMobileHeader:!0,headerTitle:l.length>2?"Queue":"Queues"}}return{showMobileHeader:!0,headerTitle:""}},[a]);return e.jsxs("div",{className:"app-shell",children:[e.jsx(os,{paused:a==="/editor"}),e.jsx(gs,{isNeutralPage:r,isEditor:p}),e.jsxs("main",{className:`page ${a==="/editor"||a==="/discover"?"fullscreen":""}`,children:[h&&e.jsx(xs,{title:u}),a==="/about"?e.jsx("div",{className:"card",children:e.jsx(qe,{})}):e.jsx(qe,{})]}),a!=="/editor"&&e.jsx(e.Fragment,{children:e.jsx(bs,{readyCount:y})}),a!=="/mobile"&&e.jsx(ls,{})]})}const ys="theme";function js(){try{const t=localStorage.getItem(ys);if(t==="light"||t==="dark")return t}catch{}return null}function it(t){if(!(typeof document>"u")){document.documentElement.setAttribute("data-theme",t);try{const n=document.querySelector('meta[name="theme-color"]');n&&(n.content=t==="light"?"#ffffff":"#1a1a1a")}catch{}}}function Ns(t="dark"){const n=js()||t;it(n)}function ws(){const{data:t,isLoading:n}=ue(),s=!!t,o=ke(),{lastSection:a}=pe(),[r,p]=j.useState(!1);return j.useEffect(()=>{if(typeof window>"u")return;const y=localStorage.getItem("hide_mobile_install_prompt")==="1",c=ce()&&!Pe()&&!y;p(c)},[]),j.useEffect(()=>{Pe()?o("/feed",{replace:!0}):s&&o("/feed",{replace:!0})},[o,s]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .landing-container {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 80px 24px 24px;
          overflow-y: auto;
          z-index: 1;
        }
        
        .landing-hero {
          text-align: center;
          max-width: 900px;
          width: 100%;
          animation: fadeInUp 0.8s ease-out;
        }
        
        .landing-title {
          font-size: clamp(48px, 8vw, 96px);
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 24px;
          background: linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #34d399 100%);
          background-size: 200% 200%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: shimmer 3s ease-in-out infinite, fadeInUp 0.8s ease-out 0.2s both;
          letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
          font-size: clamp(18px, 2.5vw, 28px);
          color: var(--muted);
          margin: 0 0 64px;
          font-weight: 400;
          animation: fadeInUp 0.8s ease-out 0.4s both;
          opacity: 0.9;
        }
        
        .landing-actions {
          display: flex;
          gap: 24px;
          justify-content: center;
          flex-wrap: wrap;
          animation: fadeInUp 0.8s ease-out 0.6s both;
        }
        
        .landing-btn {
          padding: 20px 32px;
          font-size: 20px;
          font-weight: 700;
          text-decoration: none;
          border-radius: 10px;
          transition: background 0.2s ease, border-color 0.2s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          min-width: 180px;
          border: 1px solid transparent;
          cursor: pointer;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          font-smooth: always;
        }
        
        .landing-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        
        .landing-btn-primary {
          background: #ffffff;
          color: #0b0d10;
          border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .landing-btn-primary:hover {
          background: linear-gradient(90deg, rgba(255,255,255,1), rgba(248,249,255,0.98));
          border-color: rgba(0, 0, 0, 0.18);
        }
        
        .landing-btn-secondary {
          background: var(--panel);
          color: var(--text);
          border: 1px solid var(--border);
        }
        
        .landing-btn-secondary:hover {
          background: linear-gradient(90deg, rgba(125,211,252,0.14), rgba(167,139,250,0.16));
          border-color: var(--border-strong);
        }
        
        .landing-glow {
          position: absolute;
          width: 600px;
          height: 600px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(125, 211, 252, 0.15) 0%, transparent 70%);
          pointer-events: none;
          animation: pulse 4s ease-in-out infinite;
          z-index: -1;
        }
        
        .landing-glow-1 {
          top: 10%;
          left: 10%;
          animation-delay: 0s;
        }
        
        .landing-glow-2 {
          bottom: 10%;
          right: 10%;
          background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
          animation-delay: 2s;
        }
        
        .landing-subtitle-desktop {
          display: block;
        }
        
        .landing-subtitle-mobile {
          display: none;
        }
        
        .landing-actions-desktop {
          display: flex;
        }
        
        .landing-actions-mobile {
          display: none;
        }
        
        @media (max-width: 768px) {
          .landing-container {
            padding: 60px 16px 16px;
          }
          
          .landing-actions {
            flex-direction: column;
            width: 100%;
          }
          
          .landing-btn {
            width: 100%;
            min-width: unset;
            padding: 18px 24px;
            font-size: 18px;
          }
          
          .landing-subtitle-desktop {
            display: none;
          }
          
          .landing-subtitle-mobile {
            display: block;
          }
          
          .landing-actions-desktop {
            display: none;
          }
          
          .landing-actions-mobile {
            display: flex;
          }
        }
      `}),e.jsxs("div",{className:"landing-container",children:[e.jsx("div",{className:"landing-glow landing-glow-1"}),e.jsx("div",{className:"landing-glow landing-glow-2"}),e.jsxs("div",{className:"landing-hero",children:[e.jsx("h1",{className:"landing-title",children:"mappi!"}),e.jsx("p",{className:"landing-subtitle landing-subtitle-desktop",children:"Navigate to.."}),!s&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"You have to be logged in to use the site."}),s&&e.jsx("p",{className:"landing-subtitle landing-subtitle-mobile",children:"Navigate to.."}),e.jsx("div",{className:"landing-actions landing-actions-desktop",children:e.jsx(Y,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})}),!s&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx("button",{className:"landing-btn landing-btn-primary",onClick:()=>{window.location.href=Ce+q.auth.login},disabled:n,children:n?"Checking…":"Login with osu!"})}),s&&e.jsx("div",{className:"landing-actions landing-actions-mobile",children:e.jsx(Y,{to:"/feed",className:"landing-btn landing-btn-primary",children:"Enter"})})]})]}),r&&e.jsxs("div",{className:"mobile-install-prompt",role:"dialog","aria-live":"polite",style:{position:"fixed",left:12,right:12,bottom:12,zIndex:50,display:"flex",alignItems:"center",gap:12,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px"},children:[e.jsx("div",{style:{fontSize:14,lineHeight:1.3},children:"Install osumapp.ing to your home screen"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{className:"btn secondary",onClick:()=>{p(!1);try{localStorage.setItem("hide_mobile_install_prompt","1")}catch{}},"aria-label":"Dismiss",title:"Dismiss",children:"Dismiss"}),e.jsx(Y,{to:"/mobile",className:"btn","aria-label":"How to install",children:"Install"})]})]})]})}function Be(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}const ks=({open:t,onClose:n,videoId:s,initialDescription:o,initialBeatmapUrl:a,onSave:r})=>{const[p,y]=f.useState(o||""),[c,h]=f.useState(a||""),[u,l]=f.useState(null),[w,E]=f.useState(null),[S,b]=f.useState(""),[k,g]=f.useState(!1),R=f.useRef(0);f.useEffect(()=>{t&&(y(o||""),h(a||""),l(null),E(null),b(""))},[t,o,a]),f.useEffect(()=>{if(!t)return;R.current&&window.clearTimeout(R.current);const x=(c||"").trim();if(!x){b(""),l(null),E(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(x)){b(""),l(null),E(null);return}return R.current=window.setTimeout(async()=>{var W;try{let d;try{d=new URL(x)}catch{b("Invalid URL format");return}const U=d.hash.match(/#osu\/(\d+)/),H=U?U[1]:null;d.hash="";const A={url:d.toString()};H&&(A.beatmap_id=H);const M=await $(q.osu.resolveBeatmap+xe(A),{requireAuth:!1}),N=Array.isArray(M==null?void 0:M.diffs)?M.diffs:[];if(!N.length&&!M.setId){b("No difficulties found"),l(null),E(null);return}if(l({setId:Number(M.setId)||0,beatmapId:M.beatmapId??null,title:String(M.title||""),artist:String(M.artist||""),mapper:String(M.mapper||""),diffs:N}),N.length>0){const P=Number.isFinite(Number(M.beatmapId))?Number(M.beatmapId):Number((W=N[0])==null?void 0:W.id),v=N.find(K=>Number(K.id)===P)||N[0],B=Be(v==null?void 0:v.mode);E({beatmapId:Number(v==null?void 0:v.id)||null,version:String((v==null?void 0:v.version)||""),mode:B})}b("")}catch(d){b(`Failed to resolve: ${(d==null?void 0:d.message)||"Unknown error"}`),l(null),E(null)}},400),()=>{R.current&&window.clearTimeout(R.current)}},[c,t]);const O=async()=>{if(!k){g(!0);try{await $(q.videos.update(s),{method:"PATCH",body:JSON.stringify({description:p.slice(0,100),beatmap_url:c.trim()||void 0})});const x=!!c.trim();if(u||!x)try{await $(q.videos.update(s)+"/beatmap",{method:"PATCH",body:JSON.stringify({beatmapset_id:x&&u&&u.setId>0?u.setId:null,beatmap_id:x&&(w!=null&&w.beatmapId)?w.beatmapId:null,beatmap_version:x&&(w!=null&&w.version)?w.version:null,beatmap_title:x&&(u!=null&&u.title)?u.title:null,beatmap_artist:x&&(u!=null&&u.artist)?u.artist:null,beatmap_mapper:x&&(u!=null&&u.mapper)?u.mapper:null,beatmap_url:x?c.trim():null})})}catch(W){console.warn("Failed to update beatmap metadata:",W)}r(p,c.trim()||null),n()}catch(x){alert((x==null?void 0:x.message)||"Failed to update post")}finally{g(!1)}}};return t?e.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:x=>x.target===x.currentTarget&&n(),children:[e.jsx("div",{className:"overlay-backdrop",onClick:n}),e.jsxs("div",{className:"overlay-card",style:{maxWidth:"600px",width:"calc(100vw - 24px)"},children:[e.jsx("button",{className:"overlay-close",onClick:n,"aria-label":"Close",children:e.jsx(Te,{size:18})}),e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsx("div",{className:"title",children:"Edit Post"}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Description (max 100 chars)"}),e.jsx("textarea",{maxLength:100,placeholder:"Description (max 100 chars)",value:p,onChange:x=>y(x.target.value),style:{height:64,resize:"vertical",background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}})]}),e.jsxs("div",{className:"col",style:{gap:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"Beatmap URL (optional)"}),u?e.jsx("div",{className:"col",style:{gap:8},children:e.jsxs("div",{className:"row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{className:"chip-btn",style:{cursor:"default"},children:[e.jsxs("strong",{style:{marginRight:6},children:[u.artist," – ",u.title]}),e.jsxs("span",{className:"muted",children:["by ",u.mapper]})]}),e.jsx("select",{value:(w==null?void 0:w.beatmapId)??u.beatmapId??void 0,onChange:x=>{const Q=Number(x.target.value),W=(u==null?void 0:u.diffs.find(d=>Number(d.id)===Q))||null;if(W){const d=Be(W.mode);E({beatmapId:Q,version:W.version,mode:d})}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"},children:u.diffs.map(x=>e.jsxs("option",{value:x.id,children:[x.version," (",x.mode,")"]},x.id))}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{l(null),E(null),h("")},children:"Clear"})]})}):e.jsx("input",{type:"url",placeholder:"Beatmap URL (optional) e.g. https://osu.ppy.sh/beatmapsets/...",value:c,onChange:x=>h(x.target.value),style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px"}}),S&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:12},children:S})]}),e.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn secondary",onClick:n,disabled:k,children:"Cancel"}),e.jsx("button",{className:"btn",onClick:O,disabled:k,children:k?"Saving...":"Save"})]})]})]})]}):null};function Oe(){const t=kt(),n=ke(),{notify:s}=be(),[o,a]=f.useState(null),[r,p]=f.useState(null),[y,c]=f.useState(""),[h,u]=f.useState([]),[l,w]=f.useState([]),[E,S]=f.useState([]),[b,k]=f.useState(""),[g,R]=f.useState(null),[O,x]=f.useState([]),[Q,W]=f.useState(null),[d,U]=f.useState(""),[H,T]=f.useState([]),[A,M]=f.useState(null),[N,P]=f.useState(!1),v=f.useMemo(()=>{const m=t.id?Number(t.id):null;return m?o?o.id===m:!1:!0},[t.id,o]);function B(m){const D=m.stream_uid||String(m.id),F=t.id?`/profile/${t.id}`:"/profile";n(`/mp/feed/${D}`,{state:{returnTo:F}})}f.useEffect(()=>{(async()=>{try{const m=await $(q.auth.me,{requireAuth:!1});a(m),m&&Array.isArray(m.inspirations)&&x(m.inspirations)}catch(m){c((m==null?void 0:m.message)||"Not logged in")}})()},[]),f.useEffect(()=>{(async()=>{try{const m=t.id?Number(t.id):null;if(m){const D=await $(q.users.get(m),{requireAuth:!1});p(D),k(D.about||""),Array.isArray(D.inspirations)&&x(D.inspirations);const F=await $(q.users.videos(m)+xe({limit:"60"}),{requireAuth:!1});S(F.items||[]);const X=await $(q.users.likes(m)+xe({limit:"60"}),{requireAuth:!1});w(X.items||[])}else{if(!o)return;p(o),k(o.about||""),Array.isArray(o.inspirations)&&x(o.inspirations);const D=await $(q.users.myVideos+xe({limit:"50"}),{requireAuth:!1});u(D.items||[]);const F=await $(q.users.likes(o.id)+xe({limit:"60"}),{requireAuth:!1});w(F.items||[])}}catch{}})()},[t.id,o]),f.useEffect(()=>{P(!1)},[r==null?void 0:r.id]);async function K(m){try{const F=(await $(q.auth.me,{method:"PATCH",body:JSON.stringify({inspirations:m})})).user||r;p(F),Array.isArray(F==null?void 0:F.inspirations)&&x(F.inspirations),t.id||a(F)}catch{}}return f.useEffect(()=>{let m;return Q!==null&&d.trim().length>=2?m=setTimeout(async()=>{try{const D=await $(q.osu.usersSearch(d),{requireAuth:!1});T(Array.isArray(D.items)?D.items:[])}catch{}},250):T([]),()=>{m&&clearTimeout(m)}},[d,Q]),e.jsxs("div",{className:"feed-container profile-page",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"row wrap",style:{alignItems:"center"},children:r?e.jsxs(e.Fragment,{children:[r.avatar_url&&e.jsx("img",{src:r.avatar_url,width:48,height:48,style:{borderRadius:"50%"}}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",gap:8},children:[r.username,r.osu_user_id&&e.jsx("a",{href:`https://osu.ppy.sh/users/${r.osu_user_id}`,target:"_blank",rel:"noreferrer",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"var(--text)",opacity:.7,cursor:"pointer",padding:0,textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:m=>m.currentTarget.style.opacity="1",onMouseLeave:m=>m.currentTarget.style.opacity="0.7",title:"View osu! profile","aria-label":"View osu! profile",children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"muted",children:["ID: ",r.id]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[!v&&O.length>0&&e.jsx("span",{className:"muted",style:{fontSize:12},children:"inspired by:"}),O.map((m,D)=>v?e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>M(m.id),onMouseLeave:()=>M(null),children:[e.jsx("button",{className:"insp-avatar",onClick:()=>{if(!confirm("Remove this inspiration?"))return;const F=O.filter((X,re)=>re!==D);x(F),K(F)},children:e.jsx("img",{src:m.avatar_url,alt:m.username})}),A===m.id&&e.jsxs("div",{className:"insp-tooltip",children:[m.username," — click to remove"]})]},m.id):e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>M(m.id),onMouseLeave:()=>M(null),children:[e.jsx("a",{href:`https://osu.ppy.sh/users/${m.id}`,target:"_blank",rel:"noreferrer",className:"insp-avatar link",children:e.jsx("img",{src:m.avatar_url,alt:m.username})}),A===m.id&&e.jsx("div",{className:"insp-tooltip",children:m.username})]},m.id)),v&&O.length<3&&new Array(3-O.length).fill(0).map((m,D)=>e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>M(-D-1),onMouseLeave:()=>M(null),children:[e.jsx("button",{className:"insp-add",onClick:()=>{W(D),U(""),T([])},children:"+"}),A===-D-1&&e.jsx("div",{className:"insp-tooltip",children:"Add inspiration"}),Q===D&&e.jsxs("div",{className:"insp-pop",role:"dialog","aria-label":"Search osu! users",children:[e.jsx("input",{autoFocus:!0,placeholder:"Search username",value:d,onChange:F=>U(F.target.value)}),e.jsxs("div",{className:"insp-results",children:[H.length===0&&d.trim().length>=2&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:"No results"}),H.map(F=>e.jsxs("button",{className:"insp-result",onClick:()=>{if(o&&Number(o.osu_user_id)===Number(F.id)){s("Kinda based, but no.",{variant:"warn"}),W(null);return}if(O.some(re=>re.id===F.id)){W(null);return}const X=[...O,{id:F.id,username:F.username,avatar_url:F.avatar_url}].slice(0,3);x(X),W(null),K(X)},children:[e.jsx("img",{src:F.avatar_url,alt:"avatar"}),e.jsx("span",{children:F.username})]},F.id))]}),e.jsx("button",{className:"insp-close",onClick:()=>W(null),children:"Close"})]})]},`slot-${D}`))]}),v&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Who inspires you?"})]})]}):e.jsx("div",{className:"muted",children:y||"Loading…"})}),e.jsxs("div",{className:"col",style:{marginTop:12,gap:4},children:[e.jsx("div",{className:"title",children:"About"}),v?e.jsx("div",{className:"col",style:{gap:6},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{value:b,onChange:m=>k(m.target.value),rows:3,maxLength:1e3,placeholder:"Write something about yourself (max 1000 chars)",style:{paddingRight:36}}),e.jsx("button",{className:"icon-link",onClick:async()=>{try{const m=await $(q.auth.me,{method:"PATCH",body:JSON.stringify({about:b})});p(m.user||r),a(m.user||o)}catch{}},"aria-label":"Save about",title:"Save",style:{position:"absolute",right:8,bottom:8,padding:4,color:"rgba(255,255,255,0.55)"},children:e.jsx(_e,{size:16})})]})}):(()=>{const m=((r==null?void 0:r.about)||"").trim()||"No bio.",D=m.length>200,F=D&&!N?m.slice(0,200)+"...":m;return e.jsxs("div",{className:"col",style:{gap:4},children:[e.jsx("div",{className:"muted",style:{whiteSpace:"pre-wrap"},children:F}),D&&e.jsx("button",{onClick:()=>P(!N),style:{display:"flex",alignItems:"center",gap:4,background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:0,fontSize:14,fontFamily:"inherit",marginTop:4},children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show less"}),e.jsx(_t,{size:14})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Show more"}),e.jsx(Ge,{size:14})]})})]})})()]})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Profile sections",children:[e.jsx("button",{role:"tab","aria-selected":!0,className:"profile-tab active","data-tab":"uploads",onClick:m=>{const D=m.currentTarget.closest(".profile-tabs-unified");D.querySelectorAll(".profile-tab").forEach(X=>{X.classList.remove("active"),X.setAttribute("aria-selected","false")}),m.currentTarget.classList.add("active"),m.currentTarget.setAttribute("aria-selected","true"),D.querySelector(".profile-tabs-content").setAttribute("data-active","uploads")},children:"Uploads"}),e.jsx("button",{role:"tab","aria-selected":!1,className:"profile-tab","data-tab":"likes",onClick:m=>{const D=m.currentTarget.closest(".profile-tabs-unified");D.querySelectorAll(".profile-tab").forEach(X=>{X.classList.remove("active"),X.setAttribute("aria-selected","false")}),m.currentTarget.classList.add("active"),m.currentTarget.setAttribute("aria-selected","true"),D.querySelector(".profile-tabs-content").setAttribute("data-active","likes")},children:"Likes"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":"uploads",children:[e.jsx("div",{className:"panel uploads",hidden:!1,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[(v?h:E).length===0&&e.jsx("div",{className:"profile-empty-state",children:"No uploads yet."}),(v?h:E).map(m=>(v&&r?(r.id,r.username,r.avatar_url,r.is_admin,r.is_mod):m.uploader,e.jsxs("button",{className:"recent-cell",onClick:()=>B({...m}),children:[m.poster_url?e.jsx("img",{className:"recent-thumb",src:m.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsx("div",{className:"cell-footer",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Tt,{size:12}),e.jsx("span",{children:m.likes_count??0})]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ct,{size:12}),e.jsx("span",{children:m.comments_count??0})]})]})})]},m.id)))]})})}),e.jsx("div",{className:"panel likes",hidden:!0,children:e.jsx("div",{className:"profile-grid-container",children:e.jsxs("div",{className:"recent-grid cols3",children:[l.length===0&&e.jsx("div",{className:"profile-empty-state",children:"No likes yet."}),l.map(m=>{var D,F;return e.jsxs("button",{className:"recent-cell",onClick:()=>B(m),children:[m.poster_url?e.jsx("img",{className:"recent-thumb",src:m.poster_url,alt:"thumb"}):e.jsx("div",{className:"thumb-fallback"}),e.jsxs("div",{className:"cell-footer",children:[((D=m.uploader)==null?void 0:D.avatar_url)&&e.jsx("img",{className:"cell-avatar",src:m.uploader.avatar_url,alt:"avatar"}),e.jsx("span",{className:"cell-name",children:(F=m.uploader)==null?void 0:F.username})]})]},m.id)})]})})})]})]}),g&&e.jsx(ks,{open:!!g,onClose:()=>R(null),videoId:g.id,initialDescription:g.description,initialBeatmapUrl:g.beatmap_url,onSave:(m,D)=>{u(h.map(F=>F.id===g.id?{...F,description:m||null,beatmap_url:D}:F)),R(null)}}),e.jsx("style",{children:`
        .insp-avatar { width: 32px; height: 32px; border-radius: 9999px; padding: 0; border: none; overflow: hidden; cursor: pointer; background: var(--hover-overlay); display: inline-flex; align-items: center; justify-content: center; }
        .insp-avatar.link { background: transparent; border: 1px solid var(--divider); }
        .insp-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .insp-add { width: 32px; height: 32px; border-radius: 9999px; border: 1px dashed var(--divider); background: transparent; color: var(--text); font-weight: 700; cursor: pointer; }
        .insp-add:hover { border-color: var(--border-strong); }
        .insp-tooltip {
          position: absolute;
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
          background: rgba(18, 20, 24, 0.95);
          color: var(--text, #e5e7eb);
          border: 1px solid var(--divider);
          border-radius: 6px;
          padding: 6px 10px;
          font-size: 14px;
          white-space: nowrap;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Torus Pro', Torus, ui-sans-serif, system-ui, sans-serif;
        }
        .insp-tooltip::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 5px solid rgba(18, 20, 24, 0.95);
        }
        .insp-pop { position: absolute; right: 0; top: 40px; width: 260px; background: var(--panel); border: 1px solid var(--divider); border-radius: 10px; padding: 8px; z-index: 10; }
        .insp-pop input { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--divider); background: var(--panel-dark); color: var(--text); outline: none; box-sizing: border-box; display: block; }
        .insp-results { margin-top: 6px; max-height: 220px; overflow: auto; display: grid; gap: 4px; }
        .insp-result { display: grid; grid-template-columns: 24px 1fr; gap: 8px; align-items: center; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; background: transparent; color: var(--text); cursor: pointer; text-align: left; }
        .insp-result:hover { background: var(--hover-overlay); border-color: var(--divider); }
        .insp-result img { width: 24px; height: 24px; border-radius: 9999px; object-fit: cover; }
        .insp-close { margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--divider); background: var(--hover-overlay); color: var(--text); cursor: pointer; }
      `})]})}function Ss(){var D,F,X,re,G,se,te,he,fe,je;const[t,n]=f.useState(null),[s,o]=f.useState([]),[a,r]=f.useState(""),[p,y]=f.useState([]),[c,h]=f.useState(null),[u,l]=f.useState([]),[w,E]=f.useState("all"),[S,b]=f.useState("approvals"),[k,g]=f.useState(null),[R,O]=f.useState(""),[x,Q]=f.useState(!1),{notify:W}=be(),[d,U]=f.useState(null),[H,T]=f.useState(!1);f.useEffect(()=>{(async()=>{try{const i=await $(q.auth.me,{requireAuth:!1});if(n(i),i!=null&&i.is_admin)try{const I=await $(q.admin.settingsModeration,{requireAuth:!1});g(!!I.require_approval)}catch{}}catch{}try{const i=await $(q.admin.videosPending+xe({limit:"50"}),{requireAuth:!1});o(i.items||[])}catch{}})()},[]);async function A(){T(!0);try{const i=await $(q.admin.analytics,{requireAuth:!1});U(i)}finally{T(!1)}}async function M(){try{const i=await $(q.admin.usersSearch(a),{requireAuth:!1});y(i.items||[])}catch{}}async function N(i){h(i),l([]);try{const I=await $(q.admin.userVideos(i.id)+xe({limit:"50"}),{requireAuth:!1});l(I.items||[])}catch{}}async function P(i,I){try{const ae=await $(q.admin.userUpdate(i.id),{method:"PATCH",body:JSON.stringify({is_mod:I})}),ee=(ae==null?void 0:ae.user)||{...i,is_mod:I};W(I?"Granted moderation":"Revoked moderation",{variant:I?"success":"warn"}),h(ee),y(p.map(ve=>ve.id===i.id?ee:ve))}catch{alert("Failed to update")}}const v=!!(t!=null&&t.is_admin||t!=null&&t.is_mod),B=!!(t!=null&&t.is_admin);if(!v)return e.jsx("div",{className:"muted",style:{padding:20},children:"You do not have access."});const K=s.filter(i=>!i.flagged_only),m=s.filter(i=>!!i.flagged_only);return e.jsxs("div",{className:"moderation-container",children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Moderation"}),e.jsx("div",{className:"moderation-description",children:"Review approvals, manage users, and monitor moderation metrics from one place."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Moderation tabs",style:{display:"flex",flexWrap:ce()?"nowrap":"wrap",gap:ce()?"2px":"4px",overflowX:ce()?"auto":void 0},children:[e.jsx("button",{role:"tab","aria-selected":S==="approvals",className:`profile-tab ${S==="approvals"?"active":""}`,"data-tab":"approvals",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","approvals"),b("approvals")},children:"Approvals"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":S==="manage",className:`profile-tab ${S==="manage"?"active":""}`,"data-tab":"manage",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","manage"),b("manage")},children:"Manage"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":S==="analytics",className:`profile-tab ${S==="analytics"?"active":""}`,"data-tab":"analytics",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","analytics"),b("analytics"),d||A()},children:"Analytics"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{role:"tab","aria-selected":S==="message",className:`profile-tab ${S==="message"?"active":""}`,"data-tab":"message",onClick:i=>{const I=i.currentTarget.closest(".profile-tabs-unified");I.querySelectorAll(".profile-tab").forEach(ee=>{ee.classList.remove("active"),ee.setAttribute("aria-selected","false")}),i.currentTarget.classList.add("active"),i.currentTarget.setAttribute("aria-selected","true"),I.querySelector(".profile-tabs-content").setAttribute("data-active","message"),b("message")},children:"Message"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":S,children:[e.jsx("div",{className:"panel approvals",hidden:S!=="approvals",children:e.jsxs("div",{className:"moderation-grid",style:{paddingTop:16},children:[e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Pending approvals"}),e.jsx("div",{className:"moderation-column-count",children:K.length})]}),K.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Nothing pending."}),K.map(i=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:e.jsx(we,{text:i.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.username}),i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(needs review)"}):e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(q.admin.videosReject(i.id),{method:"POST"}),o(s.filter(I=>I.id!==i.id)),W("Rejected",{variant:"warn"})}catch{}},children:"Reject"}),e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await $(q.admin.videosApprove(i.id),{method:"POST"}),o(s.filter(I=>I.id!==i.id)),W("Approved",{variant:"success"})}catch{}},children:"Approve"}),e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(q.videos.delete(i.id),{method:"DELETE"}),o(s.filter(I=>I.id!==i.id)),W("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))]}),e.jsxs("div",{className:"moderation-column",children:[e.jsxs("div",{className:"moderation-column-header",children:[e.jsx("div",{className:"moderation-column-title",children:"Flagged (FYI)"}),e.jsx("div",{className:"moderation-column-count",children:m.length})]}),m.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No flagged items."}),m.map(i=>e.jsxs("div",{className:"moderation-video-card flagged",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:e.jsx(we,{text:i.description||"No description."})}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.username}),e.jsx("span",{style:{color:"#9ca3af"},children:"(flagged)"}),typeof i.flags_count=="number"&&i.flags_count>0?e.jsxs("span",{className:"muted",children:["• ",i.flags_count," reports"]}):null]})]})]}),e.jsx("div",{className:"mod-card-actions",children:e.jsx("button",{className:"btn secondary compact",style:{width:"100%"},onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(q.videos.delete(i.id),{method:"DELETE"}),o(s.filter(I=>I.id!==i.id)),W("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})})]},i.id)),m.length>0&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,padding:"0 4px"},children:"Flagged items don't require approval; use Delete only if necessary."})]})]})}),e.jsx("div",{className:"panel manage",hidden:S!=="manage",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"User management"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:a,onChange:i=>r(i.target.value),onKeyDown:i=>{i.key==="Enter"&&M()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:M,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"40vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:p.map(i=>e.jsxs("button",{className:`moderation-user-result ${(c==null?void 0:c.id)===i.id?"selected":""}`,onClick:()=>N(i),children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),i.is_admin?e.jsx("span",{className:"chip info",children:"admin"}):i.is_mod?e.jsx("span",{className:"chip success",children:"mod"}):i.is_blacklisted?e.jsx("span",{className:"chip error",children:"blacklisted"}):null]},i.id))})})]}),c?e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:24},children:[e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[c.avatar_url&&e.jsx("img",{src:c.avatar_url,width:64,height:64,style:{borderRadius:"50%",flexShrink:0,border:"2px solid var(--border)"}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"title",style:{fontSize:"24px"},children:c.username}),e.jsxs("div",{className:"muted",style:{fontSize:13},children:["id ",c.id," • osu ",c.osu_user_id]})]}),e.jsxs("div",{className:"row wrap",style:{gap:8},children:[B&&!c.is_admin&&(c.is_mod?e.jsx("button",{className:"btn secondary compact",onClick:()=>P(c,!1),children:"Revoke moderation"}):e.jsx("button",{className:"btn secondary compact",onClick:()=>P(c,!0),children:"Grant moderation"})),!c.is_admin&&(c.is_blacklisted?e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(q.admin.userUpdate(c.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!1})}),h({...c,is_blacklisted:!1}),W("User unblacklisted",{variant:"success"})}catch{alert("Failed")}},children:"Unblacklist"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{try{await $(q.admin.userUpdate(c.id),{method:"PATCH",body:JSON.stringify({is_blacklisted:!0})}),h({...c,is_blacklisted:!0}),W("User blacklisted",{variant:"warn"})}catch{alert("Failed")}},children:"Blacklist"}))]})]})]}),e.jsxs("div",{className:"col",style:{gap:16},children:[e.jsxs("div",{className:"row-between",style:{alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Uploads"}),e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[e.jsx("button",{className:`btn compact ${w==="all"?"primary":"secondary"}`,onClick:()=>E("all"),children:"All"}),e.jsx("button",{className:`btn compact ${w==="review"?"primary":"secondary"}`,onClick:()=>E("review"),children:"Review"})]})]}),e.jsxs("div",{className:"scroll-panel sm",style:{maxHeight:"50vh"},children:[u.length===0&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No uploads."}),e.jsx("div",{className:"col",style:{gap:12},children:u.filter(i=>{if(w==="all")return!0;const I=(k?!i.approved_at:!1)&&i.status==="ready",ae=!!i.needs_review;return I||ae}).map(i=>e.jsxs("div",{className:"moderation-video-card",children:[e.jsxs("div",{className:"mod-card-content",children:[i.poster_url?e.jsx("img",{src:i.poster_url,className:"mod-card-poster",alt:""}):e.jsx("div",{className:"mod-card-poster"}),e.jsxs("div",{className:"mod-card-info",children:[e.jsx("div",{className:"mod-card-desc",title:i.description||"",children:i.description||"No description."}),e.jsxs("div",{className:"mod-card-meta",children:[e.jsx("span",{children:i.status.toUpperCase()}),e.jsxs("span",{className:"muted",children:["• ",new Date(i.created_at*1e3).toLocaleDateString()]}),i.needs_review?e.jsx("span",{style:{color:"#f59e0b"},children:"(purgatory)"}):null,k&&!i.approved_at&&i.status==="ready"?e.jsx("span",{style:{color:"#60a5fa"},children:"(pending)"}):null]}),e.jsxs("div",{className:"row",style:{gap:4,marginTop:4},children:[e.jsx("span",{style:{color:"var(--accent)",fontSize:14},children:"★"}),e.jsx("span",{className:"muted",style:{fontSize:13},children:i.likes_count??0})]})]})]}),e.jsxs("div",{className:"mod-card-actions",children:[(B||(t==null?void 0:t.is_mod))&&(!!i.needs_review||k&&!i.approved_at&&i.status==="ready")&&e.jsx("button",{className:"btn primary compact",onClick:async()=>{try{await $(q.admin.videosApprove(i.id),{method:"POST"}),l(u.map(I=>I.id===i.id?{...I,approved_at:Math.floor(Date.now()/1e3),needs_review:0}:I)),W("Approved",{variant:"success"})}catch{alert("Approve failed")}},children:"Approve"}),(B||(t==null?void 0:t.is_mod))&&e.jsx("button",{className:"btn secondary compact",onClick:async()=>{if(confirm("Permanently delete this video?"))try{await $(q.videos.delete(i.id),{method:"DELETE"}),l(u.filter(I=>I.id!==i.id)),W("Deleted",{variant:"warn"})}catch{alert("Delete failed")}},children:"Delete"})]})]},i.id))})]})]})]}):e.jsx("div",{className:"muted",style:{padding:"20px",textAlign:"center",border:"1px dashed var(--border)",borderRadius:"12px"},children:"Select a user to view details and uploads."})]})}),e.jsx("div",{className:"panel message",hidden:S!=="message",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsxs("div",{className:"col",style:{minWidth:0},children:[e.jsx("div",{className:"title",style:{fontSize:"18px",marginBottom:8},children:"Send a system message"}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx("input",{type:"text",placeholder:"Search username or ID",value:a,onChange:i=>r(i.target.value),onKeyDown:i=>{i.key==="Enter"&&M()},className:"moderation-input"}),e.jsx("button",{className:"btn secondary",onClick:M,style:{minHeight:"44px"},children:"Search"})]}),e.jsx("div",{className:"scroll-panel sm",style:{marginTop:12,maxHeight:"30vh"},children:e.jsx("div",{className:"col",style:{gap:8},children:p.map(i=>e.jsxs("button",{className:`moderation-user-result ${(c==null?void 0:c.id)===i.id?"selected":""}`,onClick:()=>h(i),children:[i.avatar_url&&e.jsx("img",{src:i.avatar_url,width:32,height:32,style:{borderRadius:"50%",flexShrink:0}}),e.jsxs("div",{className:"col",style:{flex:1,minWidth:0,gap:2,alignItems:"flex-start"},children:[e.jsx("span",{style:{fontWeight:500},children:i.username}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["id ",i.id," • osu ",i.osu_user_id]})]}),(c==null?void 0:c.id)===i.id&&e.jsx("span",{className:"chip info",children:"selected"})]},i.id))})})]}),e.jsxs("div",{className:"col",style:{minWidth:0,borderTop:"1px solid var(--divider)",paddingTop:24,gap:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Compose"}),e.jsxs("label",{className:"row",style:{alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:i=>Q(i.currentTarget.checked),style:{width:20,height:20,cursor:"pointer",minWidth:20,minHeight:20}}),e.jsx("span",{className:"muted",style:{fontSize:14},children:"Send to all users (global)"})]}),e.jsx("textarea",{placeholder:"Message (shown in notifications)",className:"moderation-input",style:{height:120,resize:"vertical",fontFamily:"inherit"},value:R,onChange:i=>O(i.target.value)}),e.jsx("button",{className:"btn primary",style:{width:"100%",minHeight:"44px"},onClick:()=>{const i=(R||"").trim();if(!i){alert("Enter a message");return}(async()=>{try{const I={text:i,global:x};!x&&(c!=null&&c.id)&&(I.user_id=c.id),await $(q.admin.notificationsSystem,{method:"POST",body:JSON.stringify(I)}),O(""),W("Message sent",{variant:"success"})}catch{alert("Failed to send")}})()},children:"Send"}),e.jsx("div",{className:"caption",style:{marginTop:4,fontSize:12,lineHeight:1.4},children:'System messages persist for 24 hours and show an "Expires at" timestamp.'})]})]})}),e.jsx("div",{className:"panel analytics",hidden:S!=="analytics",children:e.jsxs("div",{className:"col",style:{gap:24,paddingTop:16},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Analytics"}),H&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"Loading…"}),!H&&!d&&e.jsx("div",{className:"muted",style:{padding:"12px"},children:"No data."}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"moderation-stats-grid",children:[e.jsx(de,{label:"Users",value:d.totals.users_total}),e.jsx(de,{label:"Admins",value:d.totals.users_admin}),e.jsx(de,{label:"Mods",value:d.totals.users_mod}),e.jsx(de,{label:"Blacklisted",value:d.totals.users_blacklisted}),e.jsx(de,{label:"Videos",value:d.totals.videos_total}),e.jsx(de,{label:"Ready",value:d.totals.videos_ready}),e.jsx(de,{label:"Pending",value:d.totals.pending_count}),e.jsx(de,{label:"Purgatory",value:d.totals.purgatory_count}),e.jsx(de,{label:"Likes",value:d.totals.likes_total}),e.jsx(de,{label:"Flags",value:d.totals.flags_total})]}),e.jsxs("div",{className:"col",style:{gap:20,marginTop:8},children:[e.jsx(Ae,{title:"New users (30d)",series:d.series.users,color:"#60a5fa"}),e.jsx(Ae,{title:"New videos (30d)",series:d.series.videos,color:"#34d399"}),(F=(D=d.stream)==null?void 0:D.graphql)!=null&&F.minutes_viewed?e.jsx(Ae,{title:"Minutes viewed (30d)",series:d.stream.graphql.minutes_viewed,color:"#f59e0b"}):e.jsxs("div",{className:"moderation-chart-card",children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:ce()?13:14},children:"Minutes viewed (30d)"}),e.jsx("div",{className:"muted",style:{fontSize:ce()?11:12},children:"Data unavailable"})]}),e.jsxs("div",{className:"col",style:{padding:"24px",gap:12},children:[e.jsx("div",{className:"muted",style:{textAlign:"center",fontSize:14},children:"Minutes viewed data is not currently available."}),((re=(X=d.stream)==null?void 0:X.graphql)==null?void 0:re.errors)&&Array.isArray(d.stream.graphql.errors)&&d.stream.graphql.errors.length>0&&e.jsxs("div",{className:"col",style:{gap:8,padding:"12px",background:"var(--panel-dark)",borderRadius:8,border:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:600,color:"var(--danger)"},children:"Error details:"}),d.stream.graphql.errors.map((i,I)=>e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.5,fontFamily:"monospace"},children:typeof i=="string"?i:(i==null?void 0:i.message)||JSON.stringify(i)},I)),((se=(G=d.stream)==null?void 0:G.graphql)==null?void 0:se.raw)&&e.jsxs("div",{className:"col",style:{gap:4,marginTop:8,paddingTop:8,borderTop:"1px solid var(--border)"},children:[e.jsx("div",{className:"muted",style:{fontSize:11,fontWeight:600},children:"Debug info:"}),d.stream.graphql.raw.account_keys&&d.stream.graphql.raw.account_keys.length>0&&e.jsxs("div",{className:"muted",style:{fontSize:10,fontFamily:"monospace"},children:["Available account fields: ",d.stream.graphql.raw.account_keys.join(", ")]}),d.stream.graphql.raw.response_sample&&e.jsxs("details",{style:{fontSize:10},children:[e.jsx("summary",{className:"muted",style:{cursor:"pointer",marginTop:4},children:"Response sample"}),e.jsx("pre",{style:{fontSize:9,overflow:"auto",maxHeight:"200px",marginTop:4,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:4},children:d.stream.graphql.raw.response_sample})]})]})]}),!((te=d.stream)!=null&&te.graphql)&&e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",padding:"8px",background:"var(--panel-dark)",borderRadius:8},children:"GraphQL API not configured. Set CF_GRAPHQL_API_TOKEN secret."})]})]})]}),e.jsxs("div",{className:"col",style:{gap:8,marginTop:8},children:[e.jsx("div",{className:"title",style:{fontSize:"18px"},children:"Feed & Stream"}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Feed: ",d.feed.count," items in rotation",d.feed.cursor?` • cursor ${d.feed.cursor}`:""]}),e.jsxs("div",{className:"muted",style:{fontSize:14,lineHeight:1.5},children:["Approx. ready seconds: ",d.stream.approximate.total_duration_sec," • ready videos: ",d.stream.approximate.videos_ready]}),d.stream.api&&e.jsxs("div",{className:"muted",style:{fontSize:12,lineHeight:1.5},children:["Stream API: ",d.stream.api.ok?"ok":"unavailable",(fe=(he=d.stream.api)==null?void 0:he.result_info)!=null&&fe.count?` • count ${d.stream.api.result_info.count}`:"",(je=d.stream.api)!=null&&je.sample_status?` • sample status ${String(d.stream.api.sample_status)}`:""]})]})]})]})})]})]})]})}function de({label:t,value:n}){return e.jsxs("div",{className:"moderation-stat-card",children:[e.jsx("div",{className:"mod-stat-label",children:t}),e.jsx("div",{className:"mod-stat-value",children:n})]})}function Ae({title:t,series:n,color:s}){const[o,a]=f.useState(()=>ce()),r=j.useRef(null),[p,y]=f.useState(400);f.useEffect(()=>{const T=()=>{if(a(ce()),r.current){const M=r.current.offsetWidth-48;y(Math.max(300,M))}};T();let A=null;return r.current&&typeof ResizeObserver<"u"&&(A=new ResizeObserver(T),A.observe(r.current)),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T),A&&r.current&&A.unobserve(r.current)}},[]);const c=o?Math.min(400,Math.max(300,window.innerWidth-48)):Math.max(400,Math.min(1e3,p)),h=160,u=8,l=8,w=28,E=o?36:42,S=n.map(T=>T.count),b=Math.max(1,...S),k=f.useMemo(()=>{const T=b,A=Math.pow(10,Math.floor(Math.log10(T))),M=T/A;return(M<=1?1:M<=2?2:M<=5?5:10)*A},[b]),g=c-E-l,R=h-u-w,O=f.useMemo(()=>n.map((T,A)=>{const M=E+A/Math.max(1,n.length-1)*g,N=u+(1-T.count/(k||1))*R;return[M,N]}),[n,k,g,R]),x=f.useMemo(()=>O.map((T,A)=>A===0?`M ${T[0]} ${T[1]}`:`L ${T[0]} ${T[1]}`).join(" "),[O]),Q=[0,.25,.5,.75,1],W=f.useMemo(()=>{if(n.length===0)return[];const T=[0,.25,.5,.75,1].map(A=>Math.min(n.length-1,Math.round(A*(n.length-1))));return Array.from(new Set(T))},[n]),d=T=>{if(!T||T.length<10)return T||"";const A=T.slice(5,7).replace(/^0/,""),M=T.slice(8,10).replace(/^0/,"");return`${A}/${M}`};function U(T){const A=Number.isInteger(T);return T>=1e6?`${(T/1e6).toFixed(1).replace(/\.0$/,"")}M`:T>=1e3?`${(T/1e3).toFixed(1).replace(/\.0$/,"")}k`:A?String(T):T<10?T.toFixed(1):T.toFixed(1).replace(/\.0$/,"")}const H=n.length?n[n.length-1].count:0;return e.jsxs("div",{className:"moderation-chart-card",ref:r,children:[e.jsxs("div",{className:"row",style:{alignItems:"baseline",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:4},children:[e.jsx("div",{className:"muted",style:{fontSize:o?13:14},children:t}),e.jsxs("div",{className:"muted",style:{fontSize:o?11:12},children:["latest: ",U(H)]})]}),e.jsx("div",{style:{width:"100%"},children:e.jsxs("svg",{width:c,height:h,role:"img","aria-label":t,style:{display:"block",width:`${c}px`,height:`${h}px`,maxWidth:"100%"},children:[e.jsx("rect",{x:0,y:0,width:c,height:h,rx:12,style:{fill:"var(--panel-dark)"}}),Q.map((T,A)=>{const M=u+(1-T)*R,N=T*k;return e.jsxs("g",{children:[e.jsx("line",{x1:E,y1:M,x2:c-l,y2:M,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:E-6,y:M+4,textAnchor:"end",fontSize:10,style:{fill:"var(--muted)"},children:U(N)})]},A)}),e.jsx("line",{x1:E,y1:u,x2:E,y2:u+R,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),e.jsx("line",{x1:E,y1:u+R,x2:E+g,y2:u+R,strokeWidth:1,style:{stroke:"var(--border-strong)"}}),W.map((T,A)=>{var N;const M=E+T/Math.max(1,n.length-1)*g;return e.jsxs("g",{children:[e.jsx("line",{x1:M,y1:u,x2:M,y2:u+R,strokeWidth:1,style:{stroke:"var(--divider)"}}),e.jsx("text",{x:M,y:u+R+12,textAnchor:"middle",fontSize:10,style:{fill:"var(--muted)"},children:d((N=n[T])==null?void 0:N.day)})]},A)}),e.jsx("path",{d:x,fill:"none",stroke:s,strokeWidth:2}),O.length>0&&e.jsx("circle",{cx:O[O.length-1][0],cy:O[O.length-1][1],r:3,fill:s})]})})]})}function _s(){return e.jsxs("div",{className:"col",style:{gap:12},children:[e.jsxs("div",{className:"title",style:{fontSize:"2em"},children:["mappi! ",e.jsx("span",{style:{fontSize:"0.4em",fontWeight:"normal"},children:"by Catawba."})]}),e.jsx("div",{className:"muted",children:"Hi, I get writers block/lose motivation very very easily. I want this site to counterract that."}),e.jsx("div",{className:"muted",children:"Basically, when you are struggling to come up with ideas; you'd hop on this site, watch a few videos, see something that impresses you, then hopefully you can get back to mapping with a lil' bit of inspiration."}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Log in with your osu! account."}),e.jsx("li",{children:"Upload a clip (100MB max). Allow for it to upload/process."}),e.jsx("li",{children:"Uploaded clips enter the random feed. New uploads and liked videos surface more often."}),e.jsx("li",{children:"Moderators can review reports and pending items for safety."})]})]}),e.jsxs("div",{className:"section-panel",children:[e.jsx("div",{className:"title",style:{fontSize:18},children:"Guidelines:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You can post two clips every 24 hours before getting rate-limited."}),e.jsx("li",{children:"Keep clips 4:3 or 16:9 for best fit. Ultrawide will letterbox."}),e.jsx("li",{children:"Add a short description and (optional) beatmap link."}),e.jsx("li",{children:"Don't post unrelated content."}),e.jsx("li",{children:"Report posts accordingly and within reason."})]})]})]})}function Ts(t){const n="=".repeat((4-t.length%4)%4),s=(t+n).replace(/-/g,"+").replace(/_/g,"/"),o=atob(s),a=new Uint8Array(o.length);for(let r=0;r<o.length;r++)a[r]=o.charCodeAt(r);return a}async function Se(){return!("serviceWorker"in navigator)||!("PushManager"in window)?null:(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function Cs(){try{const t=await fetch(`${Ce}/api/push/public_key`,{credentials:"include"});if(!t.ok)return null;const n=await t.json().catch(()=>null);return n&&typeof n.publicKey=="string"?n.publicKey:null}catch{return null}}async function Es(t){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)||await Notification.requestPermission()!=="granted")return!1;const s=await navigator.serviceWorker.ready;let o=await s.pushManager.getSubscription();o||(o=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ts(t)}));try{await $(q.user.pushSubscribe,{method:"POST",body:JSON.stringify({...o.toJSON(),ua:navigator.userAgent})})}catch{}return!0}async function Ms(){const t=await Se();if(!t)return!0;try{await $(q.user.pushUnsubscribe,{method:"POST",body:JSON.stringify({endpoint:t.endpoint})})}catch{}try{await t.unsubscribe()}catch{}return!0}function Ls(){const{theme:t,setTheme:n}=pe(),{data:s}=ue(),{notify:o}=be(),[a,r]=j.useState("general"),[p,y]=j.useState(!1),[c,h]=j.useState(!1),[u,l]=j.useState(!1),[w,E]=j.useState(typeof Notification<"u"?Notification.permission:"default"),S=b=>{n(b),it(b)};return j.useEffect(()=>{y(typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),h(Pe()),Se().then(b=>l(!!b)).catch(()=>l(!1)),typeof Notification<"u"&&E(Notification.permission)},[]),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("div",{className:"settings-title",children:"Settings"}),e.jsx("div",{className:"settings-description",children:"Personalize appearance and app behavior."})]}),e.jsxs("div",{className:"profile-tabs-unified",role:"region","aria-label":"Settings",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Settings tabs",children:[e.jsx("button",{role:"tab","aria-selected":a==="general",className:`profile-tab ${a==="general"?"active":""}`,"data-tab":"general",onClick:b=>{const k=b.currentTarget.closest(".profile-tabs-unified"),g=k==null?void 0:k.querySelector(".profile-tabs-content");g==null||g.setAttribute("data-active","general"),r("general")},children:"General"}),e.jsx("button",{role:"tab","aria-selected":a==="notifications",className:`profile-tab ${a==="notifications"?"active":""}`,"data-tab":"notifications",onClick:b=>{const k=b.currentTarget.closest(".profile-tabs-unified"),g=k==null?void 0:k.querySelector(".profile-tabs-content");g==null||g.setAttribute("data-active","notifications"),r("notifications")},children:"Notifications"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":a,children:[e.jsx("div",{className:"panel general",hidden:a!=="general",children:e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Appearance"}),e.jsx("span",{className:"settings-section-desc",children:"Customize how the app looks on this device."})]}),e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Theme"}),e.jsx("span",{className:"settings-sublabel",children:"Select your preferred color scheme"})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("div",{className:"theme-toggle-group",role:"group","aria-label":"Theme selection",children:[e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="dark"?"active":""}`,"aria-pressed":t==="dark",onClick:()=>S("dark"),children:"Dark"}),e.jsx("button",{type:"button",className:`theme-toggle-btn ${t==="light"?"active":""}`,"aria-pressed":t==="light",onClick:()=>S("light"),children:"Light"})]})})]})]})}),e.jsx("div",{className:"panel notifications",hidden:a!=="notifications",children:e.jsxs("div",{className:"col",style:{gap:24},children:[e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Push Notifications"}),e.jsx("span",{className:"settings-section-desc",children:"Manage push alerts for this device."})]}),!p&&e.jsx("div",{className:"settings-hint",children:"Push notifications are not supported on this device."}),p&&e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:"Push Alerts"}),e.jsx("span",{className:"settings-sublabel",children:w==="granted"&&u?"Enabled on this device":"Disabled on this device"}),!c&&e.jsx("div",{className:"settings-hint",style:{marginTop:4},children:"On iOS, install the app to your Home Screen to enable push."})]}),e.jsx("div",{className:"settings-action",children:w!=="granted"||!u?e.jsx("button",{className:"btn primary compact",onClick:async()=>{const b=await Cs();if(!b)return;await Es(b),E(typeof Notification<"u"?Notification.permission:"default");const k=await Se();l(!!k)},title:c?void 0:"On iOS, install as PWA to enable",children:"Enable"}):e.jsx("button",{className:"btn secondary compact",onClick:async()=>{await Ms();const b=await Se();l(!!b),E(typeof Notification<"u"?Notification.permission:"default")},children:"Disable"})})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsxs("div",{className:"settings-section-header",children:[e.jsx("h3",{className:"settings-section-title",children:"Preferences"}),e.jsx("span",{className:"settings-section-desc",children:"Choose which activities trigger notifications."})]}),e.jsx(As,{})]})]})})]})]})]})}function As(){const{notify:t}=be(),[n,s]=j.useState(!0),[o,a]=j.useState(!1),[r,p]=j.useState({star:!0,likes5:!0,comment:!0,inspiration:!0,reaction:!0,system:!0,invites:!0});j.useEffect(()=>{(async()=>{s(!0);try{const u=await $(q.user.notifPrefs,{requireAuth:!0});u&&u.prefs&&p(l=>({...l,...u.prefs}))}finally{s(!1)}})()},[]);async function y(u){a(!0);try{await $(q.user.notifPrefs,{method:"POST",body:JSON.stringify(u)}),t("Preferences saved",{variant:"success"})}catch(l){t((l==null?void 0:l.message)||"Failed to save",{variant:"error"})}finally{a(!1)}}function c(u){const l={...r,[u]:!r[u]};p(l),y(l)}const h=({k:u,label:l,desc:w})=>e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{className:"settings-info",children:[e.jsx("span",{className:"settings-label",children:l}),w&&e.jsx("span",{className:"settings-sublabel",children:w})]}),e.jsx("div",{className:"settings-action",children:e.jsxs("label",{className:"settings-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:r[u],onChange:()=>c(u),"aria-label":`Toggle ${l}`}),e.jsx("span",{className:"settings-toggle-slider"})]})})]});return n?e.jsx("div",{className:"settings-hint",children:"Loading preferences…"}):e.jsxs(e.Fragment,{children:[e.jsx(h,{k:"star",label:"Stars",desc:"When someone stars your map"}),e.jsx(h,{k:"likes5",label:"Likes milestone",desc:"When you reach 5+ likes"}),e.jsx(h,{k:"comment",label:"Comments",desc:"When someone comments on your post"}),e.jsx(h,{k:"inspiration",label:"Inspirations",desc:"When someone is inspired by you"}),e.jsx(h,{k:"reaction",label:"Reactions",desc:"When someone reacts to your comment"}),e.jsx(h,{k:"invites",label:"Queue invitations",desc:"When you are invited to a queue"}),e.jsx(h,{k:"system",label:"System messages",desc:"Important announcements"}),o&&e.jsx("div",{className:"settings-hint",style:{marginTop:8},children:"Saving…"})]})}const Ps=()=>(f.useEffect(()=>()=>{Xt.clearAll()},[]),e.jsx(Zt,{}));function Is(){const[t,n]=j.useState({mobile:!1,standalone:!1,platform:""}),[s,o]=j.useState("ios");return j.useEffect(()=>{const a=typeof navigator<"u"&&navigator.userAgent||"",r=/iPad|iPhone|iPod/i.test(a)||/(Macintosh).*Mobile/.test(a),p=/Android/i.test(a),y=r?"ios":p?"android":"other";n({mobile:ce(),standalone:!1,platform:y}),o(y==="android"?"android":"ios")},[]),e.jsx("div",{className:"feed-container",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 16px"},children:e.jsxs("div",{className:"feed-header",style:{paddingTop:12,paddingBottom:0},children:[e.jsxs("div",{className:"moderation-header",children:[e.jsx("div",{className:"moderation-title",children:"Install osumapp.ing"}),e.jsx("div",{className:"muted moderation-description",children:"Add this app to your home screen for a faster, fullscreen experience."})]}),e.jsxs("div",{className:"profile-tabs-unified",children:[e.jsxs("div",{className:"profile-tabs-header",role:"tablist","aria-label":"Install tabs",style:{display:"flex",gap:4},children:[e.jsx("button",{role:"tab","aria-selected":s==="ios",className:`profile-tab ${s==="ios"?"active":""}`,"data-tab":"ios",onClick:a=>{const r=a.currentTarget.closest(".profile-tabs-unified");r.querySelectorAll(".profile-tab").forEach(y=>{y.classList.remove("active"),y.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),r.querySelector(".profile-tabs-content").setAttribute("data-active","ios"),o("ios")},children:"iOS"}),e.jsx("button",{role:"tab","aria-selected":s==="android",className:`profile-tab ${s==="android"?"active":""}`,"data-tab":"android",onClick:a=>{const r=a.currentTarget.closest(".profile-tabs-unified");r.querySelectorAll(".profile-tab").forEach(y=>{y.classList.remove("active"),y.setAttribute("aria-selected","false")}),a.currentTarget.classList.add("active"),a.currentTarget.setAttribute("aria-selected","true"),r.querySelector(".profile-tabs-content").setAttribute("data-active","android"),o("android")},children:"Android"})]}),e.jsxs("div",{className:"profile-tabs-content","data-active":s,children:[e.jsx("div",{className:"panel",hidden:s!=="ios",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"iOS (Safari)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open this site in Safari."}),e.jsx("li",{children:"Tap the Share button."}),e.jsx("li",{children:"Select “Add to Home Screen”."}),e.jsx("li",{children:"Tap “Add” to confirm."})]})]})}),e.jsx("div",{className:"panel",hidden:s!=="android",children:e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Android (Chrome)"}),e.jsxs("ol",{style:{paddingLeft:18,margin:0,lineHeight:1.7},children:[e.jsx("li",{children:"Open the browser menu (⋮) in Chrome."}),e.jsx("li",{children:"Choose “Install app” or “Add to Home screen”."}),e.jsx("li",{children:"Confirm to add it."})]})]})})]})]})]})})}const He={standard:at,taiko:et,mania:tt,catch:st},Qe={standard:"Standard",taiko:"Taiko",mania:"Mania",catch:"Catch"},zs=({value:t,onChange:n})=>{const[s,o]=f.useState(!1),a=f.useRef(null);f.useEffect(()=>{if(!s)return;const p=c=>{a.current&&!a.current.contains(c.target)&&o(!1)},y=c=>{c.key==="Escape"&&o(!1)};return document.addEventListener("mousedown",p),document.addEventListener("keydown",y),()=>{document.removeEventListener("mousedown",p),document.removeEventListener("keydown",y)}},[s]);const r=p=>e.jsxs("button",{className:`mode-option${p===t?" selected":""}`,onClick:()=>{n(p),o(!1)},role:"option","aria-selected":p===t,children:[e.jsx("img",{className:"mode-icon",src:He[p],width:24,height:24,alt:""}),e.jsx("span",{children:Qe[p]})]},p);return e.jsxs("div",{className:"mode-select",ref:a,children:[e.jsxs("button",{type:"button",className:"mode-button","aria-haspopup":"listbox","aria-expanded":s,onClick:()=>o(p=>!p),children:[e.jsx("img",{className:"mode-icon",src:He[t],width:24,height:24,alt:""}),e.jsx("span",{className:"mode-label",children:Qe[t]}),e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6","aria-hidden":"true",style:{marginLeft:6,opacity:.8},children:e.jsx("path",{d:"M1 1l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("div",{className:"mode-panel",role:"listbox",children:["standard","taiko","mania","catch"].map(r)})]})};function Ke(t){if(!t)return"standard";const n=String(t).toLowerCase().trim();return n==="osu"||n==="0"||n==="standard"?"standard":n==="taiko"||n==="1"?"taiko":n==="catch"||n==="fruits"||n==="2"?"catch":n==="mania"||n==="3"?"mania":"standard"}function Rs({section:t,onUpload:n,onPost:s}){const{notify:o}=be(),{data:a}=ue(),[r,p]=f.useState(""),[y,c]=f.useState(""),[h,u]=f.useState(null),[l,w]=f.useState(null),[E,S]=f.useState(!1),[b,k]=f.useState(""),g=f.useRef(0),[R,O]=f.useState("standard"),[x,Q]=f.useState(null),[W,d]=f.useState(0),[U,H]=f.useState(""),[T,A]=f.useState(""),[M,N]=f.useState(""),[P,v]=f.useState(""),[B,K]=f.useState(null),[m,D]=f.useState(!1),[F,X]=f.useState(null),re=100*1024*1024,G=f.useMemo(()=>x?`${x.name}:${x.size}:${x.lastModified}`:null,[x]),[se,te]=f.useState(!1),[he,fe]=f.useState([]),je=f.useRef(null),i=f.useRef(null);f.useEffect(()=>{const C=r.match(/https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\/[^\s]+/);C&&C[0]!==y?c(C[0]):!C&&y&&(c(""),u(null),w(null))},[r,y]),f.useEffect(()=>{g.current&&window.clearTimeout(g.current);const C=(y||"").trim();if(!C){k(""),u(null),w(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(C)){k(""),u(null),w(null);return}return g.current=window.setTimeout(async()=>{var z;try{let J;try{J=new URL(C)}catch{k("Invalid URL format");return}const oe=J.hash.match(/#osu\/(\d+)/),Z=oe?oe[1]:null;J.hash="";const ze={url:J.toString()};Z&&(ze.beatmap_id=Z);const ne=await $(q.osu.resolveBeatmap+xe(ze),{requireAuth:!1}),Ne=Array.isArray(ne==null?void 0:ne.diffs)?ne.diffs:[];if(!Ne.length&&!ne.setId){k("No difficulties found"),u(null),w(null);return}if(u({setId:Number(ne.setId)||0,beatmapId:ne.beatmapId??null,title:String(ne.title||""),artist:String(ne.artist||""),mapper:String(ne.mapper||""),diffs:Ne}),Ne.length>0){const nt=Number.isFinite(Number(ne.beatmapId))?Number(ne.beatmapId):Number((z=Ne[0])==null?void 0:z.id),me=Ne.find(rt=>Number(rt.id)===nt)||Ne[0],Re=Ke(me==null?void 0:me.mode);w({beatmapId:Number(me==null?void 0:me.id)||null,version:String((me==null?void 0:me.version)||""),mode:Re}),O(Re)}else w(null);k("")}catch(J){const oe=(J==null?void 0:J.message)||"Unknown error";k(`Failed to resolve: ${oe}`),u(null),w(null)}},400),()=>{g.current&&window.clearTimeout(g.current)}},[y]);const I=r.replace(/https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\/[^\s]+/g,"").trim(),ae=C=>{var J;const L=((J=C.target.files)==null?void 0:J[0])||null;if(Q(L),K(null),L&&L.size>re?N("File exceeds 100MB limit"):N(""),L)try{const oe=URL.createObjectURL(L),Z=document.createElement("video");Z.preload="metadata",Z.src=oe,Z.onloadedmetadata=()=>{URL.revokeObjectURL(oe);const ie=Number.isFinite(Z.duration)?Z.duration:NaN;Number.isFinite(ie)&&K(ie),Number.isFinite(ie)&&ie>60.5?v("Clip exceeds 60s limit"):v("")},Z.onerror=()=>{URL.revokeObjectURL(oe),K(null)}}catch{K(null)}else v("");const z=L?`${L.name}:${L.size}:${L.lastModified}`:null;z&&z!==F&&D(!1)};async function ee(){return A("info"),H("Requesting upload URL..."),await $(q.uploads.new,{method:"POST",body:JSON.stringify({description:I.slice(0,100),beatmap_url:y||void 0,size_bytes:(x==null?void 0:x.size)??void 0,mode:R,beatmapset_id:(h==null?void 0:h.setId)??void 0,beatmap_id:(l==null?void 0:l.beatmapId)??void 0,beatmap_version:(l==null?void 0:l.version)??void 0,beatmap_title:h?`${h.title}`:void 0,beatmap_artist:h?`${h.artist}`:void 0,beatmap_mapper:h?`${h.mapper}`:void 0})})}async function ve(C,L,z="form"){await new Promise((J,oe)=>{const Z=new XMLHttpRequest;if(Z.open("POST",C),Z.upload.onprogress=ie=>{ie.lengthComputable&&d(Math.round(ie.loaded/ie.total*100))},Z.onload=()=>Z.status>=200&&Z.status<300?J():oe(new Error(`Upload failed (${Z.status}) ${Z.responseText||""}`)),Z.onerror=()=>oe(new Error("Network error")),z==="form"){const ie=new FormData;ie.append("file",L,L.name),Z.send(ie)}else Z.setRequestHeader("Content-Type","application/octet-stream"),Z.send(L)})}async function Ee(){if(x){if(x.size>re){N("File exceeds 100MB limit");return}if(typeof B=="number"&&B>60.5){v("Clip exceeds 60s limit");return}G&&(D(!0),X(G)),d(0),A("info"),te(!0);try{const C=await ee();let L=C.streamUID;try{H("Uploading..."),await ve(C.uploadURL,x,"form")}catch(z){A("warn"),H(`Retrying upload... (${(z==null?void 0:z.message)||z})`);const J=await ee();L=J.streamUID,await ve(J.uploadURL,x,"binary")}A("info"),H("Processing...");for(let z=0;z<60;z++){await new Promise(J=>setTimeout(J,3e3));try{if((await $(q.videos.get(L),{requireAuth:!1})).status==="ready"){A("success"),H("Ready!"),o("Upload complete!",{variant:"success"}),Q(null),p(""),c(""),u(null),w(null),O("standard"),d(0),N(""),v(""),K(null),D(!1),X(null),H(""),n&&n();break}}catch{}}}catch(C){A("error"),H(C.message||"Error"),o(C.message||"Upload failed",{variant:"error"})}finally{te(!1)}}}const Me=async()=>{if(!I.trim()){o("Text is required",{variant:"error"});return}if(I.length>200){o("Text must be 200 characters or less",{variant:"error"});return}te(!0);try{const C=await $(q.moddi.posts,{method:"POST",body:JSON.stringify({text:I,beatmap_url:y.trim()||void 0,beatmapset_id:(h==null?void 0:h.setId)??void 0,beatmap_id:(l==null?void 0:l.beatmapId)??(h==null?void 0:h.beatmapId)??void 0,beatmap_version:(l==null?void 0:l.version)??void 0,tags:he.length>0?he.join(","):void 0})});if(C){const L=C==null?void 0:C.post;L?(!L.uid&&L.id&&(L.uid=String(L.id)),s&&s(L)):s&&s(),o("Post created!",{variant:"success"}),p(""),c(""),u(null),w(null),k(""),fe([])}}catch{o("Failed to create post",{variant:"error"})}finally{te(!1)}},_=x?!M&&!P&&!m&&!se:I.trim().length>0&&I.length<=200&&!se;return e.jsxs("div",{className:"compose-twitter",style:{background:"var(--panel)",borderBottom:"1px solid rgba(255,255,255,0.08)",padding:"12px 0"},children:[e.jsxs("div",{style:{display:"flex",gap:12},children:[a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"",style:{width:40,height:40,borderRadius:"50%",flexShrink:0,objectFit:"cover"}}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("textarea",{ref:je,placeholder:"What's happening?",value:r,onChange:C=>p(C.target.value),maxLength:500,style:{width:"100%",background:"transparent",border:"none",padding:"8px 0",color:"var(--text)",fontFamily:"inherit",fontSize:18,resize:"none",minHeight:52,outline:"none",lineHeight:1.4},rows:1,onInput:C=>{const L=C.target;L.style.height="auto",L.style.height=L.scrollHeight+"px"}}),h&&e.jsxs("div",{style:{marginTop:8,padding:"10px 12px",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,display:"flex",alignItems:"center",gap:10},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:500},children:[h.artist," – ",h.title]}),e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:2},children:["Mapped by ",h.mapper]})]}),h.diffs.length>0&&e.jsx("select",{value:(l==null?void 0:l.beatmapId)??h.beatmapId??void 0,onChange:C=>{const L=Number(C.target.value),z=(h==null?void 0:h.diffs.find(J=>Number(J.id)===L))||null;if(z){const J=Ke(z.mode);w({beatmapId:L,version:z.version,mode:J}),O(J)}},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,padding:"4px 8px",fontSize:11},children:h.diffs.map(C=>e.jsx("option",{value:C.id,children:C.version},C.id))}),e.jsx("button",{type:"button",onClick:()=>{p(r.replace(/https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\/[^\s]+/g,"").trim()),u(null),w(null),c("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:16,padding:4},children:e.jsx(Te,{size:14})})]}),b&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:b}),x&&e.jsxs("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.2)",borderRadius:8,display:"flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx(Ue,{size:16}),e.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:x.name}),e.jsxs("span",{className:"muted",children:[(x.size/1024/1024).toFixed(1),"MB",B&&e.jsxs("span",{children:[" • ",Math.round(B),"s"]})]}),e.jsx("button",{type:"button",onClick:()=>{Q(null),N(""),v("")},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:14,padding:2},children:e.jsx(Te,{size:14})})]}),M&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:M}),P&&e.jsx("div",{style:{color:"var(--danger)",fontSize:11,marginTop:4},children:P}),(W>0||U)&&e.jsxs("div",{style:{marginTop:8},children:[U&&e.jsx("div",{className:`chip ${T||"info"}`,style:{fontSize:11,padding:"4px 8px"},children:U}),W>0&&e.jsx("div",{style:{marginTop:6,height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.min(100,Math.max(0,W))}%`,height:"100%",background:"#667eea",borderRadius:2,transition:"width 0.2s"}})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.06)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("button",{type:"button",disabled:!0,style:{background:"transparent",border:"none",padding:8,cursor:"not-allowed",opacity:.4,color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center"},title:"Image upload (coming soon)",children:e.jsx(Et,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{var C;return(C=i.current)==null?void 0:C.click()},style:{background:x?"rgba(102, 126, 234, 0.15)":"transparent",border:"none",padding:8,cursor:"pointer",color:"#667eea",borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.15s"},title:"Add video clip (max 60s, 100MB)",children:e.jsx(Ue,{size:20})}),e.jsx("input",{ref:i,type:"file",accept:"video/*",onChange:ae,style:{display:"none"}}),x&&e.jsx("div",{style:{marginLeft:8},children:e.jsx(zs,{value:R,onChange:O})}),e.jsxs("span",{className:"muted",style:{fontSize:11,marginLeft:12},children:[I.length,"/",x?100:200]})]}),e.jsx("button",{type:"button",onClick:x?Ee:Me,disabled:!_,style:{background:_?"#667eea":"rgba(102, 126, 234, 0.3)",border:"none",borderRadius:999,padding:"8px 18px",color:"#fff",fontWeight:600,fontSize:14,cursor:_?"pointer":"not-allowed",transition:"all 0.15s"},children:se?"Posting...":"Post"})]})]})]}),E&&h&&e.jsx(es,{open:E,onClose:()=>S(!1),downloadUrl:q.osu.downloadBeatmapset(h.setId),beatmapId:(l==null?void 0:l.beatmapId)??h.beatmapId??void 0,beatmapVersion:l==null?void 0:l.version})]})}function Fs(){const{data:t}=ue(),{modeFilters:n}=pe(),s=Object.entries(n).filter(([a,r])=>r).map(([a])=>a),o=s.length?s.join(","):"standard";return Ve({queryKey:["mappi","feed",o],queryFn:async({pageParam:a=0})=>{const r=new URLSearchParams({limit:"20",offset:String(a),modes:o}),p=`${q.feed.recent}?${r.toString()}`;return await $(p)},enabled:!!t,initialPageParam:0,getNextPageParam:(a,r)=>{var c;const p=r.reduce((h,u)=>{var l;return h+(((l=u.items)==null?void 0:l.length)||0)},0);return(((c=a.items)==null?void 0:c.length)||0)===20?p:void 0}})}function Ws(){const{data:t}=ue(),{tagFilters:n}=pe();return Ve({queryKey:["moddi","feed",n],queryFn:async({pageParam:s=0})=>{const o=new URLSearchParams({limit:"20",offset:String(s)}),a=`${q.moddi.posts}?${o.toString()}`;return await $(a)},enabled:!!t,initialPageParam:0,getNextPageParam:(s,o)=>{var p;const a=o.reduce((y,c)=>{var h;return y+(((h=c.items)==null?void 0:h.length)||0)},0);return(((p=s.items)==null?void 0:p.length)||0)===20?a:void 0}})}function Ds(){const t=ye(),n=Mt(),{data:s}=ue(),{modeFilters:o,tagFilters:a}=pe(),{data:r,fetchNextPage:p,hasNextPage:y,isFetching:c,isFetchingNextPage:h,refetch:u}=Fs(),{data:l,fetchNextPage:w,hasNextPage:E,isFetching:S,isFetchingNextPage:b,refetch:k}=Ws(),g=f.useMemo(()=>(r==null?void 0:r.pages.flatMap(N=>N.items||[]))||[],[r]),R=f.useMemo(()=>l!=null&&l.pages?l.pages.flatMap(N=>(N.items||[]).map(v=>({...v,user_id:v.user_id??0,username:v.username||"Unknown",avatar_url:v.avatar_url||null,text:v.text??null,uid:v.uid||String(v.id||""),reactions_count:Number(v.reactions_count??0),reacted_by_me:v.reacted_by_me??!1,comments_count:Number(v.comments_count??0),_type:"moddi"}))):[],[l]),O=f.useMemo(()=>{const P=[...g.map(v=>({...v,_type:"mappi"})),...R];return P.sort((v,B)=>{const K=v.created_at||0;return(B.created_at||0)-K}),P},[g,R]),x=f.useMemo(()=>O.filter(N=>{if(N._type==="mappi"){const P=Object.entries(o).filter(([K,m])=>m).map(([K])=>K.toLowerCase());if(P.length===0)return!0;const v=new Set(P),B=String(N.mode||"standard").toLowerCase();return v.has(B)}else{const P=N.tags?typeof N.tags=="string"?N.tags.split(",").map(K=>K.trim()):[]:[],v=!P.length,B=P.includes("help");return a.untagged&&a.help?!0:a.untagged&&!a.help?v:!a.untagged&&a.help?B:!0}}),[O,o,a]);f.useEffect(()=>{t.pathname==="/feed"&&(u(),k())},[t.pathname,u,k]);const Q=N=>{n.setQueryData(["mappi","feed"],P=>P&&{...P,pages:P.pages.map(v=>({...v,items:v.items.map(B=>B.id===N.id?N:B)}))})},W=N=>{n.setQueryData(["moddi","feed"],P=>P&&{...P,pages:P.pages.map(v=>({...v,items:v.items.map(B=>B.id===N.id?N:B)}))})},d=N=>{n.setQueryData(["mappi","feed"],P=>P&&{...P,pages:P.pages.map(v=>({...v,items:v.items.filter(B=>B.id!==N)}))}),n.setQueryData(["moddi","feed"],P=>P&&{...P,pages:P.pages.map(v=>({...v,items:v.items.filter(B=>B.id!==N)}))})},U=()=>{u()},H=N=>{N&&n.setQueryData(["moddi","feed"],P=>{if(!P)return P;const v={...N,user_id:N.user_id??0,username:N.username||"Unknown",avatar_url:N.avatar_url||null,text:N.text??null,uid:N.uid||String(N.id||""),reactions_count:Number(N.reactions_count??0),reacted_by_me:N.reacted_by_me??!1,comments_count:Number(N.comments_count??0)};return{...P,pages:P.pages.map((B,K)=>K===0?{...B,items:[v,...B.items||[]]}:B)}}),n.invalidateQueries({queryKey:["moddi","feed"]}),k()},T=c&&!h||S&&!b,A=y||E,M=()=>{y&&p(),E&&w()};return e.jsxs("div",{className:"feed-container unified-feed",style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[e.jsxs("div",{className:"feed-header",children:[e.jsx("div",{className:"title",style:{marginBottom:8},children:"Feed"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:12},children:"Share your mapping journey - upload clips or ask for feedback!"}),e.jsx(Rs,{section:"mappi",onUpload:U,onPost:H})]}),e.jsx(Qt,{context:"unified-feed"}),e.jsx("div",{className:"feed-list-wrapper",style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",paddingBottom:"100px"},children:e.jsxs("div",{className:"col",style:{gap:0},children:[x.length===0&&!T&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No posts yet. Be the first to share something!"}),x.map(N=>e.jsx(Rt,{post:N,section:N._type,onUpdate:N._type==="mappi"?Q:W,onDelete:d,me:s},`${N._type}-${N.id}`)),x.length>0&&A&&e.jsx("div",{style:{padding:"16px",textAlign:"center",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("button",{className:"btn secondary",onClick:M,disabled:h||b,children:h||b?"Loading...":"Load more"})})]})})]})}const qs=j.lazy(()=>as(()=>import("./Discover-C3fI28uN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));Ns("dark");Ft();"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t=encodeURIComponent(Ce);navigator.serviceWorker.register(`/sw.js?api=${t}`).then(n=>{console.log("Service Worker registered successfully:",n.scope)}).catch(n=>{console.error("Service Worker registration failed:",n)})});const Us=()=>e.jsx(It,{children:e.jsxs(V,{element:e.jsx(vs,{}),children:[e.jsx(V,{path:"/",element:e.jsx(ws,{})}),e.jsx(V,{path:"/feed",element:e.jsx(Ds,{})}),e.jsx(V,{path:"/feed/:uid",element:e.jsx(Dt,{})}),e.jsx(V,{path:"/discover",element:e.jsx(f.Suspense,{fallback:e.jsx("div",{style:{padding:"48px",textAlign:"center"},children:"Loading..."}),children:e.jsx(qs,{})})}),e.jsx(V,{path:"/queues",element:e.jsx(Kt,{})}),e.jsx(V,{path:"/queues/:id",element:e.jsx(Jt,{})}),e.jsx(V,{path:"/submissions",element:e.jsx(Gt,{})}),e.jsx(V,{path:"/mp/feed",element:e.jsx(ge,{to:"/feed",replace:!0})}),e.jsx(V,{path:"/mp/feed/:uid",element:e.jsx(ge,{to:"/feed/:uid",replace:!0})}),e.jsx(V,{path:"/mp/discover",element:e.jsx(ge,{to:"/discover",replace:!0})}),e.jsx(V,{path:"/md/feed",element:e.jsx(ge,{to:"/feed",replace:!0})}),e.jsx(V,{path:"/md/feed/:uid",element:e.jsx(ge,{to:"/feed/:uid",replace:!0})}),e.jsx(V,{path:"/md/queues",element:e.jsx(ge,{to:"/queues",replace:!0})}),e.jsx(V,{path:"/md/queues/:id",element:e.jsx(ge,{to:"/queues/:id",replace:!0})}),e.jsx(V,{path:"/md/submissions",element:e.jsx(ge,{to:"/submissions",replace:!0})}),e.jsx(V,{path:"/notifications",element:e.jsx(Vt,{})}),e.jsx(V,{path:"/profile",element:e.jsx(Oe,{})}),e.jsx(V,{path:"/profile/:id",element:e.jsx(Oe,{})}),e.jsx(V,{path:"/moderation",element:e.jsx(Ss,{})}),e.jsx(V,{path:"/about",element:e.jsx(_s,{})}),e.jsx(V,{path:"/settings",element:e.jsx(Ls,{})}),e.jsx(V,{path:"/mobile",element:e.jsx(Is,{})}),e.jsx(V,{path:"/editor",element:e.jsx(Ps,{})})]})}),$s=()=>e.jsx(Pt,{children:e.jsx(Us,{})});Lt(document.getElementById("root")).render(e.jsx(ns,{children:e.jsx(At,{client:is,children:e.jsx(Wt,{children:e.jsx($s,{})})})}));export{os as B,as as _};
