import{r as a,j as t,d as Me,u as be,e as ve,L as oe,A as ye,F as we,f as ze,g as De,h as fe,i as he,k as ge,l as Se,m as qe,n as Be,c as We,o as Ue,p as Oe,q as Ve}from"./vendor-react-DAsiiV4L.js";import{H as B}from"./vendor-hls-B_fsdCYC.js";import{B as Ge}from"./editor-lib-C53M5fdW.js";import{P as Xe}from"./beatmap-preview-BawQgby_.js";const je=a.createContext(null);function it({children:e}){const[l,d]=a.useState([]),w=a.useRef(1),p=a.useRef(new Map),y=u=>{const h=p.current.get(u);h&&(clearTimeout(h),p.current.delete(u))},i=(u,h)=>{y(u);const f=window.setTimeout(()=>v(u),h);p.current.set(u,f)},v=a.useCallback(u=>{y(u),d(h=>h.filter(f=>f.id!==u))},[]),s=a.useCallback((u,h)=>{const f=typeof h=="number"?h:(h==null?void 0:h.durationMs)??5e3,C=typeof h=="number"?"info":(h==null?void 0:h.variant)??"info",H=(()=>{try{return window.matchMedia("(max-width: 600px), (pointer: coarse)").matches}catch{return!1}})();let j=null;return d(H?N=>{const _=N[0];if(_&&_.message===u&&_.variant===C){const E={..._,count:_.count+1,duration:f};return j=E.id,[E]}N.forEach(E=>y(E.id));const g=w.current++,z={id:g,message:u,duration:f,variant:C,count:1};return j=g,[z]}:N=>{const _=N.findIndex(E=>E.message===u&&E.variant===C);if(_!==-1){const E=[...N],T={...E[_],count:E[_].count+1};return E[_]=T,j=T.id,E}const g=w.current++,z={id:g,message:u,duration:f,variant:C,count:1};return j=g,[...N,z]}),j!=null&&i(j,f),j??-1},[]),R=a.useMemo(()=>({notify:s,close:v}),[s,v]);return t.jsxs(je.Provider,{value:R,children:[e,t.jsx("div",{className:"toasts",children:l.map(u=>t.jsxs("div",{className:`toast ${u.variant}`,children:[t.jsxs("div",{className:"toast-text",children:[u.message,u.count>1&&t.jsxs("span",{style:{marginLeft:6,opacity:.8},children:["×",u.count]})]}),t.jsx("button",{className:"toast-close",onClick:()=>v(u.id),"aria-label":"Close",children:"×"})]},u.id))})]})}function ce(){const e=a.useContext(je);if(!e)throw new Error("useToasts must be used within ToastProvider");return e}const ue="https://api.osumappi.ng";function Ye(){var e;try{return((e=document.cookie.split("; ").map(l=>l.split("=")).find(([l])=>l==="csrf"))==null?void 0:e[1])||""}catch{return""}}async function W(e,l={}){const{requireAuth:d=!0,skipCsrf:w=!1,...p}=l,y={...p.headers};if(p.body&&!y["Content-Type"]&&(y["Content-Type"]="application/json"),d&&!w){const v=Ye();v&&(y["X-CSRF-Token"]=v)}const i=await fetch(`${ue}${e}`,{...p,credentials:"include",headers:y});if(!i.ok){const v=await i.json().catch(()=>({error:`HTTP ${i.status}`}));throw new Error(v.error||`HTTP ${i.status}: ${i.statusText}`)}return i.json()}function xe(e){const l=new URLSearchParams;for(const[w,p]of Object.entries(e))p!=null&&l.append(w,String(p));const d=l.toString();return d?`?${d}`:""}const I={auth:{login:"/api/auth/login",logout:"/api/auth/logout",me:"/api/me"},user:{quota:"/api/me/upload_quota",notifications:"/api/me/notifications",markNotificationsRead:"/api/me/notifications/mark_read",deleteNotification:e=>`/api/me/notifications/${encodeURIComponent(e)}`},feed:{next:"/api/feed/next",batch:"/api/feed/batch",progress:e=>`/api/feed/progress${e?`?modes=${encodeURIComponent(e)}`:""}`,recent:"/api/videos/recent"},videos:{like:e=>`/api/videos/${e}/like`,view:e=>`/api/videos/${e}/view`,update:e=>`/api/videos/${e}`,delete:e=>`/api/videos/${e}`,flag:e=>`/api/videos/${e}/flag`,comments:e=>`/api/videos/${e}/comments`,get:e=>`/api/videos/${e}`},uploads:{new:"/api/uploads/new"},moddi:{posts:"/api/moddiposts",post:e=>`/api/moddiposts/${e}`,postReact:e=>`/api/moddiposts/${e}/react`,postComments:e=>`/api/moddiposts/${e}/comments`,queues:"/api/moddi/queues",queue:e=>`/api/moddi/queues/${e}`,queueSubmit:e=>`/api/moddi/queues/${e}/submit`,queueAccept:e=>`/api/moddi/queues/${e}/accept`,queueDeny:e=>`/api/moddi/queues/${e}/deny`,queueInvite:e=>`/api/moddi/queues/${e}/invite`,queueMember:(e,l)=>`/api/moddi/queues/${e}/members/${l}`,queueSubmission:(e,l)=>`/api/moddi/queues/${e}/submissions/${l}`,queueSubmissionDelete:(e,l)=>`/api/moddi/queues/${e}/submissions/${l}`,queueBlockUser:e=>`/api/moddi/queues/${e}/block`,queueUnblockUser:(e,l)=>`/api/moddi/queues/${e}/block/${l}`,queueBlockedUsers:e=>`/api/moddi/queues/${e}/blocked`,queueSubmissionAcknowledge:(e,l)=>`/api/moddi/queues/${e}/submissions/${l}/acknowledge`,queueSubmissionUnacknowledge:(e,l)=>`/api/moddi/queues/${e}/submissions/${l}/acknowledge`,usersSearch:e=>`/api/moddi/users/search?q=${encodeURIComponent(e)}`},osu:{resolveBeatmap:"/api/osu/beatmap/resolve",downloadBeatmapset:e=>`/api/osu/beatmapsets/${e}/download?noVideo=1`,usersSearch:e=>`/api/osu/users/search?q=${encodeURIComponent(e)}`},users:{get:e=>`/api/users/${e}`,videos:e=>`/api/users/${e}/videos`,likes:e=>`/api/users/${e}/likes`,myVideos:"/api/me/videos"},admin:{clearViews:"/api/admin/me/clear_views",debugState:"/api/debug/state",settingsModeration:"/api/admin/settings/moderation",videosPending:"/api/admin/videos/pending",videosApprove:e=>`/api/admin/videos/${e}/approve`,videosReject:e=>`/api/admin/videos/${e}/reject`,videosAction:(e,l)=>`/api/admin/videos/${e}/${l}`,analytics:"/api/admin/analytics",usersSearch:e=>`/api/admin/users/search?q=${encodeURIComponent(e)}`,userVideos:e=>`/api/admin/users/${e}/videos`,userUpdate:e=>`/api/admin/users/${e}`,notificationsSystem:"/api/admin/notifications/system"}},ke=({open:e,onClose:l,buttonRef:d,children:w,align:p="right",minWidth:y=160})=>{const[i,v]=a.useState(null),s=a.useRef(null);if(a.useEffect(()=>{if(!e||!d.current){v(null);return}const u=()=>{if(!d.current)return;const h=d.current.getBoundingClientRect();v({top:h.bottom+8,[p]:window.innerWidth-h[p==="right"?"right":"left"]})};return u(),window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),()=>{window.removeEventListener("resize",u),window.removeEventListener("scroll",u,!0)}},[e,d,p]),a.useEffect(()=>{if(!e)return;const u=h=>{s.current&&!s.current.contains(h.target)&&d.current&&!d.current.contains(h.target)&&l()};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[e,l,d]),!e||!i)return null;const R=t.jsx("div",{ref:s,style:{position:"fixed",top:i.top,[p]:i[p],background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:y,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:w});return Me.createPortal(R,document.body)},_e=({playbackUrl:e,streamUID:l,aspectRatio:d,preferNative:w=!1,autoplay:p=!1,loop:y=!1,muted:i=!1,controls:v=!0,onVideoRef:s,onClick:R,inOverlay:u=!1})=>{const h=typeof window<"u"&&window.matchMedia("(pointer: fine) and (min-width: 768px)").matches,f=a.useRef(null),[C,H]=a.useState(null),j=a.useMemo(()=>{const r=typeof d=="number"&&isFinite(d)&&d>0?d:null;return r||16/9},[d]),_=`${C??j} / 1`,g=a.useMemo(()=>e||(l?`https://videodelivery.net/${l}/manifest/video.m3u8`:null),[e,l]),z=a.useRef(null);a.useEffect(()=>{g&&(z.current=g)},[g]),a.useEffect(()=>{H(null)},[g]),a.useEffect(()=>{if(!w||!f.current)return;const r=f.current;let F=!1;const k=()=>{if(!F)if(r.videoWidth>0&&r.videoHeight>0){const D=r.videoWidth/r.videoHeight;H(D),F=!0}else H(j),F=!0};return r.addEventListener("loadedmetadata",k),r.readyState>=1&&k(),()=>{r.removeEventListener("loadedmetadata",k)}},[w,j,g]);const E=a.useRef(null),T=a.useRef(null);a.useEffect(()=>{if(!g)return;let r=E.current,F=null,k=!1,D=null;if(r&&T.current&&T.current!==g){console.log(`[HLS] URL changed from ${T.current} to ${g}, using loadSource`);try{r.stopLoad(),r.loadSource(g),T.current=g;const o=f.current;if(o)try{o.pause(),o.currentTime=0,o.load()}catch(b){console.warn("[HLS] Error resetting video element:",b)}}catch(o){console.error("[HLS] Error switching source:",o);try{r.destroy()}catch{}r=null,E.current=null,T.current=null}}if(r&&T.current===g)return console.log(`[HLS] URL unchanged (${g}), reusing existing HLS instance`),()=>{k=!0};const Z=()=>{if(document.hidden&&r){const o=f.current;if(o)try{o.pause()}catch{}try{r.stopLoad()}catch{}}},q=()=>{if(k=!0,r){try{r.stopLoad(),r.detachMedia(),r.destroy()}catch{}r=null}};document.addEventListener("visibilitychange",Z),window.addEventListener("beforeunload",q);const G=()=>{const o=f.current;if(!o||k)return;try{for(o.pause(),o.currentTime=0,o.src="",o.srcObject=null;o.firstChild;)o.removeChild(o.firstChild);o.load()}catch(c){console.warn("[HLS] Error resetting video element:",c)}const b=performance.now();if(console.log(`[HLS] Starting HLS setup for ${g} at ${b.toFixed(2)}ms`),console.log("[HLS] Video element ready:",{readyState:o.readyState,isConnected:o.isConnected,paused:o.paused,currentTime:o.currentTime}),B.isSupported()){console.log("[HLS] HLS.js is supported, creating instance");const c={enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,startLevel:-1,maxBufferLength:20,maxMaxBufferLength:60,maxBufferSize:60*1e3*1e3,maxBufferHole:.3,maxLoadingDelay:2,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxFragLoadingTimeMs:2e4,fragLoadingTimeOut:2e4,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,fragLoadingMaxRetry:3};try{const x=performance.now();r=new B(c),E.current=r,T.current=g;const L=performance.now()-x;console.log(`[HLS] HLS instance created in ${L.toFixed(2)}ms`);const A=performance.now();r.loadSource(g);const P=performance.now()-A;console.log(`[HLS] loadSource() called in ${P.toFixed(2)}ms`);const M=performance.now();r.attachMedia(o);const ee=performance.now()-M;console.log(`[HLS] attachMedia() completed in ${ee.toFixed(2)}ms`);const ie=performance.now()-b;console.log(`[HLS] Total HLS setup time: ${ie.toFixed(2)}ms`)}catch(x){const L=performance.now()-b;if(console.error(`[HLS] Failed to initialize HLS after ${L.toFixed(2)}ms:`,x),r){try{r.destroy()}catch{}r=null}return}r.on(B.Events.MANIFEST_PARSED,()=>{const x=performance.now()-b;if(console.log(`[HLS] MANIFEST_PARSED event fired at ${x.toFixed(2)}ms after setup start`),k||!o)return;y&&(D=()=>{if(!(k||!o||!r))try{o.currentTime=0,o.play().catch(A=>{A.name!=="AbortError"&&A.name!=="NotAllowedError"&&console.debug("Loop play failed:",A)})}catch{o.currentTime=0,o.play().catch(()=>{})}},o.addEventListener("ended",D)),(()=>{if(!(k||!o))if(o.readyState>=2){if(p){const A=performance.now();o.play().then(()=>{const P=performance.now()-A;console.log(`[HLS] Autoplay succeeded in ${P.toFixed(2)}ms after MANIFEST_PARSED`)}).catch(P=>{const M=performance.now()-A;P.name!=="AbortError"&&P.name!=="NotAllowedError"&&console.warn(`[HLS] Autoplay prevented after ${M.toFixed(2)}ms:`,P)})}}else{const A=()=>{if(!(k||!o)&&(o.removeEventListener("canplay",A),p)){const P=performance.now();o.play().then(()=>{const M=performance.now()-P;console.log(`[HLS] Autoplay succeeded in ${M.toFixed(2)}ms after canplay event`)}).catch(M=>{const ee=performance.now()-P;M.name!=="AbortError"&&M.name!=="NotAllowedError"&&console.warn(`[HLS] Autoplay prevented after ${ee.toFixed(2)}ms:`,M)})}};o.addEventListener("canplay",A,{once:!0})}})()}),r.on(B.Events.ERROR,(x,L)=>{if(!k&&L.fatal)switch(L.type){case B.ErrorTypes.NETWORK_ERROR:if(!k&&r)try{r.startLoad()}catch{}break;case B.ErrorTypes.MEDIA_ERROR:if(!k&&r)try{r.recoverMediaError()}catch{}break;default:r&&(r.destroy(),r=null);break}})}else k||console.warn("HLS.js not supported, falling back to native HLS"),o.src=g,o.loop=y,F=()=>{k||console.warn("Native HLS playback failed")},o.addEventListener("error",F),p&&!k&&o.play().catch(c=>{c.name!=="AbortError"&&c.name!=="NotAllowedError"&&console.debug("Autoplay prevented:",c)})};let Y=0;const X=10,V=()=>{if(k)return;if(Y++,Y>X){console.error("[HLS] Failed to setup HLS after max attempts - video element may not be ready");return}const o=f.current;if(!o){requestAnimationFrame(V);return}if(!o.isConnected){requestAnimationFrame(V);return}G()},J=requestAnimationFrame(()=>{requestAnimationFrame(V)});return()=>{cancelAnimationFrame(J),k=!0,document.removeEventListener("visibilitychange",Z),window.removeEventListener("beforeunload",q);const o=f.current;if(o&&D&&(o.removeEventListener("ended",D),D=null),r){try{r.stopLoad(),r.off(B.Events.MANIFEST_PARSED),r.off(B.Events.ERROR),r.off(B.Events.MEDIA_ATTACHED),r.off(B.Events.MEDIA_DETACHED),r.off(B.Events.MANIFEST_LOADED),r.off(B.Events.MEDIA_ATTACHING),r.off(B.Events.MEDIA_DETACHING),r.off(B.Events.DESTROYING),r.destroy()}catch{try{r&&r.detachMedia()}catch{}}r=null,E.current=null,T.current=null}if(o){F&&(o.removeEventListener("error",F),F=null);try{o.pause()}catch{}}}},[g,p]),a.useEffect(()=>(s&&f.current&&s(f.current),()=>{s&&s(null)}),[s,w,g]);const S=h||!u?{width:"auto",maxWidth:"100%",height:"100%",maxHeight:"100%",aspectRatio:_,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box",minWidth:0,minHeight:0,flexShrink:1,alignSelf:"center"}:{width:"100%",maxWidth:"100%",maxHeight:"calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 160px)",aspectRatio:_,background:"#000",borderRadius:10,overflow:"hidden",display:"flex",boxSizing:"border-box",minWidth:0,minHeight:0,flexShrink:1,alignSelf:"center"};return g?t.jsx("div",{style:S,children:t.jsx("video",{ref:f,autoPlay:p,loop:!1,muted:i,controls:v,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",background:"#000",cursor:R?"pointer":"default"},children:"Your browser does not support the video tag."})}):t.jsx("div",{style:S,children:"No video available"})};function Je({beatmapMeta:e,beatmapVersion:l}){const d=a.useRef(null),w=a.useRef(null),[p,y]=a.useState(!1),[i,v]=a.useState(!1),[s,R]=a.useState(0);a.useEffect(()=>{if(d.current&&w.current){const f=d.current.offsetWidth,C=w.current.scrollWidth;R(C),v(C>f)}},[e,l]);const u=e?t.jsxs(t.Fragment,{children:[e.artist," – ",e.title,e.mapper?` (by ${e.mapper})`:"",l?` [${l}]`:""]}):l?`[${l}]`:"Beatmap",h=s>0?Math.max(3,s/50):3;return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
        @keyframes beatmap-marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-100% - 1em)); }
        }
      `}),t.jsxs("div",{ref:d,className:"muted one-line",style:{fontSize:12,color:"#7b8491",flex:"0 1 auto",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",position:"relative",cursor:i?"pointer":"default"},onMouseEnter:()=>i&&y(!0),onMouseLeave:()=>y(!1),children:[t.jsx("span",{ref:w,style:{display:"inline-block",animation:p&&i?`beatmap-marquee ${h}s linear infinite`:"none"},children:u}),p&&i&&t.jsx("span",{style:{display:"inline-block",paddingLeft:"1em"},children:u})]})]})}function Ke(e){return"post_type"in e?e.post_type==="mappi":!!e.stream_uid}function Qe({post:e,section:l,onUpdate:d,onDelete:w,me:p}){const y=be(),i=ve(),v=l==="mappi"?i.pathname.startsWith("/mp/feed/"):i.pathname.startsWith("/md/feed/"),s=Ke(e);e.id;const R=s?e.stream_uid||String(e.id||""):e.uid||String(e.id||""),u=R&&R!=="null"&&R!=="undefined"?l==="mappi"?`/mp/feed/${R}`:`/md/feed/${R}`:l==="mappi"?`/mp/feed/${e.id}`:`/md/feed/${e.id}`,[h,f]=a.useState(!1),[C,H]=a.useState(!1),[j,N]=a.useState(!1),[_,g]=a.useState(!1),[z,E]=a.useState(!1),T=a.useRef(null),S=a.useRef(null),r=a.useRef(null),[F,k]=a.useState(null),[D,Z]=a.useState(null),{notify:q}=ce(),[G,Y]=a.useState(!1),[X,V]=a.useState(s?"":e.text??""),[J,o]=a.useState(e.beatmap_url||""),[b,c]=a.useState(null),[x,L]=a.useState(null),[A,P]=a.useState(""),M=a.useRef(0),ee=p&&((s?e.uploader&&p.id===e.uploader.id:p.id===e.user_id)||p.is_admin||p.is_mod),ie=(()=>{const n=e.created_at;if(!n)return"";const m=Math.floor(Date.now()/1e3)-n;return m<60?"just now":m<3600?`${Math.floor(m/60)}m`:m<86400?`${Math.floor(m/3600)}h`:m<604800?`${Math.floor(m/86400)}d`:new Date(n*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})})();a.useEffect(()=>{if(!G&&!s){const n=e;V(n.text??""),o(n.beatmap_url||""),c(null),L(null),P("")}},[e,G,s]),a.useEffect(()=>{if(!G||s)return;M.current&&window.clearTimeout(M.current);const n=(J||"").trim();if(!n){P(""),c(null),L(null);return}if(!/^https?:\/\/osu\.ppy\.sh\/(beatmapsets|beatmaps)\//i.test(n)){P(""),c(null),L(null);return}return M.current=window.setTimeout(async()=>{var $;try{let U;try{U=new URL(n)}catch{P("Invalid URL format");return}const ae=U.hash.match(/#osu\/(\d+)/),de=ae?ae[1]:null;U.hash="";const Q={url:U.toString()};de&&(Q.beatmap_id=de);const O=await W(I.osu.resolveBeatmap+xe(Q),{requireAuth:!1}),ne=Array.isArray(O==null?void 0:O.diffs)?O.diffs:[];if(!ne.length&&!O.setId){P("No difficulties found"),c(null),L(null);return}if(c({setId:Number(O.setId)||0,beatmapId:O.beatmapId??null,title:String(O.title||""),artist:String(O.artist||""),mapper:String(O.mapper||""),diffs:ne}),ne.length>0){const Ae=Number.isFinite(Number(O.beatmapId))?Number(O.beatmapId):Number(($=ne[0])==null?void 0:$.id),K=ne.find(Fe=>Number(Fe.id)===Ae)||ne[0];L({beatmapId:Number(K==null?void 0:K.id)||null,version:String((K==null?void 0:K.version)||""),mode:String((K==null?void 0:K.mode)||"standard")})}else L(null);P("")}catch(U){P(`Failed to resolve: ${(U==null?void 0:U.message)||"Unknown error"}`),c(null),L(null)}},400),()=>{M.current&&window.clearTimeout(M.current)}},[J,G,s]),a.useEffect(()=>{if(s||!e.beatmap_url||D)return;const n=e;let m=!1;return(async()=>{try{let $;try{$=new URL(n.beatmap_url)}catch{return}const U=$.hash.match(/#osu\/(\d+)/),ae=U?U[1]:null;$.hash="";const se={url:$.toString()};if(ae?se.beatmap_id=ae:n.beatmap_id&&(se.beatmap_id=String(n.beatmap_id)),!m){const Q=await W(I.osu.resolveBeatmap+xe(se),{requireAuth:!1});(Q.title||Q.artist)&&Z({title:Q.title||null,artist:Q.artist||null,mapper:Q.mapper||null})}}catch{}})(),()=>{m=!0}},[e,s,D]);const Le=async()=>{if(!(h||!s)){f(!0);try{const n=e.liked_by_me?"DELETE":"POST",m=await W(I.videos.like(e.id),{method:n}),$={...e,liked_by_me:!e.liked_by_me,likes_count:m.likes_count||e.likes_count};d&&d($)}catch{q("Failed to like",{variant:"error"})}finally{f(!1)}}},Ce=async()=>{if(!(C||s)){H(!0);try{const n=e.reacted_by_me?"DELETE":"POST",m=await W(I.moddi.postReact(e.id),{method:n}),$={...e,reacted_by_me:!e.reacted_by_me,reactions_count:m.reactions_count||e.reactions_count};d&&d($)}catch{q("Failed to react",{variant:"error"})}finally{H(!1)}}},me=async()=>{if(confirm(s?"Permanently delete this video?":"Permanently delete this post?")){try{const n=s?I.videos.delete(e.id):I.moddi.post(String(e.id));await W(n,{method:"DELETE"}),q(s?"Video deleted":"Post deleted",{variant:"warn"}),w&&w(e.id)}catch(n){q((n==null?void 0:n.message)||(s?"Failed to delete video":"Failed to delete post"),{variant:"error"})}g(!1)}},$e=async()=>{if(s){try{const n=!e.is_starred,m=n?"star":"unstar";await W(I.admin.videosAction(e.id,m),{method:"POST"});const $={...e,is_starred:n};d&&d($),q(n?"Post starred":"Star removed",{variant:"success"})}catch{q("Action failed",{variant:"error"})}g(!1)}},Re=()=>{s||(Y(!0),V(e.text??""),o(e.beatmap_url||""),c(null),L(null),P(""),g(!1))},Te=async()=>{if(!s)try{await W(I.moddi.post(String(e.id)),{method:"PATCH",body:JSON.stringify({text:X.trim(),beatmap_url:J.trim()||null,beatmapset_id:(b==null?void 0:b.setId)??void 0,beatmap_id:(x==null?void 0:x.beatmapId)??(b==null?void 0:b.beatmapId)??void 0,beatmap_version:(x==null?void 0:x.version)??void 0})});const n=await W(I.moddi.post(String(e.id)),{method:"GET",requireAuth:!1});d&&n.post&&d({...e,...n.post}),q("Post updated",{variant:"success"}),Y(!1)}catch(n){q((n==null?void 0:n.message)||"Failed to update post",{variant:"error"})}},Pe=()=>{Y(!1);const n=e;V(n.text??""),o(n.beatmap_url||""),c(null),L(null),P("")};a.useEffect(()=>{if(!j||!S.current){k(null);return}const n=()=>{if(S.current){const m=S.current.getBoundingClientRect();k({top:m.bottom+8,right:window.innerWidth-m.right})}};return n(),window.addEventListener("resize",n),window.addEventListener("scroll",n,!0),()=>{window.removeEventListener("resize",n),window.removeEventListener("scroll",n,!0)}},[j]),a.useEffect(()=>{if(!j)return;const n=m=>{T.current&&!T.current.contains(m.target)&&S.current&&!S.current.contains(m.target)&&N(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[j]);const Ne=n=>{const m=n.target;if(m.closest("button")||m.closest(".menu-panel")||m.closest("input")||m.closest("textarea")||m.closest("select"))return;const $=m.closest("a");$&&$.getAttribute("href")!==`#${u}`||y(u)},te=s?e.uploader||{id:0,username:"Unknown",avatar_url:null}:{id:e.user_id||0,username:e.username||"Unknown",avatar_url:e.avatar_url||null},re=!s&&(e.reacted_by_me===!0||e.reacted_by_me===1),pe=!s&&e.tags&&(typeof e.tags=="string"?e.tags.split(",").map(n=>n.trim()):[]).includes("help"),le=e.beatmapset_id,He=e.beatmap_id,Ie=e.beatmap_version;return t.jsxs("article",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease",position:"relative",cursor:"pointer"},onMouseEnter:n=>n.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:n=>n.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",onClick:Ne,children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[te.avatar_url?t.jsx(oe,{to:`/profile/${te.id}`,onClick:n=>n.stopPropagation(),style:{flexShrink:0},children:t.jsx("img",{src:te.avatar_url,width:40,height:40,style:{borderRadius:"50%",border:"1px solid rgba(255,255,255,0.08)",display:"block"},alt:te.username})}):t.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.08)",flexShrink:0}}),t.jsx(oe,{to:u,style:{flex:1,minWidth:0,textDecoration:"none",color:"inherit",display:"block"},onClick:n=>{const m=n.target,$=m.closest("a");if($&&$!==n.currentTarget){n.preventDefault(),n.stopPropagation();return}if(m.closest("button")||m.closest(".menu-panel")||m.closest("input")||m.closest("textarea")||m.closest("select")){n.preventDefault(),n.stopPropagation();return}n.stopPropagation()},children:t.jsxs("div",{style:{flex:1,minWidth:0,width:"100%"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6,marginBottom:6},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx(oe,{to:`/profile/${te.id}`,style:{textDecoration:"none",color:"inherit",fontWeight:600,fontSize:14},onClick:n=>n.stopPropagation(),onMouseEnter:n=>n.currentTarget.style.color="#7dd3fc",onMouseLeave:n=>n.currentTarget.style.color="inherit",children:te.username}),s&&e.is_starred&&t.jsx(ye,{size:14,color:"#f59e0b",title:"Starred"}),s&&e.mode&&t.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:"rgba(125, 211, 252, 0.2)",border:"1px solid rgba(125, 211, 252, 0.4)",color:"#7dd3fc",fontWeight:500,lineHeight:1.2,textTransform:"capitalize"},children:e.mode}),!s&&pe&&t.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:10,background:"rgba(234, 179, 8, 0.2)",border:"1px solid rgba(234, 179, 8, 0.4)",color:"#fbbf24",fontWeight:500,lineHeight:1.2},children:"Help"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[ie&&t.jsx("span",{className:"muted",style:{fontSize:13},children:ie}),ee&&t.jsx("button",{ref:r,onClick:n=>{n.preventDefault(),n.stopPropagation(),g(m=>!m)},style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",padding:4,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4},onMouseEnter:n=>n.currentTarget.style.backgroundColor="rgba(255,255,255,0.05)",onMouseLeave:n=>n.currentTarget.style.backgroundColor="transparent","aria-label":"Post options",children:t.jsx(we,{size:16})})]})]}),s&&v&&e.playback_url&&t.jsx("div",{style:{marginBottom:10,borderRadius:8,overflow:"hidden",background:"#0b0d10"},children:t.jsx(_e,{playbackUrl:e.playback_url,streamUID:e.stream_uid,aspectRatio:e.width&&e.height?e.width/e.height:null})}),s&&!v&&e.poster_url&&t.jsxs("div",{style:{marginBottom:10,borderRadius:8,overflow:"hidden",background:"#0b0d10",aspectRatio:e.width&&e.height?`${e.width} / ${e.height}`:"16 / 9",position:"relative"},children:[t.jsx("img",{src:e.poster_url,alt:"Video thumbnail",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}),e.duration_sec&&t.jsxs("div",{style:{position:"absolute",bottom:8,right:8,background:"rgba(0,0,0,0.7)",color:"#fff",padding:"2px 6px",borderRadius:4,fontSize:11,fontWeight:500},children:[Math.floor(e.duration_sec/60),":",(e.duration_sec%60).toFixed(0).padStart(2,"0")]})]}),!s&&G?t.jsx("div",{style:{marginBottom:12},children:t.jsxs("div",{className:"col",style:{gap:8},children:[t.jsx("textarea",{value:X,onChange:n=>V(n.target.value),maxLength:200,rows:2,style:{background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:8,color:"var(--text)",fontFamily:"inherit",fontSize:14,resize:"vertical",width:"100%"}}),b?t.jsxs("div",{className:"row",style:{alignItems:"center",gap:6,flexWrap:"wrap"},children:[t.jsxs("div",{className:"chip-btn",style:{cursor:"default",fontSize:12,padding:"4px 8px"},children:[t.jsxs("strong",{style:{marginRight:4},children:[b.artist," – ",b.title]}),t.jsxs("span",{className:"muted",style:{fontSize:11},children:["by ",b.mapper]})]}),b.diffs.length>0&&t.jsx("select",{value:(x==null?void 0:x.beatmapId)??(b==null?void 0:b.beatmapId)??void 0,onChange:n=>{const m=Number(n.target.value),$=(b==null?void 0:b.diffs.find(U=>Number(U.id)===m))||null;$&&L({beatmapId:m,version:$.version,mode:String($.mode||"standard")})},style:{background:"var(--panel-dark)",color:"var(--text)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"4px 8px",fontSize:12},children:b.diffs.map(n=>t.jsxs("option",{value:n.id,children:[n.version," (",n.mode,")"]},n.id))}),t.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{c(null),L(null),o("")},style:{padding:"6px 12px",fontSize:13},children:"Clear"})]}):t.jsx("input",{type:"url",placeholder:"Beatmap URL (optional)",value:J,onChange:n=>o(n.target.value),style:{fontSize:13,padding:"6px 8px"}}),A&&t.jsx("div",{className:"muted",style:{color:"var(--danger)",fontSize:11},children:A}),t.jsxs("div",{className:"row",style:{gap:8,justifyContent:"flex-end"},children:[t.jsx("button",{className:"btn secondary",onClick:Pe,style:{padding:"6px 12px",fontSize:13},children:"Cancel"}),t.jsx("button",{className:"btn",onClick:Te,style:{padding:"6px 12px",fontSize:13},children:"Save"})]})]})}):t.jsxs(t.Fragment,{children:[(()=>{if(s){const n=e.description??"";return n.trim()?t.jsx("div",{style:{marginBottom:e.beatmap_url?12:10,wordBreak:"break-word",fontSize:14,lineHeight:1.6,color:"rgba(255,255,255,0.9)"},children:n}):null}else{const n=e.text??"";return n.trim()?t.jsx("div",{style:{marginBottom:e.beatmap_url?12:10,wordBreak:"break-word",fontSize:14,lineHeight:1.6,color:"rgba(255,255,255,0.9)"},children:n}):null}})(),s&&e.beatmap_title&&t.jsxs("div",{style:{marginBottom:10,fontSize:12,color:"#7b8491",lineHeight:1.4},children:[e.beatmap_artist," – ",e.beatmap_title," ",e.beatmap_mapper?`(by ${e.beatmap_mapper})`:""," ",e.beatmap_version?`[${e.beatmap_version}]`:""]}),!G&&t.jsxs("div",{className:"row post-actions",style:{alignItems:"center",gap:8,marginTop:8,position:"relative",justifyContent:"flex-start",flexWrap:"nowrap"},children:[s&&e.beatmap_url&&!e.beatmap_title&&t.jsx("div",{className:"muted one-line",style:{fontSize:12,color:"#7b8491",flex:"0 1 auto",minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"Beatmap"}),!s&&e.beatmap_url&&(D||e.beatmapset_id||e.beatmap_id)&&t.jsx(Je,{beatmapMeta:D,beatmapVersion:e.beatmap_version}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexShrink:0,marginLeft:"auto"},children:[s&&t.jsxs("span",{className:"views-badge","aria-label":"Views",title:"Views",onClick:n=>{n.preventDefault(),n.stopPropagation()},children:[t.jsx(ze,{size:12}),t.jsx("span",{children:e.views_count??0})]}),t.jsxs("span",{className:"views-badge","aria-label":"Comments",title:"Comments",onClick:n=>{n.preventDefault(),n.stopPropagation()},children:[t.jsx(De,{size:12}),t.jsx("span",{children:e.comments_count??0})]}),s?t.jsxs("button",{className:`chip-btn like ${e.liked_by_me?"liked":""}`,onClick:n=>{n.preventDefault(),n.stopPropagation(),Le()},disabled:h,"aria-label":e.liked_by_me?"Unlike":"Like",title:e.liked_by_me?"Unlike":"Like",children:[e.liked_by_me?t.jsx(fe,{size:16}):t.jsx(he,{size:16}),t.jsx("span",{children:e.likes_count||0})]}):t.jsxs("button",{className:`chip-btn like ${re?"liked":""}`,onClick:n=>{n.preventDefault(),n.stopPropagation(),Ce()},disabled:C,"aria-label":re?"Remove reaction":"React",title:re?"Remove reaction":"React",children:[pe?t.jsx("span",{style:{fontSize:16,lineHeight:1},children:"✋"}):re?t.jsx(fe,{size:16}):t.jsx(he,{size:16}),t.jsx("span",{children:e.reactions_count||0})]}),e.beatmap_url&&t.jsxs("button",{ref:S,className:"chip-btn link",onClick:n=>{n.preventDefault(),n.stopPropagation(),N(m=>!m)},title:"Beatmap options","aria-label":"Beatmap options",children:[t.jsx(ge,{size:16}),t.jsx("span",{className:"muted",style:{fontSize:12},children:"Beatmap"}),t.jsx(Se,{size:14,style:{marginLeft:4,opacity:.7}})]})]})]})]})]})})]}),j&&F&&e.beatmap_url&&t.jsxs("div",{ref:T,style:{position:"fixed",top:F.top,right:F.right,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:1e3,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[t.jsxs("a",{className:"menu-item",href:e.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>N(!1),children:[t.jsx(ge,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),le&&t.jsx("button",{className:"menu-item",onClick:()=>{E(!0),N(!1)},children:"Preview"})]}),z&&le&&t.jsx(Ge,{open:z,onClose:()=>E(!1),downloadUrl:`${ue}${I.osu.downloadBeatmapset(le)}`,beatmapId:He??void 0,beatmapVersion:Ie??void 0}),ee&&t.jsx(ke,{open:_,onClose:()=>g(!1),buttonRef:r,minWidth:160,children:s?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"menu-item",onClick:n=>{n.preventDefault(),n.stopPropagation(),$e()},children:e.is_starred?"Unstar post":"Star post"}),t.jsx("button",{className:"menu-item",onClick:n=>{n.preventDefault(),n.stopPropagation(),me()},children:"Delete video"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"menu-item",onClick:Re,children:"Edit post"}),t.jsx("button",{className:"menu-item",onClick:me,children:"Delete post"})]})})]})}function Ee({comment:e,replies:l,me:d,onReply:w,onDelete:p,replyingTo:y,replyText:i,onReplyTextChange:v,onReplySubmit:s,posting:R,onCancelReply:u,section:h,repliesMap:f}){const[C,H]=a.useState(!1),j=a.useRef(null),{notify:N}=ce(),[_,g]=a.useState(!1),z=e.parent_id!==null,E=d&&(d.id===e.user_id||d.is_admin||d.is_mod),T=async()=>{if(confirm("Delete this comment?"))try{const S=h==="mappi"?I.videos.comments(e.post_id)+`/${e.id}`:I.moddi.postComments(e.post_id)+`/${e.id}`;await W(S,{method:"DELETE"}),p(e.id),N("Comment deleted",{variant:"success"})}catch{N("Failed to delete comment",{variant:"error"})}finally{H(!1)}};return t.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.01)",transition:"background-color 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.backgroundColor="rgba(255,255,255,0.025)",onMouseLeave:S=>S.currentTarget.style.backgroundColor="rgba(255,255,255,0.01)",children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[t.jsx("span",{style:{fontSize:13,fontWeight:500},children:e.username}),t.jsx("span",{className:"muted",style:{fontSize:11},children:new Date(e.created_at*1e3).toLocaleDateString()})]}),t.jsx("div",{style:{fontSize:14,lineHeight:1.5,wordBreak:"break-word"},children:e.text}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:t.jsxs("button",{onClick:()=>w(e.id),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:12,padding:0},children:[t.jsx(qe,{size:14}),"Reply"]})}),y===e.id&&d&&t.jsx("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"},children:t.jsxs("form",{onSubmit:s,style:{display:"flex",alignItems:"flex-end",gap:6},children:[t.jsx("textarea",{placeholder:`Reply to ${e.username}...`,value:i||"",onChange:S=>v==null?void 0:v(S.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:12,resize:"none",minHeight:"28px",maxHeight:"100px",overflowY:"auto"},onInput:S=>{const r=S.target;r.style.height="auto",r.style.height=`${Math.min(r.scrollHeight,100)}px`},autoFocus:!0}),t.jsx("button",{type:"submit",className:"btn compact",disabled:R||!(i!=null&&i.trim()),style:{padding:"5px 10px",fontSize:11,flexShrink:0},children:R?"...":"Reply"}),u&&t.jsx("button",{type:"button",onClick:u,style:{padding:"5px 10px",fontSize:11,flexShrink:0,background:"transparent",border:"1px solid rgba(255,255,255,0.12)",color:"var(--muted)",borderRadius:6,cursor:"pointer"},children:"Cancel"})]})})]}),E&&t.jsxs("div",{style:{position:"relative"},children:[t.jsx("button",{ref:j,className:"icon-link",onClick:()=>H(!C),style:{width:"auto",height:"auto",padding:"4px"},title:"More options","aria-label":"More options",children:t.jsx(we,{size:16})}),t.jsx(ke,{open:C,onClose:()=>H(!1),buttonRef:j,children:t.jsx("button",{className:"menu-item",onClick:T,style:{color:"var(--danger)"},children:"Delete"})})]})]}),l.length>0&&t.jsxs("div",{style:{marginTop:12,marginLeft:16,paddingLeft:16,borderLeft:"1px solid rgba(255,255,255,0.06)"},children:[z&&t.jsxs("button",{onClick:()=>g(!_),style:{background:"transparent",border:"none",color:"var(--muted)",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4,fontSize:11,padding:"4px 0",marginBottom:4},children:[_?t.jsx(Se,{size:12}):t.jsx(Be,{size:12}),_?"Hide":"Show"," ",l.length," ",l.length===1?"reply":"replies"]}),(!z||_)&&t.jsx(t.Fragment,{children:l.map(S=>t.jsx(Ee,{comment:S,replies:(f==null?void 0:f.get(S.id))||[],me:d,onReply:w,onDelete:p,replyingTo:y,replyText:i,onReplyTextChange:v,onReplySubmit:s,posting:R,onCancelReply:u,section:h,repliesMap:f},S.id))})]})]})}const Ze=({streamUID:e,playbackUrl:l,aspectRatio:d,onClose:w,headerLeft:p,headerRight:y,children:i,beatmapDownloadUrl:v,beatmapVersion:s,beatmapId:R,onOpenInEditor:u})=>{const h=typeof d=="number"&&isFinite(d)&&d>0?d:1.7777777777777777,f=!!v;return t.jsxs("div",{className:"overlay",role:"dialog","aria-modal":"true",onClick:C=>C.stopPropagation(),children:[t.jsx("div",{className:"overlay-backdrop",onClick:w}),t.jsxs("div",{className:"overlay-card",onClick:C=>C.stopPropagation(),children:[t.jsx("button",{className:"overlay-close",onClick:w,"aria-label":"Close",children:t.jsx(We,{size:18})}),t.jsx("div",{className:"section-panel",style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:f?"500px":"auto",height:"auto",maxHeight:f?"80vh":"calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 160px)",width:"100%",maxWidth:"100%",overflow:"hidden",boxSizing:"border-box",flexShrink:1,minWidth:0},onClick:C=>C.stopPropagation(),children:f?t.jsx("div",{style:{width:"100%",maxWidth:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box",minHeight:0},children:t.jsx(Xe,{downloadUrl:v,beatmapVersion:s,beatmapId:R,onOpenInEditor:u})}):t.jsx(_e,{streamUID:e||void 0,playbackUrl:l||void 0,aspectRatio:h,inOverlay:!0})}),(p||y||i)&&t.jsxs("div",{className:"section-panel",children:[(p||y)&&t.jsxs("div",{className:"row-between",children:[t.jsx("div",{className:"row",style:{alignItems:"center"},children:p}),y?t.jsx("div",{className:"row post-actions",style:{gap:8,position:"relative"},children:y}):t.jsx("div",{})]}),i]})]})]})};function rt(){var V,J,o,b;const{uid:e}=Ue(),[l,d]=Oe(),w=be(),y=((V=ve().state)==null?void 0:V.returnTo)||"/mp/feed",[i,v]=a.useState(null),[s,R]=a.useState([]),[u,h]=a.useState(!0),[f,C]=a.useState(null),[H,j]=a.useState(""),[N,_]=a.useState(null),[g,z]=a.useState(!1),[E,T]=a.useState(!1),{notify:S}=ce(),r=a.useRef(new Set);a.useEffect(()=>{W(I.auth.me,{requireAuth:!1}).then(c=>C(c)).catch(()=>{})},[]),a.useEffect(()=>{l.get("preview")==="true"&&T(!0)},[l]);const F=async()=>{if(e){h(!0);try{const c=await W(I.videos.get(e),{requireAuth:!1});v(c)}catch{S("Failed to load post",{variant:"error"}),w(y)}finally{h(!1)}}},k=async()=>{if(i!=null&&i.id)try{const c=await W(I.videos.comments(i.id),{requireAuth:!1});R(c.items||[])}catch{}};a.useEffect(()=>{F()},[e]),a.useEffect(()=>{i!=null&&i.id&&k()},[i==null?void 0:i.id]),a.useEffect(()=>{i!=null&&i.id&&(r.current.has(i.id)||(r.current.add(i.id),W(I.videos.view(i.id),{method:"POST"}).then(c=>{if(!c)return;const x=Number(c.views_count??0);v(L=>L?{...L,views_count:x,viewed_by_me:!0}:null)}).catch(()=>{})))},[i==null?void 0:i.id]);const D=c=>{"stream_uid"in c&&v(c)},Z=()=>{w(y)},q=async c=>{if(c.preventDefault(),!(!H.trim()||!(i!=null&&i.id))){z(!0);try{await W(I.videos.comments(i.id),{method:"POST",body:JSON.stringify({text:H.trim(),parent_id:N||void 0})}),j(""),_(null),k(),F(),S("Comment posted!",{variant:"success"})}catch(x){S((x==null?void 0:x.message)||"Failed to post comment",{variant:"error"})}finally{z(!1)}}},G=c=>{R(x=>x.filter(L=>L.id!==c))};if(u)return t.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Loading..."});if(!i)return t.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"Post not found"});const Y=s.filter(c=>!c.parent_id),X=new Map;return s.filter(c=>c.parent_id).forEach(c=>{const x=c.parent_id;X.has(x)||X.set(x,[]),X.get(x).push(c)}),t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{width:"100%",maxWidth:"600px",margin:"0 auto",padding:"0 16px"},children:[t.jsxs("div",{style:{paddingTop:16,marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[t.jsx("button",{className:"icon-link",onClick:()=>w(y),style:{width:"auto",height:"auto",padding:"4px",background:"transparent"},title:"Back","aria-label":"Back",children:t.jsx(Ve,{size:20})}),t.jsx("span",{style:{fontSize:20,fontWeight:600,lineHeight:1},children:"Post"})]}),t.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:t.jsx(Qe,{post:i,section:"mappi",onUpdate:D,onDelete:Z,me:f})}),f&&!N&&t.jsx("div",{style:{marginTop:12,marginBottom:12,padding:"8px 12px",background:"rgba(255,255,255,0.01)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:6},children:t.jsxs("form",{onSubmit:q,style:{display:"flex",alignItems:"flex-end",gap:8},children:[t.jsx("textarea",{placeholder:"Write a comment...",value:H,onChange:c=>j(c.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"6px 10px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"32px",maxHeight:"120px",overflowY:"auto"},onInput:c=>{const x=c.target;x.style.height="auto",x.style.height=`${Math.min(x.scrollHeight,120)}px`}}),t.jsx("button",{type:"submit",className:"btn compact",disabled:g||!H.trim(),style:{padding:"6px 12px",fontSize:12,flexShrink:0},children:g?"...":"Post"})]})}),t.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:Y.length===0?t.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):t.jsx("div",{className:"col",style:{gap:0},children:Y.map(c=>t.jsx(Ee,{comment:c,replies:X.get(c.id)||[],me:f,section:"mappi",onReply:x=>_(x),onDelete:G,replyingTo:N,replyText:H,onReplyTextChange:j,onReplySubmit:q,posting:g,onCancelReply:()=>{_(null),j("")},repliesMap:X},c.id))})})]}),i&&E&&i.beatmapset_id&&t.jsx(Ze,{streamUID:null,playbackUrl:null,aspectRatio:16/9,onClose:()=>{T(!1),d({})},beatmapDownloadUrl:`${ue}${I.osu.downloadBeatmapset(i.beatmapset_id)}`,beatmapId:i.beatmap_id??void 0,beatmapVersion:i.beatmap_version??void 0,onOpenInEditor:()=>{T(!1),d({}),window.location.hash="/editor"},headerLeft:t.jsxs(t.Fragment,{children:[((J=i.uploader)==null?void 0:J.avatar_url)&&t.jsx("img",{src:i.uploader.avatar_url,width:28,height:28,style:{borderRadius:"50%"}}),t.jsxs(oe,{to:`/profile/${(o=i.uploader)==null?void 0:o.id}`,style:{marginLeft:6,display:"inline-flex",alignItems:"center",gap:6,textDecoration:"none",color:"inherit",fontWeight:700},children:[t.jsx("span",{children:(b=i.uploader)==null?void 0:b.username}),i.is_starred?t.jsx(ye,{size:14,color:"#f59e0b",title:"Starred"}):null]})]})})]})}export{I as A,Ee as C,Qe as P,it as T,W as a,xe as b,ue as c,_e as d,rt as e,Ye as g,ce as u};
