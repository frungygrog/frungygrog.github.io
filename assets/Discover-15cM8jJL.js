const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-CnqFYqIJ.js","assets/index-D6qh1hkn.js","assets/vendor-react-_vsaDC62.js","assets/vendor-DBgzFpze.js","assets/editor-components-CKFEosPJ.js","assets/editor-components-Bzmrvihl.css","assets/index-Do5egyzH.css"])))=>i.map(i=>d[i]);
import{u as vt,a as w,A as x,_ as Y,B as Et,b as nt}from"./index-D6qh1hkn.js";import{r as i,R as he,i as _t,j as s,b as St,a as It,L as rt,p as jt,D as kt,E as Rt,G as st,I as Dt,J as ot,A as Ot,c as Ct}from"./vendor-react-_vsaDC62.js";import{P as Tt}from"./Popup-CnqFYqIJ.js";import{P as At}from"./beatmap-preview-iFLBdsja.js";import{C as Lt}from"./Comment-D6hXNjCM.js";import"./vendor-DBgzFpze.js";import"./editor-components-CKFEosPJ.js";import"./editor-lib-BGkr3wNG.js";const _={};function Ut(){var Ze,et,tt;const[b,N]=i.useState(_.history||[]),[u,B]=i.useState(_.index||-1),t=u>=0?b[u]:null,[te,Le]=i.useState(!1),[it,$e]=i.useState(!1),[at,Ne]=i.useState(!1),[pe,ne]=i.useState(!1),ge=he.useRef(null),[xe,be]=i.useState(!1),ye=he.useRef(null),[P,ct]=i.useState(null),[we,G]=i.useState(!1),[ve,re]=i.useState(!1),Ee=he.useRef(null),_e=he.useRef(null),[f,Se]=i.useState(!1),[Pe,Fe]=i.useState([]),[J,se]=i.useState(""),[Ie,je]=i.useState(null),[ke,Me]=i.useState(!1),[F,K]=i.useState(!0),{notify:O}=vt(),[S,X]=i.useState(_.queue||[]),M=i.useRef(_.seenIds||new Set),Ve=i.useRef(new Set),Re=i.useRef(!1),ze=i.useRef(null),[Be,Q]=i.useState(_.eligibleCount||null),[Ue,Z]=i.useState(_.viewedCount||0),[U,W]=i.useState(!1),j=i.useRef(_.lastShownVideoId||null),C=i.useRef(0);i.useEffect(()=>()=>{_.history=b,_.index=u,_.queue=S,_.seenIds=M.current,_.eligibleCount=Be,_.viewedCount=Ue,_.lastShownVideoId=j.current},[b,u,S,Be,Ue]);function lt(){try{const e=Array.from(M.current).slice(-200);localStorage.setItem("feed_seen_ids",JSON.stringify(e))}catch{}}function oe(){try{const e=localStorage.getItem("filter_modes"),n=(e?String(e):"standard").toLowerCase().split(",").map(a=>a.trim()).filter(Boolean),r=["standard","taiko","mania","catch"],o=Array.from(new Set(n.filter(a=>r.includes(a))));return o.length?o:["standard"]}catch{return["standard"]}}const dt=()=>{const e=new Set;return j.current!==null&&e.add(j.current),Array.from(M.current).slice(-200).forEach(r=>e.add(r)),S.forEach(r=>e.add(r.id)),Array.from(e)},We=async(e=5)=>{var n,r,o,a,c,g,v,E,I,R;if(Re.current)return[];Re.current=!0;try{const $=dt(),T=oe().join(",");if(ze.current!==!1)try{const l=await w(x.feed.batch+nt({size:String(e),exclude:$.join(","),modes:T}),{requireAuth:!1}),d=l&&Array.isArray(l.items)?l.items:[],p=new Set,D=d.filter(y=>p.has(y.id)?!1:(p.add(y.id),!0)),V=new Set(S.map(y=>y.id)),L=D.filter(y=>!M.current.has(y.id)&&!V.has(y.id)&&y.id!==j.current);if(L.length>0&&X(y=>{const z=new Set(y.map(ee=>ee.id)),H=L.filter(ee=>!z.has(ee.id));return[...y,...H]}),L.length===0&&S.length===0)try{const y=await w(x.feed.progress(T),{requireAuth:!1}),z=Number(y.eligible||0),H=Number(y.viewed||0);Q(z),Z(H),W(z>0&&H>=z)}catch{}return L}catch(l){if((n=l==null?void 0:l.message)!=null&&n.includes("401")||(r=l==null?void 0:l.message)!=null&&r.includes("Unauthorized"))return Ne(!0),[];if((o=l==null?void 0:l.message)!=null&&o.includes("429")||(a=l==null?void 0:l.message)!=null&&a.includes("rate limit"))return O("Please slow down a bit.",{durationMs:4e3,variant:"warn"}),[];((c=l==null?void 0:l.message)!=null&&c.includes("404")||(g=l==null?void 0:l.message)!=null&&g.includes("Not Found"))&&(ze.current=!1)}const A=[],m=new Set(S.map(l=>l.id));let h=[...$];for(let l=0;l<e;l++)try{const d=await w(x.feed.next+nt({exclude:h.join(","),modes:T}),{requireAuth:!1}),p=d&&("id"in d?d:d.video)||null;if(!p)break;if(M.current.has(p.id)||m.has(p.id)||p.id===j.current){h.push(p.id);continue}A.push(p),h.push(p.id),m.add(p.id)}catch(d){(v=d==null?void 0:d.message)!=null&&v.includes("401")||(E=d==null?void 0:d.message)!=null&&E.includes("Unauthorized")?Ne(!0):((I=d==null?void 0:d.message)!=null&&I.includes("429")||(R=d==null?void 0:d.message)!=null&&R.includes("rate limit"))&&O("Please slow down a bit.",{durationMs:3e3,variant:"warn"});break}if(A.length>0&&X(l=>{const d=new Set(l.map(D=>D.id)),p=A.filter(D=>!d.has(D.id));return[...l,...p]}),A.length===0&&S.length===0)try{const l=await w(x.feed.progress(T),{requireAuth:!1});Q(Number(l.eligible||0)),Z(Number(l.viewed||0)),W(Number(l.caught_up||0)===1)}catch{}return A}catch{return[]}finally{Re.current=!1}},ie=async()=>{if(!te){Le(!0);try{S.length<=2&&We(5).catch(()=>{});let e;if(S.length>0)e=S[0],e&&X(n=>n.filter(o=>o.id!==e.id));else{const n=await We(3);n.length>0&&(e=n[0],n.length>1&&X(r=>{const o=new Set(r.map(c=>c.id)),a=n.slice(1).filter(c=>!o.has(c.id));return[...r,...a]}))}if(e){if(j.current=e.id,M.current.add(e.id),lt(),C.current+=1,N(n=>{const r=[...n.slice(0,u+1),e];return B(r.length-1),r}),!Ve.current.has(e.id)){Ve.current.add(e.id);try{const n=await w(x.videos.view(e.id),{method:"POST"});n&&N(r=>{const o=[...r],a=o.findIndex(c=>c.id===e.id);return a!==-1&&(o[a]={...o[a],views_count:n.views_count??o[a].views_count??0,viewed_by_me:!0}),o})}catch{}}}else try{const n=oe().join(","),r=await w(x.feed.progress(n),{requireAuth:!1}),o=Number(r.eligible||0),a=Number(r.viewed||0);Q(o),Z(a),W(o>0&&a>=o)}catch{}}finally{Le(!1)}}},De=()=>{const e=performance.now();if(console.log(`[NAVIGATION] goPrev() called at ${e.toFixed(2)}ms`),console.log(`[NAVIGATION] Current state: index=${u}, history.length=${b.length}, currentVideo.id=${(t==null?void 0:t.id)||"null"}`),u>0){const n=u-1,r=b[n];if(console.log(`[NAVIGATION] Navigating back to index ${n}, video.id=${(r==null?void 0:r.id)||"null"}, stream_uid=${(r==null?void 0:r.stream_uid)||"null"}`),r!=null&&r.stream_uid&&Y(async()=>{const{skipCacheForVideo:c}=await import("./Popup-CnqFYqIJ.js").then(g=>g.h);return{skipCacheForVideo:c}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({skipCacheForVideo:c})=>{c(r.stream_uid),console.log(`[NAVIGATION] Marked video ${r.stream_uid} to skip cache for backward navigation`)}),r){const c=j.current;j.current=r.id,console.log(`[NAVIGATION] Updated lastShownVideoId from ${c} to ${r.id}`)}const o=C.current;C.current+=1,console.log(`[NAVIGATION] Incremented navigationKey from ${o} to ${C.current} to force Player remount`),B(n),G(!1);const a=performance.now()-e;console.log(`[NAVIGATION] goPrev() completed in ${a.toFixed(2)}ms, new index=${n}`)}else console.warn(`[NAVIGATION] goPrev() called but index=${u} <= 0, cannot go back`)},Oe=()=>{if(!F&&(de.current=!0,Te.current=!0,k.current)){const e=k.current;e.muted=!1,K(!1),e.play().catch(()=>{})}if(u<b.length-1){const e=b[u+1];e&&(j.current=e.id),C.current+=1,B(u+1),G(!1);return}U||ie()},ae=i.useRef(0),ce=i.useRef(null),le=i.useRef(null),Ce=i.useRef({goNext:Oe,goPrev:De,index:u,history:b,loading:te,exhausted:U});i.useEffect(()=>{Ce.current={goNext:Oe,goPrev:De,index:u,history:b,loading:te,exhausted:U}},[Oe,De,u,b,te,U]),i.useEffect(()=>{const e=Qe.current;if(!e)return;const n=a=>{if(e){const E=e.getBoundingClientRect(),I=a.clientX,R=a.clientY;if(I<E.left||I>E.right||R<E.top||R>E.bottom)return}a.preventDefault(),a.stopPropagation();const c=Date.now();if(c<ae.current||(ae.current=c+1e3,Math.abs(a.deltaY)<Math.abs(a.deltaX)))return;const{goNext:g,goPrev:v}=Ce.current;a.deltaY>0?g():v()},r=a=>{ce.current=a.touches[0].clientY,le.current=Date.now()},o=a=>{if(ce.current===null||le.current===null)return;const c=a.changedTouches[0].clientY,g=Date.now(),v=ce.current-c,E=g-le.current;if(ce.current=null,le.current=null,Math.abs(v)<50||E>300)return;const I=Date.now();if(I<ae.current)return;ae.current=I+1e3;const{goNext:R,goPrev:$}=Ce.current;v>0?R():$()};return e.addEventListener("wheel",n,{passive:!1,capture:!0}),e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",o,{passive:!0}),window.addEventListener("wheel",n,{passive:!1,capture:!0}),()=>{e.removeEventListener("wheel",n,{capture:!0}),e.removeEventListener("touchstart",r),e.removeEventListener("touchend",o),window.removeEventListener("wheel",n,{capture:!0})}},[]);const ut=async()=>{var e,n;if(t){$e(!0);try{const r=t.liked_by_me?"DELETE":"POST",o=await w(x.videos.like(t.id),{method:r});N(a=>{const c=[...a];return c[u]={...c[u],liked_by_me:!t.liked_by_me,likes_count:o.likes_count},c})}catch(r){((e=r==null?void 0:r.message)!=null&&e.includes("429")||(n=r==null?void 0:r.message)!=null&&n.includes("rate limit"))&&O("Please slow down a bit.",{durationMs:5e3,variant:"warn"})}finally{$e(!1)}}};async function qe(e){if(t)try{await w(x.videos.flag(t.id),{method:"POST",body:JSON.stringify({reason:e})}),O("Thanks for your report.",{variant:"info"})}catch{O("Report failed",{variant:"error"})}finally{ne(!1)}}i.useEffect(()=>{if(!pe)return;const e=n=>{ge.current&&!ge.current.contains(n.target)&&ne(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[pe]),i.useEffect(()=>{if(!xe)return;const e=n=>{ye.current&&!ye.current.contains(n.target)&&be(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[xe]),i.useEffect(()=>{if(!ve)return;const e=n=>{Ee.current&&!Ee.current.contains(n.target)&&_e.current&&!_e.current.contains(n.target)&&re(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ve]),i.useEffect(()=>{b.length===0&&ie()},[]),i.useEffect(()=>{t&&(j.current=t.id)},[t==null?void 0:t.id]),i.useEffect(()=>{(async()=>{try{const e=oe().join(","),n=await w(x.feed.progress(e),{requireAuth:!1}),r=Number(n.eligible||0),o=Number(n.viewed||0);Q(r),Z(o);const a=r>0&&o>=r;W(a)}catch{}})()},[]),i.useEffect(()=>{const e=()=>{N([]),X([]),M.current.clear(),j.current=null,C.current=0,B(-1),W(!1),(async()=>{try{const n=oe().join(","),r=await w(x.feed.progress(n),{requireAuth:!1}),o=Number(r.eligible||0),a=Number(r.viewed||0);Q(o),Z(a),W(!1)}catch{}ie()})()};return window.addEventListener("filterchange",e),()=>window.removeEventListener("filterchange",e)},[]),i.useEffect(()=>{try{const e=localStorage.getItem("feed_seen_ids");if(e){const n=JSON.parse(e);if(Array.isArray(n))for(const r of n)typeof r=="number"&&M.current.add(r)}}catch{}},[]),i.useEffect(()=>{(async()=>{try{const e=await w(x.auth.me,{requireAuth:!1});ct(e)}catch{}})()},[]);const de=i.useRef(!1),ft=async e=>{if(!e)return;const n=performance.now();console.log(`[PRELOAD] Starting preload for next video ${e.id} (${e.stream_uid}) at ${n.toFixed(2)}ms`);try{const r=e.playback_url||(e.stream_uid?`https://videodelivery.net/${e.stream_uid}/manifest/video.m3u8`:null);if(!r)return;(async()=>{const a=performance.now();console.log(`[PRELOAD] Fetching manifest: ${r} at ${a.toFixed(2)}ms`);try{const c=await fetch(r,{priority:"high"}),g=performance.now()-a;if(console.log(`[PRELOAD] Manifest fetched in ${g.toFixed(2)}ms, status: ${c.status}`),c.ok){const v=await c.text(),I=new TextEncoder().encode(v).buffer,{setCached:R}=await Y(async()=>{const{setCached:m}=await import("./Popup-CnqFYqIJ.js").then(h=>h.v);return{setCached:m}},__vite__mapDeps([0,1,2,3,4,5,6]));await R(r,I,!0,e.stream_uid);const $=v.split(`
`),T=[];let A=r.substring(0,r.lastIndexOf("/")+1);for(let m=0;m<$.length&&T.length<3;m++){const h=$[m].trim();if(h&&!h.startsWith("#")&&(h.endsWith(".ts")||h.endsWith(".m4s"))){const l=h.startsWith("http")?h:A+h;T.push(l)}}for(let m=0;m<T.slice(0,2).length;m++){const h=T[m],l=performance.now();console.log(`[PRELOAD] Preloading segment ${m+1}: ${h} at ${l.toFixed(2)}ms`),fetch(h,{priority:"high"}).then(async d=>{const p=performance.now()-l;if(console.log(`[PRELOAD] Segment ${m+1} fetched in ${p.toFixed(2)}ms, status: ${d.status}`),d.ok)try{const D=performance.now(),V=await d.arrayBuffer(),L=performance.now()-D;console.log(`[PRELOAD] Segment ${m+1} buffer read in ${L.toFixed(2)}ms, size: ${V.byteLength} bytes`);const y=performance.now(),{setCached:z}=await Y(async()=>{const{setCached:ee}=await import("./Popup-CnqFYqIJ.js").then(wt=>wt.v);return{setCached:ee}},__vite__mapDeps([0,1,2,3,4,5,6]));await z(h,V,!1,e.stream_uid);const H=performance.now()-y;console.log(`[PRELOAD] Segment ${m+1} cached in ${H.toFixed(2)}ms`)}catch(D){console.error(`[PRELOAD] Error caching segment ${m+1}:`,D)}}).catch(d=>{const p=performance.now()-l;console.error(`[PRELOAD] Segment ${m+1} preload failed after ${p.toFixed(2)}ms:`,d)})}}}catch{}})()}catch{}};i.useEffect(()=>{G(!1),Se(!1),de.current?K(!1):K(!0)},[t==null?void 0:t.id]),i.useEffect(()=>{k.current&&(k.current.muted=F)},[F]),i.useEffect(()=>{if(!t){console.log("[VIDEO LOAD] No video available, skipping load");return}const e=performance.now(),n=u<b.length-1,r=n?"BACKWARD":"FORWARD";console.log(`[VIDEO LOAD] Starting load for video ${t.id} (${t.stream_uid}) at ${e.toFixed(2)}ms`),console.log(`[VIDEO LOAD] Navigation direction: ${r}, index=${u}, history.length=${b.length}`),console.log(`[VIDEO LOAD] Video details: id=${t.id}, stream_uid=${t.stream_uid}, playback_url=${t.playback_url||"null"}`),t.stream_uid&&Y(async()=>{const{setCurrentVideoForCache:c}=await import("./Popup-CnqFYqIJ.js").then(g=>g.h);return{setCurrentVideoForCache:c}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({setCurrentVideoForCache:c})=>{c(t.stream_uid),console.log(`[VIDEO LOAD] Set current video ${t.stream_uid} to use cache for looping`)});const o=t.playback_url||(t.stream_uid?`https://videodelivery.net/${t.stream_uid}/manifest/video.m3u8`:null);if(o){const c=performance.now();console.log(`[VIDEO LOAD] Prefetching manifest: ${o} at ${c.toFixed(2)}ms`),console.log(`[VIDEO LOAD] This is a ${n?"PREVIOUSLY SEEN":"NEW"} video - cache should ${n?"be available":"be populated"}`),fetch(o,{priority:"high"}).then(async g=>{const v=performance.now()-c;if(console.log(`[VIDEO LOAD] Manifest fetch completed in ${v.toFixed(2)}ms, status: ${g.status}`),g.ok)try{const E=performance.now(),I=await g.text(),R=performance.now()-E;console.log(`[VIDEO LOAD] Manifest text read in ${R.toFixed(2)}ms, size: ${I.length} bytes`);const $=performance.now(),A=new TextEncoder().encode(I).buffer,{setCached:m}=await Y(async()=>{const{setCached:V}=await import("./Popup-CnqFYqIJ.js").then(L=>L.v);return{setCached:V}},__vite__mapDeps([0,1,2,3,4,5,6]));await m(o,A,!0,t.stream_uid);const h=performance.now()-$;console.log(`[VIDEO LOAD] Manifest cached in IndexedDB in ${h.toFixed(2)}ms`);const l=performance.now(),{memoryCache:d}=await Y(async()=>{const{memoryCache:V}=await import("./Popup-CnqFYqIJ.js").then(L=>L.h);return{memoryCache:V}},__vite__mapDeps([0,1,2,3,4,5,6]));d.set(o,A);const p=performance.now()-l;console.log(`[VIDEO LOAD] Manifest added to memory cache in ${p.toFixed(2)}ms`);const D=performance.now()-c;console.log(`[VIDEO LOAD] Total manifest prefetch time: ${D.toFixed(2)}ms`)}catch(E){console.error("[VIDEO LOAD] Error caching manifest:",E)}}).catch(g=>{const v=performance.now()-c;console.error(`[VIDEO LOAD] Manifest prefetch failed after ${v.toFixed(2)}ms:`,g)})}if(n)console.log("[VIDEO LOAD] Skipping preload for backward navigation (video should be cached)");else{const c=S.length>0?S[0]:u<b.length-1?b[u+1]:null;c&&c.id!==t.id&&(console.log(`[VIDEO LOAD] Preloading next video ${c.id} for forward navigation`),ft(c))}const a=performance.now()-e;console.log(`[VIDEO LOAD] Total video load setup completed in ${a.toFixed(2)}ms for video ${t.id}`)},[t==null?void 0:t.id,S,u,b]);const Te=i.useRef(!1),mt=e=>{k.current=e,e?(console.log(`[VIDEO REF] Video element ref set for video ${t==null?void 0:t.id}, readyState=${e.readyState}`),e.muted=F,Te.current&&de.current&&(Te.current=!1,K(!1),e.muted=!1)):console.log("[VIDEO REF] Video element ref cleared")},He=async()=>{if(t!=null&&t.id)try{const e=await w(x.videos.comments(t.id),{requireAuth:!1});Fe(e.items||[])}catch{}};i.useEffect(()=>{f&&(t!=null&&t.id)&&He()},[f,t==null?void 0:t.id]);const Ye=async e=>{if(e.preventDefault(),!(!J.trim()||!(t!=null&&t.id))){Me(!0);try{await w(x.videos.comments(t.id),{method:"POST",body:JSON.stringify({text:J.trim(),parent_id:Ie||void 0})}),se(""),je(null),He(),N(n=>{const r=[...n],o=r.findIndex(a=>a.id===t.id);return o!==-1&&(r[o]={...r[o],comments_count:(r[o].comments_count||0)+1}),r}),O("Comment posted!",{variant:"success"})}catch(n){O((n==null?void 0:n.message)||"Failed to post comment",{variant:"error"})}finally{Me(!1)}}},ht=e=>{Fe(n=>n.filter(r=>r.id!==e)),N(n=>{const r=[...n],o=r.findIndex(a=>a.id===(t==null?void 0:t.id));return o!==-1&&(r[o]={...r[o],comments_count:Math.max(0,(r[o].comments_count||0)-1)}),r})},Ge=Pe.filter(e=>!e.parent_id),ue=new Map;Pe.filter(e=>e.parent_id).forEach(e=>{const n=e.parent_id;ue.has(n)||ue.set(n,[]),ue.get(n).push(e)});const k=i.useRef(null),fe=i.useRef(null),q=i.useRef(!1),pt=()=>{if(!k.current||q.current)return;const e=k.current,n=!F;K(n),e.muted=n,n||(de.current=!0),!n&&e.paused&&e.play().catch(r=>{console.debug("Play failed after unmute:",r)})},Je=()=>{k.current&&(q.current=!1,fe.current=window.setTimeout(()=>{q.current=!0;const e=k.current;e&&!e.paused&&e.pause()},200))},Ae=()=>{if(fe.current&&(clearTimeout(fe.current),fe.current=null),q.current&&k.current){const e=k.current;e.paused&&e.play().catch(n=>console.debug("Resume failed:",n)),q.current=!1}},gt=()=>{Je()},xt=e=>{q.current&&e.preventDefault(),Ae()},Ke=!!(P!=null&&P.is_admin||P!=null&&P.is_mod);async function bt(){if(!t)return;const e=!t.is_starred,n=e?"star":"unstar";try{await w(x.admin.videosAction(t.id,n),{method:"POST"}),N(r=>{const o=[...r];return o[u]={...o[u],is_starred:e},o}),be(!1),O(e?"Post starred":"Star removed",{variant:"success"})}catch{O("Action failed",{variant:"error"})}}async function Xe(){if(t&&confirm("Permanently delete this video?"))try{await w(x.videos.delete(t.id),{method:"DELETE"}),O("Deleted",{variant:"warn"}),ne(!1),N(e=>{const n=e.filter((r,o)=>o!==u);return n.length===0?(C.current=0,B(-1),setTimeout(ie,0)):(C.current+=1,B(r=>Math.max(0,Math.min(r,n.length-1)))),n})}catch{alert("Delete failed")}}_t();const Qe=i.useRef(null),[me,yt]=i.useState(0);return i.useEffect(()=>{const e=()=>{const n=document.querySelector(".top-nav");n&&yt(n.offsetHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.jsxs(s.Fragment,{children:[s.jsx(Et,{paused:!1}),s.jsxs("div",{ref:Qe,className:"player-wrap",style:{height:"100dvh",width:"100%",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"transparent",zIndex:1},children:[U&&s.jsx("div",{className:"chip info",style:{position:"absolute",top:me+20,left:"50%",transform:"translateX(-50%)",zIndex:10,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)"},children:"You're all caught up. Check 'Feed' to watch videos you've seen already."}),s.jsx("div",{className:"video-area",style:{position:"absolute",top:me,left:0,right:0,bottom:f?"50%":0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",transition:"bottom 0.3s ease-out",overflow:"hidden"},children:at?s.jsxs("div",{className:"col",style:{alignItems:"center",zIndex:10},children:[s.jsx("div",{className:"muted",style:{marginBottom:8},children:"Please log in to view videos."}),s.jsx("button",{className:"btn",onClick:()=>window.location.href=x.auth.login,children:"Login with osu!"})]}):t?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:we&&t.beatmapset_id?s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxSizing:"border-box"},children:s.jsx(At,{downloadUrl:t.beatmapset_id?x.osu.downloadBeatmapset(t.beatmapset_id):"",beatmapId:t.beatmap_id??void 0,beatmapVersion:t.beatmap_version??void 0,onOpenInEditor:()=>{G(!1),window.location.hash="/editor"}})}):s.jsxs("div",{style:{width:f?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",maxWidth:f?"clamp(50vw, 60vw, 90vw)":"clamp(60vw, 75vw, 90vw)",height:"100%",maxHeight:f?`calc(50vh - ${me}px)`:`calc(100vh - ${me}px)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"width 0.3s ease-out, max-width 0.3s ease-out, max-height 0.3s ease-out"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:"none"}}),s.jsx("div",{style:{position:"relative",zIndex:1},children:s.jsxs("div",{onClick:pt,onMouseDown:Je,onMouseUp:Ae,onMouseLeave:Ae,onTouchStart:gt,onTouchEnd:xt,style:{width:"100%",height:"100%",cursor:"pointer",position:"relative"},children:[s.jsx(Tt,{videoKey:C.current,streamUID:t.stream_uid,playbackUrl:t.playback_url,aspectRatio:t!=null&&t.width&&(t!=null&&t.height)?t.width/t.height:16/9,preferNative:!0,autoplay:!0,loop:!0,muted:F,controls:!1,onVideoRef:mt},`${t.id}-${C.current}`),s.jsx("div",{style:{position:"absolute",bottom:16,left:16,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transition:"opacity 0.3s ease",opacity:F?1:0},children:F?s.jsx(St,{size:20,color:"#fff"}):s.jsx(It,{size:20,color:"#fff"})})]})})]})}):U?null:s.jsxs("div",{className:"muted",style:{zIndex:10,textAlign:"center",padding:"20px",maxWidth:"400px"},children:[s.jsx("div",{style:{marginBottom:12,fontSize:14,fontWeight:500},children:"How to navigate"}),s.jsxs("div",{style:{fontSize:12,lineHeight:1.6},children:[s.jsx("div",{children:"• Scroll up/down or swipe to change videos"}),s.jsx("div",{children:"• Click video to toggle mute/unmute"}),s.jsx("div",{children:"• Hold to pause temporarily"})]})]})}),t&&!we&&s.jsxs("div",{style:{position:"absolute",right:f?12:16,top:"50%",display:"flex",flexDirection:"column",gap:f?12:20,alignItems:"center",zIndex:15,pointerEvents:"auto",transition:"right 0.3s ease-out, gap 0.3s ease-out, transform 0.3s ease-out",transform:f?"translateY(-50%) scale(0.85)":"translateY(-50%) scale(1)",transformOrigin:"center right"},onClick:e=>e.stopPropagation(),children:[s.jsx(rt,{to:`/profile/${(Ze=t.uploader)==null?void 0:Ze.id}`,style:{width:48,height:48,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.3)",overflow:"hidden",background:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},children:(et=t.uploader)!=null&&et.avatar_url?s.jsx("img",{src:t.uploader.avatar_url,width:48,height:48,style:{borderRadius:"50%",objectFit:"cover",display:"block"},alt:t.uploader.username}):s.jsx("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.1)"}})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:ut,disabled:it,"aria-label":t.liked_by_me?"Unlike":"Like",title:t.liked_by_me?"Unlike":"Like",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:t.liked_by_me?"#f87171":"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:t.liked_by_me?s.jsx(jt,{size:28}):s.jsx(kt,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.likes_count??0})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[s.jsx("button",{onClick:()=>Se(!0),"aria-label":"Comments",title:"Comments",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(Rt,{size:28})}),s.jsx("span",{style:{color:"#fff",fontSize:12,fontWeight:600,textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:t.comments_count??0})]}),t.beatmap_url&&s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{ref:_e,onClick:()=>re(e=>!e),title:"Beatmap options","aria-label":"Beatmap options",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(st,{size:24})}),ve&&s.jsxs("div",{ref:Ee,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsxs("a",{className:"menu-item",href:t.beatmap_url,target:"_blank",rel:"noreferrer",onClick:()=>re(!1),children:[s.jsx(st,{size:16,style:{marginRight:8}}),"osu.ppy.sh"]}),t.beatmapset_id&&s.jsx("button",{className:"menu-item",onClick:()=>{G(!0),re(!1)},children:"Preview"})]})]}),Ke?s.jsxs("div",{style:{position:"relative"},children:[s.jsx("button",{onClick:()=>be(e=>!e),title:"Manage","aria-label":"Manage",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(ot,{size:24})}),xe&&s.jsxs("div",{ref:ye,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:180,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("button",{className:"menu-item",onClick:bt,children:t.is_starred?"Unstar post":"Star post"}),s.jsx("button",{className:"menu-item",onClick:Xe,children:"Delete video"})]})]}):s.jsx("button",{onClick:()=>ne(e=>!e),title:"Report","aria-label":"Report",style:{width:48,height:48,borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",transition:"transform 0.2s ease",pointerEvents:"auto"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx(Dt,{size:24})}),pe&&s.jsxs("div",{ref:ge,style:{position:"absolute",bottom:60,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:6,zIndex:100,minWidth:160,boxShadow:"0 12px 30px rgba(0,0,0,0.4)"},children:[s.jsx("div",{className:"muted",style:{fontSize:12,padding:"4px 8px"},children:"Report as…"}),s.jsx("button",{className:"menu-item",onClick:()=>qe("unrelated"),children:"Unrelated"}),s.jsx("button",{className:"menu-item",onClick:()=>qe("explicit"),children:"Explicit"}),Ke&&s.jsx("button",{className:"menu-item",onClick:Xe,children:"Delete video"})]})]}),t&&!we&&s.jsxs("div",{style:{position:"absolute",left:f?12:16,bottom:f?"55%":80,right:f?200:80,zIndex:15,pointerEvents:"none",display:"flex",flexDirection:"column",gap:f?8:12,transition:"left 0.3s ease-out, bottom 0.3s ease-out, right 0.3s ease-out, gap 0.3s ease-out",transform:f?"scale(0.9)":"scale(1)",transformOrigin:"bottom left"},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto"},children:s.jsx(rt,{to:`/profile/${(tt=t.uploader)==null?void 0:tt.id}`,style:{textDecoration:"none",color:"#fff",fontWeight:600,fontSize:f?"clamp(12px, 14px, 16px)":"clamp(14px, 16px, 18px)",display:"flex",alignItems:"center",gap:8,textShadow:"0 1px 3px rgba(0,0,0,0.8)",transition:"font-size 0.3s ease-out"},children:(()=>{var o,a,c;const e=(o=t.uploader)==null?void 0:o.is_admin,n=(a=t.uploader)==null?void 0:a.is_mod,r=e?"#fff3bf":n?"#d7fbe8":"#fff";return s.jsxs(s.Fragment,{children:[s.jsxs("span",{style:{color:r},children:["@",(c=t.uploader)==null?void 0:c.username]}),t.is_starred&&s.jsx(Ot,{size:f?14:16,color:"#f59e0b",title:"Starred"}),(e||n)&&s.jsx(ot,{size:f?12:14,color:r,title:e?"admin":"mod"})]})})()})}),(t.description??"").trim()&&s.jsx("div",{style:{color:"#fff",fontSize:f?"clamp(10px, 12px, 14px)":"clamp(12px, 14px, 16px)",lineHeight:1.5,textShadow:"0 1px 3px rgba(0,0,0,0.8)",maxWidth:"85%",wordBreak:"break-word",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:t.description}),t.beatmap_title&&s.jsxs("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:f?"clamp(9px, 11px, 13px)":"clamp(11px, 13px, 15px)",textShadow:"0 1px 3px rgba(0,0,0,0.8)",pointerEvents:"auto",transition:"font-size 0.3s ease-out"},children:[t.beatmap_artist," – ",t.beatmap_title," ",t.beatmap_mapper?`(by ${t.beatmap_mapper})`:""," ",t.beatmap_version?`[${t.beatmap_version}]`:""]})]}),f&&t&&s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
            @keyframes slideUp {
              from {
                transform: translateY(100%);
              }
              to {
                transform: translateY(0);
              }
            }
          `}),s.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"var(--panel)",borderTop:"1px solid rgba(255,255,255,0.08)",borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column",zIndex:20,boxShadow:"0 -4px 20px rgba(0,0,0,0.3)",animation:"slideUp 0.3s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[s.jsxs("div",{style:{fontSize:18,fontWeight:600},children:["Comments (",t.comments_count??0,")"]}),s.jsx("button",{onClick:()=>Se(!1),style:{background:"transparent",border:"none",color:"var(--text)",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close comments",children:s.jsx(Ct,{size:24})})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:Ge.length===0?s.jsx("div",{className:"muted",style:{textAlign:"center",padding:48},children:"No comments yet. Be the first to comment!"}):s.jsx("div",{className:"col",style:{gap:0},children:Ge.map(e=>s.jsx(Lt,{comment:e,replies:ue.get(e.id)||[],me:P,section:"mappi",onReply:n=>je(n),onDelete:ht,replyingTo:Ie,replyText:J,onReplyTextChange:se,onReplySubmit:Ye,posting:ke,onCancelReply:()=>{je(null),se("")}},e.id))})}),P&&!Ie&&s.jsx("div",{style:{padding:"12px 20px",borderTop:"1px solid rgba(255,255,255,0.06)",background:"var(--panel-dark)"},children:s.jsxs("form",{onSubmit:Ye,style:{display:"flex",alignItems:"flex-end",gap:8},children:[s.jsx("textarea",{placeholder:"Write a comment...",value:J,onChange:e=>se(e.target.value),rows:1,style:{flex:1,background:"#0b0d10",border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:"8px 12px",color:"var(--text)",fontFamily:"inherit",fontSize:13,resize:"none",minHeight:"36px",maxHeight:"120px",overflowY:"auto"},onInput:e=>{const n=e.target;n.style.height="auto",n.style.height=`${Math.min(n.scrollHeight,120)}px`}}),s.jsx("button",{type:"submit",className:"btn compact",disabled:ke||!J.trim(),style:{padding:"8px 16px",fontSize:13,flexShrink:0},children:ke?"...":"Post"})]})})]})]})]})]})}export{Ut as default};
